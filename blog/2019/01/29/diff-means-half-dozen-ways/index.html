<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Hong T.M. Chu">
<meta name="description" content="Learn how to run standard t-tests, simulations, and Bayesian difference in means tests with R and Stan">
<title>Half a dozen frequentist and Bayesian ways to measure the difference in means in two groups | Hong T.M. Chu – Hong T.M. Chu</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../../">
<link href="../../../../..//files/favicon-512.png" rel="icon" type="image/png">
<script src="../../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting-17c909d5fd25ae21b861c0c7a49b2096.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../site_libs/bootstrap/bootstrap-5cd0811f461c8271ae6bab49df9501be.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script src="../../../../../site_libs/quarto-contrib/iconify-2.0.0/iconify-icon.min.js"></script><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-527449-5', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script><style>

      .quarto-title-block .quarto-title-banner {
        background: #170C3A;
      }
</style>
<script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
<meta property="og:title" content="Half a dozen frequentist and Bayesian ways to measure the difference in means in two groups | Hong T.M. Chu">
<meta property="og:description" content="Learn how to run standard t-tests, simulations, and Bayesian difference in means tests with R and Stan">
<meta property="og:image" content="https://www.andrewheiss.com/blog/2019/01/29/diff-means-half-dozen-ways/compare-everything-1.png">
<meta property="og:site_name" content="Hong T.M. Chu">
<meta property="og:locale" content="en_US">
<meta property="og:image:height" content="624">
<meta property="og:image:width" content="1344">
<meta name="twitter:title" content="Half a dozen frequentist and Bayesian ways to measure the difference in means in two groups | Hong T.M. Chu">
<meta name="twitter:description" content="Learn how to run standard t-tests, simulations, and Bayesian difference in means tests with R and Stan">
<meta name="twitter:image" content="https://www.andrewheiss.com/blog/2019/01/29/diff-means-half-dozen-ways/compare-everything-1.png">
<meta name="twitter:creator" content="@andrewheiss">
<meta name="twitter:site" content="@andrewheiss">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image-height" content="624">
<meta name="twitter:image-width" content="1344">
</head>
<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../../index.html">
    <span class="navbar-title">Hong T.M. Chu</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../../../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../cv/index.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../research/index.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../teaching/index.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="mailto:hong.ctm@vinuni.edu.vn"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:envelope" style="font-size: 1.1em;" aria-label="Icon envelope from bi Iconify.design set." title="E-mail"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/andrewheiss" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:github" style="font-size: 1.1em;" aria-label="Icon github from bi Iconify.design set." title="GitHub"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/hongtmchu" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:linkedin" style="font-size: 1.1em;" aria-label="Icon linkedin from bi Iconify.design set." title="LinkedIn"></iconify-icon></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default blog-post page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Half a dozen frequentist and Bayesian ways to measure the difference in means in two groups</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
                  <div>
        <div class="description">
          Learn how to run standard t-tests, simulations, and Bayesian difference in means tests with R and Stan
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">r</div>
                <div class="quarto-category">ggplot</div>
                <div class="quarto-category">tidyverse</div>
                <div class="quarto-category">stan</div>
                <div class="quarto-category">bayes</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://www.andrewheiss.com/">Andrew Heiss</a> <a href="https://orcid.org/0000-0002-3948-3914" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">Tuesday, January 29, 2019</p>
      </div>
    </div>
    
      
      <div>
      <div class="quarto-title-meta-heading">Doi</div>
      <div class="quarto-title-meta-contents">
        <p class="doi">
          <a href="https://doi.org/10.59350/94eck-1gd29">10.59350/94eck-1gd29</a>
        </p>
      </div>
    </div>
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Contents</h2>
   
  <ul>
<li><a href="#data" id="toc-data" class="nav-link active" data-scroll-target="#data">Data</a></li>
  <li>
<a href="#classical-frequentist-t-tests" id="toc-classical-frequentist-t-tests" class="nav-link" data-scroll-target="#classical-frequentist-t-tests">Classical frequentist t-tests</a>
  <ul class="collapse">
<li><a href="#t-test-assuming-equal-variances" id="toc-t-test-assuming-equal-variances" class="nav-link" data-scroll-target="#t-test-assuming-equal-variances">t-test, assuming equal variances</a></li>
  <li><a href="#t-test-assuming-unequal-variance" id="toc-t-test-assuming-unequal-variance" class="nav-link" data-scroll-target="#t-test-assuming-unequal-variance">t-test, assuming unequal variance</a></li>
  </ul>
</li>
  <li><a href="#simulation-based-tests" id="toc-simulation-based-tests" class="nav-link" data-scroll-target="#simulation-based-tests">Simulation-based tests</a></li>
  <li>
<a href="#bayesian-regression" id="toc-bayesian-regression" class="nav-link" data-scroll-target="#bayesian-regression">Bayesian regression</a>
  <ul class="collapse">
<li><a href="#regression-assuming-equal-variances" id="toc-regression-assuming-equal-variances" class="nav-link" data-scroll-target="#regression-assuming-equal-variances">Regression, assuming equal variances</a></li>
  <li><a href="#a-quick-digression-into-priors" id="toc-a-quick-digression-into-priors" class="nav-link" data-scroll-target="#a-quick-digression-into-priors">A quick digression into priors</a></li>
  <li><a href="#regression-assuming-unequal-variances" id="toc-regression-assuming-unequal-variances" class="nav-link" data-scroll-target="#regression-assuming-unequal-variances">Regression, assuming unequal variances</a></li>
  <li><a href="#regression-best" id="toc-regression-best" class="nav-link" data-scroll-target="#regression-best">Regression, BEST</a></li>
  </ul>
</li>
  <li><a href="#bayesian-analysis-directly-with-stan" id="toc-bayesian-analysis-directly-with-stan" class="nav-link" data-scroll-target="#bayesian-analysis-directly-with-stan">Bayesian analysis, directly with Stan</a></li>
  <li><a href="#regression-best-with-priors-on-variables-instead-of-difference" id="toc-regression-best-with-priors-on-variables-instead-of-difference" class="nav-link" data-scroll-target="#regression-best-with-priors-on-variables-instead-of-difference">Regression, BEST, with priors on variables instead of difference</a></li>
  <li><a href="#comparing-all-methods" id="toc-comparing-all-methods" class="nav-link" data-scroll-target="#comparing-all-methods">Comparing all methods</a></li>
  </ul></nav>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content"><p><span class="small">(<a href="https://github.com/andrewheiss/diff-means-half-dozen-ways">See this notebook on GitHub</a>)</span></p>
<hr>
<p>Taking a sample from two groups from a population and seeing if there’s a significant or substantial difference between them is a standard task in statistics. Measuring performance on a test before and after some sort of intervention, measuring average GDP in two different continents, measuring average height in two groups of flowers, etc.—we like to know if any group differences we see are attributable to chance / measurement error, or if they’re real.</p>
<p>Classical frequentist statistics typically measures the difference between groups with a <a href="https://en.wikipedia.org/wiki/Student%27s_t-test">t-test</a>, but t-tests are 100+ years old and statistical methods have advanced a lot since 1908. Nowadays, we can use simulation and/or Bayesian methods to get richer information about the differences between two groups without worrying so much about the assumptions and preconditions for classical t-tests.</p>
<p>Mostly as a resource to future me, here are a bunch of different ways to measure the difference in means in two groups. I’ve done them all in real life projects, but I’m tired of constantly searching my computer for the code to do them:)</p>
<p>These ways can all be adapted to different situations (i.e.&nbsp;difference in proportions, one-sample difference in means, etc.). The process for simulation and Bayesian approaches will be roughly the same, while for frequentist approaches, you’ll need to walk through a <a href="https://www.google.com/search?q=statistical+test+workflow&amp;tbm=isch">statistical test workflow</a> to find the appropriate test.</p>
<p>Also, this is long and really kind of meant as a general reference. Here’s a tl;dr table of contents:</p>
<ul>
<li><a href="#data">Data</a></li>
<li>
<a href="#classical-frequentist-t-tests">Classical frequentist t-tests</a>
<ul>
<li><a href="#t-test-assuming-equal-variances">t-test, assuming equal variances</a></li>
<li><a href="#t-test-assuming-unequal-variance">t-test, assuming unequal variance</a></li>
</ul>
</li>
<li><a href="#simulation-based-tests">Simulation-based tests</a></li>
<li>
<a href="#bayesian-regression">Bayesian regression</a>
<ul>
<li><a href="#regression-assuming-equal-variances">Regression, assuming equal variances</a></li>
<li><a href="#a-quick-digression-into-priors">A quick digression into priors</a></li>
<li><a href="#regression-assuming-unequal-variances">Regression, assuming unequal variances</a></li>
<li><a href="#regression-best">Regression, BEST</a></li>
</ul>
</li>
<li><a href="#bayesian-analysis-directly-with-stan">Bayesian analysis, directly with Stan</a></li>
<li><a href="#regression-best-with-priors-on-variables-instead-of-difference">Regression, BEST, with priors on variables instead of difference</a></li>
<li><a href="#comparing-all-methods">Comparing all methods</a></li>
</ul>
<section id="data" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="data">Data</h2>
<p>First we need some data to play with. We’ll use the <a href="https://cran.r-project.org/package=ggplot2movies"><strong>ggplot2movies</strong> package</a>, which contains information about almost 60,000 movies from IMDB from 1893 to 2005. For this example, we want to see if there is a significant/substantial/real difference in the average IMDB rating for action movies and comedies. Are people more likely to rate comedies higher than action movies?</p>
<p>Instead of working with all 20,407 action movies and comedies, we take a random sample of 200 each. (This is just so we can have some variation in the group averages—if we work with all 20,000, the confidence intervals for each group average basically disappear since there are so many observations.)</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>  <span class="co"># ggplot, dplyr, and friends</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/ggridges/">ggridges</a></span><span class="op">)</span>   <span class="co"># Ridge plots</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lionel-/ggstance">ggstance</a></span><span class="op">)</span>   <span class="co"># Horizontal pointranges and bars</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span>  <span class="co"># Lay out multiple ggplot plots; install from https://github.com/thomasp85/patchwork</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org">scales</a></span><span class="op">)</span>     <span class="co"># Nicer formatting for numbers</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span>      <span class="co"># Convert model results to tidy data frames</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/infer">infer</a></span><span class="op">)</span>      <span class="co"># Statistical inference with simulation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstan/">rstan</a></span><span class="op">)</span>      <span class="co"># R interface to Stan</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms">brms</a></span><span class="op">)</span>       <span class="co"># Run Stan-based models with standard R syntax</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ggplot2movies</span><span class="op">)</span>  <span class="co"># Lots of movies from IMDB</span></span>
<span></span>
<span></span>
<span><span class="co"># Clean up data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>  <span class="co"># Set seed so we get the same sampled rows every time</span></span>
<span><span class="va">movies_clean</span> <span class="op">&lt;-</span> <span class="va">movies</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># Make a binary column for genre</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">title</span>, <span class="va">year</span>, <span class="va">rating</span>, <span class="va">Action</span>, <span class="va">Comedy</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">Action</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">Comedy</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>genre <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="va">Action</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"Action"</span>,</span>
<span>                           <span class="va">Comedy</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"Comedy"</span>,</span>
<span>                           <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"Neither"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">genre</span> <span class="op">!=</span> <span class="st">"Neither"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># Make a numeric version of genre, where action = 1, comedy = 2</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>genre_numeric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">genre</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># Make genre a factor</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>genre <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">genre</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">Action</span>, <span class="op">-</span><span class="va">Comedy</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># Randomly select 200 movies in each genre</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">genre</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">sample_n</span><span class="op">(</span><span class="fl">200</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To get a sense of the data, we’ll do some quick exploratory data analysis with a bunch of different graph types.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Make a custom theme</span></span>
<span><span class="co"># I'm using Asap Condensed; download from </span></span>
<span><span class="co"># https://fonts.google.com/specimen/Asap+Condensed</span></span>
<span><span class="va">theme_fancy</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span>base_family <span class="op">=</span> <span class="st">"Asap Condensed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">eda_boxplot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">movies_clean</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">genre</span>, y <span class="op">=</span> <span class="va">rating</span>, fill <span class="op">=</span> <span class="va">genre</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#0288b7"</span>, <span class="st">"#a90010"</span><span class="op">)</span>, guide <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"Rating"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_fancy</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">eda_histogram</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">movies_clean</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">rating</span>, fill <span class="op">=</span> <span class="va">genre</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#0288b7"</span>, <span class="st">"#a90010"</span><span class="op">)</span>, guide <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Count"</span>, x <span class="op">=</span> <span class="st">"Rating"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">genre</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_fancy</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid.major.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">eda_ridges</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">movies_clean</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">rating</span>, y <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="va">genre</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">genre</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_density_ridges</span><span class="op">(</span>quantile_lines <span class="op">=</span> <span class="cn">TRUE</span>, quantiles <span class="op">=</span> <span class="fl">2</span>, scale <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#0288b7"</span>, <span class="st">"#a90010"</span><span class="op">)</span>, guide <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Rating"</span>, y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"White line shows median rating"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_fancy</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">eda_boxplot</span> <span class="op">|</span> <span class="va">eda_histogram</span><span class="op">)</span> <span class="op">/</span> </span>
<span>    <span class="va">eda_ridges</span> <span class="op">+</span> </span>
<span>  <span class="fu">plot_annotation</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Do comedies get higher ratings than action movies?"</span>,</span>
<span>                  subtitle <span class="op">=</span> <span class="st">"Sample of 400 movies from IMDB"</span>,</span>
<span>                  theme <span class="op">=</span> <span class="fu">theme</span><span class="op">(</span>text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Asap Condensed"</span><span class="op">)</span>,</span>
<span>                                plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>                                                          size <span class="op">=</span> <span class="fu">rel</span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="eda-plots-1.png" class="img-fluid figure-img"></p>
<figcaption class="margin-caption">Exploratory data analysis</figcaption></figure>
</div>
<p>Initially, it looks like there might be a difference in average rating. Comedies tend to have higher ratings. We can calculate the difference with some <strong>dplyr</strong> <code>group_by() %&gt;% summarize()</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">group_diffs</span> <span class="op">&lt;-</span> <span class="va">movies_clean</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">genre</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span>avg_rating <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">rating</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>diff_means <span class="op">=</span> <span class="va">avg_rating</span> <span class="op">-</span> <span class="fu">lead</span><span class="op">(</span><span class="va">avg_rating</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">group_diffs</span></span>
<span></span>
<span><span class="co">## # A tibble: 2 x 3</span></span>
<span><span class="co">##   genre  avg_rating diff_means</span></span>
<span><span class="co">##   &lt;fct&gt;       &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span><span class="co">## 1 Action       5.28     -0.682</span></span>
<span><span class="co">## 2 Comedy       5.97     NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Yep. There’s a -0.6825 point difference in ratings. Action movies score 0.7 points lower than comedies, on average.</p>
<p>But how certain are we that that difference is real and not just due to sampling error? It’s time for inference!</p>
</section><section id="classical-frequentist-t-tests" class="level2"><h2 class="anchored" data-anchor-id="classical-frequentist-t-tests">Classical frequentist t-tests</h2>
<section id="t-test-assuming-equal-variances" class="level3"><h3 class="anchored" data-anchor-id="t-test-assuming-equal-variances">t-test, assuming equal variances</h3>
<p>We can use a standard frequentist t-test to check if the group means are different. We can assume that the variances in the two groups are the same and run <code><a href="https://rdrr.io/r/stats/t.test.html">t.test()</a></code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Assume equal variances</span></span>
<span><span class="va">t_test_eq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">rating</span> <span class="op">~</span> <span class="va">genre</span>, data <span class="op">=</span> <span class="va">movies_clean</span>, var.equal <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">t_test_eq</span></span>
<span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Two Sample t-test</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  rating by genre</span></span>
<span><span class="co">## t = -4.4753, df = 398, p-value = 0.000009977</span></span>
<span><span class="co">## alternative hypothesis: true difference in means is not equal to 0</span></span>
<span><span class="co">## 95 percent confidence interval:</span></span>
<span><span class="co">##  -0.9823168 -0.3826832</span></span>
<span><span class="co">## sample estimates:</span></span>
<span><span class="co">## mean in group Action mean in group Comedy </span></span>
<span><span class="co">##               5.2845               5.9670</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The default output is helpful—the p-value is really tiny, which means there’s a tiny chance that we’d see a difference that big in group means in a world where there’s no difference. However, in this format, it’s hard to extract any of these values for later use, like in plotting. We can use the <code>tidy()</code> function from the <strong>broom</strong> library to convert these t-test results to a nice data frame.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">t_test_eq_tidy</span> <span class="op">&lt;-</span> <span class="fu">tidy</span><span class="op">(</span><span class="va">t_test_eq</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># Calculate difference in means, since t.test() doesn't actually do that</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>estimate <span class="op">=</span> <span class="va">estimate1</span> <span class="op">-</span> <span class="va">estimate2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># Rearrange columns</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"estimate"</span><span class="op">)</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">t_test_eq_tidy</span></span>
<span></span>
<span><span class="co">## # A tibble: 1 x 10</span></span>
<span><span class="co">##   estimate1 estimate2 estimate statistic p.value parameter conf.low</span></span>
<span><span class="co">##       &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">## 1      5.28      5.97   -0.682     -4.48 9.98e-6       398   -0.982</span></span>
<span><span class="co">## # … with 3 more variables: conf.high &lt;dbl&gt;, method &lt;chr&gt;,</span></span>
<span><span class="co">## #   alternative &lt;chr&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By default, though, R does not assume that the variance in the two groups’ populations is equal, which is probably a reasonable thing to do. There may be structural differences in how comedies and action movies are produced, which in turn leads to structural differences in how they’re rated.</p>
<p>There are several systematic ways to check if the two groups have equal variance. For all these tests, the null hypothesis is that the two groups have similar (homogeneous) variances. If the p-value is less than 0.05, we can assume that they have unequal or heterogeneous variances. (<a href="https://statistic-on-air.blogspot.com/2009/07/analysis-of-variance-anova-for-multiple.html">Here’s a helpful overview</a> of this process.)</p>
<ul>
<li>
<p><a href="https://en.wikipedia.org/wiki/Bartlett%27s_test"><strong>Bartlett test</strong></a>: Check homogeneity of variances based on the mean</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/bartlett.test.html">bartlett.test</a></span><span class="op">(</span><span class="va">rating</span> <span class="op">~</span> <span class="va">genre</span>, data <span class="op">=</span> <span class="va">movies_clean</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Bartlett test of homogeneity of variances</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  rating by genre</span></span>
<span><span class="co">## Bartlett's K-squared = 0.10006, df = 1, p-value = 0.7518</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Levene%27s_test"><strong>Levene test</strong></a>: Check homogeneity of variances based on the median, so it’s more robust to outliers</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Install the car package first</span></span>
<span><span class="fu">car</span><span class="fu">::</span><span class="fu">leveneTest</span><span class="op">(</span><span class="va">rating</span> <span class="op">~</span> <span class="va">genre</span>, data <span class="op">=</span> <span class="va">movies_clean</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Levene's Test for Homogeneity of Variance (center = median)</span></span>
<span><span class="co">##        Df F value Pr(&gt;F)</span></span>
<span><span class="co">## group   1  0.4917 0.4836</span></span>
<span><span class="co">##       398</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</li>
<li>
<p><a href="https://biostats.w.uib.no/test-for-homogeneity-of-variances-levenes-test/"><strong>Fligner-Killeen test</strong></a>: Check homogeneity of variances based on the median, so it’s more robust to outliers</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/fligner.test.html">fligner.test</a></span><span class="op">(</span><span class="va">rating</span> <span class="op">~</span> <span class="va">genre</span>, data <span class="op">=</span> <span class="va">movies_clean</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Fligner-Killeen test of homogeneity of variances</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  rating by genre</span></span>
<span><span class="co">## Fligner-Killeen:med chi-squared = 0.78337, df = 1, p-value = 0.3761</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Kruskal%E2%80%93Wallis_one-way_analysis_of_variance"><strong>Kruskal-Wallis test</strong></a>: Check homogeneity of distributions nonparametrically</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/kruskal.test.html">kruskal.test</a></span><span class="op">(</span><span class="va">rating</span> <span class="op">~</span> <span class="va">genre</span>, data <span class="op">=</span> <span class="va">movies_clean</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Kruskal-Wallis rank sum test</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  rating by genre</span></span>
<span><span class="co">## Kruskal-Wallis chi-squared = 19.787, df = 1, p-value = 0.000008655</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</li>
</ul>
<p>Phew. In all these tests except the Kruskall-Wallis test, we don’t have enough evidence to conclude that the variances are different, so we’re probably safe leaving <code>var.equal = TRUE</code> on.</p>
</section><section id="t-test-assuming-unequal-variance" class="level3"><h3 class="anchored" data-anchor-id="t-test-assuming-unequal-variance">t-test, assuming unequal variance</h3>
<p>We can run a t-test assuming that the two groups have unequal variances by setting <code>var.equal = FALSE</code>, or just leaving it off. I generally just do this instead of going through all the tests for equal variance.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Assume unequal variances</span></span>
<span><span class="va">t_test_uneq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">rating</span> <span class="op">~</span> <span class="va">genre</span>, data <span class="op">=</span> <span class="va">movies_clean</span><span class="op">)</span></span>
<span><span class="va">t_test_uneq_tidy</span> <span class="op">&lt;-</span> <span class="fu">tidy</span><span class="op">(</span><span class="va">t_test_uneq</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>estimate <span class="op">=</span> <span class="va">estimate1</span> <span class="op">-</span> <span class="va">estimate2</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"estimate"</span><span class="op">)</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">t_test_uneq_tidy</span></span>
<span></span>
<span><span class="co">## # A tibble: 1 x 10</span></span>
<span><span class="co">##   estimate estimate1 estimate2 statistic p.value parameter conf.low</span></span>
<span><span class="co">##      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">## 1   -0.682      5.28      5.97     -4.48 9.98e-6      398.   -0.982</span></span>
<span><span class="co">## # … with 3 more variables: conf.high &lt;dbl&gt;, method &lt;chr&gt;,</span></span>
<span><span class="co">## #   alternative &lt;chr&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section></section><section id="simulation-based-tests" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="simulation-based-tests">Simulation-based tests</h2>
<p>Instead of dealing with all the assumptions of the data and finding the exact statistical test written by some dude in the 1940s, we can use the power of bootstrapping, permutation, and simulation to construct a null distribution and calculate confidence intervals. According to Allen Downey, <a href="http://allendowney.blogspot.com/2016/06/there-is-still-only-one-test.html">there is actually only one statistical test</a> and that at their core, all statistical tests follow the same universal pattern:</p>
<ul>
<li>
<strong>Step 1: Calculate a sample statistic, or <span class="math inline">\(\delta\)</span>.</strong> This is the main measure you care about: the difference in means, the average, the median, the proportion, the difference in proportions, the chi-squared value, etc.</li>
<li>
<strong>Step 2: Use simulation to invent a world where <span class="math inline">\(\delta\)</span> is null.</strong> Simulate what the world would look like if there was no difference between two groups, or if there was no difference in proportions, or where the average value is a specific number.</li>
<li>
<strong>Step 3: Look at <span class="math inline">\(\delta\)</span> in the null world.</strong> Put the sample statistic in the null world and see if it fits well.</li>
<li>
<strong>Step 4: Calculate the probability that <span class="math inline">\(\delta\)</span> could exist in null world.</strong> This is the p-value, or the probability that you’d see a <span class="math inline">\(\delta\)</span> at least that high in a world where there’s no difference.</li>
<li>
<strong>Step 5: Decide if <span class="math inline">\(\delta\)</span> is statistically significant.</strong> Choose some evidentiary standard or threshold (like 0.05) for deciding if there’s sufficient proof for rejecting the null world.</li>
</ul>
<p>I have <a href="https://www.andrewheiss.com/blog/2018/12/05/test-any-hypothesis/">a fully commented example of how to do this with the <strong>infer</strong> package here</a>. Once you get the hang of it, the <a href="https://github.com/tidymodels/infer"><strong>infer</strong> workflow</a> is fairly intuitive and flexible and far more delightful than worrying about classical tests.</p>
<p>First we calculate the difference in means in the actual data:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calculate the difference in means</span></span>
<span><span class="va">diff_means</span> <span class="op">&lt;-</span> <span class="va">movies_clean</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">specify</span><span class="op">(</span><span class="va">rating</span> <span class="op">~</span> <span class="va">genre</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># Order here means we subtract comedy from action (Action - Comedy)</span></span>
<span>  <span class="fu">calculate</span><span class="op">(</span><span class="st">"diff in means"</span>, order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Action"</span>, <span class="st">"Comedy"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">diff_means</span></span>
<span></span>
<span><span class="co">## # A tibble: 1 x 1</span></span>
<span><span class="co">##     stat</span></span>
<span><span class="co">##    &lt;dbl&gt;</span></span>
<span><span class="co">## 1 -0.682</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then we can generate a bootstrapped distribution of the difference in means based on our sample and calculate the confidence interval:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">boot_means</span> <span class="op">&lt;-</span> <span class="va">movies_clean</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">specify</span><span class="op">(</span><span class="va">rating</span> <span class="op">~</span> <span class="va">genre</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">generate</span><span class="op">(</span>reps <span class="op">=</span> <span class="fl">1000</span>, type <span class="op">=</span> <span class="st">"bootstrap"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">calculate</span><span class="op">(</span><span class="st">"diff in means"</span>, order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Action"</span>, <span class="st">"Comedy"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">boostrapped_confint</span> <span class="op">&lt;-</span> <span class="va">boot_means</span> <span class="op">%&gt;%</span> <span class="fu">get_confidence_interval</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">boot_means</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">visualize</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">shade_confidence_interval</span><span class="op">(</span><span class="va">boostrapped_confint</span>,</span>
<span>                            color <span class="op">=</span> <span class="st">"#8bc5ed"</span>, fill <span class="op">=</span> <span class="st">"#85d9d2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">diff_means</span><span class="op">$</span><span class="va">stat</span>, size <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"#77002c"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Bootstrapped distribution of differences in means"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Action − Comedy"</span>, y <span class="op">=</span> <span class="st">"Count"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Red line shows observed difference; shaded area shows 95% confidence interval"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_fancy</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="sim-boot-1.png" class="img-fluid figure-img"></p>
<figcaption class="margin-caption">Bootstrapped confidence interval</figcaption></figure>
</div>
<p>Neat. We have a simulation-based confidence interval, and it doesn’t contain zero, so we can have some confidence that there’s a real difference between the two groups.</p>
<p>We can go through the testing process more thoroughly by following Downey’s process. We’ve already done step one (calculate <span class="math inline">\(\delta\)</span>); next we generate a world where there’s no difference by shuffling all the action/comedy labels through permutation</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Step 2: Invent a world where δ is null</span></span>
<span><span class="va">genre_diffs_null</span> <span class="op">&lt;-</span> <span class="va">movies_clean</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">specify</span><span class="op">(</span><span class="va">rating</span> <span class="op">~</span> <span class="va">genre</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">hypothesize</span><span class="op">(</span>null <span class="op">=</span> <span class="st">"independence"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">generate</span><span class="op">(</span>reps <span class="op">=</span> <span class="fl">5000</span>, type <span class="op">=</span> <span class="st">"permute"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">calculate</span><span class="op">(</span><span class="st">"diff in means"</span>, order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Action"</span>, <span class="st">"Comedy"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 3: Put actual observed δ in the null world and see if it fits</span></span>
<span><span class="va">genre_diffs_null</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">visualize</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">diff_means</span><span class="op">$</span><span class="va">stat</span>, size <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"#77002c"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">comma</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Simulated difference in average ratings (Action − Comedy)"</span>, y <span class="op">=</span> <span class="st">"Count"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Simulation-based null distribution of differences in means"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Red line shows observed difference"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_fancy</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="sim-generate-null-world-1.png" class="img-fluid figure-img"></p>
<figcaption class="margin-caption">Simulated p-value</figcaption></figure>
</div>
<p>That red line is pretty far to the left and seems like it wouldn’t fit very well in a world where there’s no actual difference between the groups. We can calculate the probability of seeing that red line in a null world (step 4) with <code>get_p_value()</code> (and we can use the cool new <code>pvalue()</code> function in the <strong>scales</strong> library to format it as &lt; 0.001):</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Step 4: Calculate probability that observed δ could exist in null world</span></span>
<span><span class="va">genre_diffs_null</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">get_p_value</span><span class="op">(</span>obs_stat <span class="op">=</span> <span class="va">diff_means</span>, direction <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>p_value_clean <span class="op">=</span> <span class="fu">pvalue</span><span class="op">(</span><span class="va">p_value</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## # A tibble: 1 x 2</span></span>
<span><span class="co">##   p_value p_value_clean</span></span>
<span><span class="co">##     &lt;dbl&gt; &lt;chr&gt;        </span></span>
<span><span class="co">## 1       0 &lt;0.001</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Because the p-value is so small, it passes pretty much all evidentiary thresholds (p &lt; 0.05, p &lt; 0.01, etc), so we can safely say that there’s a difference between the two groups. Action movies are rated lower, on average, than comedies.</p>
</section><section id="bayesian-regression" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="bayesian-regression">Bayesian regression</h2>
<p>Next we can leave the world of frequentist statistics and null hypothesis testing and do some Bayesian analysis. Frequentist null hypothesis significance testing (NHST) determines the <em>probability of the data given a null hypothesis</em> (i.e.&nbsp;<span class="math inline">\(P(\text{data} | H)\)</span>, yielding results that are often unwieldy, phrased as the probability of rejecting the null if it is true (hence all that talk of “null worlds” earlier). In contrast, Bayesian analysis determines the <em>probability of a hypothesis given the data</em> (i.e.<span class="math inline">\(P(H | \text{data})\)</span>), resulting in probabilities that are directly interpretable.</p>
<p>Bayesian analysis is way more computationally intensive and requires more upfront work (e.g prior specification). Because of this, R itself doesn’t have robust support for the actual Monte Carlo sampling and other computational heavy lifting involved in Bayesian stuff. Instead, it can connect to external sampling programs that are optimized for this kind of repetitive simulation work. <a href="https://en.wikipedia.org/wiki/Bayesian_inference_using_Gibbs_sampling">BUGS</a> and <a href="http://mcmc-jags.sourceforge.net/">JAGS</a> were popular sampling software tools, but nowadays all the cool kids are using <a href="https://mc-stan.org/">Stan</a>.</p>
<p>Writing Stan code by hand is tricky since it requires that you essentially learn another programming language. Fortunately, you technically can do Bayesian analysis without writing a single line of Stan code. There are two different packages that precompile Stan code for you:</p>
<ul>
<li>
<a href="https://mc-stan.org/users/interfaces/rstanarm"><strong>rstanarm</strong></a>: This is written by the Stan team itself and provides functions like <code>stan_lm()</code> and <code>stan_glm()</code> that are drop-in replacements for R’s standard <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> and <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code>. The code is highly optimized and precompiled and runs really fast, but there’s no good way to inspect the underlying Stan code. Also, it’s more limited in the types of regression it supports.</li>
<li>
<a href="https://github.com/paul-buerkner/brms"><strong>brms</strong></a>: This provides a more universal front end for Stan and supports a wider variety of models. It doesn’t have drop-in <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> replacements, but the <code>brm()</code> function is fairly intuitive after poring through the documentation and examples. It’s slower than <strong>rstanarm</strong> because it has to compile the Stan scripts it generates with C++, but you can inspect the Stan code behind each of the models with <code>stancode()</code> and better see what’s going on behind the scenes.</li>
</ul>
<p>There aren’t really any cool front end packages for running non-regression analyses with Stan from R (there is <a href="http://www.sumsar.net/blog/2014/02/bayesian-first-aid-one-sample-t-test/">Rasmus Bååth’s Bayesian First Aid package</a>, but it uses JAGS and hasn’t been updated in a while and I want to use Stan like the cool kids), but you can actually calculate differences in means with regression, which means we can approximate frequentist t-tests without writing any Stan code.</p>
<p><a href="https://vuorre.netlify.com/post/2017/01/02/how-to-compare-two-groups-with-robust-bayesian-estimation-using-r-stan-and-brms/">This blog post by Matti Vuorre</a> is a masterpiece and clearly explains the rationale behind how and why you can use regression for t-tests. This code here is adapted from his stuff.</p>
<p>First, we’ll set a bunch of Monte Carlo parameters:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">CHAINS</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">ITER</span> <span class="op">&lt;-</span> <span class="fl">2000</span></span>
<span><span class="va">WARMUP</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">BAYES_SEED</span> <span class="op">&lt;-</span> <span class="fl">1234</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Use all cores</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="regression-assuming-equal-variances" class="level3"><h3 class="anchored" data-anchor-id="regression-assuming-equal-variances">Regression, assuming equal variances</h3>
<p>Then we can run the model. We set a couple priors for the intercept (normal, with a mean of 0 and standard deviation of 5) and the beta/slope (normal, with a mean of 0 and a standard deviation of 1). In this model, <code>rating ~ genre</code>, we assume equal variances between the groups.</p>
<p>We use <code>tidyMCMC</code> from <strong>broom</strong> to calculate the medians of the posterior distributions and create confidence intervals.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">brms_eq</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span></span>
<span>  <span class="co"># bf() is an alias for brmsformula() and lets you specify model formulas</span></span>
<span>  <span class="fu">bf</span><span class="op">(</span><span class="va">rating</span> <span class="op">~</span> <span class="va">genre</span><span class="op">)</span>, </span>
<span>  <span class="co"># Reverse the levels of genre so that comedy is the base case</span></span>
<span>  data <span class="op">=</span> <span class="fu">mutate</span><span class="op">(</span><span class="va">movies_clean</span>, genre <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="va">genre</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">set_prior</span><span class="op">(</span><span class="st">"normal(0, 5)"</span>, class <span class="op">=</span> <span class="st">"Intercept"</span><span class="op">)</span>,</span>
<span>            <span class="fu">set_prior</span><span class="op">(</span><span class="st">"normal(0, 1)"</span>, class <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="va">CHAINS</span>, iter <span class="op">=</span> <span class="va">ITER</span>, warmup <span class="op">=</span> <span class="va">WARMUP</span>, seed <span class="op">=</span> <span class="va">BAYES_SEED</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"cache/brms_eq"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">brms_eq_tidy</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">tidyMCMC</span><span class="op">(</span><span class="va">brms_eq</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, </span>
<span>           estimate.method <span class="op">=</span> <span class="st">"median"</span>, conf.method <span class="op">=</span> <span class="st">"HPDinterval"</span><span class="op">)</span></span>
<span><span class="va">brms_eq_tidy</span></span>
<span></span>
<span><span class="co">## # A tibble: 3 x 5</span></span>
<span><span class="co">##   term          estimate std.error conf.low conf.high</span></span>
<span><span class="co">##   &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">## 1 b_Intercept      5.96     0.108     5.74      6.16 </span></span>
<span><span class="co">## 2 b_genreAction   -0.666    0.152    -0.968    -0.374</span></span>
<span><span class="co">## 3 sigma            1.53     0.0529    1.43      1.64</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here the intercept represents the mean comedy score, while the coefficient for action represents the difference from that mean, or the effect that we care about. These findings match what we got with the frequentist work from earlier, only now we can change the interpretation: We’re 95% confident that the true population-level difference in rating is between -0.968 and -0.374, with a median of -0.666.</p>
</section><section id="a-quick-digression-into-priors" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="a-quick-digression-into-priors">A quick digression into priors</h3>
<p>If you don’t explicitly set any priors, <strong>brms</strong> chooses sensible defaults for you. You can see what priors you can potentially set with <code>get_prior()</code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">get_prior</span><span class="op">(</span><span class="fu">bf</span><span class="op">(</span><span class="va">rating</span> <span class="op">~</span> <span class="va">genre</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">movies_clean</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##                 prior     class        coef group resp dpar nlpar bound</span></span>
<span><span class="co">## 1                             b                                        </span></span>
<span><span class="co">## 2                             b genreComedy                            </span></span>
<span><span class="co">## 3 student_t(3, 6, 10) Intercept                                        </span></span>
<span><span class="co">## 4 student_t(3, 0, 10)     sigma</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can use this table to select which prior you want to set. For instance, to specify the prior distribution for the intercept, you can use <code>set_prior("normal(0, 5)", class = "Intercept")</code>, which matches the table. More complicated formulas will have values in the <code>dpar</code> and <code>nlpar</code> columns, and you can use those to drill down to specific priors for those terms (e.g.&nbsp;<code>set_prior("cauchy(0, 1)", class = "b", dpar = "sigma")</code>).</p>
<p>Also, you can plot the different distributions to get a sense of their shapes with either base R or with ggplot:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Normal distribution: normal(0, 5)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span>expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">x</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, from <span class="op">=</span> <span class="op">-</span><span class="fl">20</span>, to <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell page-columns page-full">
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="dist-base-norm-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="margin-caption">Normal distribution</figcaption></figure>
</div>
</div>
</div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Cauchy distribution: cauchy(0, 1)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span>expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Cauchy.html">dcauchy</a></span><span class="op">(</span><span class="va">x</span>, location <span class="op">=</span> <span class="fl">0</span>, scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, from <span class="op">=</span> <span class="op">-</span><span class="fl">5</span>, to <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell page-columns page-full">
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="dist-base-cauchy-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="margin-caption">Cauchy distribution</figcaption></figure>
</div>
</div>
</div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Or do this with ggplot</span></span>
<span><span class="va">norm_ggplot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dnorm</span>, n <span class="op">=</span> <span class="fl">500</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"normal(0, 5)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_fancy</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cauchy_ggplot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dcauchy</span>, n <span class="op">=</span> <span class="fl">500</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>location <span class="op">=</span> <span class="fl">0</span>, scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"cauchy(0, 1)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_fancy</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">norm_ggplot</span> <span class="op">/</span> <span class="va">cauchy_ggplot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell page-columns page-full">
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="dists-ggplot-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="margin-caption">Normal and Cauchy distributions with ggplot</figcaption></figure>
</div>
</div>
</div>
</section><section id="regression-assuming-unequal-variances" class="level3"><h3 class="anchored" data-anchor-id="regression-assuming-unequal-variances">Regression, assuming unequal variances</h3>
<p>We can also use regression to estimate the difference in means under the assumption that group variances are different. Here, following <a href="https://vuorre.netlify.com/post/2017/01/02/how-to-compare-two-groups-with-robust-bayesian-estimation-using-r-stan-and-brms/#equal-variances-model">Matti Vuorre</a>, we need to model the variance (or sigma) in each group, and we need to specify a prior for that term (I chose <code>cauchy(0, 1</code>). We do this by specifying two formulas in <code>brm()</code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">brms_uneq</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span></span>
<span>  <span class="fu">bf</span><span class="op">(</span><span class="va">rating</span> <span class="op">~</span> <span class="va">genre</span>, <span class="va">sigma</span> <span class="op">~</span> <span class="va">genre</span><span class="op">)</span>, </span>
<span>  data <span class="op">=</span> <span class="fu">mutate</span><span class="op">(</span><span class="va">movies_clean</span>, genre <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="va">genre</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">set_prior</span><span class="op">(</span><span class="st">"normal(0, 5)"</span>, class <span class="op">=</span> <span class="st">"Intercept"</span><span class="op">)</span>,</span>
<span>            <span class="fu">set_prior</span><span class="op">(</span><span class="st">"normal(0, 1)"</span>, class <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span>,</span>
<span>            <span class="fu">set_prior</span><span class="op">(</span><span class="st">"cauchy(0, 1)"</span>, class <span class="op">=</span> <span class="st">"b"</span>, dpar <span class="op">=</span> <span class="st">"sigma"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="va">CHAINS</span>, iter <span class="op">=</span> <span class="va">ITER</span>, warmup <span class="op">=</span> <span class="va">WARMUP</span>, seed <span class="op">=</span> <span class="va">BAYES_SEED</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"cache/brms_uneq"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">brms_uneq_tidy</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">tidyMCMC</span><span class="op">(</span><span class="va">brms_uneq</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, </span>
<span>           estimate.method <span class="op">=</span> <span class="st">"median"</span>, conf.method <span class="op">=</span> <span class="st">"HPDinterval"</span><span class="op">)</span></span>
<span><span class="va">brms_uneq_tidy</span></span>
<span></span>
<span><span class="co">## # A tibble: 4 x 5</span></span>
<span><span class="co">##   term                estimate std.error conf.low conf.high</span></span>
<span><span class="co">##   &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">## 1 b_Intercept           5.96      0.111     5.73      6.17 </span></span>
<span><span class="co">## 2 b_sigma_Intercept     0.433     0.0494    0.335     0.528</span></span>
<span><span class="co">## 3 b_genreAction        -0.665     0.156    -0.979    -0.371</span></span>
<span><span class="co">## 4 b_sigma_genreAction  -0.0199    0.0702   -0.161     0.113</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For mathy reasons (again, <a href="https://vuorre.netlify.com/post/2017/01/02/how-to-compare-two-groups-with-robust-bayesian-estimation-using-r-stan-and-brms/#unequal-variances-model">see Matti Vourre’s post</a>), the sigma terms are on a log scale, so we need to exponentiate them back to the scale of the data.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">brms_uneq_tidy</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate_at</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">estimate</span>, <span class="va">std.error</span>, <span class="va">conf.low</span>, <span class="va">conf.high</span><span class="op">)</span>,</span>
<span>            <span class="fu">funs</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">term</span>, <span class="st">"sigma"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## # A tibble: 4 x 5</span></span>
<span><span class="co">##   term                estimate std.error conf.low conf.high</span></span>
<span><span class="co">##   &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">## 1 b_Intercept            5.96      0.111    5.73      6.17 </span></span>
<span><span class="co">## 2 b_sigma_Intercept      1.54      1.05     1.40      1.70 </span></span>
<span><span class="co">## 3 b_genreAction         -0.665     0.156   -0.979    -0.371</span></span>
<span><span class="co">## 4 b_sigma_genreAction    0.980     1.07     0.851     1.12</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here, the interpretation for the intercept and action coefficients are the same as before: the intercept the average comedy rating; the action coefficient is the change from the average comedy rating, or the effect we care about. The sigmas work similarly: the intercept sigma is the standard deviation for comedies; the intercept sigma + action sigma is the standard deviation for action movies.</p>
</section><section id="regression-best" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="regression-best">Regression, BEST</h3>
<p>A more robust way of estimating group differences Bayesianly is to use John Kruschke’s <a href="https://psycnet.apa.org/doi/10.1037/a0029146">Bayesian Estimation Supersedes the t Test (BEST)</a> method. I’m 100% not going into the nitty gritty details of this (<a href="https://vuorre.netlify.com/post/2017/01/02/how-to-compare-two-groups-with-robust-bayesian-estimation-using-r-stan-and-brms/#robust-bayesian-estimation">Matti Vuorre has, though</a>). In the most simplest terms, the only difference between BEST and the unequal variance regression above is that we model the data with a t distribution, which means we have a new parameter, <span class="math inline">\(\nu\)</span> (nu), that changes the normality of the distribution (i.e.&nbsp;the degrees of freedom parameter in a t distribution). Kruschke uses an exponential prior with a rate of 1/29 in his paper, so we do too. It looks like this:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dexp</span>, n <span class="op">=</span> <span class="fl">500</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">29</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"exponential(1/29)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_fancy</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell page-columns page-full">
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="dist-exp-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="margin-caption">Exponential distribution</figcaption></figure>
</div>
</div>
</div>
<p>Add <code>family = student</code> and set the prior for <code>nu</code> and we’re ready to go:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">brms_uneq_robust</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span></span>
<span>  <span class="fu">bf</span><span class="op">(</span><span class="va">rating</span> <span class="op">~</span> <span class="va">genre</span>, <span class="va">sigma</span> <span class="op">~</span> <span class="va">genre</span><span class="op">)</span>, </span>
<span>  family <span class="op">=</span> <span class="va">student</span>,</span>
<span>  data <span class="op">=</span> <span class="fu">mutate</span><span class="op">(</span><span class="va">movies_clean</span>, genre <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="va">genre</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">set_prior</span><span class="op">(</span><span class="st">"normal(0, 5)"</span>, class <span class="op">=</span> <span class="st">"Intercept"</span><span class="op">)</span>,</span>
<span>            <span class="fu">set_prior</span><span class="op">(</span><span class="st">"normal(0, 1)"</span>, class <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span>,</span>
<span>            <span class="fu">set_prior</span><span class="op">(</span><span class="st">"cauchy(0, 1)"</span>, class <span class="op">=</span> <span class="st">"b"</span>, dpar <span class="op">=</span> <span class="st">"sigma"</span><span class="op">)</span>,</span>
<span>            <span class="fu">set_prior</span><span class="op">(</span><span class="st">"exponential(1.0/29)"</span>, class <span class="op">=</span> <span class="st">"nu"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="va">CHAINS</span>, iter <span class="op">=</span> <span class="va">ITER</span>, warmup <span class="op">=</span> <span class="va">WARMUP</span>, seed <span class="op">=</span> <span class="va">BAYES_SEED</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"cache/brms_uneq_robust"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">brms_uneq_robust_tidy</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">tidyMCMC</span><span class="op">(</span><span class="va">brms_uneq_robust</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, </span>
<span>           estimate.method <span class="op">=</span> <span class="st">"median"</span>, conf.method <span class="op">=</span> <span class="st">"HPDinterval"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># Rescale sigmas</span></span>
<span>  <span class="fu">mutate_at</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">estimate</span>, <span class="va">std.error</span>, <span class="va">conf.low</span>, <span class="va">conf.high</span><span class="op">)</span>,</span>
<span>            <span class="fu">funs</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">term</span>, <span class="st">"sigma"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">brms_uneq_robust_tidy</span></span>
<span></span>
<span><span class="co">## # A tibble: 5 x 5</span></span>
<span><span class="co">##   term                estimate std.error conf.low conf.high</span></span>
<span><span class="co">##   &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">## 1 b_Intercept            5.98      0.104    5.77      6.17 </span></span>
<span><span class="co">## 2 b_sigma_Intercept      1.47      1.06     1.31      1.66 </span></span>
<span><span class="co">## 3 b_genreAction         -0.680     0.148   -0.966    -0.394</span></span>
<span><span class="co">## 4 b_sigma_genreAction    0.999     1.08     0.860     1.16 </span></span>
<span><span class="co">## 5 nu                    31.9      27.5      5.62     95.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Neato. Just like the other models, the coefficient for action shows us the difference in means (and it’s super similar to everything else). We can exponentiate the sigma coefficients and see the group standard deviations, and we have a coefficient for <span class="math inline">\(\nu\)</span>, or the degrees of freedom for the underlying distribution.</p>
</section></section><section id="bayesian-analysis-directly-with-stan" class="level2"><h2 class="anchored" data-anchor-id="bayesian-analysis-directly-with-stan">Bayesian analysis, directly with Stan</h2>
<p><strong>Update</strong>: <a href="https://mikedecr.github.io/">Mike DeCrescenzo</a> made a <a href="https://twitter.com/mikedecr/status/1090416939917340672">fascinating point on Twitter</a> that relying on regression for t-test-like analysis with Bayesianism actually has important theoretical implications. When specifying a model as <code>y ~ a + bx</code> as we did above with <code>rating ~ genre</code>, the coefficient for genre (<code>b</code>) is actually the difference in means and doesn’t directly reflect the rating itself. In theory, if we’re thinking about two groups with two different variances, we should model the distribution of each group, not the distribution of the differences in groups. Analyzing the distributions of the two groups separately and <em>then</em> calculating the difference should yield more transparent results. And that’s why we can/should do the analysis in Stan by hand like this.</p>
<p><strong>Another update</strong>: <a href="https://twitter.com/tjmahr/status/1090417050600816641?s=21">According to TJ Mahr</a>, you can get around this beta-for-the-difference issue by running a model like <code>rating ~ 0 + genre</code>, which suppresses the intercept and estimates coefficients for both groups directly. You have to calculate the difference in coefficients/group means by hand after, but at least you’ll be estimating the right things.</p>
<p>Instead of using regression models and combining coefficients to figure out group means and differences, we can be brave and write actual Stan code that can return any value we want. We don’t have to be constrained by regression formulas, but we do have to figure out how to code in Stan, which is intimidating.</p>
<p>There are lots of resources out there for Stan (and Bayesianism in general), including <a href="https://xcelab.net/rm/statistical-rethinking/">Richard McElreath’s <em>Statistical Rethinking</em></a>, which has all its code in raw Stan <em>and</em> brms syntax. John Kruschke’s <em>Doing Bayesian Data Analysis</em> book includes code in both JAGS and Stan (click on <a href="https://sites.google.com/site/doingbayesiandataanalysis/software-installation">the link in step 5 here</a>; the code for BEST analysis is in the file named <code>Stan-Ymet-Xnom2grp-MrobustHet.R</code>).</p>
<p>But the resource that made the structure of Stan files (mostly) click for me was a recorded class (specifically <a href="https://www.youtube.com/watch?v=-mfeHHLcb1g">the session from 2017-01-30</a>) by <a href="https://github.com/mike-lawrence">Mike Lawrence</a> (a Canadian researcher) that <a href="https://discourse.mc-stan.org/t/what-would-be-a-good-resource-to-understand-the-method-of-two-sample-bayesian-hypothesis-testing/1492/6">I stumbled on</a> while searching the internet for ways to run BEST with Stan. Though the video is super long (you can skip around and/or watch at 2x speed; the two-sample example starts at minute 52), Mike clearly lays out the process for writing a Stan file and it’s the coolest thing ever. EVEN BETTER is the fact that he provides <a href="https://www.dropbox.com/sh/js0us2461w98bn7/AADcxczFADrCfnSA2qo8Gb2wa?dl=0">all the code from his class on Dropbox</a> (see the <a href="https://www.dropbox.com/sh/js0us2461w98bn7/AACjhob9JjkfncwkEjyI2-Pxa/2017-01-30?dl=0&amp;subfolder_nav_tracking=1">code from 2017-01-30</a> for t-test related stuff)</p>
<p>Through a combination of Mike Lawrence’s video, <a href="https://github.com/m-clark/Miscellaneous-R-Code/blob/master/ModelFitting/Bayesian/rstant_testBEST.R">Michael Clark’s BEST implementation here</a>, John Kruschke’s Stan code, and lots of debugging, <a href="imdb_best.stan">I created this Stan code</a>. Explaining the whole logic behind it goes way beyond the scope of this blog post, but I heavily commented it so it should be easy-ish to follow if you understand Stan files (which I still don’t completely ¯\_(ツ)_/¯).</p>
<p><a href="https://github.com/andrewheiss/diff-means-half-dozen-ways/blob/master/imdb_best.stan">Download <code>fancy-best.stan</code></a> and put it in the same folder as whatever script you’re typing in (or change the path to match wherever you put it). Note how the <code>data</code> argument in <code>sampling()</code> doesn’t just take a data frame like in <code>brm()</code>. We have to pass Stan specific pieces of data, all of which are specified in the <code>data{}</code> block in the Stan script.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">stan_best</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">sampling</span><span class="op">(</span><span class="fu">stan_model</span><span class="op">(</span><span class="st">"imdb_best.stan"</span><span class="op">)</span>, </span>
<span>           <span class="co"># Make a list of data to send to Stan</span></span>
<span>           data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">movies_clean</span><span class="op">)</span>, </span>
<span>                       n_groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">movies_clean</span><span class="op">$</span><span class="va">genre</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                       group_id <span class="op">=</span> <span class="va">movies_clean</span><span class="op">$</span><span class="va">genre_numeric</span>, </span>
<span>                       y <span class="op">=</span> <span class="va">movies_clean</span><span class="op">$</span><span class="va">rating</span><span class="op">)</span>,</span>
<span>           chains <span class="op">=</span> <span class="va">CHAINS</span>, iter <span class="op">=</span> <span class="va">ITER</span>, warmup <span class="op">=</span> <span class="va">WARMUP</span>, seed <span class="op">=</span> <span class="va">BAYES_SEED</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">stan_best_tidy</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">tidyMCMC</span><span class="op">(</span><span class="va">stan_best</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, </span>
<span>           estimate.method <span class="op">=</span> <span class="st">"median"</span>, conf.method <span class="op">=</span> <span class="st">"HPDinterval"</span><span class="op">)</span></span>
<span><span class="va">stan_best_tidy</span></span>
<span></span>
<span><span class="co">## # A tibble: 8 x 5</span></span>
<span><span class="co">##   term     estimate std.error conf.low conf.high</span></span>
<span><span class="co">##   &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">## 1 mu[1]       5.29     0.108     5.09      5.50 </span></span>
<span><span class="co">## 2 mu[2]       5.99     0.104     5.79      6.19 </span></span>
<span><span class="co">## 3 sigma[1]    1.47     0.0838    1.30      1.63 </span></span>
<span><span class="co">## 4 sigma[2]    1.47     0.0885    1.30      1.65 </span></span>
<span><span class="co">## 5 nu         29.0     20.1       6.35     76.2  </span></span>
<span><span class="co">## 6 mu_diff    -0.693    0.147    -0.992    -0.422</span></span>
<span><span class="co">## 7 cohen_d    -0.573    0.123    -0.825    -0.349</span></span>
<span><span class="co">## 8 cles        0.343    0.0318    0.280     0.402</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>One advantage of running the analysis with raw Stan instead of forcing it into regression form is that we can have Stan calculate all sorts of stuff for us. The averages for both groups get returned (<code>mu[1]</code> and <code>mu[2]</code>), along with <code>mu_diff</code>, so there’s no need to combine slope and intercept terms. Also note how the <code>sigma</code> coefficients are already in the right scale. I also (following Kruschke and others) made it so that the Stan code returned information about effect sizes, including <a href="https://en.wikipedia.org/wiki/Effect_size#Cohen's_d">Cohen’s d</a>, which is the standardized difference in means, and the <a href="https://janhove.github.io/reporting/2016/11/16/common-language-effect-sizes">common language effect size (CLES)</a>, which is the probability that a rating sampled at random from one group will be greater than a rating sampled from the other group.</p>
<p>Here, the difference in means is the same as all the other methods, but the effect size isn’t terribly huge. According to Cohen’s d, we have a medium effect size, and there’s a 34% chance that we could randomly select an action rating from the comedy distribution.</p>
</section><section id="regression-best-with-priors-on-variables-instead-of-difference" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="regression-best-with-priors-on-variables-instead-of-difference">Regression, BEST, with priors on variables instead of difference</h2>
<p><em>(I added this section later)</em></p>
<p>In the Twitter discussion that followed this post, <a href="https://mikedecr.github.io/">Mike DeCrescenzo</a> made a <a href="https://twitter.com/mikedecr/status/1090416939917340672">fascinating point</a> that relying on regression for t-test-like analysis with Bayesianism actually has important theoretical implications.</p>
<p>When specifying a model as <code>y ~ a + bx</code> as we did above with <code>rating ~ genre</code>, the coefficient for genre (<code>b</code>) is actually the difference in means and doesn’t directly reflect the rating itself. In theory, if we’re thinking about two groups with two different variances, we should model the distribution of each group, not the distribution of the differences in groups. Analyzing the distributions of the two groups separately and <em>then</em> calculating the difference should yield more transparent results. Plus it’s easier to think about setting priors on two variables that were measured in real life (e.g.&nbsp;ratings for comedies and action movies), rather than setting priors on whatever the difference between those looks like.</p>
<p>The raw Stan code above does this correctly by feeding two groups into the model rather than the difference in means. <a href="https://twitter.com/tjmahr/status/1090417050600816641?s=21">TJ Mahr</a> and <a href="https://github.com/ASKurz/Doing-Bayesian-Data-Analysis-in-brms-and-the-tidyverse">Solomon Kurz’s translation of Kruschke’s code into <strong>brms</strong></a> (<a href="https://github.com/ASKurz/Doing-Bayesian-Data-Analysis-in-brms-and-the-tidyverse/blob/master/16.Rmd">see near the bottom of chapter 16</a>) both show that we can do this with <strong>brms</strong> by changing the formula slightly. If we suppress the intercept by running a model like <code>ratiing ~ 0 + genre</code>, <strong>brms</strong> returns coefficients for each of the groups (no more base case!), and these coefficients represent group means.</p>
<p>Here’s an intercept-free version of the <strong>brms</strong>-based BEST regression from earlier. Note how we’re modeling both the rating and the group sigmas without intercepts (<code>rating ~ 0 + genre, sigma ~ 0 + genre</code>), and that we no longer specify a prior for the intercept (if we do, <code>brm()</code> yells at us). Also note that instead of modeling the beta coefficient as a normal distribution centered around zero (since that represented the difference in means), we specify the distribution of action and comedy ratings themselves. Because we’re dealing with actual ratings, we can make them fairly well informed and constrained. For instance, no movie is rated below 1 or above 10, and I’m guessing from past experience looking at ratings on Amazon and IMDB and elsewhere that people tend to inflate their ratings. I’d guess that the distribution of ratings looks something like this: normally distributed with a mean of 6, standard deviation of 2, and truncated at 1 and 10.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Cool extra thing I discovered: the msm library has rtnorm, dtnorm, and family</span></span>
<span><span class="co"># which let you plot and draw from a truncated normal distribution</span></span>
<span><span class="co"># msm::rtnorm(1000, mean = 6, sd = 2, lower = 1, upper = 10)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dnorm</span>, n <span class="op">=</span> <span class="fl">500</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">6</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"normal(6, 2); truncated at 1 and 10"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_fancy</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell page-columns page-full">
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="dist-ratings-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="margin-caption">Normal distribution, truncated</figcaption></figure>
</div>
</div>
</div>
<p>Now we can run the model like normal:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">brms_uneq_robust_groups</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span></span>
<span>  <span class="fu">bf</span><span class="op">(</span><span class="va">rating</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">genre</span>, <span class="va">sigma</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">genre</span><span class="op">)</span>, </span>
<span>  family <span class="op">=</span> <span class="va">student</span>,</span>
<span>  data <span class="op">=</span> <span class="fu">mutate</span><span class="op">(</span><span class="va">movies_clean</span>, genre <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="va">genre</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="co"># Set group mean prior</span></span>
<span>    <span class="fu">set_prior</span><span class="op">(</span><span class="st">"normal(6, 2)"</span>, class <span class="op">=</span> <span class="st">"b"</span>, lb <span class="op">=</span> <span class="fl">1</span>, ub <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>    <span class="co"># Ser group variance priors. We keep the less informative cauchy(0, 1).</span></span>
<span>    <span class="fu">set_prior</span><span class="op">(</span><span class="st">"cauchy(0, 1)"</span>, class <span class="op">=</span> <span class="st">"b"</span>, dpar <span class="op">=</span> <span class="st">"sigma"</span><span class="op">)</span>,</span>
<span>    <span class="fu">set_prior</span><span class="op">(</span><span class="st">"exponential(1.0/29)"</span>, class <span class="op">=</span> <span class="st">"nu"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="va">CHAINS</span>, iter <span class="op">=</span> <span class="va">ITER</span>, warmup <span class="op">=</span> <span class="va">WARMUP</span>, seed <span class="op">=</span> <span class="va">BAYES_SEED</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"cache/brms_uneq_robust_groups"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We still need to exponentiate the sigma coefficients when we’re done.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">brms_uneq_robust_groups_tidy</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">tidyMCMC</span><span class="op">(</span><span class="va">brms_uneq_robust_groups</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, </span>
<span>           estimate.method <span class="op">=</span> <span class="st">"median"</span>, conf.method <span class="op">=</span> <span class="st">"HPDinterval"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># Rescale sigmas</span></span>
<span>  <span class="fu">mutate_at</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">estimate</span>, <span class="va">std.error</span>, <span class="va">conf.low</span>, <span class="va">conf.high</span><span class="op">)</span>,</span>
<span>            <span class="fu">funs</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">term</span>, <span class="st">"sigma"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">brms_uneq_robust_groups_tidy</span></span>
<span></span>
<span><span class="co">## # A tibble: 5 x 5</span></span>
<span><span class="co">##   term                estimate std.error conf.low conf.high</span></span>
<span><span class="co">##   &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">## 1 b_genreComedy           5.99     0.109     5.77      6.19</span></span>
<span><span class="co">## 2 b_genreAction           5.30     0.107     5.09      5.50</span></span>
<span><span class="co">## 3 b_sigma_genreComedy     1.47     1.06      1.30      1.65</span></span>
<span><span class="co">## 4 b_sigma_genreAction     1.47     1.06      1.31      1.62</span></span>
<span><span class="co">## 5 nu                     29.9     28.1       6.00     92.7</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Because we calculated the group means themselves, we need to do an extra few steps to get the difference in means. It’s fairly easy: we extract the posterior samples for each of the groups, subtract them from each other, and then calculate the credible interval.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">brms_uneq_robust_groups_post</span> <span class="op">&lt;-</span> <span class="fu">posterior_samples</span><span class="op">(</span><span class="va">brms_uneq_robust_groups</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># We can exponentiate here!</span></span>
<span>  <span class="fu">mutate_at</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="fu">contains</span><span class="op">(</span><span class="st">"sigma"</span><span class="op">)</span><span class="op">)</span>, <span class="fu">funs</span><span class="op">(</span><span class="va">exp</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># For whatever reason, we need to log nu?</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>nu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">nu</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>diff_means <span class="op">=</span> <span class="va">b_genreAction</span> <span class="op">-</span> <span class="va">b_genreComedy</span>,</span>
<span>         diff_sigma <span class="op">=</span> <span class="va">b_sigma_genreAction</span> <span class="op">-</span> <span class="va">b_sigma_genreComedy</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># Calculate effect sizes, just for fun</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>cohen_d <span class="op">=</span> <span class="va">diff_means</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="va">b_sigma_genreAction</span> <span class="op">+</span> <span class="va">b_sigma_genreComedy</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>         cles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">diff_means</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="va">b_sigma_genreAction</span> <span class="op">+</span> <span class="va">b_sigma_genreComedy</span><span class="op">)</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">brms_uneq_robust_groups_tidy_fixed</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">tidyMCMC</span><span class="op">(</span><span class="va">brms_uneq_robust_groups_post</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span>, </span>
<span>           estimate.method <span class="op">=</span> <span class="st">"median"</span>, conf.method <span class="op">=</span> <span class="st">"HPDinterval"</span><span class="op">)</span></span>
<span><span class="va">brms_uneq_robust_groups_tidy_fixed</span></span>
<span></span>
<span><span class="co">## # A tibble: 9 x 5</span></span>
<span><span class="co">##   term                estimate std.error conf.low conf.high</span></span>
<span><span class="co">##   &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">## 1 b_genreComedy        5.99       0.109     5.77      6.19 </span></span>
<span><span class="co">## 2 b_genreAction        5.30       0.107     5.09      5.50 </span></span>
<span><span class="co">## 3 b_sigma_genreComedy  1.47       0.0882    1.30      1.64 </span></span>
<span><span class="co">## 4 b_sigma_genreAction  1.47       0.0826    1.31      1.62 </span></span>
<span><span class="co">## 5 nu                   1.48       0.287     0.963     2.04 </span></span>
<span><span class="co">## 6 diff_means          -0.690      0.151    -1.01     -0.415</span></span>
<span><span class="co">## 7 diff_sigma           0.00100    0.111    -0.212     0.217</span></span>
<span><span class="co">## 8 cohen_d             -0.571      0.126    -0.818    -0.327</span></span>
<span><span class="co">## 9 cles                 0.368      0.0132    0.341     0.391</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And voila! Difference in means based on priors on individual group means rather than differences in groups!</p>
</section><section id="comparing-all-methods" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="comparing-all-methods">Comparing all methods</h2>
<p>Holy cow, that’s a lot of code. We can compare the output from all these different methods in a single plot. In this case, since both groups are pretty normally distributed already and there were no outliers, there isn’t much variation at all in the results—all the different methods show essentially the same thing. We can legally interpret the Bayesian results using credible intervals and probabilities; with the classical t-tests, we still have to talk about null hypotheses. But in the end, the results are nearly identical (but that’s definitely not always the case).</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Make a bunch of data frames that have three columns: </span></span>
<span><span class="co"># estimate, conf.low, and conf.high</span></span>
<span></span>
<span><span class="co"># Extract t-test results</span></span>
<span><span class="va">t_test_eq_small</span> <span class="op">&lt;-</span> <span class="va">t_test_eq_tidy</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">estimate</span>, <span class="va">conf.low</span>, <span class="va">conf.high</span><span class="op">)</span></span>
<span></span>
<span><span class="va">t_test_uneq_small</span> <span class="op">&lt;-</span> <span class="va">t_test_uneq_tidy</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">estimate</span>, <span class="va">conf.low</span>, <span class="va">conf.high</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract simulation results</span></span>
<span><span class="va">infer_simulation</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>estimate <span class="op">=</span> <span class="va">diff_means</span><span class="op">$</span><span class="va">stat</span>,</span>
<span>                           conf.low <span class="op">=</span> <span class="va">boostrapped_confint</span><span class="op">$</span><span class="va">`2.5%`</span>,</span>
<span>                           conf.high <span class="op">=</span> <span class="va">boostrapped_confint</span><span class="op">$</span><span class="va">`97.5%`</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract brms regression results</span></span>
<span><span class="va">brms_eq_small</span> <span class="op">&lt;-</span> <span class="va">brms_eq_tidy</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"b_genreAction"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">estimate</span>, <span class="va">conf.low</span>, <span class="va">conf.high</span><span class="op">)</span></span>
<span></span>
<span><span class="va">brms_uneq_small</span> <span class="op">&lt;-</span> <span class="va">brms_uneq_tidy</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"b_genreAction"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">estimate</span>, <span class="va">conf.low</span>, <span class="va">conf.high</span><span class="op">)</span></span>
<span></span>
<span><span class="va">brms_uneq_robust_small</span> <span class="op">&lt;-</span> <span class="va">brms_uneq_robust_tidy</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"b_genreAction"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">estimate</span>, <span class="va">conf.low</span>, <span class="va">conf.high</span><span class="op">)</span></span>
<span></span>
<span><span class="va">brms_uneq_robust_groups_small</span> <span class="op">&lt;-</span> <span class="va">brms_uneq_robust_groups_tidy_fixed</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"diff_means"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">estimate</span>, <span class="va">conf.low</span>, <span class="va">conf.high</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract Stan results</span></span>
<span><span class="va">stan_best_small</span> <span class="op">&lt;-</span> <span class="va">stan_best_tidy</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"mu_diff"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">estimate</span>, <span class="va">conf.low</span>, <span class="va">conf.high</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Put all these mini dataframes into a list column, then unnest</span></span>
<span><span class="va">meta_diffs</span> <span class="op">&lt;-</span> <span class="fu">tribble</span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">package</span>, <span class="op">~</span><span class="va">method</span>, <span class="op">~</span><span class="va">results</span>,</span>
<span>  <span class="st">"t-test"</span>, <span class="st">"equal variances"</span>, <span class="va">t_test_eq_small</span>,</span>
<span>  <span class="st">"t-test"</span>, <span class="st">"unequal variances"</span>, <span class="va">t_test_uneq_small</span>,</span>
<span>  <span class="st">"infer"</span>, <span class="st">"simulation"</span>, <span class="va">infer_simulation</span>,</span>
<span>  <span class="st">"brms"</span>, <span class="st">"equal variances"</span>, <span class="va">brms_eq_small</span>,</span>
<span>  <span class="st">"brms"</span>, <span class="st">"unequal variances"</span>, <span class="va">brms_uneq_small</span>,</span>
<span>  <span class="st">"brms"</span>, <span class="st">"BEST"</span>, <span class="va">brms_uneq_robust_small</span>,</span>
<span>  <span class="st">"brms"</span>, <span class="st">"BEST; group means"</span>, <span class="va">brms_uneq_robust_groups_small</span>,</span>
<span>  <span class="st">"Stan"</span>, <span class="st">"BEST"</span>, <span class="va">stan_best_small</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">unnest</span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">package</span>, <span class="st">": "</span>, <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>method <span class="op">=</span> <span class="fu">fct_inorder</span><span class="op">(</span><span class="va">method</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">meta_diffs</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">estimate</span>, y <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="va">method</span><span class="op">)</span>, color <span class="op">=</span> <span class="va">package</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_pointrangeh</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">conf.low</span>, xmax <span class="op">=</span> <span class="va">conf.high</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_viridis_d</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span>, end <span class="op">=</span> <span class="fl">0.9</span>, guide <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Mean rating for action movies − mean rating for comedies"</span>,</span>
<span>       y <span class="op">=</span> <span class="cn">NULL</span>, caption <span class="op">=</span> <span class="st">"Sample of 400 movies from IMDB"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Comedies get higher ratings than action movies"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Effect is roughly the same regardless of method used"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">expand_limits</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_fancy</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fu">rel</span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="compare-everything-1.png" class="img-fluid figure-img"></p>
<figcaption class="margin-caption">Comparison of all methods</figcaption></figure>
</div>


<!-- -->

</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{heiss2019,
  author = {Heiss, Andrew},
  title = {Half a Dozen Frequentist and {Bayesian} Ways to Measure the
    Difference in Means in Two Groups},
  date = {2019-01-29},
  url = {https://www.andrewheiss.com/blog/2019/01/29/diff-means-half-dozen-ways/},
  doi = {10.59350/94eck-1gd29},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-heiss2019" class="csl-entry quarto-appendix-citeas" role="listitem">
Heiss, Andrew. 2019. <span>“Half a Dozen Frequentist and Bayesian Ways
to Measure the Difference in Means in Two Groups.”</span> January 29,
2019. <a href="https://doi.org/10.59350/94eck-1gd29">https://doi.org/10.59350/94eck-1gd29</a>.
</div></div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.andrewheiss\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><script src="https://giscus.app/client.js" data-repo="andrewheiss/ath-quarto" data-repo-id="R_kgDOIg6EJQ" data-category="Blog comments" data-category-id="DIC_kwDOIg6EJc4CSz92" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><input type="hidden" id="giscus-base-theme" value="light"><input type="hidden" id="giscus-alt-theme" value="dark"><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb35" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> Half a dozen frequentist and Bayesian ways to measure the difference in means in two groups</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2019-01-29</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> Learn how to run standard t-tests, simulations, and Bayesian difference in means tests with R and Stan</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> </span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">  - r</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">  - ggplot</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - tidyverse</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co">  - stan</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - bayes</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> compare-everything-1.png</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="an">doi:</span><span class="co"> 10.59350/94eck-1gd29</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="an">citation:</span><span class="co"> true</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>&lt;span class="small"&gt;(<span class="co">[</span><span class="ot">See this notebook on GitHub</span><span class="co">](https://github.com/andrewheiss/diff-means-half-dozen-ways)</span>)&lt;/span&gt;</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>Taking a sample from two groups from a population and seeing if there’s a significant or substantial difference between them is a standard task in statistics. Measuring performance on a test before and after some sort of intervention, measuring average GDP in two different continents, measuring average height in two groups of flowers, etc.—we like to know if any group differences we see are attributable to chance / measurement error, or if they’re real.</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>Classical frequentist statistics typically measures the difference between groups with a <span class="co">[</span><span class="ot">t-test</span><span class="co">](https://en.wikipedia.org/wiki/Student%27s_t-test)</span>, but t-tests are 100+ years old and statistical methods have advanced a lot since 1908. Nowadays, we can use simulation and/or Bayesian methods to get richer information about the differences between two groups without worrying so much about the assumptions and preconditions for classical t-tests.</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>Mostly as a resource to future me, here are a bunch of different ways to measure the difference in means in two groups. I’ve done them all in real life projects, but I’m tired of constantly searching my computer for the code to do them:)</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>These ways can all be adapted to different situations (i.e.&nbsp;difference in proportions, one-sample difference in means, etc.). The process for simulation and Bayesian approaches will be roughly the same, while for frequentist approaches, you’ll need to walk through a <span class="co">[</span><span class="ot">statistical test workflow</span><span class="co">](https://www.google.com/search?q=statistical+test+workflow&amp;tbm=isch)</span> to find the appropriate test.</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>Also, this is long and really kind of meant as a general reference. Here’s a tl;dr table of contents:</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Data</span><span class="co">](#data)</span></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Classical frequentist t-tests</span><span class="co">](#classical-frequentist-t-tests)</span></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="co">[</span><span class="ot">t-test, assuming equal variances</span><span class="co">](#t-test-assuming-equal-variances)</span></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="co">[</span><span class="ot">t-test, assuming unequal variance</span><span class="co">](#t-test-assuming-unequal-variance)</span></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Simulation-based tests</span><span class="co">](#simulation-based-tests)</span></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Bayesian regression</span><span class="co">](#bayesian-regression)</span></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="co">[</span><span class="ot">Regression, assuming equal variances</span><span class="co">](#regression-assuming-equal-variances)</span></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="co">[</span><span class="ot">A quick digression into priors</span><span class="co">](#a-quick-digression-into-priors)</span></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="co">[</span><span class="ot">Regression, assuming unequal variances</span><span class="co">](#regression-assuming-unequal-variances)</span></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="co">[</span><span class="ot">Regression, BEST</span><span class="co">](#regression-best)</span></span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Bayesian analysis, directly with Stan</span><span class="co">](#bayesian-analysis-directly-with-stan)</span></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Regression, BEST, with priors on variables instead of difference</span><span class="co">](#regression-best-with-priors-on-variables-instead-of-difference)</span></span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Comparing all methods</span><span class="co">](#comparing-all-methods)</span></span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data</span></span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>First we need some data to play with. We’ll use the <span class="co">[</span><span class="ot">**ggplot2movies** package</span><span class="co">](https://cran.r-project.org/package=ggplot2movies)</span>, which contains information about almost 60,000 movies from IMDB from 1893 to 2005. For this example, we want to see if there is a significant/substantial/real difference in the average IMDB rating for action movies and comedies. Are people more likely to rate comedies higher than action movies?</span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>Instead of working with all 20,407 action movies and comedies, we take a random sample of 200 each. (This is just so we can have some variation in the group averages—if we work with all 20,000, the confidence intervals for each group average basically disappear since there are so many observations.)</span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Load libraries</span></span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)  <span class="co"># ggplot, dplyr, and friends</span></span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggridges)   <span class="co"># Ridge plots</span></span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggstance)   <span class="co"># Horizontal pointranges and bars</span></span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)  <span class="co"># Lay out multiple ggplot plots; install from https://github.com/thomasp85/patchwork</span></span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)     <span class="co"># Nicer formatting for numbers</span></span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)      <span class="co"># Convert model results to tidy data frames</span></span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(infer)      <span class="co"># Statistical inference with simulation</span></span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)      <span class="co"># R interface to Stan</span></span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)       <span class="co"># Run Stan-based models with standard R syntax</span></span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2movies)  <span class="co"># Lots of movies from IMDB</span></span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean up data</span></span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)  <span class="co"># Set seed so we get the same sampled rows every time</span></span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a>movies_clean <span class="ot">&lt;-</span> movies <span class="sc">%&gt;%</span> </span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make a binary column for genre</span></span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(title, year, rating, Action, Comedy) <span class="sc">%&gt;%</span> </span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(Action <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Comedy <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">genre =</span> <span class="fu">case_when</span>(Action <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Action"</span>,</span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a>                           Comedy <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Comedy"</span>,</span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a>                           <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Neither"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(genre <span class="sc">!=</span> <span class="st">"Neither"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make a numeric version of genre, where action = 1, comedy = 2</span></span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">genre_numeric =</span> <span class="fu">as.numeric</span>(<span class="fu">factor</span>(genre))) <span class="sc">%&gt;%</span> </span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make genre a factor</span></span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">genre =</span> <span class="fu">factor</span>(genre)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Action, <span class="sc">-</span>Comedy) <span class="sc">%&gt;%</span> </span>
<span id="cb35-80"><a href="#cb35-80" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Randomly select 200 movies in each genre</span></span>
<span id="cb35-81"><a href="#cb35-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(genre) <span class="sc">%&gt;%</span> </span>
<span id="cb35-82"><a href="#cb35-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="dv">200</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-83"><a href="#cb35-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb35-84"><a href="#cb35-84" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-85"><a href="#cb35-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-86"><a href="#cb35-86" aria-hidden="true" tabindex="-1"></a>To get a sense of the data, we’ll do some quick exploratory data analysis with a bunch of different graph types.</span>
<span id="cb35-87"><a href="#cb35-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-88"><a href="#cb35-88" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-89"><a href="#cb35-89" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a custom theme</span></span>
<span id="cb35-90"><a href="#cb35-90" aria-hidden="true" tabindex="-1"></a><span class="co"># I'm using Asap Condensed; download from </span></span>
<span id="cb35-91"><a href="#cb35-91" aria-hidden="true" tabindex="-1"></a><span class="co"># https://fonts.google.com/specimen/Asap+Condensed</span></span>
<span id="cb35-92"><a href="#cb35-92" aria-hidden="true" tabindex="-1"></a>theme_fancy <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb35-93"><a href="#cb35-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_family =</span> <span class="st">"Asap Condensed"</span>) <span class="sc">+</span></span>
<span id="cb35-94"><a href="#cb35-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span>
<span id="cb35-95"><a href="#cb35-95" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-96"><a href="#cb35-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-97"><a href="#cb35-97" aria-hidden="true" tabindex="-1"></a>eda_boxplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(movies_clean, <span class="fu">aes</span>(<span class="at">x =</span> genre, <span class="at">y =</span> rating, <span class="at">fill =</span> genre)) <span class="sc">+</span></span>
<span id="cb35-98"><a href="#cb35-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb35-99"><a href="#cb35-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#0288b7"</span>, <span class="st">"#a90010"</span>), <span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb35-100"><a href="#cb35-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb35-101"><a href="#cb35-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Rating"</span>) <span class="sc">+</span></span>
<span id="cb35-102"><a href="#cb35-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_fancy</span>()</span>
<span id="cb35-103"><a href="#cb35-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-104"><a href="#cb35-104" aria-hidden="true" tabindex="-1"></a>eda_histogram <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(movies_clean, <span class="fu">aes</span>(<span class="at">x =</span> rating, <span class="at">fill =</span> genre)) <span class="sc">+</span></span>
<span id="cb35-105"><a href="#cb35-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb35-106"><a href="#cb35-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#0288b7"</span>, <span class="st">"#a90010"</span>), <span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb35-107"><a href="#cb35-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb35-108"><a href="#cb35-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Count"</span>, <span class="at">x =</span> <span class="st">"Rating"</span>) <span class="sc">+</span></span>
<span id="cb35-109"><a href="#cb35-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> genre, <span class="at">nrow =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb35-110"><a href="#cb35-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_fancy</span>() <span class="sc">+</span></span>
<span id="cb35-111"><a href="#cb35-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb35-112"><a href="#cb35-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-113"><a href="#cb35-113" aria-hidden="true" tabindex="-1"></a>eda_ridges <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(movies_clean, <span class="fu">aes</span>(<span class="at">x =</span> rating, <span class="at">y =</span> <span class="fu">fct_rev</span>(genre), <span class="at">fill =</span> genre)) <span class="sc">+</span></span>
<span id="cb35-114"><a href="#cb35-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_density_ridges</span>(<span class="at">quantile_lines =</span> <span class="cn">TRUE</span>, <span class="at">quantiles =</span> <span class="dv">2</span>, <span class="at">scale =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span> </span>
<span id="cb35-115"><a href="#cb35-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#0288b7"</span>, <span class="st">"#a90010"</span>), <span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb35-116"><a href="#cb35-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb35-117"><a href="#cb35-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Rating"</span>, <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb35-118"><a href="#cb35-118" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"White line shows median rating"</span>) <span class="sc">+</span></span>
<span id="cb35-119"><a href="#cb35-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_fancy</span>()</span>
<span id="cb35-120"><a href="#cb35-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-121"><a href="#cb35-121" aria-hidden="true" tabindex="-1"></a>(eda_boxplot <span class="sc">|</span> eda_histogram) <span class="sc">/</span> </span>
<span id="cb35-122"><a href="#cb35-122" aria-hidden="true" tabindex="-1"></a>    eda_ridges <span class="sc">+</span> </span>
<span id="cb35-123"><a href="#cb35-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Do comedies get higher ratings than action movies?"</span>,</span>
<span id="cb35-124"><a href="#cb35-124" aria-hidden="true" tabindex="-1"></a>                  <span class="at">subtitle =</span> <span class="st">"Sample of 400 movies from IMDB"</span>,</span>
<span id="cb35-125"><a href="#cb35-125" aria-hidden="true" tabindex="-1"></a>                  <span class="at">theme =</span> <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Asap Condensed"</span>),</span>
<span id="cb35-126"><a href="#cb35-126" aria-hidden="true" tabindex="-1"></a>                                <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb35-127"><a href="#cb35-127" aria-hidden="true" tabindex="-1"></a>                                                          <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.5</span>))))</span>
<span id="cb35-128"><a href="#cb35-128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-129"><a href="#cb35-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-130"><a href="#cb35-130" aria-hidden="true" tabindex="-1"></a><span class="al">![Exploratory data analysis](eda-plots-1.png)</span></span>
<span id="cb35-131"><a href="#cb35-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-132"><a href="#cb35-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-133"><a href="#cb35-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-134"><a href="#cb35-134" aria-hidden="true" tabindex="-1"></a>Initially, it looks like there might be a difference in average rating. Comedies tend to have higher ratings. We can calculate the difference with some **dplyr** <span class="in">`group_by() %&gt;% summarize()`</span>:</span>
<span id="cb35-135"><a href="#cb35-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-136"><a href="#cb35-136" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-137"><a href="#cb35-137" aria-hidden="true" tabindex="-1"></a>group_diffs <span class="ot">&lt;-</span> movies_clean <span class="sc">%&gt;%</span> </span>
<span id="cb35-138"><a href="#cb35-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(genre) <span class="sc">%&gt;%</span> </span>
<span id="cb35-139"><a href="#cb35-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_rating =</span> <span class="fu">mean</span>(rating, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-140"><a href="#cb35-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_means =</span> avg_rating <span class="sc">-</span> <span class="fu">lead</span>(avg_rating))</span>
<span id="cb35-141"><a href="#cb35-141" aria-hidden="true" tabindex="-1"></a>group_diffs</span>
<span id="cb35-142"><a href="#cb35-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-143"><a href="#cb35-143" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 2 x 3</span></span>
<span id="cb35-144"><a href="#cb35-144" aria-hidden="true" tabindex="-1"></a><span class="do">##   genre  avg_rating diff_means</span></span>
<span id="cb35-145"><a href="#cb35-145" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;fct&gt;       &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span id="cb35-146"><a href="#cb35-146" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Action       5.28     -0.682</span></span>
<span id="cb35-147"><a href="#cb35-147" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Comedy       5.97     NA</span></span>
<span id="cb35-148"><a href="#cb35-148" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-149"><a href="#cb35-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-150"><a href="#cb35-150" aria-hidden="true" tabindex="-1"></a>Yep. There’s a -0.6825 point difference in ratings. Action movies score 0.7 points lower than comedies, on average.</span>
<span id="cb35-151"><a href="#cb35-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-152"><a href="#cb35-152" aria-hidden="true" tabindex="-1"></a>But how certain are we that that difference is real and not just due to sampling error? It’s time for inference!</span>
<span id="cb35-153"><a href="#cb35-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-154"><a href="#cb35-154" aria-hidden="true" tabindex="-1"></a><span class="fu">## Classical frequentist t-tests</span></span>
<span id="cb35-155"><a href="#cb35-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-156"><a href="#cb35-156" aria-hidden="true" tabindex="-1"></a><span class="fu">### t-test, assuming equal variances</span></span>
<span id="cb35-157"><a href="#cb35-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-158"><a href="#cb35-158" aria-hidden="true" tabindex="-1"></a>We can use a standard frequentist t-test to check if the group means are different. We can assume that the variances in the two groups are the same and run <span class="in">`t.test()`</span>:</span>
<span id="cb35-159"><a href="#cb35-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-160"><a href="#cb35-160" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-161"><a href="#cb35-161" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume equal variances</span></span>
<span id="cb35-162"><a href="#cb35-162" aria-hidden="true" tabindex="-1"></a>t_test_eq <span class="ot">&lt;-</span> <span class="fu">t.test</span>(rating <span class="sc">~</span> genre, <span class="at">data =</span> movies_clean, <span class="at">var.equal =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-163"><a href="#cb35-163" aria-hidden="true" tabindex="-1"></a>t_test_eq</span>
<span id="cb35-164"><a href="#cb35-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-165"><a href="#cb35-165" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb35-166"><a href="#cb35-166" aria-hidden="true" tabindex="-1"></a><span class="do">##  Two Sample t-test</span></span>
<span id="cb35-167"><a href="#cb35-167" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb35-168"><a href="#cb35-168" aria-hidden="true" tabindex="-1"></a><span class="do">## data:  rating by genre</span></span>
<span id="cb35-169"><a href="#cb35-169" aria-hidden="true" tabindex="-1"></a><span class="do">## t = -4.4753, df = 398, p-value = 0.000009977</span></span>
<span id="cb35-170"><a href="#cb35-170" aria-hidden="true" tabindex="-1"></a><span class="do">## alternative hypothesis: true difference in means is not equal to 0</span></span>
<span id="cb35-171"><a href="#cb35-171" aria-hidden="true" tabindex="-1"></a><span class="do">## 95 percent confidence interval:</span></span>
<span id="cb35-172"><a href="#cb35-172" aria-hidden="true" tabindex="-1"></a><span class="do">##  -0.9823168 -0.3826832</span></span>
<span id="cb35-173"><a href="#cb35-173" aria-hidden="true" tabindex="-1"></a><span class="do">## sample estimates:</span></span>
<span id="cb35-174"><a href="#cb35-174" aria-hidden="true" tabindex="-1"></a><span class="do">## mean in group Action mean in group Comedy </span></span>
<span id="cb35-175"><a href="#cb35-175" aria-hidden="true" tabindex="-1"></a><span class="do">##               5.2845               5.9670</span></span>
<span id="cb35-176"><a href="#cb35-176" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-177"><a href="#cb35-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-178"><a href="#cb35-178" aria-hidden="true" tabindex="-1"></a>The default output is helpful—the p-value is really tiny, which means there’s a tiny chance that we’d see a difference that big in group means in a world where there’s no difference. However, in this format, it’s hard to extract any of these values for later use, like in plotting. We can use the <span class="in">`tidy()`</span> function from the **broom** library to convert these t-test results to a nice data frame.</span>
<span id="cb35-179"><a href="#cb35-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-180"><a href="#cb35-180" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-181"><a href="#cb35-181" aria-hidden="true" tabindex="-1"></a>t_test_eq_tidy <span class="ot">&lt;-</span> <span class="fu">tidy</span>(t_test_eq) <span class="sc">%&gt;%</span> </span>
<span id="cb35-182"><a href="#cb35-182" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate difference in means, since t.test() doesn't actually do that</span></span>
<span id="cb35-183"><a href="#cb35-183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimate =</span> estimate1 <span class="sc">-</span> estimate2) <span class="sc">%&gt;%</span></span>
<span id="cb35-184"><a href="#cb35-184" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rearrange columns</span></span>
<span id="cb35-185"><a href="#cb35-185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"estimate"</span>), <span class="fu">everything</span>())</span>
<span id="cb35-186"><a href="#cb35-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-187"><a href="#cb35-187" aria-hidden="true" tabindex="-1"></a>t_test_eq_tidy</span>
<span id="cb35-188"><a href="#cb35-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-189"><a href="#cb35-189" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1 x 10</span></span>
<span id="cb35-190"><a href="#cb35-190" aria-hidden="true" tabindex="-1"></a><span class="do">##   estimate1 estimate2 estimate statistic p.value parameter conf.low</span></span>
<span id="cb35-191"><a href="#cb35-191" aria-hidden="true" tabindex="-1"></a><span class="do">##       &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb35-192"><a href="#cb35-192" aria-hidden="true" tabindex="-1"></a><span class="do">## 1      5.28      5.97   -0.682     -4.48 9.98e-6       398   -0.982</span></span>
<span id="cb35-193"><a href="#cb35-193" aria-hidden="true" tabindex="-1"></a><span class="do">## # … with 3 more variables: conf.high &lt;dbl&gt;, method &lt;chr&gt;,</span></span>
<span id="cb35-194"><a href="#cb35-194" aria-hidden="true" tabindex="-1"></a><span class="do">## #   alternative &lt;chr&gt;</span></span>
<span id="cb35-195"><a href="#cb35-195" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-196"><a href="#cb35-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-197"><a href="#cb35-197" aria-hidden="true" tabindex="-1"></a>By default, though, R does not assume that the variance in the two groups’ populations is equal, which is probably a reasonable thing to do. There may be structural differences in how comedies and action movies are produced, which in turn leads to structural differences in how they’re rated.</span>
<span id="cb35-198"><a href="#cb35-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-199"><a href="#cb35-199" aria-hidden="true" tabindex="-1"></a>There are several systematic ways to check if the two groups have equal variance. For all these tests, the null hypothesis is that the two groups have similar (homogeneous) variances. If the p-value is less than 0.05, we can assume that they have unequal or heterogeneous variances. (<span class="co">[</span><span class="ot">Here’s a helpful overview</span><span class="co">](https://statistic-on-air.blogspot.com/2009/07/analysis-of-variance-anova-for-multiple.html)</span> of this process.)</span>
<span id="cb35-200"><a href="#cb35-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-201"><a href="#cb35-201" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">**Bartlett test**</span><span class="co">](https://en.wikipedia.org/wiki/Bartlett%27s_test)</span>: Check homogeneity of variances based on the mean</span>
<span id="cb35-202"><a href="#cb35-202" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb35-203"><a href="#cb35-203" aria-hidden="true" tabindex="-1"></a>    <span class="in">``` r</span></span>
<span id="cb35-204"><a href="#cb35-204" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bartlett.test</span>(rating <span class="sc">~</span> genre, <span class="at">data =</span> movies_clean)</span>
<span id="cb35-205"><a href="#cb35-205" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-206"><a href="#cb35-206" aria-hidden="true" tabindex="-1"></a>    <span class="do">## </span></span>
<span id="cb35-207"><a href="#cb35-207" aria-hidden="true" tabindex="-1"></a>    <span class="do">##  Bartlett test of homogeneity of variances</span></span>
<span id="cb35-208"><a href="#cb35-208" aria-hidden="true" tabindex="-1"></a>    <span class="do">## </span></span>
<span id="cb35-209"><a href="#cb35-209" aria-hidden="true" tabindex="-1"></a>    <span class="do">## data:  rating by genre</span></span>
<span id="cb35-210"><a href="#cb35-210" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Bartlett's K-squared = 0.10006, df = 1, p-value = 0.7518</span></span>
<span id="cb35-211"><a href="#cb35-211" aria-hidden="true" tabindex="-1"></a>    <span class="in">```</span></span>
<span id="cb35-212"><a href="#cb35-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-213"><a href="#cb35-213" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">**Levene test**</span><span class="co">](https://en.wikipedia.org/wiki/Levene%27s_test)</span>: Check homogeneity of variances based on the median, so it’s more robust to outliers</span>
<span id="cb35-214"><a href="#cb35-214" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-215"><a href="#cb35-215" aria-hidden="true" tabindex="-1"></a>    <span class="in">``` r</span></span>
<span id="cb35-216"><a href="#cb35-216" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Install the car package first</span></span>
<span id="cb35-217"><a href="#cb35-217" aria-hidden="true" tabindex="-1"></a>    car<span class="sc">::</span><span class="fu">leveneTest</span>(rating <span class="sc">~</span> genre, <span class="at">data =</span> movies_clean)</span>
<span id="cb35-218"><a href="#cb35-218" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-219"><a href="#cb35-219" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Levene's Test for Homogeneity of Variance (center = median)</span></span>
<span id="cb35-220"><a href="#cb35-220" aria-hidden="true" tabindex="-1"></a>    <span class="do">##        Df F value Pr(&gt;F)</span></span>
<span id="cb35-221"><a href="#cb35-221" aria-hidden="true" tabindex="-1"></a>    <span class="do">## group   1  0.4917 0.4836</span></span>
<span id="cb35-222"><a href="#cb35-222" aria-hidden="true" tabindex="-1"></a>    <span class="do">##       398</span></span>
<span id="cb35-223"><a href="#cb35-223" aria-hidden="true" tabindex="-1"></a>    <span class="in">```</span></span>
<span id="cb35-224"><a href="#cb35-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-225"><a href="#cb35-225" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">**Fligner-Killeen test**</span><span class="co">](https://biostats.w.uib.no/test-for-homogeneity-of-variances-levenes-test/)</span>: Check homogeneity of variances based on the median, so it’s more robust to outliers</span>
<span id="cb35-226"><a href="#cb35-226" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-227"><a href="#cb35-227" aria-hidden="true" tabindex="-1"></a>    <span class="in">``` r</span></span>
<span id="cb35-228"><a href="#cb35-228" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fligner.test</span>(rating <span class="sc">~</span> genre, <span class="at">data =</span> movies_clean)</span>
<span id="cb35-229"><a href="#cb35-229" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-230"><a href="#cb35-230" aria-hidden="true" tabindex="-1"></a>    <span class="do">## </span></span>
<span id="cb35-231"><a href="#cb35-231" aria-hidden="true" tabindex="-1"></a>    <span class="do">##  Fligner-Killeen test of homogeneity of variances</span></span>
<span id="cb35-232"><a href="#cb35-232" aria-hidden="true" tabindex="-1"></a>    <span class="do">## </span></span>
<span id="cb35-233"><a href="#cb35-233" aria-hidden="true" tabindex="-1"></a>    <span class="do">## data:  rating by genre</span></span>
<span id="cb35-234"><a href="#cb35-234" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Fligner-Killeen:med chi-squared = 0.78337, df = 1, p-value = 0.3761</span></span>
<span id="cb35-235"><a href="#cb35-235" aria-hidden="true" tabindex="-1"></a>    <span class="in">```</span></span>
<span id="cb35-236"><a href="#cb35-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-237"><a href="#cb35-237" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">**Kruskal-Wallis test**</span><span class="co">](https://en.wikipedia.org/wiki/Kruskal%E2%80%93Wallis_one-way_analysis_of_variance)</span>: Check homogeneity of distributions nonparametrically</span>
<span id="cb35-238"><a href="#cb35-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-239"><a href="#cb35-239" aria-hidden="true" tabindex="-1"></a>    <span class="in">``` r</span></span>
<span id="cb35-240"><a href="#cb35-240" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kruskal.test</span>(rating <span class="sc">~</span> genre, <span class="at">data =</span> movies_clean)</span>
<span id="cb35-241"><a href="#cb35-241" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-242"><a href="#cb35-242" aria-hidden="true" tabindex="-1"></a>    <span class="do">## </span></span>
<span id="cb35-243"><a href="#cb35-243" aria-hidden="true" tabindex="-1"></a>    <span class="do">##  Kruskal-Wallis rank sum test</span></span>
<span id="cb35-244"><a href="#cb35-244" aria-hidden="true" tabindex="-1"></a>    <span class="do">## </span></span>
<span id="cb35-245"><a href="#cb35-245" aria-hidden="true" tabindex="-1"></a>    <span class="do">## data:  rating by genre</span></span>
<span id="cb35-246"><a href="#cb35-246" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Kruskal-Wallis chi-squared = 19.787, df = 1, p-value = 0.000008655</span></span>
<span id="cb35-247"><a href="#cb35-247" aria-hidden="true" tabindex="-1"></a>    <span class="in">```</span></span>
<span id="cb35-248"><a href="#cb35-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-249"><a href="#cb35-249" aria-hidden="true" tabindex="-1"></a>Phew. In all these tests except the Kruskall-Wallis test, we don’t have enough evidence to conclude that the variances are different, so we’re probably safe leaving <span class="in">`var.equal = TRUE`</span> on.</span>
<span id="cb35-250"><a href="#cb35-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-251"><a href="#cb35-251" aria-hidden="true" tabindex="-1"></a><span class="fu">### t-test, assuming unequal variance</span></span>
<span id="cb35-252"><a href="#cb35-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-253"><a href="#cb35-253" aria-hidden="true" tabindex="-1"></a>We can run a t-test assuming that the two groups have unequal variances by setting <span class="in">`var.equal = FALSE`</span>, or just leaving it off. I generally just do this instead of going through all the tests for equal variance.</span>
<span id="cb35-254"><a href="#cb35-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-255"><a href="#cb35-255" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-256"><a href="#cb35-256" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume unequal variances</span></span>
<span id="cb35-257"><a href="#cb35-257" aria-hidden="true" tabindex="-1"></a>t_test_uneq <span class="ot">&lt;-</span> <span class="fu">t.test</span>(rating <span class="sc">~</span> genre, <span class="at">data =</span> movies_clean)</span>
<span id="cb35-258"><a href="#cb35-258" aria-hidden="true" tabindex="-1"></a>t_test_uneq_tidy <span class="ot">&lt;-</span> <span class="fu">tidy</span>(t_test_uneq) <span class="sc">%&gt;%</span> </span>
<span id="cb35-259"><a href="#cb35-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimate =</span> estimate1 <span class="sc">-</span> estimate2) <span class="sc">%&gt;%</span> </span>
<span id="cb35-260"><a href="#cb35-260" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"estimate"</span>), <span class="fu">everything</span>())</span>
<span id="cb35-261"><a href="#cb35-261" aria-hidden="true" tabindex="-1"></a>t_test_uneq_tidy</span>
<span id="cb35-262"><a href="#cb35-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-263"><a href="#cb35-263" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1 x 10</span></span>
<span id="cb35-264"><a href="#cb35-264" aria-hidden="true" tabindex="-1"></a><span class="do">##   estimate estimate1 estimate2 statistic p.value parameter conf.low</span></span>
<span id="cb35-265"><a href="#cb35-265" aria-hidden="true" tabindex="-1"></a><span class="do">##      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb35-266"><a href="#cb35-266" aria-hidden="true" tabindex="-1"></a><span class="do">## 1   -0.682      5.28      5.97     -4.48 9.98e-6      398.   -0.982</span></span>
<span id="cb35-267"><a href="#cb35-267" aria-hidden="true" tabindex="-1"></a><span class="do">## # … with 3 more variables: conf.high &lt;dbl&gt;, method &lt;chr&gt;,</span></span>
<span id="cb35-268"><a href="#cb35-268" aria-hidden="true" tabindex="-1"></a><span class="do">## #   alternative &lt;chr&gt;</span></span>
<span id="cb35-269"><a href="#cb35-269" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-270"><a href="#cb35-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-271"><a href="#cb35-271" aria-hidden="true" tabindex="-1"></a><span class="fu">## Simulation-based tests</span></span>
<span id="cb35-272"><a href="#cb35-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-273"><a href="#cb35-273" aria-hidden="true" tabindex="-1"></a>Instead of dealing with all the assumptions of the data and finding the exact statistical test written by some dude in the 1940s, we can use the power of bootstrapping, permutation, and simulation to construct a null distribution and calculate confidence intervals. According to Allen Downey, <span class="co">[</span><span class="ot">there is actually only one statistical test</span><span class="co">](http://allendowney.blogspot.com/2016/06/there-is-still-only-one-test.html)</span> and that at their core, all statistical tests follow the same universal pattern:</span>
<span id="cb35-274"><a href="#cb35-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-275"><a href="#cb35-275" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Step 1: Calculate a sample statistic, or $\delta$.** This is the main measure you care about: the difference in means, the average, the median, the proportion, the difference in proportions, the chi-squared value, etc.</span>
<span id="cb35-276"><a href="#cb35-276" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Step 2: Use simulation to invent a world where $\delta$ is null.** Simulate what the world would look like if there was no difference between two groups, or if there was no difference in proportions, or where the average value is a specific number.</span>
<span id="cb35-277"><a href="#cb35-277" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Step 3: Look at $\delta$ in the null world.** Put the sample statistic in the null world and see if it fits well.</span>
<span id="cb35-278"><a href="#cb35-278" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Step 4: Calculate the probability that $\delta$ could exist in null world.** This is the p-value, or the probability that you’d see a $\delta$ at least that high in a world where there’s no difference.</span>
<span id="cb35-279"><a href="#cb35-279" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Step 5: Decide if $\delta$ is statistically significant.** Choose some evidentiary standard or threshold (like 0.05) for deciding if there’s sufficient proof for rejecting the null world.</span>
<span id="cb35-280"><a href="#cb35-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-281"><a href="#cb35-281" aria-hidden="true" tabindex="-1"></a>I have <span class="co">[</span><span class="ot">a fully commented example of how to do this with the **infer** package here</span><span class="co">](https://www.andrewheiss.com/blog/2018/12/05/test-any-hypothesis/)</span>. Once you get the hang of it, the <span class="co">[</span><span class="ot">**infer** workflow</span><span class="co">](https://github.com/tidymodels/infer)</span> is fairly intuitive and flexible and far more delightful than worrying about classical tests.</span>
<span id="cb35-282"><a href="#cb35-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-283"><a href="#cb35-283" aria-hidden="true" tabindex="-1"></a>First we calculate the difference in means in the actual data:</span>
<span id="cb35-284"><a href="#cb35-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-285"><a href="#cb35-285" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-286"><a href="#cb35-286" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the difference in means</span></span>
<span id="cb35-287"><a href="#cb35-287" aria-hidden="true" tabindex="-1"></a>diff_means <span class="ot">&lt;-</span> movies_clean <span class="sc">%&gt;%</span> </span>
<span id="cb35-288"><a href="#cb35-288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">specify</span>(rating <span class="sc">~</span> genre) <span class="sc">%&gt;%</span></span>
<span id="cb35-289"><a href="#cb35-289" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Order here means we subtract comedy from action (Action - Comedy)</span></span>
<span id="cb35-290"><a href="#cb35-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">calculate</span>(<span class="st">"diff in means"</span>, <span class="at">order =</span> <span class="fu">c</span>(<span class="st">"Action"</span>, <span class="st">"Comedy"</span>))</span>
<span id="cb35-291"><a href="#cb35-291" aria-hidden="true" tabindex="-1"></a>diff_means</span>
<span id="cb35-292"><a href="#cb35-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-293"><a href="#cb35-293" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1 x 1</span></span>
<span id="cb35-294"><a href="#cb35-294" aria-hidden="true" tabindex="-1"></a><span class="do">##     stat</span></span>
<span id="cb35-295"><a href="#cb35-295" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;dbl&gt;</span></span>
<span id="cb35-296"><a href="#cb35-296" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 -0.682</span></span>
<span id="cb35-297"><a href="#cb35-297" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-298"><a href="#cb35-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-299"><a href="#cb35-299" aria-hidden="true" tabindex="-1"></a>Then we can generate a bootstrapped distribution of the difference in means based on our sample and calculate the confidence interval:</span>
<span id="cb35-300"><a href="#cb35-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-301"><a href="#cb35-301" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-302"><a href="#cb35-302" aria-hidden="true" tabindex="-1"></a>boot_means <span class="ot">&lt;-</span> movies_clean <span class="sc">%&gt;%</span> </span>
<span id="cb35-303"><a href="#cb35-303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">specify</span>(rating <span class="sc">~</span> genre) <span class="sc">%&gt;%</span> </span>
<span id="cb35-304"><a href="#cb35-304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate</span>(<span class="at">reps =</span> <span class="dv">1000</span>, <span class="at">type =</span> <span class="st">"bootstrap"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-305"><a href="#cb35-305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">calculate</span>(<span class="st">"diff in means"</span>, <span class="at">order =</span> <span class="fu">c</span>(<span class="st">"Action"</span>, <span class="st">"Comedy"</span>))</span>
<span id="cb35-306"><a href="#cb35-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-307"><a href="#cb35-307" aria-hidden="true" tabindex="-1"></a>boostrapped_confint <span class="ot">&lt;-</span> boot_means <span class="sc">%&gt;%</span> <span class="fu">get_confidence_interval</span>()</span>
<span id="cb35-308"><a href="#cb35-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-309"><a href="#cb35-309" aria-hidden="true" tabindex="-1"></a>boot_means <span class="sc">%&gt;%</span> </span>
<span id="cb35-310"><a href="#cb35-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visualize</span>() <span class="sc">+</span> </span>
<span id="cb35-311"><a href="#cb35-311" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shade_confidence_interval</span>(boostrapped_confint,</span>
<span id="cb35-312"><a href="#cb35-312" aria-hidden="true" tabindex="-1"></a>                            <span class="at">color =</span> <span class="st">"#8bc5ed"</span>, <span class="at">fill =</span> <span class="st">"#85d9d2"</span>) <span class="sc">+</span></span>
<span id="cb35-313"><a href="#cb35-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> diff_means<span class="sc">$</span>stat, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"#77002c"</span>) <span class="sc">+</span></span>
<span id="cb35-314"><a href="#cb35-314" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Bootstrapped distribution of differences in means"</span>,</span>
<span id="cb35-315"><a href="#cb35-315" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Action − Comedy"</span>, <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb35-316"><a href="#cb35-316" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Red line shows observed difference; shaded area shows 95% confidence interval"</span>) <span class="sc">+</span></span>
<span id="cb35-317"><a href="#cb35-317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_fancy</span>()</span>
<span id="cb35-318"><a href="#cb35-318" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-319"><a href="#cb35-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-320"><a href="#cb35-320" aria-hidden="true" tabindex="-1"></a><span class="al">![Bootstrapped confidence interval](sim-boot-1.png)</span></span>
<span id="cb35-321"><a href="#cb35-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-322"><a href="#cb35-322" aria-hidden="true" tabindex="-1"></a>Neat. We have a simulation-based confidence interval, and it doesn’t contain zero, so we can have some confidence that there’s a real difference between the two groups.</span>
<span id="cb35-323"><a href="#cb35-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-324"><a href="#cb35-324" aria-hidden="true" tabindex="-1"></a>We can go through the testing process more thoroughly by following Downey’s process. We’ve already done step one (calculate $\delta$); next we generate a world where there’s no difference by shuffling all the action/comedy labels through permutation</span>
<span id="cb35-325"><a href="#cb35-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-326"><a href="#cb35-326" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-327"><a href="#cb35-327" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Invent a world where δ is null</span></span>
<span id="cb35-328"><a href="#cb35-328" aria-hidden="true" tabindex="-1"></a>genre_diffs_null <span class="ot">&lt;-</span> movies_clean <span class="sc">%&gt;%</span> </span>
<span id="cb35-329"><a href="#cb35-329" aria-hidden="true" tabindex="-1"></a>  <span class="fu">specify</span>(rating <span class="sc">~</span> genre) <span class="sc">%&gt;%</span> </span>
<span id="cb35-330"><a href="#cb35-330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hypothesize</span>(<span class="at">null =</span> <span class="st">"independence"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-331"><a href="#cb35-331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate</span>(<span class="at">reps =</span> <span class="dv">5000</span>, <span class="at">type =</span> <span class="st">"permute"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-332"><a href="#cb35-332" aria-hidden="true" tabindex="-1"></a>  <span class="fu">calculate</span>(<span class="st">"diff in means"</span>, <span class="at">order =</span> <span class="fu">c</span>(<span class="st">"Action"</span>, <span class="st">"Comedy"</span>))</span>
<span id="cb35-333"><a href="#cb35-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-334"><a href="#cb35-334" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Put actual observed δ in the null world and see if it fits</span></span>
<span id="cb35-335"><a href="#cb35-335" aria-hidden="true" tabindex="-1"></a>genre_diffs_null <span class="sc">%&gt;%</span> </span>
<span id="cb35-336"><a href="#cb35-336" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visualize</span>() <span class="sc">+</span> </span>
<span id="cb35-337"><a href="#cb35-337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> diff_means<span class="sc">$</span>stat, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"#77002c"</span>) <span class="sc">+</span></span>
<span id="cb35-338"><a href="#cb35-338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma) <span class="sc">+</span></span>
<span id="cb35-339"><a href="#cb35-339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Simulated difference in average ratings (Action − Comedy)"</span>, <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb35-340"><a href="#cb35-340" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Simulation-based null distribution of differences in means"</span>,</span>
<span id="cb35-341"><a href="#cb35-341" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Red line shows observed difference"</span>) <span class="sc">+</span></span>
<span id="cb35-342"><a href="#cb35-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_fancy</span>()</span>
<span id="cb35-343"><a href="#cb35-343" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-344"><a href="#cb35-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-345"><a href="#cb35-345" aria-hidden="true" tabindex="-1"></a><span class="al">![Simulated p-value](sim-generate-null-world-1.png)</span></span>
<span id="cb35-346"><a href="#cb35-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-347"><a href="#cb35-347" aria-hidden="true" tabindex="-1"></a>That red line is pretty far to the left and seems like it wouldn’t fit very well in a world where there’s no actual difference between the groups. We can calculate the probability of seeing that red line in a null world (step 4) with <span class="in">`get_p_value()`</span> (and we can use the cool new <span class="in">`pvalue()`</span> function in the **scales** library to format it as &lt; 0.001):</span>
<span id="cb35-348"><a href="#cb35-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-349"><a href="#cb35-349" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-350"><a href="#cb35-350" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Calculate probability that observed δ could exist in null world</span></span>
<span id="cb35-351"><a href="#cb35-351" aria-hidden="true" tabindex="-1"></a>genre_diffs_null <span class="sc">%&gt;%</span> </span>
<span id="cb35-352"><a href="#cb35-352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_p_value</span>(<span class="at">obs_stat =</span> diff_means, <span class="at">direction =</span> <span class="st">"both"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-353"><a href="#cb35-353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_value_clean =</span> <span class="fu">pvalue</span>(p_value))</span>
<span id="cb35-354"><a href="#cb35-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-355"><a href="#cb35-355" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1 x 2</span></span>
<span id="cb35-356"><a href="#cb35-356" aria-hidden="true" tabindex="-1"></a><span class="do">##   p_value p_value_clean</span></span>
<span id="cb35-357"><a href="#cb35-357" aria-hidden="true" tabindex="-1"></a><span class="do">##     &lt;dbl&gt; &lt;chr&gt;        </span></span>
<span id="cb35-358"><a href="#cb35-358" aria-hidden="true" tabindex="-1"></a><span class="do">## 1       0 &lt;0.001</span></span>
<span id="cb35-359"><a href="#cb35-359" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-360"><a href="#cb35-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-361"><a href="#cb35-361" aria-hidden="true" tabindex="-1"></a>Because the p-value is so small, it passes pretty much all evidentiary thresholds (p &lt; 0.05, p &lt; 0.01, etc), so we can safely say that there’s a difference between the two groups. Action movies are rated lower, on average, than comedies.</span>
<span id="cb35-362"><a href="#cb35-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-363"><a href="#cb35-363" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bayesian regression</span></span>
<span id="cb35-364"><a href="#cb35-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-365"><a href="#cb35-365" aria-hidden="true" tabindex="-1"></a>Next we can leave the world of frequentist statistics and null hypothesis testing and do some Bayesian analysis. Frequentist null hypothesis significance testing (NHST) determines the *probability of the data given a null hypothesis* (i.e.&nbsp;$P(\text{data} | H)$, yielding results that are often unwieldy, phrased as the probability of rejecting the null if it is true (hence all that talk of “null worlds” earlier). In contrast, Bayesian analysis determines the *probability of a hypothesis given the data* (i.e.$P(H | \text{data})$), resulting in probabilities that are directly interpretable.</span>
<span id="cb35-366"><a href="#cb35-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-367"><a href="#cb35-367" aria-hidden="true" tabindex="-1"></a>Bayesian analysis is way more computationally intensive and requires more upfront work (e.g prior specification). Because of this, R itself doesn’t have robust support for the actual Monte Carlo sampling and other computational heavy lifting involved in Bayesian stuff. Instead, it can connect to external sampling programs that are optimized for this kind of repetitive simulation work. <span class="co">[</span><span class="ot">BUGS</span><span class="co">](https://en.wikipedia.org/wiki/Bayesian_inference_using_Gibbs_sampling)</span> and <span class="co">[</span><span class="ot">JAGS</span><span class="co">](http://mcmc-jags.sourceforge.net/)</span> were popular sampling software tools, but nowadays all the cool kids are using <span class="co">[</span><span class="ot">Stan</span><span class="co">](https://mc-stan.org/)</span>.</span>
<span id="cb35-368"><a href="#cb35-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-369"><a href="#cb35-369" aria-hidden="true" tabindex="-1"></a>Writing Stan code by hand is tricky since it requires that you essentially learn another programming language. Fortunately, you technically can do Bayesian analysis without writing a single line of Stan code. There are two different packages that precompile Stan code for you:</span>
<span id="cb35-370"><a href="#cb35-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-371"><a href="#cb35-371" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="co">[</span><span class="ot">**rstanarm**</span><span class="co">](https://mc-stan.org/users/interfaces/rstanarm)</span>: This is written by the Stan team itself and provides functions like <span class="in">`stan_lm()`</span> and <span class="in">`stan_glm()`</span> that are drop-in replacements for R’s standard <span class="in">`lm()`</span> and <span class="in">`glm()`</span>. The code is highly optimized and precompiled and runs really fast, but there’s no good way to inspect the underlying Stan code. Also, it’s more limited in the types of regression it supports.</span>
<span id="cb35-372"><a href="#cb35-372" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="co">[</span><span class="ot">**brms**</span><span class="co">](https://github.com/paul-buerkner/brms)</span>: This provides a more universal front end for Stan and supports a wider variety of models. It doesn’t have drop-in <span class="in">`lm()`</span> replacements, but the <span class="in">`brm()`</span> function is fairly intuitive after poring through the documentation and examples. It’s slower than **rstanarm** because it has to compile the Stan scripts it generates with C++, but you can inspect the Stan code behind each of the models with <span class="in">`stancode()`</span> and better see what’s going on behind the scenes.</span>
<span id="cb35-373"><a href="#cb35-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-374"><a href="#cb35-374" aria-hidden="true" tabindex="-1"></a>There aren’t really any cool front end packages for running non-regression analyses with Stan from R (there is <span class="co">[</span><span class="ot">Rasmus Bååth’s Bayesian First Aid package</span><span class="co">](http://www.sumsar.net/blog/2014/02/bayesian-first-aid-one-sample-t-test/)</span>, but it uses JAGS and hasn’t been updated in a while and I want to use Stan like the cool kids), but you can actually calculate differences in means with regression, which means we can approximate frequentist t-tests without writing any Stan code.</span>
<span id="cb35-375"><a href="#cb35-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-376"><a href="#cb35-376" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">This blog post by Matti Vuorre</span><span class="co">](https://vuorre.netlify.com/post/2017/01/02/how-to-compare-two-groups-with-robust-bayesian-estimation-using-r-stan-and-brms/)</span> is a masterpiece and clearly explains the rationale behind how and why you can use regression for t-tests. This code here is adapted from his stuff.</span>
<span id="cb35-377"><a href="#cb35-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-378"><a href="#cb35-378" aria-hidden="true" tabindex="-1"></a>First, we’ll set a bunch of Monte Carlo parameters:</span>
<span id="cb35-379"><a href="#cb35-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-380"><a href="#cb35-380" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-381"><a href="#cb35-381" aria-hidden="true" tabindex="-1"></a>CHAINS <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb35-382"><a href="#cb35-382" aria-hidden="true" tabindex="-1"></a>ITER <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb35-383"><a href="#cb35-383" aria-hidden="true" tabindex="-1"></a>WARMUP <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb35-384"><a href="#cb35-384" aria-hidden="true" tabindex="-1"></a>BAYES_SEED <span class="ot">&lt;-</span> <span class="dv">1234</span></span>
<span id="cb35-385"><a href="#cb35-385" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">mc.cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())  <span class="co"># Use all cores</span></span>
<span id="cb35-386"><a href="#cb35-386" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-387"><a href="#cb35-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-388"><a href="#cb35-388" aria-hidden="true" tabindex="-1"></a><span class="fu">### Regression, assuming equal variances</span></span>
<span id="cb35-389"><a href="#cb35-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-390"><a href="#cb35-390" aria-hidden="true" tabindex="-1"></a>Then we can run the model. We set a couple priors for the intercept (normal, with a mean of 0 and standard deviation of 5) and the beta/slope (normal, with a mean of 0 and a standard deviation of 1). In this model, <span class="in">`rating ~ genre`</span>, we assume equal variances between the groups.</span>
<span id="cb35-391"><a href="#cb35-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-392"><a href="#cb35-392" aria-hidden="true" tabindex="-1"></a>We use <span class="in">`tidyMCMC`</span> from **broom** to calculate the medians of the posterior distributions and create confidence intervals.</span>
<span id="cb35-393"><a href="#cb35-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-394"><a href="#cb35-394" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-395"><a href="#cb35-395" aria-hidden="true" tabindex="-1"></a>brms_eq <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb35-396"><a href="#cb35-396" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bf() is an alias for brmsformula() and lets you specify model formulas</span></span>
<span id="cb35-397"><a href="#cb35-397" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(rating <span class="sc">~</span> genre), </span>
<span id="cb35-398"><a href="#cb35-398" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reverse the levels of genre so that comedy is the base case</span></span>
<span id="cb35-399"><a href="#cb35-399" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">mutate</span>(movies_clean, <span class="at">genre =</span> <span class="fu">fct_rev</span>(genre)),</span>
<span id="cb35-400"><a href="#cb35-400" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">set_prior</span>(<span class="st">"normal(0, 5)"</span>, <span class="at">class =</span> <span class="st">"Intercept"</span>),</span>
<span id="cb35-401"><a href="#cb35-401" aria-hidden="true" tabindex="-1"></a>            <span class="fu">set_prior</span>(<span class="st">"normal(0, 1)"</span>, <span class="at">class =</span> <span class="st">"b"</span>)),</span>
<span id="cb35-402"><a href="#cb35-402" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> CHAINS, <span class="at">iter =</span> ITER, <span class="at">warmup =</span> WARMUP, <span class="at">seed =</span> BAYES_SEED,</span>
<span id="cb35-403"><a href="#cb35-403" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"cache/brms_eq"</span></span>
<span id="cb35-404"><a href="#cb35-404" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-405"><a href="#cb35-405" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-406"><a href="#cb35-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-407"><a href="#cb35-407" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-408"><a href="#cb35-408" aria-hidden="true" tabindex="-1"></a>brms_eq_tidy <span class="ot">&lt;-</span> </span>
<span id="cb35-409"><a href="#cb35-409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidyMCMC</span>(brms_eq, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, </span>
<span id="cb35-410"><a href="#cb35-410" aria-hidden="true" tabindex="-1"></a>           <span class="at">estimate.method =</span> <span class="st">"median"</span>, <span class="at">conf.method =</span> <span class="st">"HPDinterval"</span>)</span>
<span id="cb35-411"><a href="#cb35-411" aria-hidden="true" tabindex="-1"></a>brms_eq_tidy</span>
<span id="cb35-412"><a href="#cb35-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-413"><a href="#cb35-413" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 3 x 5</span></span>
<span id="cb35-414"><a href="#cb35-414" aria-hidden="true" tabindex="-1"></a><span class="do">##   term          estimate std.error conf.low conf.high</span></span>
<span id="cb35-415"><a href="#cb35-415" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb35-416"><a href="#cb35-416" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 b_Intercept      5.96     0.108     5.74      6.16 </span></span>
<span id="cb35-417"><a href="#cb35-417" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 b_genreAction   -0.666    0.152    -0.968    -0.374</span></span>
<span id="cb35-418"><a href="#cb35-418" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 sigma            1.53     0.0529    1.43      1.64</span></span>
<span id="cb35-419"><a href="#cb35-419" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-420"><a href="#cb35-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-421"><a href="#cb35-421" aria-hidden="true" tabindex="-1"></a>Here the intercept represents the mean comedy score, while the coefficient for action represents the difference from that mean, or the effect that we care about. These findings match what we got with the frequentist work from earlier, only now we can change the interpretation: We’re 95% confident that the true population-level difference in rating is between -0.968 and -0.374, with a median of -0.666.</span>
<span id="cb35-422"><a href="#cb35-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-423"><a href="#cb35-423" aria-hidden="true" tabindex="-1"></a><span class="fu">### A quick digression into priors</span></span>
<span id="cb35-424"><a href="#cb35-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-425"><a href="#cb35-425" aria-hidden="true" tabindex="-1"></a>If you don’t explicitly set any priors, **brms** chooses sensible defaults for you. You can see what priors you can potentially set with <span class="in">`get_prior()`</span>:</span>
<span id="cb35-426"><a href="#cb35-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-427"><a href="#cb35-427" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-428"><a href="#cb35-428" aria-hidden="true" tabindex="-1"></a><span class="fu">get_prior</span>(<span class="fu">bf</span>(rating <span class="sc">~</span> genre), <span class="at">data =</span> movies_clean)</span>
<span id="cb35-429"><a href="#cb35-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-430"><a href="#cb35-430" aria-hidden="true" tabindex="-1"></a><span class="do">##                 prior     class        coef group resp dpar nlpar bound</span></span>
<span id="cb35-431"><a href="#cb35-431" aria-hidden="true" tabindex="-1"></a><span class="do">## 1                             b                                        </span></span>
<span id="cb35-432"><a href="#cb35-432" aria-hidden="true" tabindex="-1"></a><span class="do">## 2                             b genreComedy                            </span></span>
<span id="cb35-433"><a href="#cb35-433" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 student_t(3, 6, 10) Intercept                                        </span></span>
<span id="cb35-434"><a href="#cb35-434" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 student_t(3, 0, 10)     sigma</span></span>
<span id="cb35-435"><a href="#cb35-435" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-436"><a href="#cb35-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-437"><a href="#cb35-437" aria-hidden="true" tabindex="-1"></a>You can use this table to select which prior you want to set. For instance, to specify the prior distribution for the intercept, you can use <span class="in">`set_prior("normal(0, 5)", class = "Intercept")`</span>, which matches the table. More complicated formulas will have values in the <span class="in">`dpar`</span> and <span class="in">`nlpar`</span> columns, and you can use those to drill down to specific priors for those terms (e.g.&nbsp;<span class="in">`set_prior("cauchy(0, 1)", class = "b", dpar = "sigma")`</span>).</span>
<span id="cb35-438"><a href="#cb35-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-439"><a href="#cb35-439" aria-hidden="true" tabindex="-1"></a>Also, you can plot the different distributions to get a sense of their shapes with either base R or with ggplot:</span>
<span id="cb35-440"><a href="#cb35-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-441"><a href="#cb35-441" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-442"><a href="#cb35-442" aria-hidden="true" tabindex="-1"></a><span class="co"># Normal distribution: normal(0, 5)</span></span>
<span id="cb35-443"><a href="#cb35-443" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="at">expr =</span> <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">5</span>), <span class="at">from =</span> <span class="sc">-</span><span class="dv">20</span>, <span class="at">to =</span> <span class="dv">20</span>)</span>
<span id="cb35-444"><a href="#cb35-444" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-445"><a href="#cb35-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-446"><a href="#cb35-446" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=FALSE}</span></span>
<span id="cb35-447"><a href="#cb35-447" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Normal distribution"</span></span>
<span id="cb35-448"><a href="#cb35-448" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("dist-base-norm-1.png")</span></span>
<span id="cb35-449"><a href="#cb35-449" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-450"><a href="#cb35-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-451"><a href="#cb35-451" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-452"><a href="#cb35-452" aria-hidden="true" tabindex="-1"></a><span class="co"># Cauchy distribution: cauchy(0, 1)</span></span>
<span id="cb35-453"><a href="#cb35-453" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="at">expr =</span> <span class="fu">dcauchy</span>(x, <span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="dv">1</span>), <span class="at">from =</span> <span class="sc">-</span><span class="dv">5</span>, <span class="at">to =</span> <span class="dv">5</span>)</span>
<span id="cb35-454"><a href="#cb35-454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-455"><a href="#cb35-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-456"><a href="#cb35-456" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=FALSE}</span></span>
<span id="cb35-457"><a href="#cb35-457" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Cauchy distribution"</span></span>
<span id="cb35-458"><a href="#cb35-458" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("dist-base-cauchy-1.png")</span></span>
<span id="cb35-459"><a href="#cb35-459" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-460"><a href="#cb35-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-461"><a href="#cb35-461" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-462"><a href="#cb35-462" aria-hidden="true" tabindex="-1"></a><span class="co"># Or do this with ggplot</span></span>
<span id="cb35-463"><a href="#cb35-463" aria-hidden="true" tabindex="-1"></a>norm_ggplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">20</span>)), <span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb35-464"><a href="#cb35-464" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm, <span class="at">n =</span> <span class="dv">500</span>, <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb35-465"><a href="#cb35-465" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"normal(0, 5)"</span>) <span class="sc">+</span></span>
<span id="cb35-466"><a href="#cb35-466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_fancy</span>()</span>
<span id="cb35-467"><a href="#cb35-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-468"><a href="#cb35-468" aria-hidden="true" tabindex="-1"></a>cauchy_ggplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">5</span>)), <span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb35-469"><a href="#cb35-469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dcauchy, <span class="at">n =</span> <span class="dv">500</span>, <span class="at">args =</span> <span class="fu">list</span>(<span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb35-470"><a href="#cb35-470" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"cauchy(0, 1)"</span>) <span class="sc">+</span></span>
<span id="cb35-471"><a href="#cb35-471" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_fancy</span>()</span>
<span id="cb35-472"><a href="#cb35-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-473"><a href="#cb35-473" aria-hidden="true" tabindex="-1"></a>norm_ggplot <span class="sc">/</span> cauchy_ggplot</span>
<span id="cb35-474"><a href="#cb35-474" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-475"><a href="#cb35-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-476"><a href="#cb35-476" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=FALSE}</span></span>
<span id="cb35-477"><a href="#cb35-477" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Normal and Cauchy distributions with ggplot"</span></span>
<span id="cb35-478"><a href="#cb35-478" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("dists-ggplot-1.png")</span></span>
<span id="cb35-479"><a href="#cb35-479" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-480"><a href="#cb35-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-481"><a href="#cb35-481" aria-hidden="true" tabindex="-1"></a><span class="fu">### Regression, assuming unequal variances</span></span>
<span id="cb35-482"><a href="#cb35-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-483"><a href="#cb35-483" aria-hidden="true" tabindex="-1"></a>We can also use regression to estimate the difference in means under the assumption that group variances are different. Here, following <span class="co">[</span><span class="ot">Matti Vuorre</span><span class="co">](https://vuorre.netlify.com/post/2017/01/02/how-to-compare-two-groups-with-robust-bayesian-estimation-using-r-stan-and-brms/#equal-variances-model)</span>, we need to model the variance (or sigma) in each group, and we need to specify a prior for that term (I chose <span class="in">`cauchy(0, 1`</span>). We do this by specifying two formulas in <span class="in">`brm()`</span>.</span>
<span id="cb35-484"><a href="#cb35-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-485"><a href="#cb35-485" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-486"><a href="#cb35-486" aria-hidden="true" tabindex="-1"></a>brms_uneq <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb35-487"><a href="#cb35-487" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(rating <span class="sc">~</span> genre, sigma <span class="sc">~</span> genre), </span>
<span id="cb35-488"><a href="#cb35-488" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">mutate</span>(movies_clean, <span class="at">genre =</span> <span class="fu">fct_rev</span>(genre)),</span>
<span id="cb35-489"><a href="#cb35-489" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">set_prior</span>(<span class="st">"normal(0, 5)"</span>, <span class="at">class =</span> <span class="st">"Intercept"</span>),</span>
<span id="cb35-490"><a href="#cb35-490" aria-hidden="true" tabindex="-1"></a>            <span class="fu">set_prior</span>(<span class="st">"normal(0, 1)"</span>, <span class="at">class =</span> <span class="st">"b"</span>),</span>
<span id="cb35-491"><a href="#cb35-491" aria-hidden="true" tabindex="-1"></a>            <span class="fu">set_prior</span>(<span class="st">"cauchy(0, 1)"</span>, <span class="at">class =</span> <span class="st">"b"</span>, <span class="at">dpar =</span> <span class="st">"sigma"</span>)),</span>
<span id="cb35-492"><a href="#cb35-492" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> CHAINS, <span class="at">iter =</span> ITER, <span class="at">warmup =</span> WARMUP, <span class="at">seed =</span> BAYES_SEED,</span>
<span id="cb35-493"><a href="#cb35-493" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"cache/brms_uneq"</span></span>
<span id="cb35-494"><a href="#cb35-494" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-495"><a href="#cb35-495" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-496"><a href="#cb35-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-497"><a href="#cb35-497" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-498"><a href="#cb35-498" aria-hidden="true" tabindex="-1"></a>brms_uneq_tidy <span class="ot">&lt;-</span> </span>
<span id="cb35-499"><a href="#cb35-499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidyMCMC</span>(brms_uneq, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, </span>
<span id="cb35-500"><a href="#cb35-500" aria-hidden="true" tabindex="-1"></a>           <span class="at">estimate.method =</span> <span class="st">"median"</span>, <span class="at">conf.method =</span> <span class="st">"HPDinterval"</span>)</span>
<span id="cb35-501"><a href="#cb35-501" aria-hidden="true" tabindex="-1"></a>brms_uneq_tidy</span>
<span id="cb35-502"><a href="#cb35-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-503"><a href="#cb35-503" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 4 x 5</span></span>
<span id="cb35-504"><a href="#cb35-504" aria-hidden="true" tabindex="-1"></a><span class="do">##   term                estimate std.error conf.low conf.high</span></span>
<span id="cb35-505"><a href="#cb35-505" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb35-506"><a href="#cb35-506" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 b_Intercept           5.96      0.111     5.73      6.17 </span></span>
<span id="cb35-507"><a href="#cb35-507" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 b_sigma_Intercept     0.433     0.0494    0.335     0.528</span></span>
<span id="cb35-508"><a href="#cb35-508" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 b_genreAction        -0.665     0.156    -0.979    -0.371</span></span>
<span id="cb35-509"><a href="#cb35-509" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 b_sigma_genreAction  -0.0199    0.0702   -0.161     0.113</span></span>
<span id="cb35-510"><a href="#cb35-510" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-511"><a href="#cb35-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-512"><a href="#cb35-512" aria-hidden="true" tabindex="-1"></a>For mathy reasons (again, <span class="co">[</span><span class="ot">see Matti Vourre’s post</span><span class="co">](https://vuorre.netlify.com/post/2017/01/02/how-to-compare-two-groups-with-robust-bayesian-estimation-using-r-stan-and-brms/#unequal-variances-model)</span>), the sigma terms are on a log scale, so we need to exponentiate them back to the scale of the data.</span>
<span id="cb35-513"><a href="#cb35-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-514"><a href="#cb35-514" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-515"><a href="#cb35-515" aria-hidden="true" tabindex="-1"></a>brms_uneq_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb35-516"><a href="#cb35-516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(estimate, std.error, conf.low, conf.high),</span>
<span id="cb35-517"><a href="#cb35-517" aria-hidden="true" tabindex="-1"></a>            <span class="fu">funs</span>(<span class="fu">ifelse</span>(<span class="fu">str_detect</span>(term, <span class="st">"sigma"</span>), <span class="fu">exp</span>(.), .)))</span>
<span id="cb35-518"><a href="#cb35-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-519"><a href="#cb35-519" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 4 x 5</span></span>
<span id="cb35-520"><a href="#cb35-520" aria-hidden="true" tabindex="-1"></a><span class="do">##   term                estimate std.error conf.low conf.high</span></span>
<span id="cb35-521"><a href="#cb35-521" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb35-522"><a href="#cb35-522" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 b_Intercept            5.96      0.111    5.73      6.17 </span></span>
<span id="cb35-523"><a href="#cb35-523" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 b_sigma_Intercept      1.54      1.05     1.40      1.70 </span></span>
<span id="cb35-524"><a href="#cb35-524" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 b_genreAction         -0.665     0.156   -0.979    -0.371</span></span>
<span id="cb35-525"><a href="#cb35-525" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 b_sigma_genreAction    0.980     1.07     0.851     1.12</span></span>
<span id="cb35-526"><a href="#cb35-526" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-527"><a href="#cb35-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-528"><a href="#cb35-528" aria-hidden="true" tabindex="-1"></a>Here, the interpretation for the intercept and action coefficients are the same as before: the intercept the average comedy rating; the action coefficient is the change from the average comedy rating, or the effect we care about. The sigmas work similarly: the intercept sigma is the standard deviation for comedies; the intercept sigma + action sigma is the standard deviation for action movies.</span>
<span id="cb35-529"><a href="#cb35-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-530"><a href="#cb35-530" aria-hidden="true" tabindex="-1"></a><span class="fu">### Regression, BEST</span></span>
<span id="cb35-531"><a href="#cb35-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-532"><a href="#cb35-532" aria-hidden="true" tabindex="-1"></a>A more robust way of estimating group differences Bayesianly is to use John Kruschke’s <span class="co">[</span><span class="ot">Bayesian Estimation Supersedes the t Test (BEST)</span><span class="co">](https://psycnet.apa.org/doi/10.1037/a0029146)</span> method. I’m 100% not going into the nitty gritty details of this (<span class="co">[</span><span class="ot">Matti Vuorre has, though</span><span class="co">](https://vuorre.netlify.com/post/2017/01/02/how-to-compare-two-groups-with-robust-bayesian-estimation-using-r-stan-and-brms/#robust-bayesian-estimation)</span>). In the most simplest terms, the only difference between BEST and the unequal variance regression above is that we model the data with a t distribution, which means we have a new parameter, $\nu$ (nu), that changes the normality of the distribution (i.e.&nbsp;the degrees of freedom parameter in a t distribution). Kruschke uses an exponential prior with a rate of 1/29 in his paper, so we do too. It looks like this:</span>
<span id="cb35-533"><a href="#cb35-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-534"><a href="#cb35-534" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-535"><a href="#cb35-535" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)), <span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb35-536"><a href="#cb35-536" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dexp, <span class="at">n =</span> <span class="dv">500</span>, <span class="at">args =</span> <span class="fu">list</span>(<span class="at">rate =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">29</span>)) <span class="sc">+</span></span>
<span id="cb35-537"><a href="#cb35-537" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"exponential(1/29)"</span>) <span class="sc">+</span></span>
<span id="cb35-538"><a href="#cb35-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_fancy</span>()</span>
<span id="cb35-539"><a href="#cb35-539" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-540"><a href="#cb35-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-541"><a href="#cb35-541" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=FALSE}</span></span>
<span id="cb35-542"><a href="#cb35-542" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Exponential distribution"</span></span>
<span id="cb35-543"><a href="#cb35-543" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("dist-exp-1.png")</span></span>
<span id="cb35-544"><a href="#cb35-544" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-545"><a href="#cb35-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-546"><a href="#cb35-546" aria-hidden="true" tabindex="-1"></a>Add <span class="in">`family = student`</span> and set the prior for <span class="in">`nu`</span> and we’re ready to go:</span>
<span id="cb35-547"><a href="#cb35-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-548"><a href="#cb35-548" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-549"><a href="#cb35-549" aria-hidden="true" tabindex="-1"></a>brms_uneq_robust <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb35-550"><a href="#cb35-550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(rating <span class="sc">~</span> genre, sigma <span class="sc">~</span> genre), </span>
<span id="cb35-551"><a href="#cb35-551" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> student,</span>
<span id="cb35-552"><a href="#cb35-552" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">mutate</span>(movies_clean, <span class="at">genre =</span> <span class="fu">fct_rev</span>(genre)),</span>
<span id="cb35-553"><a href="#cb35-553" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">set_prior</span>(<span class="st">"normal(0, 5)"</span>, <span class="at">class =</span> <span class="st">"Intercept"</span>),</span>
<span id="cb35-554"><a href="#cb35-554" aria-hidden="true" tabindex="-1"></a>            <span class="fu">set_prior</span>(<span class="st">"normal(0, 1)"</span>, <span class="at">class =</span> <span class="st">"b"</span>),</span>
<span id="cb35-555"><a href="#cb35-555" aria-hidden="true" tabindex="-1"></a>            <span class="fu">set_prior</span>(<span class="st">"cauchy(0, 1)"</span>, <span class="at">class =</span> <span class="st">"b"</span>, <span class="at">dpar =</span> <span class="st">"sigma"</span>),</span>
<span id="cb35-556"><a href="#cb35-556" aria-hidden="true" tabindex="-1"></a>            <span class="fu">set_prior</span>(<span class="st">"exponential(1.0/29)"</span>, <span class="at">class =</span> <span class="st">"nu"</span>)),</span>
<span id="cb35-557"><a href="#cb35-557" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> CHAINS, <span class="at">iter =</span> ITER, <span class="at">warmup =</span> WARMUP, <span class="at">seed =</span> BAYES_SEED,</span>
<span id="cb35-558"><a href="#cb35-558" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"cache/brms_uneq_robust"</span></span>
<span id="cb35-559"><a href="#cb35-559" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-560"><a href="#cb35-560" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-561"><a href="#cb35-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-562"><a href="#cb35-562" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-563"><a href="#cb35-563" aria-hidden="true" tabindex="-1"></a>brms_uneq_robust_tidy <span class="ot">&lt;-</span> </span>
<span id="cb35-564"><a href="#cb35-564" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidyMCMC</span>(brms_uneq_robust, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, </span>
<span id="cb35-565"><a href="#cb35-565" aria-hidden="true" tabindex="-1"></a>           <span class="at">estimate.method =</span> <span class="st">"median"</span>, <span class="at">conf.method =</span> <span class="st">"HPDinterval"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-566"><a href="#cb35-566" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rescale sigmas</span></span>
<span id="cb35-567"><a href="#cb35-567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(estimate, std.error, conf.low, conf.high),</span>
<span id="cb35-568"><a href="#cb35-568" aria-hidden="true" tabindex="-1"></a>            <span class="fu">funs</span>(<span class="fu">ifelse</span>(<span class="fu">str_detect</span>(term, <span class="st">"sigma"</span>), <span class="fu">exp</span>(.), .)))</span>
<span id="cb35-569"><a href="#cb35-569" aria-hidden="true" tabindex="-1"></a>brms_uneq_robust_tidy</span>
<span id="cb35-570"><a href="#cb35-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-571"><a href="#cb35-571" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 5 x 5</span></span>
<span id="cb35-572"><a href="#cb35-572" aria-hidden="true" tabindex="-1"></a><span class="do">##   term                estimate std.error conf.low conf.high</span></span>
<span id="cb35-573"><a href="#cb35-573" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb35-574"><a href="#cb35-574" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 b_Intercept            5.98      0.104    5.77      6.17 </span></span>
<span id="cb35-575"><a href="#cb35-575" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 b_sigma_Intercept      1.47      1.06     1.31      1.66 </span></span>
<span id="cb35-576"><a href="#cb35-576" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 b_genreAction         -0.680     0.148   -0.966    -0.394</span></span>
<span id="cb35-577"><a href="#cb35-577" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 b_sigma_genreAction    0.999     1.08     0.860     1.16 </span></span>
<span id="cb35-578"><a href="#cb35-578" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 nu                    31.9      27.5      5.62     95.1</span></span>
<span id="cb35-579"><a href="#cb35-579" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-580"><a href="#cb35-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-581"><a href="#cb35-581" aria-hidden="true" tabindex="-1"></a>Neato. Just like the other models, the coefficient for action shows us the difference in means (and it’s super similar to everything else). We can exponentiate the sigma coefficients and see the group standard deviations, and we have a coefficient for $\nu$, or the degrees of freedom for the underlying distribution.</span>
<span id="cb35-582"><a href="#cb35-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-583"><a href="#cb35-583" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bayesian analysis, directly with Stan</span></span>
<span id="cb35-584"><a href="#cb35-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-585"><a href="#cb35-585" aria-hidden="true" tabindex="-1"></a>**Update**: <span class="co">[</span><span class="ot">Mike DeCrescenzo</span><span class="co">](https://mikedecr.github.io/)</span> made a <span class="co">[</span><span class="ot">fascinating point on Twitter</span><span class="co">](https://twitter.com/mikedecr/status/1090416939917340672)</span> that relying on regression for t-test-like analysis with Bayesianism actually has important theoretical implications. When specifying a model as <span class="in">`y ~ a + bx`</span> as we did above with <span class="in">`rating ~ genre`</span>, the coefficient for genre (<span class="in">`b`</span>) is actually the difference in means and doesn't directly reflect the rating itself. In theory, if we're thinking about two groups with two different variances, we should model the distribution of each group, not the distribution of the differences in groups. Analyzing the distributions of the two groups separately and *then* calculating the difference should yield more transparent results. And that's why we can/should do the analysis in Stan by hand like this.</span>
<span id="cb35-586"><a href="#cb35-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-587"><a href="#cb35-587" aria-hidden="true" tabindex="-1"></a>**Another update**: <span class="co">[</span><span class="ot">According to TJ Mahr</span><span class="co">](https://twitter.com/tjmahr/status/1090417050600816641?s=21)</span>, you can get around this beta-for-the-difference issue by running a model like <span class="in">`rating ~ 0 + genre`</span>, which suppresses the intercept and estimates coefficients for both groups directly. You have to calculate the difference in coefficients/group means by hand after, but at least you'll be estimating the right things.</span>
<span id="cb35-588"><a href="#cb35-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-589"><a href="#cb35-589" aria-hidden="true" tabindex="-1"></a>Instead of using regression models and combining coefficients to figure out group means and differences, we can be brave and write actual Stan code that can return any value we want. We don’t have to be constrained by regression formulas, but we do have to figure out how to code in Stan, which is intimidating.</span>
<span id="cb35-590"><a href="#cb35-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-591"><a href="#cb35-591" aria-hidden="true" tabindex="-1"></a>There are lots of resources out there for Stan (and Bayesianism in general), including <span class="co">[</span><span class="ot">Richard McElreath’s *Statistical Rethinking*</span><span class="co">](https://xcelab.net/rm/statistical-rethinking/)</span>, which has all its code in raw Stan *and* brms syntax. John Kruschke’s *Doing Bayesian Data Analysis* book includes code in both JAGS and Stan (click on <span class="co">[</span><span class="ot">the link in step 5 here</span><span class="co">](https://sites.google.com/site/doingbayesiandataanalysis/software-installation)</span>; the code for BEST analysis is in the file named <span class="in">`Stan-Ymet-Xnom2grp-MrobustHet.R`</span>).</span>
<span id="cb35-592"><a href="#cb35-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-593"><a href="#cb35-593" aria-hidden="true" tabindex="-1"></a>But the resource that made the structure of Stan files (mostly) click for me was a recorded class (specifically <span class="co">[</span><span class="ot">the session from 2017-01-30</span><span class="co">](https://www.youtube.com/watch?v=-mfeHHLcb1g)</span>) by <span class="co">[</span><span class="ot">Mike Lawrence</span><span class="co">](https://github.com/mike-lawrence)</span> (a Canadian researcher) that <span class="co">[</span><span class="ot">I stumbled on</span><span class="co">](https://discourse.mc-stan.org/t/what-would-be-a-good-resource-to-understand-the-method-of-two-sample-bayesian-hypothesis-testing/1492/6)</span> while searching the internet for ways to run BEST with Stan. Though the video is super long (you can skip around and/or watch at 2x speed; the two-sample example starts at minute 52), Mike clearly lays out the process for writing a Stan file and it’s the coolest thing ever. EVEN BETTER is the fact that he provides <span class="co">[</span><span class="ot">all the code from his class on Dropbox</span><span class="co">](https://www.dropbox.com/sh/js0us2461w98bn7/AADcxczFADrCfnSA2qo8Gb2wa?dl=0)</span> (see the <span class="co">[</span><span class="ot">code from 2017-01-30</span><span class="co">](https://www.dropbox.com/sh/js0us2461w98bn7/AACjhob9JjkfncwkEjyI2-Pxa/2017-01-30?dl=0&amp;subfolder_nav_tracking=1)</span> for t-test related stuff)</span>
<span id="cb35-594"><a href="#cb35-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-595"><a href="#cb35-595" aria-hidden="true" tabindex="-1"></a>Through a combination of Mike Lawrence’s video, <span class="co">[</span><span class="ot">Michael Clark’s BEST implementation here</span><span class="co">](https://github.com/m-clark/Miscellaneous-R-Code/blob/master/ModelFitting/Bayesian/rstant_testBEST.R)</span>, John Kruschke’s Stan code, and lots of debugging, <span class="co">[</span><span class="ot">I created this Stan code</span><span class="co">](imdb_best.stan)</span>. Explaining the whole logic behind it goes way beyond the scope of this blog post, but I heavily commented it so it should be easy-ish to follow if you understand Stan files (which I still don’t completely ¯<span class="sc">\\\_</span>(ツ)<span class="sc">\_</span>/¯).</span>
<span id="cb35-596"><a href="#cb35-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-597"><a href="#cb35-597" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Download `fancy-best.stan`</span><span class="co">](https://github.com/andrewheiss/diff-means-half-dozen-ways/blob/master/imdb_best.stan)</span> and put it in the same folder as whatever script you’re typing in (or change the path to match wherever you put it). Note how the <span class="in">`data`</span> argument in <span class="in">`sampling()`</span> doesn’t just take a data frame like in <span class="in">`brm()`</span>. We have to pass Stan specific pieces of data, all of which are specified in the <span class="in">`data{}`</span> block in the Stan script.</span>
<span id="cb35-598"><a href="#cb35-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-599"><a href="#cb35-599" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-600"><a href="#cb35-600" aria-hidden="true" tabindex="-1"></a>stan_best <span class="ot">&lt;-</span> </span>
<span id="cb35-601"><a href="#cb35-601" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sampling</span>(<span class="fu">stan_model</span>(<span class="st">"imdb_best.stan"</span>), </span>
<span id="cb35-602"><a href="#cb35-602" aria-hidden="true" tabindex="-1"></a>           <span class="co"># Make a list of data to send to Stan</span></span>
<span id="cb35-603"><a href="#cb35-603" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> <span class="fu">list</span>(<span class="at">N =</span> <span class="fu">nrow</span>(movies_clean), </span>
<span id="cb35-604"><a href="#cb35-604" aria-hidden="true" tabindex="-1"></a>                       <span class="at">n_groups =</span> <span class="fu">length</span>(<span class="fu">unique</span>(movies_clean<span class="sc">$</span>genre)), </span>
<span id="cb35-605"><a href="#cb35-605" aria-hidden="true" tabindex="-1"></a>                       <span class="at">group_id =</span> movies_clean<span class="sc">$</span>genre_numeric, </span>
<span id="cb35-606"><a href="#cb35-606" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> movies_clean<span class="sc">$</span>rating),</span>
<span id="cb35-607"><a href="#cb35-607" aria-hidden="true" tabindex="-1"></a>           <span class="at">chains =</span> CHAINS, <span class="at">iter =</span> ITER, <span class="at">warmup =</span> WARMUP, <span class="at">seed =</span> BAYES_SEED)</span>
<span id="cb35-608"><a href="#cb35-608" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-609"><a href="#cb35-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-610"><a href="#cb35-610" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-611"><a href="#cb35-611" aria-hidden="true" tabindex="-1"></a>stan_best_tidy <span class="ot">&lt;-</span> </span>
<span id="cb35-612"><a href="#cb35-612" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidyMCMC</span>(stan_best, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, </span>
<span id="cb35-613"><a href="#cb35-613" aria-hidden="true" tabindex="-1"></a>           <span class="at">estimate.method =</span> <span class="st">"median"</span>, <span class="at">conf.method =</span> <span class="st">"HPDinterval"</span>)</span>
<span id="cb35-614"><a href="#cb35-614" aria-hidden="true" tabindex="-1"></a>stan_best_tidy</span>
<span id="cb35-615"><a href="#cb35-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-616"><a href="#cb35-616" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 8 x 5</span></span>
<span id="cb35-617"><a href="#cb35-617" aria-hidden="true" tabindex="-1"></a><span class="do">##   term     estimate std.error conf.low conf.high</span></span>
<span id="cb35-618"><a href="#cb35-618" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb35-619"><a href="#cb35-619" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 mu[1]       5.29     0.108     5.09      5.50 </span></span>
<span id="cb35-620"><a href="#cb35-620" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 mu[2]       5.99     0.104     5.79      6.19 </span></span>
<span id="cb35-621"><a href="#cb35-621" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 sigma[1]    1.47     0.0838    1.30      1.63 </span></span>
<span id="cb35-622"><a href="#cb35-622" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 sigma[2]    1.47     0.0885    1.30      1.65 </span></span>
<span id="cb35-623"><a href="#cb35-623" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 nu         29.0     20.1       6.35     76.2  </span></span>
<span id="cb35-624"><a href="#cb35-624" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 mu_diff    -0.693    0.147    -0.992    -0.422</span></span>
<span id="cb35-625"><a href="#cb35-625" aria-hidden="true" tabindex="-1"></a><span class="do">## 7 cohen_d    -0.573    0.123    -0.825    -0.349</span></span>
<span id="cb35-626"><a href="#cb35-626" aria-hidden="true" tabindex="-1"></a><span class="do">## 8 cles        0.343    0.0318    0.280     0.402</span></span>
<span id="cb35-627"><a href="#cb35-627" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-628"><a href="#cb35-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-629"><a href="#cb35-629" aria-hidden="true" tabindex="-1"></a>One advantage of running the analysis with raw Stan instead of forcing it into regression form is that we can have Stan calculate all sorts of stuff for us. The averages for both groups get returned (<span class="in">`mu[1]`</span> and <span class="in">`mu[2]`</span>), along with <span class="in">`mu_diff`</span>, so there's no need to combine slope and intercept terms. Also note how the <span class="in">`sigma`</span> coefficients are already in the right scale. I also (following Kruschke and others) made it so that the Stan code returned information about effect sizes, including <span class="co">[</span><span class="ot">Cohen's d</span><span class="co">](https://en.wikipedia.org/wiki/Effect_size#Cohen's_d)</span>, which is the standardized difference in means, and the <span class="co">[</span><span class="ot">common language effect size (CLES)</span><span class="co">](https://janhove.github.io/reporting/2016/11/16/common-language-effect-sizes)</span>, which is the probability that a rating sampled at random from one group will be greater than a rating sampled from the other group.</span>
<span id="cb35-630"><a href="#cb35-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-631"><a href="#cb35-631" aria-hidden="true" tabindex="-1"></a>Here, the difference in means is the same as all the other methods, but the effect size isn’t terribly huge. According to Cohen’s d, we have a medium effect size, and there’s a 34% chance that we could randomly select an action rating from the comedy distribution.</span>
<span id="cb35-632"><a href="#cb35-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-633"><a href="#cb35-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-634"><a href="#cb35-634" aria-hidden="true" tabindex="-1"></a><span class="fu">## Regression, BEST, with priors on variables instead of difference</span></span>
<span id="cb35-635"><a href="#cb35-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-636"><a href="#cb35-636" aria-hidden="true" tabindex="-1"></a>*(I added this section later)*</span>
<span id="cb35-637"><a href="#cb35-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-638"><a href="#cb35-638" aria-hidden="true" tabindex="-1"></a>In the Twitter discussion that followed this post, <span class="co">[</span><span class="ot">Mike DeCrescenzo</span><span class="co">](https://mikedecr.github.io/)</span> made a <span class="co">[</span><span class="ot">fascinating point</span><span class="co">](https://twitter.com/mikedecr/status/1090416939917340672)</span> that relying on regression for t-test-like analysis with Bayesianism actually has important theoretical implications.</span>
<span id="cb35-639"><a href="#cb35-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-640"><a href="#cb35-640" aria-hidden="true" tabindex="-1"></a>When specifying a model as <span class="in">`y ~ a + bx`</span> as we did above with <span class="in">`rating ~ genre`</span>, the coefficient for genre (<span class="in">`b`</span>) is actually the difference in means and doesn’t directly reflect the rating itself. In theory, if</span>
<span id="cb35-641"><a href="#cb35-641" aria-hidden="true" tabindex="-1"></a>we’re thinking about two groups with two different variances, we should model the distribution of each group, not the distribution of the differences in groups. Analyzing the distributions of the two groups separately and *then* calculating the difference should yield more transparent results. Plus it’s easier to think about setting priors on two variables that were measured in real life (e.g.&nbsp;ratings for comedies and action movies), rather than setting priors on whatever the difference between those looks like.</span>
<span id="cb35-642"><a href="#cb35-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-643"><a href="#cb35-643" aria-hidden="true" tabindex="-1"></a>The raw Stan code above does this correctly by feeding two groups into the model rather than the difference in means. <span class="co">[</span><span class="ot">TJ Mahr</span><span class="co">](https://twitter.com/tjmahr/status/1090417050600816641?s=21)</span> and <span class="co">[</span><span class="ot">Solomon Kurz’s translation of Kruschke’s code into **brms**</span><span class="co">](https://github.com/ASKurz/Doing-Bayesian-Data-Analysis-in-brms-and-the-tidyverse)</span> (<span class="co">[</span><span class="ot">see near the bottom of chapter 16</span><span class="co">](https://github.com/ASKurz/Doing-Bayesian-Data-Analysis-in-brms-and-the-tidyverse/blob/master/16.Rmd)</span>) both show that we can do this with **brms** by changing the formula slightly. If we suppress the intercept by running a model like `ratiing ~ 0 + genre`, **brms** returns coefficients for each of the groups (no more base case!), and these coefficients represent group means.</span>
<span id="cb35-644"><a href="#cb35-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-645"><a href="#cb35-645" aria-hidden="true" tabindex="-1"></a>Here’s an intercept-free version of the **brms**-based BEST regression from earlier. Note how we’re modeling both the rating and the group sigmas without intercepts (<span class="in">`rating ~ 0 + genre, sigma ~ 0 + genre`</span>), and that we no longer specify a prior for the intercept (if we do, <span class="in">`brm()`</span> yells at us). Also note that instead of modeling the beta coefficient as a normal distribution centered around zero (since that represented the difference in means), we specify the distribution of action and comedy ratings themselves. Because we’re dealing with actual ratings, we can make them fairly well informed and constrained. For instance, no movie is rated below 1 or above 10, and I’m guessing from past experience looking at ratings on Amazon and IMDB and elsewhere that people tend to inflate their ratings. I’d guess that the distribution of ratings looks something like this: normally distributed with a mean of 6, standard deviation of 2, and truncated at 1 and 10.</span>
<span id="cb35-646"><a href="#cb35-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-647"><a href="#cb35-647" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-648"><a href="#cb35-648" aria-hidden="true" tabindex="-1"></a><span class="co"># Cool extra thing I discovered: the msm library has rtnorm, dtnorm, and family</span></span>
<span id="cb35-649"><a href="#cb35-649" aria-hidden="true" tabindex="-1"></a><span class="co"># which let you plot and draw from a truncated normal distribution</span></span>
<span id="cb35-650"><a href="#cb35-650" aria-hidden="true" tabindex="-1"></a><span class="co"># msm::rtnorm(1000, mean = 6, sd = 2, lower = 1, upper = 10)</span></span>
<span id="cb35-651"><a href="#cb35-651" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>)), <span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb35-652"><a href="#cb35-652" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm, <span class="at">n =</span> <span class="dv">500</span>, <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="dv">6</span>, <span class="at">sd =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb35-653"><a href="#cb35-653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"normal(6, 2); truncated at 1 and 10"</span>) <span class="sc">+</span></span>
<span id="cb35-654"><a href="#cb35-654" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_fancy</span>()</span>
<span id="cb35-655"><a href="#cb35-655" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-656"><a href="#cb35-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-657"><a href="#cb35-657" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=FALSE}</span></span>
<span id="cb35-658"><a href="#cb35-658" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Normal distribution, truncated"</span></span>
<span id="cb35-659"><a href="#cb35-659" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("dist-ratings-1.png")</span></span>
<span id="cb35-660"><a href="#cb35-660" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-661"><a href="#cb35-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-662"><a href="#cb35-662" aria-hidden="true" tabindex="-1"></a>Now we can run the model like normal:</span>
<span id="cb35-663"><a href="#cb35-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-664"><a href="#cb35-664" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-665"><a href="#cb35-665" aria-hidden="true" tabindex="-1"></a>brms_uneq_robust_groups <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb35-666"><a href="#cb35-666" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(rating <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> genre, sigma <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> genre), </span>
<span id="cb35-667"><a href="#cb35-667" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> student,</span>
<span id="cb35-668"><a href="#cb35-668" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">mutate</span>(movies_clean, <span class="at">genre =</span> <span class="fu">fct_rev</span>(genre)),</span>
<span id="cb35-669"><a href="#cb35-669" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(</span>
<span id="cb35-670"><a href="#cb35-670" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set group mean prior</span></span>
<span id="cb35-671"><a href="#cb35-671" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_prior</span>(<span class="st">"normal(6, 2)"</span>, <span class="at">class =</span> <span class="st">"b"</span>, <span class="at">lb =</span> <span class="dv">1</span>, <span class="at">ub =</span> <span class="dv">10</span>),</span>
<span id="cb35-672"><a href="#cb35-672" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ser group variance priors. We keep the less informative cauchy(0, 1).</span></span>
<span id="cb35-673"><a href="#cb35-673" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_prior</span>(<span class="st">"cauchy(0, 1)"</span>, <span class="at">class =</span> <span class="st">"b"</span>, <span class="at">dpar =</span> <span class="st">"sigma"</span>),</span>
<span id="cb35-674"><a href="#cb35-674" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_prior</span>(<span class="st">"exponential(1.0/29)"</span>, <span class="at">class =</span> <span class="st">"nu"</span>)),</span>
<span id="cb35-675"><a href="#cb35-675" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> CHAINS, <span class="at">iter =</span> ITER, <span class="at">warmup =</span> WARMUP, <span class="at">seed =</span> BAYES_SEED,</span>
<span id="cb35-676"><a href="#cb35-676" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"cache/brms_uneq_robust_groups"</span></span>
<span id="cb35-677"><a href="#cb35-677" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-678"><a href="#cb35-678" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-679"><a href="#cb35-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-680"><a href="#cb35-680" aria-hidden="true" tabindex="-1"></a>We still need to exponentiate the sigma coefficients when we’re done.</span>
<span id="cb35-681"><a href="#cb35-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-682"><a href="#cb35-682" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-683"><a href="#cb35-683" aria-hidden="true" tabindex="-1"></a>brms_uneq_robust_groups_tidy <span class="ot">&lt;-</span> </span>
<span id="cb35-684"><a href="#cb35-684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidyMCMC</span>(brms_uneq_robust_groups, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, </span>
<span id="cb35-685"><a href="#cb35-685" aria-hidden="true" tabindex="-1"></a>           <span class="at">estimate.method =</span> <span class="st">"median"</span>, <span class="at">conf.method =</span> <span class="st">"HPDinterval"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-686"><a href="#cb35-686" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rescale sigmas</span></span>
<span id="cb35-687"><a href="#cb35-687" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(estimate, std.error, conf.low, conf.high),</span>
<span id="cb35-688"><a href="#cb35-688" aria-hidden="true" tabindex="-1"></a>            <span class="fu">funs</span>(<span class="fu">ifelse</span>(<span class="fu">str_detect</span>(term, <span class="st">"sigma"</span>), <span class="fu">exp</span>(.), .)))</span>
<span id="cb35-689"><a href="#cb35-689" aria-hidden="true" tabindex="-1"></a>brms_uneq_robust_groups_tidy</span>
<span id="cb35-690"><a href="#cb35-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-691"><a href="#cb35-691" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 5 x 5</span></span>
<span id="cb35-692"><a href="#cb35-692" aria-hidden="true" tabindex="-1"></a><span class="do">##   term                estimate std.error conf.low conf.high</span></span>
<span id="cb35-693"><a href="#cb35-693" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb35-694"><a href="#cb35-694" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 b_genreComedy           5.99     0.109     5.77      6.19</span></span>
<span id="cb35-695"><a href="#cb35-695" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 b_genreAction           5.30     0.107     5.09      5.50</span></span>
<span id="cb35-696"><a href="#cb35-696" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 b_sigma_genreComedy     1.47     1.06      1.30      1.65</span></span>
<span id="cb35-697"><a href="#cb35-697" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 b_sigma_genreAction     1.47     1.06      1.31      1.62</span></span>
<span id="cb35-698"><a href="#cb35-698" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 nu                     29.9     28.1       6.00     92.7</span></span>
<span id="cb35-699"><a href="#cb35-699" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-700"><a href="#cb35-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-701"><a href="#cb35-701" aria-hidden="true" tabindex="-1"></a>Because we calculated the group means themselves, we need to do an extra few steps to get the difference in means. It’s fairly easy: we extract the posterior samples for each of the groups, subtract them from each other, and then calculate the credible interval.</span>
<span id="cb35-702"><a href="#cb35-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-703"><a href="#cb35-703" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-704"><a href="#cb35-704" aria-hidden="true" tabindex="-1"></a>brms_uneq_robust_groups_post <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(brms_uneq_robust_groups) <span class="sc">%&gt;%</span> </span>
<span id="cb35-705"><a href="#cb35-705" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We can exponentiate here!</span></span>
<span id="cb35-706"><a href="#cb35-706" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">contains</span>(<span class="st">"sigma"</span>)), <span class="fu">funs</span>(exp)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-707"><a href="#cb35-707" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For whatever reason, we need to log nu?</span></span>
<span id="cb35-708"><a href="#cb35-708" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nu =</span> <span class="fu">log10</span>(nu)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-709"><a href="#cb35-709" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_means =</span> b_genreAction <span class="sc">-</span> b_genreComedy,</span>
<span id="cb35-710"><a href="#cb35-710" aria-hidden="true" tabindex="-1"></a>         <span class="at">diff_sigma =</span> b_sigma_genreAction <span class="sc">-</span> b_sigma_genreComedy) <span class="sc">%&gt;%</span> </span>
<span id="cb35-711"><a href="#cb35-711" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate effect sizes, just for fun</span></span>
<span id="cb35-712"><a href="#cb35-712" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cohen_d =</span> diff_means <span class="sc">/</span> <span class="fu">sqrt</span>((b_sigma_genreAction <span class="sc">+</span> b_sigma_genreComedy)<span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb35-713"><a href="#cb35-713" aria-hidden="true" tabindex="-1"></a>         <span class="at">cles =</span> <span class="fu">dnorm</span>(diff_means <span class="sc">/</span> <span class="fu">sqrt</span>((b_sigma_genreAction <span class="sc">+</span> b_sigma_genreComedy)), <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb35-714"><a href="#cb35-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-715"><a href="#cb35-715" aria-hidden="true" tabindex="-1"></a>brms_uneq_robust_groups_tidy_fixed <span class="ot">&lt;-</span> </span>
<span id="cb35-716"><a href="#cb35-716" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidyMCMC</span>(brms_uneq_robust_groups_post, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, </span>
<span id="cb35-717"><a href="#cb35-717" aria-hidden="true" tabindex="-1"></a>           <span class="at">estimate.method =</span> <span class="st">"median"</span>, <span class="at">conf.method =</span> <span class="st">"HPDinterval"</span>)</span>
<span id="cb35-718"><a href="#cb35-718" aria-hidden="true" tabindex="-1"></a>brms_uneq_robust_groups_tidy_fixed</span>
<span id="cb35-719"><a href="#cb35-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-720"><a href="#cb35-720" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 9 x 5</span></span>
<span id="cb35-721"><a href="#cb35-721" aria-hidden="true" tabindex="-1"></a><span class="do">##   term                estimate std.error conf.low conf.high</span></span>
<span id="cb35-722"><a href="#cb35-722" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb35-723"><a href="#cb35-723" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 b_genreComedy        5.99       0.109     5.77      6.19 </span></span>
<span id="cb35-724"><a href="#cb35-724" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 b_genreAction        5.30       0.107     5.09      5.50 </span></span>
<span id="cb35-725"><a href="#cb35-725" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 b_sigma_genreComedy  1.47       0.0882    1.30      1.64 </span></span>
<span id="cb35-726"><a href="#cb35-726" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 b_sigma_genreAction  1.47       0.0826    1.31      1.62 </span></span>
<span id="cb35-727"><a href="#cb35-727" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 nu                   1.48       0.287     0.963     2.04 </span></span>
<span id="cb35-728"><a href="#cb35-728" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 diff_means          -0.690      0.151    -1.01     -0.415</span></span>
<span id="cb35-729"><a href="#cb35-729" aria-hidden="true" tabindex="-1"></a><span class="do">## 7 diff_sigma           0.00100    0.111    -0.212     0.217</span></span>
<span id="cb35-730"><a href="#cb35-730" aria-hidden="true" tabindex="-1"></a><span class="do">## 8 cohen_d             -0.571      0.126    -0.818    -0.327</span></span>
<span id="cb35-731"><a href="#cb35-731" aria-hidden="true" tabindex="-1"></a><span class="do">## 9 cles                 0.368      0.0132    0.341     0.391</span></span>
<span id="cb35-732"><a href="#cb35-732" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-733"><a href="#cb35-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-734"><a href="#cb35-734" aria-hidden="true" tabindex="-1"></a>And voila! Difference in means based on priors on individual group means rather than differences in groups!</span>
<span id="cb35-735"><a href="#cb35-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-736"><a href="#cb35-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-737"><a href="#cb35-737" aria-hidden="true" tabindex="-1"></a><span class="fu">## Comparing all methods</span></span>
<span id="cb35-738"><a href="#cb35-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-739"><a href="#cb35-739" aria-hidden="true" tabindex="-1"></a>Holy cow, that’s a lot of code. We can compare the output from all these different methods in a single plot. In this case, since both groups are pretty normally distributed already and there were no outliers, there isn’t much variation at all in the results—all the different methods show essentially the same thing. We can legally interpret the Bayesian results using credible intervals and probabilities; with the classical t-tests, we still have to talk about null hypotheses. But in the end, the results are nearly identical (but that’s definitely not always the case).</span>
<span id="cb35-740"><a href="#cb35-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-741"><a href="#cb35-741" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb35-742"><a href="#cb35-742" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a bunch of data frames that have three columns: </span></span>
<span id="cb35-743"><a href="#cb35-743" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate, conf.low, and conf.high</span></span>
<span id="cb35-744"><a href="#cb35-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-745"><a href="#cb35-745" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract t-test results</span></span>
<span id="cb35-746"><a href="#cb35-746" aria-hidden="true" tabindex="-1"></a>t_test_eq_small <span class="ot">&lt;-</span> t_test_eq_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb35-747"><a href="#cb35-747" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb35-748"><a href="#cb35-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-749"><a href="#cb35-749" aria-hidden="true" tabindex="-1"></a>t_test_uneq_small <span class="ot">&lt;-</span> t_test_uneq_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb35-750"><a href="#cb35-750" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb35-751"><a href="#cb35-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-752"><a href="#cb35-752" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract simulation results</span></span>
<span id="cb35-753"><a href="#cb35-753" aria-hidden="true" tabindex="-1"></a>infer_simulation <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">estimate =</span> diff_means<span class="sc">$</span>stat,</span>
<span id="cb35-754"><a href="#cb35-754" aria-hidden="true" tabindex="-1"></a>                           <span class="at">conf.low =</span> boostrapped_confint<span class="sc">$</span><span class="st">`</span><span class="at">2.5%</span><span class="st">`</span>,</span>
<span id="cb35-755"><a href="#cb35-755" aria-hidden="true" tabindex="-1"></a>                           <span class="at">conf.high =</span> boostrapped_confint<span class="sc">$</span><span class="st">`</span><span class="at">97.5%</span><span class="st">`</span>)</span>
<span id="cb35-756"><a href="#cb35-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-757"><a href="#cb35-757" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract brms regression results</span></span>
<span id="cb35-758"><a href="#cb35-758" aria-hidden="true" tabindex="-1"></a>brms_eq_small <span class="ot">&lt;-</span> brms_eq_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb35-759"><a href="#cb35-759" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"b_genreAction"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-760"><a href="#cb35-760" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb35-761"><a href="#cb35-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-762"><a href="#cb35-762" aria-hidden="true" tabindex="-1"></a>brms_uneq_small <span class="ot">&lt;-</span> brms_uneq_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb35-763"><a href="#cb35-763" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"b_genreAction"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-764"><a href="#cb35-764" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb35-765"><a href="#cb35-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-766"><a href="#cb35-766" aria-hidden="true" tabindex="-1"></a>brms_uneq_robust_small <span class="ot">&lt;-</span> brms_uneq_robust_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb35-767"><a href="#cb35-767" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"b_genreAction"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-768"><a href="#cb35-768" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb35-769"><a href="#cb35-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-770"><a href="#cb35-770" aria-hidden="true" tabindex="-1"></a>brms_uneq_robust_groups_small <span class="ot">&lt;-</span> brms_uneq_robust_groups_tidy_fixed <span class="sc">%&gt;%</span> </span>
<span id="cb35-771"><a href="#cb35-771" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"diff_means"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-772"><a href="#cb35-772" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb35-773"><a href="#cb35-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-774"><a href="#cb35-774" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract Stan results</span></span>
<span id="cb35-775"><a href="#cb35-775" aria-hidden="true" tabindex="-1"></a>stan_best_small <span class="ot">&lt;-</span> stan_best_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb35-776"><a href="#cb35-776" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"mu_diff"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-777"><a href="#cb35-777" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(estimate, conf.low, conf.high)</span>
<span id="cb35-778"><a href="#cb35-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-779"><a href="#cb35-779" aria-hidden="true" tabindex="-1"></a><span class="co"># Put all these mini dataframes into a list column, then unnest</span></span>
<span id="cb35-780"><a href="#cb35-780" aria-hidden="true" tabindex="-1"></a>meta_diffs <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb35-781"><a href="#cb35-781" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>package, <span class="sc">~</span>method, <span class="sc">~</span>results,</span>
<span id="cb35-782"><a href="#cb35-782" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t-test"</span>, <span class="st">"equal variances"</span>, t_test_eq_small,</span>
<span id="cb35-783"><a href="#cb35-783" aria-hidden="true" tabindex="-1"></a>  <span class="st">"t-test"</span>, <span class="st">"unequal variances"</span>, t_test_uneq_small,</span>
<span id="cb35-784"><a href="#cb35-784" aria-hidden="true" tabindex="-1"></a>  <span class="st">"infer"</span>, <span class="st">"simulation"</span>, infer_simulation,</span>
<span id="cb35-785"><a href="#cb35-785" aria-hidden="true" tabindex="-1"></a>  <span class="st">"brms"</span>, <span class="st">"equal variances"</span>, brms_eq_small,</span>
<span id="cb35-786"><a href="#cb35-786" aria-hidden="true" tabindex="-1"></a>  <span class="st">"brms"</span>, <span class="st">"unequal variances"</span>, brms_uneq_small,</span>
<span id="cb35-787"><a href="#cb35-787" aria-hidden="true" tabindex="-1"></a>  <span class="st">"brms"</span>, <span class="st">"BEST"</span>, brms_uneq_robust_small,</span>
<span id="cb35-788"><a href="#cb35-788" aria-hidden="true" tabindex="-1"></a>  <span class="st">"brms"</span>, <span class="st">"BEST; group means"</span>, brms_uneq_robust_groups_small,</span>
<span id="cb35-789"><a href="#cb35-789" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Stan"</span>, <span class="st">"BEST"</span>, stan_best_small</span>
<span id="cb35-790"><a href="#cb35-790" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-791"><a href="#cb35-791" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(results) <span class="sc">%&gt;%</span> </span>
<span id="cb35-792"><a href="#cb35-792" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="fu">paste0</span>(package, <span class="st">": "</span>, method)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-793"><a href="#cb35-793" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="fu">fct_inorder</span>(method))</span>
<span id="cb35-794"><a href="#cb35-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-795"><a href="#cb35-795" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(meta_diffs, <span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">y =</span> <span class="fu">fct_rev</span>(method), <span class="at">color =</span> package)) <span class="sc">+</span></span>
<span id="cb35-796"><a href="#cb35-796" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrangeh</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> conf.low, <span class="at">xmax =</span> conf.high), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb35-797"><a href="#cb35-797" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb35-798"><a href="#cb35-798" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"plasma"</span>, <span class="at">end =</span> <span class="fl">0.9</span>, <span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb35-799"><a href="#cb35-799" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Mean rating for action movies − mean rating for comedies"</span>,</span>
<span id="cb35-800"><a href="#cb35-800" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">caption =</span> <span class="st">"Sample of 400 movies from IMDB"</span>,</span>
<span id="cb35-801"><a href="#cb35-801" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Comedies get higher ratings than action movies"</span>,</span>
<span id="cb35-802"><a href="#cb35-802" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Effect is roughly the same regardless of method used"</span>) <span class="sc">+</span></span>
<span id="cb35-803"><a href="#cb35-803" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb35-804"><a href="#cb35-804" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_fancy</span>() <span class="sc">+</span></span>
<span id="cb35-805"><a href="#cb35-805" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.5</span>)))</span>
<span id="cb35-806"><a href="#cb35-806" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-807"><a href="#cb35-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-808"><a href="#cb35-808" aria-hidden="true" tabindex="-1"></a><span class="al">![Comparison of all methods](compare-everything-1.png)</span></span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p><span class="faux-block">Forked from <a href="https://www.andrewheiss.com/">Andrew Heiss</a></span> # <span class="faux-block"><a href="https://github.com/andrewheiss/ath-quarto">View the source at <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></span></p>
</div>
  </div>
</footer>


</body></html>