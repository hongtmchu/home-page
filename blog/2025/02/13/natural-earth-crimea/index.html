<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Andrew Heiss">
<meta name="description" content="Natural Earth’s de facto on-the-ground policy conflicts with de jure boundaries. Use {sf} and R to relocate parts of country shapes.">
<title>How to move Crimea from Russia to Ukraine in maps with R | Andrew Heiss – Andrew Heiss</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../../">
<link href="../../../../..//files/favicon-512.png" rel="icon" type="image/png">
<script src="../../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting-17c909d5fd25ae21b861c0c7a49b2096.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../site_libs/bootstrap/bootstrap-5cd0811f461c8271ae6bab49df9501be.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script src="../../../../../site_libs/quarto-contrib/iconify-2.0.0/iconify-icon.min.js"></script><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-527449-5', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script><style>

      .quarto-title-block .quarto-title-banner {
        background: #170C3A;
      }
</style>
<script type="module" src="../../../../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script><link href="../../../../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<style type="text/css">
div.sourceCode > pre.sourceCode.js::before {
  content: 'Observable JS';
  display: block;
  text-align: left;
  font-size: 1em;
  margin-bottom: 7px;
  border-bottom: #4c4c4c 1px solid;
  padding-left: 4.25px;
  padding-bottom: 5px;
  color: #aaaaaa;
}

div.sourceCode > pre.sourceCode.r::before {
  content: 'R';
  display: block;
  text-align: left;
  font-size: 1em;
  margin-bottom: 7px;
  border-bottom: #4c4c4c 1px solid;
  padding-left: 4.25px;
  padding-bottom: 5px;
  color: #aaaaaa;
}
</style>
<meta property="og:title" content="How to move Crimea from Russia to Ukraine in maps with R | Andrew Heiss">
<meta property="og:description" content="Natural Earth’s de facto on-the-ground policy conflicts with de jure boundaries. Use {sf} and R to relocate parts of country shapes.">
<meta property="og:image" content="https://www.andrewheiss.com/blog/2025/02/13/natural-earth-crimea/index_files/figure-html/plot-eastern-europe-50-1.png">
<meta property="og:site_name" content="Andrew Heiss">
<meta property="og:locale" content="en_US">
<meta property="og:image:height" content="1067">
<meta property="og:image:width" content="1728">
<meta name="twitter:title" content="How to move Crimea from Russia to Ukraine in maps with R | Andrew Heiss">
<meta name="twitter:description" content="Natural Earth’s de facto on-the-ground policy conflicts with de jure boundaries. Use {sf} and R to relocate parts of country shapes.">
<meta name="twitter:image" content="https://www.andrewheiss.com/blog/2025/02/13/natural-earth-crimea/index_files/figure-html/plot-eastern-europe-50-1.png">
<meta name="twitter:creator" content="@andrewheiss">
<meta name="twitter:site" content="@andrewheiss">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image-height" content="1067">
<meta name="twitter:image-width" content="1728">
</head>
<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../../index.html">
    <span class="navbar-title">Andrew Heiss</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../../../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../cv/index.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../research/index.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../teaching/index.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../talks/index.html"> 
<span class="menu-text">Talks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../now/index.html"> 
<span class="menu-text">Now</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../uses/index.html"> 
<span class="menu-text">Uses</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../../../../../atom.xml"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:rss" style="font-size: 1.1em;" aria-label="Icon rss from bi Iconify.design set." title="RSS"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="mailto:aheiss@gsu.edu"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:envelope" style="font-size: 1.1em;" aria-label="Icon envelope from bi Iconify.design set." title="E-mail"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://bsky.app/profile/andrew.heiss.phd" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="fa6-brands:bluesky" style="font-size: 1.1em;" aria-label="Icon bluesky from fa6-brands Iconify.design set." title="Bluesky"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://fediscience.org/users/andrew/" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:mastodon" style="font-size: 1.1em;" aria-label="Icon mastodon from bi Iconify.design set." title="Mastodon"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/andrewheiss" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:github" style="font-size: 1.1em;" aria-label="Icon github from bi Iconify.design set." title="GitHub"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.youtube.com/andrewheiss" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:youtube" style="font-size: 1.1em;" aria-label="Icon youtube from bi Iconify.design set." title="YouTube"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.heissatopia.com/"> 
<span class="menu-text"><iconify-icon inline="" icon="fa6-brands:blogger" style="font-size: 1.15em;" aria-label="Icon blogger from fa6-brands Iconify.design set." title="Blogger"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/andrewheiss" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:linkedin" style="font-size: 1.1em;" aria-label="Icon linkedin from bi Iconify.design set." title="LinkedIn"></iconify-icon></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default blog-post page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">How to move Crimea from Russia to Ukraine in maps with R</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
                  <div>
        <div class="description">
          Natural Earth’s de facto on-the-ground policy conflicts with de jure boundaries. Use {sf} and R to relocate parts of country shapes.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">r</div>
                <div class="quarto-category">tidyverse</div>
                <div class="quarto-category">ggplot</div>
                <div class="quarto-category">ojs</div>
                <div class="quarto-category">observable plot</div>
                <div class="quarto-category">gis</div>
                <div class="quarto-category">maps</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://www.andrewheiss.com/">Andrew Heiss</a> <a href="https://orcid.org/0000-0002-3948-3914" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">Thursday, February 13, 2025</p>
      </div>
    </div>
    
      
      <div>
      <div class="quarto-title-meta-heading">Doi</div>
      <div class="quarto-title-meta-contents">
        <p class="doi">
          <a href="https://doi.org/10.59350/28kp0-nbq92">10.59350/28kp0-nbq92</a>
        </p>
      </div>
    </div>
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Contents</h2>
   
  <ul>
<li>
<a href="#the-natural-earth-project" id="toc-the-natural-earth-project" class="nav-link active" data-scroll-target="#the-natural-earth-project">The Natural Earth Project</a>
  <ul class="collapse">
<li><a href="#natural-earths-de-facto-policy" id="toc-natural-earths-de-facto-policy" class="nav-link" data-scroll-target="#natural-earths-de-facto-policy">Natural Earth’s <em>de facto</em> policy</a></li>
  <li><a href="#natural-earth-de-jure-points-of-view" id="toc-natural-earth-de-jure-points-of-view" class="nav-link" data-scroll-target="#natural-earth-de-jure-points-of-view">Natural Earth <em>de jure</em> points of view</a></li>
  </ul>
</li>
  <li>
<a href="#relocating-crimea-manually-with-r-and-sf" id="toc-relocating-crimea-manually-with-r-and-sf" class="nav-link" data-scroll-target="#relocating-crimea-manually-with-r-and-sf">Relocating Crimea manually with R and {sf}</a>
  <ul class="collapse">
<li><a href="#identifying-the-crimea-polygon-from-a-point" id="toc-identifying-the-crimea-polygon-from-a-point" class="nav-link" data-scroll-target="#identifying-the-crimea-polygon-from-a-point">Identifying the Crimea POLYGON from a POINT</a></li>
  <li><a href="#extracting-the-crimea-polygon-from-russia" id="toc-extracting-the-crimea-polygon-from-russia" class="nav-link" data-scroll-target="#extracting-the-crimea-polygon-from-russia">Extracting the Crimea POLYGON from Russia</a></li>
  <li><a href="#adding-the-crimea-polygon-to-ukraine" id="toc-adding-the-crimea-polygon-to-ukraine" class="nav-link" data-scroll-target="#adding-the-crimea-polygon-to-ukraine">Adding the Crimea POLYGON to Ukraine</a></li>
  <li><a href="#updating-russia-and-ukraine-in-the-full-data" id="toc-updating-russia-and-ukraine-in-the-full-data" class="nav-link" data-scroll-target="#updating-russia-and-ukraine-in-the-full-data">Updating Russia and Ukraine in the full data</a></li>
  <li><a href="#the-whole-game" id="toc-the-whole-game" class="nav-link" data-scroll-target="#the-whole-game">The whole game</a></li>
  <li><a href="#moving-crimea-with-medium-resolution-50m-data" id="toc-moving-crimea-with-medium-resolution-50m-data" class="nav-link" data-scroll-target="#moving-crimea-with-medium-resolution-50m-data">Moving Crimea with medium resolution (50m) data</a></li>
  </ul>
</li>
  <li>
<a href="#using-the-adjusted-natural-earth-data-as-geojson-in-observable-js" id="toc-using-the-adjusted-natural-earth-data-as-geojson-in-observable-js" class="nav-link" data-scroll-target="#using-the-adjusted-natural-earth-data-as-geojson-in-observable-js">Using the adjusted Natural Earth data as GeoJSON in Observable JS</a>
  <ul class="collapse">
<li><a href="#broken-geojson" id="toc-broken-geojson" class="nav-link" data-scroll-target="#broken-geojson">Broken GeoJSON</a></li>
  <li><a href="#geojson-and-winding-order" id="toc-geojson-and-winding-order" class="nav-link" data-scroll-target="#geojson-and-winding-order">GeoJSON and ↻ ↺ winding order ↻ ↺</a></li>
  <li><a href="#clean-geojson-with-correct-winding-order" id="toc-clean-geojson-with-correct-winding-order" class="nav-link" data-scroll-target="#clean-geojson-with-correct-winding-order">Clean GeoJSON with correct winding order</a></li>
  </ul>
</li>
  <li>
<a href="#alternative-data-sources" id="toc-alternative-data-sources" class="nav-link" data-scroll-target="#alternative-data-sources">Alternative data sources</a>
  <ul class="collapse">
<li><a href="#gisco" id="toc-gisco" class="nav-link" data-scroll-target="#gisco">GISCO</a></li>
  <li><a href="#visionscarto" id="toc-visionscarto" class="nav-link" data-scroll-target="#visionscarto">Visionscarto</a></li>
  <li><a href="#less-automatic-sources" id="toc-less-automatic-sources" class="nav-link" data-scroll-target="#less-automatic-sources">Less automatic sources</a></li>
  </ul>
</li>
  </ul></nav>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content"><section id="the-natural-earth-project" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="the-natural-earth-project">The Natural Earth Project</h2>
<p>The <a href="https://www.naturalearthdata.com/downloads/">Natural Earth Project</a> provides high quality public domain geographic data with all sorts of incredible detail, at three resolutions: high (1:10m), medium (1:50m), and low (1:110m). I use their data all the time in my own work and research, and <a href="http://ropensci.github.io/rnaturalearth/">the {rnaturalearth} package</a> makes it really easy to get their data into R for immediate mapping. I mean, look at this!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rnaturalearth/">rnaturalearth</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set some colors</span></span>
<span><span class="va">ukr_blue</span> <span class="op">&lt;-</span> <span class="st">"#0057b7"</span>  <span class="co"># Blue from the Ukrainian flag</span></span>
<span><span class="va">ukr_yellow</span> <span class="op">&lt;-</span> <span class="st">"#ffdd00"</span>  <span class="co"># Yellow from the Ukrainian flag</span></span>
<span><span class="va">rus_red</span> <span class="op">&lt;-</span> <span class="st">"#d62718"</span>  <span class="co"># Red from the Russian flag</span></span>
<span></span>
<span><span class="va">clr_ocean</span> <span class="op">&lt;-</span> <span class="st">"#d9f0ff"</span></span>
<span><span class="va">clr_land</span> <span class="op">&lt;-</span> <span class="st">"#facba6"</span></span>
<span></span>
<span><span class="co"># CARTOColors Prism (https://carto.com/carto-colors/)</span></span>
<span><span class="va">carto_prism</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"#5F4690"</span>, <span class="st">"#1D6996"</span>, <span class="st">"#38A6A5"</span>, <span class="st">"#0F8554"</span>, <span class="st">"#73AF48"</span>, <span class="st">"#EDAD08"</span>, </span>
<span>  <span class="st">"#E17C05"</span>, <span class="st">"#CC503E"</span>, <span class="st">"#94346E"</span>, <span class="st">"#6F4070"</span>, <span class="st">"#994E95"</span>, <span class="st">"#666666"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ne_countries</span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">110</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">admin</span> <span class="op">!=</span> <span class="st">"Antarctica"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">continent</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"white"</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">carto_prism</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>crs <span class="op">=</span> <span class="st">"+proj=robin"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-natural-earth-world-map-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<section id="natural-earths-de-facto-policy" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="natural-earths-de-facto-policy">Natural Earth’s <em>de facto</em> policy</h3>
<p><strong>Maps are intensely political things.</strong> There are dozens of disputes over maps and land and territories (e.g., Palestine, Western Sahara, Northern Cyprus, Taiwan, Kashmir, etc.), and many UN member states don’t recognize other UN member states (<a href="https://en.wikipedia.org/wiki/International_recognition_of_Israel">Israel isn’t recognized by many Arab states</a>; <a href="https://en.wikipedia.org/wiki/Armenia%E2%80%93Pakistan_relations">Pakistan doesn’t recognize Armenia</a>).</p>
<p>The Natural Earth Project’s <a href="https://www.naturalearthdata.com/about/disputed-boundaries-policy/">official policy for disputed territories</a> is to reflect on-the-ground <em>de facto</em> <a href="https://www.naturalearthdata.com/downloads/10m-cultural-vectors/10m-admin-0-details/">control over each piece of land</a><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>:</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;<a href="https://osmfoundation.org/w/images/d/d8/DisputedTerritoriesInformation.pdf">OpenStreetMap does this too</a>.</p></div></div><blockquote class="blockquote">
<p>Natural Earth Vector draws boundaries of sovereign states according to defacto status. We show who actually controls the situation on the ground. For instance, we show China and Taiwan as two separate states. But we show Palestine as part of Israel.</p>
</blockquote>
<p>Though <a href="https://www.naturalearthdata.com/about/disputed-boundaries-policy/">they claim that this <em>de facto</em> policy “is rigorous and self consistent”</a>, it gets them in trouble a lot. For instance, there are nearly <a href="https://github.com/search?q=repo:nvkelso/natural-earth-vector+crimea&amp;type=issues">two dozen issues on GitHub</a> about Crimea, which is <a href="https://en.wikipedia.org/wiki/Annexation_of_Crimea_by_the_Russian_Federation">illegally occupied by Russia</a> but <a href="https://en.wikipedia.org/wiki/Russian_occupation_of_Crimea#Annexation"><em>de jure</em> part of Ukraine</a>. <a href="https://github.com/nvkelso/natural-earth-vector/issues/391">There</a> <a href="https://github.com/nvkelso/natural-earth-vector/issues/489">are</a> <a href="https://github.com/nvkelso/natural-earth-vector/issues/926">huge</a> <a href="https://github.com/nvkelso/natural-earth-vector/issues/810">debates</a> <a href="https://github.com/nvkelso/natural-earth-vector/issues/812">over</a> the ethics of the <em>de facto</em> policy.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Treating the Natural Earth <em>de facto</em> policy as a <em>de facto</em> policy
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>I’m not weighing in on that policy here!</strong> I don’t super like it—it makes it really hard to map Palestine, for instance—but it is what it is. In this post I’m treating the <em>de facto</em> policy as the <em>de facto</em> situation of the data.</p>
</div>
</div>
</section><section id="natural-earth-de-jure-points-of-view" class="level3"><h3 class="anchored" data-anchor-id="natural-earth-de-jure-points-of-view">Natural Earth <em>de jure</em> points of view</h3>
<p>Natural Earth’s solution for disputed territories is to <a href="https://github.com/nvkelso/natural-earth-vector/issues/391#issuecomment-890772203">offer different options</a> to reflect country-specific <em>de jure</em> points of view. They offer <a href="https://www.naturalearthdata.com/blog/admin-0-countries-point-of-views/">pre-built high resolution shapefiles for 31 different points of views</a>, so it’s possible to download data that reflect <em>de jure</em> boundaries for a bunch of different countries. Their other shapefiles <a href="https://github.com/nvkelso/natural-earth-vector/blob/master/packages/Natural_Earth_quick_start/LOCALIZATION.md#setting-boundary-pov">all have columns like <code>fclass_us</code>, <code>fclass_ua</code>, and so on</a> for doing… something?… with the point of view. <strong>I can’t figure out how these columns work</strong> beyond localization stuff (i.e.&nbsp;changing place names based on the point of view). The documentation doesn’t say much about how to actually use these different points of view, and <a href="https://github.com/nvkelso/natural-earth-vector/issues/875#issuecomment-1726400482">pre-built medium and low resolution maps don’t exist yet</a>.</p>
<p>For example, the US doesn’t <em>de jure</em>-ily recognize the Russian occupation of Crimea, so if we <a href="https://www.naturalearthdata.com/blog/admin-0-countries-point-of-views/">download the pre-built high resolution (10m) version of the world</a> from the US point of view, we can see Crimea as part of Ukraine (we have to <a href="https://www.naturalearthdata.com/blog/admin-0-countries-point-of-views/">download this manually</a>—<code>rnaturalearth::ne_countries()</code> doesn’t support POV files):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">world_10_us</span> <span class="op">&lt;-</span> <span class="fu">read_sf</span><span class="op">(</span><span class="st">"ne_10m_admin_0_countries_usa/ne_10m_admin_0_countries_usa.shp"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">world_10_us</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">ADMIN</span> <span class="op">==</span> <span class="st">"Ukraine"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">ukr_blue</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-ne-us10-ukraine-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>Unfortunately, the pre-built point-of-view datasets <a href="https://github.com/nvkelso/natural-earth-vector/issues/875#issuecomment-1726400482">only exist for the 10m high resolution data</a>. If we want to show medium or low resolution maps, we’re stuck with the <em>de facto</em> version of the map, which means Crimea will be shown as part of Russia. Here’s the low resolution version of Ukraine, with Crimea in Russia:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">world</span> <span class="op">&lt;-</span> <span class="fu">ne_countries</span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">110</span>, type <span class="op">=</span> <span class="st">"map_units"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ukraine</span> <span class="op">&lt;-</span> <span class="va">world</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">admin</span> <span class="op">==</span> <span class="st">"Ukraine"</span><span class="op">)</span></span>
<span><span class="va">russia</span> <span class="op">&lt;-</span> <span class="va">world</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">admin</span> <span class="op">==</span> <span class="st">"Russia"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ukraine_bbox</span> <span class="op">&lt;-</span> <span class="va">ukraine</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_buffer</span><span class="op">(</span>dist <span class="op">=</span> <span class="fl">100000</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># Add 100,000 meter buffer around the country </span></span>
<span>  <span class="fu">st_bbox</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">world</span>, fill <span class="op">=</span> <span class="va">clr_land</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">russia</span>, fill <span class="op">=</span> <span class="va">rus_red</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">ukraine</span>, fill <span class="op">=</span> <span class="va">ukr_blue</span>, color <span class="op">=</span> <span class="va">ukr_yellow</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span></span>
<span>    xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ukraine_bbox</span><span class="op">[</span><span class="st">"xmin"</span><span class="op">]</span>, <span class="va">ukraine_bbox</span><span class="op">[</span><span class="st">"xmax"</span><span class="op">]</span><span class="op">)</span>, </span>
<span>    ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ukraine_bbox</span><span class="op">[</span><span class="st">"ymin"</span><span class="op">]</span>, <span class="va">ukraine_bbox</span><span class="op">[</span><span class="st">"ymax"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_ocean</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-ne-110-crimea-in-russia-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="relocating-crimea-manually-with-r-and-sf" class="level2"><h2 class="anchored" data-anchor-id="relocating-crimea-manually-with-r-and-sf">Relocating Crimea manually with R and {sf}</h2>
<p>Natural Earth’s recommendation is to <a href="https://www.naturalearthdata.com/about/disputed-boundaries-policy/">“mashup our countries and disputed areas themes to match their particular political outlook”</a>, so we’ll do that here. Though we won’t use any of the point-of-view themes or features because I have no idea how to get those to work.</p>
<p>Instead we’ll manipulate the geometry data directly and move Crimea from the Russia shape to the Ukraine shape by extracting the Crimea POLYGON from Russia and merging it with Ukraine.</p>
<p>The actual geometric shapes for all the countries in <code>world</code> are MULTIPOLYGONs, or collections of POLYGON geometric objects. For instance, Russia is defined as a single MULTIPOLYGON:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">russia</span> <span class="op">|&gt;</span> <span class="fu">st_geometry</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## Geometry set for 1 feature </span></span>
<span><span class="co">## Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: -180 ymin: 41.15 xmax: 180 ymax: 81.25</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span>
<span><span class="co">## MULTIPOLYGON (((178.7 71.1, 180 71.52, 180 70.8...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can split MULTIPOLYGONs into their component POLYGONs with <code>st_cast()</code>. Russia consists of 14 different shapes:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">russia_polygons</span> <span class="op">&lt;-</span> <span class="va">russia</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_geometry</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_cast</span><span class="op">(</span><span class="st">"POLYGON"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">russia_polygons</span></span>
<span><span class="co">## Geometry set for 14 features </span></span>
<span><span class="co">## Geometry type: POLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: -180 ymin: 41.15 xmax: 180 ymax: 81.25</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span>
<span><span class="co">## First 5 geometries:</span></span>
<span><span class="co">## POLYGON ((178.7 71.1, 180 71.52, 180 70.83, 178...</span></span>
<span><span class="co">## POLYGON ((49.1 46.4, 48.65 45.81, 47.68 45.64, ...</span></span>
<span><span class="co">## POLYGON ((93.78 81.02, 95.94 81.25, 97.88 80.75...</span></span>
<span><span class="co">## POLYGON ((102.8 79.28, 105.4 78.71, 105.1 78.31...</span></span>
<span><span class="co">## POLYGON ((138.8 76.14, 141.5 76.09, 145.1 75.56...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The second one is the main Russia landmass:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">russia_polygons</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-main-russia-polygon-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>The last one is the Crimean peninsula:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">russia_polygons</span><span class="op">[</span><span class="fl">14</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-crimea-polygon-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<section id="identifying-the-crimea-polygon-from-a-point" class="level3"><h3 class="anchored" data-anchor-id="identifying-the-crimea-polygon-from-a-point">Identifying the Crimea POLYGON from a POINT</h3>
<p>The only way I figured out what of these POLYGONs were was to plot them individually until I saw a recognizable shape. And if I use a different map (like the 50m or 10m resolution maps), there’s no guarantee that Russia will have 14 POLYGONs or that the 14th one will be Crimea. We need a more reliable way to find the Crimea shape.</p>
<p>One way to do this is to create a POINT object based somewhere in Crimea and do some geometric set math to identify which Russian POLYGON contains it. The point <a href="https://maps.app.goo.gl/iEkGZkrEpEcqTmZi7">45°N 34°E</a> happens to be in the middle of Crimea:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">crimea_point</span> <span class="op">&lt;-</span> <span class="fu">st_sfc</span><span class="op">(</span><span class="fu">st_point</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">34</span>, <span class="fl">45</span><span class="op">)</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="va">world</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">world</span>, fill <span class="op">=</span> <span class="va">clr_land</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">russia</span>, fill <span class="op">=</span> <span class="va">rus_red</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">ukraine</span>, fill <span class="op">=</span> <span class="va">ukr_blue</span>, color <span class="op">=</span> <span class="va">ukr_yellow</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">crimea_point</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span></span>
<span>    xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ukraine_bbox</span><span class="op">[</span><span class="st">"xmin"</span><span class="op">]</span>, <span class="va">ukraine_bbox</span><span class="op">[</span><span class="st">"xmax"</span><span class="op">]</span><span class="op">)</span>, </span>
<span>    ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ukraine_bbox</span><span class="op">[</span><span class="st">"ymin"</span><span class="op">]</span>, <span class="va">ukraine_bbox</span><span class="op">[</span><span class="st">"ymax"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_ocean</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-crimea-point-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>We can use it with <code>st_intersects()</code> to identify the Russia POLYGON that contains it:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extract the Russia MULTIPOLYGON and convert it to polygons</span></span>
<span><span class="va">russia_polygons</span> <span class="op">&lt;-</span> <span class="va">world</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">admin</span> <span class="op">==</span> <span class="st">"Russia"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_geometry</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_cast</span><span class="op">(</span><span class="st">"POLYGON"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the Russia polygon that has Crimea in it</span></span>
<span><span class="va">crimea_polygon</span> <span class="op">&lt;-</span> <span class="va">russia_polygons</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">keep</span><span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">st_intersects</span><span class="op">(</span><span class="va">x</span>, <span class="va">crimea_point</span>, sparse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This is the same as russia_polygons[14]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">crimea_polygon</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-extracted-crimea-polygon-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
</section><section id="extracting-the-crimea-polygon-from-russia" class="level3"><h3 class="anchored" data-anchor-id="extracting-the-crimea-polygon-from-russia">Extracting the Crimea POLYGON from Russia</h3>
<p>We can then remove that polygon from Russia and recombine everything back into a MULTIPOLYGON. It works!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Remove Crimea from Russia</span></span>
<span><span class="va">new_russia</span> <span class="op">&lt;-</span> <span class="va">russia_polygons</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">discard</span><span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="fu">st_equals</span><span class="op">(</span><span class="va">x</span>, <span class="va">crimea_polygon</span>, sparse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_combine</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_cast</span><span class="op">(</span><span class="st">"MULTIPOLYGON"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">world</span>, fill <span class="op">=</span> <span class="va">clr_land</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">new_russia</span>, fill <span class="op">=</span> <span class="va">rus_red</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">ukraine</span>, fill <span class="op">=</span> <span class="va">ukr_blue</span>, color <span class="op">=</span> <span class="va">ukr_yellow</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span></span>
<span>    xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ukraine_bbox</span><span class="op">[</span><span class="st">"xmin"</span><span class="op">]</span>, <span class="va">ukraine_bbox</span><span class="op">[</span><span class="st">"xmax"</span><span class="op">]</span><span class="op">)</span>, </span>
<span>    ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ukraine_bbox</span><span class="op">[</span><span class="st">"ymin"</span><span class="op">]</span>, <span class="va">ukraine_bbox</span><span class="op">[</span><span class="st">"ymax"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_ocean</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-crimea-removed-from-russia-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
</section><section id="adding-the-crimea-polygon-to-ukraine" class="level3"><h3 class="anchored" data-anchor-id="adding-the-crimea-polygon-to-ukraine">Adding the Crimea POLYGON to Ukraine</h3>
<p>Next we need to merge <code>crimea_polygon</code> with Ukraine. We’ll convert Ukraine to its component POLYGONs, combine those with Crimea, and recombine everything back to a MULTIPOLYGON. It also works!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extract the Ukraine MULTIPOLYGON and convert it to polygons</span></span>
<span><span class="va">ukraine_polygons</span> <span class="op">&lt;-</span> <span class="va">world</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">admin</span> <span class="op">==</span> <span class="st">"Ukraine"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_geometry</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_cast</span><span class="op">(</span><span class="st">"POLYGON"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add Crimea to Ukraine</span></span>
<span><span class="va">new_ukraine</span> <span class="op">&lt;-</span> <span class="fu">st_union</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ukraine_polygons</span>, <span class="va">crimea_polygon</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">st_cast</span><span class="op">(</span><span class="st">"MULTIPOLYGON"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">world</span>, fill <span class="op">=</span> <span class="va">clr_land</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">new_russia</span>, fill <span class="op">=</span> <span class="va">rus_red</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">new_ukraine</span>, fill <span class="op">=</span> <span class="va">ukr_blue</span>, color <span class="op">=</span> <span class="va">ukr_yellow</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span></span>
<span>    xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ukraine_bbox</span><span class="op">[</span><span class="st">"xmin"</span><span class="op">]</span>, <span class="va">ukraine_bbox</span><span class="op">[</span><span class="st">"xmax"</span><span class="op">]</span><span class="op">)</span>, </span>
<span>    ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ukraine_bbox</span><span class="op">[</span><span class="st">"ymin"</span><span class="op">]</span>, <span class="va">ukraine_bbox</span><span class="op">[</span><span class="st">"ymax"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_ocean</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-crimea-added-to-ukraine-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
</section><section id="updating-russia-and-ukraine-in-the-full-data" class="level3"><h3 class="anchored" data-anchor-id="updating-russia-and-ukraine-in-the-full-data">Updating Russia and Ukraine in the full data</h3>
<p>The last step is to modify the full <code>world</code> dataset and replace the existing geometry values for the two countries with the updated boundaries:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">world_un</span> <span class="op">&lt;-</span> <span class="va">world</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>geometry <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>    <span class="va">admin</span> <span class="op">==</span> <span class="st">"Ukraine"</span> <span class="op">~</span> <span class="va">new_ukraine</span>,</span>
<span>    <span class="va">admin</span> <span class="op">==</span> <span class="st">"Russia"</span> <span class="op">~</span> <span class="va">new_russia</span>,</span>
<span>    .default <span class="op">=</span> <span class="va">geometry</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that <code>world_un</code> has the corrected boundaries in it, it works like normal. Here’s a map of Eastern Europe, colored by <code>mapcolor9</code> (a column that comes with Natural Earth data that lets you use 9 distinct colors to fill all countries without having bordering countries share colors). Crimea is in Ukraine now:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">eastern_eu_bbox</span> <span class="op">&lt;-</span> <span class="va">ukraine</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_buffer</span><span class="op">(</span>dist <span class="op">=</span> <span class="fl">700000</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># Add 700,000 meter buffer around the country </span></span>
<span>  <span class="fu">st_bbox</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">world_un</span>, <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">mapcolor9</span><span class="op">)</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">0.25</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">carto_prism</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span></span>
<span>    xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">eastern_eu_bbox</span><span class="op">[</span><span class="st">"xmin"</span><span class="op">]</span>, <span class="va">eastern_eu_bbox</span><span class="op">[</span><span class="st">"xmax"</span><span class="op">]</span><span class="op">)</span>, </span>
<span>    ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">eastern_eu_bbox</span><span class="op">[</span><span class="st">"ymin"</span><span class="op">]</span>, <span class="va">eastern_eu_bbox</span><span class="op">[</span><span class="st">"ymax"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_ocean</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-eastern-europe-110-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
</section><section id="the-whole-game" class="level3"><h3 class="anchored" data-anchor-id="the-whole-game">The whole game</h3>
<p>Everything above was fairly didactic, with illustrations at each intermediate step. Here’s the whole process all in one place:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">world_110</span> <span class="op">&lt;-</span> <span class="fu">ne_countries</span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">110</span>, type <span class="op">=</span> <span class="st">"map_units"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">crimea_point_110</span> <span class="op">&lt;-</span> <span class="fu">st_sfc</span><span class="op">(</span><span class="fu">st_point</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">34</span>, <span class="fl">45</span><span class="op">)</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="va">world_110</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the Russia MULTIPOLYGON and convert it to polygons</span></span>
<span><span class="va">russia_polygons_110</span> <span class="op">&lt;-</span> <span class="va">world_110</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">admin</span> <span class="op">==</span> <span class="st">"Russia"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_geometry</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_cast</span><span class="op">(</span><span class="st">"POLYGON"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the Russia polygon that has Crimea in it</span></span>
<span><span class="va">crimea_polygon_110</span> <span class="op">&lt;-</span> <span class="va">russia_polygons_110</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">keep</span><span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">st_intersects</span><span class="op">(</span><span class="va">x</span>, <span class="va">crimea_point_110</span>, sparse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove Crimea from Russia</span></span>
<span><span class="va">new_russia_110</span> <span class="op">&lt;-</span> <span class="va">russia_polygons_110</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">discard</span><span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="fu">st_equals</span><span class="op">(</span><span class="va">x</span>, <span class="va">crimea_polygon_110</span>, sparse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_combine</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_cast</span><span class="op">(</span><span class="st">"MULTIPOLYGON"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the Ukraine MULTIPOLYGON and convert it to polygons</span></span>
<span><span class="va">ukraine_polygons_110</span> <span class="op">&lt;-</span> <span class="va">world_110</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">admin</span> <span class="op">==</span> <span class="st">"Ukraine"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_geometry</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_cast</span><span class="op">(</span><span class="st">"POLYGON"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add Crimea to Ukraine</span></span>
<span><span class="va">new_ukraine_110</span> <span class="op">&lt;-</span> <span class="fu">st_union</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ukraine_polygons_110</span>, <span class="va">crimea_polygon_110</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">st_cast</span><span class="op">(</span><span class="st">"MULTIPOLYGON"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">world_un_110</span> <span class="op">&lt;-</span> <span class="va">world_110</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>geometry <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>    <span class="va">admin</span> <span class="op">==</span> <span class="st">"Ukraine"</span> <span class="op">~</span> <span class="va">new_ukraine_110</span>,</span>
<span>    <span class="va">admin</span> <span class="op">==</span> <span class="st">"Russia"</span> <span class="op">~</span> <span class="va">new_russia_110</span>,</span>
<span>    .default <span class="op">=</span> <span class="va">geometry</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="moving-crimea-with-medium-resolution-50m-data" class="level3"><h3 class="anchored" data-anchor-id="moving-crimea-with-medium-resolution-50m-data">Moving Crimea with medium resolution (50m) data</h3>
<p>This same approach works for other map resolutions too, like 50m:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">world_50</span> <span class="op">&lt;-</span> <span class="fu">ne_countries</span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">50</span>, type <span class="op">=</span> <span class="st">"map_units"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">crimea_point_50</span> <span class="op">&lt;-</span> <span class="fu">st_sfc</span><span class="op">(</span><span class="fu">st_point</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">34</span>, <span class="fl">45</span><span class="op">)</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="va">world_50</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the Russia MULTIPOLYGON and convert it to polygons</span></span>
<span><span class="va">russia_polygons_50</span> <span class="op">&lt;-</span> <span class="va">world_50</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">admin</span> <span class="op">==</span> <span class="st">"Russia"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_geometry</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_cast</span><span class="op">(</span><span class="st">"POLYGON"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the Russia polygon that has Crimea in it</span></span>
<span><span class="va">crimea_polygon_50</span> <span class="op">&lt;-</span> <span class="va">russia_polygons_50</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">keep</span><span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">st_intersects</span><span class="op">(</span><span class="va">x</span>, <span class="va">crimea_point_50</span>, sparse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove Crimea from Russia</span></span>
<span><span class="va">new_russia_50</span> <span class="op">&lt;-</span> <span class="va">russia_polygons_50</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">discard</span><span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="fu">st_equals</span><span class="op">(</span><span class="va">x</span>, <span class="va">crimea_polygon_50</span>, sparse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_combine</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_cast</span><span class="op">(</span><span class="st">"MULTIPOLYGON"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the Ukraine MULTIPOLYGON and convert it to polygons</span></span>
<span><span class="va">ukraine_polygons_50</span> <span class="op">&lt;-</span> <span class="va">world_50</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">admin</span> <span class="op">==</span> <span class="st">"Ukraine"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_geometry</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_cast</span><span class="op">(</span><span class="st">"POLYGON"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add Crimea to Ukraine</span></span>
<span><span class="va">new_ukraine_50</span> <span class="op">&lt;-</span> <span class="fu">st_union</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ukraine_polygons_50</span>, <span class="va">crimea_polygon_50</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">st_cast</span><span class="op">(</span><span class="st">"MULTIPOLYGON"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">world_un_50</span> <span class="op">&lt;-</span> <span class="va">world_50</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>geometry <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>    <span class="va">admin</span> <span class="op">==</span> <span class="st">"Ukraine"</span> <span class="op">~</span> <span class="va">new_ukraine_50</span>,</span>
<span>    <span class="va">admin</span> <span class="op">==</span> <span class="st">"Russia"</span> <span class="op">~</span> <span class="va">new_russia_50</span>,</span>
<span>    .default <span class="op">=</span> <span class="va">geometry</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here’s a higher quality map of Eastern Europe with Crimea in Ukraine:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">world_un_50</span>, <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">mapcolor9</span><span class="op">)</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">0.25</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">carto_prism</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span></span>
<span>    xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">eastern_eu_bbox</span><span class="op">[</span><span class="st">"xmin"</span><span class="op">]</span>, <span class="va">eastern_eu_bbox</span><span class="op">[</span><span class="st">"xmax"</span><span class="op">]</span><span class="op">)</span>, </span>
<span>    ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">eastern_eu_bbox</span><span class="op">[</span><span class="st">"ymin"</span><span class="op">]</span>, <span class="va">eastern_eu_bbox</span><span class="op">[</span><span class="st">"ymax"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_ocean</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-eastern-europe-50-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="using-the-adjusted-natural-earth-data-as-geojson-in-observable-js" class="level2"><h2 class="anchored" data-anchor-id="using-the-adjusted-natural-earth-data-as-geojson-in-observable-js">Using the adjusted Natural Earth data as GeoJSON in Observable JS</h2>
<p>This updated shapefile works with Observable Plot too (<a href="https://www.andrewheiss.com/blog/2025/02/10/usaid-ojs-maps/">see here for more about how to make nice maps with Observable</a>), but requires one strange tweak because of weird behavior with the GeoJSON file format.</p>
<section id="broken-geojson" class="level3"><h3 class="anchored" data-anchor-id="broken-geojson">Broken GeoJSON</h3>
<p>Let’s export the adjusted geographic data to GeoJSON:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Save as geojson for Observable Plot</span></span>
<span><span class="fu">st_write</span><span class="op">(</span></span>
<span>  obj <span class="op">=</span> <span class="va">world_un</span>, </span>
<span>  dsn <span class="op">=</span> <span class="st">"ne_110m_admin_0_countries_un_BROKEN.geojson"</span>, </span>
<span>  driver <span class="op">=</span> <span class="st">"GeoJSON"</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  delete_dsn <span class="op">=</span> <span class="cn">TRUE</span>  <span class="co"># Overwrite the existing .geojson if there is one</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And then load it with Observable JS:</p>
<div id="load-broken-data" class="cell">
<div class="sourceCode cell-code" id="cb18" data-startfrom="482" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 481;"><span id="cb18-482"><a href="#cb18-482" aria-hidden="true" tabindex="-1"></a>world_broken <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"ne_110m_admin_0_countries_un_BROKEN.geojson"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb18-483"><a href="#cb18-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-484"><a href="#cb18-484" aria-hidden="true" tabindex="-1"></a>clr_ocean <span class="op">=</span> <span class="st">"#d9f0ff"</span></span>
<span id="cb18-485"><a href="#cb18-485" aria-hidden="true" tabindex="-1"></a>clr_land <span class="op">=</span> <span class="st">"#facba6"</span></span>
<span id="cb18-486"><a href="#cb18-486" aria-hidden="true" tabindex="-1"></a>ukr_blue <span class="op">=</span> <span class="st">"#0057b7"</span></span>
<span id="cb18-487"><a href="#cb18-487" aria-hidden="true" tabindex="-1"></a>ukr_yellow <span class="op">=</span> <span class="st">"#ffdd00"</span></span>
<span id="cb18-488"><a href="#cb18-488" aria-hidden="true" tabindex="-1"></a>rus_red <span class="op">=</span> <span class="st">"#d62718"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="load-broken-data-1">
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="load-broken-data-2">
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="load-broken-data-3">
<div id="ojs-cell-1-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="load-broken-data-4">
<div id="ojs-cell-1-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="load-broken-data-5">
<div id="ojs-cell-1-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="load-broken-data-6">
<div id="ojs-cell-1-6" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<p>And then plot it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" data-startfrom="494" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 493;"><span id="cb19-494"><a href="#cb19-494" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb19-495"><a href="#cb19-495" aria-hidden="true" tabindex="-1"></a>  <span class="dt">projection</span><span class="op">:</span> <span class="st">"equal-earth"</span><span class="op">,</span></span>
<span id="cb19-496"><a href="#cb19-496" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb19-497"><a href="#cb19-497" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">sphere</span>({ <span class="dt">fill</span><span class="op">:</span> clr_ocean })<span class="op">,</span></span>
<span id="cb19-498"><a href="#cb19-498" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">geo</span>(world_broken<span class="op">,</span> {</span>
<span id="cb19-499"><a href="#cb19-499" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb19-500"><a href="#cb19-500" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb19-501"><a href="#cb19-501" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> clr_land</span>
<span id="cb19-502"><a href="#cb19-502" aria-hidden="true" tabindex="-1"></a>    }) </span>
<span id="cb19-503"><a href="#cb19-503" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb19-504"><a href="#cb19-504" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="plot-broken-world" class="cell-output cell-output-display">
<div id="ojs-cell-2" data-nodetype="expression">

</div>
</div>
</div>
<p>lol what even. The new Ukraine shape seems to have broken boundaries that distort everything else in the map. Weirdly, Ukraine is filled with the ocean color while the rest of the globe—both the ocean and whatever countries didn’t have their borders erased—is the color of land.</p>
<p>Let’s zoom in on just Ukraine:</p>
<div id="plot-broken-ukraine" class="cell">
<div class="sourceCode cell-code" id="cb20" data-startfrom="516" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 515;"><span id="cb20-516"><a href="#cb20-516" aria-hidden="true" tabindex="-1"></a>ukraine <span class="op">=</span> world_broken<span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">find</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">name</span> <span class="op">===</span> <span class="st">"Ukraine"</span>)</span>
<span id="cb20-517"><a href="#cb20-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-518"><a href="#cb20-518" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb20-519"><a href="#cb20-519" aria-hidden="true" tabindex="-1"></a>  <span class="dt">projection</span><span class="op">:</span> { </span>
<span id="cb20-520"><a href="#cb20-520" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"equal-earth"</span><span class="op">,</span> </span>
<span id="cb20-521"><a href="#cb20-521" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> ukraine<span class="op">,</span> </span>
<span id="cb20-522"><a href="#cb20-522" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inset</span><span class="op">:</span> <span class="dv">50</span> </span>
<span id="cb20-523"><a href="#cb20-523" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span> </span>
<span id="cb20-524"><a href="#cb20-524" aria-hidden="true" tabindex="-1"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">800</span><span class="op">,</span> </span>
<span id="cb20-525"><a href="#cb20-525" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb20-526"><a href="#cb20-526" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">sphere</span>({ <span class="dt">fill</span><span class="op">:</span> clr_ocean })<span class="op">,</span></span>
<span id="cb20-527"><a href="#cb20-527" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">geo</span>(world_broken<span class="op">,</span> {</span>
<span id="cb20-528"><a href="#cb20-528" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb20-529"><a href="#cb20-529" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb20-530"><a href="#cb20-530" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> clr_land</span>
<span id="cb20-531"><a href="#cb20-531" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb20-532"><a href="#cb20-532" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">geo</span>(ukraine<span class="op">,</span> { <span class="dt">fill</span><span class="op">:</span> ukr_blue })</span>
<span id="cb20-533"><a href="#cb20-533" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb20-534"><a href="#cb20-534" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="plot-broken-ukraine-1">
<div id="ojs-cell-3-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="plot-broken-ukraine-2">
<div id="ojs-cell-3-2" data-nodetype="expression">

</div>
</div>
</div>
</div>
<p>¯\_(ツ)_/¯. Now Ukraine is the color of the ocean and the whole rest of the world is the dark blue of the Ukrainian flag. And it didn’t zoom in at all.</p>
</section><section id="geojson-and-winding-order" class="level3"><h3 class="anchored" data-anchor-id="geojson-and-winding-order">GeoJSON and ↻ ↺ winding order ↻ ↺</h3>
<p>This is a symptom of an issue with <a href="https://macwright.com/2015/03/23/geojson-second-bite#winding">GeoJSON winding order</a>. GeoJSON cares about the direction that country borders (and all LINESTRING elements) are drawn in. Exterior borders should be drawn counterclockwise; interior borders should be drawn clockwise. If a geographic shape doesn’t follow this winding order, bad things happen. Specifically:</p>
<blockquote class="blockquote">
<p>a shape that represents a tiny speck of land becomes inflated to represent the whole globe minus that tiny speck of land, the map fills with a uniform color, the local projection explodes. (via <a href="https://observablehq.com/@fil/rewind">@fil</a>)</p>
</blockquote>
<p>That’s exactly what’s happening here. Somehow the winding order is getting reversed when we combine Ukraine with Crimea. {sf} itself doesn’t care about winding order, so everything works fine within R; GeoJSON is picky about winding order, so things break.</p>
<p>Fixing it is tricky though! {sf} uses a bunch of different libraries behind the scenes to do its geographic calculations, including <a href="https://libgeos.org/">GEOS</a> and <a href="http://s2geometry.io/">S2</a>, and they all have different approaches to polygon creation. Apparently <a href="https://github.com/r-spatial/sf/issues/2096#issuecomment-1426480037">GEOS goes clockwise by default</a> while others go counterclockwise, or something. It should theoretically be possible to fix by adding <code>st_sfc(check_ring_dir = TRUE)</code> after making the new Ukraine shape:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># It would be cool if this worked but it doesn't :(</span></span>
<span><span class="va">new_ukraine</span> <span class="op">&lt;-</span> <span class="fu">st_union</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ukraine_polygons</span>, <span class="va">crimea_polygon</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">st_sfc</span><span class="op">(</span>check_ring_dir <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_cast</span><span class="op">(</span><span class="st">"MULTIPOLYGON"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>But that doesn’t change anything (<a href="https://github.com/r-spatial/sf/issues/2096#issuecomment-2269379942">nor does it work for this person at GitHub</a>).</p>
</section><section id="clean-geojson-with-correct-winding-order" class="level3"><h3 class="anchored" data-anchor-id="clean-geojson-with-correct-winding-order">Clean GeoJSON with correct winding order</h3>
<p>BUT there’s another solution. We can force {sf} to <em>not</em> use the S2 library (which it uses by default, I guess?), since S2 seems go in the wrong direction. If we turn off S2 with <code>sf_use_s2(FALSE)</code>, make the new Ukraine shape, and then turn S2 back on with <code>sf_use_s2(TRUE)</code>, things work!</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Add Crimea to Ukraine</span></span>
<span><span class="fu">sf_use_s2</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">new_ukraine_110</span> <span class="op">&lt;-</span> <span class="fu">st_union</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ukraine_polygons_110</span>, <span class="va">crimea_polygon_110</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">st_cast</span><span class="op">(</span><span class="st">"MULTIPOLYGON"</span><span class="op">)</span></span>
<span><span class="fu">sf_use_s2</span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here’s the full process with the 110m map:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">world_110</span> <span class="op">&lt;-</span> <span class="fu">ne_countries</span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">110</span>, type <span class="op">=</span> <span class="st">"map_units"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">crimea_point_110</span> <span class="op">&lt;-</span> <span class="fu">st_sfc</span><span class="op">(</span><span class="fu">st_point</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">34</span>, <span class="fl">45</span><span class="op">)</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="va">world_110</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the Russia MULTIPOLYGON and convert it to polygons</span></span>
<span><span class="va">russia_polygons_110</span> <span class="op">&lt;-</span> <span class="va">world_110</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">admin</span> <span class="op">==</span> <span class="st">"Russia"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_geometry</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_cast</span><span class="op">(</span><span class="st">"POLYGON"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the Russia polygon that has Crimea in it</span></span>
<span><span class="va">crimea_polygon_110</span> <span class="op">&lt;-</span> <span class="va">russia_polygons_110</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">keep</span><span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">st_intersects</span><span class="op">(</span><span class="va">x</span>, <span class="va">crimea_point_110</span>, sparse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the Ukraine MULTIPOLYGON and convert it to polygons</span></span>
<span><span class="va">ukraine_polygons_110</span> <span class="op">&lt;-</span> <span class="va">world_110</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">admin</span> <span class="op">==</span> <span class="st">"Ukraine"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_geometry</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_cast</span><span class="op">(</span><span class="st">"POLYGON"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add Crimea to Ukraine</span></span>
<span><span class="fu">sf_use_s2</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">## Spherical geometry (s2) switched off</span></span>
<span><span class="va">new_ukraine_110</span> <span class="op">&lt;-</span> <span class="fu">st_union</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ukraine_polygons_110</span>, <span class="va">crimea_polygon_110</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">st_cast</span><span class="op">(</span><span class="st">"MULTIPOLYGON"</span><span class="op">)</span></span>
<span><span class="co">## although coordinates are longitude/latitude, st_union assumes that they are planar</span></span>
<span><span class="fu">sf_use_s2</span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## Spherical geometry (s2) switched on</span></span>
<span></span>
<span><span class="co"># Remove Crimea from Russia</span></span>
<span><span class="va">new_russia_110</span> <span class="op">&lt;-</span> <span class="va">russia_polygons_110</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">discard</span><span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="fu">st_equals</span><span class="op">(</span><span class="va">x</span>, <span class="va">crimea_polygon_110</span>, sparse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_combine</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_cast</span><span class="op">(</span><span class="st">"MULTIPOLYGON"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add the modified Russia and Ukraine to the main data</span></span>
<span><span class="va">world_un_110_fixed</span> <span class="op">&lt;-</span> <span class="va">world_110</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>geometry <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>    <span class="va">admin</span> <span class="op">==</span> <span class="st">"Ukraine"</span> <span class="op">~</span> <span class="va">new_ukraine_110</span>,</span>
<span>    <span class="va">admin</span> <span class="op">==</span> <span class="st">"Russia"</span> <span class="op">~</span> <span class="va">new_russia_110</span>,</span>
<span>    .default <span class="op">=</span> <span class="va">geometry</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save as GeoJSON</span></span>
<span><span class="fu">st_write</span><span class="op">(</span></span>
<span>  obj <span class="op">=</span> <span class="va">world_un_110_fixed</span>, </span>
<span>  dsn <span class="op">=</span> <span class="st">"ne_110m_admin_0_countries_un.geojson"</span>, </span>
<span>  driver <span class="op">=</span> <span class="st">"GeoJSON"</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  delete_dsn <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here’s the new world map with the the correct Ukraine:</p>
<div id="plot-fixed-world" class="cell">
<div class="sourceCode cell-code" id="cb24" data-startfrom="630" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 629;"><span id="cb24-630"><a href="#cb24-630" aria-hidden="true" tabindex="-1"></a>world_fixed <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"ne_110m_admin_0_countries_un.geojson"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb24-631"><a href="#cb24-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-632"><a href="#cb24-632" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb24-633"><a href="#cb24-633" aria-hidden="true" tabindex="-1"></a>  <span class="dt">projection</span><span class="op">:</span> <span class="st">"equal-earth"</span><span class="op">,</span></span>
<span id="cb24-634"><a href="#cb24-634" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb24-635"><a href="#cb24-635" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">sphere</span>({ <span class="dt">fill</span><span class="op">:</span> clr_ocean })<span class="op">,</span></span>
<span id="cb24-636"><a href="#cb24-636" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">geo</span>(world_fixed<span class="op">,</span> {</span>
<span id="cb24-637"><a href="#cb24-637" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb24-638"><a href="#cb24-638" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb24-639"><a href="#cb24-639" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> clr_land</span>
<span id="cb24-640"><a href="#cb24-640" aria-hidden="true" tabindex="-1"></a>    }) </span>
<span id="cb24-641"><a href="#cb24-641" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb24-642"><a href="#cb24-642" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="plot-fixed-world-1">
<div id="ojs-cell-4-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="plot-fixed-world-2">
<div id="ojs-cell-4-2" data-nodetype="expression">

</div>
</div>
</div>
</div>
<p>We can zoom in on Ukraine too:</p>
<div id="plot-fixed-ukraine" class="cell">
<div class="sourceCode cell-code" id="cb25" data-startfrom="650" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 649;"><span id="cb25-650"><a href="#cb25-650" aria-hidden="true" tabindex="-1"></a>ukraine_good <span class="op">=</span> world_fixed<span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">find</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">name</span> <span class="op">===</span> <span class="st">"Ukraine"</span>)</span>
<span id="cb25-651"><a href="#cb25-651" aria-hidden="true" tabindex="-1"></a>russia <span class="op">=</span> world_fixed<span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">find</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">name</span> <span class="op">===</span> <span class="st">"Russia"</span>)</span>
<span id="cb25-652"><a href="#cb25-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-653"><a href="#cb25-653" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb25-654"><a href="#cb25-654" aria-hidden="true" tabindex="-1"></a>  <span class="dt">projection</span><span class="op">:</span> { </span>
<span id="cb25-655"><a href="#cb25-655" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"equal-earth"</span><span class="op">,</span> </span>
<span id="cb25-656"><a href="#cb25-656" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> ukraine_good<span class="op">,</span> </span>
<span id="cb25-657"><a href="#cb25-657" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inset</span><span class="op">:</span> <span class="dv">50</span> </span>
<span id="cb25-658"><a href="#cb25-658" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span> </span>
<span id="cb25-659"><a href="#cb25-659" aria-hidden="true" tabindex="-1"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">800</span><span class="op">,</span> </span>
<span id="cb25-660"><a href="#cb25-660" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb25-661"><a href="#cb25-661" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">sphere</span>({ <span class="dt">fill</span><span class="op">:</span> clr_ocean })<span class="op">,</span></span>
<span id="cb25-662"><a href="#cb25-662" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">geo</span>(world_fixed<span class="op">,</span> {</span>
<span id="cb25-663"><a href="#cb25-663" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb25-664"><a href="#cb25-664" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb25-665"><a href="#cb25-665" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> clr_land</span>
<span id="cb25-666"><a href="#cb25-666" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb25-667"><a href="#cb25-667" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">geo</span>(russia<span class="op">,</span> { <span class="dt">fill</span><span class="op">:</span> rus_red })<span class="op">,</span></span>
<span id="cb25-668"><a href="#cb25-668" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">geo</span>(ukraine_good<span class="op">,</span> { </span>
<span id="cb25-669"><a href="#cb25-669" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> ukr_blue<span class="op">,</span> </span>
<span id="cb25-670"><a href="#cb25-670" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> ukr_yellow<span class="op">,</span> </span>
<span id="cb25-671"><a href="#cb25-671" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">3</span></span>
<span id="cb25-672"><a href="#cb25-672" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb25-673"><a href="#cb25-673" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb25-674"><a href="#cb25-674" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="plot-fixed-ukraine-1">
<div id="ojs-cell-5-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="plot-fixed-ukraine-2">
<div id="ojs-cell-5-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="plot-fixed-ukraine-3">
<div id="ojs-cell-5-3" data-nodetype="expression">

</div>
</div>
</div>
</div>
</section></section><section id="alternative-data-sources" class="level2"><h2 class="anchored" data-anchor-id="alternative-data-sources">Alternative data sources</h2>
<p>Natural Earth isn’t the only source of geographic data online, and other sources use <em>de jure</em> borders instead of <em>de facto</em> borders, like these:</p>
<section id="gisco" class="level3"><h3 class="anchored" data-anchor-id="gisco">GISCO</h3>
<p>The European Commission’s Eurostat hosts the <a href="https://ec.europa.eu/eurostat/web/gisco">Geographic Information System of the Commission (GISCO)</a>, which provides GIS data for the EU. They offer global shapefiles that follow EU-based <em>de jure</em> borders. <a href="https://ropengov.github.io/giscoR/">The {giscoR} package</a> provides a nice frontend for getting that data into R at 5 different resolutions (1:60m, 1:20m, 1:10m, 1:3m, and super detailed 1:1m!). It does not come with additional metadata for each country, though (i.e.&nbsp;there are no regional divisions, population values, map colors, names in other languages, and so on), so it requires some extra cleaning work if you want those details. For example, can add region information with <a href="https://vincentarelbundock.github.io/countrycode/">{countrycode}</a>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ropengov.github.io/giscoR/">giscoR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://vincentarelbundock.github.io/countrycode/">countrycode</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">world_gisco</span> <span class="op">&lt;-</span> <span class="fu">gisco_get_countries</span><span class="op">(</span></span>
<span>  year <span class="op">=</span> <span class="st">"2024"</span>,</span>
<span>  epsg <span class="op">=</span> <span class="st">"4326"</span>,</span>
<span>  resolution <span class="op">=</span> <span class="st">"60"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Add World Bank regions</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>region <span class="op">=</span> <span class="fu">countrycode</span><span class="op">(</span><span class="va">ISO3_CODE</span>, origin <span class="op">=</span> <span class="st">"iso3c"</span>, destination <span class="op">=</span> <span class="st">"region"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">world_gisco</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">NAME_ENGL</span> <span class="op">!=</span> <span class="st">"Antarctica"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">region</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"white"</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">carto_prism</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>crs <span class="op">=</span> <span class="st">"+proj=robin"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-gisco-world-map-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Since the EU doesn’t <em>de jure</em>-ily recognize the Russian occupation of Crimea, Crimea is in Ukraine:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ukraine_gisco</span> <span class="op">&lt;-</span> <span class="va">world_gisco</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">NAME_ENGL</span> <span class="op">==</span> <span class="st">"Ukraine"</span><span class="op">)</span></span>
<span><span class="va">russia_gisco</span> <span class="op">&lt;-</span> <span class="va">world_gisco</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">NAME_ENGL</span> <span class="op">==</span> <span class="st">"Russian Federation"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ukraine_gisco_bbox</span> <span class="op">&lt;-</span> <span class="va">ukraine_gisco</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_buffer</span><span class="op">(</span>dist <span class="op">=</span> <span class="fl">100000</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># Add 100,000 meter buffer around the country </span></span>
<span>  <span class="fu">st_bbox</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">world_gisco</span>, fill <span class="op">=</span> <span class="va">clr_land</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">russia_gisco</span>, fill <span class="op">=</span> <span class="va">rus_red</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">ukraine_gisco</span>, fill <span class="op">=</span> <span class="va">ukr_blue</span>, color <span class="op">=</span> <span class="va">ukr_yellow</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span></span>
<span>    xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ukraine_gisco_bbox</span><span class="op">[</span><span class="st">"xmin"</span><span class="op">]</span>, <span class="va">ukraine_gisco_bbox</span><span class="op">[</span><span class="st">"xmax"</span><span class="op">]</span><span class="op">)</span>, </span>
<span>    ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ukraine_gisco_bbox</span><span class="op">[</span><span class="st">"ymin"</span><span class="op">]</span>, <span class="va">ukraine_gisco_bbox</span><span class="op">[</span><span class="st">"ymax"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_ocean</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-ukraine-gisco-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>It’s possible to use GISCO data with Observable too. We could load the data into R and clean it up there (like adding regions and other details) and the save it as GeoJSON, like we did with the Natural Earth data.</p>
<p>Or we can grab the <a href="https://gisco-services.ec.europa.eu/distribution/v2/countries/geojson/">original raw GeoJSON from Eurostat</a> directly. For example, here’s the <a href="https://gisco-services.ec.europa.eu/distribution/v2/countries/geojson/CNTR_BN_60M_2024_4326.geojson">raw 60M 2024 world map using the WGS84 (4326) projection</a> that we grabbed with <code>gisco_get_countries()</code> earlier.</p>
<div id="plot-ojs-gisco" class="cell">
<div class="sourceCode cell-code" id="cb28" data-startfrom="743" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 742;"><span id="cb28-743"><a href="#cb28-743" aria-hidden="true" tabindex="-1"></a>world_gisco <span class="op">=</span> <span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"https://gisco-services.ec.europa.eu/distribution/v2/countries/geojson/CNTR_RG_60M_2024_4326.geojson"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb28-744"><a href="#cb28-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-745"><a href="#cb28-745" aria-hidden="true" tabindex="-1"></a>ukraine_gisco <span class="op">=</span> world_gisco<span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">find</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">NAME_ENGL</span> <span class="op">===</span> <span class="st">"Ukraine"</span>)</span>
<span id="cb28-746"><a href="#cb28-746" aria-hidden="true" tabindex="-1"></a>russia_gisco <span class="op">=</span> world_gisco<span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">find</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">NAME_ENGL</span> <span class="op">===</span> <span class="st">"Russian Federation"</span>)</span>
<span id="cb28-747"><a href="#cb28-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-748"><a href="#cb28-748" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb28-749"><a href="#cb28-749" aria-hidden="true" tabindex="-1"></a>  <span class="dt">projection</span><span class="op">:</span> { </span>
<span id="cb28-750"><a href="#cb28-750" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"equal-earth"</span><span class="op">,</span> </span>
<span id="cb28-751"><a href="#cb28-751" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> ukraine_gisco<span class="op">,</span> </span>
<span id="cb28-752"><a href="#cb28-752" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inset</span><span class="op">:</span> <span class="dv">50</span> </span>
<span id="cb28-753"><a href="#cb28-753" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span> </span>
<span id="cb28-754"><a href="#cb28-754" aria-hidden="true" tabindex="-1"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">800</span><span class="op">,</span> </span>
<span id="cb28-755"><a href="#cb28-755" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb28-756"><a href="#cb28-756" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">sphere</span>({ <span class="dt">fill</span><span class="op">:</span> clr_ocean })<span class="op">,</span></span>
<span id="cb28-757"><a href="#cb28-757" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">geo</span>(world_gisco<span class="op">,</span> {</span>
<span id="cb28-758"><a href="#cb28-758" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb28-759"><a href="#cb28-759" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb28-760"><a href="#cb28-760" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> clr_land</span>
<span id="cb28-761"><a href="#cb28-761" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb28-762"><a href="#cb28-762" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">geo</span>(russia_gisco<span class="op">,</span> { <span class="dt">fill</span><span class="op">:</span> rus_red })<span class="op">,</span></span>
<span id="cb28-763"><a href="#cb28-763" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">geo</span>(ukraine_gisco<span class="op">,</span> { </span>
<span id="cb28-764"><a href="#cb28-764" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> ukr_blue<span class="op">,</span> </span>
<span id="cb28-765"><a href="#cb28-765" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> ukr_yellow<span class="op">,</span> </span>
<span id="cb28-766"><a href="#cb28-766" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">3</span></span>
<span id="cb28-767"><a href="#cb28-767" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb28-768"><a href="#cb28-768" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb28-769"><a href="#cb28-769" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="plot-ojs-gisco-1">
<div id="ojs-cell-6-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="plot-ojs-gisco-2">
<div id="ojs-cell-6-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="plot-ojs-gisco-3">
<div id="ojs-cell-6-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="plot-ojs-gisco-4">
<div id="ojs-cell-6-4" data-nodetype="expression">

</div>
</div>
</div>
</div>
</section><section id="visionscarto" class="level3"><h3 class="anchored" data-anchor-id="visionscarto">Visionscarto</h3>
<p>There are JSON-based map files created by <a href="https://observablehq.com/user/@fil">@fil at Observable</a> as part of the <a href="https://observablehq.com/@visionscarto/world-atlas-topojson">Visionscarto project</a>.</p>
<p>They’re based on Natural Earth, but with <a href="https://observablehq.com/@visionscarto/world-atlas-topojson#cell-93">some specific adjustments</a> like adding Crimea to Ukraine, making Gaza a little bit bigger so that it doesn’t get dropped at lower resolutions like 110m, and using UN boundaries for Western Sahara.</p>
<p>Like GISCO, though, these don’t have the additional columns that Natural Earth comes with (country names in a bunch of languages, region and continent designations, map coloring schemes, population and GDP estimates, etc.), and those would need to be added manually in R or Observable or whatever.</p>
<div id="plot-visionscarto" class="cell">
<div class="sourceCode cell-code" id="cb29" data-startfrom="783" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 782;"><span id="cb29-783"><a href="#cb29-783" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> {world110m} <span class="im">from</span> <span class="st">"@visionscarto/geo"</span></span>
<span id="cb29-784"><a href="#cb29-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-785"><a href="#cb29-785" aria-hidden="true" tabindex="-1"></a>countries110m <span class="op">=</span> topojson<span class="op">.</span><span class="fu">feature</span>(world110m<span class="op">,</span> world110m<span class="op">.</span><span class="at">objects</span><span class="op">.</span><span class="at">countries</span>)</span>
<span id="cb29-786"><a href="#cb29-786" aria-hidden="true" tabindex="-1"></a>ukraine_visionscarto <span class="op">=</span> countries110m<span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">find</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">name</span> <span class="op">===</span> <span class="st">"Ukraine"</span>)</span>
<span id="cb29-787"><a href="#cb29-787" aria-hidden="true" tabindex="-1"></a>russia_visionscarto <span class="op">=</span> countries110m<span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">find</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">name</span> <span class="op">===</span> <span class="st">"Russia"</span>)</span>
<span id="cb29-788"><a href="#cb29-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-789"><a href="#cb29-789" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb29-790"><a href="#cb29-790" aria-hidden="true" tabindex="-1"></a>  <span class="dt">projection</span><span class="op">:</span> { </span>
<span id="cb29-791"><a href="#cb29-791" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"equal-earth"</span><span class="op">,</span> </span>
<span id="cb29-792"><a href="#cb29-792" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> ukraine_visionscarto<span class="op">,</span> </span>
<span id="cb29-793"><a href="#cb29-793" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inset</span><span class="op">:</span> <span class="dv">50</span> </span>
<span id="cb29-794"><a href="#cb29-794" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span> </span>
<span id="cb29-795"><a href="#cb29-795" aria-hidden="true" tabindex="-1"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">800</span><span class="op">,</span> </span>
<span id="cb29-796"><a href="#cb29-796" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb29-797"><a href="#cb29-797" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">sphere</span>({ <span class="dt">fill</span><span class="op">:</span> clr_ocean })<span class="op">,</span></span>
<span id="cb29-798"><a href="#cb29-798" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">geo</span>(countries110m<span class="op">,</span> {</span>
<span id="cb29-799"><a href="#cb29-799" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb29-800"><a href="#cb29-800" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb29-801"><a href="#cb29-801" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> clr_land</span>
<span id="cb29-802"><a href="#cb29-802" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb29-803"><a href="#cb29-803" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">geo</span>(russia_visionscarto<span class="op">,</span> { <span class="dt">fill</span><span class="op">:</span> rus_red })<span class="op">,</span></span>
<span id="cb29-804"><a href="#cb29-804" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">geo</span>(ukraine_visionscarto<span class="op">,</span> { </span>
<span id="cb29-805"><a href="#cb29-805" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> ukr_blue<span class="op">,</span> </span>
<span id="cb29-806"><a href="#cb29-806" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> ukr_yellow<span class="op">,</span> </span>
<span id="cb29-807"><a href="#cb29-807" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">3</span></span>
<span id="cb29-808"><a href="#cb29-808" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb29-809"><a href="#cb29-809" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb29-810"><a href="#cb29-810" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="plot-visionscarto-1">
<div id="ojs-cell-7-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="plot-visionscarto-2">
<div id="ojs-cell-7-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="plot-visionscarto-3">
<div id="ojs-cell-7-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="plot-visionscarto-4">
<div id="ojs-cell-7-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="plot-visionscarto-5">
<div id="ojs-cell-7-5" data-nodetype="expression">

</div>
</div>
</div>
</div>
</section><section id="less-automatic-sources" class="level3"><h3 class="anchored" data-anchor-id="less-automatic-sources">Less automatic sources</h3>
<p>There are other sources too, but they require manual downloading:</p>
<ul>
<li>
<a href="https://www.geoboundaries.org/">The geoBoundaries project</a>, hosted by the <a href="https://sites.google.com/view/wmgeolab/">William &amp; Mary geoLab</a>
</li>
<li><a href="https://data.apps.fao.org/catalog/iso/6aecaf08-c7d0-4e16-8778-b8dddae9da14">The UN’s Country Boundaries of the World hosted at the UN’s Food and Agricultural Organization (FAO) site</a></li>
<li><a href="https://public.opendatasoft.com/explore/dataset/world-administrative-boundaries/map/?location=5,48.87917,30.25635&amp;basemap=jawg.light&amp;dataChart=eyJxdWVyaWVzIjpbeyJjb25maWciOnsiZGF0YXNldCI6IndvcmxkLWFkbWluaXN0cmF0aXZlLWJvdW5kYXJpZXMiLCJvcHRpb25zIjp7ImJhc2VtYXAiOiJqYXdnLmxpZ2h0IiwibG9jYXRpb24iOiI1LDQ1LjkwNTMsMzcuNzI3MDUifX0sImNoYXJ0cyI6W3siYWxpZ25Nb250aCI6dHJ1ZSwidHlwZSI6ImNvbHVtbiIsImZ1bmMiOiJDT1VOVCIsInNjaWVudGlmaWNEaXNwbGF5Ijp0cnVlLCJjb2xvciI6IiNGRjUxNUEifV0sInhBeGlzIjoic3RhdHVzIiwibWF4cG9pbnRzIjo1MCwic29ydCI6IiJ9XSwidGltZXNjYWxlIjoiIiwiZGlzcGxheUxlZ2VuZCI6dHJ1ZSwiYWxpZ25Nb250aCI6dHJ1ZX0%3D">Opendatasoft’s copy of the World Food Programme’s World Administrative Boundaries shapefile</a></li>
</ul>


<!-- -->

</section></section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{heiss2025,
  author = {Heiss, Andrew},
  title = {How to Move {Crimea} from {Russia} to {Ukraine} in Maps with
    {R}},
  date = {2025-02-13},
  url = {https://www.andrewheiss.com/blog/2025/02/13/natural-earth-crimea/},
  doi = {10.59350/28kp0-nbq92},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-heiss2025" class="csl-entry quarto-appendix-citeas" role="listitem">
Heiss, Andrew. 2025. <span>“How to Move Crimea from Russia to Ukraine in
Maps with R.”</span> February 13, 2025. <a href="https://doi.org/10.59350/28kp0-nbq92">https://doi.org/10.59350/28kp0-nbq92</a>.
</div></div></section></div></main><!-- /main --><script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ilxud29ybGRfYnJva2VuID0gRmlsZUF0dGFjaG1lbnQoXCJuZV8xMTBtX2FkbWluXzBfY291bnRyaWVzX3VuX0JST0tFTi5nZW9qc29uXCIpLmpzb24oKVxuXG5jbHJfb2NlYW4gPSBcIiNkOWYwZmZcIlxuY2xyX2xhbmQgPSBcIiNmYWNiYTZcIlxudWtyX2JsdWUgPSBcIiMwMDU3YjdcIlxudWtyX3llbGxvdyA9IFwiI2ZmZGQwMFwiXG5ydXNfcmVkID0gXCIjZDYyNzE4XCJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuUGxvdC5wbG90KHtcbiAgcHJvamVjdGlvbjogXCJlcXVhbC1lYXJ0aFwiLFxuICBtYXJrczogW1xuICAgIFBsb3Quc3BoZXJlKHsgZmlsbDogY2xyX29jZWFuIH0pLFxuICAgIFBsb3QuZ2VvKHdvcmxkX2Jyb2tlbiwge1xuICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICBzdHJva2VXaWR0aDogMC41LFxuICAgICAgZmlsbDogY2xyX2xhbmRcbiAgICB9KSBcbiAgXVxufSlcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxudWtyYWluZSA9IHdvcmxkX2Jyb2tlbi5mZWF0dXJlcy5maW5kKGQgPT4gZC5wcm9wZXJ0aWVzLm5hbWUgPT09IFwiVWtyYWluZVwiKVxuXG5QbG90LnBsb3Qoe1xuICBwcm9qZWN0aW9uOiB7IFxuICAgIHR5cGU6IFwiZXF1YWwtZWFydGhcIiwgXG4gICAgZG9tYWluOiB1a3JhaW5lLCBcbiAgICBpbnNldDogNTAgXG4gIH0sIFxuICB3aWR0aDogODAwLCBcbiAgbWFya3M6IFtcbiAgICBQbG90LnNwaGVyZSh7IGZpbGw6IGNscl9vY2VhbiB9KSxcbiAgICBQbG90Lmdlbyh3b3JsZF9icm9rZW4sIHtcbiAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgc3Ryb2tlV2lkdGg6IDAuNSxcbiAgICAgIGZpbGw6IGNscl9sYW5kXG4gICAgfSksXG4gICAgUGxvdC5nZW8odWtyYWluZSwgeyBmaWxsOiB1a3JfYmx1ZSB9KVxuICBdXG59KVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG53b3JsZF9maXhlZCA9IEZpbGVBdHRhY2htZW50KFwibmVfMTEwbV9hZG1pbl8wX2NvdW50cmllc191bi5nZW9qc29uXCIpLmpzb24oKVxuXG5QbG90LnBsb3Qoe1xuICBwcm9qZWN0aW9uOiBcImVxdWFsLWVhcnRoXCIsXG4gIG1hcmtzOiBbXG4gICAgUGxvdC5zcGhlcmUoeyBmaWxsOiBjbHJfb2NlYW4gfSksXG4gICAgUGxvdC5nZW8od29ybGRfZml4ZWQsIHtcbiAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgc3Ryb2tlV2lkdGg6IDAuNSxcbiAgICAgIGZpbGw6IGNscl9sYW5kXG4gICAgfSkgXG4gIF1cbn0pXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbnVrcmFpbmVfZ29vZCA9IHdvcmxkX2ZpeGVkLmZlYXR1cmVzLmZpbmQoZCA9PiBkLnByb3BlcnRpZXMubmFtZSA9PT0gXCJVa3JhaW5lXCIpXG5ydXNzaWEgPSB3b3JsZF9maXhlZC5mZWF0dXJlcy5maW5kKGQgPT4gZC5wcm9wZXJ0aWVzLm5hbWUgPT09IFwiUnVzc2lhXCIpXG5cblBsb3QucGxvdCh7XG4gIHByb2plY3Rpb246IHsgXG4gICAgdHlwZTogXCJlcXVhbC1lYXJ0aFwiLCBcbiAgICBkb21haW46IHVrcmFpbmVfZ29vZCwgXG4gICAgaW5zZXQ6IDUwIFxuICB9LCBcbiAgd2lkdGg6IDgwMCwgXG4gIG1hcmtzOiBbXG4gICAgUGxvdC5zcGhlcmUoeyBmaWxsOiBjbHJfb2NlYW4gfSksXG4gICAgUGxvdC5nZW8od29ybGRfZml4ZWQsIHtcbiAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgc3Ryb2tlV2lkdGg6IDAuNSxcbiAgICAgIGZpbGw6IGNscl9sYW5kXG4gICAgfSksXG4gICAgUGxvdC5nZW8ocnVzc2lhLCB7IGZpbGw6IHJ1c19yZWQgfSksXG4gICAgUGxvdC5nZW8odWtyYWluZV9nb29kLCB7IFxuICAgICAgZmlsbDogdWtyX2JsdWUsIFxuICAgICAgc3Ryb2tlOiB1a3JfeWVsbG93LCBcbiAgICAgIHN0cm9rZVdpZHRoOiAzXG4gICAgfSlcbiAgXVxufSlcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ilxud29ybGRfZ2lzY28gPSBhd2FpdCBGaWxlQXR0YWNobWVudChcImh0dHBzOi8vZ2lzY28tc2VydmljZXMuZWMuZXVyb3BhLmV1L2Rpc3RyaWJ1dGlvbi92Mi9jb3VudHJpZXMvZ2VvanNvbi9DTlRSX1JHXzYwTV8yMDI0XzQzMjYuZ2VvanNvblwiKS5qc29uKClcblxudWtyYWluZV9naXNjbyA9IHdvcmxkX2dpc2NvLmZlYXR1cmVzLmZpbmQoZCA9PiBkLnByb3BlcnRpZXMuTkFNRV9FTkdMID09PSBcIlVrcmFpbmVcIilcbnJ1c3NpYV9naXNjbyA9IHdvcmxkX2dpc2NvLmZlYXR1cmVzLmZpbmQoZCA9PiBkLnByb3BlcnRpZXMuTkFNRV9FTkdMID09PSBcIlJ1c3NpYW4gRmVkZXJhdGlvblwiKVxuXG5QbG90LnBsb3Qoe1xuICBwcm9qZWN0aW9uOiB7IFxuICAgIHR5cGU6IFwiZXF1YWwtZWFydGhcIiwgXG4gICAgZG9tYWluOiB1a3JhaW5lX2dpc2NvLCBcbiAgICBpbnNldDogNTAgXG4gIH0sIFxuICB3aWR0aDogODAwLCBcbiAgbWFya3M6IFtcbiAgICBQbG90LnNwaGVyZSh7IGZpbGw6IGNscl9vY2VhbiB9KSxcbiAgICBQbG90Lmdlbyh3b3JsZF9naXNjbywge1xuICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICBzdHJva2VXaWR0aDogMC41LFxuICAgICAgZmlsbDogY2xyX2xhbmRcbiAgICB9KSxcbiAgICBQbG90LmdlbyhydXNzaWFfZ2lzY28sIHsgZmlsbDogcnVzX3JlZCB9KSxcbiAgICBQbG90Lmdlbyh1a3JhaW5lX2dpc2NvLCB7IFxuICAgICAgZmlsbDogdWtyX2JsdWUsIFxuICAgICAgc3Ryb2tlOiB1a3JfeWVsbG93LCBcbiAgICAgIHN0cm9rZVdpZHRoOiAzXG4gICAgfSlcbiAgXVxufSlcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuaW1wb3J0IHt3b3JsZDExMG19IGZyb20gXCJAdmlzaW9uc2NhcnRvL2dlb1wiXG5cbmNvdW50cmllczExMG0gPSB0b3BvanNvbi5mZWF0dXJlKHdvcmxkMTEwbSwgd29ybGQxMTBtLm9iamVjdHMuY291bnRyaWVzKVxudWtyYWluZV92aXNpb25zY2FydG8gPSBjb3VudHJpZXMxMTBtLmZlYXR1cmVzLmZpbmQoZCA9PiBkLnByb3BlcnRpZXMubmFtZSA9PT0gXCJVa3JhaW5lXCIpXG5ydXNzaWFfdmlzaW9uc2NhcnRvID0gY291bnRyaWVzMTEwbS5mZWF0dXJlcy5maW5kKGQgPT4gZC5wcm9wZXJ0aWVzLm5hbWUgPT09IFwiUnVzc2lhXCIpXG5cblBsb3QucGxvdCh7XG4gIHByb2plY3Rpb246IHsgXG4gICAgdHlwZTogXCJlcXVhbC1lYXJ0aFwiLCBcbiAgICBkb21haW46IHVrcmFpbmVfdmlzaW9uc2NhcnRvLCBcbiAgICBpbnNldDogNTAgXG4gIH0sIFxuICB3aWR0aDogODAwLCBcbiAgbWFya3M6IFtcbiAgICBQbG90LnNwaGVyZSh7IGZpbGw6IGNscl9vY2VhbiB9KSxcbiAgICBQbG90Lmdlbyhjb3VudHJpZXMxMTBtLCB7XG4gICAgICBzdHJva2U6IFwiYmxhY2tcIixcbiAgICAgIHN0cm9rZVdpZHRoOiAwLjUsXG4gICAgICBmaWxsOiBjbHJfbGFuZFxuICAgIH0pLFxuICAgIFBsb3QuZ2VvKHJ1c3NpYV92aXNpb25zY2FydG8sIHsgZmlsbDogcnVzX3JlZCB9KSxcbiAgICBQbG90Lmdlbyh1a3JhaW5lX3Zpc2lvbnNjYXJ0bywgeyBcbiAgICAgIGZpbGw6IHVrcl9ibHVlLCBcbiAgICAgIHN0cm9rZTogdWtyX3llbGxvdywgXG4gICAgICBzdHJva2VXaWR0aDogM1xuICAgIH0pXG4gIF1cbn0pXG4ifV19
</script><script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../blog/2025/02/13/natural-earth-crimea";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../../../../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.andrewheiss\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><script src="https://giscus.app/client.js" data-repo="andrewheiss/ath-quarto" data-repo-id="R_kgDOIg6EJQ" data-category="Blog comments" data-category-id="DIC_kwDOIg6EJc4CSz92" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><input type="hidden" id="giscus-base-theme" value="light"><input type="hidden" id="giscus-alt-theme" value="dark"><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb30" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "How to move Crimea from Russia to Ukraine in maps with R"</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2025-02-13</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Natural Earth's de facto on-the-ground policy conflicts with de jure boundaries. Use {sf} and R to relocate parts of country shapes."</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> index_files/figure-html/plot-eastern-europe-50-1.png</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="an">twitter-card:</span><span class="co"> </span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co">    image: "index_files/figure-html/plot-eastern-europe-50-1.png"</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="an">open-graph:</span><span class="co"> </span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co">    image: "index_files/figure-html/plot-eastern-europe-50-1.png"</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co">  - r</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="co">  - tidyverse</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co">  - ggplot</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co">  - ojs</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="co">  - observable plot</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="co">  - gis</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co">  - maps</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a><span class="co">    include-in-header:</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="co">      - text: |</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a><span class="co">          &lt;style type="text/css"&gt;</span></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a><span class="co">          div.sourceCode &gt; pre.sourceCode.js::before {</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a><span class="co">            content: 'Observable JS';</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a><span class="co">            display: block;</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a><span class="co">            text-align: left;</span></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a><span class="co">            font-size: 1em;</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a><span class="co">            margin-bottom: 7px;</span></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a><span class="co">            border-bottom: #4c4c4c 1px solid;</span></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a><span class="co">            padding-left: 4.25px;</span></span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a><span class="co">            padding-bottom: 5px;</span></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a><span class="co">            color: #aaaaaa;</span></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a><span class="co">          }</span></span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a><span class="co">          div.sourceCode &gt; pre.sourceCode.r::before {</span></span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a><span class="co">            content: 'R';</span></span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a><span class="co">            display: block;</span></span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a><span class="co">            text-align: left;</span></span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a><span class="co">            font-size: 1em;</span></span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a><span class="co">            margin-bottom: 7px;</span></span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a><span class="co">            border-bottom: #4c4c4c 1px solid;</span></span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a><span class="co">            padding-left: 4.25px;</span></span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a><span class="co">            padding-bottom: 5px;</span></span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a><span class="co">            color: #aaaaaa;</span></span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a><span class="co">          }</span></span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a><span class="co">          &lt;/style&gt;</span></span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a><span class="an">doi:</span><span class="co"> 10.59350/28kp0-nbq92</span></span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a><span class="an">citation:</span><span class="co"> true</span></span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-57"><a href="#cb30-57" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-58"><a href="#cb30-58" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb30-59"><a href="#cb30-59" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb30-60"><a href="#cb30-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-61"><a href="#cb30-61" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb30-62"><a href="#cb30-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig.width =</span> <span class="dv">6</span>,</span>
<span id="cb30-63"><a href="#cb30-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig.height =</span> <span class="dv">6</span> <span class="sc">*</span> <span class="fl">0.618</span>,</span>
<span id="cb30-64"><a href="#cb30-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig.retina =</span> <span class="dv">3</span>,</span>
<span id="cb30-65"><a href="#cb30-65" aria-hidden="true" tabindex="-1"></a>  <span class="at">dev =</span> <span class="st">"ragg_png"</span>,</span>
<span id="cb30-66"><a href="#cb30-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig.align =</span> <span class="st">"center"</span>,</span>
<span id="cb30-67"><a href="#cb30-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">out.width =</span> <span class="st">"90%"</span>,</span>
<span id="cb30-68"><a href="#cb30-68" aria-hidden="true" tabindex="-1"></a>  <span class="at">collapse =</span> <span class="cn">TRUE</span>,</span>
<span id="cb30-69"><a href="#cb30-69" aria-hidden="true" tabindex="-1"></a>  <span class="at">cache.extra =</span> <span class="dv">1234</span>  <span class="co"># Change number to invalidate cache</span></span>
<span id="cb30-70"><a href="#cb30-70" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-71"><a href="#cb30-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-72"><a href="#cb30-72" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(</span>
<span id="cb30-73"><a href="#cb30-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">digits =</span> <span class="dv">4</span>,</span>
<span id="cb30-74"><a href="#cb30-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">300</span>,</span>
<span id="cb30-75"><a href="#cb30-75" aria-hidden="true" tabindex="-1"></a>  <span class="at">dplyr.summarise.inform =</span> <span class="cn">FALSE</span></span>
<span id="cb30-76"><a href="#cb30-76" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-77"><a href="#cb30-77" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-78"><a href="#cb30-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-79"><a href="#cb30-79" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Natural Earth Project</span></span>
<span id="cb30-80"><a href="#cb30-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-81"><a href="#cb30-81" aria-hidden="true" tabindex="-1"></a>The <span class="co">[</span><span class="ot">Natural Earth Project</span><span class="co">](https://www.naturalearthdata.com/downloads/)</span> provides high quality public domain geographic data with all sorts of incredible detail, at three resolutions: high (1:10m), medium (1:50m), and low (1:110m). I use their data all the time in my own work and research, and <span class="co">[</span><span class="ot">the {rnaturalearth} package</span><span class="co">](http://ropensci.github.io/rnaturalearth/)</span> makes it really easy to get their data into R for immediate mapping. I mean, look at this!</span>
<span id="cb30-82"><a href="#cb30-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-85"><a href="#cb30-85" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-86"><a href="#cb30-86" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-natural-earth-world-map</span></span>
<span id="cb30-87"><a href="#cb30-87" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb30-88"><a href="#cb30-88" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 3</span></span>
<span id="cb30-89"><a href="#cb30-89" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: 100%</span></span>
<span id="cb30-90"><a href="#cb30-90" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb30-91"><a href="#cb30-91" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb30-92"><a href="#cb30-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-93"><a href="#cb30-93" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb30-94"><a href="#cb30-94" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb30-95"><a href="#cb30-95" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb30-96"><a href="#cb30-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-97"><a href="#cb30-97" aria-hidden="true" tabindex="-1"></a><span class="co"># Set some colors</span></span>
<span id="cb30-98"><a href="#cb30-98" aria-hidden="true" tabindex="-1"></a>ukr_blue <span class="ot">&lt;-</span> <span class="st">"#0057b7"</span>  <span class="co"># Blue from the Ukrainian flag</span></span>
<span id="cb30-99"><a href="#cb30-99" aria-hidden="true" tabindex="-1"></a>ukr_yellow <span class="ot">&lt;-</span> <span class="st">"#ffdd00"</span>  <span class="co"># Yellow from the Ukrainian flag</span></span>
<span id="cb30-100"><a href="#cb30-100" aria-hidden="true" tabindex="-1"></a>rus_red <span class="ot">&lt;-</span> <span class="st">"#d62718"</span>  <span class="co"># Red from the Russian flag</span></span>
<span id="cb30-101"><a href="#cb30-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-102"><a href="#cb30-102" aria-hidden="true" tabindex="-1"></a>clr_ocean <span class="ot">&lt;-</span> <span class="st">"#d9f0ff"</span></span>
<span id="cb30-103"><a href="#cb30-103" aria-hidden="true" tabindex="-1"></a>clr_land <span class="ot">&lt;-</span> <span class="st">"#facba6"</span></span>
<span id="cb30-104"><a href="#cb30-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-105"><a href="#cb30-105" aria-hidden="true" tabindex="-1"></a><span class="co"># CARTOColors Prism (https://carto.com/carto-colors/)</span></span>
<span id="cb30-106"><a href="#cb30-106" aria-hidden="true" tabindex="-1"></a>carto_prism <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb30-107"><a href="#cb30-107" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#5F4690"</span>, <span class="st">"#1D6996"</span>, <span class="st">"#38A6A5"</span>, <span class="st">"#0F8554"</span>, <span class="st">"#73AF48"</span>, <span class="st">"#EDAD08"</span>, </span>
<span id="cb30-108"><a href="#cb30-108" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#E17C05"</span>, <span class="st">"#CC503E"</span>, <span class="st">"#94346E"</span>, <span class="st">"#6F4070"</span>, <span class="st">"#994E95"</span>, <span class="st">"#666666"</span></span>
<span id="cb30-109"><a href="#cb30-109" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-110"><a href="#cb30-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-111"><a href="#cb30-111" aria-hidden="true" tabindex="-1"></a><span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="dv">110</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-112"><a href="#cb30-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(admin <span class="sc">!=</span> <span class="st">"Antarctica"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-113"><a href="#cb30-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb30-114"><a href="#cb30-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> continent), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb30-115"><a href="#cb30-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> carto_prism, <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb30-116"><a href="#cb30-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="st">"+proj=robin"</span>) <span class="sc">+</span></span>
<span id="cb30-117"><a href="#cb30-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb30-118"><a href="#cb30-118" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-119"><a href="#cb30-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-120"><a href="#cb30-120" aria-hidden="true" tabindex="-1"></a><span class="fu">### Natural Earth's *de facto* policy</span></span>
<span id="cb30-121"><a href="#cb30-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-122"><a href="#cb30-122" aria-hidden="true" tabindex="-1"></a>**Maps are intensely political things.** There are dozens of disputes over maps and land and territories (e.g., Palestine, Western Sahara, Northern Cyprus, Taiwan, Kashmir, etc.), and many UN member states don't recognize other UN member states (<span class="co">[</span><span class="ot">Israel isn't recognized by many Arab states</span><span class="co">](https://en.wikipedia.org/wiki/International_recognition_of_Israel)</span>; <span class="co">[</span><span class="ot">Pakistan doesn't recognize Armenia</span><span class="co">](https://en.wikipedia.org/wiki/Armenia%E2%80%93Pakistan_relations)</span>).</span>
<span id="cb30-123"><a href="#cb30-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-124"><a href="#cb30-124" aria-hidden="true" tabindex="-1"></a>The Natural Earth Project's <span class="co">[</span><span class="ot">official policy for disputed territories</span><span class="co">](https://www.naturalearthdata.com/about/disputed-boundaries-policy/)</span> is to reflect on-the-ground *de facto* <span class="co">[</span><span class="ot">control over each piece of land</span><span class="co">](https://www.naturalearthdata.com/downloads/10m-cultural-vectors/10m-admin-0-details/)</span>^[<span class="co">[</span><span class="ot">OpenStreetMap does this too</span><span class="co">](https://osmfoundation.org/w/images/d/d8/DisputedTerritoriesInformation.pdf)</span>.]:</span>
<span id="cb30-125"><a href="#cb30-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-126"><a href="#cb30-126" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Natural Earth Vector draws boundaries of sovereign states according to defacto status. We show who actually controls the situation on the ground. For instance, we show China and Taiwan as two separate states. But we show Palestine as part of Israel.</span></span>
<span id="cb30-127"><a href="#cb30-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-128"><a href="#cb30-128" aria-hidden="true" tabindex="-1"></a>Though <span class="co">[</span><span class="ot">they claim that this *de facto* policy "is rigorous and self consistent"</span><span class="co">](https://www.naturalearthdata.com/about/disputed-boundaries-policy/)</span>, it gets them in trouble a lot. For instance, there are nearly <span class="co">[</span><span class="ot">two dozen issues on GitHub</span><span class="co">](https://github.com/search?q=repo:nvkelso/natural-earth-vector+crimea&amp;type=issues)</span> about Crimea, which is <span class="co">[</span><span class="ot">illegally occupied by Russia</span><span class="co">](https://en.wikipedia.org/wiki/Annexation_of_Crimea_by_the_Russian_Federation)</span> but <span class="co">[</span><span class="ot">*de jure* part of Ukraine</span><span class="co">](https://en.wikipedia.org/wiki/Russian_occupation_of_Crimea#Annexation)</span>. <span class="co">[</span><span class="ot">There</span><span class="co">](https://github.com/nvkelso/natural-earth-vector/issues/391)</span> <span class="co">[</span><span class="ot">are</span><span class="co">](https://github.com/nvkelso/natural-earth-vector/issues/489)</span> <span class="co">[</span><span class="ot">huge</span><span class="co">](https://github.com/nvkelso/natural-earth-vector/issues/926)</span> <span class="co">[</span><span class="ot">debates</span><span class="co">](https://github.com/nvkelso/natural-earth-vector/issues/810)</span> <span class="co">[</span><span class="ot">over</span><span class="co">](https://github.com/nvkelso/natural-earth-vector/issues/812)</span> the ethics of the *de facto* policy. </span>
<span id="cb30-129"><a href="#cb30-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-130"><a href="#cb30-130" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb30-131"><a href="#cb30-131" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Treating the Natural Earth *de facto* policy as a *de facto* policy</span></span>
<span id="cb30-132"><a href="#cb30-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-133"><a href="#cb30-133" aria-hidden="true" tabindex="-1"></a>**I'm not weighing in on that policy here!** I don't super like it—it makes it really hard to map Palestine, for instance—but it is what it is. In this post I'm treating the *de facto* policy as the *de facto* situation of the data.</span>
<span id="cb30-134"><a href="#cb30-134" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb30-135"><a href="#cb30-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-136"><a href="#cb30-136" aria-hidden="true" tabindex="-1"></a><span class="fu">### Natural Earth *de jure* points of view</span></span>
<span id="cb30-137"><a href="#cb30-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-138"><a href="#cb30-138" aria-hidden="true" tabindex="-1"></a>Natural Earth's solution for disputed territories is to <span class="co">[</span><span class="ot">offer different options</span><span class="co">](https://github.com/nvkelso/natural-earth-vector/issues/391#issuecomment-890772203)</span> to reflect country-specific *de jure* points of view. They offer [pre-built high resolution shapefiles for 31 different points of views](https://www.naturalearthdata.com/blog/admin-0-countries-point-of-views/), so it's possible to download data that reflect *de jure* boundaries for a bunch of different countries. Their other shapefiles [all have columns like `fclass_us`, `fclass_ua`, and so on](https://github.com/nvkelso/natural-earth-vector/blob/master/packages/Natural_Earth_quick_start/LOCALIZATION.md#setting-boundary-pov) for doing… something?… with the point of view. **I can't figure out how these columns work** beyond localization stuff (i.e. changing place names based on the point of view). The documentation doesn't say much about how to actually use these different points of view, and <span class="co">[</span><span class="ot">pre-built medium and low resolution maps don't exist yet</span><span class="co">](https://github.com/nvkelso/natural-earth-vector/issues/875#issuecomment-1726400482)</span>.</span>
<span id="cb30-139"><a href="#cb30-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-140"><a href="#cb30-140" aria-hidden="true" tabindex="-1"></a>For example, the US doesn't *de jure*-ily recognize the Russian occupation of Crimea, so if we <span class="co">[</span><span class="ot">download the pre-built high resolution (10m) version of the world</span><span class="co">](https://www.naturalearthdata.com/blog/admin-0-countries-point-of-views/)</span> from the US point of view, we can see Crimea as part of Ukraine (we have to <span class="co">[</span><span class="ot">download this manually</span><span class="co">](https://www.naturalearthdata.com/blog/admin-0-countries-point-of-views/)</span>—<span class="in">`rnaturalearth::ne_countries()`</span> doesn't support POV files):</span>
<span id="cb30-141"><a href="#cb30-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-144"><a href="#cb30-144" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-145"><a href="#cb30-145" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-ne-us10-ukraine</span></span>
<span id="cb30-146"><a href="#cb30-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-147"><a href="#cb30-147" aria-hidden="true" tabindex="-1"></a>world_10_us <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"ne_10m_admin_0_countries_usa/ne_10m_admin_0_countries_usa.shp"</span>)</span>
<span id="cb30-148"><a href="#cb30-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-149"><a href="#cb30-149" aria-hidden="true" tabindex="-1"></a>world_10_us <span class="sc">|&gt;</span> </span>
<span id="cb30-150"><a href="#cb30-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ADMIN <span class="sc">==</span> <span class="st">"Ukraine"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-151"><a href="#cb30-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb30-152"><a href="#cb30-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">fill =</span> ukr_blue) <span class="sc">+</span></span>
<span id="cb30-153"><a href="#cb30-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb30-154"><a href="#cb30-154" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-155"><a href="#cb30-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-156"><a href="#cb30-156" aria-hidden="true" tabindex="-1"></a>Unfortunately, the pre-built point-of-view datasets <span class="co">[</span><span class="ot">only exist for the 10m high resolution data</span><span class="co">](https://github.com/nvkelso/natural-earth-vector/issues/875#issuecomment-1726400482)</span>. If we want to show medium or low resolution maps, we're stuck with the *de facto* version of the map, which means Crimea will be shown as part of Russia. Here's the low resolution version of Ukraine, with Crimea in Russia:</span>
<span id="cb30-157"><a href="#cb30-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-160"><a href="#cb30-160" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-161"><a href="#cb30-161" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-ne-110-crimea-in-russia</span></span>
<span id="cb30-162"><a href="#cb30-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-163"><a href="#cb30-163" aria-hidden="true" tabindex="-1"></a>world <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="dv">110</span>, <span class="at">type =</span> <span class="st">"map_units"</span>)</span>
<span id="cb30-164"><a href="#cb30-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-165"><a href="#cb30-165" aria-hidden="true" tabindex="-1"></a>ukraine <span class="ot">&lt;-</span> world <span class="sc">|&gt;</span> <span class="fu">filter</span>(admin <span class="sc">==</span> <span class="st">"Ukraine"</span>)</span>
<span id="cb30-166"><a href="#cb30-166" aria-hidden="true" tabindex="-1"></a>russia <span class="ot">&lt;-</span> world <span class="sc">|&gt;</span> <span class="fu">filter</span>(admin <span class="sc">==</span> <span class="st">"Russia"</span>)</span>
<span id="cb30-167"><a href="#cb30-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-168"><a href="#cb30-168" aria-hidden="true" tabindex="-1"></a>ukraine_bbox <span class="ot">&lt;-</span> ukraine <span class="sc">|&gt;</span> </span>
<span id="cb30-169"><a href="#cb30-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="at">dist =</span> <span class="dv">100000</span>) <span class="sc">|&gt;</span>  <span class="co"># Add 100,000 meter buffer around the country </span></span>
<span id="cb30-170"><a href="#cb30-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_bbox</span>()</span>
<span id="cb30-171"><a href="#cb30-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-172"><a href="#cb30-172" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb30-173"><a href="#cb30-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world, <span class="at">fill =</span> clr_land) <span class="sc">+</span></span>
<span id="cb30-174"><a href="#cb30-174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> russia, <span class="at">fill =</span> rus_red) <span class="sc">+</span> </span>
<span id="cb30-175"><a href="#cb30-175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ukraine, <span class="at">fill =</span> ukr_blue, <span class="at">color =</span> ukr_yellow, <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb30-176"><a href="#cb30-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb30-177"><a href="#cb30-177" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(ukraine_bbox[<span class="st">"xmin"</span>], ukraine_bbox[<span class="st">"xmax"</span>]), </span>
<span id="cb30-178"><a href="#cb30-178" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(ukraine_bbox[<span class="st">"ymin"</span>], ukraine_bbox[<span class="st">"ymax"</span>])</span>
<span id="cb30-179"><a href="#cb30-179" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-180"><a href="#cb30-180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb30-181"><a href="#cb30-181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> clr_ocean))</span>
<span id="cb30-182"><a href="#cb30-182" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-183"><a href="#cb30-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-184"><a href="#cb30-184" aria-hidden="true" tabindex="-1"></a><span class="fu">## Relocating Crimea manually with R and {sf}</span></span>
<span id="cb30-185"><a href="#cb30-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-186"><a href="#cb30-186" aria-hidden="true" tabindex="-1"></a>Natural Earth's recommendation is to <span class="co">[</span><span class="ot">"mashup our countries and disputed areas themes to match their particular political outlook"</span><span class="co">](https://www.naturalearthdata.com/about/disputed-boundaries-policy/)</span>, so we'll do that here. Though we won't use any of the point-of-view themes or features because I have no idea how to get those to work.</span>
<span id="cb30-187"><a href="#cb30-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-188"><a href="#cb30-188" aria-hidden="true" tabindex="-1"></a>Instead we'll manipulate the geometry data directly and move Crimea from the Russia shape to the Ukraine shape by extracting the Crimea POLYGON from Russia and merging it with Ukraine. </span>
<span id="cb30-189"><a href="#cb30-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-190"><a href="#cb30-190" aria-hidden="true" tabindex="-1"></a>The actual geometric shapes for all the countries in <span class="in">`world`</span> are MULTIPOLYGONs, or collections of POLYGON geometric objects. For instance, Russia is defined as a single MULTIPOLYGON: </span>
<span id="cb30-191"><a href="#cb30-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-194"><a href="#cb30-194" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-195"><a href="#cb30-195" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: show-russia-multipolygons</span></span>
<span id="cb30-196"><a href="#cb30-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-197"><a href="#cb30-197" aria-hidden="true" tabindex="-1"></a>russia <span class="sc">|&gt;</span> <span class="fu">st_geometry</span>()</span>
<span id="cb30-198"><a href="#cb30-198" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-199"><a href="#cb30-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-200"><a href="#cb30-200" aria-hidden="true" tabindex="-1"></a>We can split MULTIPOLYGONs into their component POLYGONs with <span class="in">`st_cast()`</span>. Russia consists of 14 different shapes:</span>
<span id="cb30-201"><a href="#cb30-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-204"><a href="#cb30-204" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-205"><a href="#cb30-205" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: show-russia-polygons</span></span>
<span id="cb30-206"><a href="#cb30-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-207"><a href="#cb30-207" aria-hidden="true" tabindex="-1"></a>russia_polygons <span class="ot">&lt;-</span> russia <span class="sc">|&gt;</span> </span>
<span id="cb30-208"><a href="#cb30-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb30-209"><a href="#cb30-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>)</span>
<span id="cb30-210"><a href="#cb30-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-211"><a href="#cb30-211" aria-hidden="true" tabindex="-1"></a>russia_polygons</span>
<span id="cb30-212"><a href="#cb30-212" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-213"><a href="#cb30-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-214"><a href="#cb30-214" aria-hidden="true" tabindex="-1"></a>The second one is the main Russia landmass:</span>
<span id="cb30-215"><a href="#cb30-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-218"><a href="#cb30-218" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-219"><a href="#cb30-219" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-main-russia-polygon</span></span>
<span id="cb30-220"><a href="#cb30-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-221"><a href="#cb30-221" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(russia_polygons[<span class="dv">2</span>])</span>
<span id="cb30-222"><a href="#cb30-222" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-223"><a href="#cb30-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-224"><a href="#cb30-224" aria-hidden="true" tabindex="-1"></a>The last one is the Crimean peninsula:</span>
<span id="cb30-225"><a href="#cb30-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-228"><a href="#cb30-228" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-229"><a href="#cb30-229" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-crimea-polygon</span></span>
<span id="cb30-230"><a href="#cb30-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-231"><a href="#cb30-231" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(russia_polygons[<span class="dv">14</span>])</span>
<span id="cb30-232"><a href="#cb30-232" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-233"><a href="#cb30-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-234"><a href="#cb30-234" aria-hidden="true" tabindex="-1"></a><span class="fu">### Identifying the Crimea POLYGON from a POINT</span></span>
<span id="cb30-235"><a href="#cb30-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-236"><a href="#cb30-236" aria-hidden="true" tabindex="-1"></a>The only way I figured out what of these POLYGONs were was to plot them individually until I saw a recognizable shape. And if I use a different map (like the 50m or 10m resolution maps), there's no guarantee that Russia will have 14 POLYGONs or that the 14th one will be Crimea. We need a more reliable way to find the Crimea shape.</span>
<span id="cb30-237"><a href="#cb30-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-238"><a href="#cb30-238" aria-hidden="true" tabindex="-1"></a>One way to do this is to create a POINT object based somewhere in Crimea and do some geometric set math to identify which Russian POLYGON contains it. The point <span class="co">[</span><span class="ot">45°N 34°E</span><span class="co">](https://maps.app.goo.gl/iEkGZkrEpEcqTmZi7)</span> happens to be in the middle of Crimea:</span>
<span id="cb30-239"><a href="#cb30-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-242"><a href="#cb30-242" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-243"><a href="#cb30-243" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-crimea-point</span></span>
<span id="cb30-244"><a href="#cb30-244" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb30-245"><a href="#cb30-245" aria-hidden="true" tabindex="-1"></a>crimea_point <span class="ot">&lt;-</span> <span class="fu">st_sfc</span>(<span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">34</span>, <span class="dv">45</span>)), <span class="at">crs =</span> <span class="fu">st_crs</span>(world))</span>
<span id="cb30-246"><a href="#cb30-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-247"><a href="#cb30-247" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb30-248"><a href="#cb30-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world, <span class="at">fill =</span> clr_land) <span class="sc">+</span></span>
<span id="cb30-249"><a href="#cb30-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> russia, <span class="at">fill =</span> rus_red) <span class="sc">+</span> </span>
<span id="cb30-250"><a href="#cb30-250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ukraine, <span class="at">fill =</span> ukr_blue, <span class="at">color =</span> ukr_yellow, <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb30-251"><a href="#cb30-251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> crimea_point) <span class="sc">+</span></span>
<span id="cb30-252"><a href="#cb30-252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb30-253"><a href="#cb30-253" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(ukraine_bbox[<span class="st">"xmin"</span>], ukraine_bbox[<span class="st">"xmax"</span>]), </span>
<span id="cb30-254"><a href="#cb30-254" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(ukraine_bbox[<span class="st">"ymin"</span>], ukraine_bbox[<span class="st">"ymax"</span>])</span>
<span id="cb30-255"><a href="#cb30-255" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-256"><a href="#cb30-256" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb30-257"><a href="#cb30-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> clr_ocean))</span>
<span id="cb30-258"><a href="#cb30-258" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-259"><a href="#cb30-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-260"><a href="#cb30-260" aria-hidden="true" tabindex="-1"></a>We can use it with <span class="in">`st_intersects()`</span> to identify the Russia POLYGON that contains it:</span>
<span id="cb30-261"><a href="#cb30-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-264"><a href="#cb30-264" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-265"><a href="#cb30-265" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-extracted-crimea-polygon</span></span>
<span id="cb30-266"><a href="#cb30-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-267"><a href="#cb30-267" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the Russia MULTIPOLYGON and convert it to polygons</span></span>
<span id="cb30-268"><a href="#cb30-268" aria-hidden="true" tabindex="-1"></a>russia_polygons <span class="ot">&lt;-</span> world <span class="sc">|&gt;</span> </span>
<span id="cb30-269"><a href="#cb30-269" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(admin <span class="sc">==</span> <span class="st">"Russia"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-270"><a href="#cb30-270" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb30-271"><a href="#cb30-271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>)</span>
<span id="cb30-272"><a href="#cb30-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-273"><a href="#cb30-273" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the Russia polygon that has Crimea in it</span></span>
<span id="cb30-274"><a href="#cb30-274" aria-hidden="true" tabindex="-1"></a>crimea_polygon <span class="ot">&lt;-</span> russia_polygons <span class="sc">|&gt;</span></span>
<span id="cb30-275"><a href="#cb30-275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">keep</span>(\(x) <span class="fu">st_intersects</span>(x, crimea_point, <span class="at">sparse =</span> <span class="cn">FALSE</span>))</span>
<span id="cb30-276"><a href="#cb30-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-277"><a href="#cb30-277" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the same as russia_polygons[14]</span></span>
<span id="cb30-278"><a href="#cb30-278" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(crimea_polygon)</span>
<span id="cb30-279"><a href="#cb30-279" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-280"><a href="#cb30-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-281"><a href="#cb30-281" aria-hidden="true" tabindex="-1"></a><span class="fu">### Extracting the Crimea POLYGON from Russia</span></span>
<span id="cb30-282"><a href="#cb30-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-283"><a href="#cb30-283" aria-hidden="true" tabindex="-1"></a>We can then remove that polygon from Russia and recombine everything back into a MULTIPOLYGON. It works!</span>
<span id="cb30-284"><a href="#cb30-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-287"><a href="#cb30-287" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-288"><a href="#cb30-288" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-crimea-removed-from-russia</span></span>
<span id="cb30-289"><a href="#cb30-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-290"><a href="#cb30-290" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove Crimea from Russia</span></span>
<span id="cb30-291"><a href="#cb30-291" aria-hidden="true" tabindex="-1"></a>new_russia <span class="ot">&lt;-</span> russia_polygons <span class="sc">|&gt;</span></span>
<span id="cb30-292"><a href="#cb30-292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">discard</span>(\(x) <span class="fu">any</span>(<span class="fu">st_equals</span>(x, crimea_polygon, <span class="at">sparse =</span> <span class="cn">FALSE</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb30-293"><a href="#cb30-293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_combine</span>() <span class="sc">|&gt;</span> </span>
<span id="cb30-294"><a href="#cb30-294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"MULTIPOLYGON"</span>)</span>
<span id="cb30-295"><a href="#cb30-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-296"><a href="#cb30-296" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb30-297"><a href="#cb30-297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world, <span class="at">fill =</span> clr_land) <span class="sc">+</span></span>
<span id="cb30-298"><a href="#cb30-298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> new_russia, <span class="at">fill =</span> rus_red) <span class="sc">+</span> </span>
<span id="cb30-299"><a href="#cb30-299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ukraine, <span class="at">fill =</span> ukr_blue, <span class="at">color =</span> ukr_yellow, <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb30-300"><a href="#cb30-300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb30-301"><a href="#cb30-301" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(ukraine_bbox[<span class="st">"xmin"</span>], ukraine_bbox[<span class="st">"xmax"</span>]), </span>
<span id="cb30-302"><a href="#cb30-302" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(ukraine_bbox[<span class="st">"ymin"</span>], ukraine_bbox[<span class="st">"ymax"</span>])</span>
<span id="cb30-303"><a href="#cb30-303" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-304"><a href="#cb30-304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb30-305"><a href="#cb30-305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> clr_ocean))</span>
<span id="cb30-306"><a href="#cb30-306" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-307"><a href="#cb30-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-308"><a href="#cb30-308" aria-hidden="true" tabindex="-1"></a><span class="fu">### Adding the Crimea POLYGON to Ukraine</span></span>
<span id="cb30-309"><a href="#cb30-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-310"><a href="#cb30-310" aria-hidden="true" tabindex="-1"></a>Next we need to merge <span class="in">`crimea_polygon`</span> with Ukraine. We'll convert Ukraine to its component POLYGONs, combine those with Crimea, and recombine everything back to a MULTIPOLYGON. It also works!</span>
<span id="cb30-311"><a href="#cb30-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-314"><a href="#cb30-314" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-315"><a href="#cb30-315" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-crimea-added-to-ukraine</span></span>
<span id="cb30-316"><a href="#cb30-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-317"><a href="#cb30-317" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the Ukraine MULTIPOLYGON and convert it to polygons</span></span>
<span id="cb30-318"><a href="#cb30-318" aria-hidden="true" tabindex="-1"></a>ukraine_polygons <span class="ot">&lt;-</span> world <span class="sc">|&gt;</span> </span>
<span id="cb30-319"><a href="#cb30-319" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(admin <span class="sc">==</span> <span class="st">"Ukraine"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-320"><a href="#cb30-320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb30-321"><a href="#cb30-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>)</span>
<span id="cb30-322"><a href="#cb30-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-323"><a href="#cb30-323" aria-hidden="true" tabindex="-1"></a><span class="co"># Add Crimea to Ukraine</span></span>
<span id="cb30-324"><a href="#cb30-324" aria-hidden="true" tabindex="-1"></a>new_ukraine <span class="ot">&lt;-</span> <span class="fu">st_union</span>(<span class="fu">c</span>(ukraine_polygons, crimea_polygon)) <span class="sc">|&gt;</span></span>
<span id="cb30-325"><a href="#cb30-325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"MULTIPOLYGON"</span>)</span>
<span id="cb30-326"><a href="#cb30-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-327"><a href="#cb30-327" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb30-328"><a href="#cb30-328" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world, <span class="at">fill =</span> clr_land) <span class="sc">+</span></span>
<span id="cb30-329"><a href="#cb30-329" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> new_russia, <span class="at">fill =</span> rus_red) <span class="sc">+</span> </span>
<span id="cb30-330"><a href="#cb30-330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> new_ukraine, <span class="at">fill =</span> ukr_blue, <span class="at">color =</span> ukr_yellow, <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb30-331"><a href="#cb30-331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb30-332"><a href="#cb30-332" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(ukraine_bbox[<span class="st">"xmin"</span>], ukraine_bbox[<span class="st">"xmax"</span>]), </span>
<span id="cb30-333"><a href="#cb30-333" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(ukraine_bbox[<span class="st">"ymin"</span>], ukraine_bbox[<span class="st">"ymax"</span>])</span>
<span id="cb30-334"><a href="#cb30-334" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-335"><a href="#cb30-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb30-336"><a href="#cb30-336" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> clr_ocean))</span>
<span id="cb30-337"><a href="#cb30-337" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-338"><a href="#cb30-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-339"><a href="#cb30-339" aria-hidden="true" tabindex="-1"></a><span class="fu">### Updating Russia and Ukraine in the full data</span></span>
<span id="cb30-340"><a href="#cb30-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-341"><a href="#cb30-341" aria-hidden="true" tabindex="-1"></a>The last step is to modify the full <span class="in">`world`</span> dataset and replace the existing geometry values for the two countries with the updated boundaries:</span>
<span id="cb30-342"><a href="#cb30-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-345"><a href="#cb30-345" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-346"><a href="#cb30-346" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: replace-geometries</span></span>
<span id="cb30-347"><a href="#cb30-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-348"><a href="#cb30-348" aria-hidden="true" tabindex="-1"></a>world_un <span class="ot">&lt;-</span> world <span class="sc">|&gt;</span></span>
<span id="cb30-349"><a href="#cb30-349" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">geometry =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-350"><a href="#cb30-350" aria-hidden="true" tabindex="-1"></a>    admin <span class="sc">==</span> <span class="st">"Ukraine"</span> <span class="sc">~</span> new_ukraine,</span>
<span id="cb30-351"><a href="#cb30-351" aria-hidden="true" tabindex="-1"></a>    admin <span class="sc">==</span> <span class="st">"Russia"</span> <span class="sc">~</span> new_russia,</span>
<span id="cb30-352"><a href="#cb30-352" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> geometry</span>
<span id="cb30-353"><a href="#cb30-353" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb30-354"><a href="#cb30-354" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-355"><a href="#cb30-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-356"><a href="#cb30-356" aria-hidden="true" tabindex="-1"></a>Now that <span class="in">`world_un`</span> has the corrected boundaries in it, it works like normal. Here's a map of Eastern Europe, colored by <span class="in">`mapcolor9`</span> (a column that comes with Natural Earth data that lets you use 9 distinct colors to fill all countries without having bordering countries share colors). Crimea is in Ukraine now:</span>
<span id="cb30-357"><a href="#cb30-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-360"><a href="#cb30-360" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-361"><a href="#cb30-361" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-eastern-europe-110</span></span>
<span id="cb30-362"><a href="#cb30-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-363"><a href="#cb30-363" aria-hidden="true" tabindex="-1"></a>eastern_eu_bbox <span class="ot">&lt;-</span> ukraine <span class="sc">|&gt;</span> </span>
<span id="cb30-364"><a href="#cb30-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="at">dist =</span> <span class="dv">700000</span>) <span class="sc">|&gt;</span>  <span class="co"># Add 700,000 meter buffer around the country </span></span>
<span id="cb30-365"><a href="#cb30-365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_bbox</span>()</span>
<span id="cb30-366"><a href="#cb30-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-367"><a href="#cb30-367" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb30-368"><a href="#cb30-368" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world_un, <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">factor</span>(mapcolor9)), <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb30-369"><a href="#cb30-369" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> carto_prism, <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb30-370"><a href="#cb30-370" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb30-371"><a href="#cb30-371" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(eastern_eu_bbox[<span class="st">"xmin"</span>], eastern_eu_bbox[<span class="st">"xmax"</span>]), </span>
<span id="cb30-372"><a href="#cb30-372" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(eastern_eu_bbox[<span class="st">"ymin"</span>], eastern_eu_bbox[<span class="st">"ymax"</span>])</span>
<span id="cb30-373"><a href="#cb30-373" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-374"><a href="#cb30-374" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb30-375"><a href="#cb30-375" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> clr_ocean))</span>
<span id="cb30-376"><a href="#cb30-376" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-377"><a href="#cb30-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-378"><a href="#cb30-378" aria-hidden="true" tabindex="-1"></a><span class="fu">### The whole game</span></span>
<span id="cb30-379"><a href="#cb30-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-380"><a href="#cb30-380" aria-hidden="true" tabindex="-1"></a>Everything above was fairly didactic, with illustrations at each intermediate step. Here's the whole process all in one place:</span>
<span id="cb30-381"><a href="#cb30-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-384"><a href="#cb30-384" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-385"><a href="#cb30-385" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: whole-game-110</span></span>
<span id="cb30-386"><a href="#cb30-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-387"><a href="#cb30-387" aria-hidden="true" tabindex="-1"></a>world_110 <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="dv">110</span>, <span class="at">type =</span> <span class="st">"map_units"</span>)</span>
<span id="cb30-388"><a href="#cb30-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-389"><a href="#cb30-389" aria-hidden="true" tabindex="-1"></a>crimea_point_110 <span class="ot">&lt;-</span> <span class="fu">st_sfc</span>(<span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">34</span>, <span class="dv">45</span>)), <span class="at">crs =</span> <span class="fu">st_crs</span>(world_110))</span>
<span id="cb30-390"><a href="#cb30-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-391"><a href="#cb30-391" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the Russia MULTIPOLYGON and convert it to polygons</span></span>
<span id="cb30-392"><a href="#cb30-392" aria-hidden="true" tabindex="-1"></a>russia_polygons_110 <span class="ot">&lt;-</span> world_110 <span class="sc">|&gt;</span> </span>
<span id="cb30-393"><a href="#cb30-393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(admin <span class="sc">==</span> <span class="st">"Russia"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-394"><a href="#cb30-394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb30-395"><a href="#cb30-395" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>)</span>
<span id="cb30-396"><a href="#cb30-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-397"><a href="#cb30-397" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the Russia polygon that has Crimea in it</span></span>
<span id="cb30-398"><a href="#cb30-398" aria-hidden="true" tabindex="-1"></a>crimea_polygon_110 <span class="ot">&lt;-</span> russia_polygons_110 <span class="sc">|&gt;</span></span>
<span id="cb30-399"><a href="#cb30-399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">keep</span>(\(x) <span class="fu">st_intersects</span>(x, crimea_point_110, <span class="at">sparse =</span> <span class="cn">FALSE</span>))</span>
<span id="cb30-400"><a href="#cb30-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-401"><a href="#cb30-401" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove Crimea from Russia</span></span>
<span id="cb30-402"><a href="#cb30-402" aria-hidden="true" tabindex="-1"></a>new_russia_110 <span class="ot">&lt;-</span> russia_polygons_110 <span class="sc">|&gt;</span></span>
<span id="cb30-403"><a href="#cb30-403" aria-hidden="true" tabindex="-1"></a>  <span class="fu">discard</span>(\(x) <span class="fu">any</span>(<span class="fu">st_equals</span>(x, crimea_polygon_110, <span class="at">sparse =</span> <span class="cn">FALSE</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb30-404"><a href="#cb30-404" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_combine</span>() <span class="sc">|&gt;</span> </span>
<span id="cb30-405"><a href="#cb30-405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"MULTIPOLYGON"</span>)</span>
<span id="cb30-406"><a href="#cb30-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-407"><a href="#cb30-407" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the Ukraine MULTIPOLYGON and convert it to polygons</span></span>
<span id="cb30-408"><a href="#cb30-408" aria-hidden="true" tabindex="-1"></a>ukraine_polygons_110 <span class="ot">&lt;-</span> world_110 <span class="sc">|&gt;</span> </span>
<span id="cb30-409"><a href="#cb30-409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(admin <span class="sc">==</span> <span class="st">"Ukraine"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-410"><a href="#cb30-410" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb30-411"><a href="#cb30-411" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>)</span>
<span id="cb30-412"><a href="#cb30-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-413"><a href="#cb30-413" aria-hidden="true" tabindex="-1"></a><span class="co"># Add Crimea to Ukraine</span></span>
<span id="cb30-414"><a href="#cb30-414" aria-hidden="true" tabindex="-1"></a>new_ukraine_110 <span class="ot">&lt;-</span> <span class="fu">st_union</span>(<span class="fu">c</span>(ukraine_polygons_110, crimea_polygon_110)) <span class="sc">|&gt;</span></span>
<span id="cb30-415"><a href="#cb30-415" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"MULTIPOLYGON"</span>)</span>
<span id="cb30-416"><a href="#cb30-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-417"><a href="#cb30-417" aria-hidden="true" tabindex="-1"></a>world_un_110 <span class="ot">&lt;-</span> world_110 <span class="sc">|&gt;</span></span>
<span id="cb30-418"><a href="#cb30-418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">geometry =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-419"><a href="#cb30-419" aria-hidden="true" tabindex="-1"></a>    admin <span class="sc">==</span> <span class="st">"Ukraine"</span> <span class="sc">~</span> new_ukraine_110,</span>
<span id="cb30-420"><a href="#cb30-420" aria-hidden="true" tabindex="-1"></a>    admin <span class="sc">==</span> <span class="st">"Russia"</span> <span class="sc">~</span> new_russia_110,</span>
<span id="cb30-421"><a href="#cb30-421" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> geometry</span>
<span id="cb30-422"><a href="#cb30-422" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb30-423"><a href="#cb30-423" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-424"><a href="#cb30-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-425"><a href="#cb30-425" aria-hidden="true" tabindex="-1"></a><span class="fu">### Moving Crimea with medium resolution (50m) data</span></span>
<span id="cb30-426"><a href="#cb30-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-427"><a href="#cb30-427" aria-hidden="true" tabindex="-1"></a>This same approach works for other map resolutions too, like 50m:</span>
<span id="cb30-428"><a href="#cb30-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-431"><a href="#cb30-431" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-432"><a href="#cb30-432" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: whole-game-50</span></span>
<span id="cb30-433"><a href="#cb30-433" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb30-434"><a href="#cb30-434" aria-hidden="true" tabindex="-1"></a>world_50 <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="dv">50</span>, <span class="at">type =</span> <span class="st">"map_units"</span>)</span>
<span id="cb30-435"><a href="#cb30-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-436"><a href="#cb30-436" aria-hidden="true" tabindex="-1"></a>crimea_point_50 <span class="ot">&lt;-</span> <span class="fu">st_sfc</span>(<span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">34</span>, <span class="dv">45</span>)), <span class="at">crs =</span> <span class="fu">st_crs</span>(world_50))</span>
<span id="cb30-437"><a href="#cb30-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-438"><a href="#cb30-438" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the Russia MULTIPOLYGON and convert it to polygons</span></span>
<span id="cb30-439"><a href="#cb30-439" aria-hidden="true" tabindex="-1"></a>russia_polygons_50 <span class="ot">&lt;-</span> world_50 <span class="sc">|&gt;</span> </span>
<span id="cb30-440"><a href="#cb30-440" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(admin <span class="sc">==</span> <span class="st">"Russia"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-441"><a href="#cb30-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb30-442"><a href="#cb30-442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>)</span>
<span id="cb30-443"><a href="#cb30-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-444"><a href="#cb30-444" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the Russia polygon that has Crimea in it</span></span>
<span id="cb30-445"><a href="#cb30-445" aria-hidden="true" tabindex="-1"></a>crimea_polygon_50 <span class="ot">&lt;-</span> russia_polygons_50 <span class="sc">|&gt;</span></span>
<span id="cb30-446"><a href="#cb30-446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">keep</span>(\(x) <span class="fu">st_intersects</span>(x, crimea_point_50, <span class="at">sparse =</span> <span class="cn">FALSE</span>))</span>
<span id="cb30-447"><a href="#cb30-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-448"><a href="#cb30-448" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove Crimea from Russia</span></span>
<span id="cb30-449"><a href="#cb30-449" aria-hidden="true" tabindex="-1"></a>new_russia_50 <span class="ot">&lt;-</span> russia_polygons_50 <span class="sc">|&gt;</span></span>
<span id="cb30-450"><a href="#cb30-450" aria-hidden="true" tabindex="-1"></a>  <span class="fu">discard</span>(\(x) <span class="fu">any</span>(<span class="fu">st_equals</span>(x, crimea_polygon_50, <span class="at">sparse =</span> <span class="cn">FALSE</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb30-451"><a href="#cb30-451" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_combine</span>() <span class="sc">|&gt;</span> </span>
<span id="cb30-452"><a href="#cb30-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"MULTIPOLYGON"</span>)</span>
<span id="cb30-453"><a href="#cb30-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-454"><a href="#cb30-454" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the Ukraine MULTIPOLYGON and convert it to polygons</span></span>
<span id="cb30-455"><a href="#cb30-455" aria-hidden="true" tabindex="-1"></a>ukraine_polygons_50 <span class="ot">&lt;-</span> world_50 <span class="sc">|&gt;</span> </span>
<span id="cb30-456"><a href="#cb30-456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(admin <span class="sc">==</span> <span class="st">"Ukraine"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-457"><a href="#cb30-457" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb30-458"><a href="#cb30-458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>)</span>
<span id="cb30-459"><a href="#cb30-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-460"><a href="#cb30-460" aria-hidden="true" tabindex="-1"></a><span class="co"># Add Crimea to Ukraine</span></span>
<span id="cb30-461"><a href="#cb30-461" aria-hidden="true" tabindex="-1"></a>new_ukraine_50 <span class="ot">&lt;-</span> <span class="fu">st_union</span>(<span class="fu">c</span>(ukraine_polygons_50, crimea_polygon_50)) <span class="sc">|&gt;</span></span>
<span id="cb30-462"><a href="#cb30-462" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"MULTIPOLYGON"</span>)</span>
<span id="cb30-463"><a href="#cb30-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-464"><a href="#cb30-464" aria-hidden="true" tabindex="-1"></a>world_un_50 <span class="ot">&lt;-</span> world_50 <span class="sc">|&gt;</span></span>
<span id="cb30-465"><a href="#cb30-465" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">geometry =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-466"><a href="#cb30-466" aria-hidden="true" tabindex="-1"></a>    admin <span class="sc">==</span> <span class="st">"Ukraine"</span> <span class="sc">~</span> new_ukraine_50,</span>
<span id="cb30-467"><a href="#cb30-467" aria-hidden="true" tabindex="-1"></a>    admin <span class="sc">==</span> <span class="st">"Russia"</span> <span class="sc">~</span> new_russia_50,</span>
<span id="cb30-468"><a href="#cb30-468" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> geometry</span>
<span id="cb30-469"><a href="#cb30-469" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb30-470"><a href="#cb30-470" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-471"><a href="#cb30-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-472"><a href="#cb30-472" aria-hidden="true" tabindex="-1"></a>Here's a higher quality map of Eastern Europe with Crimea in Ukraine:</span>
<span id="cb30-473"><a href="#cb30-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-476"><a href="#cb30-476" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-477"><a href="#cb30-477" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-eastern-europe-50</span></span>
<span id="cb30-478"><a href="#cb30-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-479"><a href="#cb30-479" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb30-480"><a href="#cb30-480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world_un_50, <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">factor</span>(mapcolor9)), <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb30-481"><a href="#cb30-481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> carto_prism, <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb30-482"><a href="#cb30-482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb30-483"><a href="#cb30-483" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(eastern_eu_bbox[<span class="st">"xmin"</span>], eastern_eu_bbox[<span class="st">"xmax"</span>]), </span>
<span id="cb30-484"><a href="#cb30-484" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(eastern_eu_bbox[<span class="st">"ymin"</span>], eastern_eu_bbox[<span class="st">"ymax"</span>])</span>
<span id="cb30-485"><a href="#cb30-485" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-486"><a href="#cb30-486" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb30-487"><a href="#cb30-487" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> clr_ocean))</span>
<span id="cb30-488"><a href="#cb30-488" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-489"><a href="#cb30-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-490"><a href="#cb30-490" aria-hidden="true" tabindex="-1"></a><span class="fu">## Using the adjusted Natural Earth data as GeoJSON in Observable JS</span></span>
<span id="cb30-491"><a href="#cb30-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-492"><a href="#cb30-492" aria-hidden="true" tabindex="-1"></a>This updated shapefile works with Observable Plot too (<span class="co">[</span><span class="ot">see here for more about how to make nice maps with Observable</span><span class="co">](https://www.andrewheiss.com/blog/2025/02/10/usaid-ojs-maps/)</span>), but requires one strange tweak because of weird behavior with the GeoJSON file format.</span>
<span id="cb30-493"><a href="#cb30-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-494"><a href="#cb30-494" aria-hidden="true" tabindex="-1"></a><span class="fu">### Broken GeoJSON</span></span>
<span id="cb30-495"><a href="#cb30-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-496"><a href="#cb30-496" aria-hidden="true" tabindex="-1"></a>Let's export the adjusted geographic data to GeoJSON:</span>
<span id="cb30-497"><a href="#cb30-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-500"><a href="#cb30-500" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-501"><a href="#cb30-501" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: save-broken-geojson</span></span>
<span id="cb30-502"><a href="#cb30-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-503"><a href="#cb30-503" aria-hidden="true" tabindex="-1"></a><span class="co"># Save as geojson for Observable Plot</span></span>
<span id="cb30-504"><a href="#cb30-504" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(</span>
<span id="cb30-505"><a href="#cb30-505" aria-hidden="true" tabindex="-1"></a>  <span class="at">obj =</span> world_un, </span>
<span id="cb30-506"><a href="#cb30-506" aria-hidden="true" tabindex="-1"></a>  <span class="at">dsn =</span> <span class="st">"ne_110m_admin_0_countries_un_BROKEN.geojson"</span>, </span>
<span id="cb30-507"><a href="#cb30-507" aria-hidden="true" tabindex="-1"></a>  <span class="at">driver =</span> <span class="st">"GeoJSON"</span>,</span>
<span id="cb30-508"><a href="#cb30-508" aria-hidden="true" tabindex="-1"></a>  <span class="at">quiet =</span> <span class="cn">TRUE</span>,</span>
<span id="cb30-509"><a href="#cb30-509" aria-hidden="true" tabindex="-1"></a>  <span class="at">delete_dsn =</span> <span class="cn">TRUE</span>  <span class="co"># Overwrite the existing .geojson if there is one</span></span>
<span id="cb30-510"><a href="#cb30-510" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-511"><a href="#cb30-511" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-512"><a href="#cb30-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-513"><a href="#cb30-513" aria-hidden="true" tabindex="-1"></a>And then load it with Observable JS:</span>
<span id="cb30-514"><a href="#cb30-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-517"><a href="#cb30-517" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb30-518"><a href="#cb30-518" aria-hidden="true" tabindex="-1"></a><span class="in">//| label: load-broken-data</span></span>
<span id="cb30-519"><a href="#cb30-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-520"><a href="#cb30-520" aria-hidden="true" tabindex="-1"></a><span class="in">world_broken = FileAttachment("ne_110m_admin_0_countries_un_BROKEN.geojson").json()</span></span>
<span id="cb30-521"><a href="#cb30-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-522"><a href="#cb30-522" aria-hidden="true" tabindex="-1"></a><span class="in">clr_ocean = "#d9f0ff"</span></span>
<span id="cb30-523"><a href="#cb30-523" aria-hidden="true" tabindex="-1"></a><span class="in">clr_land = "#facba6"</span></span>
<span id="cb30-524"><a href="#cb30-524" aria-hidden="true" tabindex="-1"></a><span class="in">ukr_blue = "#0057b7"</span></span>
<span id="cb30-525"><a href="#cb30-525" aria-hidden="true" tabindex="-1"></a><span class="in">ukr_yellow = "#ffdd00"</span></span>
<span id="cb30-526"><a href="#cb30-526" aria-hidden="true" tabindex="-1"></a><span class="in">rus_red = "#d62718"</span></span>
<span id="cb30-527"><a href="#cb30-527" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-528"><a href="#cb30-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-529"><a href="#cb30-529" aria-hidden="true" tabindex="-1"></a>And then plot it:</span>
<span id="cb30-530"><a href="#cb30-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-533"><a href="#cb30-533" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb30-534"><a href="#cb30-534" aria-hidden="true" tabindex="-1"></a><span class="in">//| label: plot-broken-world</span></span>
<span id="cb30-535"><a href="#cb30-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-536"><a href="#cb30-536" aria-hidden="true" tabindex="-1"></a><span class="in">Plot.plot({</span></span>
<span id="cb30-537"><a href="#cb30-537" aria-hidden="true" tabindex="-1"></a><span class="in">  projection: "equal-earth",</span></span>
<span id="cb30-538"><a href="#cb30-538" aria-hidden="true" tabindex="-1"></a><span class="in">  marks: [</span></span>
<span id="cb30-539"><a href="#cb30-539" aria-hidden="true" tabindex="-1"></a><span class="in">    Plot.sphere({ fill: clr_ocean }),</span></span>
<span id="cb30-540"><a href="#cb30-540" aria-hidden="true" tabindex="-1"></a><span class="in">    Plot.geo(world_broken, {</span></span>
<span id="cb30-541"><a href="#cb30-541" aria-hidden="true" tabindex="-1"></a><span class="in">      stroke: "black",</span></span>
<span id="cb30-542"><a href="#cb30-542" aria-hidden="true" tabindex="-1"></a><span class="in">      strokeWidth: 0.5,</span></span>
<span id="cb30-543"><a href="#cb30-543" aria-hidden="true" tabindex="-1"></a><span class="in">      fill: clr_land</span></span>
<span id="cb30-544"><a href="#cb30-544" aria-hidden="true" tabindex="-1"></a><span class="in">    }) </span></span>
<span id="cb30-545"><a href="#cb30-545" aria-hidden="true" tabindex="-1"></a><span class="in">  ]</span></span>
<span id="cb30-546"><a href="#cb30-546" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb30-547"><a href="#cb30-547" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-548"><a href="#cb30-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-549"><a href="#cb30-549" aria-hidden="true" tabindex="-1"></a>lol what even. The new Ukraine shape seems to have broken boundaries that distort everything else in the map. Weirdly, Ukraine is filled with the ocean color while the rest of the globe—both the ocean and whatever countries didn't have their borders erased—is the color of land.</span>
<span id="cb30-550"><a href="#cb30-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-551"><a href="#cb30-551" aria-hidden="true" tabindex="-1"></a>Let's zoom in on just Ukraine:</span>
<span id="cb30-552"><a href="#cb30-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-555"><a href="#cb30-555" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb30-556"><a href="#cb30-556" aria-hidden="true" tabindex="-1"></a><span class="in">//| label: plot-broken-ukraine</span></span>
<span id="cb30-557"><a href="#cb30-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-558"><a href="#cb30-558" aria-hidden="true" tabindex="-1"></a><span class="in">ukraine = world_broken.features.find(d =&gt; d.properties.name === "Ukraine")</span></span>
<span id="cb30-559"><a href="#cb30-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-560"><a href="#cb30-560" aria-hidden="true" tabindex="-1"></a><span class="in">Plot.plot({</span></span>
<span id="cb30-561"><a href="#cb30-561" aria-hidden="true" tabindex="-1"></a><span class="in">  projection: { </span></span>
<span id="cb30-562"><a href="#cb30-562" aria-hidden="true" tabindex="-1"></a><span class="in">    type: "equal-earth", </span></span>
<span id="cb30-563"><a href="#cb30-563" aria-hidden="true" tabindex="-1"></a><span class="in">    domain: ukraine, </span></span>
<span id="cb30-564"><a href="#cb30-564" aria-hidden="true" tabindex="-1"></a><span class="in">    inset: 50 </span></span>
<span id="cb30-565"><a href="#cb30-565" aria-hidden="true" tabindex="-1"></a><span class="in">  }, </span></span>
<span id="cb30-566"><a href="#cb30-566" aria-hidden="true" tabindex="-1"></a><span class="in">  width: 800, </span></span>
<span id="cb30-567"><a href="#cb30-567" aria-hidden="true" tabindex="-1"></a><span class="in">  marks: [</span></span>
<span id="cb30-568"><a href="#cb30-568" aria-hidden="true" tabindex="-1"></a><span class="in">    Plot.sphere({ fill: clr_ocean }),</span></span>
<span id="cb30-569"><a href="#cb30-569" aria-hidden="true" tabindex="-1"></a><span class="in">    Plot.geo(world_broken, {</span></span>
<span id="cb30-570"><a href="#cb30-570" aria-hidden="true" tabindex="-1"></a><span class="in">      stroke: "black",</span></span>
<span id="cb30-571"><a href="#cb30-571" aria-hidden="true" tabindex="-1"></a><span class="in">      strokeWidth: 0.5,</span></span>
<span id="cb30-572"><a href="#cb30-572" aria-hidden="true" tabindex="-1"></a><span class="in">      fill: clr_land</span></span>
<span id="cb30-573"><a href="#cb30-573" aria-hidden="true" tabindex="-1"></a><span class="in">    }),</span></span>
<span id="cb30-574"><a href="#cb30-574" aria-hidden="true" tabindex="-1"></a><span class="in">    Plot.geo(ukraine, { fill: ukr_blue })</span></span>
<span id="cb30-575"><a href="#cb30-575" aria-hidden="true" tabindex="-1"></a><span class="in">  ]</span></span>
<span id="cb30-576"><a href="#cb30-576" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb30-577"><a href="#cb30-577" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-578"><a href="#cb30-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-579"><a href="#cb30-579" aria-hidden="true" tabindex="-1"></a>¯<span class="sc">\\\_</span>(ツ)<span class="sc">\_</span>/¯. Now Ukraine is the color of the ocean and the whole rest of the world is the dark blue of the Ukrainian flag. And it didn't zoom in at all.</span>
<span id="cb30-580"><a href="#cb30-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-581"><a href="#cb30-581" aria-hidden="true" tabindex="-1"></a><span class="fu">### GeoJSON and ↻ ↺ winding order ↻ ↺</span></span>
<span id="cb30-582"><a href="#cb30-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-583"><a href="#cb30-583" aria-hidden="true" tabindex="-1"></a>This is a symptom of an issue with <span class="co">[</span><span class="ot">GeoJSON winding order</span><span class="co">](https://macwright.com/2015/03/23/geojson-second-bite#winding)</span>. GeoJSON cares about the direction that country borders (and all LINESTRING elements) are drawn in. Exterior borders should be drawn counterclockwise; interior borders should be drawn clockwise. If a geographic shape doesn't follow this winding order, bad things happen. Specifically:</span>
<span id="cb30-584"><a href="#cb30-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-585"><a href="#cb30-585" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; a shape that represents a tiny speck of land becomes inflated to represent the whole globe minus that tiny speck of land, the map fills with a uniform color, the local projection explodes. (via </span><span class="co">[</span><span class="ot">\@fil</span><span class="co">](https://observablehq.com/@fil/rewind)</span><span class="at">)</span></span>
<span id="cb30-586"><a href="#cb30-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-587"><a href="#cb30-587" aria-hidden="true" tabindex="-1"></a>That's exactly what's happening here. Somehow the winding order is getting reversed when we combine Ukraine with Crimea. {sf} itself doesn't care about winding order, so everything works fine within R; GeoJSON is picky about winding order, so things break.</span>
<span id="cb30-588"><a href="#cb30-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-589"><a href="#cb30-589" aria-hidden="true" tabindex="-1"></a>Fixing it is tricky though! {sf} uses a bunch of different libraries behind the scenes to do its geographic calculations, including <span class="co">[</span><span class="ot">GEOS</span><span class="co">](https://libgeos.org/)</span> and <span class="co">[</span><span class="ot">S2</span><span class="co">](http://s2geometry.io/)</span>, and they all have different approaches to polygon creation. Apparently <span class="co">[</span><span class="ot">GEOS goes clockwise by default</span><span class="co">](https://github.com/r-spatial/sf/issues/2096#issuecomment-1426480037)</span> while others go counterclockwise, or something. It should theoretically be possible to fix by adding <span class="in">`st_sfc(check_ring_dir = TRUE)`</span> after making the new Ukraine shape:</span>
<span id="cb30-590"><a href="#cb30-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-591"><a href="#cb30-591" aria-hidden="true" tabindex="-1"></a><span class="in">```{.r}</span></span>
<span id="cb30-592"><a href="#cb30-592" aria-hidden="true" tabindex="-1"></a><span class="in"># It would be cool if this worked but it doesn't :(</span></span>
<span id="cb30-593"><a href="#cb30-593" aria-hidden="true" tabindex="-1"></a><span class="in">new_ukraine &lt;- st_union(c(ukraine_polygons, crimea_polygon)) |&gt;</span></span>
<span id="cb30-594"><a href="#cb30-594" aria-hidden="true" tabindex="-1"></a><span class="in">  st_sfc(check_ring_dir = TRUE) |&gt; </span></span>
<span id="cb30-595"><a href="#cb30-595" aria-hidden="true" tabindex="-1"></a><span class="in">  st_cast("MULTIPOLYGON")</span></span>
<span id="cb30-596"><a href="#cb30-596" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-597"><a href="#cb30-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-598"><a href="#cb30-598" aria-hidden="true" tabindex="-1"></a>But that doesn't change anything (<span class="co">[</span><span class="ot">nor does it work for this person at GitHub</span><span class="co">](https://github.com/r-spatial/sf/issues/2096#issuecomment-2269379942)</span>).</span>
<span id="cb30-599"><a href="#cb30-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-600"><a href="#cb30-600" aria-hidden="true" tabindex="-1"></a><span class="fu">### Clean GeoJSON with correct winding order</span></span>
<span id="cb30-601"><a href="#cb30-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-602"><a href="#cb30-602" aria-hidden="true" tabindex="-1"></a>BUT there's another solution. We can force {sf} to *not* use the S2 library (which it uses by default, I guess?), since S2 seems go in the wrong direction. If we turn off S2 with <span class="in">`sf_use_s2(FALSE)`</span>, make the new Ukraine shape, and then turn S2 back on with <span class="in">`sf_use_s2(TRUE)`</span>, things work!</span>
<span id="cb30-603"><a href="#cb30-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-604"><a href="#cb30-604" aria-hidden="true" tabindex="-1"></a><span class="in">```{.r}</span></span>
<span id="cb30-605"><a href="#cb30-605" aria-hidden="true" tabindex="-1"></a><span class="in"># Add Crimea to Ukraine</span></span>
<span id="cb30-606"><a href="#cb30-606" aria-hidden="true" tabindex="-1"></a><span class="in">sf_use_s2(FALSE)</span></span>
<span id="cb30-607"><a href="#cb30-607" aria-hidden="true" tabindex="-1"></a><span class="in">new_ukraine_110 &lt;- st_union(c(ukraine_polygons_110, crimea_polygon_110)) |&gt;</span></span>
<span id="cb30-608"><a href="#cb30-608" aria-hidden="true" tabindex="-1"></a><span class="in">  st_cast("MULTIPOLYGON")</span></span>
<span id="cb30-609"><a href="#cb30-609" aria-hidden="true" tabindex="-1"></a><span class="in">sf_use_s2(TRUE)</span></span>
<span id="cb30-610"><a href="#cb30-610" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-611"><a href="#cb30-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-612"><a href="#cb30-612" aria-hidden="true" tabindex="-1"></a>Here's the full process with the 110m map:</span>
<span id="cb30-613"><a href="#cb30-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-616"><a href="#cb30-616" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-617"><a href="#cb30-617" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fix-winding-direction</span></span>
<span id="cb30-618"><a href="#cb30-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-619"><a href="#cb30-619" aria-hidden="true" tabindex="-1"></a>world_110 <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="dv">110</span>, <span class="at">type =</span> <span class="st">"map_units"</span>)</span>
<span id="cb30-620"><a href="#cb30-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-621"><a href="#cb30-621" aria-hidden="true" tabindex="-1"></a>crimea_point_110 <span class="ot">&lt;-</span> <span class="fu">st_sfc</span>(<span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">34</span>, <span class="dv">45</span>)), <span class="at">crs =</span> <span class="fu">st_crs</span>(world_110))</span>
<span id="cb30-622"><a href="#cb30-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-623"><a href="#cb30-623" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the Russia MULTIPOLYGON and convert it to polygons</span></span>
<span id="cb30-624"><a href="#cb30-624" aria-hidden="true" tabindex="-1"></a>russia_polygons_110 <span class="ot">&lt;-</span> world_110 <span class="sc">|&gt;</span> </span>
<span id="cb30-625"><a href="#cb30-625" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(admin <span class="sc">==</span> <span class="st">"Russia"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-626"><a href="#cb30-626" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb30-627"><a href="#cb30-627" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>)</span>
<span id="cb30-628"><a href="#cb30-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-629"><a href="#cb30-629" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the Russia polygon that has Crimea in it</span></span>
<span id="cb30-630"><a href="#cb30-630" aria-hidden="true" tabindex="-1"></a>crimea_polygon_110 <span class="ot">&lt;-</span> russia_polygons_110 <span class="sc">|&gt;</span></span>
<span id="cb30-631"><a href="#cb30-631" aria-hidden="true" tabindex="-1"></a>  <span class="fu">keep</span>(\(x) <span class="fu">st_intersects</span>(x, crimea_point_110, <span class="at">sparse =</span> <span class="cn">FALSE</span>))</span>
<span id="cb30-632"><a href="#cb30-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-633"><a href="#cb30-633" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the Ukraine MULTIPOLYGON and convert it to polygons</span></span>
<span id="cb30-634"><a href="#cb30-634" aria-hidden="true" tabindex="-1"></a>ukraine_polygons_110 <span class="ot">&lt;-</span> world_110 <span class="sc">|&gt;</span> </span>
<span id="cb30-635"><a href="#cb30-635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(admin <span class="sc">==</span> <span class="st">"Ukraine"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-636"><a href="#cb30-636" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb30-637"><a href="#cb30-637" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>)</span>
<span id="cb30-638"><a href="#cb30-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-639"><a href="#cb30-639" aria-hidden="true" tabindex="-1"></a><span class="co"># Add Crimea to Ukraine</span></span>
<span id="cb30-640"><a href="#cb30-640" aria-hidden="true" tabindex="-1"></a><span class="fu">sf_use_s2</span>(<span class="cn">FALSE</span>)</span>
<span id="cb30-641"><a href="#cb30-641" aria-hidden="true" tabindex="-1"></a>new_ukraine_110 <span class="ot">&lt;-</span> <span class="fu">st_union</span>(<span class="fu">c</span>(ukraine_polygons_110, crimea_polygon_110)) <span class="sc">|&gt;</span></span>
<span id="cb30-642"><a href="#cb30-642" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"MULTIPOLYGON"</span>)</span>
<span id="cb30-643"><a href="#cb30-643" aria-hidden="true" tabindex="-1"></a><span class="fu">sf_use_s2</span>(<span class="cn">TRUE</span>)</span>
<span id="cb30-644"><a href="#cb30-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-645"><a href="#cb30-645" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove Crimea from Russia</span></span>
<span id="cb30-646"><a href="#cb30-646" aria-hidden="true" tabindex="-1"></a>new_russia_110 <span class="ot">&lt;-</span> russia_polygons_110 <span class="sc">|&gt;</span></span>
<span id="cb30-647"><a href="#cb30-647" aria-hidden="true" tabindex="-1"></a>  <span class="fu">discard</span>(\(x) <span class="fu">any</span>(<span class="fu">st_equals</span>(x, crimea_polygon_110, <span class="at">sparse =</span> <span class="cn">FALSE</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb30-648"><a href="#cb30-648" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_combine</span>() <span class="sc">|&gt;</span> </span>
<span id="cb30-649"><a href="#cb30-649" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"MULTIPOLYGON"</span>)</span>
<span id="cb30-650"><a href="#cb30-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-651"><a href="#cb30-651" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the modified Russia and Ukraine to the main data</span></span>
<span id="cb30-652"><a href="#cb30-652" aria-hidden="true" tabindex="-1"></a>world_un_110_fixed <span class="ot">&lt;-</span> world_110 <span class="sc">|&gt;</span></span>
<span id="cb30-653"><a href="#cb30-653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">geometry =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-654"><a href="#cb30-654" aria-hidden="true" tabindex="-1"></a>    admin <span class="sc">==</span> <span class="st">"Ukraine"</span> <span class="sc">~</span> new_ukraine_110,</span>
<span id="cb30-655"><a href="#cb30-655" aria-hidden="true" tabindex="-1"></a>    admin <span class="sc">==</span> <span class="st">"Russia"</span> <span class="sc">~</span> new_russia_110,</span>
<span id="cb30-656"><a href="#cb30-656" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> geometry</span>
<span id="cb30-657"><a href="#cb30-657" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb30-658"><a href="#cb30-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-659"><a href="#cb30-659" aria-hidden="true" tabindex="-1"></a><span class="co"># Save as GeoJSON</span></span>
<span id="cb30-660"><a href="#cb30-660" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(</span>
<span id="cb30-661"><a href="#cb30-661" aria-hidden="true" tabindex="-1"></a>  <span class="at">obj =</span> world_un_110_fixed, </span>
<span id="cb30-662"><a href="#cb30-662" aria-hidden="true" tabindex="-1"></a>  <span class="at">dsn =</span> <span class="st">"ne_110m_admin_0_countries_un.geojson"</span>, </span>
<span id="cb30-663"><a href="#cb30-663" aria-hidden="true" tabindex="-1"></a>  <span class="at">driver =</span> <span class="st">"GeoJSON"</span>,</span>
<span id="cb30-664"><a href="#cb30-664" aria-hidden="true" tabindex="-1"></a>  <span class="at">quiet =</span> <span class="cn">TRUE</span>,</span>
<span id="cb30-665"><a href="#cb30-665" aria-hidden="true" tabindex="-1"></a>  <span class="at">delete_dsn =</span> <span class="cn">TRUE</span></span>
<span id="cb30-666"><a href="#cb30-666" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-667"><a href="#cb30-667" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-668"><a href="#cb30-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-669"><a href="#cb30-669" aria-hidden="true" tabindex="-1"></a>Here's the new world map with the the correct Ukraine:</span>
<span id="cb30-670"><a href="#cb30-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-673"><a href="#cb30-673" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb30-674"><a href="#cb30-674" aria-hidden="true" tabindex="-1"></a><span class="in">//| label: plot-fixed-world</span></span>
<span id="cb30-675"><a href="#cb30-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-676"><a href="#cb30-676" aria-hidden="true" tabindex="-1"></a><span class="in">world_fixed = FileAttachment("ne_110m_admin_0_countries_un.geojson").json()</span></span>
<span id="cb30-677"><a href="#cb30-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-678"><a href="#cb30-678" aria-hidden="true" tabindex="-1"></a><span class="in">Plot.plot({</span></span>
<span id="cb30-679"><a href="#cb30-679" aria-hidden="true" tabindex="-1"></a><span class="in">  projection: "equal-earth",</span></span>
<span id="cb30-680"><a href="#cb30-680" aria-hidden="true" tabindex="-1"></a><span class="in">  marks: [</span></span>
<span id="cb30-681"><a href="#cb30-681" aria-hidden="true" tabindex="-1"></a><span class="in">    Plot.sphere({ fill: clr_ocean }),</span></span>
<span id="cb30-682"><a href="#cb30-682" aria-hidden="true" tabindex="-1"></a><span class="in">    Plot.geo(world_fixed, {</span></span>
<span id="cb30-683"><a href="#cb30-683" aria-hidden="true" tabindex="-1"></a><span class="in">      stroke: "black",</span></span>
<span id="cb30-684"><a href="#cb30-684" aria-hidden="true" tabindex="-1"></a><span class="in">      strokeWidth: 0.5,</span></span>
<span id="cb30-685"><a href="#cb30-685" aria-hidden="true" tabindex="-1"></a><span class="in">      fill: clr_land</span></span>
<span id="cb30-686"><a href="#cb30-686" aria-hidden="true" tabindex="-1"></a><span class="in">    }) </span></span>
<span id="cb30-687"><a href="#cb30-687" aria-hidden="true" tabindex="-1"></a><span class="in">  ]</span></span>
<span id="cb30-688"><a href="#cb30-688" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb30-689"><a href="#cb30-689" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-690"><a href="#cb30-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-691"><a href="#cb30-691" aria-hidden="true" tabindex="-1"></a>We can zoom in on Ukraine too:</span>
<span id="cb30-692"><a href="#cb30-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-695"><a href="#cb30-695" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb30-696"><a href="#cb30-696" aria-hidden="true" tabindex="-1"></a><span class="in">//| label: plot-fixed-ukraine</span></span>
<span id="cb30-697"><a href="#cb30-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-698"><a href="#cb30-698" aria-hidden="true" tabindex="-1"></a><span class="in">ukraine_good = world_fixed.features.find(d =&gt; d.properties.name === "Ukraine")</span></span>
<span id="cb30-699"><a href="#cb30-699" aria-hidden="true" tabindex="-1"></a><span class="in">russia = world_fixed.features.find(d =&gt; d.properties.name === "Russia")</span></span>
<span id="cb30-700"><a href="#cb30-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-701"><a href="#cb30-701" aria-hidden="true" tabindex="-1"></a><span class="in">Plot.plot({</span></span>
<span id="cb30-702"><a href="#cb30-702" aria-hidden="true" tabindex="-1"></a><span class="in">  projection: { </span></span>
<span id="cb30-703"><a href="#cb30-703" aria-hidden="true" tabindex="-1"></a><span class="in">    type: "equal-earth", </span></span>
<span id="cb30-704"><a href="#cb30-704" aria-hidden="true" tabindex="-1"></a><span class="in">    domain: ukraine_good, </span></span>
<span id="cb30-705"><a href="#cb30-705" aria-hidden="true" tabindex="-1"></a><span class="in">    inset: 50 </span></span>
<span id="cb30-706"><a href="#cb30-706" aria-hidden="true" tabindex="-1"></a><span class="in">  }, </span></span>
<span id="cb30-707"><a href="#cb30-707" aria-hidden="true" tabindex="-1"></a><span class="in">  width: 800, </span></span>
<span id="cb30-708"><a href="#cb30-708" aria-hidden="true" tabindex="-1"></a><span class="in">  marks: [</span></span>
<span id="cb30-709"><a href="#cb30-709" aria-hidden="true" tabindex="-1"></a><span class="in">    Plot.sphere({ fill: clr_ocean }),</span></span>
<span id="cb30-710"><a href="#cb30-710" aria-hidden="true" tabindex="-1"></a><span class="in">    Plot.geo(world_fixed, {</span></span>
<span id="cb30-711"><a href="#cb30-711" aria-hidden="true" tabindex="-1"></a><span class="in">      stroke: "black",</span></span>
<span id="cb30-712"><a href="#cb30-712" aria-hidden="true" tabindex="-1"></a><span class="in">      strokeWidth: 0.5,</span></span>
<span id="cb30-713"><a href="#cb30-713" aria-hidden="true" tabindex="-1"></a><span class="in">      fill: clr_land</span></span>
<span id="cb30-714"><a href="#cb30-714" aria-hidden="true" tabindex="-1"></a><span class="in">    }),</span></span>
<span id="cb30-715"><a href="#cb30-715" aria-hidden="true" tabindex="-1"></a><span class="in">    Plot.geo(russia, { fill: rus_red }),</span></span>
<span id="cb30-716"><a href="#cb30-716" aria-hidden="true" tabindex="-1"></a><span class="in">    Plot.geo(ukraine_good, { </span></span>
<span id="cb30-717"><a href="#cb30-717" aria-hidden="true" tabindex="-1"></a><span class="in">      fill: ukr_blue, </span></span>
<span id="cb30-718"><a href="#cb30-718" aria-hidden="true" tabindex="-1"></a><span class="in">      stroke: ukr_yellow, </span></span>
<span id="cb30-719"><a href="#cb30-719" aria-hidden="true" tabindex="-1"></a><span class="in">      strokeWidth: 3</span></span>
<span id="cb30-720"><a href="#cb30-720" aria-hidden="true" tabindex="-1"></a><span class="in">    })</span></span>
<span id="cb30-721"><a href="#cb30-721" aria-hidden="true" tabindex="-1"></a><span class="in">  ]</span></span>
<span id="cb30-722"><a href="#cb30-722" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb30-723"><a href="#cb30-723" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-724"><a href="#cb30-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-725"><a href="#cb30-725" aria-hidden="true" tabindex="-1"></a><span class="fu">## Alternative data sources</span></span>
<span id="cb30-726"><a href="#cb30-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-727"><a href="#cb30-727" aria-hidden="true" tabindex="-1"></a>Natural Earth isn't the only source of geographic data online, and other sources use *de jure* borders instead of *de facto* borders, like these:</span>
<span id="cb30-728"><a href="#cb30-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-729"><a href="#cb30-729" aria-hidden="true" tabindex="-1"></a><span class="fu">### GISCO</span></span>
<span id="cb30-730"><a href="#cb30-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-731"><a href="#cb30-731" aria-hidden="true" tabindex="-1"></a>The European Commission's Eurostat hosts the <span class="co">[</span><span class="ot">Geographic Information System of the Commission (GISCO)</span><span class="co">](https://ec.europa.eu/eurostat/web/gisco)</span>, which provides GIS data for the EU. They offer global shapefiles that follow EU-based *de jure* borders. <span class="co">[</span><span class="ot">The {giscoR} package</span><span class="co">](https://ropengov.github.io/giscoR/)</span> provides a nice frontend for getting that data into R at 5 different resolutions (1:60m, 1:20m, 1:10m, 1:3m, and super detailed 1:1m!). It does not come with additional metadata for each country, though (i.e. there are no regional divisions, population values, map colors, names in other languages, and so on), so it requires some extra cleaning work if you want those details. For example, can add region information with <span class="co">[</span><span class="ot">{countrycode}</span><span class="co">](https://vincentarelbundock.github.io/countrycode/)</span>:</span>
<span id="cb30-732"><a href="#cb30-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-735"><a href="#cb30-735" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-736"><a href="#cb30-736" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-gisco-world-map</span></span>
<span id="cb30-737"><a href="#cb30-737" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb30-738"><a href="#cb30-738" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 3</span></span>
<span id="cb30-739"><a href="#cb30-739" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: 100%</span></span>
<span id="cb30-740"><a href="#cb30-740" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb30-741"><a href="#cb30-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-742"><a href="#cb30-742" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(giscoR)</span>
<span id="cb30-743"><a href="#cb30-743" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(countrycode)</span>
<span id="cb30-744"><a href="#cb30-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-745"><a href="#cb30-745" aria-hidden="true" tabindex="-1"></a>world_gisco <span class="ot">&lt;-</span> <span class="fu">gisco_get_countries</span>(</span>
<span id="cb30-746"><a href="#cb30-746" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="st">"2024"</span>,</span>
<span id="cb30-747"><a href="#cb30-747" aria-hidden="true" tabindex="-1"></a>  <span class="at">epsg =</span> <span class="st">"4326"</span>,</span>
<span id="cb30-748"><a href="#cb30-748" aria-hidden="true" tabindex="-1"></a>  <span class="at">resolution =</span> <span class="st">"60"</span></span>
<span id="cb30-749"><a href="#cb30-749" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb30-750"><a href="#cb30-750" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add World Bank regions</span></span>
<span id="cb30-751"><a href="#cb30-751" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">countrycode</span>(ISO3_CODE, <span class="at">origin =</span> <span class="st">"iso3c"</span>, <span class="at">destination =</span> <span class="st">"region"</span>))</span>
<span id="cb30-752"><a href="#cb30-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-753"><a href="#cb30-753" aria-hidden="true" tabindex="-1"></a>world_gisco <span class="sc">|&gt;</span> </span>
<span id="cb30-754"><a href="#cb30-754" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME_ENGL <span class="sc">!=</span> <span class="st">"Antarctica"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-755"><a href="#cb30-755" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb30-756"><a href="#cb30-756" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> region), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb30-757"><a href="#cb30-757" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> carto_prism, <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb30-758"><a href="#cb30-758" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="st">"+proj=robin"</span>) <span class="sc">+</span></span>
<span id="cb30-759"><a href="#cb30-759" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb30-760"><a href="#cb30-760" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-761"><a href="#cb30-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-762"><a href="#cb30-762" aria-hidden="true" tabindex="-1"></a>Since the EU doesn't *de jure*-ily recognize the Russian occupation of Crimea, Crimea is in Ukraine:</span>
<span id="cb30-763"><a href="#cb30-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-766"><a href="#cb30-766" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-767"><a href="#cb30-767" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-ukraine-gisco</span></span>
<span id="cb30-768"><a href="#cb30-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-769"><a href="#cb30-769" aria-hidden="true" tabindex="-1"></a>ukraine_gisco <span class="ot">&lt;-</span> world_gisco <span class="sc">|&gt;</span> <span class="fu">filter</span>(NAME_ENGL <span class="sc">==</span> <span class="st">"Ukraine"</span>)</span>
<span id="cb30-770"><a href="#cb30-770" aria-hidden="true" tabindex="-1"></a>russia_gisco <span class="ot">&lt;-</span> world_gisco <span class="sc">|&gt;</span> <span class="fu">filter</span>(NAME_ENGL <span class="sc">==</span> <span class="st">"Russian Federation"</span>)</span>
<span id="cb30-771"><a href="#cb30-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-772"><a href="#cb30-772" aria-hidden="true" tabindex="-1"></a>ukraine_gisco_bbox <span class="ot">&lt;-</span> ukraine_gisco <span class="sc">|&gt;</span> </span>
<span id="cb30-773"><a href="#cb30-773" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="at">dist =</span> <span class="dv">100000</span>) <span class="sc">|&gt;</span>  <span class="co"># Add 100,000 meter buffer around the country </span></span>
<span id="cb30-774"><a href="#cb30-774" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_bbox</span>()</span>
<span id="cb30-775"><a href="#cb30-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-776"><a href="#cb30-776" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb30-777"><a href="#cb30-777" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world_gisco, <span class="at">fill =</span> clr_land) <span class="sc">+</span></span>
<span id="cb30-778"><a href="#cb30-778" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> russia_gisco, <span class="at">fill =</span> rus_red) <span class="sc">+</span> </span>
<span id="cb30-779"><a href="#cb30-779" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ukraine_gisco, <span class="at">fill =</span> ukr_blue, <span class="at">color =</span> ukr_yellow, <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb30-780"><a href="#cb30-780" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb30-781"><a href="#cb30-781" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(ukraine_gisco_bbox[<span class="st">"xmin"</span>], ukraine_gisco_bbox[<span class="st">"xmax"</span>]), </span>
<span id="cb30-782"><a href="#cb30-782" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(ukraine_gisco_bbox[<span class="st">"ymin"</span>], ukraine_gisco_bbox[<span class="st">"ymax"</span>])</span>
<span id="cb30-783"><a href="#cb30-783" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-784"><a href="#cb30-784" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb30-785"><a href="#cb30-785" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> clr_ocean))</span>
<span id="cb30-786"><a href="#cb30-786" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-787"><a href="#cb30-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-788"><a href="#cb30-788" aria-hidden="true" tabindex="-1"></a>It's possible to use GISCO data with Observable too. We could load the data into R and clean it up there (like adding regions and other details) and the save it as GeoJSON, like we did with the Natural Earth data. </span>
<span id="cb30-789"><a href="#cb30-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-790"><a href="#cb30-790" aria-hidden="true" tabindex="-1"></a>Or we can grab the <span class="co">[</span><span class="ot">original raw GeoJSON from Eurostat</span><span class="co">](https://gisco-services.ec.europa.eu/distribution/v2/countries/geojson/)</span> directly. For example, here's the <span class="co">[</span><span class="ot">raw 60M 2024 world map using the WGS84 (4326) projection</span><span class="co">](https://gisco-services.ec.europa.eu/distribution/v2/countries/geojson/CNTR_BN_60M_2024_4326.geojson)</span> that we grabbed with <span class="in">`gisco_get_countries()`</span> earlier.</span>
<span id="cb30-791"><a href="#cb30-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-794"><a href="#cb30-794" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb30-795"><a href="#cb30-795" aria-hidden="true" tabindex="-1"></a><span class="in">//| label: plot-ojs-gisco</span></span>
<span id="cb30-796"><a href="#cb30-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-797"><a href="#cb30-797" aria-hidden="true" tabindex="-1"></a><span class="in">world_gisco = await FileAttachment("https://gisco-services.ec.europa.eu/distribution/v2/countries/geojson/CNTR_RG_60M_2024_4326.geojson").json()</span></span>
<span id="cb30-798"><a href="#cb30-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-799"><a href="#cb30-799" aria-hidden="true" tabindex="-1"></a><span class="in">ukraine_gisco = world_gisco.features.find(d =&gt; d.properties.NAME_ENGL === "Ukraine")</span></span>
<span id="cb30-800"><a href="#cb30-800" aria-hidden="true" tabindex="-1"></a><span class="in">russia_gisco = world_gisco.features.find(d =&gt; d.properties.NAME_ENGL === "Russian Federation")</span></span>
<span id="cb30-801"><a href="#cb30-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-802"><a href="#cb30-802" aria-hidden="true" tabindex="-1"></a><span class="in">Plot.plot({</span></span>
<span id="cb30-803"><a href="#cb30-803" aria-hidden="true" tabindex="-1"></a><span class="in">  projection: { </span></span>
<span id="cb30-804"><a href="#cb30-804" aria-hidden="true" tabindex="-1"></a><span class="in">    type: "equal-earth", </span></span>
<span id="cb30-805"><a href="#cb30-805" aria-hidden="true" tabindex="-1"></a><span class="in">    domain: ukraine_gisco, </span></span>
<span id="cb30-806"><a href="#cb30-806" aria-hidden="true" tabindex="-1"></a><span class="in">    inset: 50 </span></span>
<span id="cb30-807"><a href="#cb30-807" aria-hidden="true" tabindex="-1"></a><span class="in">  }, </span></span>
<span id="cb30-808"><a href="#cb30-808" aria-hidden="true" tabindex="-1"></a><span class="in">  width: 800, </span></span>
<span id="cb30-809"><a href="#cb30-809" aria-hidden="true" tabindex="-1"></a><span class="in">  marks: [</span></span>
<span id="cb30-810"><a href="#cb30-810" aria-hidden="true" tabindex="-1"></a><span class="in">    Plot.sphere({ fill: clr_ocean }),</span></span>
<span id="cb30-811"><a href="#cb30-811" aria-hidden="true" tabindex="-1"></a><span class="in">    Plot.geo(world_gisco, {</span></span>
<span id="cb30-812"><a href="#cb30-812" aria-hidden="true" tabindex="-1"></a><span class="in">      stroke: "black",</span></span>
<span id="cb30-813"><a href="#cb30-813" aria-hidden="true" tabindex="-1"></a><span class="in">      strokeWidth: 0.5,</span></span>
<span id="cb30-814"><a href="#cb30-814" aria-hidden="true" tabindex="-1"></a><span class="in">      fill: clr_land</span></span>
<span id="cb30-815"><a href="#cb30-815" aria-hidden="true" tabindex="-1"></a><span class="in">    }),</span></span>
<span id="cb30-816"><a href="#cb30-816" aria-hidden="true" tabindex="-1"></a><span class="in">    Plot.geo(russia_gisco, { fill: rus_red }),</span></span>
<span id="cb30-817"><a href="#cb30-817" aria-hidden="true" tabindex="-1"></a><span class="in">    Plot.geo(ukraine_gisco, { </span></span>
<span id="cb30-818"><a href="#cb30-818" aria-hidden="true" tabindex="-1"></a><span class="in">      fill: ukr_blue, </span></span>
<span id="cb30-819"><a href="#cb30-819" aria-hidden="true" tabindex="-1"></a><span class="in">      stroke: ukr_yellow, </span></span>
<span id="cb30-820"><a href="#cb30-820" aria-hidden="true" tabindex="-1"></a><span class="in">      strokeWidth: 3</span></span>
<span id="cb30-821"><a href="#cb30-821" aria-hidden="true" tabindex="-1"></a><span class="in">    })</span></span>
<span id="cb30-822"><a href="#cb30-822" aria-hidden="true" tabindex="-1"></a><span class="in">  ]</span></span>
<span id="cb30-823"><a href="#cb30-823" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb30-824"><a href="#cb30-824" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-825"><a href="#cb30-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-826"><a href="#cb30-826" aria-hidden="true" tabindex="-1"></a><span class="fu">### Visionscarto</span></span>
<span id="cb30-827"><a href="#cb30-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-828"><a href="#cb30-828" aria-hidden="true" tabindex="-1"></a>There are JSON-based map files created by <span class="co">[</span><span class="ot">\@fil at Observable</span><span class="co">](https://observablehq.com/user/@fil)</span> as part of the <span class="co">[</span><span class="ot">Visionscarto project</span><span class="co">](https://observablehq.com/@visionscarto/world-atlas-topojson)</span>.</span>
<span id="cb30-829"><a href="#cb30-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-830"><a href="#cb30-830" aria-hidden="true" tabindex="-1"></a>They're based on Natural Earth, but with <span class="co">[</span><span class="ot">some specific adjustments</span><span class="co">](https://observablehq.com/@visionscarto/world-atlas-topojson#cell-93)</span> like adding Crimea to Ukraine, making Gaza a little bit bigger so that it doesn't get dropped at lower resolutions like 110m, and using UN boundaries for Western Sahara. </span>
<span id="cb30-831"><a href="#cb30-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-832"><a href="#cb30-832" aria-hidden="true" tabindex="-1"></a>Like GISCO, though, these don't have the additional columns that Natural Earth comes with (country names in a bunch of languages, region and continent designations, map coloring schemes, population and GDP estimates, etc.), and those would need to be added manually in R or Observable or whatever.</span>
<span id="cb30-833"><a href="#cb30-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-836"><a href="#cb30-836" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb30-837"><a href="#cb30-837" aria-hidden="true" tabindex="-1"></a><span class="in">//| label: plot-visionscarto</span></span>
<span id="cb30-838"><a href="#cb30-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-839"><a href="#cb30-839" aria-hidden="true" tabindex="-1"></a><span class="in">import {world110m} from "@visionscarto/geo"</span></span>
<span id="cb30-840"><a href="#cb30-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-841"><a href="#cb30-841" aria-hidden="true" tabindex="-1"></a><span class="in">countries110m = topojson.feature(world110m, world110m.objects.countries)</span></span>
<span id="cb30-842"><a href="#cb30-842" aria-hidden="true" tabindex="-1"></a><span class="in">ukraine_visionscarto = countries110m.features.find(d =&gt; d.properties.name === "Ukraine")</span></span>
<span id="cb30-843"><a href="#cb30-843" aria-hidden="true" tabindex="-1"></a><span class="in">russia_visionscarto = countries110m.features.find(d =&gt; d.properties.name === "Russia")</span></span>
<span id="cb30-844"><a href="#cb30-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-845"><a href="#cb30-845" aria-hidden="true" tabindex="-1"></a><span class="in">Plot.plot({</span></span>
<span id="cb30-846"><a href="#cb30-846" aria-hidden="true" tabindex="-1"></a><span class="in">  projection: { </span></span>
<span id="cb30-847"><a href="#cb30-847" aria-hidden="true" tabindex="-1"></a><span class="in">    type: "equal-earth", </span></span>
<span id="cb30-848"><a href="#cb30-848" aria-hidden="true" tabindex="-1"></a><span class="in">    domain: ukraine_visionscarto, </span></span>
<span id="cb30-849"><a href="#cb30-849" aria-hidden="true" tabindex="-1"></a><span class="in">    inset: 50 </span></span>
<span id="cb30-850"><a href="#cb30-850" aria-hidden="true" tabindex="-1"></a><span class="in">  }, </span></span>
<span id="cb30-851"><a href="#cb30-851" aria-hidden="true" tabindex="-1"></a><span class="in">  width: 800, </span></span>
<span id="cb30-852"><a href="#cb30-852" aria-hidden="true" tabindex="-1"></a><span class="in">  marks: [</span></span>
<span id="cb30-853"><a href="#cb30-853" aria-hidden="true" tabindex="-1"></a><span class="in">    Plot.sphere({ fill: clr_ocean }),</span></span>
<span id="cb30-854"><a href="#cb30-854" aria-hidden="true" tabindex="-1"></a><span class="in">    Plot.geo(countries110m, {</span></span>
<span id="cb30-855"><a href="#cb30-855" aria-hidden="true" tabindex="-1"></a><span class="in">      stroke: "black",</span></span>
<span id="cb30-856"><a href="#cb30-856" aria-hidden="true" tabindex="-1"></a><span class="in">      strokeWidth: 0.5,</span></span>
<span id="cb30-857"><a href="#cb30-857" aria-hidden="true" tabindex="-1"></a><span class="in">      fill: clr_land</span></span>
<span id="cb30-858"><a href="#cb30-858" aria-hidden="true" tabindex="-1"></a><span class="in">    }),</span></span>
<span id="cb30-859"><a href="#cb30-859" aria-hidden="true" tabindex="-1"></a><span class="in">    Plot.geo(russia_visionscarto, { fill: rus_red }),</span></span>
<span id="cb30-860"><a href="#cb30-860" aria-hidden="true" tabindex="-1"></a><span class="in">    Plot.geo(ukraine_visionscarto, { </span></span>
<span id="cb30-861"><a href="#cb30-861" aria-hidden="true" tabindex="-1"></a><span class="in">      fill: ukr_blue, </span></span>
<span id="cb30-862"><a href="#cb30-862" aria-hidden="true" tabindex="-1"></a><span class="in">      stroke: ukr_yellow, </span></span>
<span id="cb30-863"><a href="#cb30-863" aria-hidden="true" tabindex="-1"></a><span class="in">      strokeWidth: 3</span></span>
<span id="cb30-864"><a href="#cb30-864" aria-hidden="true" tabindex="-1"></a><span class="in">    })</span></span>
<span id="cb30-865"><a href="#cb30-865" aria-hidden="true" tabindex="-1"></a><span class="in">  ]</span></span>
<span id="cb30-866"><a href="#cb30-866" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb30-867"><a href="#cb30-867" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-868"><a href="#cb30-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-869"><a href="#cb30-869" aria-hidden="true" tabindex="-1"></a><span class="fu">### Less automatic sources</span></span>
<span id="cb30-870"><a href="#cb30-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-871"><a href="#cb30-871" aria-hidden="true" tabindex="-1"></a>There are other sources too, but they require manual downloading:</span>
<span id="cb30-872"><a href="#cb30-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-873"><a href="#cb30-873" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">The geoBoundaries project</span><span class="co">](https://www.geoboundaries.org/)</span>, hosted by the <span class="co">[</span><span class="ot">William &amp; Mary geoLab</span><span class="co">](https://sites.google.com/view/wmgeolab/)</span></span>
<span id="cb30-874"><a href="#cb30-874" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">The UN's Country Boundaries of the World hosted at the UN's Food and Agricultural Organization (FAO) site</span><span class="co">](https://data.apps.fao.org/catalog/iso/6aecaf08-c7d0-4e16-8778-b8dddae9da14)</span></span>
<span id="cb30-875"><a href="#cb30-875" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Opendatasoft's copy of the World Food Programme's World Administrative Boundaries shapefile</span><span class="co">](https://public.opendatasoft.com/explore/dataset/world-administrative-boundaries/map/?location=5,48.87917,30.25635&amp;basemap=jawg.light&amp;dataChart=eyJxdWVyaWVzIjpbeyJjb25maWciOnsiZGF0YXNldCI6IndvcmxkLWFkbWluaXN0cmF0aXZlLWJvdW5kYXJpZXMiLCJvcHRpb25zIjp7ImJhc2VtYXAiOiJqYXdnLmxpZ2h0IiwibG9jYXRpb24iOiI1LDQ1LjkwNTMsMzcuNzI3MDUifX0sImNoYXJ0cyI6W3siYWxpZ25Nb250aCI6dHJ1ZSwidHlwZSI6ImNvbHVtbiIsImZ1bmMiOiJDT1VOVCIsInNjaWVudGlmaWNEaXNwbGF5Ijp0cnVlLCJjb2xvciI6IiNGRjUxNUEifV0sInhBeGlzIjoic3RhdHVzIiwibWF4cG9pbnRzIjo1MCwic29ydCI6IiJ9XSwidGltZXNjYWxlIjoiIiwiZGlzcGxheUxlZ2VuZCI6dHJ1ZSwiYWxpZ25Nb250aCI6dHJ1ZX0%3D)</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p><span class="faux-block"><i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> 2007–2024 Andrew Heiss</span> <span class="faux-block">All content licensed under<br><a href="https://creativecommons.org/licenses/by/4.0/"><i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> <i class="fa-brands fa-creative-commons-by" aria-label="creative-commons-by"></i> Creative Commons CC BY 4.0</a></span></p>
</div>   
    <div class="nav-footer-center">
<p><span class="faux-block"><i class="fa-brands fa-orcid" aria-label="orcid"></i> <strong>ORCID</strong> <a href="https://orcid.org/0000-0002-3948-3914">0000-0002-3948-3914</a></span> <span class="faux-block"><i class="fa-solid fa-key" aria-label="key"></i> <a href="../../../../../pgp_ath.asc.txt">PGP public key</a>   <i class="fa-solid fa-fingerprint" aria-label="fingerprint"></i> Fingerprint:<br><span class="fingerprint">4AA2 FA83 A8B2 05A4 E30F<br> 610D 1382 6216 9178 36AB</span></span></p>
</div>
    <div class="nav-footer-right">
<p><span class="faux-block">Made with <i class="fa-brands fa-r-project" aria-label="r-project"></i> and <a href="https://quarto.org/">Quarto</a></span> <span class="faux-block"><a href="https://github.com/andrewheiss/ath-quarto">View the source at <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></span></p>
</div>
  </div>
</footer>


</body></html>