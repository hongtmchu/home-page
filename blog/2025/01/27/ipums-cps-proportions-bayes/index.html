<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Hong T.M. Chu">
<meta name="description" content="Download CPS demographic data from IPUMS and use R and {brms} to calculate differences between sample and national proportions with Bayesian ROPE-based inference">
<title>Guide to comparing sample and population proportions with CPS data, both classically and Bayesianly | Hong T.M. Chu – Hong T.M. Chu</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../../">
<link href="../../../../..//files/favicon-512.png" rel="icon" type="image/png">
<script src="../../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting-17c909d5fd25ae21b861c0c7a49b2096.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../site_libs/bootstrap/bootstrap-5cd0811f461c8271ae6bab49df9501be.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script src="../../../../../site_libs/quarto-contrib/iconify-2.0.0/iconify-icon.min.js"></script>
<script src="../../../../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../../../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-527449-5', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script><style>

      .quarto-title-block .quarto-title-banner {
        background: #170C3A;
      }
</style>
<style type="text/css">
hr.dinkus {
    width: 50px;
    margin: 2em auto 2em;
    border-top: 5px dotted #454545;
}

div.column-margin+hr.dinkus {
    margin: 1em auto 2em;
}

.quarto-float-tbl figcaption {
    text-align: left !important;
}
</style>
<script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
<meta property="og:title" content="Guide to comparing sample and population proportions with CPS data, both classically and Bayesianly | Hong T.M. Chu">
<meta property="og:description" content="Download CPS demographic data from IPUMS and use R and {brms} to calculate differences between sample and national proportions with Bayesian ROPE-based inference">
<meta property="og:image" content="https://www.andrewheiss.com/blog/2025/01/27/ipums-cps-proportions-bayes/index_files/figure-html/fig-prop-test-bayes-diffs-1.png">
<meta property="og:site_name" content="Hong T.M. Chu">
<meta property="og:locale" content="en_US">
<meta property="og:image:height" content="1296">
<meta property="og:image:width" content="1728">
<meta name="twitter:title" content="Guide to comparing sample and population proportions with CPS data, both classically and Bayesianly | Hong T.M. Chu">
<meta name="twitter:description" content="Download CPS demographic data from IPUMS and use R and {brms} to calculate differences between sample and national proportions with Bayesian ROPE-based inference">
<meta name="twitter:image" content="https://www.andrewheiss.com/blog/2025/01/27/ipums-cps-proportions-bayes/index_files/figure-html/fig-prop-test-bayes-diffs-1.png">
<meta name="twitter:creator" content="@andrewheiss">
<meta name="twitter:site" content="@andrewheiss">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image-height" content="1296">
<meta name="twitter:image-width" content="1728">
</head>
<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../../index.html">
    <span class="navbar-title">Hong T.M. Chu</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../../../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../cv/index.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../research/index.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../teaching/index.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="mailto:hong.ctm@vinuni.edu.vn"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:envelope" style="font-size: 1.1em;" aria-label="Icon envelope from bi Iconify.design set." title="E-mail"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/andrewheiss" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:github" style="font-size: 1.1em;" aria-label="Icon github from bi Iconify.design set." title="GitHub"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/hongtmchu" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:linkedin" style="font-size: 1.1em;" aria-label="Icon linkedin from bi Iconify.design set." title="LinkedIn"></iconify-icon></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default blog-post page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Guide to comparing sample and population proportions with CPS data, both classically and Bayesianly</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                  <div>
        <div class="description">
          Download CPS demographic data from IPUMS and use R and {brms} to calculate differences between sample and national proportions with Bayesian ROPE-based inference
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">r</div>
                <div class="quarto-category">tidyverse</div>
                <div class="quarto-category">us census</div>
                <div class="quarto-category">ggplot</div>
                <div class="quarto-category">bayes</div>
                <div class="quarto-category">brms</div>
                <div class="quarto-category">surveys</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://www.andrewheiss.com/">Andrew Heiss</a> <a href="https://orcid.org/0000-0002-3948-3914" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">Monday, January 27, 2025</p>
      </div>
    </div>
    
      
      <div>
      <div class="quarto-title-meta-heading">Doi</div>
      <div class="quarto-title-meta-contents">
        <p class="doi">
          <a href="https://doi.org/10.59350/8ws3f-1fd56">10.59350/8ws3f-1fd56</a>
        </p>
      </div>
    </div>
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Contents</h2>
   
  <ul>
<li><a href="#nationally-representative-demographic-data" id="toc-nationally-representative-demographic-data" class="nav-link active" data-scroll-target="#nationally-representative-demographic-data">Nationally representative demographic data</a></li>
  <li>
<a href="#accessing-us-census-data" id="toc-accessing-us-census-data" class="nav-link" data-scroll-target="#accessing-us-census-data">Accessing US Census data</a>
  <ul class="collapse">
<li><a href="#acs" id="toc-acs" class="nav-link" data-scroll-target="#acs">ACS</a></li>
  <li><a href="#cps-and-others" id="toc-cps-and-others" class="nav-link" data-scroll-target="#cps-and-others">CPS (and others!)</a></li>
  </ul>
</li>
  <li><a href="#getting-started" id="toc-getting-started" class="nav-link" data-scroll-target="#getting-started">Getting started</a></li>
  <li>
<a href="#getting-cps-data-from-the-ipums-website" id="toc-getting-cps-data-from-the-ipums-website" class="nav-link" data-scroll-target="#getting-cps-data-from-the-ipums-website">Getting CPS data from the IPUMS website</a>
  <ul class="collapse">
<li><a href="#finding-variables" id="toc-finding-variables" class="nav-link" data-scroll-target="#finding-variables">Finding variables</a></li>
  <li><a href="#selecting-samples" id="toc-selecting-samples" class="nav-link" data-scroll-target="#selecting-samples">Selecting samples</a></li>
  <li><a href="#downloading-the-data" id="toc-downloading-the-data" class="nav-link" data-scroll-target="#downloading-the-data">Downloading the data</a></li>
  </ul>
</li>
  <li><a href="#more-reproducible-alternative-using-the-ipums-api" id="toc-more-reproducible-alternative-using-the-ipums-api" class="nav-link" data-scroll-target="#more-reproducible-alternative-using-the-ipums-api">More reproducible alternative: using the IPUMS API</a></li>
  <li><a href="#loading-cps-data" id="toc-loading-cps-data" class="nav-link" data-scroll-target="#loading-cps-data">Loading CPS data</a></li>
  <li>
<a href="#summarizing-cps-data" id="toc-summarizing-cps-data" class="nav-link" data-scroll-target="#summarizing-cps-data">Summarizing CPS data</a>
  <ul class="collapse">
<li><a href="#weighting" id="toc-weighting" class="nav-link" data-scroll-target="#weighting">Weighting</a></li>
  <li><a href="#calculating-population-level-proportions" id="toc-calculating-population-level-proportions" class="nav-link" data-scroll-target="#calculating-population-level-proportions">Calculating population-level proportions</a></li>
  </ul>
</li>
  <li><a href="#summarizing-sample-proportions" id="toc-summarizing-sample-proportions" class="nav-link" data-scroll-target="#summarizing-sample-proportions">Summarizing sample proportions</a></li>
  <li>
<a href="#testing-sample-vs.-population-proportions-frequentist-ly" id="toc-testing-sample-vs.-population-proportions-frequentist-ly" class="nav-link" data-scroll-target="#testing-sample-vs.-population-proportions-frequentist-ly">Testing sample vs.&nbsp;population proportions frequentist-ly</a>
  <ul class="collapse">
<li><a href="#one-sample-proportion-test-for-age" id="toc-one-sample-proportion-test-for-age" class="nav-link" data-scroll-target="#one-sample-proportion-test-for-age">One-sample proportion test for age</a></li>
  <li><a href="#one-sample-proportion-test-for-volunteering" id="toc-one-sample-proportion-test-for-volunteering" class="nav-link" data-scroll-target="#one-sample-proportion-test-for-volunteering">One-sample proportion test for volunteering</a></li>
  <li><a href="#proportion-tests-and-differences-for-everything-all-at-once" id="toc-proportion-tests-and-differences-for-everything-all-at-once" class="nav-link" data-scroll-target="#proportion-tests-and-differences-for-everything-all-at-once">Proportion tests and differences for everything all at once</a></li>
  </ul>
</li>
  <li>
<a href="#testing-sample-vs.-population-proportions-bayesian-ly" id="toc-testing-sample-vs.-population-proportions-bayesian-ly" class="nav-link" data-scroll-target="#testing-sample-vs.-population-proportions-bayesian-ly">Testing sample vs.&nbsp;population proportions Bayesian-ly</a>
  <ul class="collapse">
<li><a href="#ew-null-hypothesis-significance-testing" id="toc-ew-null-hypothesis-significance-testing" class="nav-link" data-scroll-target="#ew-null-hypothesis-significance-testing">ew null hypothesis significance testing</a></li>
  <li><a href="#modeling-proportions-with-a-binomial-distribution" id="toc-modeling-proportions-with-a-binomial-distribution" class="nav-link" data-scroll-target="#modeling-proportions-with-a-binomial-distribution">Modeling proportions with a binomial distribution</a></li>
  <li><a href="#working-with-the-posterior" id="toc-working-with-the-posterior" class="nav-link" data-scroll-target="#working-with-the-posterior">Working with the posterior</a></li>
  <li><a href="#the-region-of-practical-equivalence-rope" id="toc-the-region-of-practical-equivalence-rope" class="nav-link" data-scroll-target="#the-region-of-practical-equivalence-rope">The region of practical equivalence (ROPE)</a></li>
  <li><a href="#bayesian-proportion-test-for-volunteering" id="toc-bayesian-proportion-test-for-volunteering" class="nav-link" data-scroll-target="#bayesian-proportion-test-for-volunteering">Bayesian proportion test for volunteering</a></li>
  <li><a href="#posterior-proportions-differences-and-ropes-for-everything-all-at-once" id="toc-posterior-proportions-differences-and-ropes-for-everything-all-at-once" class="nav-link" data-scroll-target="#posterior-proportions-differences-and-ropes-for-everything-all-at-once">Posterior proportions, differences, and ROPEs for everything all at once</a></li>
  </ul>
</li>
  </ul></nav>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content"><p>Last week I was making some final revisions <a href="https://stats.andrewheiss.com/silent-skywalk/">to a paper</a> where we used a neat conjoint experiment to test the effect of a bunch of different treatments on nonprofit donor preference.</p>
<p>One of the peer reviewers asked us to compare the characteristics of our experimental sample with the general population so that we could speak a little to the experiment’s generalizability. This is a super common thing to do with survey research, and one of the main reasons survey researchers include demographic questions in their surveys.</p>
<p>Thanks to the wonders of the R community—and thanks to publicly accessible data—I was able to grab nationally representative demographic data, clean it up and summarize it, run some statistical tests, and make a table to meet the reviewer’s request, <a href="https://bsky.app/profile/andrew.heiss.phd/post/3lgc5loazd22y">all in like 45 minutes</a>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/00-bsky-post.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>It was a magically quick and easy process, so I figured I’d make a guide about it so that the rest of the world (but mostly future me) can see how to do it.</p>
<section id="nationally-representative-demographic-data" class="level2"><h2 class="anchored" data-anchor-id="nationally-representative-demographic-data">Nationally representative demographic data</h2>
<p>Finding nationally representative demographic data (in the US, at least) is pretty easy, and there are two common sources for it:</p>
<ul>
<li>The US Census’s <a href="https://www.census.gov/programs-surveys/acs">American Community Survey</a> (ACS) is a rolling monthly survey of ≈3.5 million (!!!) US <em>households</em> that’s compiled into an annual dataset.</li>
<li>The US Census’s <a href="https://www.census.gov/programs-surveys/cps.html">Current Population Survey</a> (CPS) is a monthly survey of ≈100,000 US <em>individuals</em>. A more comprehensive annual version—the Annual Social and Economic Supplement (ASEC)—is published every March.</li>
</ul>
<p>The two surveys serve different purposes, and <a href="https://www.census.gov/topics/income-poverty/poverty/guidance/data-sources/acs-vs-cps.html">the Census has an FAQ fact sheet explaining the difference between the ACS and CPS</a>. Notably, the ACS only surveys <em>households</em>, and it uses a shorter 8-question survey, while the CPS tries to reach the entire civilian noninstitutionalized population and uses a longer, more detailed survey.</p>
<p>Researchers use both surveys—I’ve used both in my own work. <a href="https://www.census.gov/topics/income-poverty/poverty/guidance/data-sources/acs-vs-cps.html">According to the Census</a>, due to its detailed questionnaire and staff experience and regular frequency, the CPS ASEC is a “high quality source of information used to produce the official annual estimate of poverty, and estimates of a number of other socioeconomic and demographic characteristics”. The ACS also has demographic details and people use those instead too.</p>
<p>I’m not entirely sure which one is best—to me they’re both great 🤷‍♂️. Smarter people than me know and care about the difference.</p>
</section><section id="accessing-us-census-data" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="accessing-us-census-data">Accessing US Census data</h2>
<p>Getting data from the Census is a surprisingly complex process! There are websites and R packages that make it easier though.</p>
<section id="acs" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="acs">ACS</h3>
<p>For the ACS, <a href="https://walker-data.com/tidycensus/">the {tidycensus} R package</a> provides an interface to the Census’s API, and <a href="https://walker-data.com/tidycensus/">its documentation is great and thorough</a>. Working with the results is tricky though, and involves a lot of pivoting and reshaping and combining variables. <a href="https://stats.andrewheiss.com/zany-zebra/notebook/acs-data.html">I have a whole notebook</a> showing how I access the ACS and create a bunch of variables, with <a href="https://stats.andrewheiss.com/zany-zebra/notebook/acs-data.html#high-school-education">little notes</a> reminding myself how I constructed everything:</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="img/00-zany-zebra-example.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Explanation of how I calculated the proportion of households in a block group with a high school education"><img src="img/00-zany-zebra-example.png" class="border img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" alt="Explanation of how I calculated the proportion of households in a block group with a high school education"></a></p>
</figure>
</div>
<figcaption class="margin-caption">Explanation of how I calculated the proportion of households in a block group with a high school education</figcaption></figure>
</div>
</section><section id="cps-and-others" class="level3"><h3 class="anchored" data-anchor-id="cps-and-others">CPS (and others!)</h3>
<p>{tidycensus} doesn’t provide Census API access to CPS data. Instead, <a href="https://www.ipums.org/">IPUMS</a>—a project housed at the University of Minnesota and supported by a consortium of other institutions and companies—provides easy access to all sorts of census and survey data, both through its website and through an API. It’s wild how much data they have. In addition to the <a href="https://cps.ipums.org/cps/">CPS</a>, they have the <a href="https://usa.ipums.org/">ACS</a>, <a href="https://international.ipums.org/international/">census microtata for 100+ countries</a>, <a href="https://www.nhgis.org/">historical GIS shapefiles</a>, <a href="https://timeuse.ipums.org/">time use surveys</a>, and a ton of other things. It’s an incredible project.</p>
</section></section><section id="getting-started" class="level2"><h2 class="anchored" data-anchor-id="getting-started">Getting started</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Who this guide is for
</div>
</div>
<div class="callout-body-container callout-body">
<p>Here’s what I assume you know:</p>
<ul>
<li>You’re familiar with <a href="https://www.r-project.org/">R</a> and the <a href="https://www.tidyverse.org/">tidyverse</a> (particularly <a href="https://dplyr.tidyverse.org/">{dplyr}</a> and <a href="https://ggplot2.tidyverse.org/">{ggplot2}</a>).</li>
<li>You’re familiar with <a href="https://paul-buerkner.github.io/brms/">{brms}</a> for running Bayesian regression models and <a href="https://mjskay.github.io/tidybayes/">{tidybayes}</a> and <a href="https://mjskay.github.io/ggdist/">{ggdist}</a> for manipulating and plotting posterior draws.</li>
</ul>
</div>
</div>
<p>In this guide, we’ll use IPUMS to get <a href="https://cps.ipums.org/cps/">CPS</a> data (monthly and ASEC) with R. Because their data explorer website takes a little while to get used to, I’ll show a bunch of step-by-step screenshots of how to navigate it. It’s possible to <a href="https://tech.popdata.org/ipumsr/articles/ipums-api.html">access the IPUMS API</a> with the {ipumsr} package, and I also <a href="#more-reproducible-alternative-using-the-ipums-api">show how to do that in this guide</a>. But in order to use the API, you still need to know how to use the website—you have to find variable names and figure out which samples include which variables. So the screenshots below are still important even if you’re using the API.</p>
<p>I’ll then show how to answer the question of whether a survey proportion is equivalent to a population proportion in a couple diffferent ways:</p>
<ol type="1">
<li>Frequentist/classical proportion tests with null hypothesis significance testing, and</li>
<li>Bayesian proportion tests and inference based on regions of practical equivalence, or ROPEs</li>
</ol>
<p>Before getting started, let’s load all the packages we need and create some helpful functions and variables.</p>
<p>The experimental survey data here comes from <span class="citation" data-cites="ChaudhryDotsonHeiss:2024">Chaudhry, Dotson, and Heiss (<a href="#ref-ChaudhryDotsonHeiss:2024" role="doc-biblioref">2024</a>)</span>. Since we haven’t published it yet (though it’s close—it’s under review post R&amp;R now!), the original data isn’t quite public yet. So I used <a href="https://synthpop.org.uk/get-started.html">the {synthpop} R package</a> to create a synthetic version of part of our data that has the same relationships and distributions as the real results, but is all fake. You can see <a href="https://github.com/andrewheiss/ath-quarto/blob/main/blog/2025/01/27/ipums-cps-proportions-bayes/make_synthetic_data.R">the R code I used for that process here</a>.</p>
<p>If you want to follow along, you can download this synthetic data here:</p>
<ul>
<li>
<a href="synthetic_data.rds"><i class="fa-brands fa-r-project" aria-label="r-project"></i> <code>synthetic_data.rds</code></a>: RDS version with all the variable attributes (i.e.&nbsp;factor levels and ordering) included</li>
<li>
<a href="synthetic_data.csv"><i class="fa-solid fa-file-csv" aria-label="file-csv"></i> <code>synthetic_data.csv</code></a>: Plain-text version (but without variable attributes)</li>
</ul>
<p>To reflect the fact that this is all public, government-created data, I’m using the <a href="https://public-sans.digital.gov/">Public Sans font</a>, an open source font developed as part of the General Services Administration’s <a href="https://designsystem.digital.gov/">USWDS</a> (US Web Design System) for making accessible federal government websites. I’m also using the <a href="https://designsystem.digital.gov/utilities/color/#basic-palette-2">USWDS’s basic color palette</a>, developed by <a href="https://18f.gsa.gov/2020/04/21/a-token-of-our-affection-uswds-2/">18F</a>.</p>
<p>Let’s get started!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>   <span class="co"># {ggplot2}, {dplyr}, and friends</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://vincentarelbundock.github.io/tinytable/">tinytable</a></span><span class="op">)</span>   <span class="co"># Nice tables</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms">brms</a></span><span class="op">)</span>        <span class="co"># Best way to run Stan models</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/tidybayes/">tidybayes</a></span><span class="op">)</span>   <span class="co"># Manipulate Stan objects and draws</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span>       <span class="co"># Convert model objects to data frames</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://glue.tidyverse.org/">glue</a></span><span class="op">)</span>        <span class="co"># Easier string construction</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org">scales</a></span><span class="op">)</span>      <span class="co"># Nicer labels</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/ggdist/">ggdist</a></span><span class="op">)</span>      <span class="co"># Plot posterior distributions</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggforce.data-imaginist.com">ggforce</a></span><span class="op">)</span>     <span class="co"># Extra ggplot things like facet_col()</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span>   <span class="co"># Combine ggplot plots</span></span>
<span></span>
<span><span class="co"># Load the synthetic survey results</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"synthetic_data.rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use the cmdstanr backend for brms because it's faster and more modern than the</span></span>
<span><span class="co"># default rstan backend. You need to install the cmdstanr package first</span></span>
<span><span class="co"># (https://mc-stan.org/cmdstanr/) and then run cmdstanr::install_cmdstan() to</span></span>
<span><span class="co"># install cmdstan on your computer.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span></span>
<span>  mc.cores <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  brms.backend <span class="op">=</span> <span class="st">"cmdstanr"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set some global Stan options</span></span>
<span><span class="va">CHAINS</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">ITER</span> <span class="op">&lt;-</span> <span class="fl">2000</span></span>
<span><span class="va">WARMUP</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">BAYES_SEED</span> <span class="op">&lt;-</span> <span class="fl">1234</span></span>
<span></span>
<span><span class="co"># Nice ggplot theme</span></span>
<span><span class="va">theme_public</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span>base_family <span class="op">=</span> <span class="st">"Public Sans"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span></span>
<span>      panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Public Sans"</span>, face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fu">rel</span><span class="op">(</span><span class="fl">1.25</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Public Sans Light"</span>, face <span class="op">=</span> <span class="st">"plain"</span><span class="op">)</span>,</span>
<span>      plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Public Sans Light"</span>, face <span class="op">=</span> <span class="st">"plain"</span><span class="op">)</span>,</span>
<span>      axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Public Sans Semibold"</span>, size <span class="op">=</span> <span class="fu">rel</span><span class="op">(</span><span class="fl">0.8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      axis.title.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>      axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>      strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>        family <span class="op">=</span> <span class="st">"Public Sans Semibold"</span>, face <span class="op">=</span> <span class="st">"plain"</span>,</span>
<span>        size <span class="op">=</span> <span class="fu">rel</span><span class="op">(</span><span class="fl">0.8</span><span class="op">)</span>, hjust <span class="op">=</span> <span class="fl">0</span></span>
<span>      <span class="op">)</span>,</span>
<span>      strip.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey90"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>      legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Public Sans Semibold"</span>, size <span class="op">=</span> <span class="fu">rel</span><span class="op">(</span><span class="fl">0.8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fu">rel</span><span class="op">(</span><span class="fl">0.8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>      legend.justification <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>      legend.title.position <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>      legend.margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span>l <span class="op">=</span> <span class="fl">0</span>, t <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">theme_set</span><span class="op">(</span><span class="fu">theme_public</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">update_geom_defaults</span><span class="op">(</span><span class="st">"text"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Public Sans"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">update_geom_defaults</span><span class="op">(</span><span class="st">"label"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Public Sans"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># USWDS basic palette</span></span>
<span><span class="co"># https://designsystem.digital.gov/utilities/color/#basic-palette-2</span></span>
<span><span class="va">clrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"#e52207"</span>, <span class="co"># .bg-red</span></span>
<span>  <span class="st">"#e66f0e"</span>, <span class="co"># .bg-orange</span></span>
<span>  <span class="st">"#ffbe2e"</span>, <span class="co"># .bg-gold</span></span>
<span>  <span class="st">"#fee685"</span>, <span class="co"># .bg-yellow</span></span>
<span>  <span class="st">"#538200"</span>, <span class="co"># .bg-green</span></span>
<span>  <span class="st">"#04c585"</span>, <span class="co"># .bg-mint</span></span>
<span>  <span class="st">"#009ec1"</span>, <span class="co"># .bg-cyan</span></span>
<span>  <span class="st">"#0076d6"</span>, <span class="co"># .bg-blue</span></span>
<span>  <span class="st">"#676cc8"</span>, <span class="co"># .bg-indigo</span></span>
<span>  <span class="st">"#8168b3"</span>, <span class="co"># .bg-violet</span></span>
<span>  <span class="st">"#d72d79"</span> <span class="co"># .bg-magenta</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Some functions for creating percentage point labels</span></span>
<span><span class="va">label_pp</span> <span class="op">&lt;-</span> <span class="fu">label_number</span><span class="op">(</span></span>
<span>  accuracy <span class="op">=</span> <span class="fl">1</span>, scale <span class="op">=</span> <span class="fl">100</span>, suffix <span class="op">=</span> <span class="st">" pp."</span>, style_negative <span class="op">=</span> <span class="st">"minus"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">label_pp_01</span> <span class="op">&lt;-</span> <span class="fu">label_number</span><span class="op">(</span></span>
<span>  accuracy <span class="op">=</span> <span class="fl">0.1</span>, scale <span class="op">=</span> <span class="fl">100</span>, suffix <span class="op">=</span> <span class="st">" pp."</span>, style_negative <span class="op">=</span> <span class="st">"minus"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="getting-cps-data-from-the-ipums-website" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="getting-cps-data-from-the-ipums-website">Getting CPS data from the IPUMS website</h2>
<p>Go to the <a href="https://cps.ipums.org/cps/">IPUMS CPS website</a> and create an account if you don’t already have one.</p>
<p>Once you’re logged in, go the <a href="https://cps.ipums.org/cps-action/variables/group">“Select Data” page</a>, where IPUMS tells you to do two things:</p>
<ol type="1">
<li>
<strong>Select samples</strong>, or specific verisons of different surveys</li>
<li>
<strong>Select variables</strong>, or specific columns in different surveys</li>
</ol>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><a href="img/01-data-extract.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Initial data extract page"><img src="img/01-data-extract.png" class="img-fluid figure-img" alt="Initial data extract page"></a></p>
<figcaption class="margin-caption">Initial data extract page</figcaption></figure>
</div>
<p>Visually it looks like you should select samples first, but <strong>I actually find it easier to poke around for different variables first</strong>, since not all variables are recorded in every sample.</p>
<section id="finding-variables" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="finding-variables">Finding variables</h3>
<p>So first let’s look at a few variables to get a feel for the IPUMS data extract website. Click on the little “SEARCH 🔍” button in the “SELECT VARIABLES” section. We could do a bunch of fancy advanced search options, but for now, just search for “age”</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><a href="img/02-age-search.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Searching for age-related variables"><img src="img/02-age-search.png" class="img-fluid figure-img" alt="Searching for age-related variables"></a></p>
<figcaption class="margin-caption">Searching for age-related variables</figcaption></figure>
</div>
<p>There are 200+(!) age-related variables in the CPS data:</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><a href="img/02-age-results.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Search results related to age"><img src="img/02-age-results.png" class="img-fluid figure-img" alt="Search results related to age"></a></p>
<figcaption class="margin-caption">Search results related to age</figcaption></figure>
</div>
<p>This big list shows some useful information already. The first variable in the search results is <code>AGE</code>, and it’s the one we care about. It gets recorded in every CPS survey: each monthly one and in the annual ASEC one. Not all the age variables do this—notice that <code>WHYSS1</code> only appears in the annual ASEC.</p>
<p>If you click on <code>AGE</code> in the “Variable” column, you can see detailed information about the variable, like how it’s coded, a description, and its availability. For example, prior to 1976, age was only available in the annual ASEC; starting in January 1976, it became a monthly thing.</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><a href="img/02-age-availability.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="AGE availability"><img src="img/02-age-availability.png" class="img-fluid figure-img" alt="AGE availability"></a></p>
<figcaption class="margin-caption">AGE availability</figcaption></figure>
</div>
<p>Since we know we want this variable, we can add it to our “Data Cart”. IPUMS ues a shopping metaphor for building a data extract—we can add different variables and samples to a cart and then check it out (for free) once we’ve found everything we’re looking for.</p>
<p>Click on “Add to cart” to add it, then go back to the search page to look for more variables. You can also add variables to the cart without going to the variable details page—there’s a plus sign in the search results page next to each result that will add the variable for you.</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><a href="img/02-age-add-cart.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="Add AGE to cart"><img src="img/02-age-add-cart.png" class="img-fluid figure-img" alt="Add AGE to cart"></a></p>
<figcaption class="margin-caption">Add AGE to cart</figcaption></figure>
</div>
<p>Now that we have age, we need to hunt around for other variables we care about, like sex, marital status, voting history, and so on. To speed things up, you can search for their official variable names and add each one to the cart:</p>
<ul>
<li>Sex = <code>SEX</code>
</li>
<li>Marital status = <code>MARST</code>
</li>
<li>Education = <code>EDUC</code>
</li>
<li>Donating = <code>VLDONATE</code>
</li>
<li>Volunteering = <code>VLSTATUS</code>
</li>
<li>Volunteering Supplement weight = <code>VLSUPPWT</code>
</li>
<li>Voting = <code>VOTED</code>
</li>
<li>Voter Supplement weight = <code>VOSUPPWT</code>
</li>
</ul>
<section id="pay-attention-to-the-details" class="level4 page-columns page-full"><h4 class="anchored" data-anchor-id="pay-attention-to-the-details">Pay attention to the details!</h4>
<p>Looking at the details for these variables is helpful since they’re all categorical variables, unlike age. For instance, marital status has 9 different levels:</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><a href="img/03-marst-codes.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7" title="Nine different marital status (MARST) codes"><img src="img/03-marst-codes.png" class="img-fluid figure-img" alt="Nine different marital status (MARST) codes"></a></p>
<figcaption class="margin-caption">Nine different marital status (MARST) codes</figcaption></figure>
</div>
<p>Also, it’s important to check the variable details to check for availability. While basic demographic variables like age, sex, marital status, etc. are available in both the monthly surveys and in the annual ASEC, more specialized variables are not.</p>
<p>Variables related to philanthropy and volunteering are only available in September (since they’re part of a <a href="https://cps.ipums.org/cps/volunteer_sample_notes.shtml">special CPS Volunteer Supplement</a>), and only in some years:</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><a href="img/03-vlstatus-availability.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8" title="Volunteer status (VLSTATUS) only available in September, and only in some years"><img src="img/03-vlstatus-availability.png" class="img-fluid figure-img" alt="Volunteer status (VLSTATUS) only available in September, and only in some years"></a></p>
<figcaption class="margin-caption">Volunteer status (VLSTATUS) only available in September, and only in some years</figcaption></figure>
</div>
<p>Variables related to voting are only available in November in even-numbered years (since they’re part the <a href="https://cps.ipums.org/cps/voter_sample_notes.shtml">CPS’s Voting and Registration Supplement</a>)</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><a href="img/03-voted-availability.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9" title="Voting status (VOTED) only available in even-numbered years in November"><img src="img/03-voted-availability.png" class="img-fluid figure-img" alt="Voting status (VOTED) only available in even-numbered years in November"></a></p>
<figcaption class="margin-caption">Voting status (VOTED) only available in even-numbered years in November</figcaption></figure>
</div>
</section></section><section id="selecting-samples" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="selecting-samples">Selecting samples</h3>
<p>Great! If you check the cart, you’ll see all the variables we added at the bottom, along with a bunch of other pre-selected columns:</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><a href="img/04-cart-no-samples.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10" title="All variables added to the cart, but no samples are selected"><img src="img/04-cart-no-samples.png" class="img-fluid figure-img" alt="All variables added to the cart, but no samples are selected"></a></p>
<figcaption class="margin-caption">All variables added to the cart, but no samples are selected</figcaption></figure>
</div>
<p>We can’t download any data yet, though. We’ve selected the variables—now we need to select the samples. Go back to the “Select data” page and click on “Select samples” (or click on the “Add more samples” button at the top of the data cart page).</p>
<p>By default, IPUMS will have a bunch of different samples pre-checked. In my case, it grabbed all annual ASEC surveys from 2010–2024, and all monthly surveys from 2021–2024.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset page-columns page-full">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Pre-selected ASEC samples</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Pre-selected monthly samples</a></li>
</ul>
<div class="tab-content page-columns page-full">
<div id="tabset-1-1" class="tab-pane active page-columns page-full" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><a href="img/05-default-samples-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11" title="Pre-selected ASEC samples"><img src="img/05-default-samples-1.png" class="img-fluid figure-img" alt="Pre-selected ASEC samples"></a></p>
<figcaption class="margin-caption">Pre-selected ASEC samples</figcaption></figure>
</div>
</div>
<div id="tabset-1-2" class="tab-pane page-columns page-full" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><a href="img/05-default-samples-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12" title="Pre-selected monthly samples"><img src="img/05-default-samples-2.png" class="img-fluid figure-img" alt="Pre-selected monthly samples"></a></p>
<figcaption class="margin-caption">Pre-selected monthly samples</figcaption></figure>
</div>
</div>
</div>
</div>
<p>Including all these samples would be useful if we were doing some sort of analysis of CPS trends over time, comparing changes in age or education or volunteering or whatever. But that doesn’t matter here—all we want to know is what age (and everything else) looked like at the time the survey was administered. That means we really just need one year.</p>
<p>However, we can’t just choose one sample. Things like demographics are availble in all annual and monthly samples, but volunteering is only available in September in specific years, and voting is only available in November in specific years.</p>
<p>This survey was administered in mid-2019, so we’ll choose samples that are as close to that as possible. Though demographics are available both monthly and annually, I like to use the annual versions because ASEC data is typically used to stand in for annual information—like if you were building a state-year panel dataset, you’d use ASEC data for each year. The ASEC occurs in March and actually overlaps with the monthly March data (<a href="https://cps.ipums.org/cps/basic_asec.shtml">IPUMS has a note about that</a>), so the data <em>technically</em> is for March 2019, but whatever. We don’t have to be super precise here.</p>
<p>We’ll use the September 2019 sample for volunteering, even though that’s after the survey was administered. The next earliest volunteering data is the September 2017 sample, which is like 2 years before the survey. Things don’t line up precisely, but again, that’s fine.</p>
<p>Finally, we’ll use the November 2018 sample for voting. That’s before the survey, but it’s the closest we can get—the next alternative is November 2020, which is a year after the survey. Once again, nothing lines up exactly, but it’s fine.</p>
<p>In summary, here are the variables we want and the samples we’ll get them from:</p>
<ul>
<li>Age (<code>AGE</code>): 2019 ASEC</li>
<li>Sex (<code>SEX</code>): 2019 ASEC</li>
<li>Marital status (<code>MARST</code>): 2019 ASEC</li>
<li>Education (<code>EDUC</code>): 2019 ASEC</li>
<li>Donating (<code>VLDONATE</code>): 2019-09 Monthly</li>
<li>Volunteering (<code>VLSTATUS</code>): 2019-09 Monthly</li>
<li>Volunteering Supplement weight (<code>VLSUPPWT</code>): 2019-09 Monthly</li>
<li>Voting (<code>VOTED</code>): 2018-11 Monthly</li>
<li>Voter Supplement weight (<code>VOSUPPWT</code>): 2018-11 Monthly</li>
</ul>
<p>Select those three samples (2019 ASEC, September 2019, and November 2018) and click on “Submit sample selections” to add them to the cart.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset page-columns page-full">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Specific ASEC sample</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Specific monthly samples</a></li>
</ul>
<div class="tab-content page-columns page-full">
<div id="tabset-2-1" class="tab-pane active page-columns page-full" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><a href="img/05-asec-real.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13" title="March 2019 ASEC sample"><img src="img/05-asec-real.png" class="img-fluid figure-img" alt="March 2019 ASEC sample"></a></p>
<figcaption class="margin-caption">March 2019 ASEC sample</figcaption></figure>
</div>
</div>
<div id="tabset-2-2" class="tab-pane page-columns page-full" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><a href="img/05-monthly-real.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14" title="September 2019 and November 2018 monthly samples"><img src="img/05-monthly-real.png" class="img-fluid figure-img" alt="September 2019 and November 2018 monthly samples"></a></p>
<figcaption class="margin-caption">September 2019 and November 2018 monthly samples</figcaption></figure>
</div>
</div>
</div>
</div>
<p>The cart should now have 9 variables and 3 samples. Conveniently, it has a little summary table showing which samples have which variables, where we can confirm that age, sex, marital status, and education are in all three, volunteering and donating are only in September 2019, and voting is only in November 2018.</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><a href="img/05-everything-selected.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15" title="All variables and samples selected and ready to go"><img src="img/05-everything-selected.png" class="img-fluid figure-img" alt="All variables and samples selected and ready to go"></a></p>
<figcaption class="margin-caption">All variables and samples selected and ready to go</figcaption></figure>
</div>
</section><section id="downloading-the-data" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="downloading-the-data">Downloading the data</h3>
<p>Now that we have all the variables and samples we care about in the data cart, we can create a data extract and download this stuff.</p>
<p>Click on the “Create data extract” button at the top of the data cart page, which will take you to the official Extract Request page. There are a bunch of extra options here, and you can optionally add a description to the extract, but we’ll ignore all those. Click on the “Submit Abstract” button and wait for the IPUMS server to compile it all.</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><a href="img/06-extract-page.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16" title="Extract submission page"><img src="img/06-extract-page.png" class="img-fluid figure-img" alt="Extract submission page"></a></p>
<figcaption class="margin-caption">Extract submission page</figcaption></figure>
</div>
<p>Once it’s ready, it’ll appear at your “My Data” page, which will have a list of all your past extracts.</p>
<p>To download the data, we actually need to download two things:</p>
<ol type="1" class="page-columns page-full">
<li class="page-columns page-full">
<p><strong>The data itself.</strong> Click on the big green “Download .DAT” button.</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><a href="img/07-data-page-download-dat.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17" title="Button for download a .dat version of the data"><img src="img/07-data-page-download-dat.png" class="img-fluid figure-img" alt="Button for download a .dat version of the data"></a></p>
<figcaption class="margin-caption">Button for download a <code>.dat</code> version of the data</figcaption></figure>
</div>
</li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code>.dat</code> vs <code>.dat.gz</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Depending on your browser, the downloaded file will either end in <code>.dat</code> or <code>.dat.gz</code>. If it ends in <code>.gz</code>, it’ll be compressed and zipped (the compressed version of this extract is 7.6 MB); if it ends in <code>.dat</code>, it’ll be uncompressed and huge (≈55 MB in this case). Chrome and Firefox will keep the compressed <code>.gz</code> version; Safari will automatically unzip it and throw away the <code>.gz</code> version, which is annoying.</p>
<p>Try to keep the compressed version. You don’t even need to extract/unzip it—the {ipumsr} data loading functions will handle unzipping for you automatically behind the scenes.</p>
</div>
</div>
<ol start="2" type="1" class="page-columns page-full">
<li class="page-columns page-full">
<p>The machine-readable XML codebook, or <strong>the DDI file</strong>. R uses to clean and relabel the raw data when you load it. If you click on the DDI link in the Codebook column, your browser will likely open a plain text XML file, which isn’t really what you want. Instead, right click on the DDI link and choose “Save file as…” or “Download file as…” or whatever your browser calls it. This will let you save the XML file to your computer.</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><a href="img/07-data-page-download-ddi.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18" title="Context menu for the DDI codebook link"><img src="img/07-data-page-download-ddi.png" class="img-fluid figure-img" style="width:50.0%" alt="Context menu for the DDI codebook link"></a></p>
<figcaption class="margin-caption">Context menu for the DDI codebook link</figcaption></figure>
</div>
</li>
</ol>
<p>There are some other helpful links there too:</p>
<ul>
<li>
<p>If you click on the R link, it’ll give you a barebones R script for loading the data. It’ll look something like this:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># NOTE: To load data, you must download both the extract's data and the DDI</span></span>
<span><span class="co"># and also set the working directory to the folder with these files (or change the path below).</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="st"><a href="https://tech.popdata.org/ipumsr/">"ipumsr"</a></span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"Reading IPUMS data into R requires the ipumsr package. It can be installed using the following command: install.packages('ipumsr')"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ddi</span> <span class="op">&lt;-</span> <span class="fu">read_ipums_ddi</span><span class="op">(</span><span class="st">"cps_00001.xml"</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">read_ipums_micro</span><span class="op">(</span><span class="va">ddi</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</li>
<li><p>If you click on the basic codebook, you’ll get a short plain text version of the codebook, which I find really helpful for remembering which variables show up where and how each variable is coded.</p></li>
</ul>
<p>Move the newly downloaded <code>.dat</code> and the <code>.ddi</code> files to the same folder somewhere on your computer (preferably in an RStudio Project or a Positron project/folder or wherever your R working directory is). I put mine in a folder named <code>raw_data</code>; you can put it wherever.</p>
<p>We’re finally ready to load this CPS data into R!</p>
</section></section><section id="more-reproducible-alternative-using-the-ipums-api" class="level2"><h2 class="anchored" data-anchor-id="more-reproducible-alternative-using-the-ipums-api">More reproducible alternative: using the IPUMS API</h2>
<p>Alternatively, it’s possible to use the {ipumsr} package to access the IPUMS API directly and not need to manually download the data extract from the IPUMS website.</p>
<p>The {ipumsr} API functions essentially let you programmatically create and download a data extract cart. Unless you know the IPUMS CPS data <em>really well</em>, <strong>you’ll still likely need to hunt around the website for specific variables and their availabilities</strong>, so the whole previous section is still relevant.</p>
<p><a href="https://tech.popdata.org/ipumsr/articles/ipums-api.html">The {ipumsr} vignette for working with the API</a> is nice and complete—see that for full details.</p>
<p>Here’s an abbreviated example of how to get the same data extract we collected manually from the website:</p>
<ol type="1">
<li>
<p>Go to your IPUMS dashboard and <a href="https://account.ipums.org/api_keys">create an API key</a>. This needs to be stored as an environment variable named <code>IPUMS_API_KEY</code>. You can manually add this to your <code>.Renviron</code> file, or you can run this to make {ipumsr} do it for you:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ipumsr</span><span class="fu">::</span><span class="fu">set_ipums_api_key</span><span class="op">(</span><span class="st">"BLAH"</span>, save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</li>
<li>
<p>Build a data extract with <code>define_extract_micro()</code>. This is the equivalent of adding stuff to your data cart on the IPUMS website. You’ll need to know two things:</p>
<ul>
<li><p>The variable names, which you can find by searching the IPUMS website</p></li>
<li>
<p>The sample IDs, which you can find by running <code>get_sample_info()</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tech.popdata.org/ipumsr/">ipumsr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">all_cps_samples</span> <span class="op">&lt;-</span> <span class="fu">get_sample_info</span><span class="op">(</span>collection <span class="op">=</span> <span class="st">"cps"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Find the names for 2019 samples</span></span>
<span><span class="va">all_cps_samples</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">description</span>, <span class="st">"ASEC 2019"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 13 × 2</span></span>
<span><span class="co">#&gt;    name        description              </span></span>
<span><span class="co">#&gt;    &lt;chr&gt;       &lt;chr&gt;                    </span></span>
<span><span class="co">#&gt;  1 cps2019_01s IPUMS-CPS, January 2019  </span></span>
<span><span class="co">#&gt;  2 cps2019_02s IPUMS-CPS, February 2019 </span></span>
<span><span class="co">#&gt;  3 cps2019_03b IPUMS-CPS, March 2019    </span></span>
<span><span class="co">#&gt;  4 cps2019_04b IPUMS-CPS, April 2019    </span></span>
<span><span class="co">#&gt;  5 cps2019_05s IPUMS-CPS, May 2019      </span></span>
<span><span class="co">#&gt;  6 cps2019_06s IPUMS-CPS, June 2019     </span></span>
<span><span class="co">#&gt;  7 cps2019_03s IPUMS-CPS, ASEC 2019  </span></span>
<span><span class="co">#&gt;  ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</li>
</ul>
<p>The code for creating the extract will look like this:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cps_extract_definition</span> <span class="op">&lt;-</span> <span class="fu">define_extract_micro</span><span class="op">(</span></span>
<span>  collection <span class="op">=</span> <span class="st">"cps"</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"API extract for blog post"</span>,</span>
<span>  samples <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"cps2019_03s"</span>,  <span class="co"># ASEC, March 2019</span></span>
<span>    <span class="st">"cps2019_09s"</span>,  <span class="co"># CPS, September 2019</span></span>
<span>    <span class="st">"cps2018_11s"</span>   <span class="co"># CPS, November 2018</span></span>
<span>  <span class="op">)</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"AGE"</span>, <span class="st">"SEX"</span>, <span class="st">"MARST"</span>, <span class="st">"EDUC"</span>,</span>
<span>    <span class="st">"VLDONATE"</span>, <span class="st">"VLSTATUS"</span>, <span class="st">"VLSUPPWT"</span>,</span>
<span>    <span class="st">"VOTED"</span>, <span class="st">"VOSUPPWT"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This is identical to what we had in the cart on the the website: 9 variables and 3 samples:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cps_extract_definition</span></span>
<span><span class="co">#&gt; Unsubmitted IPUMS CPS extract </span></span>
<span><span class="co">#&gt; Description: API extract for blog post</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Samples: (3 total) cps2019_03s, cps2019_09s, cps2018_11s</span></span>
<span><span class="co">#&gt; Variables: (9 total) AGE, SEX, MARST, EDUC, VLDONATE, VLSTATUS, VLSU...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</li>
<li>
<p>Submit the request to the server to generate the extract. This is equivalent to checking out your data cart on the website.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cps_extract</span> <span class="op">&lt;-</span> <span class="fu">submit_extract</span><span class="op">(</span><span class="va">cps_extract_definition</span><span class="op">)</span></span>
<span><span class="co">#&gt; Successfully submitted IPUMS CPS extract number ZZZZ</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</li>
<li>
<p>Download the extract. The extract won’t be downloadable immediately—you need to wait for e-mail confirmation. Once it’s ready, you can download it with <code>download_extract()</code>, which will download both the <code>.dat.gz</code> data and the <code>.xml</code> codebook to your computer:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cps_downloaded</span> <span class="op">&lt;-</span> <span class="fu">download_extract</span><span class="op">(</span><span class="va">cps_extract</span>, download_dir <span class="op">=</span> <span class="st">"raw_data"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  |==================================================| 100%</span></span>
<span><span class="co">#&gt;  |==================================================| 100%</span></span>
<span><span class="co">#&gt; DDI codebook file saved to ~/blah/raw_data/cps_ZZZZ.xml</span></span>
<span><span class="co">#&gt; Data file saved to ~/blah/raw_data/cps_ZZZZ.dat.gz</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</li>
<li>
<p>Once it’s on your computer, you can load it with the standard {ipumsr} process shown in the next section.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cps_data</span> <span class="op">&lt;-</span> <span class="fu">read_ipums_micro</span><span class="op">(</span><span class="va">cps_downloaded</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</li>
</ol>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The IPUMS API and literate programming
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you’re using a literate programming document Quarto or R Markdown, <strong>don’t include this API extraction process in your document</strong>. It will rerun every time you render your document and create a new IPUMS extract each time, which is excessive. It’s best to run this process in a separate R script or function (perhaps orchestrated with something like <a href="https://books.ropensci.org/targets/">{targets}</a>), and then load the DDI <code>.xml</code> and <code>.dat</code> data in the document.</p>
</div>
</div>
</section><section id="loading-cps-data" class="level2"><h2 class="anchored" data-anchor-id="loading-cps-data">Loading CPS data</h2>
<p>Getting this data into R is easy thanks to <a href="https://tech.popdata.org/ipumsr/">the {ipumsr} package</a>. We feed the XML DDI codebook into <code>read_ipums_ddi()</code> and then feed that into <code>read_ipums_micro()</code></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tech.popdata.org/ipumsr/">ipumsr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ddi</span> <span class="op">&lt;-</span> <span class="fu">read_ipums_ddi</span><span class="op">(</span><span class="st">"raw_data/cps_00001.xml"</span><span class="op">)</span></span>
<span><span class="va">cps_data</span> <span class="op">&lt;-</span> <span class="fu">read_ipums_micro</span><span class="op">(</span><span class="va">ddi</span>, data_file <span class="op">=</span> <span class="st">"raw_data/cps_00001.dat.gz"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">cps_data</span><span class="op">)</span></span>
<span><span class="co">## Rows: 421,402</span></span>
<span><span class="co">## Columns: 21</span></span>
<span><span class="co">## $ YEAR     &lt;dbl&gt; 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018, 2018,…</span></span>
<span><span class="co">## $ SERIAL   &lt;dbl&gt; 1, 1, 3, 4, 4, 4, 4, 5, 5, 6, 6, 7, 7, 7, 8, 8, 9, 9, 10, 10, 11, 12, 13, 13, 14, 14, 14, 15, 15, 16, 17, 19, 20, 20, 21, 21, 22, 23, 23, 23, 23, 24, 25, 26, 26, 26, 26, 26, 28, 28, 28, 28, 29, 30, 30, 30, 32, 36, 36, 37, 37, 37, 37, 39, 39, 39, 39, 39, 40, 40, 41, 41, 41, 41, 42,…</span></span>
<span><span class="co">## $ MONTH    &lt;int+lbl&gt; 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 1…</span></span>
<span><span class="co">## $ HWTFINL  &lt;dbl&gt; 1704, 1704, 1957, 1688, 1688, 1688, 1688, 2090, 2090, 1832, 1832, 1779, 1779, 1779, 1853, 1853, 2077, 2077, 1427, 1427, 1611, 2044, 1738, 1738, 1690, 1690, 1690, 3135, 3135, 2679, 2253, 1639, 1615, 1615, 1515, 1515, 2254, 1459, 1459, 1459, 1459, 1960, 1942, 1701, 1701, 1701, 1701,…</span></span>
<span><span class="co">## $ CPSID    &lt;dbl&gt; 2.017e+13, 2.017e+13, 2.018e+13, 2.017e+13, 2.017e+13, 2.017e+13, 2.017e+13, 2.018e+13, 2.018e+13, 2.017e+13, 2.017e+13, 2.018e+13, 2.018e+13, 2.018e+13, 2.017e+13, 2.017e+13, 2.018e+13, 2.018e+13, 2.018e+13, 2.018e+13, 2.017e+13, 2.017e+13, 2.017e+13, 2.017e+13, 2.017e+13, 2.017e…</span></span>
<span><span class="co">## $ ASECFLAG &lt;int+lbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</span></span>
<span><span class="co">## $ ASECWTH  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</span></span>
<span><span class="co">## $ PERNUM   &lt;dbl&gt; 1, 2, 1, 1, 2, 3, 4, 1, 2, 1, 2, 1, 2, 3, 1, 2, 1, 2, 1, 2, 1, 1, 1, 2, 1, 2, 3, 1, 2, 1, 1, 1, 1, 2, 1, 2, 1, 1, 2, 3, 4, 1, 1, 1, 2, 3, 4, 5, 1, 2, 3, 4, 1, 1, 2, 3, 1, 1, 2, 1, 2, 3, 4, 1, 2, 3, 4, 5, 1, 2, 1, 2, 3, 4, 1, 1, 1, 2, 1, 1, 2, 3, 1, 2, 1, 2, 3, 4, 1, 2, 1, 2, 3, 4,…</span></span>
<span><span class="co">## $ WTFINL   &lt;dbl&gt; 1704, 1845, 1957, 1688, 2780, 2780, 2679, 2090, 2090, 1832, 2679, 1754, 1779, 2452, 1853, 1870, 2151, 2077, 2003, 1427, 1611, 2044, 1738, 1738, 1690, 2102, 2537, 3135, 4172, 2679, 2253, 1639, 1615, 2609, 1900, 1515, 2254, 1459, 1546, 1912, 1752, 1960, 1942, 1527, 1701, 2231, 2104,…</span></span>
<span><span class="co">## $ CPSIDP   &lt;dbl&gt; 2.017e+13, 2.017e+13, 2.018e+13, 2.017e+13, 2.017e+13, 2.017e+13, 2.017e+13, 2.018e+13, 2.018e+13, 2.017e+13, 2.017e+13, 2.018e+13, 2.018e+13, 2.018e+13, 2.017e+13, 2.017e+13, 2.018e+13, 2.018e+13, 2.018e+13, 2.018e+13, 2.017e+13, 2.017e+13, 2.017e+13, 2.017e+13, 2.017e+13, 2.017e…</span></span>
<span><span class="co">## $ CPSIDV   &lt;dbl&gt; 2.017e+14, 2.017e+14, 2.018e+14, 2.017e+14, 2.017e+14, 2.017e+14, 2.017e+14, 2.018e+14, 2.018e+14, 2.017e+14, 2.017e+14, 2.018e+14, 2.018e+14, 2.018e+14, 2.017e+14, 2.017e+14, 2.018e+14, 2.018e+14, 2.018e+14, 2.018e+14, 2.017e+14, 2.017e+14, 2.017e+14, 2.017e+14, 2.017e+14, 2.017e…</span></span>
<span><span class="co">## $ ASECWT   &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</span></span>
<span><span class="co">## $ AGE      &lt;int+lbl&gt; 26, 26, 48, 53, 16, 16, 20, 22, 23, 57, 23, 61, 62, 39, 74, 49, 54, 52, 69, 76, 41, 56, 64, 62, 53, 13, 21, 28, 28, 40, 51, 78, 64, 40, 59, 36, 27, 35, 36, 5, 8, 76, 80, 36, 33, 3, 6, 11, 62, 80, 61, 61, 57, 24, 22, 26, 61, 24, 0, 37, 3, 5, 32, 33, 8, 9, 10, 15, 55, 61, 29, 29…</span></span>
<span><span class="co">## $ SEX      &lt;int+lbl&gt; 2, 1, 2, 2, 1, 1, 2, 1, 1, 2, 2, 1, 2, 2, 2, 2, 1, 2, 1, 2, 1, 2, 1, 1, 1, 2, 2, 2, 1, 1, 2, 2, 2, 2, 1, 2, 2, 2, 1, 1, 1, 2, 1, 1, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 2, 1, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 1, 1, 1, 2, 2, 1, 2, 1, 1, 1, 1, 2, 2, 1, 2, 2, 2, 1, 1, 2, 2, 1, 2, 1, 2, 2, 2…</span></span>
<span><span class="co">## $ MARST    &lt;int+lbl&gt; 6, 6, 4, 4, 6, 6, 6, 6, 6, 4, 6, 1, 1, 6, 5, 6, 1, 1, 1, 1, 6, 4, 6, 6, 5, 9, 6, 1, 1, 6, 3, 5, 6, 6, 1, 1, 6, 1, 1, 9, 9, 5, 4, 1, 1, 9, 9, 9, 6, 5, 4, 3, 4, 6, 6, 6, 3, 6, 9, 3, 9, 9, 6, 6, 9, 9, 9, 6, 1, 1, 1, 1, 9, 9, 6, 4, 1, 1, 4, 1, 1, 9, 1, 1, 1, 1, 9, 9, 1, 1, 4, 1, 5…</span></span>
<span><span class="co">## $ EDUC     &lt;int+lbl&gt; 111, 123, 73, 81, 50, 50, 81, 81, 81, 111, 81, 81, 81, 92, 81, 81, 123, 111, 81, 60, 111, 73, 73, 73, 81, 1, 81, 81, 81, 91, 111, 60, 73, 73, 125, 81, 92, 124, 111, 1, 1, 60, 73, 123, 125, 1, 1, 1, 73, 30, 73, 73, 124, 81, 92, 73, 73, 73, 1, 20, 1, 1, 20, 73, 1, 1, 1, 30, 111,…</span></span>
<span><span class="co">## $ VLSTATUS &lt;int+lbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</span></span>
<span><span class="co">## $ VLDONATE &lt;int+lbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</span></span>
<span><span class="co">## $ VLSUPPWT &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</span></span>
<span><span class="co">## $ VOTED    &lt;int+lbl&gt; 98, 98, 2, 2, 99, 99, 2, 99, 99, 98, 98, 2, 2, 2, 1, 97, 2, 2, 1, 1, 2, 98, 2, 1, 2, 99, 1, 1, 2, 98, 98, 2, 98, 98, 98, 98, 2, 2, 2, 99, 99, 1, 2, 1, 1, 99, 99, 99, 2, 1, 1, 2, 2, 1, 1, 1, 2, 1, 99, 98, 99, 99, 98, 2, 99, 99, 99, 99, 1, 1, 2, 2, 99, 99, 2, 98, 2, 2, 96, 2, 2,…</span></span>
<span><span class="co">## $ VOSUPPWT &lt;dbl&gt; 1704, 1845, 1957, 1688, 2780, 2780, 2679, 2090, 2090, 1832, 2679, 1754, 1779, 2452, 1853, 1870, 2151, 2077, 2003, 1427, 1611, 2044, 1738, 1738, 1690, 2102, 2537, 3135, 4172, 2679, 2253, 1639, 1615, 2609, 1900, 1515, 2254, 1459, 1546, 1912, 1752, 1960, 1942, 1527, 1701, 2231, 2104,…</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>holy moly we have nearly half a million rows. That’s because we have three samples (2019 ASEC, September 2019, and November 2018) and they’re all stacked on top of each other in this data. We need to filter this huge data to extract the three samples. We’ll also remove rows with missing data.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cps_demographics</span> <span class="op">&lt;-</span> <span class="va">cps_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Only look at the 2019 ASEC data</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">YEAR</span> <span class="op">==</span> <span class="fl">2019</span>, <span class="va">MONTH</span> <span class="op">==</span> <span class="fl">03</span>, <span class="va">ASECFLAG</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Remove rows that are missing or are "not in universe"</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    SEX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">SEX</span> <span class="op">==</span> <span class="fl">9</span>, <span class="cn">NA</span>, <span class="va">SEX</span><span class="op">)</span>,</span>
<span>    MARST <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">MARST</span> <span class="op">==</span> <span class="fl">9</span>, <span class="cn">NA</span>, <span class="va">MARST</span><span class="op">)</span>,</span>
<span>    EDUC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">EDUC</span> <span class="op">&lt;</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">EDUC</span> <span class="op">==</span> <span class="fl">999</span>, <span class="cn">NA</span>, <span class="va">EDUC</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">cps_volunteer</span> <span class="op">&lt;-</span> <span class="va">cps_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">YEAR</span> <span class="op">==</span> <span class="fl">2019</span>, <span class="va">MONTH</span> <span class="op">==</span> <span class="fl">09</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Remove rows that are missing or are "not in universe"</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">VLSTATUS</span>, <span class="va">VLDONATE</span><span class="op">)</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="fl">99</span>, <span class="cn">NA</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cps_voting</span> <span class="op">&lt;-</span> <span class="va">cps_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">YEAR</span> <span class="op">==</span> <span class="fl">2018</span>, <span class="va">MONTH</span> <span class="op">==</span> <span class="fl">11</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Remove rows that are missing or are "not in universe"</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>VOTED <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">VOTED</span> <span class="op">==</span> <span class="fl">99</span>, <span class="cn">NA</span>, <span class="va">VOTED</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These counts are more reasonable (but still huge!)</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">cps_demographics</span><span class="op">)</span></span>
<span><span class="co">## [1] 180101</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">cps_volunteer</span><span class="op">)</span></span>
<span><span class="co">## [1] 118557</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">cps_voting</span><span class="op">)</span></span>
<span><span class="co">## [1] 122744</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="summarizing-cps-data" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="summarizing-cps-data">Summarizing CPS data</h2>
<p>Ultimately, our goal is to find the population-level average of a bunch of characteristics and see if our sample plausibly matches population averages.</p>
<p>Things get a little tricky and loosey-goosey here. The different levels measured by the CPS don’t always match what’s in the survey. For example, the CPS measures sex and provides only 2 levels (1 = male; 2 = female); the experiment called this construct gender and included male, female,<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> transgender, prefer not to say, and other.</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;We should have called these “man” and “woman” since gender ≠ sex.</p></div></div><p>To make the survey question reasonably match what the CPS is capturing, I find that it’s easiest to collapse both the survey data and the CPS data to simpler constructs. Before we collapse things, though, we need to look at one statistical issue: weighting.</p>
<section id="weighting" class="level3"><h3 class="anchored" data-anchor-id="weighting">Weighting</h3>
<p>In an effort to make the CPS nationally representative, every row is <a href="https://cps.ipums.org/cps-action/faq#7">weighted</a>—<a href="https://cps.ipums.org/cps-action/faq#ques21">each individual does not represent the same number of persons in the population</a>. The Census oversamples some subpopulations and shifts weights up and down to give individuals more or less statistical influence in the sample so that the survey results better approximate the characteristics of the general population. Any analysis we do with CPS data needs to take those weights into account.</p>
<p>The weights for ASEC variables are included in the <code>ASECWT</code> column; the weights for volunteering and voting variables are in the <code>VLSUPPWT</code> and <code>VOSUPPWT</code> columns</p>
<p>If we’re calculating basic averages, we can use <code><a href="https://rdrr.io/r/stats/weighted.mean.html">weighted.mean()</a></code> instead of <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code>. Note the difference in average when we don’t weight!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cps_demographics</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span></span>
<span>    avg_age_weighted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html">weighted.mean</a></span><span class="op">(</span><span class="va">AGE</span>, w <span class="op">=</span> <span class="va">ASECWT</span><span class="op">)</span>,  <span class="co"># BAD</span></span>
<span>    avg_age_unweighted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">AGE</span><span class="op">)</span>  <span class="co"># GOOD</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 2</span></span>
<span><span class="co">##   avg_age_weighted avg_age_unweighted</span></span>
<span><span class="co">##              &lt;dbl&gt;              &lt;dbl&gt;</span></span>
<span><span class="co">## 1             38.8               37.3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we’re doing stuff with models, we can use the <code>weights</code> argument:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># BAD: Non-weighted intercept-only model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">AGE</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">cps_demographics</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidy</span><span class="op">(</span>conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 7</span></span>
<span><span class="co">##   term        estimate std.error statistic p.value conf.low conf.high</span></span>
<span><span class="co">##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">## 1 (Intercept)     37.3    0.0540      690.       0     37.2      37.4</span></span>
<span></span>
<span><span class="co"># GOOD: Weighted intercept-only model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">AGE</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">cps_demographics</span>, weights <span class="op">=</span> <span class="va">ASECWT</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidy</span><span class="op">(</span>conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 7</span></span>
<span><span class="co">##   term        estimate std.error statistic p.value conf.low conf.high</span></span>
<span><span class="co">##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">## 1 (Intercept)     38.8    0.0542      715.       0     38.7      38.9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Base R only really has <code><a href="https://rdrr.io/r/stats/weighted.mean.html">weighted.mean()</a></code>. If we want other things, like a weighted variance, or weighted rank, or weighted table/crosstabs, we can use a bunch of different functions in the {Hmisc} package:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Some Hmisc::wtd.*() things:</span></span>
<span><span class="va">cps_demographics</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span></span>
<span>    avg_age <span class="op">=</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu">wtd.mean</span><span class="op">(</span><span class="va">AGE</span>, weights <span class="op">=</span> <span class="va">ASECWT</span><span class="op">)</span>,</span>
<span>    var_age <span class="op">=</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu">wtd.var</span><span class="op">(</span><span class="va">AGE</span>, weights <span class="op">=</span> <span class="va">ASECWT</span><span class="op">)</span>,</span>
<span>    sd_age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">var_age</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 3</span></span>
<span><span class="co">##   avg_age var_age sd_age</span></span>
<span><span class="co">##     &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">## 1    38.8    529.   23.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="calculating-population-level-proportions" class="level3"><h3 class="anchored" data-anchor-id="calculating-population-level-proportions">Calculating population-level proportions</h3>
<p>We’ll collapse these population-level CPS values into binary versions of each question so that we can look at things like the proportion of women, the proportion of people who volunteer, and so on. We’ll also collapse age into a binary above/below the median age—this isn’t necessary, and we could totally work with numeric age instead of proportions, but in our anonymized survey data, our age column is an indicator representing being above/below 36 (the median age at the time of the survey).</p>
<p>We’ll do some basic summarizing with <code><a href="https://rdrr.io/r/stats/weighted.mean.html">weighted.mean()</a></code> and calculate all these national proportions, along with the weighted standard deviations (which will be important for the Bayesian analysis later in this post).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">national_demographics</span> <span class="op">&lt;-</span> <span class="va">cps_demographics</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span></span>
<span>    <span class="co"># AGE is already numeric</span></span>
<span>    age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html">weighted.mean</a></span><span class="op">(</span><span class="va">AGE</span> <span class="op">&gt;=</span> <span class="fl">36</span>, <span class="va">ASECWT</span><span class="op">)</span>, </span>
<span>    age_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu">Hmisc</span><span class="fu">::</span><span class="fu">wtd.var</span><span class="op">(</span><span class="va">AGE</span> <span class="op">&gt;=</span> <span class="fl">36</span>, weights <span class="op">=</span> <span class="va">ASECWT</span><span class="op">)</span><span class="op">)</span>,</span>
<span></span>
<span>    <span class="co"># 1 = Female</span></span>
<span>    female <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html">weighted.mean</a></span><span class="op">(</span><span class="va">SEX</span> <span class="op">==</span> <span class="fl">2</span>, <span class="va">ASECWT</span><span class="op">)</span>,</span>
<span>    female_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu">Hmisc</span><span class="fu">::</span><span class="fu">wtd.var</span><span class="op">(</span><span class="va">SEX</span> <span class="op">==</span> <span class="fl">2</span>, weights <span class="op">=</span> <span class="va">ASECWT</span><span class="op">)</span><span class="op">)</span>,</span>
<span></span>
<span>    <span class="co"># 1 = Married, spouse present</span></span>
<span>    <span class="co"># 2 = Married, spouse absent</span></span>
<span>    married <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html">weighted.mean</a></span><span class="op">(</span><span class="va">MARST</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    married_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu">Hmisc</span><span class="fu">::</span><span class="fu">wtd.var</span><span class="op">(</span><span class="va">MARST</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, weights <span class="op">=</span> <span class="va">ASECWT</span><span class="op">)</span><span class="op">)</span>,</span>
<span></span>
<span>    <span class="co"># 111 = Bachelor's degree</span></span>
<span>    college <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html">weighted.mean</a></span><span class="op">(</span><span class="va">EDUC</span> <span class="op">&gt;=</span> <span class="fl">111</span>, <span class="va">ASECWT</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    college_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu">Hmisc</span><span class="fu">::</span><span class="fu">wtd.var</span><span class="op">(</span><span class="va">EDUC</span> <span class="op">&gt;=</span> <span class="fl">111</span>, weights <span class="op">=</span> <span class="va">ASECWT</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">national_volunteer</span> <span class="op">&lt;-</span> <span class="va">cps_volunteer</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span></span>
<span>    <span class="co"># 1 = Volunteer</span></span>
<span>    volunteering <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html">weighted.mean</a></span><span class="op">(</span><span class="va">VLSTATUS</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">VLSUPPWT</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    volunteering_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu">Hmisc</span><span class="fu">::</span><span class="fu">wtd.var</span><span class="op">(</span><span class="va">VLSTATUS</span> <span class="op">==</span> <span class="fl">1</span>, weights <span class="op">=</span> <span class="va">VLSUPPWT</span><span class="op">)</span><span class="op">)</span>,</span>
<span></span>
<span>    <span class="co"># 2 = Yes, made a donation to charity in the past 12 months</span></span>
<span>    donating <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html">weighted.mean</a></span><span class="op">(</span><span class="va">VLDONATE</span> <span class="op">==</span> <span class="fl">2</span>, <span class="va">VLSUPPWT</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    donating_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu">Hmisc</span><span class="fu">::</span><span class="fu">wtd.var</span><span class="op">(</span><span class="va">VLDONATE</span> <span class="op">==</span> <span class="fl">2</span>, weights <span class="op">=</span> <span class="va">VLSUPPWT</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">national_voting</span> <span class="op">&lt;-</span> <span class="va">cps_voting</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span></span>
<span>    <span class="co"># 2 = Voted in the most recent November election</span></span>
<span>    voting <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html">weighted.mean</a></span><span class="op">(</span><span class="va">VOTED</span> <span class="op">==</span> <span class="fl">2</span>, <span class="va">VOSUPPWT</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    voting_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu">Hmisc</span><span class="fu">::</span><span class="fu">wtd.var</span><span class="op">(</span><span class="va">VOTED</span> <span class="op">==</span> <span class="fl">2</span>, weights <span class="op">=</span> <span class="va">VOSUPPWT</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I like to store these in a little one-row data frame so that it’s easy to access invidiual values:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">national_values</span> <span class="op">&lt;-</span> <span class="fu">bind_cols</span><span class="op">(</span></span>
<span>  <span class="va">national_demographics</span>, <span class="va">national_volunteer</span>, <span class="va">national_voting</span></span>
<span><span class="op">)</span></span>
<span><span class="va">national_values</span></span>
<span><span class="co">## # A tibble: 1 × 14</span></span>
<span><span class="co">##     age age_sd female female_sd married married_sd college college_sd volunteering volunteering_sd donating donating_sd voting voting_sd</span></span>
<span><span class="co">##   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt;           &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">## 1 0.530  0.499  0.510     0.500   0.410      0.492   0.258      0.437        0.300           0.458    0.474       0.499  0.534     0.499</span></span>
<span></span>
<span><span class="co"># Proportion of women</span></span>
<span><span class="va">national_values</span><span class="op">$</span><span class="va">female</span></span>
<span><span class="co">## [1] 0.5097</span></span>
<span></span>
<span><span class="co"># Proportion that voted</span></span>
<span><span class="va">national_values</span><span class="op">$</span><span class="va">voting</span></span>
<span><span class="co">## [1] 0.5344</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="summarizing-sample-proportions" class="level2"><h2 class="anchored" data-anchor-id="summarizing-sample-proportions">Summarizing sample proportions</h2>
<p>We’re almost done! All that’s left is testing whether the demographic characteristics of the survey experiment respondents reasonably match their corresponding population proportions.</p>
<p>First, though, we need to make binary versions of the survey responses. To make life easier, we’ll use the same names as the CPS data:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">results_to_test</span> <span class="op">&lt;-</span> <span class="va">results</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    age <span class="op">=</span> <span class="va">age</span> <span class="op">==</span> <span class="st">"More than median"</span>,</span>
<span>    female <span class="op">=</span> <span class="va">gender</span> <span class="op">==</span> <span class="st">"Female"</span>,</span>
<span>    married <span class="op">=</span> <span class="va">marital_status</span> <span class="op">==</span> <span class="st">"Married"</span>,</span>
<span>    college <span class="op">=</span> <span class="va">education</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"4 year degree"</span>, </span>
<span>      <span class="st">"Graduate or professional degree"</span>, </span>
<span>      <span class="st">"Doctorate"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    volunteering <span class="op">=</span> <span class="va">volunteer_frequency</span> <span class="op">!=</span> <span class="st">"Haven't volunteered in past 12 months"</span>,</span>
<span>    donating <span class="op">=</span> <span class="va">donate_frequency</span> <span class="op">==</span> <span class="st">"More than once a month, less than once a year"</span>,</span>
<span>    voting <span class="op">=</span> <span class="va">voted</span> <span class="op">==</span> <span class="st">"Yes"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">female</span>, <span class="va">age</span>, <span class="va">married</span>, <span class="va">college</span>, <span class="va">volunteering</span>, <span class="va">donating</span>, <span class="va">voting</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">results_to_test</span><span class="op">)</span></span>
<span><span class="co">## Rows: 1,300</span></span>
<span><span class="co">## Columns: 7</span></span>
<span><span class="co">## $ female       &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, TRUE, FALSE, FALSE, TRUE, FALSE, FALSE, FALSE, TRUE, TRUE, FALSE, FALSE, TRUE, FALSE, FALSE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, FALSE, FALSE, FALSE, TRUE, FALSE, FALSE, FALSE, TRUE, TRUE, FALSE, TRUE, FALSE, FALSE, TRUE, FALSE, TRUE, …</span></span>
<span><span class="co">## $ age          &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, TRUE, TRUE, FALSE, TRUE, TRUE, FALSE, FALSE, FALSE, FALSE, TRUE, FALSE, FALSE, FALSE, FALSE, TRUE, FALSE, TRUE, FALSE, TRUE, FALSE, FALSE, FALSE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, FALSE, FALSE, TRUE, TRUE, TRUE, TRUE, F…</span></span>
<span><span class="co">## $ married      &lt;lgl&gt; TRUE, FALSE, FALSE, FALSE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, FALSE, FALSE, FALSE, TRUE, TRUE, FALSE, TRUE, FALSE, FALSE, TRUE, FALSE, TRUE, FALSE, TRUE, FALSE, FALSE, FALSE, TRUE, FALSE, FALSE, FALSE, TRUE, TRUE, FALSE, FALSE, FALSE, TRUE, TRUE, TRUE, FALSE, TRU…</span></span>
<span><span class="co">## $ college      &lt;lgl&gt; TRUE, FALSE, TRUE, FALSE, TRUE, FALSE, FALSE, FALSE, FALSE, TRUE, TRUE, TRUE, FALSE, FALSE, TRUE, TRUE, FALSE, TRUE, FALSE, FALSE, FALSE, TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, TRUE, TRUE, FALSE, TRUE, TRUE, FALSE, FALSE, TRUE, FALSE, TRUE, TRUE, …</span></span>
<span><span class="co">## $ volunteering &lt;lgl&gt; TRUE, FALSE, TRUE, TRUE, FALSE, FALSE, TRUE, FALSE, TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, TRUE, FALSE, TRUE, TRUE, FALSE, TRUE, FALSE, TRUE, FALSE, FALSE, TRUE, TRUE, TRUE, FALSE, TRUE, FALSE, TRUE, FALSE, TRUE, FALSE, TRUE, FALSE, TRUE, TRUE, FALSE, TRUE, TRUE, FALSE, TR…</span></span>
<span><span class="co">## $ donating     &lt;lgl&gt; FALSE, FALSE, FALSE, TRUE, FALSE, TRUE, TRUE, FALSE, FALSE, FALSE, TRUE, FALSE, FALSE, FALSE, TRUE, FALSE, TRUE, TRUE, TRUE, FALSE, TRUE, FALSE, FALSE, FALSE, TRUE, FALSE, TRUE, TRUE, TRUE, FALSE, TRUE, FALSE, TRUE, FALSE, TRUE, FALSE, TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, …</span></span>
<span><span class="co">## $ voting       &lt;lgl&gt; TRUE, TRUE, TRUE, FALSE, TRUE, TRUE, TRUE, FALSE, FALSE, TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, FALSE, TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, TRUE…</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="testing-sample-vs.-population-proportions-frequentist-ly" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="testing-sample-vs.-population-proportions-frequentist-ly">Testing sample vs.&nbsp;population proportions frequentist-ly</h2>
<section id="one-sample-proportion-test-for-age" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="one-sample-proportion-test-for-age">One-sample proportion test for age</h3>
<p>As a quick and easy check, we can run a one-sample proportion test to see if the proportion of a variable is significantly different from a null value. We can do this with <code><a href="https://rdrr.io/r/stats/prop.test.html">prop.test()</a></code>, which works a bunch of different ways—with matrices, with vectors, and with single values (<a href="https://www.andrewheiss.com/blog/2023/05/15/fancy-bayes-diffs-props/index.html#classically">see this blog post</a> for some other examples of <code><a href="https://rdrr.io/r/stats/prop.test.html">prop.test()</a></code>).</p>
<p>Let’s look at age first. 50.77% of people in the sample are older than 36; 53% of people in the population are older than 36:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Proportion of sample older than 36</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">results_to_test</span><span class="op">$</span><span class="va">age</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.5077</span></span>
<span></span>
<span><span class="co"># CPS proportion older than 36</span></span>
<span><span class="va">national_values</span><span class="op">$</span><span class="va">age</span></span>
<span><span class="co">## [1] 0.5303</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Is that an issue? Is the sample significantly younger than the rest of the country?</p>
<p>For this one-sample test, we need to feed <code><a href="https://rdrr.io/r/stats/prop.test.html">prop.test()</a></code> three things: (1) the number of “successes”, or the count of rows where the respondent is older than 36 (or where <code>age</code> is <code>TRUE</code>), (2) the number of rows in the sample, and (3) the null value, or the population-level CPS proportion:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prop_test_freq_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prop.test.html">prop.test</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">results_to_test</span><span class="op">$</span><span class="va">age</span><span class="op">)</span>,  <span class="co"># Number of "successes" (rows where age == TRUE)</span></span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">results_to_test</span><span class="op">)</span>,     <span class="co"># Sample size</span></span>
<span>  p <span class="op">=</span> <span class="va">national_values</span><span class="op">$</span><span class="va">age</span>        <span class="co"># Population-level proportion from the CPS</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">tidy</span><span class="op">(</span><span class="va">prop_test_freq_age</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 8</span></span>
<span><span class="co">##   estimate statistic p.value parameter conf.low conf.high method                                               alternative</span></span>
<span><span class="co">##      &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;int&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;                                                &lt;chr&gt;      </span></span>
<span><span class="co">## 1    0.508      2.59   0.108         1    0.480     0.535 1-sample proportions test with continuity correction two.sided</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For fun, we can plot this too:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details class="code-fold"><summary>Code for making this plot ↓</summary><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prop_test_freq_age</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    prop_label <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span></span>
<span>      <span class="st">"Sample proportion\n{prop} [{low}, {high}]"</span>,</span>
<span>      prop <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span>,</span>
<span>      low <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span><span class="op">(</span><span class="va">conf.low</span><span class="op">)</span>,</span>
<span>      high <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span><span class="op">(</span><span class="va">conf.high</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">estimate</span>, y <span class="op">=</span> <span class="st">"Age"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span></span>
<span>    xintercept <span class="op">=</span> <span class="va">national_values</span><span class="op">$</span><span class="va">age</span>, color <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"label"</span>, x <span class="op">=</span> <span class="va">national_values</span><span class="op">$</span><span class="va">age</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">1.3</span><span class="op">)</span>, </span>
<span>    label <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span></span>
<span>      <span class="st">"CPS proportion\n{x}"</span>, </span>
<span>      x <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span><span class="op">(</span><span class="va">national_values</span><span class="op">$</span><span class="va">age</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">8</span>, size.unit <span class="op">=</span> <span class="st">"pt"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_pointrange</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">conf.low</span>, xmax <span class="op">=</span> <span class="va">conf.high</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_label</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">prop_label</span><span class="op">)</span>, nudge_y <span class="op">=</span> <span class="op">-</span><span class="fl">0.3</span>, size <span class="op">=</span> <span class="fl">8</span>, size.unit <span class="op">=</span> <span class="st">"pt"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Proportion older than 36"</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div id="fig-age-sample-prop-freq" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full"><div aria-describedby="fig-age-sample-prop-freq-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-age-sample-prop-freq-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-age-sample-prop-freq-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Proportion of survey respondents older than 36 compared to the national proportion
</figcaption></figure>
</div>
</div>
</div>
<p>Based on this, the 95% confidence interval for the proportion in the sample is 0.48–0.54, and the null/population value is 0.53, which fits safely in that confidence interval. The corresponding <em>p</em>-value is 0.108, which means that the sample proportion isn’t significantly different from the national proportion.</p>
<p>We can’t be certain that the sample doesn’t generally match the population, age-wise.</p>
<p>That’s a horribly convoluted sentence—welcome to the world of frequentist null hypothesis testing! Technically we can’t really say that the sample matches the population, and we can only say that we don’t know if it doesn’t match. Stay tuned for the Bayesian analysis section for a way to get an answer that we do care about. For now, as a kind of cheat-y shorthand, we can (semi-illegally) say that since the CPS proportion is in the sample confidence interval, there probably isn’t a significant difference between the two.</p>
</section><section id="one-sample-proportion-test-for-volunteering" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="one-sample-proportion-test-for-volunteering">One-sample proportion test for volunteering</h3>
<p>Let’s do another one: volunteering.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prop_test_freq_vol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prop.test.html">prop.test</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">results_to_test</span><span class="op">$</span><span class="va">volunteering</span><span class="op">)</span>,</span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">results_to_test</span><span class="op">)</span>,</span>
<span>  p <span class="op">=</span> <span class="va">national_values</span><span class="op">$</span><span class="va">volunteering</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">tidy</span><span class="op">(</span><span class="va">prop_test_freq_vol</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 8</span></span>
<span><span class="co">##   estimate statistic   p.value parameter conf.low conf.high method                                               alternative</span></span>
<span><span class="co">##      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;int&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;                                                &lt;chr&gt;      </span></span>
<span><span class="co">## 1    0.598      546. 8.79e-121         1    0.570     0.624 1-sample proportions test with continuity correction two.sided</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell page-columns page-full" data-layout-align="center">
<details class="code-fold"><summary>Code for making this plot ↓</summary><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prop_test_freq_vol</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    prop_label <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span></span>
<span>      <span class="st">"Sample proportion\n{prop} [{low}, {high}]"</span>,</span>
<span>      prop <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span>,</span>
<span>      low <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span><span class="op">(</span><span class="va">conf.low</span><span class="op">)</span>,</span>
<span>      high <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span><span class="op">(</span><span class="va">conf.high</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">estimate</span>, y <span class="op">=</span> <span class="st">"Volunteering"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span></span>
<span>    xintercept <span class="op">=</span> <span class="va">national_values</span><span class="op">$</span><span class="va">volunteering</span>, color <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"label"</span>, x <span class="op">=</span> <span class="va">national_values</span><span class="op">$</span><span class="va">volunteering</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">1.3</span><span class="op">)</span>, </span>
<span>    label <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span></span>
<span>      <span class="st">"CPS proportion\n{x}"</span>, </span>
<span>      x <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span><span class="op">(</span><span class="va">national_values</span><span class="op">$</span><span class="va">volunteering</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">8</span>, size.unit <span class="op">=</span> <span class="st">"pt"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_pointrange</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">conf.low</span>, xmax <span class="op">=</span> <span class="va">conf.high</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_label</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">prop_label</span><span class="op">)</span>, nudge_y <span class="op">=</span> <span class="op">-</span><span class="fl">0.3</span>, size <span class="op">=</span> <span class="fl">8</span>, size.unit <span class="op">=</span> <span class="st">"pt"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Proportion that volunteers regularly"</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">expand_limits</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.26</span>, <span class="fl">0.7</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div id="fig-age-sample-prop-vol" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full"><div aria-describedby="fig-age-sample-prop-vol-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-age-sample-prop-vol-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-age-sample-prop-vol-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Proportion of survey respondents that volunteer compared to the national proportion
</figcaption></figure>
</div>
</div>
</div>
<p>Phew, this one is <em>way</em> off. 30% of the general population has volunteered in the last year; 60% of the sample has volunteered. The sample proportion is most definitely significantly different from the general population, and we can reject the null hypothesis that it’s the same.</p>
<p>In this case, that’s fine. In our experiment, we only wanted to test our different treatments on people who donate to charity on at least an annual basis, so we screened out respondents who hadn’t donated in the past year. Volunteer behavior and donation behavior are closely correlated, so we have way more volunteers in our sample.</p>
</section><section id="proportion-tests-and-differences-for-everything-all-at-once" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="proportion-tests-and-differences-for-everything-all-at-once">Proportion tests and differences for everything all at once</h3>
<p>We can repeat this one-sample proportion test for all the different characteristics we care about. Instead of repeating the same code over and over, we’ll make a little wrapper function for it. We’ll also calculate the difference between the sample and population proportions:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary><code>prop_test_freq()</code> wrapper function</summary><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' Perform a basic one-sample proportion test</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param sample_column A numeric vector representing the sample data (0s and 1s).</span></span>
<span><span class="co">#' @param cps_prop A numeric value representing the proportion to compare against.</span></span>
<span><span class="co">#' @return A tibble containing the test results and the differences between the</span></span>
<span><span class="co">#'         sample estimate and the specified proportion.</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' sample_data &lt;- c(1, 0, 1, 1, 0, 1, 0, 1, 1, 0)</span></span>
<span><span class="co">#' cps_prop &lt;- 0.5</span></span>
<span><span class="co">#' prop_test_freq(sample_data, cps_prop)</span></span>
<span><span class="va">prop_test_freq</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sample_column</span>, <span class="va">cps_prop</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n_yes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">sample_column</span><span class="op">)</span></span>
<span>  <span class="va">n_total</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">sample_column</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">sample_prop_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prop.test.html">prop.test</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">n_yes</span>,</span>
<span>    n <span class="op">=</span> <span class="va">n_total</span>,</span>
<span>    p <span class="op">=</span> <span class="va">cps_prop</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">out_df</span> <span class="op">&lt;-</span> <span class="fu">tidy</span><span class="op">(</span><span class="va">sample_prop_test</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">mutate</span><span class="op">(</span></span>
<span>      diff <span class="op">=</span> <span class="va">estimate</span> <span class="op">-</span> <span class="va">cps_prop</span>,</span>
<span>      diff_low <span class="op">=</span> <span class="va">conf.low</span> <span class="op">-</span> <span class="va">cps_prop</span>,</span>
<span>      diff_high <span class="op">=</span> <span class="va">conf.high</span> <span class="op">-</span> <span class="va">cps_prop</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu">tibble</span><span class="op">(</span>test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">sample_prop_test</span><span class="op">)</span>, <span class="va">out_df</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We’ll then create a little summary dataset and plug each row of it into our new <code>prop_test_freq()</code> function with the magic of <code>purrr::map()</code>, which will store the results from the hypothesis test in a list column named <code>prop_test_results</code>, which we’ll finally unnest so that we can access the results as columns:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Create <code>sample_cps_props_freq</code> and use <code>prop_test_freq()</code> on each row</summary><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sample_cps_props_freq</span> <span class="op">&lt;-</span> <span class="fu">tribble</span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">category</span>, <span class="op">~</span><span class="va">variable</span>, <span class="op">~</span><span class="va">sample_value</span>, <span class="op">~</span><span class="va">national_value</span>,</span>
<span>  <span class="st">"Demographics"</span>, <span class="st">"Age (% 36+)"</span>, <span class="va">results_to_test</span><span class="op">$</span><span class="va">age</span>, <span class="va">national_values</span><span class="op">$</span><span class="va">age</span>,</span>
<span>  <span class="st">"Demographics"</span>, <span class="st">"Female (%)"</span>, <span class="va">results_to_test</span><span class="op">$</span><span class="va">female</span>, <span class="va">national_values</span><span class="op">$</span><span class="va">female</span>,</span>
<span>  <span class="st">"Demographics"</span>, <span class="st">"Married (%)"</span>, <span class="va">results_to_test</span><span class="op">$</span><span class="va">married</span>, <span class="va">national_values</span><span class="op">$</span><span class="va">married</span>,</span>
<span>  <span class="st">"Demographics"</span>, <span class="st">"Education (% BA+)"</span>, <span class="va">results_to_test</span><span class="op">$</span><span class="va">college</span>, <span class="va">national_values</span><span class="op">$</span><span class="va">college</span>,</span>
<span>  <span class="st">"Philanthropy"</span>, <span class="st">"Donated in past year (%)"</span>, <span class="va">results_to_test</span><span class="op">$</span><span class="va">donating</span>, <span class="va">national_values</span><span class="op">$</span><span class="va">donating</span>,</span>
<span>  <span class="st">"Philanthropy"</span>, <span class="st">"Volunteered in past year (%)"</span>, <span class="va">results_to_test</span><span class="op">$</span><span class="va">volunteering</span>, <span class="va">national_values</span><span class="op">$</span><span class="va">volunteering</span>,</span>
<span>  <span class="st">"Voting"</span>, <span class="st">"Voted in last November election (%)"</span>, <span class="va">results_to_test</span><span class="op">$</span><span class="va">voting</span>, <span class="va">national_values</span><span class="op">$</span><span class="va">voting</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>prop_test_results <span class="op">=</span> <span class="fu">pmap</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">sample_value</span>, <span class="va">national_value</span><span class="op">)</span>, \<span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="fu">prop_test_freq</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">unnest_wider</span><span class="op">(</span><span class="va">prop_test_results</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can use this new <code>sample_cps_props_freq</code> data frame for plotting:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details class="code-fold"><summary>Code for making this plot ↓</summary><div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sample_cps_props_freq</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">variable</span>, <span class="va">category</span><span class="op">)</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">fct_inorder</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">estimate</span>, y <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="va">variable</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># It would be nicer to use geom_segment() to add vertical lines here, but it </span></span>
<span>  <span class="co"># doesn't play nicely with categorical y-axis breaks, so we can cheat and use </span></span>
<span>  <span class="co"># geom_point() instead with `shape = "|"` to use the | character</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">national_value</span>, color <span class="op">=</span> <span class="st">"CPS proportion"</span><span class="op">)</span>, shape <span class="op">=</span> <span class="st">"|"</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_pointrange</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">conf.low</span>, xmax <span class="op">=</span> <span class="va">conf.high</span>, color <span class="op">=</span> <span class="st">"Sample proportion"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_discrete</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_wrap</span><span class="op">(</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"CPS proportion"</span> <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="st">"Sample proportion"</span> <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_col</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">category</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>, space <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Average proportion"</span>, y <span class="op">=</span> <span class="cn">NULL</span>, color <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div id="fig-prop-test-freq-props" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full"><div aria-describedby="fig-prop-test-freq-props-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-prop-test-freq-props-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-prop-test-freq-props-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Respondent demographic proportions compared to national proportions
</figcaption></figure>
</div>
</div>
</div>
<p>That looks super neat and it’s helpful to visualize all these differences. In general, the sample looks like the population in terms of age, gender, marital status, and education, but the sample is way more socially and civically oriented than the rest of the country (again, by design).</p>
<p>The only issue with this plot is that it’s a little hard to read with the CPS proportion moving around in each variable. We can center it at 0 and look at differences from the CPS proportion:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details class="code-fold"><summary>Code for making this plot ↓</summary><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sample_cps_props_freq</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">variable</span>, <span class="va">category</span><span class="op">)</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">fct_inorder</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">diff</span>, y <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="va">variable</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, color <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_pointrange</span><span class="op">(</span></span>
<span>    <span class="fu">aes</span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">diff_low</span>, xmax <span class="op">=</span> <span class="va">diff_high</span>, color <span class="op">=</span> <span class="st">"Sample proportion − CPS proportion"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">label_pp</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_discrete</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_wrap</span><span class="op">(</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sample proportion − CPS proportion"</span> <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_col</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">category</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>, space <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Difference in proportion from CPS"</span>, y <span class="op">=</span> <span class="cn">NULL</span>, color <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div id="fig-prop-test-freq-diffs" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full"><div aria-describedby="fig-prop-test-freq-diffs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-prop-test-freq-diffs-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-prop-test-freq-diffs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Differences between demographic proportions and national proportions
</figcaption></figure>
</div>
</div>
</div>
<p>And we can also use <code>sample_cps_props_freq</code> to make a pretty table. Here’s a table with <a href="https://vincentarelbundock.github.io/tinytable/">{tinytable}</a> (though you could do this with any of R’s tablemaking packages, like <a href="https://gt.rstudio.com/">{gt}</a> or <a href="https://haozhu233.github.io/kableExtra/">{kableExtra}</a> or whatever)</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details class="code-fold"><summary>Code for making this table ↓</summary><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">notes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"*"</span> <span class="op">=</span> <span class="st">"Sample proportion significantly different from CPS (p &lt; 0.05)"</span>,</span>
<span>  <span class="st">"a"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, j <span class="op">=</span> <span class="fl">1</span>, text <span class="op">=</span> <span class="st">"Annual Social and Economic Supplement (ASEC) of the Current Population Survey (CPS), March 2019"</span><span class="op">)</span>,</span>
<span>  <span class="st">"b"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">6</span>, j <span class="op">=</span> <span class="fl">1</span>, text <span class="op">=</span> <span class="st">"Monthly CPS, September 2019"</span><span class="op">)</span>,</span>
<span>  <span class="st">"c"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fl">7</span>, j <span class="op">=</span> <span class="fl">1</span>, text <span class="op">=</span> <span class="st">"Monthly CPS, November 2018"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sample_cps_props_freq</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>significant <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">p.value</span> <span class="op">&lt;</span> <span class="fl">0.05</span>, <span class="st">"*"</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>sample_nice <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span></span>
<span>    <span class="st">"{estimate}{significant}&lt;br&gt;[{conf.low}, {conf.high}]"</span>,</span>
<span>    estimate <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span>,</span>
<span>    conf.low <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">(</span><span class="va">conf.low</span><span class="op">)</span>,</span>
<span>    conf.high <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">(</span><span class="va">conf.high</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>diff_nice <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span></span>
<span>    <span class="st">"{diff}{significant}&lt;br&gt;[{diff_low}, {diff_high}]"</span>,</span>
<span>    diff <span class="op">=</span> <span class="fu">label_pp_01</span><span class="op">(</span><span class="va">diff</span><span class="op">)</span>,</span>
<span>    diff_low <span class="op">=</span> <span class="fu">label_number</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.1</span>, scale <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">(</span><span class="va">diff_low</span><span class="op">)</span>,</span>
<span>    diff_high <span class="op">=</span> <span class="fu">label_number</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.1</span>, scale <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">(</span><span class="va">diff_high</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span></span>
<span>    Variable <span class="op">=</span> <span class="va">variable</span>, </span>
<span>    National <span class="op">=</span> <span class="va">national_value</span>, </span>
<span>    Sample <span class="op">=</span> <span class="va">sample_nice</span>,</span>
<span>    `∆` <span class="op">=</span> <span class="va">diff_nice</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tt</span><span class="op">(</span>width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span><span class="op">)</span>, notes <span class="op">=</span> <span class="va">notes</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">group_tt</span><span class="op">(</span>i <span class="op">=</span> <span class="va">sample_cps_props_freq</span><span class="op">$</span><span class="va">category</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">format_tt</span><span class="op">(</span>j <span class="op">=</span> <span class="fl">2</span>, fn <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">style_tt</span><span class="op">(</span>i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">9</span><span class="op">)</span>, bold <span class="op">=</span> <span class="cn">TRUE</span>, background <span class="op">=</span> <span class="st">"#e6e6e6"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">style_tt</span><span class="op">(</span></span>
<span>    bootstrap_class <span class="op">=</span> <span class="st">"table"</span>,</span>
<span>    bootstrap_css_rule <span class="op">=</span> <span class="st">".table tfoot { text-align: left; } .table { font-size: 0.85rem; }"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">style_tt</span><span class="op">(</span>j <span class="op">=</span> <span class="fl">1</span>, align <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">style_tt</span><span class="op">(</span>j <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>, align <span class="op">=</span> <span class="st">"c"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-prop-test-freq" class="cell quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure page-columns page-full"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-prop-test-freq-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Sample characteristics compared to nationally representative Current Population Survey (CPS) estimates
</figcaption><div aria-describedby="tbl-prop-test-freq-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="cell-output-display column-body-outset-right">
<!-- preamble start -->

    <script>

      function styleCell_ld6qh6salal4ubr4rmdj(i, j, css_id) {
          var table = document.getElementById("tinytable_ld6qh6salal4ubr4rmdj");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow_66yl1bwz5sa262mezhrr(i, colspan, content) {
        var table = document.getElementById('tinytable_ld6qh6salal4ubr4rmdj');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_ld6qh6salal4ubr4rmdj(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_ld6qh6salal4ubr4rmdj");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
window.addEventListener('load', function () { insertSpanRow_66yl1bwz5sa262mezhrr(7, 4, 'Voting') });
window.addEventListener('load', function () { insertSpanRow_66yl1bwz5sa262mezhrr(5, 4, 'Philanthropy') });
window.addEventListener('load', function () { insertSpanRow_66yl1bwz5sa262mezhrr(1, 4, 'Demographics') });
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 10, j: 2 },  ], css_id: 'tinytable_css_w8r5j06dldozutkr0oib',}, 
          { positions: [ { i: 1, j: 0 }, { i: 6, j: 0 }, { i: 9, j: 0 },  ], css_id: 'tinytable_css_s37bt60jk7x1i3wdrl8l',}, 
          { positions: [ { i: 6, j: 3 }, { i: 1, j: 1 }, { i: 6, j: 1 }, { i: 9, j: 3 }, { i: 1, j: 3 }, { i: 9, j: 1 },  ], css_id: 'tinytable_css_ph8hne8x40wi8lva29qf',}, 
          { positions: [ { i: 0, j: 0 },  ], css_id: 'tinytable_css_ov1w4cbja1z30ech1y7p',}, 
          { positions: [ { i: 3, j: 1 }, { i: 4, j: 1 }, { i: 7, j: 1 }, { i: 8, j: 1 }, { i: 2, j: 3 }, { i: 3, j: 3 }, { i: 4, j: 3 }, { i: 2, j: 1 }, { i: 7, j: 3 }, { i: 8, j: 3 }, { i: 5, j: 3 }, { i: 5, j: 1 },  ], css_id: 'tinytable_css_lnwhtekyfgwdhc3p8bc4',}, 
          { positions: [ { i: 10, j: 3 }, { i: 10, j: 1 },  ], css_id: 'tinytable_css_jlzq19oodbfh1n09fepz',}, 
          { positions: [ { i: 10, j: 0 },  ], css_id: 'tinytable_css_cyjkn1lwjswb6oakr1mk',}, 
          { positions: [ { i: 3, j: 0 }, { i: 4, j: 0 }, { i: 2, j: 0 }, { i: 7, j: 0 }, { i: 8, j: 0 }, { i: 5, j: 0 },  ], css_id: 'tinytable_css_9w0xuixan42vkjya2u15',}, 
          { positions: [ { i: 0, j: 2 },  ], css_id: 'tinytable_css_93a8bxxxps4v26q6ixky',}, 
          { positions: [ { i: 1, j: 2 }, { i: 9, j: 2 }, { i: 6, j: 2 },  ], css_id: 'tinytable_css_296h63pemb3gbg1ddr2y',}, 
          { positions: [ { i: 0, j: 1 }, { i: 0, j: 3 },  ], css_id: 'tinytable_css_1iw7xz5nv8i699p9bnmx',}, 
          { positions: [ { i: 5, j: 2 }, { i: 3, j: 2 }, { i: 4, j: 2 }, { i: 2, j: 2 }, { i: 7, j: 2 }, { i: 8, j: 2 },  ], css_id: 'tinytable_css_1bln1l6w4n205be5mtd6',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_ld6qh6salal4ubr4rmdj(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script><style>
      /* tinytable css entries after */
      .table td.tinytable_css_w8r5j06dldozutkr0oib, .table th.tinytable_css_w8r5j06dldozutkr0oib { text-align: center; border-bottom: solid #d3d8dc 0.1em; width: 30%; }
      .table td.tinytable_css_s37bt60jk7x1i3wdrl8l, .table th.tinytable_css_s37bt60jk7x1i3wdrl8l { font-weight: bold; background-color: #e6e6e6; text-align: left; width: 30%; }
      .table td.tinytable_css_ph8hne8x40wi8lva29qf, .table th.tinytable_css_ph8hne8x40wi8lva29qf { font-weight: bold; background-color: #e6e6e6; text-align: center; width: 20%; }
      .table td.tinytable_css_ov1w4cbja1z30ech1y7p, .table th.tinytable_css_ov1w4cbja1z30ech1y7p { text-align: left; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; width: 30%; }
      .table td.tinytable_css_lnwhtekyfgwdhc3p8bc4, .table th.tinytable_css_lnwhtekyfgwdhc3p8bc4 { text-align: center; width: 20%; }
      .table td.tinytable_css_jlzq19oodbfh1n09fepz, .table th.tinytable_css_jlzq19oodbfh1n09fepz { text-align: center; border-bottom: solid #d3d8dc 0.1em; width: 20%; }
      .table td.tinytable_css_cyjkn1lwjswb6oakr1mk, .table th.tinytable_css_cyjkn1lwjswb6oakr1mk { padding-left: 1em; text-align: left; border-bottom: solid #d3d8dc 0.1em; width: 30%; }
      .table td.tinytable_css_9w0xuixan42vkjya2u15, .table th.tinytable_css_9w0xuixan42vkjya2u15 { padding-left: 1em; text-align: left; width: 30%; }
      .table td.tinytable_css_93a8bxxxps4v26q6ixky, .table th.tinytable_css_93a8bxxxps4v26q6ixky { text-align: center; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; width: 30%; }
      .table td.tinytable_css_296h63pemb3gbg1ddr2y, .table th.tinytable_css_296h63pemb3gbg1ddr2y { font-weight: bold; background-color: #e6e6e6; text-align: center; width: 30%; }
      .table td.tinytable_css_1iw7xz5nv8i699p9bnmx, .table th.tinytable_css_1iw7xz5nv8i699p9bnmx { text-align: center; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; width: 20%; }
      .table td.tinytable_css_1bln1l6w4n205be5mtd6, .table th.tinytable_css_1bln1l6w4n205be5mtd6 { text-align: center; width: 30%; }
.table tfoot { text-align: left; } .table { font-size: 0.85rem; }
    </style>
<div class="container">
      <table class="table" id="tinytable_ld6qh6salal4ubr4rmdj" style="table-layout: fixed; width: 100% !important; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
<thead><tr>
<th scope="col">Variable</th>
                <th scope="col">National</th>
                <th scope="col">Sample</th>
                <th scope="col">∆</th>
              </tr></thead>
<tfoot>
<tr><td colspan="4">
<sup>*</sup> Sample proportion significantly different from CPS (p &lt; 0.05)</td></tr>
<tr><td colspan="4">
<sup>a</sup> Annual Social and Economic Supplement (ASEC) of the Current Population Survey (CPS), March 2019</td></tr>
<tr><td colspan="4">
<sup>b</sup> Monthly CPS, September 2019</td></tr>
<tr><td colspan="4">
<sup>c</sup> Monthly CPS, November 2018</td></tr>
</tfoot>
<tbody>
<tr>
<td>Age (% 36+)<sup>a</sup>
</td>
                  <td>53.0%</td>
                  <td>50.8%<br>[48.0%, 53.5%]</td>
                  <td>−2.3 pp.<br>[-5.0, 0.5]</td>
                </tr>
<tr>
<td>Female (%)<sup>a</sup>
</td>
                  <td>51.0%</td>
                  <td>47.2%*<br>[44.4%, 49.9%]</td>
                  <td>−3.8 pp.*<br>[-6.6, -1.1]</td>
                </tr>
<tr>
<td>Married (%)<sup>a</sup>
</td>
                  <td>41.0%</td>
                  <td>40.6%<br>[37.9%, 43.3%]</td>
                  <td>−0.4 pp.<br>[-3.1, 2.3]</td>
                </tr>
<tr>
<td>Education (% BA+)<sup>a</sup>
</td>
                  <td>25.8%</td>
                  <td>28.5%*<br>[26.1%, 31.1%]</td>
                  <td>2.8 pp.*<br>[0.4, 5.3]</td>
                </tr>
<tr>
<td>Donated in past year (%)<sup>b</sup>
</td>
                  <td>47.4%</td>
                  <td>56.9%*<br>[54.2%, 59.6%]</td>
                  <td>9.5 pp.*<br>[6.8, 12.2]</td>
                </tr>
<tr>
<td>Volunteered in past year (%)<sup>b</sup>
</td>
                  <td>30.0%</td>
                  <td>59.8%*<br>[57.0%, 62.4%]</td>
                  <td>29.7 pp.*<br>[27.0, 32.4]</td>
                </tr>
<tr>
<td>Voted in last November election (%)<sup>c</sup>
</td>
                  <td>53.4%</td>
                  <td>71.5%*<br>[69.0%, 74.0%]</td>
                  <td>18.1 pp.*<br>[15.5, 20.5]</td>
                </tr>
</tbody>
</table>
</div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
</figure>
</div>
</div>
</section></section><section id="testing-sample-vs.-population-proportions-bayesian-ly" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="testing-sample-vs.-population-proportions-bayesian-ly">Testing sample vs.&nbsp;population proportions Bayesian-ly</h2>
<section id="ew-null-hypothesis-significance-testing" class="level3"><h3 class="anchored" data-anchor-id="ew-null-hypothesis-significance-testing">ew null hypothesis significance testing</h3>
<p>That’s all well and good, but I’m actually not 100% sure if that’s the right proportion test to use. <a href="https://www.andrewheiss.com/blog/2023/05/15/fancy-bayes-diffs-props/index.html#classically">As I mention here</a>, every classical statistical test has a bunch of “flavors” for different situations and assumptions (e.g., do the two samples have equal or unequal variances? do we need to correct the sample size? make a continuity correction? is it tuesday?). There are <a href="https://www.google.com/search?q=statistical+test+flow+chart">all sorts of flowcharts</a> you can follow to choose the right version.</p>
<p>Technically, the results from all those one-sample proportion tests above tell us the answer to this question:</p>
<blockquote class="blockquote">
<p>In a hypothetical world where the difference between the sample and population proportions is 0 (or where the sample proportion is equal to the population proportion), what’s the probability that this one-time collection of data fits in that world—and if the probability is low, is there enough evidence (i.e.&nbsp;is the probability less than 0.05?) to confidently reject that hypothetical world of no difference?</p>
</blockquote>
<p>That’s a mouthful and it’s a weird question. With age, there’s a 2.3 percentage point difference between the sample and the national proportions, with a <em>p</em>-value of 0.108. This means that there’s a 10.8% chance of seeing a 2.3 percentage point difference in a world where the difference is actually 0. That’s less than 5%, so we cannot confidently declare that there’s not <em>not</em> a difference. Or in other words, we can’t reject the possibility that we’re in the hypothetical null world.</p>
<p>As a kind of shorthand, we then handwavily concluded that the sample and population proportions are probably about the same, but technically that’s wrong. All we really concluded is that we don’t have enough evidence that the hypothetical world of no difference is wrong. It could be right; it could be wrong. Who knows.</p>
<p>With volunteering, there’s a 29.7 percentage point difference between the sample and the national proportions, with a tiny tiny <em>p</em>-value of 8.79&nbsp;×&nbsp;10<sup>−121</sup>. This means that there’s basicaly a 0% chance that we’d see that 29.7 percentage point difference in a world where the difference is actually 0. That makes it statistically significant—we have enough evidence to safely declare that we’re not in the hypothetical null world.</p>
<p>I really really don’t like this logic of null hypothesis testing. It doesn’t really answer the question we want to know. Here’s what we’re really actually interested in:</p>
<blockquote class="blockquote">
<p>Given this data, what’s the probability that there’s no difference between the sample and population proportions?</p>
</blockquote>
<p>We can answer this question with Bayesian statistics and avoid all this null hypothesis stuff. And as an added bonus, we don’t need to think about which flavor of which context-specific statistical test we need to use. We can instead model the data-generating process more directly and then work with the simulated posterior distribution of that process.</p>
</section><section id="modeling-proportions-with-a-binomial-distribution" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="modeling-proportions-with-a-binomial-distribution">Modeling proportions with a binomial distribution</h3>
<p>The actual process for generating the age column (and all the other variables in the sample) involved asking each survey respondent their age. If someone is older than 36, it’s counted as a “success”; if they are younger than 36, it’s not a success. It’s a binary choice<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> that is repeated across hundreds of other respondents (or “trials”). There’s some underlying probability for being older than 36 that corresponds to the proportion of people that select that answer.</p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;Kind of—technically they selected their actual age, but we can pretend that it was just a binary choice.</p></div></div><p>This data-generating process involves a bunch of independent trials (or respondents) with some probability of success (or being older than 36), which makes it a <a href="https://en.wikipedia.org/wiki/Binomial_distribution">binomial distribution</a>.</p>
<p>Formally, it has three parameters:</p>
<p><span class="math display">\[
y \sim \operatorname{Binomial}(n, \pi)
\]</span></p>
<ol type="1">
<li>
<span class="math inline">\(y\)</span>, or the number of successes (the number of people older than 36)</li>
<li>
<span class="math inline">\(n\)</span>, or the number of trials (the total number of respondents)</li>
<li>
<span class="math inline">\(\pi\)</span>, or the probability of success (the probability that someone is older than 36)</li>
</ol>
<p>We know <span class="math inline">\(y\)</span> and <span class="math inline">\(n\)</span> from our data:</p>
<ul>
<li>
<span class="math inline">\(y\)</span> = <code>sum(results_to_test$age)</code> = 660</li>
<li>
<span class="math inline">\(n\)</span> = <code>nrow(results_to_test)</code> = 1300</li>
</ul>
<p>We want to find out <span class="math inline">\(\pi\)</span> so we can find the difference between <span class="math inline">\(\pi\)</span> and the population proportion to see if it’s 0 or not.</p>
<p>We can estimate <span class="math inline">\(\pi\)</span> with a Bayesian beta-binomial regression model using {brms}. We’ll use a vague Beta(1, 1) prior, which is 50% with a wide range—<a href="https://www.andrewheiss.com/blog/2023/05/15/fancy-bayes-diffs-props/#formal-model">see here for more about Beta distributions and priors</a>. Note that this is an intercept-only model with no other covariates. That’s because we just want to know the underlying proportion of age—we’re not conditioning that proportion on anything else.</p>
<p><span class="math display">\[
\begin{aligned}
y_{(n \text{ age &gt; 36})} \sim&amp;\ \operatorname{Binomial}(n_{\text{Total respondents}}, \pi_{\text{age &gt; 36}}) \\
\pi_{\text{age &gt; 36}} =&amp;\ \beta_0 \\[10pt]
\beta_0 =&amp;\ \operatorname{Beta}(1, 1)
\end{aligned}
\]</span></p>
<p>{brms} likes working with data frames, so we’ll put our <span class="math inline">\(y\)</span> and <span class="math inline">\(n\)</span> into a little one-row dataset and then use <code>brm()</code> to fit a model:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">age_binomial_df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>  n_yes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">results_to_test</span><span class="op">$</span><span class="va">age</span><span class="op">)</span>,</span>
<span>  n_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">results_to_test</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># lol tiny data</span></span>
<span><span class="va">age_binomial_df</span></span>
<span><span class="co">## # A tibble: 1 × 2</span></span>
<span><span class="co">##   n_yes n_total</span></span>
<span><span class="co">##   &lt;int&gt;   &lt;int&gt;</span></span>
<span><span class="co">## 1   660    1300</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_age_binomial</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span></span>
<span>  <span class="fu">bf</span><span class="op">(</span><span class="va">n_yes</span> <span class="op">|</span> <span class="fu">trials</span><span class="op">(</span><span class="va">n_total</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">age_binomial_df</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span>,</span>
<span>  prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">prior</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Special.html">beta</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"Intercept"</span>, lb <span class="op">=</span> <span class="fl">0</span>, ub <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="va">CHAINS</span>, warmup <span class="op">=</span> <span class="va">WARMUP</span>, iter <span class="op">=</span> <span class="va">ITER</span>, seed <span class="op">=</span> <span class="va">BAYES_SEED</span>,</span>
<span>  refresh <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"models/model_age_binomial"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="working-with-the-posterior" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="working-with-the-posterior">Working with the posterior</h3>
<p>Since this is just a regression model, it behaves like any normal {brms} model. The coefficient for the intercept represents the estimated proportion of people older than 36 in the sample:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model_age_binomial</span><span class="op">)</span></span>
<span><span class="co">##  Family: binomial </span></span>
<span><span class="co">##   Links: mu = identity </span></span>
<span><span class="co">## Formula: n_yes | trials(n_total) ~ 1 </span></span>
<span><span class="co">##    Data: age_binomial_df (Number of observations: 1) </span></span>
<span><span class="co">##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;</span></span>
<span><span class="co">##          total post-warmup draws = 4000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Regression Coefficients:</span></span>
<span><span class="co">##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">## Intercept     0.51      0.01     0.48     0.54 1.00     1537     1828</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span></span>
<span><span class="co">## and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">## scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since we’re in The Land of Bayes, we can work with the full posterior and calculate estimands directly, like the posterior difference between the sample proportion and the national proportion:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">age_draws</span> <span class="op">&lt;-</span> <span class="va">model_age_binomial</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">spread_draws</span><span class="op">(</span><span class="va">b_Intercept</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>diff <span class="op">=</span> <span class="va">b_Intercept</span> <span class="op">-</span> <span class="va">national_values</span><span class="op">$</span><span class="va">age</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And we can plot these estimands:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">age_draws</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">b_Intercept</span>, y <span class="op">=</span> <span class="st">"Age (% 36+)"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">national_values</span><span class="op">$</span><span class="va">age</span>, color <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Proportion older than 36"</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">age_draws</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">diff</span>, y <span class="op">=</span> <span class="st">"Age (% 36+)"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">label_pp</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Difference from CPS"</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">/</span> <span class="va">p2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div id="fig-age-posterior-only" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full"><div aria-describedby="fig-age-posterior-only-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-age-posterior-only-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-age-posterior-only-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Posterior proportion of survey respondents older than 36 compared to the national proportion, and posterior differences between sample and national proportions (like <a href="#fig-age-sample-prop-freq" class="quarto-xref">Figure&nbsp;1</a>, but Bayesian)
</figcaption></figure>
</div>
</div>
</div>
<p>The population value is in the sample posterior, which means that the posterior difference between the sample and population includes 0, but that doesn’t tell us much about how likely that is. We could calculate the probability that the difference isn’t equal to 0, but that’s relatively useless—zero is a single point, and the probability that the posterior is different from that one point is infinite.</p>
</section><section id="the-region-of-practical-equivalence-rope" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="the-region-of-practical-equivalence-rope">The region of practical equivalence (ROPE)</h3>
<p>Another approach is to think of a range of values around 0 that all have “practically no effect.” I like to think of this as a sort of “dead zone.” If the difference between the sample and the population is 0, we can safely conclude that there’s no difference between the two. If the measured difference were 0.3 percentage points, or −0.6 percentage points, or even 2 percentage points, I’d still feel pretty confident that that’s basically the same. Bayesians call this the <a href="https://easystats.github.io/bayestestR/articles/region_of_practical_equivalence.html">region of practical equivalence</a>, or ROPE <span class="citation" data-cites="Kruschke:2010a Kruschke:2015 KruschkeAguinisJoo:2012 KruschkeLiddell:2018">(<a href="#ref-Kruschke:2010a" role="doc-biblioref">Kruschke 2010</a>, <a href="#ref-Kruschke:2015" role="doc-biblioref">2015</a>; <a href="#ref-KruschkeAguinisJoo:2012" role="doc-biblioref">Kruschke, Aguinis, and Joo 2012</a>; <a href="#ref-KruschkeLiddell:2018" role="doc-biblioref">Kruschke and Liddell 2018</a>)</span>.</p>
<p>There are lots of ways to define this ROPE or dead zone. You can base it on experience with the phenomenon, or you can base it on data that you have. <span class="citation" data-cites="KruschkeLiddell:2018">Kruschke and Liddell (<a href="#ref-KruschkeLiddell:2018" role="doc-biblioref">2018</a>)</span> suggest looking at a tenth of the variable’s standard deviation above and below the main null value, or</p>
<p><span class="math display">\[
[-0.1 \times SD_y, 0.1 \times SD_y]
\]</span></p>
<p>To illustrate, let’s find the ROPE for the proportion of people older than 36 with ±0.1 × standard deviation:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">age_rope</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>  avg_age <span class="op">=</span> <span class="va">national_values</span><span class="op">$</span><span class="va">age</span>,</span>
<span>  sd_age <span class="op">=</span> <span class="va">national_values</span><span class="op">$</span><span class="va">age_sd</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    rope_low <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span> <span class="op">*</span> <span class="va">sd_age</span>,</span>
<span>    rope_avg_low <span class="op">=</span> <span class="va">avg_age</span> <span class="op">+</span> <span class="va">rope_low</span>,</span>
<span>    rope_high <span class="op">=</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="va">sd_age</span>,</span>
<span>    rope_avg_high <span class="op">=</span> <span class="va">avg_age</span> <span class="op">+</span> <span class="va">rope_high</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">age_rope</span></span>
<span><span class="co">## # A tibble: 1 × 6</span></span>
<span><span class="co">##   avg_age sd_age rope_low rope_avg_low rope_high rope_avg_high</span></span>
<span><span class="co">##     &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;</span></span>
<span><span class="co">## 1   0.530  0.499  -0.0499        0.480    0.0499         0.580</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Following this rule, we shouldn’t care about sample/population differences between ±4.99 percentage points. For all intents and purposes, any differences in that range—or any sample proportions between 53% ± 4.99 (or 48%–58%)—are equivalent.</p>
<p>Here’s what the ROPE for age looks like, both for the full proportion and for the difference:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">age_draws</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">b_Intercept</span>, y <span class="op">=</span> <span class="st">"Age (% 36+)"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"rect"</span>, </span>
<span>    xmin <span class="op">=</span> <span class="va">age_rope</span><span class="op">$</span><span class="va">rope_avg_low</span>, </span>
<span>    xmax <span class="op">=</span> <span class="va">age_rope</span><span class="op">$</span><span class="va">rope_avg_high</span>, </span>
<span>    ymin <span class="op">=</span> <span class="fl">1</span>, ymax <span class="op">=</span> <span class="cn">Inf</span>, </span>
<span>    fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, alpha <span class="op">=</span> <span class="fl">0.2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">age_rope</span><span class="op">$</span><span class="va">avg_age</span>, color <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Proportion older than 36"</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">age_draws</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">diff</span>, y <span class="op">=</span> <span class="st">"Age (% 36+)"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"rect"</span>, </span>
<span>    xmin <span class="op">=</span> <span class="va">age_rope</span><span class="op">$</span><span class="va">rope_low</span>, </span>
<span>    xmax <span class="op">=</span> <span class="va">age_rope</span><span class="op">$</span><span class="va">rope_high</span>, </span>
<span>    ymin <span class="op">=</span> <span class="fl">1</span>, ymax <span class="op">=</span> <span class="cn">Inf</span>, </span>
<span>    fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, alpha <span class="op">=</span> <span class="fl">0.2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">label_pp</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Difference from CPS"</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">/</span> <span class="va">p2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div id="fig-age-rope" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full"><div aria-describedby="fig-age-rope-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-age-rope-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-age-rope-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Posterior proportion of survey respondents older than 36 compared to the national proportion, and posterior differences between sample and national proportions, overlaid on a region of practical equivalence (ROPE)
</figcaption></figure>
</div>
</div>
</div>
<p>A huge chunk of that posterior distribution is inside the ROPE dead zone. We can calculate the exact proportion:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prop_in_rope</span> <span class="op">&lt;-</span> <span class="va">age_draws</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    is_below_rope <span class="op">=</span> <span class="va">diff</span> <span class="op">&lt;</span> <span class="va">age_rope</span><span class="op">$</span><span class="va">rope_low</span>,</span>
<span>    is_above_rope <span class="op">=</span> <span class="va">diff</span> <span class="op">&gt;</span> <span class="va">age_rope</span><span class="op">$</span><span class="va">rope_high</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span>is_inside_rope <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">is_below_rope</span> <span class="op">|</span> <span class="va">is_above_rope</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">prop_in_rope</span><span class="op">$</span><span class="va">is_inside_rope</span></span>
<span><span class="co">## [1] 0.9762</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>97.6% of the posterior is inside the ROPE, which means that there’s a 97.6% probability that the sample matches the population.</p>
<p>That’s <em>way</em> cooler and <em>way</em> more interpretable than null hypothesis testing.</p>
<hr class="dinkus">
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
BONUS: Faster, more automatic ROPE calculations
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We just went through a lot of work ↑ up there to calculate the bounds of the ROPE and then find how much of the posterior is in it.</p>
<p>There’s a faster and easier way! The {bayestestR} package has a <code>rope()</code> function that can do it automatically.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_age_binomial</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">bayestestR</span><span class="fu">::</span><span class="fu">rope</span><span class="op">(</span>ci <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">## # Proportion of samples inside the ROPE [-45.25, 45.25]:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parameter | inside ROPE</span></span>
<span><span class="co">## -----------------------</span></span>
<span><span class="co">## Intercept |    100.00 %</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It doesn’t give exactly the same result as before because the automatic ROPE limits (<code>range</code> here) aren’t based on the weighted standard deviation, but we can define that range ourselves:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_age_binomial</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">bayestestR</span><span class="fu">::</span><span class="fu">rope</span><span class="op">(</span></span>
<span>    ci <span class="op">=</span> <span class="fl">1</span>, </span>
<span>    range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">age_rope</span><span class="op">$</span><span class="va">rope_avg_low</span>, <span class="va">age_rope</span><span class="op">$</span><span class="va">rope_avg_high</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">## # Proportion of samples inside the ROPE [0.48, 0.58]:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parameter | inside ROPE</span></span>
<span><span class="co">## -----------------------</span></span>
<span><span class="co">## Intercept |     97.62 %</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>bayestestR::rope()</code> is incorporated in the {parameters} package too, so you can do this:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_age_binomial</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">parameters</span><span class="fu">::</span><span class="fu">model_parameters</span><span class="op">(</span></span>
<span>    test <span class="op">=</span> <span class="st">"rope"</span>,</span>
<span>    rope_ci <span class="op">=</span> <span class="fl">1</span>, </span>
<span>    rope_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">age_rope</span><span class="op">$</span><span class="va">rope_avg_low</span>, <span class="va">age_rope</span><span class="op">$</span><span class="va">rope_avg_high</span><span class="op">)</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">## # Fixed Effects</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parameter   | Median |       95% CI | % in ROPE |  Rhat |     ESS</span></span>
<span><span class="co">## -----------------------------------------------------------------</span></span>
<span><span class="co">## (Intercept) |   0.51 | [0.48, 0.54] |    97.62% | 1.001 | 1528.00</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
BONUS: How much of the posterior should we count?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><a href="https://easystats.github.io/bayestestR/articles/region_of_practical_equivalence.html#credible-interval-in-rope-vs-full-posterior-in-rope">There are big debates in the ROPE world</a> about how much of the posterior we should look at when working with ROPEs. We just looked at the 100% of the sample posterior. Some people <span class="citation" data-cites="Kruschke:2015 McElreath:2020">(<a href="#ref-Kruschke:2015" role="doc-biblioref">Kruschke 2015</a>; <a href="#ref-McElreath:2020" role="doc-biblioref">McElreath 2020</a>)</span> say to look instead at how much of the 95% (or 89%) highest density interval (HDI) falls within the ROPE.</p>
<p>I have no strong preferences either way, and it’s fairly straightforward to calculate the proportion of the HDI in the ROPE. Here’s an example with a Richard McElreath-style 89% HDI:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Find the 89% HDI</span></span>
<span><span class="va">age_hdi</span> <span class="op">&lt;-</span> <span class="va">age_draws</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">median_hdi</span><span class="op">(</span><span class="va">diff</span>, .width <span class="op">=</span> <span class="fl">0.89</span><span class="op">)</span></span>
<span><span class="va">age_hdi</span></span>
<span><span class="co">## # A tibble: 1 × 6</span></span>
<span><span class="co">##      diff  .lower   .upper .width .point .interval</span></span>
<span><span class="co">##     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    </span></span>
<span><span class="co">## 1 -0.0227 -0.0450 -0.00108   0.89 median hdi</span></span>
<span></span>
<span><span class="co"># Find how much of the the age HDI is in the ROPE</span></span>
<span><span class="va">age_draws</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">diff</span> <span class="op">&gt;=</span> <span class="va">age_hdi</span><span class="op">$</span><span class="va">.lower</span> <span class="op">&amp;</span> <span class="va">diff</span> <span class="op">&lt;=</span> <span class="va">age_hdi</span><span class="op">$</span><span class="va">.upper</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    is_below_rope <span class="op">=</span> <span class="va">diff</span> <span class="op">&lt;</span> <span class="va">age_rope</span><span class="op">$</span><span class="va">rope_low</span>,</span>
<span>    is_above_rope <span class="op">=</span> <span class="va">diff</span> <span class="op">&gt;</span> <span class="va">age_rope</span><span class="op">$</span><span class="va">rope_high</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span>is_inside_rope <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">is_below_rope</span> <span class="op">|</span> <span class="va">is_above_rope</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 1</span></span>
<span><span class="co">##   is_inside_rope</span></span>
<span><span class="co">##            &lt;dbl&gt;</span></span>
<span><span class="co">## 1              1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Or with the more automatic <code>bayestestR::rope()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_age_binomial</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">bayestestR</span><span class="fu">::</span><span class="fu">rope</span><span class="op">(</span></span>
<span>    ci <span class="op">=</span> <span class="fl">0.89</span>, </span>
<span>    range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">age_rope</span><span class="op">$</span><span class="va">rope_avg_low</span>, <span class="va">age_rope</span><span class="op">$</span><span class="va">rope_avg_high</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">## # Proportion of samples inside the ROPE [0.48, 0.58]:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parameter | inside ROPE</span></span>
<span><span class="co">## -----------------------</span></span>
<span><span class="co">## Intercept |    100.00 %</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this case, 100% of the HDI is in the ROPE, so we can say that the age proportion is equivalent to the population proportion.</p>
</div>
</div>
</div>
</section><section id="bayesian-proportion-test-for-volunteering" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="bayesian-proportion-test-for-volunteering">Bayesian proportion test for volunteering</h3>
<p>Let’s look at volunteer status by itself next, to keep things parallel with <a href="#one-sample-proportion-test-for-volunteering">the frequentist section earlier</a>.</p>
<p>We’ll make a little one-row dataset:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vol_binomial_df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>  n_yes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">results_to_test</span><span class="op">$</span><span class="va">volunteering</span><span class="op">)</span>,</span>
<span>  n_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">results_to_test</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">vol_binomial_df</span></span>
<span><span class="co">## # A tibble: 1 × 2</span></span>
<span><span class="co">##   n_yes n_total</span></span>
<span><span class="co">##   &lt;int&gt;   &lt;int&gt;</span></span>
<span><span class="co">## 1   777    1300</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we’ll use it to model the proportion/probability of volunteering:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_vol_binomial</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span></span>
<span>  <span class="fu">bf</span><span class="op">(</span><span class="va">n_yes</span> <span class="op">|</span> <span class="fu">trials</span><span class="op">(</span><span class="va">n_total</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">vol_binomial_df</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span>,</span>
<span>  prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">prior</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Special.html">beta</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"Intercept"</span>, lb <span class="op">=</span> <span class="fl">0</span>, ub <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="va">CHAINS</span>, warmup <span class="op">=</span> <span class="va">WARMUP</span>, iter <span class="op">=</span> <span class="va">ITER</span>, seed <span class="op">=</span> <span class="va">BAYES_SEED</span>,</span>
<span>  refresh <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"models/model_vol_binomial"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vol_draws</span> <span class="op">&lt;-</span> <span class="va">model_vol_binomial</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">spread_draws</span><span class="op">(</span><span class="va">b_Intercept</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>diff <span class="op">=</span> <span class="va">b_Intercept</span> <span class="op">-</span> <span class="va">national_values</span><span class="op">$</span><span class="va">volunteering</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can calculate the ROPE for the proportion volunteering, or ±0.1 × SD<sub>volunteering</sub></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vol_rope</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>  avg_vol <span class="op">=</span> <span class="va">national_values</span><span class="op">$</span><span class="va">volunteering</span>,</span>
<span>  sd_vol <span class="op">=</span> <span class="va">national_values</span><span class="op">$</span><span class="va">volunteering_sd</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    rope_low <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span> <span class="op">*</span> <span class="va">sd_vol</span>,</span>
<span>    rope_avg_low <span class="op">=</span> <span class="va">avg_vol</span> <span class="op">+</span> <span class="va">rope_low</span>,</span>
<span>    rope_high <span class="op">=</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="va">sd_vol</span>,</span>
<span>    rope_avg_high <span class="op">=</span> <span class="va">avg_vol</span> <span class="op">+</span> <span class="va">rope_high</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">vol_rope</span></span>
<span><span class="co">## # A tibble: 1 × 6</span></span>
<span><span class="co">##   avg_vol sd_vol rope_low rope_avg_low rope_high rope_avg_high</span></span>
<span><span class="co">##     &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;</span></span>
<span><span class="co">## 1   0.300  0.458  -0.0458        0.254    0.0458         0.346</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And finally we can visualize things and calculate how much of the posterior fits inside the ROPE:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">vol_draws</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">b_Intercept</span>, y <span class="op">=</span> <span class="st">"Volunteered in past year (%)"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"rect"</span>, </span>
<span>    xmin <span class="op">=</span> <span class="va">vol_rope</span><span class="op">$</span><span class="va">rope_avg_low</span>, </span>
<span>    xmax <span class="op">=</span> <span class="va">vol_rope</span><span class="op">$</span><span class="va">rope_avg_high</span>, </span>
<span>    ymin <span class="op">=</span> <span class="fl">1</span>, ymax <span class="op">=</span> <span class="cn">Inf</span>, </span>
<span>    fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, alpha <span class="op">=</span> <span class="fl">0.2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">vol_rope</span><span class="op">$</span><span class="va">avg_vol</span>, color <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Proportion"</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">vol_draws</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">diff</span>, y <span class="op">=</span> <span class="st">"Volunteered in past year (%)"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"rect"</span>, </span>
<span>    xmin <span class="op">=</span> <span class="va">vol_rope</span><span class="op">$</span><span class="va">rope_low</span>, </span>
<span>    xmax <span class="op">=</span> <span class="va">vol_rope</span><span class="op">$</span><span class="va">rope_high</span>, </span>
<span>    ymin <span class="op">=</span> <span class="fl">1</span>, ymax <span class="op">=</span> <span class="cn">Inf</span>, </span>
<span>    fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, alpha <span class="op">=</span> <span class="fl">0.2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">label_pp</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Difference from CPS"</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">/</span> <span class="va">p2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div id="fig-vol-rope" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full"><div aria-describedby="fig-vol-rope-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-vol-rope-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-vol-rope-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Posterior proportion of survey respondents that volunteer to the national proportion, and posterior differences between sample and national proportions, overlaid on a region of practical equivalence (ROPE); like <a href="#fig-age-sample-prop-vol" class="quarto-xref">Figure&nbsp;2</a>, but Bayesian
</figcaption></figure>
</div>
</div>
</div>
<p>As we saw with the frequentist version of this analysis, the proportion of people who volunteer is <em>substantially</em> different from the CPS—≈30 percentage points higher! The probability that the sample is equivalent to the CPS population is 0:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vol_draws</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    is_below_rope <span class="op">=</span> <span class="va">b_Intercept</span> <span class="op">&lt;</span> <span class="va">vol_rope</span><span class="op">$</span><span class="va">rope_avg_low</span>,</span>
<span>    is_above_rope <span class="op">=</span> <span class="va">b_Intercept</span> <span class="op">&gt;</span> <span class="va">vol_rope</span><span class="op">$</span><span class="va">rope_avg_high</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span>is_inside_rope <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">is_below_rope</span> <span class="op">|</span> <span class="va">is_above_rope</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 1</span></span>
<span><span class="co">##   is_inside_rope</span></span>
<span><span class="co">##            &lt;dbl&gt;</span></span>
<span><span class="co">## 1              0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="posterior-proportions-differences-and-ropes-for-everything-all-at-once" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="posterior-proportions-differences-and-ropes-for-everything-all-at-once">Posterior proportions, differences, and ROPEs for everything all at once</h3>
<p><a href="#proportion-tests-and-differences-for-everything-all-at-once">Like we did before with the frequentist approach</a>, we’ll make a little wrapper function for this process. It’s a little more complex, and we’ll make it return a list of lots of things: the original {brms} model, a long data frame of all the MCMC draws, a data frame with the ROPE bounds, and the probability that the full posterior is in the ROPE.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary><code>prop_test_bayes()</code> wrapper function</summary><div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' Perform a Bayesian proportion test using a beta-binomial model</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param short_name A character string representing a short name for the model file.</span></span>
<span><span class="co">#' @param sample_column A numeric vector representing the sample data (0/1 or logical).</span></span>
<span><span class="co">#' @param cps_prop A numeric value representing the population proportion to compare against.</span></span>
<span><span class="co">#' @param cps_sd A numeric value representing the standard deviation of the population proportion.</span></span>
<span><span class="co">#' @return A list containing the model, MCMC draws, ROPE details, and the proportion of the posterior</span></span>
<span><span class="co">#'         inside the ROPE.</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' sample_data &lt;- c(1, 0, 1, 1, 0, 1, 0, 1, 1, 0)</span></span>
<span><span class="co">#' cps_prop &lt;- 0.5</span></span>
<span><span class="co">#' cps_sd &lt;- 0.1</span></span>
<span><span class="co">#' prop_test_bayes("example", sample_data, cps_prop, cps_sd)</span></span>
<span><span class="va">prop_test_bayes</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">short_name</span>, <span class="va">sample_column</span>, <span class="va">cps_prop</span>, <span class="va">cps_sd</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Little one-row data frame</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>    n_yes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">sample_column</span><span class="op">)</span>,</span>
<span>    n_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">sample_column</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Intercept-only beta-binomial model</span></span>
<span>  <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span></span>
<span>    <span class="fu">bf</span><span class="op">(</span><span class="va">n_yes</span> <span class="op">|</span> <span class="fu">trials</span><span class="op">(</span><span class="va">n_total</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">df</span>,</span>
<span>    family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span>,</span>
<span>    prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">prior</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Special.html">beta</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"Intercept"</span>, lb <span class="op">=</span> <span class="fl">0</span>, ub <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    chains <span class="op">=</span> <span class="va">CHAINS</span>, warmup <span class="op">=</span> <span class="va">WARMUP</span>, iter <span class="op">=</span> <span class="va">ITER</span>, seed <span class="op">=</span> <span class="va">BAYES_SEED</span>,</span>
<span>    refresh <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    file <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"models/model_{short_name}_binomial"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># ROPE details</span></span>
<span>  <span class="va">rope</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>    cps_avg <span class="op">=</span> <span class="va">cps_prop</span>,</span>
<span>    cps_sd <span class="op">=</span> <span class="va">cps_sd</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">mutate</span><span class="op">(</span></span>
<span>      rope_low <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span> <span class="op">*</span> <span class="va">cps_sd</span>,</span>
<span>      rope_avg_low <span class="op">=</span> <span class="va">cps_avg</span> <span class="op">+</span> <span class="va">rope_low</span>,</span>
<span>      rope_high <span class="op">=</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="va">cps_sd</span>,</span>
<span>      rope_avg_high <span class="op">=</span> <span class="va">cps_avg</span> <span class="op">+</span> <span class="va">rope_high</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># MCMC draws of intercept and difference from population </span></span>
<span>  <span class="va">draws</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">spread_draws</span><span class="op">(</span><span class="va">b_Intercept</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">mutate</span><span class="op">(</span>diff <span class="op">=</span> <span class="va">b_Intercept</span> <span class="op">-</span> <span class="va">cps_prop</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Proportion of posterior inside the ROPE</span></span>
<span>  <span class="va">prop_in_rope</span> <span class="op">&lt;-</span> <span class="va">draws</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">mutate</span><span class="op">(</span></span>
<span>      is_below_rope_full <span class="op">=</span> <span class="va">b_Intercept</span> <span class="op">&lt;</span> <span class="va">rope</span><span class="op">$</span><span class="va">rope_avg_low</span>,</span>
<span>      is_above_rope_full <span class="op">=</span> <span class="va">b_Intercept</span> <span class="op">&gt;</span> <span class="va">rope</span><span class="op">$</span><span class="va">rope_avg_high</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">summarize</span><span class="op">(</span>is_inside_rope_full <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">is_below_rope_full</span> <span class="op">|</span> <span class="va">is_above_rope_full</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu">lst</span><span class="op">(</span><span class="va">model</span>, <span class="va">draws</span>, <span class="va">rope</span>, <span class="va">prop_in_rope</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And as before, we’ll make a little data frame with each of the variables we want to compare.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Create <code>sample_cps_props_bayes</code> and use <code>prop_test_bayes()</code> on each row</summary><div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sample_cps_props_bayes</span> <span class="op">&lt;-</span> <span class="fu">tribble</span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">category</span>, <span class="op">~</span><span class="va">short_name</span>, <span class="op">~</span><span class="va">variable</span>, <span class="op">~</span><span class="va">sample_value</span>, <span class="op">~</span><span class="va">national_value</span>, <span class="op">~</span><span class="va">national_sd</span>,</span>
<span>  <span class="st">"Demographics"</span>, <span class="st">"age"</span>, <span class="st">"Age (% 36+)"</span>, <span class="va">results_to_test</span><span class="op">$</span><span class="va">age</span>, <span class="va">national_values</span><span class="op">$</span><span class="va">age</span>, <span class="va">national_values</span><span class="op">$</span><span class="va">age_sd</span>,</span>
<span>  <span class="st">"Demographics"</span>, <span class="st">"female"</span>, <span class="st">"Female (%)"</span>, <span class="va">results_to_test</span><span class="op">$</span><span class="va">female</span>, <span class="va">national_values</span><span class="op">$</span><span class="va">female</span>, <span class="va">national_values</span><span class="op">$</span><span class="va">female_sd</span>,</span>
<span>  <span class="st">"Demographics"</span>, <span class="st">"married"</span>, <span class="st">"Married (%)"</span>, <span class="va">results_to_test</span><span class="op">$</span><span class="va">married</span>, <span class="va">national_values</span><span class="op">$</span><span class="va">married</span>, <span class="va">national_values</span><span class="op">$</span><span class="va">married_sd</span>,</span>
<span>  <span class="st">"Demographics"</span>, <span class="st">"college"</span>, <span class="st">"Education (% BA+)"</span>, <span class="va">results_to_test</span><span class="op">$</span><span class="va">college</span>, <span class="va">national_values</span><span class="op">$</span><span class="va">college</span>, <span class="va">national_values</span><span class="op">$</span><span class="va">college_sd</span>,</span>
<span>  <span class="st">"Philanthropy"</span>, <span class="st">"donating"</span>, <span class="st">"Donated in past year (%)"</span>, <span class="va">results_to_test</span><span class="op">$</span><span class="va">donating</span>, <span class="va">national_values</span><span class="op">$</span><span class="va">donating</span>, <span class="va">national_values</span><span class="op">$</span><span class="va">donating_sd</span>,</span>
<span>  <span class="st">"Philanthropy"</span>, <span class="st">"volunteering"</span>, <span class="st">"Volunteered in past year (%)"</span>, <span class="va">results_to_test</span><span class="op">$</span><span class="va">volunteering</span>, <span class="va">national_values</span><span class="op">$</span><span class="va">volunteering</span>, <span class="va">national_values</span><span class="op">$</span><span class="va">volunteering_sd</span>,</span>
<span>  <span class="st">"Voting"</span>, <span class="st">"voting"</span>, <span class="st">"Voted in last November election (%)"</span>, <span class="va">results_to_test</span><span class="op">$</span><span class="va">voting</span>, <span class="va">national_values</span><span class="op">$</span><span class="va">voting</span>, <span class="va">national_values</span><span class="op">$</span><span class="va">voting_sd</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>prop_test_results <span class="op">=</span> <span class="fu">pmap</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">short_name</span>, <span class="va">sample_value</span>, <span class="va">national_value</span>, <span class="va">national_sd</span><span class="op">)</span>,</span>
<span>    \<span class="op">(</span><span class="va">short_name</span>, <span class="va">sample_value</span>, <span class="va">national_value</span>, <span class="va">national_sd</span><span class="op">)</span> <span class="fu">prop_test_bayes</span><span class="op">(</span><span class="va">short_name</span>, <span class="va">sample_value</span>, <span class="va">national_value</span>, <span class="va">national_sd</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We’ll then extract the MCMC draws and ROPE details from the little data frame so that we can make some plots and tables.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Extract draws and ROPE from <code>sample_cps_props_bayes</code> results</summary><div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rope_details</span> <span class="op">&lt;-</span> <span class="va">sample_cps_props_bayes</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>prop_in_rope <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">prop_test_results</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">prop_in_rope</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>rope <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">prop_test_results</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">rope</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>sample_median <span class="op">=</span> <span class="fu">map_dbl</span><span class="op">(</span><span class="va">prop_test_results</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">draws</span><span class="op">$</span><span class="va">b_Intercept</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">unnest_wider</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">rope</span>, <span class="va">prop_in_rope</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    variable <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="fu">fct_inorder</span><span class="op">(</span><span class="va">variable</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    category <span class="op">=</span> <span class="fu">fct_inorder</span><span class="op">(</span><span class="va">category</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>p_rope <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>    <span class="fu">row_number</span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"p(Sample = CPS) = {x}"</span>, x <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">(</span><span class="va">is_inside_rope_full</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"{x}"</span>, x <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">(</span><span class="va">is_inside_rope_full</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">category</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>variable_numeric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu">fct_drop</span><span class="op">(</span><span class="va">variable</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sample_cps_props_draws</span> <span class="op">&lt;-</span> <span class="va">sample_cps_props_bayes</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>draws <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">prop_test_results</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">draws</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">unnest</span><span class="op">(</span><span class="va">draws</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    variable <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="fu">fct_inorder</span><span class="op">(</span><span class="va">variable</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    category <span class="op">=</span> <span class="fu">fct_inorder</span><span class="op">(</span><span class="va">category</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And finally, we can make a plot of all these fancy results!</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details class="code-fold"><summary>Code for making this plot ↓</summary><div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sample_cps_props_draws</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">b_Intercept</span>, y <span class="op">=</span> <span class="va">variable</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_rect</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">rope_details</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span></span>
<span>      xmin <span class="op">=</span> <span class="va">rope_avg_low</span>, xmax <span class="op">=</span> <span class="va">rope_avg_high</span>,</span>
<span>      ymin <span class="op">=</span> <span class="va">variable_numeric</span>,</span>
<span>      ymax <span class="op">=</span> <span class="va">variable_numeric</span> <span class="op">+</span> <span class="fl">0.9</span>,</span>
<span>      fill <span class="op">=</span> <span class="st">"ROPE (± 0.1 SD)"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.2</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>slab_fill <span class="op">=</span> <span class="va">category</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_segment</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">rope_details</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">national_value</span>, xend <span class="op">=</span> <span class="va">national_value</span>,</span>
<span>      y <span class="op">=</span> <span class="va">variable_numeric</span>, yend <span class="op">=</span> <span class="va">variable_numeric</span> <span class="op">+</span> <span class="fl">0.9</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"CPS proportion"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    key_glyph <span class="op">=</span> <span class="st">"vline"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_label</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">rope_details</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.9</span>, y <span class="op">=</span> <span class="va">variable</span>, label <span class="op">=</span> <span class="va">p_rope</span><span class="op">)</span>, </span>
<span>    inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    hjust <span class="op">=</span> <span class="fl">1</span>, vjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>, size <span class="op">=</span> <span class="fl">8</span>, size.unit <span class="op">=</span> <span class="st">"pt"</span>, label.size <span class="op">=</span> <span class="fl">0</span>, fill <span class="op">=</span> <span class="st">"grey95"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>color <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>order <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, fill <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>order <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_discrete</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_wrap</span><span class="op">(</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">clrs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">clrs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">8</span>, <span class="fl">11</span><span class="op">)</span><span class="op">]</span>, aesthetics <span class="op">=</span> <span class="st">"slab_fill"</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Proportion"</span>, y <span class="op">=</span> <span class="cn">NULL</span>, color <span class="op">=</span> <span class="cn">NULL</span>, fill <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_col</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">category</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>, space <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    legend.key.width <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">2</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>    legend.key.height <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.9</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>    axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>vjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div id="fig-prop-test-bayes-props" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full"><div aria-describedby="fig-prop-test-bayes-props-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-prop-test-bayes-props-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-prop-test-bayes-props-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Respondent demographic proportions compared to national proportions, overlaid on variable-specific ROPEs; like <a href="#fig-prop-test-freq-props" class="quarto-xref">Figure&nbsp;3</a>, but Bayesian
</figcaption></figure>
</div>
</div>
</div>
<div class="cell page-columns page-full" data-layout-align="center">
<details class="code-fold"><summary>Code for making this plot ↓</summary><div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sample_cps_props_draws</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">diff</span>, y <span class="op">=</span> <span class="va">variable</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_rect</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">rope_details</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span></span>
<span>      xmin <span class="op">=</span> <span class="va">rope_low</span>, xmax <span class="op">=</span> <span class="va">rope_high</span>,</span>
<span>      ymin <span class="op">=</span> <span class="va">variable_numeric</span>,</span>
<span>      ymax <span class="op">=</span> <span class="va">variable_numeric</span> <span class="op">+</span> <span class="fl">0.9</span>,</span>
<span>      fill <span class="op">=</span> <span class="st">"ROPE (± 0.1 SD)"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.2</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"CPS proportion"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>slab_fill <span class="op">=</span> <span class="va">category</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_label</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">rope_details</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.4</span>, y <span class="op">=</span> <span class="va">variable</span>, label <span class="op">=</span> <span class="va">p_rope</span><span class="op">)</span>, </span>
<span>    inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    hjust <span class="op">=</span> <span class="fl">1</span>, vjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>, size <span class="op">=</span> <span class="fl">8</span>, size.unit <span class="op">=</span> <span class="st">"pt"</span>, label.size <span class="op">=</span> <span class="fl">0</span>, fill <span class="op">=</span> <span class="st">"grey95"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>color <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>order <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, fill <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>order <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">label_pp</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_discrete</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_wrap</span><span class="op">(</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">clrs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">clrs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">8</span>, <span class="fl">11</span><span class="op">)</span><span class="op">]</span>, aesthetics <span class="op">=</span> <span class="st">"slab_fill"</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Difference from CPS"</span>, y <span class="op">=</span> <span class="cn">NULL</span>, color <span class="op">=</span> <span class="cn">NULL</span>, fill <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_col</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">category</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>, space <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    legend.key.width <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">2</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>    legend.key.height <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.9</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>    axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>vjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div id="fig-prop-test-bayes-diffs" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full"><div aria-describedby="fig-prop-test-bayes-diffs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-prop-test-bayes-diffs-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-prop-test-bayes-diffs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Differences between demographic proportions and national proportions, overlaid on variable-specific ROPEs; like <a href="#fig-prop-test-freq-diffs" class="quarto-xref">Figure&nbsp;4</a>, but Bayesian
</figcaption></figure>
</div>
</div>
</div>
<p>And as before, we can make pretty tables with <a href="https://vincentarelbundock.github.io/tinytable/">{tinytable}</a>:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details class="code-fold"><summary>Code for making this table ↓</summary><div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">notes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"†"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fl">0</span>, j <span class="op">=</span> <span class="fl">5</span>, text <span class="op">=</span> <span class="st">"Proportion of the complete sample posterior that falls outside of the region of practical equivalence (ROPE) around the national proportion, or [−0.1 × SD, 0.1 × SD]. This essentially respresents the probabilty that the sample posterior is equivalent to the national proportion."</span><span class="op">)</span>,</span>
<span>  <span class="st">"a"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, j <span class="op">=</span> <span class="fl">1</span>, text <span class="op">=</span> <span class="st">"Annual Social and Economic Supplement (ASEC) of the Current Population Survey (CPS), March 2019"</span><span class="op">)</span>,</span>
<span>  <span class="st">"b"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">6</span>, j <span class="op">=</span> <span class="fl">1</span>, text <span class="op">=</span> <span class="st">"Monthly CPS, September 2019"</span><span class="op">)</span>,</span>
<span>  <span class="st">"c"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fl">7</span>, j <span class="op">=</span> <span class="fl">1</span>, text <span class="op">=</span> <span class="st">"Monthly CPS, November 2018"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tbl_bayes</span> <span class="op">&lt;-</span> <span class="va">sample_cps_props_bayes</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>prop_in_rope <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">prop_test_results</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">prop_in_rope</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>sample_median_ci <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">prop_test_results</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">draws</span> <span class="op">|&gt;</span> <span class="fu">median_qi</span><span class="op">(</span><span class="va">b_Intercept</span>, <span class="va">diff</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">unnest_wider</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">prop_in_rope</span>, <span class="va">sample_median_ci</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tbl_bayes</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>sample_nice <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span></span>
<span>    <span class="st">"{value}&lt;br&gt;[{lower}, {upper}]"</span>,</span>
<span>    value <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">(</span><span class="va">b_Intercept</span><span class="op">)</span>,</span>
<span>    lower <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">(</span><span class="va">b_Intercept.lower</span><span class="op">)</span>,</span>
<span>    upper <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">(</span><span class="va">b_Intercept.upper</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>diff_nice <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span></span>
<span>    <span class="st">"{diff}&lt;br&gt;[{lower}, {upper}]"</span>,</span>
<span>    diff <span class="op">=</span> <span class="fu">label_pp_01</span><span class="op">(</span><span class="va">diff</span><span class="op">)</span>,</span>
<span>    lower <span class="op">=</span> <span class="fu">label_number</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.1</span>, scale <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">(</span><span class="va">diff.lower</span><span class="op">)</span>,</span>
<span>    upper <span class="op">=</span> <span class="fu">label_number</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.1</span>, scale <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">(</span><span class="va">diff.upper</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>p_in_rope <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.1</span>, scale <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">(</span><span class="va">is_inside_rope_full</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span></span>
<span>    Variable <span class="op">=</span> <span class="va">variable</span>,</span>
<span>    National <span class="op">=</span> <span class="va">national_value</span>,</span>
<span>    Sample <span class="op">=</span> <span class="va">sample_nice</span>,</span>
<span>    `∆` <span class="op">=</span> <span class="va">diff_nice</span>,</span>
<span>    `p(Sample = CPS)` <span class="op">=</span> <span class="va">p_in_rope</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tt</span><span class="op">(</span>width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span><span class="op">)</span>, notes <span class="op">=</span> <span class="va">notes</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">group_tt</span><span class="op">(</span>i <span class="op">=</span> <span class="va">tbl_bayes</span><span class="op">$</span><span class="va">category</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">format_tt</span><span class="op">(</span>j <span class="op">=</span> <span class="fl">2</span>, fn <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">style_tt</span><span class="op">(</span>i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">9</span><span class="op">)</span>, bold <span class="op">=</span> <span class="cn">TRUE</span>, background <span class="op">=</span> <span class="st">"#e6e6e6"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">style_tt</span><span class="op">(</span></span>
<span>    bootstrap_class <span class="op">=</span> <span class="st">"table"</span>,</span>
<span>    bootstrap_css_rule <span class="op">=</span> <span class="st">".table tfoot { text-align: left; } .table { font-size: 0.85rem; }"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">style_tt</span><span class="op">(</span>j <span class="op">=</span> <span class="fl">1</span>, align <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">style_tt</span><span class="op">(</span>j <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">5</span>, align <span class="op">=</span> <span class="st">"c"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-prop-test-bayes" class="cell quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure page-columns page-full"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-prop-test-bayes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Sample characteristics compared to nationally representative Current Population Survey (CPS) estimates, with probability that the sample is equivalent to the national proportion; like <a href="#tbl-prop-test-freq" class="quarto-xref">Table&nbsp;1</a>, but Bayesian
</figcaption><div aria-describedby="tbl-prop-test-bayes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="cell-output-display column-page-inset-right">
<!-- preamble start -->

    <script>

      function styleCell_ms43054bhimhmv9c76po(i, j, css_id) {
          var table = document.getElementById("tinytable_ms43054bhimhmv9c76po");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow_o8mhpj00ubn4atozcgij(i, colspan, content) {
        var table = document.getElementById('tinytable_ms43054bhimhmv9c76po');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_ms43054bhimhmv9c76po(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_ms43054bhimhmv9c76po");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
window.addEventListener('load', function () { insertSpanRow_o8mhpj00ubn4atozcgij(7, 5, 'Voting') });
window.addEventListener('load', function () { insertSpanRow_o8mhpj00ubn4atozcgij(5, 5, 'Philanthropy') });
window.addEventListener('load', function () { insertSpanRow_o8mhpj00ubn4atozcgij(1, 5, 'Demographics') });
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 10, j: 0 },  ], css_id: 'tinytable_css_yovxku58v0bjx6jc0qkz',}, 
          { positions: [ { i: 0, j: 2 }, { i: 0, j: 4 }, { i: 0, j: 3 },  ], css_id: 'tinytable_css_n64iujdx2r8u733mg4hl',}, 
          { positions: [ { i: 10, j: 1 },  ], css_id: 'tinytable_css_mxxq8s459gf8eeekadyl',}, 
          { positions: [ { i: 3, j: 2 }, { i: 8, j: 2 }, { i: 2, j: 3 }, { i: 2, j: 2 }, { i: 5, j: 3 }, { i: 4, j: 2 }, { i: 3, j: 3 }, { i: 8, j: 3 }, { i: 7, j: 2 }, { i: 3, j: 4 }, { i: 5, j: 2 }, { i: 5, j: 4 }, { i: 2, j: 4 }, { i: 7, j: 4 }, { i: 4, j: 4 }, { i: 7, j: 3 }, { i: 4, j: 3 }, { i: 8, j: 4 },  ], css_id: 'tinytable_css_l0lsc21ndng4xj5gdaem',}, 
          { positions: [ { i: 6, j: 4 }, { i: 6, j: 3 }, { i: 1, j: 2 }, { i: 6, j: 2 }, { i: 9, j: 3 }, { i: 1, j: 3 }, { i: 9, j: 4 }, { i: 1, j: 4 }, { i: 9, j: 2 },  ], css_id: 'tinytable_css_kwvl4def6mbofzyd7wip',}, 
          { positions: [ { i: 10, j: 3 }, { i: 10, j: 2 }, { i: 10, j: 4 },  ], css_id: 'tinytable_css_c2bvxsmutc4dpjn73sd8',}, 
          { positions: [ { i: 3, j: 0 }, { i: 4, j: 0 }, { i: 2, j: 0 }, { i: 7, j: 0 }, { i: 8, j: 0 }, { i: 5, j: 0 },  ], css_id: 'tinytable_css_as197ai34n64j3k85z8j',}, 
          { positions: [ { i: 3, j: 1 }, { i: 4, j: 1 }, { i: 2, j: 1 }, { i: 7, j: 1 }, { i: 8, j: 1 }, { i: 5, j: 1 },  ], css_id: 'tinytable_css_57e6t6absi9ldka4hb7f',}, 
          { positions: [ { i: 0, j: 0 },  ], css_id: 'tinytable_css_4qogn9jo72vqe52excn0',}, 
          { positions: [ { i: 1, j: 0 }, { i: 6, j: 0 }, { i: 9, j: 0 },  ], css_id: 'tinytable_css_1ijbhgq20zatxfa3paf3',}, 
          { positions: [ { i: 1, j: 1 }, { i: 6, j: 1 }, { i: 9, j: 1 },  ], css_id: 'tinytable_css_1goilph8rur79xfdjw04',}, 
          { positions: [ { i: 0, j: 1 },  ], css_id: 'tinytable_css_03v7ob43ggstz9l3t130',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_ms43054bhimhmv9c76po(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script><style>
      /* tinytable css entries after */
      .table td.tinytable_css_yovxku58v0bjx6jc0qkz, .table th.tinytable_css_yovxku58v0bjx6jc0qkz { padding-left: 1em; text-align: left; border-bottom: solid #d3d8dc 0.1em; width: 30%; }
      .table td.tinytable_css_n64iujdx2r8u733mg4hl, .table th.tinytable_css_n64iujdx2r8u733mg4hl { text-align: center; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; width: 20%; }
      .table td.tinytable_css_mxxq8s459gf8eeekadyl, .table th.tinytable_css_mxxq8s459gf8eeekadyl { text-align: center; border-bottom: solid #d3d8dc 0.1em; width: 10%; }
      .table td.tinytable_css_l0lsc21ndng4xj5gdaem, .table th.tinytable_css_l0lsc21ndng4xj5gdaem { text-align: center; width: 20%; }
      .table td.tinytable_css_kwvl4def6mbofzyd7wip, .table th.tinytable_css_kwvl4def6mbofzyd7wip { font-weight: bold; background-color: #e6e6e6; text-align: center; width: 20%; }
      .table td.tinytable_css_c2bvxsmutc4dpjn73sd8, .table th.tinytable_css_c2bvxsmutc4dpjn73sd8 { text-align: center; border-bottom: solid #d3d8dc 0.1em; width: 20%; }
      .table td.tinytable_css_as197ai34n64j3k85z8j, .table th.tinytable_css_as197ai34n64j3k85z8j { padding-left: 1em; text-align: left; width: 30%; }
      .table td.tinytable_css_57e6t6absi9ldka4hb7f, .table th.tinytable_css_57e6t6absi9ldka4hb7f { text-align: center; width: 10%; }
      .table td.tinytable_css_4qogn9jo72vqe52excn0, .table th.tinytable_css_4qogn9jo72vqe52excn0 { text-align: left; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; width: 30%; }
      .table td.tinytable_css_1ijbhgq20zatxfa3paf3, .table th.tinytable_css_1ijbhgq20zatxfa3paf3 { font-weight: bold; background-color: #e6e6e6; text-align: left; width: 30%; }
      .table td.tinytable_css_1goilph8rur79xfdjw04, .table th.tinytable_css_1goilph8rur79xfdjw04 { font-weight: bold; background-color: #e6e6e6; text-align: center; width: 10%; }
      .table td.tinytable_css_03v7ob43ggstz9l3t130, .table th.tinytable_css_03v7ob43ggstz9l3t130 { text-align: center; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; width: 10%; }
.table tfoot { text-align: left; } .table { font-size: 0.85rem; }
    </style>
<div class="container">
      <table class="table" id="tinytable_ms43054bhimhmv9c76po" style="table-layout: fixed; width: 100% !important; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
<thead><tr>
<th scope="col">Variable</th>
                <th scope="col">National</th>
                <th scope="col">Sample</th>
                <th scope="col">∆</th>
                <th scope="col">p(Sample = CPS)<sup>†</sup>
</th>
              </tr></thead>
<tfoot>
<tr><td colspan="5">
<sup>†</sup> Proportion of the complete sample posterior that falls outside of the region of practical equivalence (ROPE) around the national proportion, or [−0.1 × SD, 0.1 × SD]. This essentially respresents the probabilty that the sample posterior is equivalent to the national proportion.</td></tr>
<tr><td colspan="5">
<sup>a</sup> Annual Social and Economic Supplement (ASEC) of the Current Population Survey (CPS), March 2019</td></tr>
<tr><td colspan="5">
<sup>b</sup> Monthly CPS, September 2019</td></tr>
<tr><td colspan="5">
<sup>c</sup> Monthly CPS, November 2018</td></tr>
</tfoot>
<tbody>
<tr>
<td>Age (% 36+)<sup>a</sup>
</td>
                  <td>53.0%</td>
                  <td>50.8%<br>[48.1%, 53.5%]</td>
                  <td>−2.3 pp.<br>[-5.0, 0.5]</td>
                  <td>97.6%</td>
                </tr>
<tr>
<td>Female (%)<sup>a</sup>
</td>
                  <td>51.0%</td>
                  <td>47.2%<br>[44.4%, 49.9%]</td>
                  <td>−3.8 pp.<br>[-6.5, -1.1]</td>
                  <td>80.9%</td>
                </tr>
<tr>
<td>Married (%)<sup>a</sup>
</td>
                  <td>41.0%</td>
                  <td>40.6%<br>[37.9%, 43.3%]</td>
                  <td>−0.4 pp.<br>[-3.1, 2.3]</td>
                  <td>99.9%</td>
                </tr>
<tr>
<td>Education (% BA+)<sup>a</sup>
</td>
                  <td>25.8%</td>
                  <td>28.6%<br>[26.0%, 31.1%]</td>
                  <td>2.8 pp.<br>[0.3, 5.3]</td>
                  <td>89.8%</td>
                </tr>
<tr>
<td>Donated in past year (%)<sup>b</sup>
</td>
                  <td>47.4%</td>
                  <td>56.9%<br>[54.3%, 59.7%]</td>
                  <td>9.5 pp.<br>[6.9, 12.3]</td>
                  <td>0.1%</td>
                </tr>
<tr>
<td>Volunteered in past year (%)<sup>b</sup>
</td>
                  <td>30.0%</td>
                  <td>59.7%<br>[57.1%, 62.4%]</td>
                  <td>29.7 pp.<br>[27.1, 32.3]</td>
                  <td>0.0%</td>
                </tr>
<tr>
<td>Voted in last November election (%)<sup>c</sup>
</td>
                  <td>53.4%</td>
                  <td>71.5%<br>[68.9%, 73.9%]</td>
                  <td>18.0 pp.<br>[15.5, 20.5]</td>
                  <td>0.0%</td>
                </tr>
</tbody>
</table>
</div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
</figure>
</div>
</div>


<!-- -->


</section></section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-ChaudhryDotsonHeiss:2024" class="csl-entry" role="listitem">
Chaudhry, Suparna, Marc Dotson, and Andrew Heiss. 2024. <span>“Navigating Hostility: The Effect of Nonprofit Transparency and Accountability on Donor Preferences in the Face of Shrinking Civic Space.”</span> Working paper. <a href="https://doi.org/10.31235/osf.io/hu6a5">https://doi.org/10.31235/osf.io/hu6a5</a>.
</div>
<div id="ref-Kruschke:2010a" class="csl-entry" role="listitem">
Kruschke, John K. 2010. <span>“What to Believe: Bayesian Methods for Data Analysis.”</span> <em>Trends in Cognitive Sciences</em> 14 (7): 293–300. <a href="https://doi.org/10.1016/j.tics.2010.05.001">https://doi.org/10.1016/j.tics.2010.05.001</a>.
</div>
<div id="ref-Kruschke:2015" class="csl-entry" role="listitem">
———. 2015. <em>Doing Bayesian Data Analysis: A Tutorial with R, JAGS, and Stan</em>. 2nd ed. London: Academic Press / Elsevier. <a href="https://doi.org/10.1016/c2012-0-00477-2">https://doi.org/10.1016/c2012-0-00477-2</a>.
</div>
<div id="ref-KruschkeAguinisJoo:2012" class="csl-entry" role="listitem">
Kruschke, John K., Herman Aguinis, and Harry Joo. 2012. <span>“The Time Has Come: Bayesian Methods for Data Analysis in the Organizational Sciences.”</span> <em>Organizational Research Methods</em> 15 (4): 722–52. <a href="https://doi.org/10.1177/1094428112457829">https://doi.org/10.1177/1094428112457829</a>.
</div>
<div id="ref-KruschkeLiddell:2018" class="csl-entry" role="listitem">
Kruschke, John K., and Torrin M. Liddell. 2018. <span>“The Bayesian New Statistics: Hypothesis Testing, Estimation, Meta-Analysis, and Power Analysis from a Bayesian Perspective.”</span> <em>Psychonomic Bulletin &amp; Review</em> 25 (1): 178–206. <a href="https://doi.org/10.3758/s13423-016-1221-4">https://doi.org/10.3758/s13423-016-1221-4</a>.
</div>
<div id="ref-McElreath:2020" class="csl-entry" role="listitem">
McElreath, Richard. 2020. <em>Statistical Rethinking: A Bayesian Course with Examples in R and Stan</em>. 2nd ed. Boca Raton, Florida: Chapman and Hall / CRC.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{heiss2025,
  author = {Heiss, Andrew},
  title = {Guide to Comparing Sample and Population Proportions with
    {CPS} Data, Both Classically and {Bayesianly}},
  date = {2025-01-27},
  url = {https://www.andrewheiss.com/blog/2025/01/27/ipums-cps-proportions-bayes/},
  doi = {10.59350/8ws3f-1fd56},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-heiss2025" class="csl-entry quarto-appendix-citeas" role="listitem">
Heiss, Andrew. 2025. <span>“Guide to Comparing Sample and Population
Proportions with CPS Data, Both Classically and Bayesianly.”</span>
January 27, 2025. <a href="https://doi.org/10.59350/8ws3f-1fd56">https://doi.org/10.59350/8ws3f-1fd56</a>.
</div></div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.andrewheiss\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><script src="https://giscus.app/client.js" data-repo="andrewheiss/ath-quarto" data-repo-id="R_kgDOIg6EJQ" data-category="Blog comments" data-category-id="DIC_kwDOIg6EJc4CSz92" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><input type="hidden" id="giscus-base-theme" value="light"><input type="hidden" id="giscus-alt-theme" value="dark"><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb54" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Guide to comparing sample and population proportions with CPS data, both classically and Bayesianly"</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2025-01-27</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Download CPS demographic data from IPUMS and use R and {brms} to calculate differences between sample and national proportions with Bayesian ROPE-based inference"</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> index_files/figure-html/fig-prop-test-bayes-diffs-1.png</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="an">twitter-card:</span><span class="co"> </span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="co">    image: "index_files/figure-html/fig-prop-test-bayes-diffs-1.png"</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="an">open-graph:</span><span class="co"> </span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="co">    image: "index_files/figure-html/fig-prop-test-bayes-diffs-1.png"</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="co">  - r</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a><span class="co">  - tidyverse</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a><span class="co">  - us census</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a><span class="co">  - ggplot</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a><span class="co">  - bayes</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a><span class="co">  - brms</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a><span class="co">  - surveys</span></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a><span class="co">    shift-heading-level-by: 1</span></span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a><span class="co">    reference-location: margin</span></span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a><span class="co">    include-in-header:</span></span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a><span class="co">      - text: |</span></span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a><span class="co">          &lt;style type="text/css"&gt;</span></span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a><span class="co">          hr.dinkus {</span></span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a><span class="co">              width: 50px;</span></span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a><span class="co">              margin: 2em auto 2em;</span></span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a><span class="co">              border-top: 5px dotted #454545;</span></span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a><span class="co">          }</span></span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a><span class="co">          div.column-margin+hr.dinkus {</span></span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a><span class="co">              margin: 1em auto 2em;</span></span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a><span class="co">          }</span></span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a><span class="co">          .quarto-float-tbl figcaption {</span></span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a><span class="co">              text-align: left !important;</span></span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a><span class="co">          }</span></span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a><span class="co">          &lt;/style&gt;</span></span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true" tabindex="-1"></a><span class="an">resources:</span></span>
<span id="cb54-44"><a href="#cb54-44" aria-hidden="true" tabindex="-1"></a><span class="co">  - "synthetic_data.rds"</span></span>
<span id="cb54-45"><a href="#cb54-45" aria-hidden="true" tabindex="-1"></a><span class="co">  - "synthetic_data.csv"</span></span>
<span id="cb54-46"><a href="#cb54-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-47"><a href="#cb54-47" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> references.json</span></span>
<span id="cb54-48"><a href="#cb54-48" aria-hidden="true" tabindex="-1"></a><span class="an">csl:</span><span class="co"> chicago-author-date.csl</span></span>
<span id="cb54-49"><a href="#cb54-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-50"><a href="#cb54-50" aria-hidden="true" tabindex="-1"></a><span class="an">doi:</span><span class="co"> 10.59350/8ws3f-1fd56</span></span>
<span id="cb54-51"><a href="#cb54-51" aria-hidden="true" tabindex="-1"></a><span class="an">citation:</span><span class="co"> true</span></span>
<span id="cb54-52"><a href="#cb54-52" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb54-53"><a href="#cb54-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-56"><a href="#cb54-56" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-57"><a href="#cb54-57" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb54-58"><a href="#cb54-58" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb54-59"><a href="#cb54-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-60"><a href="#cb54-60" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb54-61"><a href="#cb54-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig.width =</span> <span class="dv">6</span>,</span>
<span id="cb54-62"><a href="#cb54-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig.height =</span> <span class="dv">6</span> <span class="sc">*</span> <span class="fl">0.618</span>,</span>
<span id="cb54-63"><a href="#cb54-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig.retina =</span> <span class="dv">3</span>,</span>
<span id="cb54-64"><a href="#cb54-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">dev =</span> <span class="st">"ragg_png"</span>,</span>
<span id="cb54-65"><a href="#cb54-65" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig.align =</span> <span class="st">"center"</span>,</span>
<span id="cb54-66"><a href="#cb54-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">out.width =</span> <span class="st">"90%"</span>,</span>
<span id="cb54-67"><a href="#cb54-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">collapse =</span> <span class="cn">TRUE</span>,</span>
<span id="cb54-68"><a href="#cb54-68" aria-hidden="true" tabindex="-1"></a>  <span class="at">cache.extra =</span> <span class="dv">1234</span>  <span class="co"># Change number to invalidate cache</span></span>
<span id="cb54-69"><a href="#cb54-69" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-70"><a href="#cb54-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-71"><a href="#cb54-71" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(</span>
<span id="cb54-72"><a href="#cb54-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">digits =</span> <span class="dv">4</span>,</span>
<span id="cb54-73"><a href="#cb54-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">300</span>,</span>
<span id="cb54-74"><a href="#cb54-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">dplyr.summarise.inform =</span> <span class="cn">FALSE</span></span>
<span id="cb54-75"><a href="#cb54-75" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-76"><a href="#cb54-76" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-77"><a href="#cb54-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-78"><a href="#cb54-78" aria-hidden="true" tabindex="-1"></a>Last week I was making some final revisions <span class="co">[</span><span class="ot">to a paper</span><span class="co">](https://stats.andrewheiss.com/silent-skywalk/)</span> where we used a neat conjoint experiment to test the effect of a bunch of different treatments on nonprofit donor preference. </span>
<span id="cb54-79"><a href="#cb54-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-80"><a href="#cb54-80" aria-hidden="true" tabindex="-1"></a>One of the peer reviewers asked us to compare the characteristics of our experimental sample with the general population so that we could speak a little to the experiment's generalizability. This is a super common thing to do with survey research, and one of the main reasons survey researchers include demographic questions in their surveys.</span>
<span id="cb54-81"><a href="#cb54-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-82"><a href="#cb54-82" aria-hidden="true" tabindex="-1"></a>Thanks to the wonders of the R community—and thanks to publicly accessible data—I was able to grab nationally representative demographic data, clean it up and summarize it, run some statistical tests, and make a table to meet the reviewer's request, <span class="co">[</span><span class="ot">all in like 45 minutes</span><span class="co">](https://bsky.app/profile/andrew.heiss.phd/post/3lgc5loazd22y)</span>.</span>
<span id="cb54-83"><a href="#cb54-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-84"><a href="#cb54-84" aria-hidden="true" tabindex="-1"></a><span class="al">![](img/00-bsky-post.png)</span>{width="80%" fig-align="center"}</span>
<span id="cb54-85"><a href="#cb54-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-86"><a href="#cb54-86" aria-hidden="true" tabindex="-1"></a>It was a magically quick and easy process, so I figured I'd make a guide about it so that the rest of the world (but mostly future me) can see how to do it.</span>
<span id="cb54-87"><a href="#cb54-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-88"><a href="#cb54-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-89"><a href="#cb54-89" aria-hidden="true" tabindex="-1"></a><span class="fu"># Nationally representative demographic data</span></span>
<span id="cb54-90"><a href="#cb54-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-91"><a href="#cb54-91" aria-hidden="true" tabindex="-1"></a>Finding nationally representative demographic data (in the US, at least) is pretty easy, and there are two common sources for it:</span>
<span id="cb54-92"><a href="#cb54-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-93"><a href="#cb54-93" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The US Census's <span class="co">[</span><span class="ot">American Community Survey</span><span class="co">](https://www.census.gov/programs-surveys/acs)</span> (ACS) is a rolling monthly survey of ≈3.5 million (!!!) US *households* that's compiled into an annual dataset.</span>
<span id="cb54-94"><a href="#cb54-94" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The US Census's <span class="co">[</span><span class="ot">Current Population Survey</span><span class="co">](https://www.census.gov/programs-surveys/cps.html)</span> (CPS) is a monthly survey of ≈100,000 US *individuals*. A more comprehensive annual version—the Annual Social and Economic Supplement (ASEC)—is published every March.</span>
<span id="cb54-95"><a href="#cb54-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-96"><a href="#cb54-96" aria-hidden="true" tabindex="-1"></a>The two surveys serve different purposes, and <span class="co">[</span><span class="ot">the Census has an FAQ fact sheet explaining the difference between the ACS and CPS</span><span class="co">](https://www.census.gov/topics/income-poverty/poverty/guidance/data-sources/acs-vs-cps.html)</span>. Notably, the ACS only surveys *households*, and it uses a shorter 8-question survey, while the CPS tries to reach the entire civilian noninstitutionalized population and uses a longer, more detailed survey.</span>
<span id="cb54-97"><a href="#cb54-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-98"><a href="#cb54-98" aria-hidden="true" tabindex="-1"></a>Researchers use both surveys—I've used both in my own work. <span class="co">[</span><span class="ot">According to the Census</span><span class="co">](https://www.census.gov/topics/income-poverty/poverty/guidance/data-sources/acs-vs-cps.html)</span>, due to its detailed questionnaire and staff experience and regular frequency, the CPS ASEC is a "high quality source of information used to produce the official annual estimate of poverty, and estimates of a number of other socioeconomic and demographic characteristics". The ACS also has demographic details and people use those instead too. </span>
<span id="cb54-99"><a href="#cb54-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-100"><a href="#cb54-100" aria-hidden="true" tabindex="-1"></a>I'm not entirely sure which one is best—to me they're both great 🤷‍♂️. Smarter people than me know and care about the difference.</span>
<span id="cb54-101"><a href="#cb54-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-102"><a href="#cb54-102" aria-hidden="true" tabindex="-1"></a><span class="fu"># Accessing US Census data</span></span>
<span id="cb54-103"><a href="#cb54-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-104"><a href="#cb54-104" aria-hidden="true" tabindex="-1"></a>Getting data from the Census is a surprisingly complex process! There are websites and R packages that make it easier though.</span>
<span id="cb54-105"><a href="#cb54-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-106"><a href="#cb54-106" aria-hidden="true" tabindex="-1"></a><span class="fu">## ACS</span></span>
<span id="cb54-107"><a href="#cb54-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-108"><a href="#cb54-108" aria-hidden="true" tabindex="-1"></a>For the ACS, <span class="co">[</span><span class="ot">the {tidycensus} R package</span><span class="co">](https://walker-data.com/tidycensus/)</span> provides an interface to the Census's API, and <span class="co">[</span><span class="ot">its documentation is great and thorough</span><span class="co">](https://walker-data.com/tidycensus/)</span>. Working with the results is tricky though, and involves a lot of pivoting and reshaping and combining variables. <span class="co">[</span><span class="ot">I have a whole notebook</span><span class="co">](https://stats.andrewheiss.com/zany-zebra/notebook/acs-data.html)</span> showing how I access the ACS and create a bunch of variables, with <span class="co">[</span><span class="ot">little notes</span><span class="co">](https://stats.andrewheiss.com/zany-zebra/notebook/acs-data.html#high-school-education)</span> reminding myself how I constructed everything:</span>
<span id="cb54-109"><a href="#cb54-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-110"><a href="#cb54-110" aria-hidden="true" tabindex="-1"></a><span class="al">![Explanation of how I calculated the proportion of households in a block group with a high school education](img/00-zany-zebra-example.png)</span>{.lightbox .border width="80%" fig-align="center"}</span>
<span id="cb54-111"><a href="#cb54-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-112"><a href="#cb54-112" aria-hidden="true" tabindex="-1"></a><span class="fu">## CPS (and others!)</span></span>
<span id="cb54-113"><a href="#cb54-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-114"><a href="#cb54-114" aria-hidden="true" tabindex="-1"></a>{tidycensus} doesn't provide Census API access to CPS data. Instead, <span class="co">[</span><span class="ot">IPUMS</span><span class="co">](https://www.ipums.org/)</span>—a project housed at the University of Minnesota and supported by a consortium of other institutions and companies—provides easy access to all sorts of census and survey data, both through its website and through an API. It's wild how much data they have. In addition to the <span class="co">[</span><span class="ot">CPS</span><span class="co">](https://cps.ipums.org/cps/)</span>, they have the <span class="co">[</span><span class="ot">ACS</span><span class="co">](https://usa.ipums.org/)</span>, <span class="co">[</span><span class="ot">census microtata for 100+ countries</span><span class="co">](https://international.ipums.org/international/)</span>, <span class="co">[</span><span class="ot">historical GIS shapefiles</span><span class="co">](https://www.nhgis.org/)</span>, <span class="co">[</span><span class="ot">time use surveys</span><span class="co">](https://timeuse.ipums.org/)</span>, and a ton of other things. It's an incredible project.</span>
<span id="cb54-115"><a href="#cb54-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-116"><a href="#cb54-116" aria-hidden="true" tabindex="-1"></a><span class="fu"># Getting started</span></span>
<span id="cb54-117"><a href="#cb54-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-118"><a href="#cb54-118" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb54-119"><a href="#cb54-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-120"><a href="#cb54-120" aria-hidden="true" tabindex="-1"></a><span class="fu">### Who this guide is for</span></span>
<span id="cb54-121"><a href="#cb54-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-122"><a href="#cb54-122" aria-hidden="true" tabindex="-1"></a>Here's what I assume you know:</span>
<span id="cb54-123"><a href="#cb54-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-124"><a href="#cb54-124" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You're familiar with <span class="co">[</span><span class="ot">R</span><span class="co">](https://www.r-project.org/)</span> and the <span class="co">[</span><span class="ot">tidyverse</span><span class="co">](https://www.tidyverse.org/)</span> (particularly <span class="co">[</span><span class="ot">{dplyr}</span><span class="co">](https://dplyr.tidyverse.org/)</span> and <span class="co">[</span><span class="ot">{ggplot2}</span><span class="co">](https://ggplot2.tidyverse.org/)</span>).</span>
<span id="cb54-125"><a href="#cb54-125" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You're familiar with <span class="co">[</span><span class="ot">{brms}</span><span class="co">](https://paul-buerkner.github.io/brms/)</span> for running Bayesian regression models and <span class="co">[</span><span class="ot">{tidybayes}</span><span class="co">](https://mjskay.github.io/tidybayes/)</span> and <span class="co">[</span><span class="ot">{ggdist}</span><span class="co">](https://mjskay.github.io/ggdist/)</span> for manipulating and plotting posterior draws.</span>
<span id="cb54-126"><a href="#cb54-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-127"><a href="#cb54-127" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb54-128"><a href="#cb54-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-129"><a href="#cb54-129" aria-hidden="true" tabindex="-1"></a>In this guide, we'll use IPUMS to get <span class="co">[</span><span class="ot">CPS</span><span class="co">](https://cps.ipums.org/cps/)</span> data (monthly and ASEC) with R. Because their data explorer website takes a little while to get used to, I'll show a bunch of step-by-step screenshots of how to navigate it. It's possible to <span class="co">[</span><span class="ot">access the IPUMS API</span><span class="co">](https://tech.popdata.org/ipumsr/articles/ipums-api.html)</span> with the {ipumsr} package, and I also <span class="co">[</span><span class="ot">show how to do that in this guide</span><span class="co">](#more-reproducible-alternative-using-the-ipums-api)</span>. But in order to use the API, you still need to know how to use the website—you have to find variable names and figure out which samples include which variables. So the screenshots below are still important even if you're using the API.</span>
<span id="cb54-130"><a href="#cb54-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-131"><a href="#cb54-131" aria-hidden="true" tabindex="-1"></a>I'll then show how to answer the question of whether a survey proportion is equivalent to a population proportion in a couple diffferent ways: </span>
<span id="cb54-132"><a href="#cb54-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-133"><a href="#cb54-133" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Frequentist/classical proportion tests with null hypothesis significance testing, and</span>
<span id="cb54-134"><a href="#cb54-134" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Bayesian proportion tests and inference based on regions of practical equivalence, or ROPEs</span>
<span id="cb54-135"><a href="#cb54-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-136"><a href="#cb54-136" aria-hidden="true" tabindex="-1"></a>Before getting started, let's load all the packages we need and create some helpful functions and variables.</span>
<span id="cb54-137"><a href="#cb54-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-138"><a href="#cb54-138" aria-hidden="true" tabindex="-1"></a>The experimental survey data here comes from @ChaudhryDotsonHeiss:2024. Since we haven't published it yet (though it's close—it's under review post R&amp;R now!), the original data isn't quite public yet. So I used <span class="co">[</span><span class="ot">the {synthpop} R package</span><span class="co">](https://synthpop.org.uk/get-started.html)</span> to create a synthetic version of part of our data that has the same relationships and distributions as the real results, but is all fake. You can see <span class="co">[</span><span class="ot">the R code I used for that process here</span><span class="co">](https://github.com/andrewheiss/ath-quarto/blob/main/blog/2025/01/27/ipums-cps-proportions-bayes/make_synthetic_data.R)</span>.</span>
<span id="cb54-139"><a href="#cb54-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-140"><a href="#cb54-140" aria-hidden="true" tabindex="-1"></a>If you want to follow along, you can download this synthetic data here:</span>
<span id="cb54-141"><a href="#cb54-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-142"><a href="#cb54-142" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">{{&lt; fa brands r-project &gt;}}&amp;ensp;`synthetic_data.rds`</span><span class="co">](synthetic_data.rds)</span>: RDS version with all the variable attributes (i.e. factor levels and ordering) included</span>
<span id="cb54-143"><a href="#cb54-143" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">{{&lt; fa file-csv &gt;}}&amp;ensp;`synthetic_data.csv`</span><span class="co">](synthetic_data.csv)</span>: Plain-text version (but without variable attributes)</span>
<span id="cb54-144"><a href="#cb54-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-145"><a href="#cb54-145" aria-hidden="true" tabindex="-1"></a>To reflect the fact that this is all public, government-created data, I'm using the <span class="co">[</span><span class="ot">Public Sans font</span><span class="co">](https://public-sans.digital.gov/)</span>, an open source font developed as part of the General Services Administration's <span class="co">[</span><span class="ot">USWDS</span><span class="co">](https://designsystem.digital.gov/)</span> (US Web Design System) for making accessible federal government websites. I'm also using the <span class="co">[</span><span class="ot">USWDS's basic color palette</span><span class="co">](https://designsystem.digital.gov/utilities/color/#basic-palette-2)</span>, developed by <span class="co">[</span><span class="ot">18F</span><span class="co">](https://18f.gsa.gov/2020/04/21/a-token-of-our-affection-uswds-2/)</span>.</span>
<span id="cb54-146"><a href="#cb54-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-147"><a href="#cb54-147" aria-hidden="true" tabindex="-1"></a>Let's get started!</span>
<span id="cb54-148"><a href="#cb54-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-151"><a href="#cb54-151" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-152"><a href="#cb54-152" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-packages-data</span></span>
<span id="cb54-153"><a href="#cb54-153" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb54-154"><a href="#cb54-154" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb54-155"><a href="#cb54-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-156"><a href="#cb54-156" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)   <span class="co"># {ggplot2}, {dplyr}, and friends</span></span>
<span id="cb54-157"><a href="#cb54-157" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tinytable)   <span class="co"># Nice tables</span></span>
<span id="cb54-158"><a href="#cb54-158" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)        <span class="co"># Best way to run Stan models</span></span>
<span id="cb54-159"><a href="#cb54-159" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)   <span class="co"># Manipulate Stan objects and draws</span></span>
<span id="cb54-160"><a href="#cb54-160" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)       <span class="co"># Convert model objects to data frames</span></span>
<span id="cb54-161"><a href="#cb54-161" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)        <span class="co"># Easier string construction</span></span>
<span id="cb54-162"><a href="#cb54-162" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)      <span class="co"># Nicer labels</span></span>
<span id="cb54-163"><a href="#cb54-163" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdist)      <span class="co"># Plot posterior distributions</span></span>
<span id="cb54-164"><a href="#cb54-164" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggforce)     <span class="co"># Extra ggplot things like facet_col()</span></span>
<span id="cb54-165"><a href="#cb54-165" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)   <span class="co"># Combine ggplot plots</span></span>
<span id="cb54-166"><a href="#cb54-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-167"><a href="#cb54-167" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the synthetic survey results</span></span>
<span id="cb54-168"><a href="#cb54-168" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"synthetic_data.rds"</span>)</span>
<span id="cb54-169"><a href="#cb54-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-170"><a href="#cb54-170" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the cmdstanr backend for brms because it's faster and more modern than the</span></span>
<span id="cb54-171"><a href="#cb54-171" aria-hidden="true" tabindex="-1"></a><span class="co"># default rstan backend. You need to install the cmdstanr package first</span></span>
<span id="cb54-172"><a href="#cb54-172" aria-hidden="true" tabindex="-1"></a><span class="co"># (https://mc-stan.org/cmdstanr/) and then run cmdstanr::install_cmdstan() to</span></span>
<span id="cb54-173"><a href="#cb54-173" aria-hidden="true" tabindex="-1"></a><span class="co"># install cmdstan on your computer.</span></span>
<span id="cb54-174"><a href="#cb54-174" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(</span>
<span id="cb54-175"><a href="#cb54-175" aria-hidden="true" tabindex="-1"></a>  <span class="at">mc.cores =</span> <span class="dv">4</span>,</span>
<span id="cb54-176"><a href="#cb54-176" aria-hidden="true" tabindex="-1"></a>  <span class="at">brms.backend =</span> <span class="st">"cmdstanr"</span></span>
<span id="cb54-177"><a href="#cb54-177" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-178"><a href="#cb54-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-179"><a href="#cb54-179" aria-hidden="true" tabindex="-1"></a><span class="co"># Set some global Stan options</span></span>
<span id="cb54-180"><a href="#cb54-180" aria-hidden="true" tabindex="-1"></a>CHAINS <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb54-181"><a href="#cb54-181" aria-hidden="true" tabindex="-1"></a>ITER <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb54-182"><a href="#cb54-182" aria-hidden="true" tabindex="-1"></a>WARMUP <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb54-183"><a href="#cb54-183" aria-hidden="true" tabindex="-1"></a>BAYES_SEED <span class="ot">&lt;-</span> <span class="dv">1234</span></span>
<span id="cb54-184"><a href="#cb54-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-185"><a href="#cb54-185" aria-hidden="true" tabindex="-1"></a><span class="co"># Nice ggplot theme</span></span>
<span id="cb54-186"><a href="#cb54-186" aria-hidden="true" tabindex="-1"></a>theme_public <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb54-187"><a href="#cb54-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_family =</span> <span class="st">"Public Sans"</span>) <span class="sc">+</span></span>
<span id="cb54-188"><a href="#cb54-188" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb54-189"><a href="#cb54-189" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb54-190"><a href="#cb54-190" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Public Sans"</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.25</span>)),</span>
<span id="cb54-191"><a href="#cb54-191" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Public Sans Light"</span>, <span class="at">face =</span> <span class="st">"plain"</span>),</span>
<span id="cb54-192"><a href="#cb54-192" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Public Sans Light"</span>, <span class="at">face =</span> <span class="st">"plain"</span>),</span>
<span id="cb54-193"><a href="#cb54-193" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Public Sans Semibold"</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.8</span>)),</span>
<span id="cb54-194"><a href="#cb54-194" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb54-195"><a href="#cb54-195" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb54-196"><a href="#cb54-196" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(</span>
<span id="cb54-197"><a href="#cb54-197" aria-hidden="true" tabindex="-1"></a>        <span class="at">family =</span> <span class="st">"Public Sans Semibold"</span>, <span class="at">face =</span> <span class="st">"plain"</span>,</span>
<span id="cb54-198"><a href="#cb54-198" aria-hidden="true" tabindex="-1"></a>        <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.8</span>), <span class="at">hjust =</span> <span class="dv">0</span></span>
<span id="cb54-199"><a href="#cb54-199" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb54-200"><a href="#cb54-200" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb54-201"><a href="#cb54-201" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Public Sans Semibold"</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.8</span>)),</span>
<span id="cb54-202"><a href="#cb54-202" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.8</span>)),</span>
<span id="cb54-203"><a href="#cb54-203" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb54-204"><a href="#cb54-204" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.justification =</span> <span class="st">"left"</span>,</span>
<span id="cb54-205"><a href="#cb54-205" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title.position =</span> <span class="st">"top"</span>,</span>
<span id="cb54-206"><a href="#cb54-206" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="at">l =</span> <span class="dv">0</span>, <span class="at">t =</span> <span class="dv">0</span>)</span>
<span id="cb54-207"><a href="#cb54-207" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb54-208"><a href="#cb54-208" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-209"><a href="#cb54-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-210"><a href="#cb54-210" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_public</span>())</span>
<span id="cb54-211"><a href="#cb54-211" aria-hidden="true" tabindex="-1"></a><span class="fu">update_geom_defaults</span>(<span class="st">"text"</span>, <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"Public Sans"</span>))</span>
<span id="cb54-212"><a href="#cb54-212" aria-hidden="true" tabindex="-1"></a><span class="fu">update_geom_defaults</span>(<span class="st">"label"</span>, <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"Public Sans"</span>))</span>
<span id="cb54-213"><a href="#cb54-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-214"><a href="#cb54-214" aria-hidden="true" tabindex="-1"></a><span class="co"># USWDS basic palette</span></span>
<span id="cb54-215"><a href="#cb54-215" aria-hidden="true" tabindex="-1"></a><span class="co"># https://designsystem.digital.gov/utilities/color/#basic-palette-2</span></span>
<span id="cb54-216"><a href="#cb54-216" aria-hidden="true" tabindex="-1"></a>clrs <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb54-217"><a href="#cb54-217" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#e52207"</span>, <span class="co"># .bg-red</span></span>
<span id="cb54-218"><a href="#cb54-218" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#e66f0e"</span>, <span class="co"># .bg-orange</span></span>
<span id="cb54-219"><a href="#cb54-219" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#ffbe2e"</span>, <span class="co"># .bg-gold</span></span>
<span id="cb54-220"><a href="#cb54-220" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#fee685"</span>, <span class="co"># .bg-yellow</span></span>
<span id="cb54-221"><a href="#cb54-221" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#538200"</span>, <span class="co"># .bg-green</span></span>
<span id="cb54-222"><a href="#cb54-222" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#04c585"</span>, <span class="co"># .bg-mint</span></span>
<span id="cb54-223"><a href="#cb54-223" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#009ec1"</span>, <span class="co"># .bg-cyan</span></span>
<span id="cb54-224"><a href="#cb54-224" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#0076d6"</span>, <span class="co"># .bg-blue</span></span>
<span id="cb54-225"><a href="#cb54-225" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#676cc8"</span>, <span class="co"># .bg-indigo</span></span>
<span id="cb54-226"><a href="#cb54-226" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#8168b3"</span>, <span class="co"># .bg-violet</span></span>
<span id="cb54-227"><a href="#cb54-227" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#d72d79"</span> <span class="co"># .bg-magenta</span></span>
<span id="cb54-228"><a href="#cb54-228" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-229"><a href="#cb54-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-230"><a href="#cb54-230" aria-hidden="true" tabindex="-1"></a><span class="co"># Some functions for creating percentage point labels</span></span>
<span id="cb54-231"><a href="#cb54-231" aria-hidden="true" tabindex="-1"></a>label_pp <span class="ot">&lt;-</span> <span class="fu">label_number</span>(</span>
<span id="cb54-232"><a href="#cb54-232" aria-hidden="true" tabindex="-1"></a>  <span class="at">accuracy =</span> <span class="dv">1</span>, <span class="at">scale =</span> <span class="dv">100</span>, <span class="at">suffix =</span> <span class="st">" pp."</span>, <span class="at">style_negative =</span> <span class="st">"minus"</span></span>
<span id="cb54-233"><a href="#cb54-233" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-234"><a href="#cb54-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-235"><a href="#cb54-235" aria-hidden="true" tabindex="-1"></a>label_pp_01 <span class="ot">&lt;-</span> <span class="fu">label_number</span>(</span>
<span id="cb54-236"><a href="#cb54-236" aria-hidden="true" tabindex="-1"></a>  <span class="at">accuracy =</span> <span class="fl">0.1</span>, <span class="at">scale =</span> <span class="dv">100</span>, <span class="at">suffix =</span> <span class="st">" pp."</span>, <span class="at">style_negative =</span> <span class="st">"minus"</span></span>
<span id="cb54-237"><a href="#cb54-237" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-238"><a href="#cb54-238" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-239"><a href="#cb54-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-240"><a href="#cb54-240" aria-hidden="true" tabindex="-1"></a><span class="fu"># Getting CPS data from the IPUMS website</span></span>
<span id="cb54-241"><a href="#cb54-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-242"><a href="#cb54-242" aria-hidden="true" tabindex="-1"></a>Go to the <span class="co">[</span><span class="ot">IPUMS CPS website</span><span class="co">](https://cps.ipums.org/cps/)</span> and create an account if you don't already have one.</span>
<span id="cb54-243"><a href="#cb54-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-244"><a href="#cb54-244" aria-hidden="true" tabindex="-1"></a>Once you're logged in, go the <span class="co">[</span><span class="ot">"Select Data" page</span><span class="co">](https://cps.ipums.org/cps-action/variables/group)</span>, where IPUMS tells you to do two things: </span>
<span id="cb54-245"><a href="#cb54-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-246"><a href="#cb54-246" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Select samples**, or specific verisons of different surveys</span>
<span id="cb54-247"><a href="#cb54-247" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Select variables**, or specific columns in different surveys</span>
<span id="cb54-248"><a href="#cb54-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-249"><a href="#cb54-249" aria-hidden="true" tabindex="-1"></a><span class="al">![Initial data extract page](img/01-data-extract.png)</span>{.lightbox}</span>
<span id="cb54-250"><a href="#cb54-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-251"><a href="#cb54-251" aria-hidden="true" tabindex="-1"></a>Visually it looks like you should select samples first, but **I actually find it easier to poke around for different variables first**, since not all variables are recorded in every sample.</span>
<span id="cb54-252"><a href="#cb54-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-253"><a href="#cb54-253" aria-hidden="true" tabindex="-1"></a><span class="fu">## Finding variables</span></span>
<span id="cb54-254"><a href="#cb54-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-255"><a href="#cb54-255" aria-hidden="true" tabindex="-1"></a>So first let's look at a few variables to get a feel for the IPUMS data extract website. Click on the little "SEARCH 🔍" button in the "SELECT VARIABLES" section. We could do a bunch of fancy advanced search options, but for now, just search for "age"</span>
<span id="cb54-256"><a href="#cb54-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-257"><a href="#cb54-257" aria-hidden="true" tabindex="-1"></a><span class="al">![Searching for age-related variables](img/02-age-search.png)</span>{.lightbox}</span>
<span id="cb54-258"><a href="#cb54-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-259"><a href="#cb54-259" aria-hidden="true" tabindex="-1"></a>There are 200+(!) age-related variables in the CPS data:</span>
<span id="cb54-260"><a href="#cb54-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-261"><a href="#cb54-261" aria-hidden="true" tabindex="-1"></a><span class="al">![Search results related to age](img/02-age-results.png)</span>{.lightbox}</span>
<span id="cb54-262"><a href="#cb54-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-263"><a href="#cb54-263" aria-hidden="true" tabindex="-1"></a>This big list shows some useful information already. The first variable in the search results is <span class="in">`AGE`</span>, and it's the one we care about. It gets recorded in every CPS survey: each monthly one and in the annual ASEC one. Not all the age variables do this—notice that <span class="in">`WHYSS1`</span> only appears in the annual ASEC.</span>
<span id="cb54-264"><a href="#cb54-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-265"><a href="#cb54-265" aria-hidden="true" tabindex="-1"></a>If you click on <span class="in">`AGE`</span> in the "Variable" column, you can see detailed information about the variable, like how it's coded, a description, and its availability. For example, prior to 1976, age was only available in the annual ASEC; starting in January 1976, it became a monthly thing.</span>
<span id="cb54-266"><a href="#cb54-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-267"><a href="#cb54-267" aria-hidden="true" tabindex="-1"></a><span class="al">![AGE availability](img/02-age-availability.png)</span>{.lightbox}</span>
<span id="cb54-268"><a href="#cb54-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-269"><a href="#cb54-269" aria-hidden="true" tabindex="-1"></a>Since we know we want this variable, we can add it to our "Data Cart". IPUMS ues a shopping metaphor for building a data extract—we can add different variables and samples to a cart and then check it out (for free) once we've found everything we're looking for. </span>
<span id="cb54-270"><a href="#cb54-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-271"><a href="#cb54-271" aria-hidden="true" tabindex="-1"></a>Click on "Add to cart" to add it, then go back to the search page to look for more variables. You can also add variables to the cart without going to the variable details page—there's a plus sign in the search results page next to each result that will add the variable for you.</span>
<span id="cb54-272"><a href="#cb54-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-273"><a href="#cb54-273" aria-hidden="true" tabindex="-1"></a><span class="al">![Add AGE to cart](img/02-age-add-cart.png)</span>{.lightbox}</span>
<span id="cb54-274"><a href="#cb54-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-275"><a href="#cb54-275" aria-hidden="true" tabindex="-1"></a>Now that we have age, we need to hunt around for other variables we care about, like sex, marital status, voting history, and so on. To speed things up, you can search for their official variable names and add each one to the cart:</span>
<span id="cb54-276"><a href="#cb54-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-277"><a href="#cb54-277" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Sex = <span class="in">`SEX`</span></span>
<span id="cb54-278"><a href="#cb54-278" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Marital status = <span class="in">`MARST`</span></span>
<span id="cb54-279"><a href="#cb54-279" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Education = <span class="in">`EDUC`</span></span>
<span id="cb54-280"><a href="#cb54-280" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Donating = <span class="in">`VLDONATE`</span></span>
<span id="cb54-281"><a href="#cb54-281" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Volunteering = <span class="in">`VLSTATUS`</span></span>
<span id="cb54-282"><a href="#cb54-282" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Volunteering Supplement weight = <span class="in">`VLSUPPWT`</span></span>
<span id="cb54-283"><a href="#cb54-283" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Voting = <span class="in">`VOTED`</span></span>
<span id="cb54-284"><a href="#cb54-284" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Voter Supplement weight = <span class="in">`VOSUPPWT`</span></span>
<span id="cb54-285"><a href="#cb54-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-286"><a href="#cb54-286" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pay attention to the details!</span></span>
<span id="cb54-287"><a href="#cb54-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-288"><a href="#cb54-288" aria-hidden="true" tabindex="-1"></a>Looking at the details for these variables is helpful since they're all categorical variables, unlike age. For instance, marital status has 9 different levels:</span>
<span id="cb54-289"><a href="#cb54-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-290"><a href="#cb54-290" aria-hidden="true" tabindex="-1"></a><span class="al">![Nine different marital status (MARST) codes](img/03-marst-codes.png)</span>{.lightbox}</span>
<span id="cb54-291"><a href="#cb54-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-292"><a href="#cb54-292" aria-hidden="true" tabindex="-1"></a>Also, it's important to check the variable details to check for availability. While basic demographic variables like age, sex, marital status, etc. are available in both the monthly surveys and in the annual ASEC, more specialized variables are not.</span>
<span id="cb54-293"><a href="#cb54-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-294"><a href="#cb54-294" aria-hidden="true" tabindex="-1"></a>Variables related to philanthropy and volunteering are only available in September (since they're part of a <span class="co">[</span><span class="ot">special CPS Volunteer Supplement</span><span class="co">](https://cps.ipums.org/cps/volunteer_sample_notes.shtml)</span>), and only in some years:</span>
<span id="cb54-295"><a href="#cb54-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-296"><a href="#cb54-296" aria-hidden="true" tabindex="-1"></a><span class="al">![Volunteer status (VLSTATUS) only available in September, and only in some years](img/03-vlstatus-availability.png)</span>{.lightbox}</span>
<span id="cb54-297"><a href="#cb54-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-298"><a href="#cb54-298" aria-hidden="true" tabindex="-1"></a>Variables related to voting are only available in November in even-numbered years (since they're part the <span class="co">[</span><span class="ot">CPS's Voting and Registration Supplement</span><span class="co">](https://cps.ipums.org/cps/voter_sample_notes.shtml)</span>)</span>
<span id="cb54-299"><a href="#cb54-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-300"><a href="#cb54-300" aria-hidden="true" tabindex="-1"></a><span class="al">![Voting status (VOTED) only available in even-numbered years in November](img/03-voted-availability.png)</span>{.lightbox}</span>
<span id="cb54-301"><a href="#cb54-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-302"><a href="#cb54-302" aria-hidden="true" tabindex="-1"></a><span class="fu">## Selecting samples</span></span>
<span id="cb54-303"><a href="#cb54-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-304"><a href="#cb54-304" aria-hidden="true" tabindex="-1"></a>Great! If you check the cart, you'll see all the variables we added at the bottom, along with a bunch of other pre-selected columns:</span>
<span id="cb54-305"><a href="#cb54-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-306"><a href="#cb54-306" aria-hidden="true" tabindex="-1"></a><span class="al">![All variables added to the cart, but no samples are selected](img/04-cart-no-samples.png)</span>{.lightbox}</span>
<span id="cb54-307"><a href="#cb54-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-308"><a href="#cb54-308" aria-hidden="true" tabindex="-1"></a>We can't download any data yet, though. We've selected the variables—now we need to select the samples. Go back to the "Select data" page and click on "Select samples" (or click on the "Add more samples" button at the top of the data cart page).</span>
<span id="cb54-309"><a href="#cb54-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-310"><a href="#cb54-310" aria-hidden="true" tabindex="-1"></a>By default, IPUMS will have a bunch of different samples pre-checked. In my case, it grabbed all annual ASEC surveys from 2010–2024, and all monthly surveys from 2021–2024.</span>
<span id="cb54-311"><a href="#cb54-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-312"><a href="#cb54-312" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb54-313"><a href="#cb54-313" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pre-selected ASEC samples</span></span>
<span id="cb54-314"><a href="#cb54-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-315"><a href="#cb54-315" aria-hidden="true" tabindex="-1"></a><span class="al">![Pre-selected ASEC samples](img/05-default-samples-1.png)</span>{.lightbox}</span>
<span id="cb54-316"><a href="#cb54-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-317"><a href="#cb54-317" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pre-selected monthly samples</span></span>
<span id="cb54-318"><a href="#cb54-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-319"><a href="#cb54-319" aria-hidden="true" tabindex="-1"></a><span class="al">![Pre-selected monthly samples](img/05-default-samples-2.png)</span>{.lightbox}</span>
<span id="cb54-320"><a href="#cb54-320" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb54-321"><a href="#cb54-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-322"><a href="#cb54-322" aria-hidden="true" tabindex="-1"></a>Including all these samples would be useful if we were doing some sort of analysis of CPS trends over time, comparing changes in age or education or volunteering or whatever. But that doesn't matter here—all we want to know is what age (and everything else) looked like at the time the survey was administered. That means we really just need one year.</span>
<span id="cb54-323"><a href="#cb54-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-324"><a href="#cb54-324" aria-hidden="true" tabindex="-1"></a>However, we can't just choose one sample. Things like demographics are availble in all annual and monthly samples, but volunteering is only available in September in specific years, and voting is only available in November in specific years.</span>
<span id="cb54-325"><a href="#cb54-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-326"><a href="#cb54-326" aria-hidden="true" tabindex="-1"></a>This survey was administered in mid-2019, so we'll choose samples that are as close to that as possible. Though demographics are available both monthly and annually, I like to use the annual versions because ASEC data is typically used to stand in for annual information—like if you were building a state-year panel dataset, you'd use ASEC data for each year. The ASEC occurs in March and actually overlaps with the monthly March data (<span class="co">[</span><span class="ot">IPUMS has a note about that</span><span class="co">](https://cps.ipums.org/cps/basic_asec.shtml)</span>), so the data *technically* is for March 2019, but whatever. We don't have to be super precise here.</span>
<span id="cb54-327"><a href="#cb54-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-328"><a href="#cb54-328" aria-hidden="true" tabindex="-1"></a>We'll use the September 2019 sample for volunteering, even though that's after the survey was administered. The next earliest volunteering data is the September 2017 sample, which is like 2 years before the survey. Things don't line up precisely, but again, that's fine.</span>
<span id="cb54-329"><a href="#cb54-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-330"><a href="#cb54-330" aria-hidden="true" tabindex="-1"></a>Finally, we'll use the November 2018 sample for voting. That's before the survey, but it's the closest we can get—the next alternative is November 2020, which is a year after the survey. Once again, nothing lines up exactly, but it's fine.</span>
<span id="cb54-331"><a href="#cb54-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-332"><a href="#cb54-332" aria-hidden="true" tabindex="-1"></a>In summary, here are the variables we want and the samples we'll get them from:</span>
<span id="cb54-333"><a href="#cb54-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-334"><a href="#cb54-334" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Age (<span class="in">`AGE`</span>): 2019 ASEC</span>
<span id="cb54-335"><a href="#cb54-335" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Sex (<span class="in">`SEX`</span>): 2019 ASEC</span>
<span id="cb54-336"><a href="#cb54-336" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Marital status (<span class="in">`MARST`</span>): 2019 ASEC</span>
<span id="cb54-337"><a href="#cb54-337" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Education (<span class="in">`EDUC`</span>): 2019 ASEC</span>
<span id="cb54-338"><a href="#cb54-338" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Donating (<span class="in">`VLDONATE`</span>): 2019-09 Monthly</span>
<span id="cb54-339"><a href="#cb54-339" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Volunteering (<span class="in">`VLSTATUS`</span>): 2019-09 Monthly</span>
<span id="cb54-340"><a href="#cb54-340" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Volunteering Supplement weight (<span class="in">`VLSUPPWT`</span>): 2019-09 Monthly</span>
<span id="cb54-341"><a href="#cb54-341" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Voting (<span class="in">`VOTED`</span>): 2018-11 Monthly</span>
<span id="cb54-342"><a href="#cb54-342" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Voter Supplement weight (<span class="in">`VOSUPPWT`</span>): 2018-11 Monthly</span>
<span id="cb54-343"><a href="#cb54-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-344"><a href="#cb54-344" aria-hidden="true" tabindex="-1"></a>Select those three samples (2019 ASEC, September 2019, and November 2018) and click on "Submit sample selections" to add them to the cart.</span>
<span id="cb54-345"><a href="#cb54-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-346"><a href="#cb54-346" aria-hidden="true" tabindex="-1"></a>::: {.panel-tabset}</span>
<span id="cb54-347"><a href="#cb54-347" aria-hidden="true" tabindex="-1"></a><span class="fu">### Specific ASEC sample</span></span>
<span id="cb54-348"><a href="#cb54-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-349"><a href="#cb54-349" aria-hidden="true" tabindex="-1"></a><span class="al">![March 2019 ASEC sample](img/05-asec-real.png)</span>{.lightbox}</span>
<span id="cb54-350"><a href="#cb54-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-351"><a href="#cb54-351" aria-hidden="true" tabindex="-1"></a><span class="fu">### Specific monthly samples</span></span>
<span id="cb54-352"><a href="#cb54-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-353"><a href="#cb54-353" aria-hidden="true" tabindex="-1"></a><span class="al">![September 2019 and November 2018 monthly samples](img/05-monthly-real.png)</span>{.lightbox}</span>
<span id="cb54-354"><a href="#cb54-354" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb54-355"><a href="#cb54-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-356"><a href="#cb54-356" aria-hidden="true" tabindex="-1"></a>The cart should now have 9 variables and 3 samples. Conveniently, it has a little summary table showing which samples have which variables, where we can confirm that age, sex, marital status, and education are in all three, volunteering and donating are only in September 2019, and voting is only in November 2018.</span>
<span id="cb54-357"><a href="#cb54-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-358"><a href="#cb54-358" aria-hidden="true" tabindex="-1"></a><span class="al">![All variables and samples selected and ready to go](img/05-everything-selected.png)</span>{.lightbox}</span>
<span id="cb54-359"><a href="#cb54-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-360"><a href="#cb54-360" aria-hidden="true" tabindex="-1"></a><span class="fu">## Downloading the data</span></span>
<span id="cb54-361"><a href="#cb54-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-362"><a href="#cb54-362" aria-hidden="true" tabindex="-1"></a>Now that we have all the variables and samples we care about in the data cart, we can create a data extract and download this stuff.</span>
<span id="cb54-363"><a href="#cb54-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-364"><a href="#cb54-364" aria-hidden="true" tabindex="-1"></a>Click on the "Create data extract" button at the top of the data cart page, which will take you to the official Extract Request page. There are a bunch of extra options here, and you can optionally add a description to the extract, but we'll ignore all those. Click on the "Submit Abstract" button and wait for the IPUMS server to compile it all.</span>
<span id="cb54-365"><a href="#cb54-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-366"><a href="#cb54-366" aria-hidden="true" tabindex="-1"></a><span class="al">![Extract submission page](img/06-extract-page.png)</span>{.lightbox}</span>
<span id="cb54-367"><a href="#cb54-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-368"><a href="#cb54-368" aria-hidden="true" tabindex="-1"></a>Once it's ready, it'll appear at your "My Data" page, which will have a list of all your past extracts.</span>
<span id="cb54-369"><a href="#cb54-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-370"><a href="#cb54-370" aria-hidden="true" tabindex="-1"></a>To download the data, we actually need to download two things:</span>
<span id="cb54-371"><a href="#cb54-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-372"><a href="#cb54-372" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**The data itself.** Click on the big green "Download .DAT" button.</span>
<span id="cb54-373"><a href="#cb54-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-374"><a href="#cb54-374" aria-hidden="true" tabindex="-1"></a>   <span class="al">![Button for download a `.dat` version of the data](img/07-data-page-download-dat.png)</span>{.lightbox}</span>
<span id="cb54-375"><a href="#cb54-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-376"><a href="#cb54-376" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb54-377"><a href="#cb54-377" aria-hidden="true" tabindex="-1"></a><span class="fu">### `.dat` vs `.dat.gz`</span></span>
<span id="cb54-378"><a href="#cb54-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-379"><a href="#cb54-379" aria-hidden="true" tabindex="-1"></a>Depending on your browser, the downloaded file will either end in <span class="in">`.dat`</span> or <span class="in">`.dat.gz`</span>. If it ends in <span class="in">`.gz`</span>, it'll be compressed and zipped (the compressed version of this extract is 7.6 MB); if it ends in <span class="in">`.dat`</span>, it'll be uncompressed and huge (≈55 MB in this case). Chrome and Firefox will keep the compressed <span class="in">`.gz`</span> version; Safari will automatically unzip it and throw away the <span class="in">`.gz`</span> version, which is annoying.</span>
<span id="cb54-380"><a href="#cb54-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-381"><a href="#cb54-381" aria-hidden="true" tabindex="-1"></a>Try to keep the compressed version. You don't even need to extract/unzip it—the {ipumsr} data loading functions will handle unzipping for you automatically behind the scenes.</span>
<span id="cb54-382"><a href="#cb54-382" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb54-383"><a href="#cb54-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-384"><a href="#cb54-384" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>The machine-readable XML codebook, or **the DDI file**. R uses to clean and relabel the raw data when you load it. If you click on the DDI link in the Codebook column, your browser will likely open a plain text XML file, which isn't really what you want. Instead, right click on the DDI link and choose "Save file as…" or "Download file as…" or whatever your browser calls it. This will let you save the XML file to your computer.</span>
<span id="cb54-385"><a href="#cb54-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-386"><a href="#cb54-386" aria-hidden="true" tabindex="-1"></a>   <span class="al">![Context menu for the DDI codebook link](img/07-data-page-download-ddi.png)</span>{.lightbox width="50%"}</span>
<span id="cb54-387"><a href="#cb54-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-388"><a href="#cb54-388" aria-hidden="true" tabindex="-1"></a>There are some other helpful links there too:</span>
<span id="cb54-389"><a href="#cb54-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-390"><a href="#cb54-390" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If you click on the R link, it'll give you a barebones R script for loading the data. It'll look something like this:</span>
<span id="cb54-391"><a href="#cb54-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-392"><a href="#cb54-392" aria-hidden="true" tabindex="-1"></a>  <span class="in">```{.r}</span></span>
<span id="cb54-393"><a href="#cb54-393" aria-hidden="true" tabindex="-1"></a><span class="in">  # NOTE: To load data, you must download both the extract's data and the DDI</span></span>
<span id="cb54-394"><a href="#cb54-394" aria-hidden="true" tabindex="-1"></a><span class="in">  # and also set the working directory to the folder with these files (or change the path below).</span></span>
<span id="cb54-395"><a href="#cb54-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-396"><a href="#cb54-396" aria-hidden="true" tabindex="-1"></a><span class="in">  if (!require("ipumsr")) stop("Reading IPUMS data into R requires the ipumsr package. It can be installed using the following command: install.packages('ipumsr')")</span></span>
<span id="cb54-397"><a href="#cb54-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-398"><a href="#cb54-398" aria-hidden="true" tabindex="-1"></a><span class="in">  ddi &lt;- read_ipums_ddi("cps_00001.xml")</span></span>
<span id="cb54-399"><a href="#cb54-399" aria-hidden="true" tabindex="-1"></a><span class="in">  data &lt;- read_ipums_micro(ddi)</span></span>
<span id="cb54-400"><a href="#cb54-400" aria-hidden="true" tabindex="-1"></a><span class="in">  ```</span></span>
<span id="cb54-401"><a href="#cb54-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-402"><a href="#cb54-402" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If you click on the basic codebook, you'll get a short plain text version of the codebook, which I find really helpful for remembering which variables show up where and how each variable is coded.</span>
<span id="cb54-403"><a href="#cb54-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-404"><a href="#cb54-404" aria-hidden="true" tabindex="-1"></a>Move the newly downloaded <span class="in">`.dat`</span> and the <span class="in">`.ddi`</span> files to the same folder somewhere on your computer (preferably in an RStudio Project or a Positron project/folder or wherever your R working directory is). I put mine in a folder named <span class="in">`raw_data`</span>; you can put it wherever.</span>
<span id="cb54-405"><a href="#cb54-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-406"><a href="#cb54-406" aria-hidden="true" tabindex="-1"></a>We're finally ready to load this CPS data into R!</span>
<span id="cb54-407"><a href="#cb54-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-408"><a href="#cb54-408" aria-hidden="true" tabindex="-1"></a><span class="fu"># More reproducible alternative: using the IPUMS API</span></span>
<span id="cb54-409"><a href="#cb54-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-410"><a href="#cb54-410" aria-hidden="true" tabindex="-1"></a>Alternatively, it's possible to use the {ipumsr} package to access the IPUMS API directly and not need to manually download the data extract from the IPUMS website.</span>
<span id="cb54-411"><a href="#cb54-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-412"><a href="#cb54-412" aria-hidden="true" tabindex="-1"></a>The {ipumsr} API functions essentially let you programmatically create and download a data extract cart. Unless you know the IPUMS CPS data *really well*, **you'll still likely need to hunt around the website for specific variables and their availabilities**, so the whole previous section is still relevant.</span>
<span id="cb54-413"><a href="#cb54-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-414"><a href="#cb54-414" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">The {ipumsr} vignette for working with the API</span><span class="co">](https://tech.popdata.org/ipumsr/articles/ipums-api.html)</span> is nice and complete—see that for full details. </span>
<span id="cb54-415"><a href="#cb54-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-416"><a href="#cb54-416" aria-hidden="true" tabindex="-1"></a>Here's an abbreviated example of how to get the same data extract we collected manually from the website:</span>
<span id="cb54-417"><a href="#cb54-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-418"><a href="#cb54-418" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Go to your IPUMS dashboard and <span class="co">[</span><span class="ot">create an API key</span><span class="co">](https://account.ipums.org/api_keys)</span>. This needs to be stored as an environment variable named <span class="in">`IPUMS_API_KEY`</span>. You can manually add this to your <span class="in">`.Renviron`</span> file, or you can run this to make {ipumsr} do it for you:</span>
<span id="cb54-419"><a href="#cb54-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-420"><a href="#cb54-420" aria-hidden="true" tabindex="-1"></a>   <span class="in">```{.r}</span></span>
<span id="cb54-421"><a href="#cb54-421" aria-hidden="true" tabindex="-1"></a><span class="in">   ipumsr::set_ipums_api_key("BLAH", save = TRUE)</span></span>
<span id="cb54-422"><a href="#cb54-422" aria-hidden="true" tabindex="-1"></a><span class="in">   ```</span></span>
<span id="cb54-423"><a href="#cb54-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-424"><a href="#cb54-424" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Build a data extract with <span class="in">`define_extract_micro()`</span>. This is the equivalent of adding stuff to your data cart on the IPUMS website. You'll need to know two things:</span>
<span id="cb54-425"><a href="#cb54-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-426"><a href="#cb54-426" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>The variable names, which you can find by searching the IPUMS website</span>
<span id="cb54-427"><a href="#cb54-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-428"><a href="#cb54-428" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>The sample IDs, which you can find by running <span class="in">`get_sample_info()`</span>:</span>
<span id="cb54-429"><a href="#cb54-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-430"><a href="#cb54-430" aria-hidden="true" tabindex="-1"></a>     <span class="in">```{.r}</span></span>
<span id="cb54-431"><a href="#cb54-431" aria-hidden="true" tabindex="-1"></a><span class="in">     library(tidyverse)</span></span>
<span id="cb54-432"><a href="#cb54-432" aria-hidden="true" tabindex="-1"></a><span class="in">     library(ipumsr)</span></span>
<span id="cb54-433"><a href="#cb54-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-434"><a href="#cb54-434" aria-hidden="true" tabindex="-1"></a><span class="in">     all_cps_samples &lt;- get_sample_info(collection = "cps")</span></span>
<span id="cb54-435"><a href="#cb54-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-436"><a href="#cb54-436" aria-hidden="true" tabindex="-1"></a><span class="in">     # Find the names for 2019 samples</span></span>
<span id="cb54-437"><a href="#cb54-437" aria-hidden="true" tabindex="-1"></a><span class="in">     all_cps_samples |&gt; </span></span>
<span id="cb54-438"><a href="#cb54-438" aria-hidden="true" tabindex="-1"></a><span class="in">       filter(str_detect(description, "2019"))</span></span>
<span id="cb54-439"><a href="#cb54-439" aria-hidden="true" tabindex="-1"></a><span class="in">     #&gt; # A tibble: 13 × 2</span></span>
<span id="cb54-440"><a href="#cb54-440" aria-hidden="true" tabindex="-1"></a><span class="in">     #&gt;    name        description              </span></span>
<span id="cb54-441"><a href="#cb54-441" aria-hidden="true" tabindex="-1"></a><span class="in">     #&gt;    &lt;chr&gt;       &lt;chr&gt;                    </span></span>
<span id="cb54-442"><a href="#cb54-442" aria-hidden="true" tabindex="-1"></a><span class="in">     #&gt;  1 cps2019_01s IPUMS-CPS, January 2019  </span></span>
<span id="cb54-443"><a href="#cb54-443" aria-hidden="true" tabindex="-1"></a><span class="in">     #&gt;  2 cps2019_02s IPUMS-CPS, February 2019 </span></span>
<span id="cb54-444"><a href="#cb54-444" aria-hidden="true" tabindex="-1"></a><span class="in">     #&gt;  3 cps2019_03b IPUMS-CPS, March 2019    </span></span>
<span id="cb54-445"><a href="#cb54-445" aria-hidden="true" tabindex="-1"></a><span class="in">     #&gt;  4 cps2019_04b IPUMS-CPS, April 2019    </span></span>
<span id="cb54-446"><a href="#cb54-446" aria-hidden="true" tabindex="-1"></a><span class="in">     #&gt;  5 cps2019_05s IPUMS-CPS, May 2019      </span></span>
<span id="cb54-447"><a href="#cb54-447" aria-hidden="true" tabindex="-1"></a><span class="in">     #&gt;  6 cps2019_06s IPUMS-CPS, June 2019     </span></span>
<span id="cb54-448"><a href="#cb54-448" aria-hidden="true" tabindex="-1"></a><span class="in">     #&gt;  7 cps2019_03s IPUMS-CPS, ASEC 2019  </span></span>
<span id="cb54-449"><a href="#cb54-449" aria-hidden="true" tabindex="-1"></a><span class="in">     #&gt;  ...</span></span>
<span id="cb54-450"><a href="#cb54-450" aria-hidden="true" tabindex="-1"></a><span class="in">     ```</span></span>
<span id="cb54-451"><a href="#cb54-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-452"><a href="#cb54-452" aria-hidden="true" tabindex="-1"></a>   The code for creating the extract will look like this:</span>
<span id="cb54-453"><a href="#cb54-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-454"><a href="#cb54-454" aria-hidden="true" tabindex="-1"></a>   <span class="in">```{.r}</span></span>
<span id="cb54-455"><a href="#cb54-455" aria-hidden="true" tabindex="-1"></a><span class="in">   cps_extract_definition &lt;- define_extract_micro(</span></span>
<span id="cb54-456"><a href="#cb54-456" aria-hidden="true" tabindex="-1"></a><span class="in">     collection = "cps",</span></span>
<span id="cb54-457"><a href="#cb54-457" aria-hidden="true" tabindex="-1"></a><span class="in">     description = "API extract for blog post",</span></span>
<span id="cb54-458"><a href="#cb54-458" aria-hidden="true" tabindex="-1"></a><span class="in">     samples = c(</span></span>
<span id="cb54-459"><a href="#cb54-459" aria-hidden="true" tabindex="-1"></a><span class="in">       "cps2019_03s",  # ASEC, March 2019</span></span>
<span id="cb54-460"><a href="#cb54-460" aria-hidden="true" tabindex="-1"></a><span class="in">       "cps2019_09s",  # CPS, September 2019</span></span>
<span id="cb54-461"><a href="#cb54-461" aria-hidden="true" tabindex="-1"></a><span class="in">       "cps2018_11s"   # CPS, November 2018</span></span>
<span id="cb54-462"><a href="#cb54-462" aria-hidden="true" tabindex="-1"></a><span class="in">     ),</span></span>
<span id="cb54-463"><a href="#cb54-463" aria-hidden="true" tabindex="-1"></a><span class="in">     variables = c(</span></span>
<span id="cb54-464"><a href="#cb54-464" aria-hidden="true" tabindex="-1"></a><span class="in">       "AGE", "SEX", "MARST", "EDUC",</span></span>
<span id="cb54-465"><a href="#cb54-465" aria-hidden="true" tabindex="-1"></a><span class="in">       "VLDONATE", "VLSTATUS", "VLSUPPWT",</span></span>
<span id="cb54-466"><a href="#cb54-466" aria-hidden="true" tabindex="-1"></a><span class="in">       "VOTED", "VOSUPPWT"</span></span>
<span id="cb54-467"><a href="#cb54-467" aria-hidden="true" tabindex="-1"></a><span class="in">     )</span></span>
<span id="cb54-468"><a href="#cb54-468" aria-hidden="true" tabindex="-1"></a><span class="in">   )</span></span>
<span id="cb54-469"><a href="#cb54-469" aria-hidden="true" tabindex="-1"></a><span class="in">   ```</span></span>
<span id="cb54-470"><a href="#cb54-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-471"><a href="#cb54-471" aria-hidden="true" tabindex="-1"></a>   This is identical to what we had in the cart on the the website: 9 variables and 3 samples:</span>
<span id="cb54-472"><a href="#cb54-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-473"><a href="#cb54-473" aria-hidden="true" tabindex="-1"></a>   <span class="in">```{.r}</span></span>
<span id="cb54-474"><a href="#cb54-474" aria-hidden="true" tabindex="-1"></a><span class="in">   cps_extract_definition</span></span>
<span id="cb54-475"><a href="#cb54-475" aria-hidden="true" tabindex="-1"></a><span class="in">   #&gt; Unsubmitted IPUMS CPS extract </span></span>
<span id="cb54-476"><a href="#cb54-476" aria-hidden="true" tabindex="-1"></a><span class="in">   #&gt; Description: API extract for blog post</span></span>
<span id="cb54-477"><a href="#cb54-477" aria-hidden="true" tabindex="-1"></a><span class="in">   #&gt; </span></span>
<span id="cb54-478"><a href="#cb54-478" aria-hidden="true" tabindex="-1"></a><span class="in">   #&gt; Samples: (3 total) cps2019_03s, cps2019_09s, cps2018_11s</span></span>
<span id="cb54-479"><a href="#cb54-479" aria-hidden="true" tabindex="-1"></a><span class="in">   #&gt; Variables: (9 total) AGE, SEX, MARST, EDUC, VLDONATE, VLSTATUS, VLSU...</span></span>
<span id="cb54-480"><a href="#cb54-480" aria-hidden="true" tabindex="-1"></a><span class="in">   ```</span></span>
<span id="cb54-481"><a href="#cb54-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-482"><a href="#cb54-482" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Submit the request to the server to generate the extract. This is equivalent to checking out your data cart on the website.</span>
<span id="cb54-483"><a href="#cb54-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-484"><a href="#cb54-484" aria-hidden="true" tabindex="-1"></a>   <span class="in">```{.r}</span></span>
<span id="cb54-485"><a href="#cb54-485" aria-hidden="true" tabindex="-1"></a><span class="in">   cps_extract &lt;- submit_extract(cps_extract_definition)</span></span>
<span id="cb54-486"><a href="#cb54-486" aria-hidden="true" tabindex="-1"></a><span class="in">   #&gt; Successfully submitted IPUMS CPS extract number ZZZZ</span></span>
<span id="cb54-487"><a href="#cb54-487" aria-hidden="true" tabindex="-1"></a><span class="in">   ```</span></span>
<span id="cb54-488"><a href="#cb54-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-489"><a href="#cb54-489" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Download the extract. The extract won't be downloadable immediately—you need to wait for e-mail confirmation. Once it's ready, you can download it with <span class="in">`download_extract()`</span>, which will download both the <span class="in">`.dat.gz`</span> data and the <span class="in">`.xml`</span> codebook to your computer:</span>
<span id="cb54-490"><a href="#cb54-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-491"><a href="#cb54-491" aria-hidden="true" tabindex="-1"></a>   <span class="in">```{.r}</span></span>
<span id="cb54-492"><a href="#cb54-492" aria-hidden="true" tabindex="-1"></a><span class="in">   cps_downloaded &lt;- download_extract(cps_extract, download_dir = "raw_data")</span></span>
<span id="cb54-493"><a href="#cb54-493" aria-hidden="true" tabindex="-1"></a><span class="in">   #&gt;  |==================================================| 100%</span></span>
<span id="cb54-494"><a href="#cb54-494" aria-hidden="true" tabindex="-1"></a><span class="in">   #&gt;  |==================================================| 100%</span></span>
<span id="cb54-495"><a href="#cb54-495" aria-hidden="true" tabindex="-1"></a><span class="in">   #&gt; DDI codebook file saved to ~/blah/raw_data/cps_ZZZZ.xml</span></span>
<span id="cb54-496"><a href="#cb54-496" aria-hidden="true" tabindex="-1"></a><span class="in">   #&gt; Data file saved to ~/blah/raw_data/cps_ZZZZ.dat.gz</span></span>
<span id="cb54-497"><a href="#cb54-497" aria-hidden="true" tabindex="-1"></a><span class="in">   ```</span></span>
<span id="cb54-498"><a href="#cb54-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-499"><a href="#cb54-499" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Once it's on your computer, you can load it with the standard {ipumsr} process shown in the next section. </span>
<span id="cb54-500"><a href="#cb54-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-501"><a href="#cb54-501" aria-hidden="true" tabindex="-1"></a>   <span class="in">```{.r}</span></span>
<span id="cb54-502"><a href="#cb54-502" aria-hidden="true" tabindex="-1"></a><span class="in">   cps_data &lt;- read_ipums_micro(cps_downloaded)</span></span>
<span id="cb54-503"><a href="#cb54-503" aria-hidden="true" tabindex="-1"></a><span class="in">   ```</span></span>
<span id="cb54-504"><a href="#cb54-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-505"><a href="#cb54-505" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb54-506"><a href="#cb54-506" aria-hidden="true" tabindex="-1"></a><span class="fu">### The IPUMS API and literate programming</span></span>
<span id="cb54-507"><a href="#cb54-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-508"><a href="#cb54-508" aria-hidden="true" tabindex="-1"></a>If you're using a literate programming system like Quarto or R Markdown, **don't include this API extraction process in your document**. It will rerun every time you render your document and create a new IPUMS extract each time, which is excessive. It's best to run this process in a separate R script or function (perhaps orchestrated with something like <span class="co">[</span><span class="ot">{targets}</span><span class="co">](https://books.ropensci.org/targets/)</span>), and then load the DDI <span class="in">`.xml`</span> and <span class="in">`.dat`</span> data in the document.</span>
<span id="cb54-509"><a href="#cb54-509" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb54-510"><a href="#cb54-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-511"><a href="#cb54-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-512"><a href="#cb54-512" aria-hidden="true" tabindex="-1"></a><span class="fu"># Loading CPS data</span></span>
<span id="cb54-513"><a href="#cb54-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-514"><a href="#cb54-514" aria-hidden="true" tabindex="-1"></a>Getting this data into R is easy thanks to <span class="co">[</span><span class="ot">the {ipumsr} package</span><span class="co">](https://tech.popdata.org/ipumsr/)</span>. We feed the XML DDI codebook into <span class="in">`read_ipums_ddi()`</span> and then feed that into <span class="in">`read_ipums_micro()`</span></span>
<span id="cb54-515"><a href="#cb54-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-518"><a href="#cb54-518" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-519"><a href="#cb54-519" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-ipums-data</span></span>
<span id="cb54-520"><a href="#cb54-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-521"><a href="#cb54-521" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ipumsr)</span>
<span id="cb54-522"><a href="#cb54-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-523"><a href="#cb54-523" aria-hidden="true" tabindex="-1"></a>ddi <span class="ot">&lt;-</span> <span class="fu">read_ipums_ddi</span>(<span class="st">"raw_data/cps_00001.xml"</span>)</span>
<span id="cb54-524"><a href="#cb54-524" aria-hidden="true" tabindex="-1"></a>cps_data <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(ddi, <span class="at">data_file =</span> <span class="st">"raw_data/cps_00001.dat.gz"</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb54-525"><a href="#cb54-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-526"><a href="#cb54-526" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(cps_data)</span>
<span id="cb54-527"><a href="#cb54-527" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-528"><a href="#cb54-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-529"><a href="#cb54-529" aria-hidden="true" tabindex="-1"></a>holy moly we have nearly half a million rows. That's because we have three samples (2019 ASEC, September 2019, and November 2018) and they're all stacked on top of each other in this data. We need to filter this huge data to extract the three samples. We'll also remove rows with missing data.</span>
<span id="cb54-530"><a href="#cb54-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-533"><a href="#cb54-533" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-534"><a href="#cb54-534" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: split-cps-data</span></span>
<span id="cb54-535"><a href="#cb54-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-536"><a href="#cb54-536" aria-hidden="true" tabindex="-1"></a>cps_demographics <span class="ot">&lt;-</span> cps_data <span class="sc">|&gt;</span></span>
<span id="cb54-537"><a href="#cb54-537" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Only look at the 2019 ASEC data</span></span>
<span id="cb54-538"><a href="#cb54-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(YEAR <span class="sc">==</span> <span class="dv">2019</span>, MONTH <span class="sc">==</span> <span class="dv">03</span>, ASECFLAG <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb54-539"><a href="#cb54-539" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove rows that are missing or are "not in universe"</span></span>
<span id="cb54-540"><a href="#cb54-540" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb54-541"><a href="#cb54-541" aria-hidden="true" tabindex="-1"></a>    <span class="at">SEX =</span> <span class="fu">ifelse</span>(SEX <span class="sc">==</span> <span class="dv">9</span>, <span class="cn">NA</span>, SEX),</span>
<span id="cb54-542"><a href="#cb54-542" aria-hidden="true" tabindex="-1"></a>    <span class="at">MARST =</span> <span class="fu">ifelse</span>(MARST <span class="sc">==</span> <span class="dv">9</span>, <span class="cn">NA</span>, MARST),</span>
<span id="cb54-543"><a href="#cb54-543" aria-hidden="true" tabindex="-1"></a>    <span class="at">EDUC =</span> <span class="fu">ifelse</span>(EDUC <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">|</span> EDUC <span class="sc">==</span> <span class="dv">999</span>, <span class="cn">NA</span>, EDUC)</span>
<span id="cb54-544"><a href="#cb54-544" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-545"><a href="#cb54-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-546"><a href="#cb54-546" aria-hidden="true" tabindex="-1"></a>cps_volunteer <span class="ot">&lt;-</span> cps_data <span class="sc">|&gt;</span> </span>
<span id="cb54-547"><a href="#cb54-547" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(YEAR <span class="sc">==</span> <span class="dv">2019</span>, MONTH <span class="sc">==</span> <span class="dv">09</span>) <span class="sc">|&gt;</span> </span>
<span id="cb54-548"><a href="#cb54-548" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove rows that are missing or are "not in universe"</span></span>
<span id="cb54-549"><a href="#cb54-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(VLSTATUS, VLDONATE), \(x) <span class="fu">ifelse</span>(x <span class="sc">==</span> <span class="dv">99</span>, <span class="cn">NA</span>, x)))</span>
<span id="cb54-550"><a href="#cb54-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-551"><a href="#cb54-551" aria-hidden="true" tabindex="-1"></a>cps_voting <span class="ot">&lt;-</span> cps_data <span class="sc">|&gt;</span> </span>
<span id="cb54-552"><a href="#cb54-552" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(YEAR <span class="sc">==</span> <span class="dv">2018</span>, MONTH <span class="sc">==</span> <span class="dv">11</span>) <span class="sc">|&gt;</span></span>
<span id="cb54-553"><a href="#cb54-553" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove rows that are missing or are "not in universe"</span></span>
<span id="cb54-554"><a href="#cb54-554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VOTED =</span> <span class="fu">ifelse</span>(VOTED <span class="sc">==</span> <span class="dv">99</span>, <span class="cn">NA</span>, VOTED))</span>
<span id="cb54-555"><a href="#cb54-555" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-556"><a href="#cb54-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-557"><a href="#cb54-557" aria-hidden="true" tabindex="-1"></a>These counts are more reasonable (but still huge!)</span>
<span id="cb54-558"><a href="#cb54-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-561"><a href="#cb54-561" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-562"><a href="#cb54-562" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: check-split-counts</span></span>
<span id="cb54-563"><a href="#cb54-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-564"><a href="#cb54-564" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(cps_demographics)</span>
<span id="cb54-565"><a href="#cb54-565" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(cps_volunteer)</span>
<span id="cb54-566"><a href="#cb54-566" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(cps_voting)</span>
<span id="cb54-567"><a href="#cb54-567" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-568"><a href="#cb54-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-569"><a href="#cb54-569" aria-hidden="true" tabindex="-1"></a><span class="fu"># Summarizing CPS data</span></span>
<span id="cb54-570"><a href="#cb54-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-571"><a href="#cb54-571" aria-hidden="true" tabindex="-1"></a>Ultimately, our goal is to find the population-level average of a bunch of characteristics and see if our sample plausibly matches population averages.</span>
<span id="cb54-572"><a href="#cb54-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-573"><a href="#cb54-573" aria-hidden="true" tabindex="-1"></a>Things get a little tricky and loosey-goosey here. The different levels measured by the CPS don't always match what's in the survey. For example, the CPS measures sex and provides only 2 levels (1 = male; 2 = female); the experiment called this construct gender and included male, female,^<span class="co">[</span><span class="ot">We should have called these "man" and "woman" since gender ≠ sex.</span><span class="co">]</span> transgender, prefer not to say, and other. </span>
<span id="cb54-574"><a href="#cb54-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-575"><a href="#cb54-575" aria-hidden="true" tabindex="-1"></a>To make the survey question reasonably match what the CPS is capturing, I find that it's easiest to collapse both the survey data and the CPS data to simpler constructs. Before we collapse things, though, we need to look at one statistical issue: weighting.</span>
<span id="cb54-576"><a href="#cb54-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-577"><a href="#cb54-577" aria-hidden="true" tabindex="-1"></a><span class="fu">## Weighting</span></span>
<span id="cb54-578"><a href="#cb54-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-579"><a href="#cb54-579" aria-hidden="true" tabindex="-1"></a>In an effort to make the CPS nationally representative, every row is <span class="co">[</span><span class="ot">weighted</span><span class="co">](https://cps.ipums.org/cps-action/faq#7)</span>—<span class="co">[</span><span class="ot">each individual does not represent the same number of persons in the population</span><span class="co">](https://cps.ipums.org/cps-action/faq#ques21)</span>. The Census oversamples some subpopulations and shifts weights up and down to give individuals more or less statistical influence in the sample so that the survey results better approximate the characteristics of the general population. Any analysis we do with CPS data needs to take those weights into account.</span>
<span id="cb54-580"><a href="#cb54-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-581"><a href="#cb54-581" aria-hidden="true" tabindex="-1"></a>The weights for ASEC variables are included in the <span class="in">`ASECWT`</span> column; the weights for volunteering and voting variables are in the <span class="in">`VLSUPPWT`</span> and <span class="in">`VOSUPPWT`</span> columns</span>
<span id="cb54-582"><a href="#cb54-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-583"><a href="#cb54-583" aria-hidden="true" tabindex="-1"></a>If we're calculating basic averages, we can use <span class="in">`weighted.mean()`</span> instead of <span class="in">`mean()`</span>. Note the difference in average when we don't weight!</span>
<span id="cb54-584"><a href="#cb54-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-587"><a href="#cb54-587" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-588"><a href="#cb54-588" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: example-weighted-means</span></span>
<span id="cb54-589"><a href="#cb54-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-590"><a href="#cb54-590" aria-hidden="true" tabindex="-1"></a>cps_demographics <span class="sc">|&gt;</span> </span>
<span id="cb54-591"><a href="#cb54-591" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb54-592"><a href="#cb54-592" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_age_unweighted =</span> <span class="fu">mean</span>(AGE),  <span class="co"># BAD</span></span>
<span id="cb54-593"><a href="#cb54-593" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_age_weighted =</span> <span class="fu">weighted.mean</span>(AGE, <span class="at">w =</span> ASECWT)  <span class="co"># GOOD</span></span>
<span id="cb54-594"><a href="#cb54-594" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-595"><a href="#cb54-595" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-596"><a href="#cb54-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-597"><a href="#cb54-597" aria-hidden="true" tabindex="-1"></a>If we're doing stuff with models, we can use the <span class="in">`weights`</span> argument:</span>
<span id="cb54-598"><a href="#cb54-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-601"><a href="#cb54-601" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-602"><a href="#cb54-602" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: example-weighted-models</span></span>
<span id="cb54-603"><a href="#cb54-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-604"><a href="#cb54-604" aria-hidden="true" tabindex="-1"></a><span class="co"># BAD: Non-weighted intercept-only model</span></span>
<span id="cb54-605"><a href="#cb54-605" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(AGE <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> cps_demographics) <span class="sc">|&gt;</span> </span>
<span id="cb54-606"><a href="#cb54-606" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>(<span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span>
<span id="cb54-607"><a href="#cb54-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-608"><a href="#cb54-608" aria-hidden="true" tabindex="-1"></a><span class="co"># GOOD: Weighted intercept-only model</span></span>
<span id="cb54-609"><a href="#cb54-609" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(AGE <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> cps_demographics, <span class="at">weights =</span> ASECWT) <span class="sc">|&gt;</span> </span>
<span id="cb54-610"><a href="#cb54-610" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>(<span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span>
<span id="cb54-611"><a href="#cb54-611" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-612"><a href="#cb54-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-613"><a href="#cb54-613" aria-hidden="true" tabindex="-1"></a>Base R only really has <span class="in">`weighted.mean()`</span>. If we want other things, like a weighted variance, or weighted rank, or weighted table/crosstabs, we can use a bunch of different functions in the {Hmisc} package:</span>
<span id="cb54-614"><a href="#cb54-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-617"><a href="#cb54-617" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-618"><a href="#cb54-618" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: example-weighted-means-hmisc</span></span>
<span id="cb54-619"><a href="#cb54-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-620"><a href="#cb54-620" aria-hidden="true" tabindex="-1"></a><span class="co"># Some Hmisc::wtd.*() things:</span></span>
<span id="cb54-621"><a href="#cb54-621" aria-hidden="true" tabindex="-1"></a>cps_demographics <span class="sc">|&gt;</span> </span>
<span id="cb54-622"><a href="#cb54-622" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb54-623"><a href="#cb54-623" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_age =</span> Hmisc<span class="sc">::</span><span class="fu">wtd.mean</span>(AGE, <span class="at">weights =</span> ASECWT),</span>
<span id="cb54-624"><a href="#cb54-624" aria-hidden="true" tabindex="-1"></a>    <span class="at">var_age =</span> Hmisc<span class="sc">::</span><span class="fu">wtd.var</span>(AGE, <span class="at">weights =</span> ASECWT),</span>
<span id="cb54-625"><a href="#cb54-625" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_age =</span> <span class="fu">sqrt</span>(var_age)</span>
<span id="cb54-626"><a href="#cb54-626" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-627"><a href="#cb54-627" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-628"><a href="#cb54-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-629"><a href="#cb54-629" aria-hidden="true" tabindex="-1"></a><span class="fu">## Calculating population-level proportions</span></span>
<span id="cb54-630"><a href="#cb54-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-631"><a href="#cb54-631" aria-hidden="true" tabindex="-1"></a>We'll collapse these population-level CPS values into binary versions of each question so that we can look at things like the proportion of women, the proportion of people who volunteer, and so on. We'll also collapse age into a binary above/below the median age—this isn't necessary, and we could totally work with numeric age instead of proportions, but in our anonymized survey data, our age column is an indicator representing being above/below 36 (the median age at the time of the survey).</span>
<span id="cb54-632"><a href="#cb54-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-633"><a href="#cb54-633" aria-hidden="true" tabindex="-1"></a>We'll do some basic summarizing with <span class="in">`weighted.mean()`</span> and calculate all these national proportions, along with the weighted standard deviations (which will be important for the Bayesian analysis later in this post).</span>
<span id="cb54-634"><a href="#cb54-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-637"><a href="#cb54-637" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-638"><a href="#cb54-638" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: summarize-national-demographics</span></span>
<span id="cb54-639"><a href="#cb54-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-640"><a href="#cb54-640" aria-hidden="true" tabindex="-1"></a>national_demographics <span class="ot">&lt;-</span> cps_demographics <span class="sc">|&gt;</span> </span>
<span id="cb54-641"><a href="#cb54-641" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb54-642"><a href="#cb54-642" aria-hidden="true" tabindex="-1"></a>    <span class="co"># AGE is already numeric</span></span>
<span id="cb54-643"><a href="#cb54-643" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> <span class="fu">weighted.mean</span>(AGE <span class="sc">&gt;=</span> <span class="dv">36</span>, ASECWT), </span>
<span id="cb54-644"><a href="#cb54-644" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_sd =</span> <span class="fu">sqrt</span>(Hmisc<span class="sc">::</span><span class="fu">wtd.var</span>(AGE <span class="sc">&gt;=</span> <span class="dv">36</span>, <span class="at">weights =</span> ASECWT)),</span>
<span id="cb54-645"><a href="#cb54-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-646"><a href="#cb54-646" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1 = Female</span></span>
<span id="cb54-647"><a href="#cb54-647" aria-hidden="true" tabindex="-1"></a>    <span class="at">female =</span> <span class="fu">weighted.mean</span>(SEX <span class="sc">==</span> <span class="dv">2</span>, ASECWT),</span>
<span id="cb54-648"><a href="#cb54-648" aria-hidden="true" tabindex="-1"></a>    <span class="at">female_sd =</span> <span class="fu">sqrt</span>(Hmisc<span class="sc">::</span><span class="fu">wtd.var</span>(SEX <span class="sc">==</span> <span class="dv">2</span>, <span class="at">weights =</span> ASECWT)),</span>
<span id="cb54-649"><a href="#cb54-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-650"><a href="#cb54-650" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1 = Married, spouse present</span></span>
<span id="cb54-651"><a href="#cb54-651" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2 = Married, spouse absent</span></span>
<span id="cb54-652"><a href="#cb54-652" aria-hidden="true" tabindex="-1"></a>    <span class="at">married =</span> <span class="fu">weighted.mean</span>(MARST <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb54-653"><a href="#cb54-653" aria-hidden="true" tabindex="-1"></a>    <span class="at">married_sd =</span> <span class="fu">sqrt</span>(Hmisc<span class="sc">::</span><span class="fu">wtd.var</span>(MARST <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">weights =</span> ASECWT)),</span>
<span id="cb54-654"><a href="#cb54-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-655"><a href="#cb54-655" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 111 = Bachelor's degree</span></span>
<span id="cb54-656"><a href="#cb54-656" aria-hidden="true" tabindex="-1"></a>    <span class="at">college =</span> <span class="fu">weighted.mean</span>(EDUC <span class="sc">&gt;=</span> <span class="dv">111</span>, ASECWT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb54-657"><a href="#cb54-657" aria-hidden="true" tabindex="-1"></a>    <span class="at">college_sd =</span> <span class="fu">sqrt</span>(Hmisc<span class="sc">::</span><span class="fu">wtd.var</span>(EDUC <span class="sc">&gt;=</span> <span class="dv">111</span>, <span class="at">weights =</span> ASECWT))</span>
<span id="cb54-658"><a href="#cb54-658" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-659"><a href="#cb54-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-660"><a href="#cb54-660" aria-hidden="true" tabindex="-1"></a>national_volunteer <span class="ot">&lt;-</span> cps_volunteer <span class="sc">|&gt;</span> </span>
<span id="cb54-661"><a href="#cb54-661" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb54-662"><a href="#cb54-662" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1 = Volunteer</span></span>
<span id="cb54-663"><a href="#cb54-663" aria-hidden="true" tabindex="-1"></a>    <span class="at">volunteering =</span> <span class="fu">weighted.mean</span>(VLSTATUS <span class="sc">==</span> <span class="dv">1</span>, VLSUPPWT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb54-664"><a href="#cb54-664" aria-hidden="true" tabindex="-1"></a>    <span class="at">volunteering_sd =</span> <span class="fu">sqrt</span>(Hmisc<span class="sc">::</span><span class="fu">wtd.var</span>(VLSTATUS <span class="sc">==</span> <span class="dv">1</span>, <span class="at">weights =</span> VLSUPPWT)),</span>
<span id="cb54-665"><a href="#cb54-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-666"><a href="#cb54-666" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2 = Yes, made a donation to charity in the past 12 months</span></span>
<span id="cb54-667"><a href="#cb54-667" aria-hidden="true" tabindex="-1"></a>    <span class="at">donating =</span> <span class="fu">weighted.mean</span>(VLDONATE <span class="sc">==</span> <span class="dv">2</span>, VLSUPPWT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb54-668"><a href="#cb54-668" aria-hidden="true" tabindex="-1"></a>    <span class="at">donating_sd =</span> <span class="fu">sqrt</span>(Hmisc<span class="sc">::</span><span class="fu">wtd.var</span>(VLDONATE <span class="sc">==</span> <span class="dv">2</span>, <span class="at">weights =</span> VLSUPPWT))</span>
<span id="cb54-669"><a href="#cb54-669" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-670"><a href="#cb54-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-671"><a href="#cb54-671" aria-hidden="true" tabindex="-1"></a>national_voting <span class="ot">&lt;-</span> cps_voting <span class="sc">|&gt;</span></span>
<span id="cb54-672"><a href="#cb54-672" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb54-673"><a href="#cb54-673" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2 = Voted in the most recent November election</span></span>
<span id="cb54-674"><a href="#cb54-674" aria-hidden="true" tabindex="-1"></a>    <span class="at">voting =</span> <span class="fu">weighted.mean</span>(VOTED <span class="sc">==</span> <span class="dv">2</span>, VOSUPPWT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb54-675"><a href="#cb54-675" aria-hidden="true" tabindex="-1"></a>    <span class="at">voting_sd =</span> <span class="fu">sqrt</span>(Hmisc<span class="sc">::</span><span class="fu">wtd.var</span>(VOTED <span class="sc">==</span> <span class="dv">2</span>, <span class="at">weights =</span> VOSUPPWT))</span>
<span id="cb54-676"><a href="#cb54-676" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-677"><a href="#cb54-677" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-678"><a href="#cb54-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-679"><a href="#cb54-679" aria-hidden="true" tabindex="-1"></a>I like to store these in a little one-row data frame so that it's easy to access individual values:</span>
<span id="cb54-680"><a href="#cb54-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-683"><a href="#cb54-683" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-684"><a href="#cb54-684" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: show-national-values-df</span></span>
<span id="cb54-685"><a href="#cb54-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-686"><a href="#cb54-686" aria-hidden="true" tabindex="-1"></a>national_values <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb54-687"><a href="#cb54-687" aria-hidden="true" tabindex="-1"></a>  national_demographics, national_volunteer, national_voting</span>
<span id="cb54-688"><a href="#cb54-688" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-689"><a href="#cb54-689" aria-hidden="true" tabindex="-1"></a>national_values</span>
<span id="cb54-690"><a href="#cb54-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-691"><a href="#cb54-691" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion of women</span></span>
<span id="cb54-692"><a href="#cb54-692" aria-hidden="true" tabindex="-1"></a>national_values<span class="sc">$</span>female</span>
<span id="cb54-693"><a href="#cb54-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-694"><a href="#cb54-694" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion that voted</span></span>
<span id="cb54-695"><a href="#cb54-695" aria-hidden="true" tabindex="-1"></a>national_values<span class="sc">$</span>voting</span>
<span id="cb54-696"><a href="#cb54-696" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-697"><a href="#cb54-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-698"><a href="#cb54-698" aria-hidden="true" tabindex="-1"></a><span class="fu"># Summarizing sample proportions</span></span>
<span id="cb54-699"><a href="#cb54-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-700"><a href="#cb54-700" aria-hidden="true" tabindex="-1"></a>We're almost done! All that's left is testing whether the demographic characteristics of the survey experiment respondents reasonably match their corresponding population proportions.</span>
<span id="cb54-701"><a href="#cb54-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-702"><a href="#cb54-702" aria-hidden="true" tabindex="-1"></a>First, though, we need to make binary versions of the survey responses. To make life easier, we'll use the same names as the CPS data:</span>
<span id="cb54-703"><a href="#cb54-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-706"><a href="#cb54-706" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-707"><a href="#cb54-707" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: summarize-survey-demographics</span></span>
<span id="cb54-708"><a href="#cb54-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-709"><a href="#cb54-709" aria-hidden="true" tabindex="-1"></a>results_to_test <span class="ot">&lt;-</span> results <span class="sc">|&gt;</span> </span>
<span id="cb54-710"><a href="#cb54-710" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb54-711"><a href="#cb54-711" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> age <span class="sc">==</span> <span class="st">"More than median"</span>,</span>
<span id="cb54-712"><a href="#cb54-712" aria-hidden="true" tabindex="-1"></a>    <span class="at">female =</span> gender <span class="sc">==</span> <span class="st">"Female"</span>,</span>
<span id="cb54-713"><a href="#cb54-713" aria-hidden="true" tabindex="-1"></a>    <span class="at">married =</span> marital_status <span class="sc">==</span> <span class="st">"Married"</span>,</span>
<span id="cb54-714"><a href="#cb54-714" aria-hidden="true" tabindex="-1"></a>    <span class="at">college =</span> education <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb54-715"><a href="#cb54-715" aria-hidden="true" tabindex="-1"></a>      <span class="st">"4 year degree"</span>, </span>
<span id="cb54-716"><a href="#cb54-716" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Graduate or professional degree"</span>, </span>
<span id="cb54-717"><a href="#cb54-717" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Doctorate"</span></span>
<span id="cb54-718"><a href="#cb54-718" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb54-719"><a href="#cb54-719" aria-hidden="true" tabindex="-1"></a>    <span class="at">volunteering =</span> volunteer_frequency <span class="sc">!=</span> <span class="st">"Haven't volunteered in past 12 months"</span>,</span>
<span id="cb54-720"><a href="#cb54-720" aria-hidden="true" tabindex="-1"></a>    <span class="at">donating =</span> donate_frequency <span class="sc">==</span> <span class="st">"More than once a month, less than once a year"</span>,</span>
<span id="cb54-721"><a href="#cb54-721" aria-hidden="true" tabindex="-1"></a>    <span class="at">voting =</span> voted <span class="sc">==</span> <span class="st">"Yes"</span></span>
<span id="cb54-722"><a href="#cb54-722" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb54-723"><a href="#cb54-723" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(female, age, married, college, volunteering, donating, voting)</span>
<span id="cb54-724"><a href="#cb54-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-725"><a href="#cb54-725" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(results_to_test)</span>
<span id="cb54-726"><a href="#cb54-726" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-727"><a href="#cb54-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-728"><a href="#cb54-728" aria-hidden="true" tabindex="-1"></a><span class="fu"># Testing sample vs. population proportions frequentist-ly</span></span>
<span id="cb54-729"><a href="#cb54-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-730"><a href="#cb54-730" aria-hidden="true" tabindex="-1"></a><span class="fu">## One-sample proportion test for age</span></span>
<span id="cb54-731"><a href="#cb54-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-732"><a href="#cb54-732" aria-hidden="true" tabindex="-1"></a>As a quick and easy check, we can run a one-sample proportion test to see if the proportion of a variable is significantly different from a null value. We can do this with <span class="in">`prop.test()`</span>, which works a bunch of different ways—with matrices, with vectors, and with single values (<span class="co">[</span><span class="ot">see this blog post</span><span class="co">](https://www.andrewheiss.com/blog/2023/05/15/fancy-bayes-diffs-props/index.html#classically)</span> for some other examples of <span class="in">`prop.test()`</span>).</span>
<span id="cb54-733"><a href="#cb54-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-734"><a href="#cb54-734" aria-hidden="true" tabindex="-1"></a>Let's look at age first. 50.77% of people in the sample are older than 36; 53% of people in the population are older than 36:</span>
<span id="cb54-735"><a href="#cb54-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-738"><a href="#cb54-738" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-739"><a href="#cb54-739" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-sample-national-age-prop</span></span>
<span id="cb54-740"><a href="#cb54-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-741"><a href="#cb54-741" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion of sample older than 36</span></span>
<span id="cb54-742"><a href="#cb54-742" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(results_to_test<span class="sc">$</span>age)</span>
<span id="cb54-743"><a href="#cb54-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-744"><a href="#cb54-744" aria-hidden="true" tabindex="-1"></a><span class="co"># CPS proportion older than 36</span></span>
<span id="cb54-745"><a href="#cb54-745" aria-hidden="true" tabindex="-1"></a>national_values<span class="sc">$</span>age</span>
<span id="cb54-746"><a href="#cb54-746" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-747"><a href="#cb54-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-748"><a href="#cb54-748" aria-hidden="true" tabindex="-1"></a>Is that an issue? Is the sample significantly younger than the rest of the country?</span>
<span id="cb54-749"><a href="#cb54-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-750"><a href="#cb54-750" aria-hidden="true" tabindex="-1"></a>For this one-sample test, we need to feed <span class="in">`prop.test()`</span> three things: (1) the number of "successes", or the count of rows where the respondent is older than 36 (or where <span class="in">`age`</span> is <span class="in">`TRUE`</span>), (2) the number of rows in the sample, and (3) the null value, or the population-level CPS proportion:</span>
<span id="cb54-751"><a href="#cb54-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-754"><a href="#cb54-754" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-755"><a href="#cb54-755" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-prop-test-age-freq</span></span>
<span id="cb54-756"><a href="#cb54-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-757"><a href="#cb54-757" aria-hidden="true" tabindex="-1"></a>prop_test_freq_age <span class="ot">&lt;-</span> <span class="fu">prop.test</span>(</span>
<span id="cb54-758"><a href="#cb54-758" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">sum</span>(results_to_test<span class="sc">$</span>age),  <span class="co"># Number of "successes" (rows where age == TRUE)</span></span>
<span id="cb54-759"><a href="#cb54-759" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">nrow</span>(results_to_test),     <span class="co"># Sample size</span></span>
<span id="cb54-760"><a href="#cb54-760" aria-hidden="true" tabindex="-1"></a>  <span class="at">p =</span> national_values<span class="sc">$</span>age        <span class="co"># Population-level proportion from the CPS</span></span>
<span id="cb54-761"><a href="#cb54-761" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-762"><a href="#cb54-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-763"><a href="#cb54-763" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(prop_test_freq_age)</span>
<span id="cb54-764"><a href="#cb54-764" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-765"><a href="#cb54-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-766"><a href="#cb54-766" aria-hidden="true" tabindex="-1"></a>For fun, we can plot this too:</span>
<span id="cb54-767"><a href="#cb54-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-770"><a href="#cb54-770" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-771"><a href="#cb54-771" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-age-sample-prop-freq</span></span>
<span id="cb54-772"><a href="#cb54-772" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Proportion of survey respondents older than 36 compared to the national proportion</span></span>
<span id="cb54-773"><a href="#cb54-773" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb54-774"><a href="#cb54-774" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Code for making this plot ↓</span></span>
<span id="cb54-775"><a href="#cb54-775" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb54-776"><a href="#cb54-776" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 1.6</span></span>
<span id="cb54-777"><a href="#cb54-777" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: 90%</span></span>
<span id="cb54-778"><a href="#cb54-778" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb54-779"><a href="#cb54-779" aria-hidden="true" tabindex="-1"></a>prop_test_freq_age <span class="sc">|&gt;</span> </span>
<span id="cb54-780"><a href="#cb54-780" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">|&gt;</span> </span>
<span id="cb54-781"><a href="#cb54-781" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb54-782"><a href="#cb54-782" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_label =</span> <span class="fu">glue</span>(</span>
<span id="cb54-783"><a href="#cb54-783" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Sample proportion</span><span class="sc">\n</span><span class="st">{prop} [{low}, {high}]"</span>,</span>
<span id="cb54-784"><a href="#cb54-784" aria-hidden="true" tabindex="-1"></a>      <span class="at">prop =</span> <span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="fl">0.01</span>)(estimate),</span>
<span id="cb54-785"><a href="#cb54-785" aria-hidden="true" tabindex="-1"></a>      <span class="at">low =</span> <span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="fl">0.01</span>)(conf.low),</span>
<span id="cb54-786"><a href="#cb54-786" aria-hidden="true" tabindex="-1"></a>      <span class="at">high =</span> <span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="fl">0.01</span>)(conf.high)</span>
<span id="cb54-787"><a href="#cb54-787" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb54-788"><a href="#cb54-788" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb54-789"><a href="#cb54-789" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">y =</span> <span class="st">"Age"</span>)) <span class="sc">+</span></span>
<span id="cb54-790"><a href="#cb54-790" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb54-791"><a href="#cb54-791" aria-hidden="true" tabindex="-1"></a>    <span class="at">xintercept =</span> national_values<span class="sc">$</span>age, <span class="at">color =</span> clrs[<span class="dv">2</span>]</span>
<span id="cb54-792"><a href="#cb54-792" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb54-793"><a href="#cb54-793" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb54-794"><a href="#cb54-794" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">"label"</span>, <span class="at">x =</span> national_values<span class="sc">$</span>age, <span class="at">y =</span> <span class="fu">I</span>(<span class="fl">1.3</span>), </span>
<span id="cb54-795"><a href="#cb54-795" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">glue</span>(</span>
<span id="cb54-796"><a href="#cb54-796" aria-hidden="true" tabindex="-1"></a>      <span class="st">"CPS proportion</span><span class="sc">\n</span><span class="st">{x}"</span>, </span>
<span id="cb54-797"><a href="#cb54-797" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="fl">0.01</span>)(national_values<span class="sc">$</span>age)</span>
<span id="cb54-798"><a href="#cb54-798" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb54-799"><a href="#cb54-799" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> clrs[<span class="dv">2</span>], <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">8</span>, <span class="at">size.unit =</span> <span class="st">"pt"</span></span>
<span id="cb54-800"><a href="#cb54-800" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb54-801"><a href="#cb54-801" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> conf.low, <span class="at">xmax =</span> conf.high)) <span class="sc">+</span></span>
<span id="cb54-802"><a href="#cb54-802" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> prop_label), <span class="at">nudge_y =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">8</span>, <span class="at">size.unit =</span> <span class="st">"pt"</span>) <span class="sc">+</span></span>
<span id="cb54-803"><a href="#cb54-803" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb54-804"><a href="#cb54-804" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Proportion older than 36"</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb54-805"><a href="#cb54-805" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-806"><a href="#cb54-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-807"><a href="#cb54-807" aria-hidden="true" tabindex="-1"></a>Based on this, the 95% confidence interval for the proportion in the sample is 0.48–0.54, and the null/population value is 0.53, which fits safely in that confidence interval. The corresponding *p*-value is 0.108, which means that the sample proportion isn't significantly different from the national proportion. </span>
<span id="cb54-808"><a href="#cb54-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-809"><a href="#cb54-809" aria-hidden="true" tabindex="-1"></a>We can't be certain that the sample doesn't generally match the population, age-wise. </span>
<span id="cb54-810"><a href="#cb54-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-811"><a href="#cb54-811" aria-hidden="true" tabindex="-1"></a>That's a horribly convoluted sentence—welcome to the world of frequentist null hypothesis testing! Technically we can't really say that the sample matches the population, and we can only say that we don't know if it doesn't match. Stay tuned for the Bayesian analysis section for a way to get an answer that we do care about. For now, as a kind of cheat-y shorthand, we can (semi-illegally) say that since the CPS proportion is in the sample confidence interval, there probably isn't a significant difference between the two.</span>
<span id="cb54-812"><a href="#cb54-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-813"><a href="#cb54-813" aria-hidden="true" tabindex="-1"></a><span class="fu">## One-sample proportion test for volunteering</span></span>
<span id="cb54-814"><a href="#cb54-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-815"><a href="#cb54-815" aria-hidden="true" tabindex="-1"></a>Let's do another one: volunteering. </span>
<span id="cb54-816"><a href="#cb54-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-819"><a href="#cb54-819" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-820"><a href="#cb54-820" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-prop-test-vol-freq</span></span>
<span id="cb54-821"><a href="#cb54-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-822"><a href="#cb54-822" aria-hidden="true" tabindex="-1"></a>prop_test_freq_vol <span class="ot">&lt;-</span> <span class="fu">prop.test</span>(</span>
<span id="cb54-823"><a href="#cb54-823" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">sum</span>(results_to_test<span class="sc">$</span>volunteering),</span>
<span id="cb54-824"><a href="#cb54-824" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">nrow</span>(results_to_test),</span>
<span id="cb54-825"><a href="#cb54-825" aria-hidden="true" tabindex="-1"></a>  <span class="at">p =</span> national_values<span class="sc">$</span>volunteering</span>
<span id="cb54-826"><a href="#cb54-826" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-827"><a href="#cb54-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-828"><a href="#cb54-828" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(prop_test_freq_vol)</span>
<span id="cb54-829"><a href="#cb54-829" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-830"><a href="#cb54-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-833"><a href="#cb54-833" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-834"><a href="#cb54-834" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-age-sample-prop-vol</span></span>
<span id="cb54-835"><a href="#cb54-835" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Proportion of survey respondents that volunteer compared to the national proportion</span></span>
<span id="cb54-836"><a href="#cb54-836" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb54-837"><a href="#cb54-837" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Code for making this plot ↓</span></span>
<span id="cb54-838"><a href="#cb54-838" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb54-839"><a href="#cb54-839" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 1.6</span></span>
<span id="cb54-840"><a href="#cb54-840" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: 90%</span></span>
<span id="cb54-841"><a href="#cb54-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-842"><a href="#cb54-842" aria-hidden="true" tabindex="-1"></a>prop_test_freq_vol <span class="sc">|&gt;</span> </span>
<span id="cb54-843"><a href="#cb54-843" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">|&gt;</span> </span>
<span id="cb54-844"><a href="#cb54-844" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb54-845"><a href="#cb54-845" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_label =</span> <span class="fu">glue</span>(</span>
<span id="cb54-846"><a href="#cb54-846" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Sample proportion</span><span class="sc">\n</span><span class="st">{prop} [{low}, {high}]"</span>,</span>
<span id="cb54-847"><a href="#cb54-847" aria-hidden="true" tabindex="-1"></a>      <span class="at">prop =</span> <span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="fl">0.01</span>)(estimate),</span>
<span id="cb54-848"><a href="#cb54-848" aria-hidden="true" tabindex="-1"></a>      <span class="at">low =</span> <span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="fl">0.01</span>)(conf.low),</span>
<span id="cb54-849"><a href="#cb54-849" aria-hidden="true" tabindex="-1"></a>      <span class="at">high =</span> <span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="fl">0.01</span>)(conf.high)</span>
<span id="cb54-850"><a href="#cb54-850" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb54-851"><a href="#cb54-851" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb54-852"><a href="#cb54-852" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">y =</span> <span class="st">"Volunteering"</span>)) <span class="sc">+</span></span>
<span id="cb54-853"><a href="#cb54-853" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb54-854"><a href="#cb54-854" aria-hidden="true" tabindex="-1"></a>    <span class="at">xintercept =</span> national_values<span class="sc">$</span>volunteering, <span class="at">color =</span> clrs[<span class="dv">2</span>]</span>
<span id="cb54-855"><a href="#cb54-855" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb54-856"><a href="#cb54-856" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb54-857"><a href="#cb54-857" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">"label"</span>, <span class="at">x =</span> national_values<span class="sc">$</span>volunteering, <span class="at">y =</span> <span class="fu">I</span>(<span class="fl">1.3</span>), </span>
<span id="cb54-858"><a href="#cb54-858" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">glue</span>(</span>
<span id="cb54-859"><a href="#cb54-859" aria-hidden="true" tabindex="-1"></a>      <span class="st">"CPS proportion</span><span class="sc">\n</span><span class="st">{x}"</span>, </span>
<span id="cb54-860"><a href="#cb54-860" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="fl">0.01</span>)(national_values<span class="sc">$</span>volunteering)</span>
<span id="cb54-861"><a href="#cb54-861" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb54-862"><a href="#cb54-862" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> clrs[<span class="dv">2</span>], <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">8</span>, <span class="at">size.unit =</span> <span class="st">"pt"</span></span>
<span id="cb54-863"><a href="#cb54-863" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb54-864"><a href="#cb54-864" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> conf.low, <span class="at">xmax =</span> conf.high)) <span class="sc">+</span></span>
<span id="cb54-865"><a href="#cb54-865" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> prop_label), <span class="at">nudge_y =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">8</span>, <span class="at">size.unit =</span> <span class="st">"pt"</span>) <span class="sc">+</span></span>
<span id="cb54-866"><a href="#cb54-866" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb54-867"><a href="#cb54-867" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Proportion that volunteers regularly"</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb54-868"><a href="#cb54-868" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fl">0.26</span>, <span class="fl">0.7</span>))</span>
<span id="cb54-869"><a href="#cb54-869" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-870"><a href="#cb54-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-871"><a href="#cb54-871" aria-hidden="true" tabindex="-1"></a>Phew, this one is *way* off. 30% of the general population has volunteered in the last year; 60% of the sample has volunteered. The sample proportion is most definitely significantly different from the general population, and we can reject the null hypothesis that it's the same.</span>
<span id="cb54-872"><a href="#cb54-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-873"><a href="#cb54-873" aria-hidden="true" tabindex="-1"></a>In this case, that's fine. In our experiment, we only wanted to test our different treatments on people who donate to charity on at least an annual basis, so we screened out respondents who hadn't donated in the past year. Volunteer behavior and donation behavior are closely correlated, so we have way more volunteers in our sample.</span>
<span id="cb54-874"><a href="#cb54-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-875"><a href="#cb54-875" aria-hidden="true" tabindex="-1"></a><span class="fu">## Proportion tests and differences for everything all at once</span></span>
<span id="cb54-876"><a href="#cb54-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-877"><a href="#cb54-877" aria-hidden="true" tabindex="-1"></a>We can repeat this one-sample proportion test for all the different characteristics we care about. Instead of repeating the same code over and over, we'll make a little wrapper function for it. We'll also calculate the difference between the sample and population proportions:</span>
<span id="cb54-878"><a href="#cb54-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-881"><a href="#cb54-881" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-882"><a href="#cb54-882" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fun-prop-test-freq</span></span>
<span id="cb54-883"><a href="#cb54-883" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb54-884"><a href="#cb54-884" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "`prop_test_freq()` wrapper function"</span></span>
<span id="cb54-885"><a href="#cb54-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-886"><a href="#cb54-886" aria-hidden="true" tabindex="-1"></a><span class="co">#' Perform a basic one-sample proportion test</span></span>
<span id="cb54-887"><a href="#cb54-887" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb54-888"><a href="#cb54-888" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param sample_column A numeric vector representing the sample data (0s and 1s).</span></span>
<span id="cb54-889"><a href="#cb54-889" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param cps_prop A numeric value representing the proportion to compare against.</span></span>
<span id="cb54-890"><a href="#cb54-890" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return A tibble containing the test results and the differences between the</span></span>
<span id="cb54-891"><a href="#cb54-891" aria-hidden="true" tabindex="-1"></a><span class="co">#'         sample estimate and the specified proportion.</span></span>
<span id="cb54-892"><a href="#cb54-892" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb54-893"><a href="#cb54-893" aria-hidden="true" tabindex="-1"></a><span class="co">#' sample_data &lt;- c(1, 0, 1, 1, 0, 1, 0, 1, 1, 0)</span></span>
<span id="cb54-894"><a href="#cb54-894" aria-hidden="true" tabindex="-1"></a><span class="co">#' cps_prop &lt;- 0.5</span></span>
<span id="cb54-895"><a href="#cb54-895" aria-hidden="true" tabindex="-1"></a><span class="co">#' prop_test_freq(sample_data, cps_prop)</span></span>
<span id="cb54-896"><a href="#cb54-896" aria-hidden="true" tabindex="-1"></a>prop_test_freq <span class="ot">&lt;-</span> <span class="cf">function</span>(sample_column, cps_prop) {</span>
<span id="cb54-897"><a href="#cb54-897" aria-hidden="true" tabindex="-1"></a>  n_yes <span class="ot">&lt;-</span> <span class="fu">sum</span>(sample_column)</span>
<span id="cb54-898"><a href="#cb54-898" aria-hidden="true" tabindex="-1"></a>  n_total <span class="ot">=</span> <span class="fu">length</span>(sample_column)</span>
<span id="cb54-899"><a href="#cb54-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-900"><a href="#cb54-900" aria-hidden="true" tabindex="-1"></a>  sample_prop_test <span class="ot">&lt;-</span> <span class="fu">prop.test</span>(</span>
<span id="cb54-901"><a href="#cb54-901" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> n_yes,</span>
<span id="cb54-902"><a href="#cb54-902" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> n_total,</span>
<span id="cb54-903"><a href="#cb54-903" aria-hidden="true" tabindex="-1"></a>    <span class="at">p =</span> cps_prop</span>
<span id="cb54-904"><a href="#cb54-904" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-905"><a href="#cb54-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-906"><a href="#cb54-906" aria-hidden="true" tabindex="-1"></a>  out_df <span class="ot">&lt;-</span> <span class="fu">tidy</span>(sample_prop_test) <span class="sc">|&gt;</span> </span>
<span id="cb54-907"><a href="#cb54-907" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb54-908"><a href="#cb54-908" aria-hidden="true" tabindex="-1"></a>      <span class="at">diff =</span> estimate <span class="sc">-</span> cps_prop,</span>
<span id="cb54-909"><a href="#cb54-909" aria-hidden="true" tabindex="-1"></a>      <span class="at">diff_low =</span> conf.low <span class="sc">-</span> cps_prop,</span>
<span id="cb54-910"><a href="#cb54-910" aria-hidden="true" tabindex="-1"></a>      <span class="at">diff_high =</span> conf.high <span class="sc">-</span> cps_prop</span>
<span id="cb54-911"><a href="#cb54-911" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb54-912"><a href="#cb54-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-913"><a href="#cb54-913" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">test =</span> <span class="fu">list</span>(sample_prop_test), out_df))</span>
<span id="cb54-914"><a href="#cb54-914" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-915"><a href="#cb54-915" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-916"><a href="#cb54-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-917"><a href="#cb54-917" aria-hidden="true" tabindex="-1"></a>We'll then create a little summary dataset and plug each row of it into our new <span class="in">`prop_test_freq()`</span> function with the magic of <span class="in">`purrr::map()`</span>, which will store the results from the hypothesis test in a list column named <span class="in">`prop_test_results`</span>, which we'll finally unnest so that we can access the results as columns:</span>
<span id="cb54-918"><a href="#cb54-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-921"><a href="#cb54-921" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-922"><a href="#cb54-922" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-prop-test-freq</span></span>
<span id="cb54-923"><a href="#cb54-923" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb54-924"><a href="#cb54-924" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Create `sample_cps_props_freq` and use `prop_test_freq()` on each row"</span></span>
<span id="cb54-925"><a href="#cb54-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-926"><a href="#cb54-926" aria-hidden="true" tabindex="-1"></a>sample_cps_props_freq <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb54-927"><a href="#cb54-927" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>category, <span class="sc">~</span>variable, <span class="sc">~</span>sample_value, <span class="sc">~</span>national_value,</span>
<span id="cb54-928"><a href="#cb54-928" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Demographics"</span>, <span class="st">"Age (% 36+)"</span>, results_to_test<span class="sc">$</span>age, national_values<span class="sc">$</span>age,</span>
<span id="cb54-929"><a href="#cb54-929" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Demographics"</span>, <span class="st">"Female (%)"</span>, results_to_test<span class="sc">$</span>female, national_values<span class="sc">$</span>female,</span>
<span id="cb54-930"><a href="#cb54-930" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Demographics"</span>, <span class="st">"Married (%)"</span>, results_to_test<span class="sc">$</span>married, national_values<span class="sc">$</span>married,</span>
<span id="cb54-931"><a href="#cb54-931" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Demographics"</span>, <span class="st">"Education (% BA+)"</span>, results_to_test<span class="sc">$</span>college, national_values<span class="sc">$</span>college,</span>
<span id="cb54-932"><a href="#cb54-932" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Philanthropy"</span>, <span class="st">"Donated in past year (%)"</span>, results_to_test<span class="sc">$</span>donating, national_values<span class="sc">$</span>donating,</span>
<span id="cb54-933"><a href="#cb54-933" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Philanthropy"</span>, <span class="st">"Volunteered in past year (%)"</span>, results_to_test<span class="sc">$</span>volunteering, national_values<span class="sc">$</span>volunteering,</span>
<span id="cb54-934"><a href="#cb54-934" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Voting"</span>, <span class="st">"Voted in last November election (%)"</span>, results_to_test<span class="sc">$</span>voting, national_values<span class="sc">$</span>voting</span>
<span id="cb54-935"><a href="#cb54-935" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb54-936"><a href="#cb54-936" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop_test_results =</span> <span class="fu">pmap</span>(</span>
<span id="cb54-937"><a href="#cb54-937" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(sample_value, national_value), \(x, y) <span class="fu">prop_test_freq</span>(x, y)</span>
<span id="cb54-938"><a href="#cb54-938" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span></span>
<span id="cb54-939"><a href="#cb54-939" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(prop_test_results)</span>
<span id="cb54-940"><a href="#cb54-940" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-941"><a href="#cb54-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-942"><a href="#cb54-942" aria-hidden="true" tabindex="-1"></a>We can use this new <span class="in">`sample_cps_props_freq`</span> data frame for plotting:</span>
<span id="cb54-943"><a href="#cb54-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-946"><a href="#cb54-946" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-947"><a href="#cb54-947" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-prop-test-freq-props</span></span>
<span id="cb54-948"><a href="#cb54-948" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Respondent demographic proportions compared to national proportions</span></span>
<span id="cb54-949"><a href="#cb54-949" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb54-950"><a href="#cb54-950" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Code for making this plot ↓</span></span>
<span id="cb54-951"><a href="#cb54-951" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb54-952"><a href="#cb54-952" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb54-953"><a href="#cb54-953" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: 90%</span></span>
<span id="cb54-954"><a href="#cb54-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-955"><a href="#cb54-955" aria-hidden="true" tabindex="-1"></a>sample_cps_props_freq <span class="sc">|&gt;</span></span>
<span id="cb54-956"><a href="#cb54-956" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(variable, category), \(x) <span class="fu">fct_inorder</span>(x))) <span class="sc">|&gt;</span></span>
<span id="cb54-957"><a href="#cb54-957" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">y =</span> <span class="fu">fct_rev</span>(variable))) <span class="sc">+</span></span>
<span id="cb54-958"><a href="#cb54-958" aria-hidden="true" tabindex="-1"></a>  <span class="co"># It would be nicer to use geom_segment() to add vertical lines here, but it </span></span>
<span id="cb54-959"><a href="#cb54-959" aria-hidden="true" tabindex="-1"></a>  <span class="co"># doesn't play nicely with categorical y-axis breaks, so we can cheat and use </span></span>
<span id="cb54-960"><a href="#cb54-960" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_point() instead with `shape = "|"` to use the | character</span></span>
<span id="cb54-961"><a href="#cb54-961" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> national_value, <span class="at">color =</span> <span class="st">"CPS proportion"</span>), <span class="at">shape =</span> <span class="st">"|"</span>, <span class="at">size =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb54-962"><a href="#cb54-962" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> conf.low, <span class="at">xmax =</span> conf.high, <span class="at">color =</span> <span class="st">"Sample proportion"</span>)) <span class="sc">+</span></span>
<span id="cb54-963"><a href="#cb54-963" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb54-964"><a href="#cb54-964" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">label_wrap</span>(<span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb54-965"><a href="#cb54-965" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"CPS proportion"</span> <span class="ot">=</span> clrs[<span class="dv">2</span>], <span class="st">"Sample proportion"</span> <span class="ot">=</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb54-966"><a href="#cb54-966" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_col</span>(<span class="fu">vars</span>(category), <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">space =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb54-967"><a href="#cb54-967" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Average proportion"</span>, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">color =</span> <span class="cn">NULL</span>)</span>
<span id="cb54-968"><a href="#cb54-968" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-969"><a href="#cb54-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-970"><a href="#cb54-970" aria-hidden="true" tabindex="-1"></a>That looks super neat and it's helpful to visualize all these differences. In general, the sample looks like the population in terms of age, gender, marital status, and education, but the sample is way more socially and civically oriented than the rest of the country (again, by design).</span>
<span id="cb54-971"><a href="#cb54-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-972"><a href="#cb54-972" aria-hidden="true" tabindex="-1"></a>The only issue with this plot is that it's a little hard to read with the CPS proportion moving around in each variable. We can center it at 0 and look at differences from the CPS proportion:</span>
<span id="cb54-973"><a href="#cb54-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-976"><a href="#cb54-976" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-977"><a href="#cb54-977" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-prop-test-freq-diffs</span></span>
<span id="cb54-978"><a href="#cb54-978" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Differences between demographic proportions and national proportions</span></span>
<span id="cb54-979"><a href="#cb54-979" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb54-980"><a href="#cb54-980" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Code for making this plot ↓</span></span>
<span id="cb54-981"><a href="#cb54-981" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb54-982"><a href="#cb54-982" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb54-983"><a href="#cb54-983" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: 90%</span></span>
<span id="cb54-984"><a href="#cb54-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-985"><a href="#cb54-985" aria-hidden="true" tabindex="-1"></a>sample_cps_props_freq <span class="sc">|&gt;</span> </span>
<span id="cb54-986"><a href="#cb54-986" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(variable, category), \(x) <span class="fu">fct_inorder</span>(x))) <span class="sc">|&gt;</span> </span>
<span id="cb54-987"><a href="#cb54-987" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> diff, <span class="at">y =</span> <span class="fu">fct_rev</span>(variable))) <span class="sc">+</span></span>
<span id="cb54-988"><a href="#cb54-988" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="dv">0</span>), <span class="at">color =</span> clrs[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb54-989"><a href="#cb54-989" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(</span>
<span id="cb54-990"><a href="#cb54-990" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">xmin =</span> diff_low, <span class="at">xmax =</span> diff_high, <span class="at">color =</span> <span class="st">"Sample proportion − CPS proportion"</span>)</span>
<span id="cb54-991"><a href="#cb54-991" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb54-992"><a href="#cb54-992" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> label_pp) <span class="sc">+</span></span>
<span id="cb54-993"><a href="#cb54-993" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">label_wrap</span>(<span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb54-994"><a href="#cb54-994" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Sample proportion − CPS proportion"</span> <span class="ot">=</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb54-995"><a href="#cb54-995" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_col</span>(<span class="fu">vars</span>(category), <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">space =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb54-996"><a href="#cb54-996" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Difference in proportion from CPS"</span>, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">color =</span> <span class="cn">NULL</span>)</span>
<span id="cb54-997"><a href="#cb54-997" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-998"><a href="#cb54-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-999"><a href="#cb54-999" aria-hidden="true" tabindex="-1"></a>And we can also use <span class="in">`sample_cps_props_freq`</span> to make a pretty table. Here's a table with <span class="co">[</span><span class="ot">{tinytable}</span><span class="co">](https://vincentarelbundock.github.io/tinytable/)</span> (though you could do this with any of R's tablemaking packages, like <span class="co">[</span><span class="ot">{gt}</span><span class="co">](https://gt.rstudio.com/)</span> or <span class="co">[</span><span class="ot">{kableExtra}</span><span class="co">](https://haozhu233.github.io/kableExtra/)</span> or whatever)</span>
<span id="cb54-1000"><a href="#cb54-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1003"><a href="#cb54-1003" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1004"><a href="#cb54-1004" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-prop-test-freq</span></span>
<span id="cb54-1005"><a href="#cb54-1005" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: body-outset-right</span></span>
<span id="cb54-1006"><a href="#cb54-1006" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Sample characteristics compared to nationally representative Current Population Survey (CPS) estimates"</span></span>
<span id="cb54-1007"><a href="#cb54-1007" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb54-1008"><a href="#cb54-1008" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Code for making this table ↓</span></span>
<span id="cb54-1009"><a href="#cb54-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1010"><a href="#cb54-1010" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb54-1011"><a href="#cb54-1011" aria-hidden="true" tabindex="-1"></a>  <span class="st">"*"</span> <span class="ot">=</span> <span class="st">"Sample proportion significantly different from CPS (p &lt; 0.05)"</span>,</span>
<span id="cb54-1012"><a href="#cb54-1012" aria-hidden="true" tabindex="-1"></a>  <span class="st">"a"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">j =</span> <span class="dv">1</span>, <span class="at">text =</span> <span class="st">"Annual Social and Economic Supplement (ASEC) of the Current Population Survey (CPS), March 2019"</span>),</span>
<span id="cb54-1013"><a href="#cb54-1013" aria-hidden="true" tabindex="-1"></a>  <span class="st">"b"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="at">i =</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">j =</span> <span class="dv">1</span>, <span class="at">text =</span> <span class="st">"Monthly CPS, September 2019"</span>),</span>
<span id="cb54-1014"><a href="#cb54-1014" aria-hidden="true" tabindex="-1"></a>  <span class="st">"c"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="at">i =</span> <span class="dv">7</span>, <span class="at">j =</span> <span class="dv">1</span>, <span class="at">text =</span> <span class="st">"Monthly CPS, November 2018"</span>)</span>
<span id="cb54-1015"><a href="#cb54-1015" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-1016"><a href="#cb54-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1017"><a href="#cb54-1017" aria-hidden="true" tabindex="-1"></a>sample_cps_props_freq <span class="sc">|&gt;</span> </span>
<span id="cb54-1018"><a href="#cb54-1018" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">significant =</span> <span class="fu">ifelse</span>(p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="st">"*"</span>, <span class="st">""</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb54-1019"><a href="#cb54-1019" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sample_nice =</span> <span class="fu">glue</span>(</span>
<span id="cb54-1020"><a href="#cb54-1020" aria-hidden="true" tabindex="-1"></a>    <span class="st">"{estimate}{significant}&lt;br&gt;[{conf.low}, {conf.high}]"</span>,</span>
<span id="cb54-1021"><a href="#cb54-1021" aria-hidden="true" tabindex="-1"></a>    <span class="at">estimate =</span> <span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>)(estimate),</span>
<span id="cb54-1022"><a href="#cb54-1022" aria-hidden="true" tabindex="-1"></a>    <span class="at">conf.low =</span> <span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>)(conf.low),</span>
<span id="cb54-1023"><a href="#cb54-1023" aria-hidden="true" tabindex="-1"></a>    <span class="at">conf.high =</span> <span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>)(conf.high)</span>
<span id="cb54-1024"><a href="#cb54-1024" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb54-1025"><a href="#cb54-1025" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_nice =</span> <span class="fu">glue</span>(</span>
<span id="cb54-1026"><a href="#cb54-1026" aria-hidden="true" tabindex="-1"></a>    <span class="st">"{diff}{significant}&lt;br&gt;[{diff_low}, {diff_high}]"</span>,</span>
<span id="cb54-1027"><a href="#cb54-1027" aria-hidden="true" tabindex="-1"></a>    <span class="at">diff =</span> <span class="fu">label_pp_01</span>(diff),</span>
<span id="cb54-1028"><a href="#cb54-1028" aria-hidden="true" tabindex="-1"></a>    <span class="at">diff_low =</span> <span class="fu">label_number</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>, <span class="at">scale =</span> <span class="dv">100</span>)(diff_low),</span>
<span id="cb54-1029"><a href="#cb54-1029" aria-hidden="true" tabindex="-1"></a>    <span class="at">diff_high =</span> <span class="fu">label_number</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>, <span class="at">scale =</span> <span class="dv">100</span>)(diff_high)</span>
<span id="cb54-1030"><a href="#cb54-1030" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb54-1031"><a href="#cb54-1031" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb54-1032"><a href="#cb54-1032" aria-hidden="true" tabindex="-1"></a>    <span class="at">Variable =</span> variable, </span>
<span id="cb54-1033"><a href="#cb54-1033" aria-hidden="true" tabindex="-1"></a>    <span class="at">National =</span> national_value, </span>
<span id="cb54-1034"><a href="#cb54-1034" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sample =</span> sample_nice,</span>
<span id="cb54-1035"><a href="#cb54-1035" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">∆</span><span class="st">`</span> <span class="ot">=</span> diff_nice) <span class="sc">|&gt;</span> </span>
<span id="cb54-1036"><a href="#cb54-1036" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tt</span>(<span class="at">width =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>), <span class="at">notes =</span> notes) <span class="sc">|&gt;</span> </span>
<span id="cb54-1037"><a href="#cb54-1037" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_tt</span>(<span class="at">i =</span> sample_cps_props_freq<span class="sc">$</span>category) <span class="sc">|&gt;</span> </span>
<span id="cb54-1038"><a href="#cb54-1038" aria-hidden="true" tabindex="-1"></a>  <span class="fu">format_tt</span>(<span class="at">j =</span> <span class="dv">2</span>, <span class="at">fn =</span> <span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb54-1039"><a href="#cb54-1039" aria-hidden="true" tabindex="-1"></a>  <span class="fu">style_tt</span>(<span class="at">i =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">9</span>), <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">background =</span> <span class="st">"#e6e6e6"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb54-1040"><a href="#cb54-1040" aria-hidden="true" tabindex="-1"></a>  <span class="fu">style_tt</span>(</span>
<span id="cb54-1041"><a href="#cb54-1041" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrap_class =</span> <span class="st">"table"</span>,</span>
<span id="cb54-1042"><a href="#cb54-1042" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrap_css_rule =</span> <span class="st">".table tfoot { text-align: left; } .table { font-size: 0.85rem; }"</span></span>
<span id="cb54-1043"><a href="#cb54-1043" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb54-1044"><a href="#cb54-1044" aria-hidden="true" tabindex="-1"></a>  <span class="fu">style_tt</span>(<span class="at">j =</span> <span class="dv">1</span>, <span class="at">align =</span> <span class="st">"l"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb54-1045"><a href="#cb54-1045" aria-hidden="true" tabindex="-1"></a>  <span class="fu">style_tt</span>(<span class="at">j =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">align =</span> <span class="st">"c"</span>)</span>
<span id="cb54-1046"><a href="#cb54-1046" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1047"><a href="#cb54-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1048"><a href="#cb54-1048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1049"><a href="#cb54-1049" aria-hidden="true" tabindex="-1"></a><span class="fu"># Testing sample vs. population proportions Bayesian-ly</span></span>
<span id="cb54-1050"><a href="#cb54-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1051"><a href="#cb54-1051" aria-hidden="true" tabindex="-1"></a><span class="fu">## ew null hypothesis significance testing</span></span>
<span id="cb54-1052"><a href="#cb54-1052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1053"><a href="#cb54-1053" aria-hidden="true" tabindex="-1"></a>That's all well and good, but I'm actually not 100% sure if that's the right proportion test to use. <span class="co">[</span><span class="ot">As I mention here</span><span class="co">](https://www.andrewheiss.com/blog/2023/05/15/fancy-bayes-diffs-props/index.html#classically)</span>, every classical statistical test has a bunch of "flavors" for different situations and assumptions (e.g., do the two samples have equal or unequal variances? do we need to correct the sample size? make a continuity correction? is it tuesday?). There are <span class="co">[</span><span class="ot">all sorts of flowcharts</span><span class="co">](https://www.google.com/search?q=statistical+test+flow+chart)</span> you can follow to choose the right version.</span>
<span id="cb54-1054"><a href="#cb54-1054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1055"><a href="#cb54-1055" aria-hidden="true" tabindex="-1"></a>Technically, the results from all those one-sample proportion tests above tell us the answer to this question:</span>
<span id="cb54-1056"><a href="#cb54-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1057"><a href="#cb54-1057" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; In a hypothetical world where the difference between the sample and population proportions is 0 (or where the sample proportion is equal to the population proportion), what's the probability that this one-time collection of data fits in that world—and if the probability is low, is there enough evidence (i.e. is the probability less than 0.05?) to confidently reject that hypothetical world of no difference?</span></span>
<span id="cb54-1058"><a href="#cb54-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1059"><a href="#cb54-1059" aria-hidden="true" tabindex="-1"></a>That's a mouthful and it's a weird question. With age, there's a 2.3 percentage point difference between the sample and the national proportions, with a *p*-value of 0.108. This means that there's a 10.8% chance of seeing a 2.3 percentage point difference in a world where the difference is actually 0. That's less than 5%, so we cannot confidently declare that there's not *not* a difference. Or in other words, we can't reject the possibility that we're in the hypothetical null world.</span>
<span id="cb54-1060"><a href="#cb54-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1061"><a href="#cb54-1061" aria-hidden="true" tabindex="-1"></a>As a kind of shorthand, we then handwavily concluded that the sample and population proportions are probably about the same, but technically that's wrong. All we really concluded is that we don't have enough evidence that the hypothetical world of no difference is wrong. It could be right; it could be wrong. Who knows.</span>
<span id="cb54-1062"><a href="#cb54-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1063"><a href="#cb54-1063" aria-hidden="true" tabindex="-1"></a>With volunteering, there's a 29.7 percentage point difference between the sample and the national proportions, with a tiny tiny *p*-value of 8.79&nbsp;×&nbsp;10^−121^. This means that there's basicaly a 0% chance that we'd see that 29.7 percentage point difference in a world where the difference is actually 0. That makes it statistically significant—we have enough evidence to safely declare that we're not in the hypothetical null world.</span>
<span id="cb54-1064"><a href="#cb54-1064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1065"><a href="#cb54-1065" aria-hidden="true" tabindex="-1"></a>I really really don't like this logic of null hypothesis testing. It doesn't really answer the question we want to know. Here's what we're really actually interested in:</span>
<span id="cb54-1066"><a href="#cb54-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1067"><a href="#cb54-1067" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Given this data, what's the probability that there's no difference between the sample and population proportions?</span></span>
<span id="cb54-1068"><a href="#cb54-1068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1069"><a href="#cb54-1069" aria-hidden="true" tabindex="-1"></a>We can answer this question with Bayesian statistics and avoid all this null hypothesis stuff. And as an added bonus, we don't need to think about which flavor of which context-specific statistical test we need to use. We can instead model the data-generating process more directly and then work with the simulated posterior distribution of that process.</span>
<span id="cb54-1070"><a href="#cb54-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1071"><a href="#cb54-1071" aria-hidden="true" tabindex="-1"></a><span class="fu">## Modeling proportions with a binomial distribution</span></span>
<span id="cb54-1072"><a href="#cb54-1072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1073"><a href="#cb54-1073" aria-hidden="true" tabindex="-1"></a>The actual process for generating the age column (and all the other variables in the sample) involved asking each survey respondent their age. If someone is older than 36, it's counted as a "success"; if they are younger than 36, it's not a success. It's a binary choice^<span class="co">[</span><span class="ot">Kind of—technically they selected their actual age, but we can pretend that it was just a binary choice.</span><span class="co">]</span> that is repeated across hundreds of other respondents (or "trials"). There's some underlying probability for being older than 36 that corresponds to the proportion of people that select that answer.</span>
<span id="cb54-1074"><a href="#cb54-1074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1075"><a href="#cb54-1075" aria-hidden="true" tabindex="-1"></a>This data-generating process involves a bunch of independent trials (or respondents) with some probability of success (or being older than 36), which makes it a <span class="co">[</span><span class="ot">binomial distribution</span><span class="co">](https://en.wikipedia.org/wiki/Binomial_distribution)</span>.</span>
<span id="cb54-1076"><a href="#cb54-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1077"><a href="#cb54-1077" aria-hidden="true" tabindex="-1"></a>Formally, it has three parameters:</span>
<span id="cb54-1078"><a href="#cb54-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1079"><a href="#cb54-1079" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb54-1080"><a href="#cb54-1080" aria-hidden="true" tabindex="-1"></a>y \sim \operatorname{Binomial}(n, \pi)</span>
<span id="cb54-1081"><a href="#cb54-1081" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb54-1082"><a href="#cb54-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1083"><a href="#cb54-1083" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>$y$, or the number of successes (the number of people older than 36)</span>
<span id="cb54-1084"><a href="#cb54-1084" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>$n$, or the number of trials (the total number of respondents)</span>
<span id="cb54-1085"><a href="#cb54-1085" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>$\pi$, or the probability of success (the probability that someone is older than 36)</span>
<span id="cb54-1086"><a href="#cb54-1086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1087"><a href="#cb54-1087" aria-hidden="true" tabindex="-1"></a>We know $y$ and $n$ from our data:</span>
<span id="cb54-1088"><a href="#cb54-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1089"><a href="#cb54-1089" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$y$ = <span class="in">`sum(results_to_test$age)`</span> = <span class="in">`r sum(results_to_test$age)`</span></span>
<span id="cb54-1090"><a href="#cb54-1090" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$n$ = <span class="in">`nrow(results_to_test)`</span> = <span class="in">`r nrow(results_to_test)`</span></span>
<span id="cb54-1091"><a href="#cb54-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1092"><a href="#cb54-1092" aria-hidden="true" tabindex="-1"></a>We want to find out $\pi$ so we can find the difference between $\pi$ and the population proportion to see if it's 0 or not.</span>
<span id="cb54-1093"><a href="#cb54-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1094"><a href="#cb54-1094" aria-hidden="true" tabindex="-1"></a>We can estimate $\pi$ with a Bayesian beta-binomial regression model using {brms}. We'll use a vague Beta(1, 1) prior, which is 50% with a wide range—<span class="co">[</span><span class="ot">see here for more about Beta distributions and priors</span><span class="co">](https://www.andrewheiss.com/blog/2023/05/15/fancy-bayes-diffs-props/#formal-model)</span>. Note that this is an intercept-only model with no other covariates. That's because we just want to know the underlying proportion of age—we're not conditioning that proportion on anything else.</span>
<span id="cb54-1095"><a href="#cb54-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1096"><a href="#cb54-1096" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb54-1097"><a href="#cb54-1097" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb54-1098"><a href="#cb54-1098" aria-hidden="true" tabindex="-1"></a>y_{(n \text{ age &gt; 36})} \sim&amp;\ \operatorname{Binomial}(n_{\text{Total respondents}}, \pi_{\text{age &gt; 36}}) <span class="sc">\\</span></span>
<span id="cb54-1099"><a href="#cb54-1099" aria-hidden="true" tabindex="-1"></a>\pi_{\text{age &gt; 36}} =&amp;\ \beta_0 <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb54-1100"><a href="#cb54-1100" aria-hidden="true" tabindex="-1"></a>\beta_0 =&amp;\ \operatorname{Beta}(1, 1)</span>
<span id="cb54-1101"><a href="#cb54-1101" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb54-1102"><a href="#cb54-1102" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb54-1103"><a href="#cb54-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1104"><a href="#cb54-1104" aria-hidden="true" tabindex="-1"></a>{brms} likes working with data frames, so we'll put our $y$ and $n$ into a little one-row dataset and then use <span class="in">`brm()`</span> to fit a model:</span>
<span id="cb54-1105"><a href="#cb54-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1108"><a href="#cb54-1108" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1109"><a href="#cb54-1109" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: make-little-age-df</span></span>
<span id="cb54-1110"><a href="#cb54-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1111"><a href="#cb54-1111" aria-hidden="true" tabindex="-1"></a>age_binomial_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb54-1112"><a href="#cb54-1112" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_yes =</span> <span class="fu">sum</span>(results_to_test<span class="sc">$</span>age),</span>
<span id="cb54-1113"><a href="#cb54-1113" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_total =</span> <span class="fu">nrow</span>(results_to_test)</span>
<span id="cb54-1114"><a href="#cb54-1114" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-1115"><a href="#cb54-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1116"><a href="#cb54-1116" aria-hidden="true" tabindex="-1"></a><span class="co"># lol tiny data</span></span>
<span id="cb54-1117"><a href="#cb54-1117" aria-hidden="true" tabindex="-1"></a>age_binomial_df</span>
<span id="cb54-1118"><a href="#cb54-1118" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1119"><a href="#cb54-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1122"><a href="#cb54-1122" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1123"><a href="#cb54-1123" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: model-age-binomial</span></span>
<span id="cb54-1124"><a href="#cb54-1124" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hide</span></span>
<span id="cb54-1125"><a href="#cb54-1125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1126"><a href="#cb54-1126" aria-hidden="true" tabindex="-1"></a>model_age_binomial <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb54-1127"><a href="#cb54-1127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(n_yes <span class="sc">|</span> <span class="fu">trials</span>(n_total) <span class="sc">~</span> <span class="dv">1</span>),</span>
<span id="cb54-1128"><a href="#cb54-1128" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> age_binomial_df,</span>
<span id="cb54-1129"><a href="#cb54-1129" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"identity"</span>),</span>
<span id="cb54-1130"><a href="#cb54-1130" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">beta</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">class =</span> <span class="st">"Intercept"</span>, <span class="at">lb =</span> <span class="dv">0</span>, <span class="at">ub =</span> <span class="dv">1</span>)),</span>
<span id="cb54-1131"><a href="#cb54-1131" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> CHAINS, <span class="at">warmup =</span> WARMUP, <span class="at">iter =</span> ITER, <span class="at">seed =</span> BAYES_SEED,</span>
<span id="cb54-1132"><a href="#cb54-1132" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb54-1133"><a href="#cb54-1133" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"models/model_age_binomial"</span></span>
<span id="cb54-1134"><a href="#cb54-1134" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-1135"><a href="#cb54-1135" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1136"><a href="#cb54-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1137"><a href="#cb54-1137" aria-hidden="true" tabindex="-1"></a><span class="fu">## Working with the posterior</span></span>
<span id="cb54-1138"><a href="#cb54-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1139"><a href="#cb54-1139" aria-hidden="true" tabindex="-1"></a>Since this is just a regression model, it behaves like any normal {brms} model. The coefficient for the intercept represents the estimated proportion of people older than 36 in the sample:</span>
<span id="cb54-1140"><a href="#cb54-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1143"><a href="#cb54-1143" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1144"><a href="#cb54-1144" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: show-model-age-summary</span></span>
<span id="cb54-1145"><a href="#cb54-1145" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb54-1146"><a href="#cb54-1146" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_age_binomial)</span>
<span id="cb54-1147"><a href="#cb54-1147" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1148"><a href="#cb54-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1149"><a href="#cb54-1149" aria-hidden="true" tabindex="-1"></a>Since we're in The Land of Bayes, we can work with the full posterior and calculate estimands directly, like the posterior difference between the sample proportion and the national proportion:</span>
<span id="cb54-1150"><a href="#cb54-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1153"><a href="#cb54-1153" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1154"><a href="#cb54-1154" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-age-draws</span></span>
<span id="cb54-1155"><a href="#cb54-1155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1156"><a href="#cb54-1156" aria-hidden="true" tabindex="-1"></a>age_draws <span class="ot">&lt;-</span> model_age_binomial <span class="sc">|&gt;</span> </span>
<span id="cb54-1157"><a href="#cb54-1157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_draws</span>(b_Intercept) <span class="sc">|&gt;</span> </span>
<span id="cb54-1158"><a href="#cb54-1158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> b_Intercept <span class="sc">-</span> national_values<span class="sc">$</span>age)</span>
<span id="cb54-1159"><a href="#cb54-1159" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1160"><a href="#cb54-1160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1161"><a href="#cb54-1161" aria-hidden="true" tabindex="-1"></a>And we can plot these estimands:</span>
<span id="cb54-1162"><a href="#cb54-1162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1165"><a href="#cb54-1165" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1166"><a href="#cb54-1166" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-age-posterior-only</span></span>
<span id="cb54-1167"><a href="#cb54-1167" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Posterior proportion of survey respondents older than 36 compared to the national proportion, and posterior differences between sample and national proportions (like @fig-age-sample-prop-freq, but Bayesian)</span></span>
<span id="cb54-1168"><a href="#cb54-1168" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb54-1169"><a href="#cb54-1169" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb54-1170"><a href="#cb54-1170" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 3</span></span>
<span id="cb54-1171"><a href="#cb54-1171" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: 90%</span></span>
<span id="cb54-1172"><a href="#cb54-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1173"><a href="#cb54-1173" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(age_draws, <span class="fu">aes</span>(<span class="at">x =</span> b_Intercept, <span class="at">y =</span> <span class="st">"Age (% 36+)"</span>)) <span class="sc">+</span> </span>
<span id="cb54-1174"><a href="#cb54-1174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">fill =</span> clrs[<span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb54-1175"><a href="#cb54-1175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> national_values<span class="sc">$</span>age, <span class="at">color =</span> clrs[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb54-1176"><a href="#cb54-1176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb54-1177"><a href="#cb54-1177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">1.5</span>)) <span class="sc">+</span></span>
<span id="cb54-1178"><a href="#cb54-1178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Proportion older than 36"</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb54-1179"><a href="#cb54-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1180"><a href="#cb54-1180" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(age_draws, <span class="fu">aes</span>(<span class="at">x =</span> diff, <span class="at">y =</span> <span class="st">"Age (% 36+)"</span>)) <span class="sc">+</span> </span>
<span id="cb54-1181"><a href="#cb54-1181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">fill =</span> clrs[<span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb54-1182"><a href="#cb54-1182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clrs[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb54-1183"><a href="#cb54-1183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> label_pp) <span class="sc">+</span></span>
<span id="cb54-1184"><a href="#cb54-1184" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">1.5</span>)) <span class="sc">+</span></span>
<span id="cb54-1185"><a href="#cb54-1185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Difference from CPS"</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb54-1186"><a href="#cb54-1186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1187"><a href="#cb54-1187" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">/</span> p2</span>
<span id="cb54-1188"><a href="#cb54-1188" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1189"><a href="#cb54-1189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1190"><a href="#cb54-1190" aria-hidden="true" tabindex="-1"></a>The population value is in the sample posterior, which means that the posterior difference between the sample and population includes 0, but that doesn't tell us much about how likely that is. We could calculate the probability that the difference isn't equal to 0, but that's relatively useless—zero is a single point, and the probability that the posterior is different from that one point is infinite.</span>
<span id="cb54-1191"><a href="#cb54-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1192"><a href="#cb54-1192" aria-hidden="true" tabindex="-1"></a><span class="fu">## The region of practical equivalence (ROPE)</span></span>
<span id="cb54-1193"><a href="#cb54-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1194"><a href="#cb54-1194" aria-hidden="true" tabindex="-1"></a>Another approach is to think of a range of values around 0 that all have "practically no effect." I like to think of this as a sort of "dead zone." If the difference between the sample and the population is 0, we can safely conclude that there's no difference between the two. If the measured difference were 0.3 percentage points, or −0.6 percentage points, or even 2 percentage points, I'd still feel pretty confident that that's basically the same. Bayesians call this the <span class="co">[</span><span class="ot">region of practical equivalence</span><span class="co">](https://easystats.github.io/bayestestR/articles/region_of_practical_equivalence.html)</span>, or ROPE <span class="co">[</span><span class="ot">@Kruschke:2010a; @Kruschke:2015; @KruschkeAguinisJoo:2012; @KruschkeLiddell:2018</span><span class="co">]</span>.</span>
<span id="cb54-1195"><a href="#cb54-1195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1196"><a href="#cb54-1196" aria-hidden="true" tabindex="-1"></a>There are lots of ways to define this ROPE or dead zone. You can base it on experience with the phenomenon, or you can base it on data that you have. @KruschkeLiddell:2018 suggest looking at a tenth of the variable's standard deviation above and below the main null value, or</span>
<span id="cb54-1197"><a href="#cb54-1197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1198"><a href="#cb54-1198" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb54-1199"><a href="#cb54-1199" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">-0.1 \times SD_y, 0.1 \times SD_y</span><span class="co">]</span></span>
<span id="cb54-1200"><a href="#cb54-1200" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb54-1201"><a href="#cb54-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1202"><a href="#cb54-1202" aria-hidden="true" tabindex="-1"></a>To illustrate, let's find the ROPE for the proportion of people older than 36 with ±0.1 × standard deviation:</span>
<span id="cb54-1203"><a href="#cb54-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1206"><a href="#cb54-1206" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1207"><a href="#cb54-1207" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-age-rope</span></span>
<span id="cb54-1208"><a href="#cb54-1208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1209"><a href="#cb54-1209" aria-hidden="true" tabindex="-1"></a>age_rope <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb54-1210"><a href="#cb54-1210" aria-hidden="true" tabindex="-1"></a>  <span class="at">avg_age =</span> national_values<span class="sc">$</span>age,</span>
<span id="cb54-1211"><a href="#cb54-1211" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd_age =</span> national_values<span class="sc">$</span>age_sd</span>
<span id="cb54-1212"><a href="#cb54-1212" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb54-1213"><a href="#cb54-1213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb54-1214"><a href="#cb54-1214" aria-hidden="true" tabindex="-1"></a>    <span class="at">rope_low =</span> <span class="sc">-</span><span class="fl">0.1</span> <span class="sc">*</span> sd_age,</span>
<span id="cb54-1215"><a href="#cb54-1215" aria-hidden="true" tabindex="-1"></a>    <span class="at">rope_avg_low =</span> avg_age <span class="sc">+</span> rope_low,</span>
<span id="cb54-1216"><a href="#cb54-1216" aria-hidden="true" tabindex="-1"></a>    <span class="at">rope_high =</span> <span class="fl">0.1</span> <span class="sc">*</span> sd_age,</span>
<span id="cb54-1217"><a href="#cb54-1217" aria-hidden="true" tabindex="-1"></a>    <span class="at">rope_avg_high =</span> avg_age <span class="sc">+</span> rope_high</span>
<span id="cb54-1218"><a href="#cb54-1218" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-1219"><a href="#cb54-1219" aria-hidden="true" tabindex="-1"></a>age_rope</span>
<span id="cb54-1220"><a href="#cb54-1220" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1221"><a href="#cb54-1221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1222"><a href="#cb54-1222" aria-hidden="true" tabindex="-1"></a>Following this rule, we shouldn't care about sample/population differences between ±4.99 percentage points. For all intents and purposes, any differences in that range—or any sample proportions between 53% ± 4.99 (or 48%–58%)—are equivalent.</span>
<span id="cb54-1223"><a href="#cb54-1223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1224"><a href="#cb54-1224" aria-hidden="true" tabindex="-1"></a>Here's what the ROPE for age looks like, both for the full proportion and for the difference:</span>
<span id="cb54-1225"><a href="#cb54-1225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1228"><a href="#cb54-1228" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1229"><a href="#cb54-1229" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-age-rope</span></span>
<span id="cb54-1230"><a href="#cb54-1230" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Posterior proportion of survey respondents older than 36 compared to the national proportion, and posterior differences between sample and national proportions, overlaid on a region of practical equivalence (ROPE)</span></span>
<span id="cb54-1231"><a href="#cb54-1231" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb54-1232"><a href="#cb54-1232" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb54-1233"><a href="#cb54-1233" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 3</span></span>
<span id="cb54-1234"><a href="#cb54-1234" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: 90%</span></span>
<span id="cb54-1235"><a href="#cb54-1235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1236"><a href="#cb54-1236" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(age_draws, <span class="fu">aes</span>(<span class="at">x =</span> b_Intercept, <span class="at">y =</span> <span class="st">"Age (% 36+)"</span>)) <span class="sc">+</span> </span>
<span id="cb54-1237"><a href="#cb54-1237" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb54-1238"><a href="#cb54-1238" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">"rect"</span>, </span>
<span id="cb54-1239"><a href="#cb54-1239" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmin =</span> age_rope<span class="sc">$</span>rope_avg_low, </span>
<span id="cb54-1240"><a href="#cb54-1240" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmax =</span> age_rope<span class="sc">$</span>rope_avg_high, </span>
<span id="cb54-1241"><a href="#cb54-1241" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> <span class="dv">1</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>, </span>
<span id="cb54-1242"><a href="#cb54-1242" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> clrs[<span class="dv">2</span>], <span class="at">alpha =</span> <span class="fl">0.2</span></span>
<span id="cb54-1243"><a href="#cb54-1243" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb54-1244"><a href="#cb54-1244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">fill =</span> clrs[<span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb54-1245"><a href="#cb54-1245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> age_rope<span class="sc">$</span>avg_age, <span class="at">color =</span> clrs[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb54-1246"><a href="#cb54-1246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb54-1247"><a href="#cb54-1247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">1.5</span>)) <span class="sc">+</span></span>
<span id="cb54-1248"><a href="#cb54-1248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Proportion older than 36"</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb54-1249"><a href="#cb54-1249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1250"><a href="#cb54-1250" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(age_draws, <span class="fu">aes</span>(<span class="at">x =</span> diff, <span class="at">y =</span> <span class="st">"Age (% 36+)"</span>)) <span class="sc">+</span> </span>
<span id="cb54-1251"><a href="#cb54-1251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb54-1252"><a href="#cb54-1252" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">"rect"</span>, </span>
<span id="cb54-1253"><a href="#cb54-1253" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmin =</span> age_rope<span class="sc">$</span>rope_low, </span>
<span id="cb54-1254"><a href="#cb54-1254" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmax =</span> age_rope<span class="sc">$</span>rope_high, </span>
<span id="cb54-1255"><a href="#cb54-1255" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> <span class="dv">1</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>, </span>
<span id="cb54-1256"><a href="#cb54-1256" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> clrs[<span class="dv">2</span>], <span class="at">alpha =</span> <span class="fl">0.2</span></span>
<span id="cb54-1257"><a href="#cb54-1257" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb54-1258"><a href="#cb54-1258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">fill =</span> clrs[<span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb54-1259"><a href="#cb54-1259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clrs[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb54-1260"><a href="#cb54-1260" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> label_pp) <span class="sc">+</span></span>
<span id="cb54-1261"><a href="#cb54-1261" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">1.5</span>)) <span class="sc">+</span></span>
<span id="cb54-1262"><a href="#cb54-1262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Difference from CPS"</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb54-1263"><a href="#cb54-1263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1264"><a href="#cb54-1264" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">/</span> p2</span>
<span id="cb54-1265"><a href="#cb54-1265" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1266"><a href="#cb54-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1267"><a href="#cb54-1267" aria-hidden="true" tabindex="-1"></a>A huge chunk of that posterior distribution is inside the ROPE dead zone. We can calculate the exact proportion:</span>
<span id="cb54-1268"><a href="#cb54-1268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1271"><a href="#cb54-1271" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1272"><a href="#cb54-1272" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-age-prop-rope</span></span>
<span id="cb54-1273"><a href="#cb54-1273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1274"><a href="#cb54-1274" aria-hidden="true" tabindex="-1"></a>prop_in_rope <span class="ot">&lt;-</span> age_draws <span class="sc">|&gt;</span> </span>
<span id="cb54-1275"><a href="#cb54-1275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb54-1276"><a href="#cb54-1276" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_below_rope =</span> diff <span class="sc">&lt;</span> age_rope<span class="sc">$</span>rope_low,</span>
<span id="cb54-1277"><a href="#cb54-1277" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_above_rope =</span> diff <span class="sc">&gt;</span> age_rope<span class="sc">$</span>rope_high</span>
<span id="cb54-1278"><a href="#cb54-1278" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb54-1279"><a href="#cb54-1279" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">is_inside_rope =</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">mean</span>(is_below_rope <span class="sc">|</span> is_above_rope))</span>
<span id="cb54-1280"><a href="#cb54-1280" aria-hidden="true" tabindex="-1"></a>prop_in_rope<span class="sc">$</span>is_inside_rope</span>
<span id="cb54-1281"><a href="#cb54-1281" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1282"><a href="#cb54-1282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1283"><a href="#cb54-1283" aria-hidden="true" tabindex="-1"></a><span class="in">`r label_percent(accuracy = 0.1)(prop_in_rope$is_inside_rope)`</span> of the posterior is inside the ROPE, which means that there's a <span class="in">`r label_percent(accuracy = 0.1)(prop_in_rope$is_inside_rope)`</span> probability that the sample matches the population. </span>
<span id="cb54-1284"><a href="#cb54-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1285"><a href="#cb54-1285" aria-hidden="true" tabindex="-1"></a>That's *way* cooler and *way* more interpretable than null hypothesis testing.</span>
<span id="cb54-1286"><a href="#cb54-1286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1287"><a href="#cb54-1287" aria-hidden="true" tabindex="-1"></a>&lt;hr class="dinkus"&gt;</span>
<span id="cb54-1288"><a href="#cb54-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1289"><a href="#cb54-1289" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb54-1290"><a href="#cb54-1290" aria-hidden="true" tabindex="-1"></a><span class="fu">### BONUS: Faster, more automatic ROPE calculations</span></span>
<span id="cb54-1291"><a href="#cb54-1291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1292"><a href="#cb54-1292" aria-hidden="true" tabindex="-1"></a>We just went through a lot of work ↑ up there to calculate the bounds of the ROPE and then find how much of the posterior is in it.</span>
<span id="cb54-1293"><a href="#cb54-1293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1294"><a href="#cb54-1294" aria-hidden="true" tabindex="-1"></a>There's a faster and easier way! The {bayestestR} package has a <span class="in">`rope()`</span> function that can do it automatically.</span>
<span id="cb54-1295"><a href="#cb54-1295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1298"><a href="#cb54-1298" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1299"><a href="#cb54-1299" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-age-rope-bayestestR</span></span>
<span id="cb54-1300"><a href="#cb54-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1301"><a href="#cb54-1301" aria-hidden="true" tabindex="-1"></a>model_age_binomial <span class="sc">|&gt;</span> </span>
<span id="cb54-1302"><a href="#cb54-1302" aria-hidden="true" tabindex="-1"></a>  bayestestR<span class="sc">::</span><span class="fu">rope</span>(<span class="at">ci =</span> <span class="dv">1</span>)</span>
<span id="cb54-1303"><a href="#cb54-1303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1304"><a href="#cb54-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1305"><a href="#cb54-1305" aria-hidden="true" tabindex="-1"></a>It doesn't give exactly the same result as before because the automatic ROPE limits (<span class="in">`range`</span> here) aren't based on the weighted standard deviation, but we can define that range ourselves:</span>
<span id="cb54-1306"><a href="#cb54-1306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1309"><a href="#cb54-1309" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1310"><a href="#cb54-1310" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-age-rope-bayestestR-manual-range</span></span>
<span id="cb54-1311"><a href="#cb54-1311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1312"><a href="#cb54-1312" aria-hidden="true" tabindex="-1"></a>model_age_binomial <span class="sc">|&gt;</span> </span>
<span id="cb54-1313"><a href="#cb54-1313" aria-hidden="true" tabindex="-1"></a>  bayestestR<span class="sc">::</span><span class="fu">rope</span>(</span>
<span id="cb54-1314"><a href="#cb54-1314" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci =</span> <span class="dv">1</span>, </span>
<span id="cb54-1315"><a href="#cb54-1315" aria-hidden="true" tabindex="-1"></a>    <span class="at">range =</span> <span class="fu">c</span>(age_rope<span class="sc">$</span>rope_avg_low, age_rope<span class="sc">$</span>rope_avg_high)</span>
<span id="cb54-1316"><a href="#cb54-1316" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-1317"><a href="#cb54-1317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1318"><a href="#cb54-1318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1319"><a href="#cb54-1319" aria-hidden="true" tabindex="-1"></a><span class="in">`bayestestR::rope()`</span> is incorporated in the {parameters} package too, so you can do this:</span>
<span id="cb54-1320"><a href="#cb54-1320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1323"><a href="#cb54-1323" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1324"><a href="#cb54-1324" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-age-rope-parameters</span></span>
<span id="cb54-1325"><a href="#cb54-1325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1326"><a href="#cb54-1326" aria-hidden="true" tabindex="-1"></a>model_age_binomial <span class="sc">|&gt;</span> </span>
<span id="cb54-1327"><a href="#cb54-1327" aria-hidden="true" tabindex="-1"></a>  parameters<span class="sc">::</span><span class="fu">model_parameters</span>(</span>
<span id="cb54-1328"><a href="#cb54-1328" aria-hidden="true" tabindex="-1"></a>    <span class="at">test =</span> <span class="st">"rope"</span>,</span>
<span id="cb54-1329"><a href="#cb54-1329" aria-hidden="true" tabindex="-1"></a>    <span class="at">rope_ci =</span> <span class="dv">1</span>, </span>
<span id="cb54-1330"><a href="#cb54-1330" aria-hidden="true" tabindex="-1"></a>    <span class="at">rope_range =</span> <span class="fu">c</span>(age_rope<span class="sc">$</span>rope_avg_low, age_rope<span class="sc">$</span>rope_avg_high),</span>
<span id="cb54-1331"><a href="#cb54-1331" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb54-1332"><a href="#cb54-1332" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-1333"><a href="#cb54-1333" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1334"><a href="#cb54-1334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1335"><a href="#cb54-1335" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb54-1336"><a href="#cb54-1336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1337"><a href="#cb54-1337" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb54-1338"><a href="#cb54-1338" aria-hidden="true" tabindex="-1"></a><span class="fu">### BONUS: How much of the posterior should we count?</span></span>
<span id="cb54-1339"><a href="#cb54-1339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1340"><a href="#cb54-1340" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">There are big debates in the ROPE world</span><span class="co">](https://easystats.github.io/bayestestR/articles/region_of_practical_equivalence.html#credible-interval-in-rope-vs-full-posterior-in-rope)</span> about how much of the posterior we should look at when working with ROPEs. We just looked at the 100% of the sample posterior. Some people <span class="co">[</span><span class="ot">@Kruschke:2015; @McElreath:2020</span><span class="co">]</span> say to look instead at how much of the 95% (or 89%) highest density interval (HDI) falls within the ROPE.</span>
<span id="cb54-1341"><a href="#cb54-1341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1342"><a href="#cb54-1342" aria-hidden="true" tabindex="-1"></a>I have no strong preferences either way, and it's fairly straightforward to calculate the proportion of the HDI in the ROPE. Here's an example with a Richard McElreath-style 89% HDI:</span>
<span id="cb54-1343"><a href="#cb54-1343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1346"><a href="#cb54-1346" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1347"><a href="#cb54-1347" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-age-rope-89-manual</span></span>
<span id="cb54-1348"><a href="#cb54-1348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1349"><a href="#cb54-1349" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the 89% HDI</span></span>
<span id="cb54-1350"><a href="#cb54-1350" aria-hidden="true" tabindex="-1"></a>age_hdi <span class="ot">&lt;-</span> age_draws <span class="sc">|&gt;</span> </span>
<span id="cb54-1351"><a href="#cb54-1351" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_hdi</span>(diff, <span class="at">.width =</span> <span class="fl">0.89</span>)</span>
<span id="cb54-1352"><a href="#cb54-1352" aria-hidden="true" tabindex="-1"></a>age_hdi</span>
<span id="cb54-1353"><a href="#cb54-1353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1354"><a href="#cb54-1354" aria-hidden="true" tabindex="-1"></a><span class="co"># Find how much of the the age HDI is in the ROPE</span></span>
<span id="cb54-1355"><a href="#cb54-1355" aria-hidden="true" tabindex="-1"></a>age_draws <span class="sc">|&gt;</span> </span>
<span id="cb54-1356"><a href="#cb54-1356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(diff <span class="sc">&gt;=</span> age_hdi<span class="sc">$</span>.lower <span class="sc">&amp;</span> diff <span class="sc">&lt;=</span> age_hdi<span class="sc">$</span>.upper) <span class="sc">|&gt;</span> </span>
<span id="cb54-1357"><a href="#cb54-1357" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb54-1358"><a href="#cb54-1358" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_below_rope =</span> diff <span class="sc">&lt;</span> age_rope<span class="sc">$</span>rope_low,</span>
<span id="cb54-1359"><a href="#cb54-1359" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_above_rope =</span> diff <span class="sc">&gt;</span> age_rope<span class="sc">$</span>rope_high</span>
<span id="cb54-1360"><a href="#cb54-1360" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb54-1361"><a href="#cb54-1361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">is_inside_rope =</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">mean</span>(is_below_rope <span class="sc">|</span> is_above_rope))</span>
<span id="cb54-1362"><a href="#cb54-1362" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1363"><a href="#cb54-1363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1364"><a href="#cb54-1364" aria-hidden="true" tabindex="-1"></a>Or with the more automatic <span class="in">`bayestestR::rope()`</span>:</span>
<span id="cb54-1365"><a href="#cb54-1365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1368"><a href="#cb54-1368" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1369"><a href="#cb54-1369" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-age-rope-89-bayestestR</span></span>
<span id="cb54-1370"><a href="#cb54-1370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1371"><a href="#cb54-1371" aria-hidden="true" tabindex="-1"></a>model_age_binomial <span class="sc">|&gt;</span> </span>
<span id="cb54-1372"><a href="#cb54-1372" aria-hidden="true" tabindex="-1"></a>  bayestestR<span class="sc">::</span><span class="fu">rope</span>(</span>
<span id="cb54-1373"><a href="#cb54-1373" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci =</span> <span class="fl">0.89</span>, </span>
<span id="cb54-1374"><a href="#cb54-1374" aria-hidden="true" tabindex="-1"></a>    <span class="at">range =</span> <span class="fu">c</span>(age_rope<span class="sc">$</span>rope_avg_low, age_rope<span class="sc">$</span>rope_avg_high)</span>
<span id="cb54-1375"><a href="#cb54-1375" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-1376"><a href="#cb54-1376" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1377"><a href="#cb54-1377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1378"><a href="#cb54-1378" aria-hidden="true" tabindex="-1"></a>In this case, 100% of the HDI is in the ROPE, so we can say that the age proportion is equivalent to the population proportion.</span>
<span id="cb54-1379"><a href="#cb54-1379" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb54-1380"><a href="#cb54-1380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1381"><a href="#cb54-1381" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bayesian proportion test for volunteering</span></span>
<span id="cb54-1382"><a href="#cb54-1382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1383"><a href="#cb54-1383" aria-hidden="true" tabindex="-1"></a>Let's look at volunteer status by itself next, to keep things parallel with <span class="co">[</span><span class="ot">the frequentist section earlier</span><span class="co">](#one-sample-proportion-test-for-volunteering)</span>.</span>
<span id="cb54-1384"><a href="#cb54-1384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1385"><a href="#cb54-1385" aria-hidden="true" tabindex="-1"></a>We'll make a little one-row dataset:</span>
<span id="cb54-1386"><a href="#cb54-1386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1389"><a href="#cb54-1389" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1390"><a href="#cb54-1390" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: make-little-vol-df</span></span>
<span id="cb54-1391"><a href="#cb54-1391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1392"><a href="#cb54-1392" aria-hidden="true" tabindex="-1"></a>vol_binomial_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb54-1393"><a href="#cb54-1393" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_yes =</span> <span class="fu">sum</span>(results_to_test<span class="sc">$</span>volunteering),</span>
<span id="cb54-1394"><a href="#cb54-1394" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_total =</span> <span class="fu">nrow</span>(results_to_test)</span>
<span id="cb54-1395"><a href="#cb54-1395" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-1396"><a href="#cb54-1396" aria-hidden="true" tabindex="-1"></a>vol_binomial_df</span>
<span id="cb54-1397"><a href="#cb54-1397" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1398"><a href="#cb54-1398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1399"><a href="#cb54-1399" aria-hidden="true" tabindex="-1"></a>Then we'll use it to model the proportion/probability of volunteering:</span>
<span id="cb54-1400"><a href="#cb54-1400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1403"><a href="#cb54-1403" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1404"><a href="#cb54-1404" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: model-vol-binomial</span></span>
<span id="cb54-1405"><a href="#cb54-1405" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hide</span></span>
<span id="cb54-1406"><a href="#cb54-1406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1407"><a href="#cb54-1407" aria-hidden="true" tabindex="-1"></a>model_vol_binomial <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb54-1408"><a href="#cb54-1408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(n_yes <span class="sc">|</span> <span class="fu">trials</span>(n_total) <span class="sc">~</span> <span class="dv">1</span>),</span>
<span id="cb54-1409"><a href="#cb54-1409" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> vol_binomial_df,</span>
<span id="cb54-1410"><a href="#cb54-1410" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"identity"</span>),</span>
<span id="cb54-1411"><a href="#cb54-1411" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">beta</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">class =</span> <span class="st">"Intercept"</span>, <span class="at">lb =</span> <span class="dv">0</span>, <span class="at">ub =</span> <span class="dv">1</span>)),</span>
<span id="cb54-1412"><a href="#cb54-1412" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> CHAINS, <span class="at">warmup =</span> WARMUP, <span class="at">iter =</span> ITER, <span class="at">seed =</span> BAYES_SEED,</span>
<span id="cb54-1413"><a href="#cb54-1413" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb54-1414"><a href="#cb54-1414" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"models/model_vol_binomial"</span></span>
<span id="cb54-1415"><a href="#cb54-1415" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-1416"><a href="#cb54-1416" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1417"><a href="#cb54-1417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1420"><a href="#cb54-1420" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1421"><a href="#cb54-1421" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-vol-draws</span></span>
<span id="cb54-1422"><a href="#cb54-1422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1423"><a href="#cb54-1423" aria-hidden="true" tabindex="-1"></a>vol_draws <span class="ot">&lt;-</span> model_vol_binomial <span class="sc">|&gt;</span> </span>
<span id="cb54-1424"><a href="#cb54-1424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_draws</span>(b_Intercept) <span class="sc">|&gt;</span> </span>
<span id="cb54-1425"><a href="#cb54-1425" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> b_Intercept <span class="sc">-</span> national_values<span class="sc">$</span>volunteering)</span>
<span id="cb54-1426"><a href="#cb54-1426" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1427"><a href="#cb54-1427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1428"><a href="#cb54-1428" aria-hidden="true" tabindex="-1"></a>We can calculate the ROPE for the proportion volunteering, or ±0.1 × SD~volunteering~</span>
<span id="cb54-1429"><a href="#cb54-1429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1432"><a href="#cb54-1432" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1433"><a href="#cb54-1433" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-vol-rope</span></span>
<span id="cb54-1434"><a href="#cb54-1434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1435"><a href="#cb54-1435" aria-hidden="true" tabindex="-1"></a>vol_rope <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb54-1436"><a href="#cb54-1436" aria-hidden="true" tabindex="-1"></a>  <span class="at">avg_vol =</span> national_values<span class="sc">$</span>volunteering,</span>
<span id="cb54-1437"><a href="#cb54-1437" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd_vol =</span> national_values<span class="sc">$</span>volunteering_sd</span>
<span id="cb54-1438"><a href="#cb54-1438" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb54-1439"><a href="#cb54-1439" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb54-1440"><a href="#cb54-1440" aria-hidden="true" tabindex="-1"></a>    <span class="at">rope_low =</span> <span class="sc">-</span><span class="fl">0.1</span> <span class="sc">*</span> sd_vol,</span>
<span id="cb54-1441"><a href="#cb54-1441" aria-hidden="true" tabindex="-1"></a>    <span class="at">rope_avg_low =</span> avg_vol <span class="sc">+</span> rope_low,</span>
<span id="cb54-1442"><a href="#cb54-1442" aria-hidden="true" tabindex="-1"></a>    <span class="at">rope_high =</span> <span class="fl">0.1</span> <span class="sc">*</span> sd_vol,</span>
<span id="cb54-1443"><a href="#cb54-1443" aria-hidden="true" tabindex="-1"></a>    <span class="at">rope_avg_high =</span> avg_vol <span class="sc">+</span> rope_high</span>
<span id="cb54-1444"><a href="#cb54-1444" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-1445"><a href="#cb54-1445" aria-hidden="true" tabindex="-1"></a>vol_rope</span>
<span id="cb54-1446"><a href="#cb54-1446" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1447"><a href="#cb54-1447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1448"><a href="#cb54-1448" aria-hidden="true" tabindex="-1"></a>And finally we can visualize things and calculate how much of the posterior fits inside the ROPE:</span>
<span id="cb54-1449"><a href="#cb54-1449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1452"><a href="#cb54-1452" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1453"><a href="#cb54-1453" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-vol-rope</span></span>
<span id="cb54-1454"><a href="#cb54-1454" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Posterior proportion of survey respondents that volunteer to the national proportion, and posterior differences between sample and national proportions, overlaid on a region of practical equivalence (ROPE); like @fig-age-sample-prop-vol, but Bayesian</span></span>
<span id="cb54-1455"><a href="#cb54-1455" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb54-1456"><a href="#cb54-1456" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb54-1457"><a href="#cb54-1457" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 3</span></span>
<span id="cb54-1458"><a href="#cb54-1458" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: 90%</span></span>
<span id="cb54-1459"><a href="#cb54-1459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1460"><a href="#cb54-1460" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(vol_draws, <span class="fu">aes</span>(<span class="at">x =</span> b_Intercept, <span class="at">y =</span> <span class="st">"Volunteered in past year (%)"</span>)) <span class="sc">+</span> </span>
<span id="cb54-1461"><a href="#cb54-1461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb54-1462"><a href="#cb54-1462" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">"rect"</span>, </span>
<span id="cb54-1463"><a href="#cb54-1463" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmin =</span> vol_rope<span class="sc">$</span>rope_avg_low, </span>
<span id="cb54-1464"><a href="#cb54-1464" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmax =</span> vol_rope<span class="sc">$</span>rope_avg_high, </span>
<span id="cb54-1465"><a href="#cb54-1465" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> <span class="dv">1</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>, </span>
<span id="cb54-1466"><a href="#cb54-1466" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> clrs[<span class="dv">2</span>], <span class="at">alpha =</span> <span class="fl">0.2</span></span>
<span id="cb54-1467"><a href="#cb54-1467" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb54-1468"><a href="#cb54-1468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">fill =</span> clrs[<span class="dv">8</span>]) <span class="sc">+</span></span>
<span id="cb54-1469"><a href="#cb54-1469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> vol_rope<span class="sc">$</span>avg_vol, <span class="at">color =</span> clrs[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb54-1470"><a href="#cb54-1470" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb54-1471"><a href="#cb54-1471" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">1.5</span>)) <span class="sc">+</span></span>
<span id="cb54-1472"><a href="#cb54-1472" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Proportion"</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb54-1473"><a href="#cb54-1473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1474"><a href="#cb54-1474" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(vol_draws, <span class="fu">aes</span>(<span class="at">x =</span> diff, <span class="at">y =</span> <span class="st">"Volunteered in past year (%)"</span>)) <span class="sc">+</span> </span>
<span id="cb54-1475"><a href="#cb54-1475" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb54-1476"><a href="#cb54-1476" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">"rect"</span>, </span>
<span id="cb54-1477"><a href="#cb54-1477" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmin =</span> vol_rope<span class="sc">$</span>rope_low, </span>
<span id="cb54-1478"><a href="#cb54-1478" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmax =</span> vol_rope<span class="sc">$</span>rope_high, </span>
<span id="cb54-1479"><a href="#cb54-1479" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> <span class="dv">1</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>, </span>
<span id="cb54-1480"><a href="#cb54-1480" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> clrs[<span class="dv">2</span>], <span class="at">alpha =</span> <span class="fl">0.2</span></span>
<span id="cb54-1481"><a href="#cb54-1481" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb54-1482"><a href="#cb54-1482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">fill =</span> clrs[<span class="dv">8</span>]) <span class="sc">+</span></span>
<span id="cb54-1483"><a href="#cb54-1483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clrs[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb54-1484"><a href="#cb54-1484" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> label_pp) <span class="sc">+</span></span>
<span id="cb54-1485"><a href="#cb54-1485" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">1.5</span>)) <span class="sc">+</span></span>
<span id="cb54-1486"><a href="#cb54-1486" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Difference from CPS"</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb54-1487"><a href="#cb54-1487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1488"><a href="#cb54-1488" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">/</span> p2</span>
<span id="cb54-1489"><a href="#cb54-1489" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1490"><a href="#cb54-1490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1491"><a href="#cb54-1491" aria-hidden="true" tabindex="-1"></a>As we saw with the frequentist version of this analysis, the proportion of people who volunteer is *substantially* different from the CPS—≈30 percentage points higher! The probability that the sample is equivalent to the CPS population is 0:</span>
<span id="cb54-1492"><a href="#cb54-1492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1495"><a href="#cb54-1495" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1496"><a href="#cb54-1496" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-vol-prop-rope</span></span>
<span id="cb54-1497"><a href="#cb54-1497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1498"><a href="#cb54-1498" aria-hidden="true" tabindex="-1"></a>vol_draws <span class="sc">|&gt;</span> </span>
<span id="cb54-1499"><a href="#cb54-1499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb54-1500"><a href="#cb54-1500" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_below_rope =</span> b_Intercept <span class="sc">&lt;</span> vol_rope<span class="sc">$</span>rope_avg_low,</span>
<span id="cb54-1501"><a href="#cb54-1501" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_above_rope =</span> b_Intercept <span class="sc">&gt;</span> vol_rope<span class="sc">$</span>rope_avg_high</span>
<span id="cb54-1502"><a href="#cb54-1502" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb54-1503"><a href="#cb54-1503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">is_inside_rope =</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">mean</span>(is_below_rope <span class="sc">|</span> is_above_rope))</span>
<span id="cb54-1504"><a href="#cb54-1504" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1505"><a href="#cb54-1505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1506"><a href="#cb54-1506" aria-hidden="true" tabindex="-1"></a><span class="fu">## Posterior proportions, differences, and ROPEs for everything all at once</span></span>
<span id="cb54-1507"><a href="#cb54-1507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1508"><a href="#cb54-1508" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Like we did before with the frequentist approach</span><span class="co">](#proportion-tests-and-differences-for-everything-all-at-once)</span>, we'll make a little wrapper function for this process. It's a little more complex, and we'll make it return a list of lots of things: the original {brms} model, a long data frame of all the MCMC draws, a data frame with the ROPE bounds, and the probability that the full posterior is in the ROPE.</span>
<span id="cb54-1509"><a href="#cb54-1509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1512"><a href="#cb54-1512" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1513"><a href="#cb54-1513" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fun-prop-test-bayes</span></span>
<span id="cb54-1514"><a href="#cb54-1514" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb54-1515"><a href="#cb54-1515" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "`prop_test_bayes()` wrapper function"</span></span>
<span id="cb54-1516"><a href="#cb54-1516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1517"><a href="#cb54-1517" aria-hidden="true" tabindex="-1"></a><span class="co">#' Perform a Bayesian proportion test using a beta-binomial model</span></span>
<span id="cb54-1518"><a href="#cb54-1518" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb54-1519"><a href="#cb54-1519" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param short_name A character string representing a short name for the model file.</span></span>
<span id="cb54-1520"><a href="#cb54-1520" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param sample_column A numeric vector representing the sample data (0/1 or logical).</span></span>
<span id="cb54-1521"><a href="#cb54-1521" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param cps_prop A numeric value representing the population proportion to compare against.</span></span>
<span id="cb54-1522"><a href="#cb54-1522" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param cps_sd A numeric value representing the standard deviation of the population proportion.</span></span>
<span id="cb54-1523"><a href="#cb54-1523" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return A list containing the model, MCMC draws, ROPE details, and the proportion of the posterior</span></span>
<span id="cb54-1524"><a href="#cb54-1524" aria-hidden="true" tabindex="-1"></a><span class="co">#'         inside the ROPE.</span></span>
<span id="cb54-1525"><a href="#cb54-1525" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb54-1526"><a href="#cb54-1526" aria-hidden="true" tabindex="-1"></a><span class="co">#' sample_data &lt;- c(1, 0, 1, 1, 0, 1, 0, 1, 1, 0)</span></span>
<span id="cb54-1527"><a href="#cb54-1527" aria-hidden="true" tabindex="-1"></a><span class="co">#' cps_prop &lt;- 0.5</span></span>
<span id="cb54-1528"><a href="#cb54-1528" aria-hidden="true" tabindex="-1"></a><span class="co">#' cps_sd &lt;- 0.1</span></span>
<span id="cb54-1529"><a href="#cb54-1529" aria-hidden="true" tabindex="-1"></a><span class="co">#' prop_test_bayes("example", sample_data, cps_prop, cps_sd)</span></span>
<span id="cb54-1530"><a href="#cb54-1530" aria-hidden="true" tabindex="-1"></a>prop_test_bayes <span class="ot">&lt;-</span> <span class="cf">function</span>(short_name, sample_column, cps_prop, cps_sd) {</span>
<span id="cb54-1531"><a href="#cb54-1531" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Little one-row data frame</span></span>
<span id="cb54-1532"><a href="#cb54-1532" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb54-1533"><a href="#cb54-1533" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_yes =</span> <span class="fu">sum</span>(sample_column),</span>
<span id="cb54-1534"><a href="#cb54-1534" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_total =</span> <span class="fu">length</span>(sample_column)</span>
<span id="cb54-1535"><a href="#cb54-1535" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-1536"><a href="#cb54-1536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1537"><a href="#cb54-1537" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intercept-only beta-binomial model</span></span>
<span id="cb54-1538"><a href="#cb54-1538" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb54-1539"><a href="#cb54-1539" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bf</span>(n_yes <span class="sc">|</span> <span class="fu">trials</span>(n_total) <span class="sc">~</span> <span class="dv">1</span>),</span>
<span id="cb54-1540"><a href="#cb54-1540" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df,</span>
<span id="cb54-1541"><a href="#cb54-1541" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"identity"</span>),</span>
<span id="cb54-1542"><a href="#cb54-1542" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">beta</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">class =</span> <span class="st">"Intercept"</span>, <span class="at">lb =</span> <span class="dv">0</span>, <span class="at">ub =</span> <span class="dv">1</span>)),</span>
<span id="cb54-1543"><a href="#cb54-1543" aria-hidden="true" tabindex="-1"></a>    <span class="at">chains =</span> CHAINS, <span class="at">warmup =</span> WARMUP, <span class="at">iter =</span> ITER, <span class="at">seed =</span> BAYES_SEED,</span>
<span id="cb54-1544"><a href="#cb54-1544" aria-hidden="true" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb54-1545"><a href="#cb54-1545" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="fu">glue</span>(<span class="st">"models/model_{short_name}_binomial"</span>)</span>
<span id="cb54-1546"><a href="#cb54-1546" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-1547"><a href="#cb54-1547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1548"><a href="#cb54-1548" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ROPE details</span></span>
<span id="cb54-1549"><a href="#cb54-1549" aria-hidden="true" tabindex="-1"></a>  rope <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb54-1550"><a href="#cb54-1550" aria-hidden="true" tabindex="-1"></a>    <span class="at">cps_avg =</span> cps_prop,</span>
<span id="cb54-1551"><a href="#cb54-1551" aria-hidden="true" tabindex="-1"></a>    <span class="at">cps_sd =</span> cps_sd</span>
<span id="cb54-1552"><a href="#cb54-1552" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb54-1553"><a href="#cb54-1553" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb54-1554"><a href="#cb54-1554" aria-hidden="true" tabindex="-1"></a>      <span class="at">rope_low =</span> <span class="sc">-</span><span class="fl">0.1</span> <span class="sc">*</span> cps_sd,</span>
<span id="cb54-1555"><a href="#cb54-1555" aria-hidden="true" tabindex="-1"></a>      <span class="at">rope_avg_low =</span> cps_avg <span class="sc">+</span> rope_low,</span>
<span id="cb54-1556"><a href="#cb54-1556" aria-hidden="true" tabindex="-1"></a>      <span class="at">rope_high =</span> <span class="fl">0.1</span> <span class="sc">*</span> cps_sd,</span>
<span id="cb54-1557"><a href="#cb54-1557" aria-hidden="true" tabindex="-1"></a>      <span class="at">rope_avg_high =</span> cps_avg <span class="sc">+</span> rope_high</span>
<span id="cb54-1558"><a href="#cb54-1558" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb54-1559"><a href="#cb54-1559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1560"><a href="#cb54-1560" aria-hidden="true" tabindex="-1"></a>  <span class="co"># MCMC draws of intercept and difference from population </span></span>
<span id="cb54-1561"><a href="#cb54-1561" aria-hidden="true" tabindex="-1"></a>  draws <span class="ot">&lt;-</span> model <span class="sc">|&gt;</span> </span>
<span id="cb54-1562"><a href="#cb54-1562" aria-hidden="true" tabindex="-1"></a>    <span class="fu">spread_draws</span>(b_Intercept) <span class="sc">|&gt;</span> </span>
<span id="cb54-1563"><a href="#cb54-1563" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">diff =</span> b_Intercept <span class="sc">-</span> cps_prop)</span>
<span id="cb54-1564"><a href="#cb54-1564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1565"><a href="#cb54-1565" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Proportion of posterior inside the ROPE</span></span>
<span id="cb54-1566"><a href="#cb54-1566" aria-hidden="true" tabindex="-1"></a>  prop_in_rope <span class="ot">&lt;-</span> draws <span class="sc">|&gt;</span> </span>
<span id="cb54-1567"><a href="#cb54-1567" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb54-1568"><a href="#cb54-1568" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_below_rope_full =</span> b_Intercept <span class="sc">&lt;</span> rope<span class="sc">$</span>rope_avg_low,</span>
<span id="cb54-1569"><a href="#cb54-1569" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_above_rope_full =</span> b_Intercept <span class="sc">&gt;</span> rope<span class="sc">$</span>rope_avg_high</span>
<span id="cb54-1570"><a href="#cb54-1570" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb54-1571"><a href="#cb54-1571" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">is_inside_rope_full =</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">mean</span>(is_below_rope_full <span class="sc">|</span> is_above_rope_full))</span>
<span id="cb54-1572"><a href="#cb54-1572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1573"><a href="#cb54-1573" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">lst</span>(model, draws, rope, prop_in_rope))</span>
<span id="cb54-1574"><a href="#cb54-1574" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-1575"><a href="#cb54-1575" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1576"><a href="#cb54-1576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1577"><a href="#cb54-1577" aria-hidden="true" tabindex="-1"></a>And as before, we'll make a little data frame with each of the variables we want to compare.</span>
<span id="cb54-1578"><a href="#cb54-1578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1581"><a href="#cb54-1581" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1582"><a href="#cb54-1582" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-prop-test-bayes</span></span>
<span id="cb54-1583"><a href="#cb54-1583" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb54-1584"><a href="#cb54-1584" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Create `sample_cps_props_bayes` and use `prop_test_bayes()` on each row"</span></span>
<span id="cb54-1585"><a href="#cb54-1585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1586"><a href="#cb54-1586" aria-hidden="true" tabindex="-1"></a>sample_cps_props_bayes <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb54-1587"><a href="#cb54-1587" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>category, <span class="sc">~</span>short_name, <span class="sc">~</span>variable, <span class="sc">~</span>sample_value, <span class="sc">~</span>national_value, <span class="sc">~</span>national_sd,</span>
<span id="cb54-1588"><a href="#cb54-1588" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Demographics"</span>, <span class="st">"age"</span>, <span class="st">"Age (% 36+)"</span>, results_to_test<span class="sc">$</span>age, national_values<span class="sc">$</span>age, national_values<span class="sc">$</span>age_sd,</span>
<span id="cb54-1589"><a href="#cb54-1589" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Demographics"</span>, <span class="st">"female"</span>, <span class="st">"Female (%)"</span>, results_to_test<span class="sc">$</span>female, national_values<span class="sc">$</span>female, national_values<span class="sc">$</span>female_sd,</span>
<span id="cb54-1590"><a href="#cb54-1590" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Demographics"</span>, <span class="st">"married"</span>, <span class="st">"Married (%)"</span>, results_to_test<span class="sc">$</span>married, national_values<span class="sc">$</span>married, national_values<span class="sc">$</span>married_sd,</span>
<span id="cb54-1591"><a href="#cb54-1591" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Demographics"</span>, <span class="st">"college"</span>, <span class="st">"Education (% BA+)"</span>, results_to_test<span class="sc">$</span>college, national_values<span class="sc">$</span>college, national_values<span class="sc">$</span>college_sd,</span>
<span id="cb54-1592"><a href="#cb54-1592" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Philanthropy"</span>, <span class="st">"donating"</span>, <span class="st">"Donated in past year (%)"</span>, results_to_test<span class="sc">$</span>donating, national_values<span class="sc">$</span>donating, national_values<span class="sc">$</span>donating_sd,</span>
<span id="cb54-1593"><a href="#cb54-1593" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Philanthropy"</span>, <span class="st">"volunteering"</span>, <span class="st">"Volunteered in past year (%)"</span>, results_to_test<span class="sc">$</span>volunteering, national_values<span class="sc">$</span>volunteering, national_values<span class="sc">$</span>volunteering_sd,</span>
<span id="cb54-1594"><a href="#cb54-1594" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Voting"</span>, <span class="st">"voting"</span>, <span class="st">"Voted in last November election (%)"</span>, results_to_test<span class="sc">$</span>voting, national_values<span class="sc">$</span>voting, national_values<span class="sc">$</span>voting_sd</span>
<span id="cb54-1595"><a href="#cb54-1595" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb54-1596"><a href="#cb54-1596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop_test_results =</span> <span class="fu">pmap</span>(</span>
<span id="cb54-1597"><a href="#cb54-1597" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(short_name, sample_value, national_value, national_sd),</span>
<span id="cb54-1598"><a href="#cb54-1598" aria-hidden="true" tabindex="-1"></a>    \(short_name, sample_value, national_value, national_sd) <span class="fu">prop_test_bayes</span>(short_name, sample_value, national_value, national_sd)</span>
<span id="cb54-1599"><a href="#cb54-1599" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb54-1600"><a href="#cb54-1600" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1601"><a href="#cb54-1601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1602"><a href="#cb54-1602" aria-hidden="true" tabindex="-1"></a>We'll then extract the MCMC draws and ROPE details from the little data frame so that we can make some plots and tables.</span>
<span id="cb54-1603"><a href="#cb54-1603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1606"><a href="#cb54-1606" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1607"><a href="#cb54-1607" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: extract-rope-draws</span></span>
<span id="cb54-1608"><a href="#cb54-1608" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb54-1609"><a href="#cb54-1609" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Extract draws and ROPE from `sample_cps_props_bayes` results"</span></span>
<span id="cb54-1610"><a href="#cb54-1610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1611"><a href="#cb54-1611" aria-hidden="true" tabindex="-1"></a>rope_details <span class="ot">&lt;-</span> sample_cps_props_bayes <span class="sc">|&gt;</span></span>
<span id="cb54-1612"><a href="#cb54-1612" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop_in_rope =</span> <span class="fu">map</span>(prop_test_results, \(x) x<span class="sc">$</span>prop_in_rope)) <span class="sc">|&gt;</span></span>
<span id="cb54-1613"><a href="#cb54-1613" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rope =</span> <span class="fu">map</span>(prop_test_results, \(x) x<span class="sc">$</span>rope)) <span class="sc">|&gt;</span></span>
<span id="cb54-1614"><a href="#cb54-1614" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sample_median =</span> <span class="fu">map_dbl</span>(prop_test_results, \(x) <span class="fu">median</span>(x<span class="sc">$</span>draws<span class="sc">$</span>b_Intercept))) <span class="sc">|&gt;</span></span>
<span id="cb54-1615"><a href="#cb54-1615" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="fu">c</span>(rope, prop_in_rope)) <span class="sc">|&gt;</span></span>
<span id="cb54-1616"><a href="#cb54-1616" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb54-1617"><a href="#cb54-1617" aria-hidden="true" tabindex="-1"></a>    <span class="at">variable =</span> <span class="fu">fct_rev</span>(<span class="fu">fct_inorder</span>(variable)),</span>
<span id="cb54-1618"><a href="#cb54-1618" aria-hidden="true" tabindex="-1"></a>    <span class="at">category =</span> <span class="fu">fct_inorder</span>(category)</span>
<span id="cb54-1619"><a href="#cb54-1619" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb54-1620"><a href="#cb54-1620" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_rope =</span> <span class="fu">case_when</span>(</span>
<span id="cb54-1621"><a href="#cb54-1621" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="fu">glue</span>(<span class="st">"p(Sample = CPS) = {x}"</span>, <span class="at">x =</span> <span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>)(is_inside_rope_full)),</span>
<span id="cb54-1622"><a href="#cb54-1622" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">glue</span>(<span class="st">"{x}"</span>, <span class="at">x =</span> <span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>)(is_inside_rope_full))</span>
<span id="cb54-1623"><a href="#cb54-1623" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb54-1624"><a href="#cb54-1624" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(category) <span class="sc">|&gt;</span></span>
<span id="cb54-1625"><a href="#cb54-1625" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable_numeric =</span> <span class="fu">as.numeric</span>(<span class="fu">fct_drop</span>(variable)))</span>
<span id="cb54-1626"><a href="#cb54-1626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1627"><a href="#cb54-1627" aria-hidden="true" tabindex="-1"></a>sample_cps_props_draws <span class="ot">&lt;-</span> sample_cps_props_bayes <span class="sc">|&gt;</span></span>
<span id="cb54-1628"><a href="#cb54-1628" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">draws =</span> <span class="fu">map</span>(prop_test_results, \(x) x<span class="sc">$</span>draws)) <span class="sc">|&gt;</span></span>
<span id="cb54-1629"><a href="#cb54-1629" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(draws) <span class="sc">|&gt;</span></span>
<span id="cb54-1630"><a href="#cb54-1630" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb54-1631"><a href="#cb54-1631" aria-hidden="true" tabindex="-1"></a>    <span class="at">variable =</span> <span class="fu">fct_rev</span>(<span class="fu">fct_inorder</span>(variable)),</span>
<span id="cb54-1632"><a href="#cb54-1632" aria-hidden="true" tabindex="-1"></a>    <span class="at">category =</span> <span class="fu">fct_inorder</span>(category)</span>
<span id="cb54-1633"><a href="#cb54-1633" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-1634"><a href="#cb54-1634" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1635"><a href="#cb54-1635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1636"><a href="#cb54-1636" aria-hidden="true" tabindex="-1"></a>And finally, we can make a plot of all these fancy results!</span>
<span id="cb54-1637"><a href="#cb54-1637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1640"><a href="#cb54-1640" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1641"><a href="#cb54-1641" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-prop-test-bayes-props</span></span>
<span id="cb54-1642"><a href="#cb54-1642" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Respondent demographic proportions compared to national proportions, overlaid on variable-specific ROPEs; like @fig-prop-test-freq-props, but Bayesian</span></span>
<span id="cb54-1643"><a href="#cb54-1643" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb54-1644"><a href="#cb54-1644" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Code for making this plot ↓</span></span>
<span id="cb54-1645"><a href="#cb54-1645" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb54-1646"><a href="#cb54-1646" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4.5</span></span>
<span id="cb54-1647"><a href="#cb54-1647" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: 90%</span></span>
<span id="cb54-1648"><a href="#cb54-1648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1649"><a href="#cb54-1649" aria-hidden="true" tabindex="-1"></a>sample_cps_props_draws <span class="sc">|&gt;</span></span>
<span id="cb54-1650"><a href="#cb54-1650" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> b_Intercept, <span class="at">y =</span> variable)) <span class="sc">+</span></span>
<span id="cb54-1651"><a href="#cb54-1651" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(</span>
<span id="cb54-1652"><a href="#cb54-1652" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> rope_details,</span>
<span id="cb54-1653"><a href="#cb54-1653" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb54-1654"><a href="#cb54-1654" aria-hidden="true" tabindex="-1"></a>      <span class="at">xmin =</span> rope_avg_low, <span class="at">xmax =</span> rope_avg_high,</span>
<span id="cb54-1655"><a href="#cb54-1655" aria-hidden="true" tabindex="-1"></a>      <span class="at">ymin =</span> variable_numeric,</span>
<span id="cb54-1656"><a href="#cb54-1656" aria-hidden="true" tabindex="-1"></a>      <span class="at">ymax =</span> variable_numeric <span class="sc">+</span> <span class="fl">0.9</span>,</span>
<span id="cb54-1657"><a href="#cb54-1657" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">"ROPE (± 0.1 SD)"</span></span>
<span id="cb54-1658"><a href="#cb54-1658" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb54-1659"><a href="#cb54-1659" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span></span>
<span id="cb54-1660"><a href="#cb54-1660" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb54-1661"><a href="#cb54-1661" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="fu">aes</span>(<span class="at">slab_fill =</span> category)) <span class="sc">+</span></span>
<span id="cb54-1662"><a href="#cb54-1662" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb54-1663"><a href="#cb54-1663" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> rope_details,</span>
<span id="cb54-1664"><a href="#cb54-1664" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb54-1665"><a href="#cb54-1665" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> national_value, <span class="at">xend =</span> national_value,</span>
<span id="cb54-1666"><a href="#cb54-1666" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> variable_numeric, <span class="at">yend =</span> variable_numeric <span class="sc">+</span> <span class="fl">0.9</span>,</span>
<span id="cb54-1667"><a href="#cb54-1667" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"CPS proportion"</span></span>
<span id="cb54-1668"><a href="#cb54-1668" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb54-1669"><a href="#cb54-1669" aria-hidden="true" tabindex="-1"></a>    <span class="at">key_glyph =</span> <span class="st">"vline"</span></span>
<span id="cb54-1670"><a href="#cb54-1670" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb54-1671"><a href="#cb54-1671" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(</span>
<span id="cb54-1672"><a href="#cb54-1672" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> rope_details, </span>
<span id="cb54-1673"><a href="#cb54-1673" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> <span class="fl">0.9</span>, <span class="at">y =</span> variable, <span class="at">label =</span> p_rope), </span>
<span id="cb54-1674"><a href="#cb54-1674" aria-hidden="true" tabindex="-1"></a>    <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb54-1675"><a href="#cb54-1675" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">8</span>, <span class="at">size.unit =</span> <span class="st">"pt"</span>, <span class="at">label.size =</span> <span class="dv">0</span>, <span class="at">fill =</span> <span class="st">"grey95"</span></span>
<span id="cb54-1676"><a href="#cb54-1676" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb54-1677"><a href="#cb54-1677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">order =</span> <span class="dv">1</span>), <span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">order =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb54-1678"><a href="#cb54-1678" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb54-1679"><a href="#cb54-1679" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">label_wrap</span>(<span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb54-1680"><a href="#cb54-1680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clrs[<span class="dv">2</span>])) <span class="sc">+</span></span>
<span id="cb54-1681"><a href="#cb54-1681" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clrs[<span class="dv">2</span>])) <span class="sc">+</span></span>
<span id="cb54-1682"><a href="#cb54-1682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> clrs[<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>)], <span class="at">aesthetics =</span> <span class="st">"slab_fill"</span>, <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb54-1683"><a href="#cb54-1683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Proportion"</span>, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">color =</span> <span class="cn">NULL</span>, <span class="at">fill =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb54-1684"><a href="#cb54-1684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_col</span>(<span class="fu">vars</span>(category), <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">space =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb54-1685"><a href="#cb54-1685" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb54-1686"><a href="#cb54-1686" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"lines"</span>),</span>
<span id="cb54-1687"><a href="#cb54-1687" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="fl">0.9</span>, <span class="st">"lines"</span>),</span>
<span id="cb54-1688"><a href="#cb54-1688" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">vjust =</span> <span class="dv">0</span>)</span>
<span id="cb54-1689"><a href="#cb54-1689" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-1690"><a href="#cb54-1690" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1691"><a href="#cb54-1691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1694"><a href="#cb54-1694" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1695"><a href="#cb54-1695" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-prop-test-bayes-diffs</span></span>
<span id="cb54-1696"><a href="#cb54-1696" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Differences between demographic proportions and national proportions, overlaid on variable-specific ROPEs; like @fig-prop-test-freq-diffs, but Bayesian</span></span>
<span id="cb54-1697"><a href="#cb54-1697" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb54-1698"><a href="#cb54-1698" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Code for making this plot ↓</span></span>
<span id="cb54-1699"><a href="#cb54-1699" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb54-1700"><a href="#cb54-1700" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4.5</span></span>
<span id="cb54-1701"><a href="#cb54-1701" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: 90%</span></span>
<span id="cb54-1702"><a href="#cb54-1702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1703"><a href="#cb54-1703" aria-hidden="true" tabindex="-1"></a>sample_cps_props_draws <span class="sc">|&gt;</span></span>
<span id="cb54-1704"><a href="#cb54-1704" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> diff, <span class="at">y =</span> variable)) <span class="sc">+</span></span>
<span id="cb54-1705"><a href="#cb54-1705" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(</span>
<span id="cb54-1706"><a href="#cb54-1706" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> rope_details,</span>
<span id="cb54-1707"><a href="#cb54-1707" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb54-1708"><a href="#cb54-1708" aria-hidden="true" tabindex="-1"></a>      <span class="at">xmin =</span> rope_low, <span class="at">xmax =</span> rope_high,</span>
<span id="cb54-1709"><a href="#cb54-1709" aria-hidden="true" tabindex="-1"></a>      <span class="at">ymin =</span> variable_numeric,</span>
<span id="cb54-1710"><a href="#cb54-1710" aria-hidden="true" tabindex="-1"></a>      <span class="at">ymax =</span> variable_numeric <span class="sc">+</span> <span class="fl">0.9</span>,</span>
<span id="cb54-1711"><a href="#cb54-1711" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">"ROPE (± 0.1 SD)"</span></span>
<span id="cb54-1712"><a href="#cb54-1712" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb54-1713"><a href="#cb54-1713" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span></span>
<span id="cb54-1714"><a href="#cb54-1714" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb54-1715"><a href="#cb54-1715" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"CPS proportion"</span>)) <span class="sc">+</span></span>
<span id="cb54-1716"><a href="#cb54-1716" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="fu">aes</span>(<span class="at">slab_fill =</span> category)) <span class="sc">+</span></span>
<span id="cb54-1717"><a href="#cb54-1717" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(</span>
<span id="cb54-1718"><a href="#cb54-1718" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> rope_details, </span>
<span id="cb54-1719"><a href="#cb54-1719" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> <span class="fl">0.4</span>, <span class="at">y =</span> variable, <span class="at">label =</span> p_rope), </span>
<span id="cb54-1720"><a href="#cb54-1720" aria-hidden="true" tabindex="-1"></a>    <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb54-1721"><a href="#cb54-1721" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">8</span>, <span class="at">size.unit =</span> <span class="st">"pt"</span>, <span class="at">label.size =</span> <span class="dv">0</span>, <span class="at">fill =</span> <span class="st">"grey95"</span></span>
<span id="cb54-1722"><a href="#cb54-1722" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb54-1723"><a href="#cb54-1723" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">order =</span> <span class="dv">1</span>), <span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">order =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb54-1724"><a href="#cb54-1724" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> label_pp) <span class="sc">+</span></span>
<span id="cb54-1725"><a href="#cb54-1725" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="fu">label_wrap</span>(<span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb54-1726"><a href="#cb54-1726" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clrs[<span class="dv">2</span>])) <span class="sc">+</span></span>
<span id="cb54-1727"><a href="#cb54-1727" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clrs[<span class="dv">2</span>])) <span class="sc">+</span></span>
<span id="cb54-1728"><a href="#cb54-1728" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> clrs[<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>)], <span class="at">aesthetics =</span> <span class="st">"slab_fill"</span>, <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb54-1729"><a href="#cb54-1729" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Difference from CPS"</span>, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">color =</span> <span class="cn">NULL</span>, <span class="at">fill =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb54-1730"><a href="#cb54-1730" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_col</span>(<span class="fu">vars</span>(category), <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">space =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb54-1731"><a href="#cb54-1731" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb54-1732"><a href="#cb54-1732" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"lines"</span>),</span>
<span id="cb54-1733"><a href="#cb54-1733" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="fl">0.9</span>, <span class="st">"lines"</span>),</span>
<span id="cb54-1734"><a href="#cb54-1734" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">vjust =</span> <span class="dv">0</span>)</span>
<span id="cb54-1735"><a href="#cb54-1735" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-1736"><a href="#cb54-1736" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb54-1737"><a href="#cb54-1737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1738"><a href="#cb54-1738" aria-hidden="true" tabindex="-1"></a>And as before, we can make pretty tables with <span class="co">[</span><span class="ot">{tinytable}</span><span class="co">](https://vincentarelbundock.github.io/tinytable/)</span>:</span>
<span id="cb54-1739"><a href="#cb54-1739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1742"><a href="#cb54-1742" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb54-1743"><a href="#cb54-1743" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-prop-test-bayes</span></span>
<span id="cb54-1744"><a href="#cb54-1744" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: page-inset-right</span></span>
<span id="cb54-1745"><a href="#cb54-1745" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Sample characteristics compared to nationally representative Current Population Survey (CPS) estimates, with probability that the sample is equivalent to the national proportion; like @tbl-prop-test-freq, but Bayesian"</span></span>
<span id="cb54-1746"><a href="#cb54-1746" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb54-1747"><a href="#cb54-1747" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Code for making this table ↓</span></span>
<span id="cb54-1748"><a href="#cb54-1748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1749"><a href="#cb54-1749" aria-hidden="true" tabindex="-1"></a>notes <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb54-1750"><a href="#cb54-1750" aria-hidden="true" tabindex="-1"></a>  <span class="st">"†"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="at">i =</span> <span class="dv">0</span>, <span class="at">j =</span> <span class="dv">5</span>, <span class="at">text =</span> <span class="st">"Proportion of the complete sample posterior that falls outside of the region of practical equivalence (ROPE) around the national proportion, or [−0.1 × SD, 0.1 × SD]. This essentially respresents the probabilty that the sample posterior is equivalent to the national proportion."</span>),</span>
<span id="cb54-1751"><a href="#cb54-1751" aria-hidden="true" tabindex="-1"></a>  <span class="st">"a"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">j =</span> <span class="dv">1</span>, <span class="at">text =</span> <span class="st">"Annual Social and Economic Supplement (ASEC) of the Current Population Survey (CPS), March 2019"</span>),</span>
<span id="cb54-1752"><a href="#cb54-1752" aria-hidden="true" tabindex="-1"></a>  <span class="st">"b"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="at">i =</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">j =</span> <span class="dv">1</span>, <span class="at">text =</span> <span class="st">"Monthly CPS, September 2019"</span>),</span>
<span id="cb54-1753"><a href="#cb54-1753" aria-hidden="true" tabindex="-1"></a>  <span class="st">"c"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="at">i =</span> <span class="dv">7</span>, <span class="at">j =</span> <span class="dv">1</span>, <span class="at">text =</span> <span class="st">"Monthly CPS, November 2018"</span>)</span>
<span id="cb54-1754"><a href="#cb54-1754" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-1755"><a href="#cb54-1755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1756"><a href="#cb54-1756" aria-hidden="true" tabindex="-1"></a>tbl_bayes <span class="ot">&lt;-</span> sample_cps_props_bayes <span class="sc">|&gt;</span></span>
<span id="cb54-1757"><a href="#cb54-1757" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop_in_rope =</span> <span class="fu">map</span>(prop_test_results, \(x) x<span class="sc">$</span>prop_in_rope)) <span class="sc">|&gt;</span></span>
<span id="cb54-1758"><a href="#cb54-1758" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sample_median_ci =</span> <span class="fu">map</span>(prop_test_results, \(x) x<span class="sc">$</span>draws <span class="sc">|&gt;</span> <span class="fu">median_qi</span>(b_Intercept, diff))) <span class="sc">|&gt;</span> </span>
<span id="cb54-1759"><a href="#cb54-1759" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="fu">c</span>(prop_in_rope, sample_median_ci))</span>
<span id="cb54-1760"><a href="#cb54-1760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1761"><a href="#cb54-1761" aria-hidden="true" tabindex="-1"></a>tbl_bayes <span class="sc">|&gt;</span> </span>
<span id="cb54-1762"><a href="#cb54-1762" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sample_nice =</span> <span class="fu">glue</span>(</span>
<span id="cb54-1763"><a href="#cb54-1763" aria-hidden="true" tabindex="-1"></a>    <span class="st">"{value}&lt;br&gt;[{lower}, {upper}]"</span>,</span>
<span id="cb54-1764"><a href="#cb54-1764" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>)(b_Intercept),</span>
<span id="cb54-1765"><a href="#cb54-1765" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> <span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>)(b_Intercept.lower),</span>
<span id="cb54-1766"><a href="#cb54-1766" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper =</span> <span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>)(b_Intercept.upper)</span>
<span id="cb54-1767"><a href="#cb54-1767" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb54-1768"><a href="#cb54-1768" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_nice =</span> glue<span class="sc">::</span><span class="fu">glue</span>(</span>
<span id="cb54-1769"><a href="#cb54-1769" aria-hidden="true" tabindex="-1"></a>    <span class="st">"{diff}&lt;br&gt;[{lower}, {upper}]"</span>,</span>
<span id="cb54-1770"><a href="#cb54-1770" aria-hidden="true" tabindex="-1"></a>    <span class="at">diff =</span> <span class="fu">label_pp_01</span>(diff),</span>
<span id="cb54-1771"><a href="#cb54-1771" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> <span class="fu">label_number</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>, <span class="at">scale =</span> <span class="dv">100</span>)(diff.lower),</span>
<span id="cb54-1772"><a href="#cb54-1772" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper =</span> <span class="fu">label_number</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>, <span class="at">scale =</span> <span class="dv">100</span>)(diff.upper)</span>
<span id="cb54-1773"><a href="#cb54-1773" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb54-1774"><a href="#cb54-1774" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_in_rope =</span> <span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>, <span class="at">scale =</span> <span class="dv">100</span>)(is_inside_rope_full)) <span class="sc">|&gt;</span> </span>
<span id="cb54-1775"><a href="#cb54-1775" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb54-1776"><a href="#cb54-1776" aria-hidden="true" tabindex="-1"></a>    <span class="at">Variable =</span> variable,</span>
<span id="cb54-1777"><a href="#cb54-1777" aria-hidden="true" tabindex="-1"></a>    <span class="at">National =</span> national_value,</span>
<span id="cb54-1778"><a href="#cb54-1778" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sample =</span> sample_nice,</span>
<span id="cb54-1779"><a href="#cb54-1779" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">∆</span><span class="st">`</span> <span class="ot">=</span> diff_nice,</span>
<span id="cb54-1780"><a href="#cb54-1780" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">p(Sample = CPS)</span><span class="st">`</span> <span class="ot">=</span> p_in_rope</span>
<span id="cb54-1781"><a href="#cb54-1781" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb54-1782"><a href="#cb54-1782" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tt</span>(<span class="at">width =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>), <span class="at">notes =</span> notes) <span class="sc">|&gt;</span> </span>
<span id="cb54-1783"><a href="#cb54-1783" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_tt</span>(<span class="at">i =</span> tbl_bayes<span class="sc">$</span>category) <span class="sc">|&gt;</span> </span>
<span id="cb54-1784"><a href="#cb54-1784" aria-hidden="true" tabindex="-1"></a>  <span class="fu">format_tt</span>(<span class="at">j =</span> <span class="dv">2</span>, <span class="at">fn =</span> <span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb54-1785"><a href="#cb54-1785" aria-hidden="true" tabindex="-1"></a>  <span class="fu">style_tt</span>(<span class="at">i =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">9</span>), <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">background =</span> <span class="st">"#e6e6e6"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb54-1786"><a href="#cb54-1786" aria-hidden="true" tabindex="-1"></a>  <span class="fu">style_tt</span>(</span>
<span id="cb54-1787"><a href="#cb54-1787" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrap_class =</span> <span class="st">"table"</span>,</span>
<span id="cb54-1788"><a href="#cb54-1788" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrap_css_rule =</span> <span class="st">".table tfoot { text-align: left; } .table { font-size: 0.85rem; }"</span></span>
<span id="cb54-1789"><a href="#cb54-1789" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb54-1790"><a href="#cb54-1790" aria-hidden="true" tabindex="-1"></a>  <span class="fu">style_tt</span>(<span class="at">j =</span> <span class="dv">1</span>, <span class="at">align =</span> <span class="st">"l"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb54-1791"><a href="#cb54-1791" aria-hidden="true" tabindex="-1"></a>  <span class="fu">style_tt</span>(<span class="at">j =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">align =</span> <span class="st">"c"</span>)</span>
<span id="cb54-1792"><a href="#cb54-1792" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p><span class="faux-block">Forked from <a href="https://www.andrewheiss.com/">Andrew Heiss</a></span> # <span class="faux-block"><a href="https://github.com/andrewheiss/ath-quarto">View the source at <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></span></p>
</div>
  </div>
</footer><script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>


</body></html>