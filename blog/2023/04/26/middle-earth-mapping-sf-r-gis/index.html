<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Andrew Heiss">
<meta name="description" content="Explore Tolkien’s Middle Earth with R-based GIS tools, including {ggplot2} and {sf}">
<title>Making Middle Earth maps with R | Andrew Heiss – Andrew Heiss</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../../">
<link href="../../../../..//files/favicon-512.png" rel="icon" type="image/png">
<script src="../../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting-17c909d5fd25ae21b861c0c7a49b2096.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../site_libs/bootstrap/bootstrap-5cd0811f461c8271ae6bab49df9501be.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script src="../../../../../site_libs/quarto-contrib/iconify-2.0.0/iconify-icon.min.js"></script><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-527449-5', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script><style>

      .quarto-title-block .quarto-title-banner {
        background: #170C3A;
      }
</style>
<script src="../../../../../site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><script src="../../../../../site_libs/jquery-1.12.4/jquery.min.js"></script><link href="../../../../../site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="../../../../../site_libs/leaflet-1.3.1/leaflet.js"></script><link href="../../../../../site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="../../../../../site_libs/proj4-2.6.2/proj4.min.js"></script><script src="../../../../../site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="../../../../../site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="../../../../../site_libs/leaflet-binding-2.1.2/leaflet.js"></script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
<meta property="og:title" content="Making Middle Earth maps with R | Andrew Heiss">
<meta property="og:description" content="Explore Tolkien’s Middle Earth with R-based GIS tools, including {ggplot2} and {sf}">
<meta property="og:image" content="https://www.andrewheiss.com/blog/2023/04/26/middle-earth-mapping-sf-r-gis/index_files/figure-html/shire-zoomed-in-fancy-1.png">
<meta property="og:site_name" content="Andrew Heiss">
<meta property="og:locale" content="en_US">
<meta property="og:image:height" content="1296">
<meta property="og:image:width" content="1872">
<meta name="twitter:title" content="Making Middle Earth maps with R | Andrew Heiss">
<meta name="twitter:description" content="Explore Tolkien’s Middle Earth with R-based GIS tools, including {ggplot2} and {sf}">
<meta name="twitter:image" content="https://www.andrewheiss.com/blog/2023/04/26/middle-earth-mapping-sf-r-gis/index_files/figure-html/shire-zoomed-in-fancy-1.png">
<meta name="twitter:creator" content="@andrewheiss">
<meta name="twitter:site" content="@andrewheiss">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image-height" content="1296">
<meta name="twitter:image-width" content="1872">
</head>
<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../../index.html">
    <span class="navbar-title">Andrew Heiss</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../../../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../cv/index.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../research/index.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../teaching/index.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../talks/index.html"> 
<span class="menu-text">Talks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../now/index.html"> 
<span class="menu-text">Now</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../uses/index.html"> 
<span class="menu-text">Uses</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../../../../../atom.xml"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:rss" style="font-size: 1.1em;" aria-label="Icon rss from bi Iconify.design set." title="RSS"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="mailto:aheiss@gsu.edu"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:envelope" style="font-size: 1.1em;" aria-label="Icon envelope from bi Iconify.design set." title="E-mail"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://bsky.app/profile/andrew.heiss.phd" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="fa6-brands:bluesky" style="font-size: 1.1em;" aria-label="Icon bluesky from fa6-brands Iconify.design set." title="Bluesky"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://fediscience.org/users/andrew/" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:mastodon" style="font-size: 1.1em;" aria-label="Icon mastodon from bi Iconify.design set." title="Mastodon"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/andrewheiss" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:github" style="font-size: 1.1em;" aria-label="Icon github from bi Iconify.design set." title="GitHub"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.youtube.com/andrewheiss" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:youtube" style="font-size: 1.1em;" aria-label="Icon youtube from bi Iconify.design set." title="YouTube"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.heissatopia.com/"> 
<span class="menu-text"><iconify-icon inline="" icon="fa6-brands:blogger" style="font-size: 1.15em;" aria-label="Icon blogger from fa6-brands Iconify.design set." title="Blogger"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/andrewheiss" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:linkedin" style="font-size: 1.1em;" aria-label="Icon linkedin from bi Iconify.design set." title="LinkedIn"></iconify-icon></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default blog-post page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Making Middle Earth maps with R</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                  <div>
        <div class="description">
          Explore Tolkien’s Middle Earth with R-based GIS tools, including {ggplot2} and {sf}
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">r</div>
                <div class="quarto-category">tidyverse</div>
                <div class="quarto-category">ggplot</div>
                <div class="quarto-category">gis</div>
                <div class="quarto-category">maps</div>
                <div class="quarto-category">nerdery</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://www.andrewheiss.com/">Andrew Heiss</a> <a href="https://orcid.org/0000-0002-3948-3914" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">Wednesday, April 26, 2023</p>
      </div>
    </div>
    
      
      <div>
      <div class="quarto-title-meta-heading">Doi</div>
      <div class="quarto-title-meta-contents">
        <p class="doi">
          <a href="https://doi.org/10.59350/ccrtd-z3s22">10.59350/ccrtd-z3s22</a>
        </p>
      </div>
    </div>
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Contents</h2>
   
  <ul>
<li>
<a href="#lightning-quick-overview-of-sf-and-shapefiles" id="toc-lightning-quick-overview-of-sf-and-shapefiles" class="nav-link active" data-scroll-target="#lightning-quick-overview-of-sf-and-shapefiles">Lightning quick overview of {sf} and shapefiles</a>
  <ul class="collapse">
<li><a href="#getting-geographic-data" id="toc-getting-geographic-data" class="nav-link" data-scroll-target="#getting-geographic-data">Getting geographic data</a></li>
  </ul>
</li>
  <li><a href="#quick-reminder-latitude-vs.-longitude" id="toc-quick-reminder-latitude-vs.-longitude" class="nav-link" data-scroll-target="#quick-reminder-latitude-vs.-longitude">Quick reminder: latitude vs.&nbsp;longitude</a></li>
  <li><a href="#loading-middle-earth-shapefiles" id="toc-loading-middle-earth-shapefiles" class="nav-link" data-scroll-target="#loading-middle-earth-shapefiles">Loading Middle Earth shapefiles</a></li>
  <li><a href="#exploring-the-different-layers" id="toc-exploring-the-different-layers" class="nav-link" data-scroll-target="#exploring-the-different-layers">Exploring the different layers</a></li>
  <li><a href="#fancy-map-of-middle-earth-with-lots-of-layers" id="toc-fancy-map-of-middle-earth-with-lots-of-layers" class="nav-link" data-scroll-target="#fancy-map-of-middle-earth-with-lots-of-layers">Fancy map of Middle Earth with lots of layers</a></li>
  <li><a href="#map-of-just-the-shire" id="toc-map-of-just-the-shire" class="nav-link" data-scroll-target="#map-of-just-the-shire">Map of just the Shire</a></li>
  <li><a href="#distances-between-places" id="toc-distances-between-places" class="nav-link" data-scroll-target="#distances-between-places">Distances between places</a></li>
  <li>
<a href="#sticking-middle-earth-in-real-earth" id="toc-sticking-middle-earth-in-real-earth" class="nav-link" data-scroll-target="#sticking-middle-earth-in-real-earth">Sticking Middle Earth in Real Earth</a>
  <ul class="collapse">
<li><a href="#in-the-united-states" id="toc-in-the-united-states" class="nav-link" data-scroll-target="#in-the-united-states">In the United States</a></li>
  <li><a href="#in-europe" id="toc-in-europe" class="nav-link" data-scroll-target="#in-europe">In Europe</a></li>
  </ul>
</li>
  <li>
<a href="#things-i-want-to-do-someday-but-am-not-smart-enough-to-do" id="toc-things-i-want-to-do-someday-but-am-not-smart-enough-to-do" class="nav-link" data-scroll-target="#things-i-want-to-do-someday-but-am-not-smart-enough-to-do">Things I want to do someday but am not smart enough to do</a>
  <ul class="collapse">
<li><a href="#paths" id="toc-paths" class="nav-link" data-scroll-target="#paths">Paths</a></li>
  <li><a href="#first-and-second-ages" id="toc-first-and-second-ages" class="nav-link" data-scroll-target="#first-and-second-ages">First and Second Ages</a></li>
  </ul>
</li>
  <li><a href="#update-second-age-maps-scaled-to-real-world-distances" id="toc-update-second-age-maps-scaled-to-real-world-distances" class="nav-link" data-scroll-target="#update-second-age-maps-scaled-to-real-world-distances">Update! Second Age maps scaled to Real World distances!</a></li>
  </ul></nav>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content"><p>I’ve taught a course on data visualization with R since 2017, and it’s become one of my more popular classes, especially since <a href="https://datavizs22.classes.andrewheiss.com/">it’s all available asynchronously online</a> with hours of Creative Commons-licensed videos and materials. One of the most popular sections of the class (as measured by my server logs and by how often I use it myself) is <a href="https://datavizs22.classes.andrewheiss.com/example/12-example/">a section on GIS-related visualization</a>, or how to work with maps in {ggplot2}. Nowadays, since the advent of the <a href="https://r-spatial.github.io/sf/">{sf} package</a>, I find that making maps with R is incredibly easy and fun.</p>
<p>I’m also a huge fan of J. R. R. Tolkien and his entire <a href="https://en.wikipedia.org/wiki/Tolkien%27s_legendarium">Legendarium</a> (as evidenced by <a href="https://www.andrewheiss.com/blog/2023/03/21/aragorn-dunedan-numenorean-simulation/">my previous blog post here</a> simulating Aragorn’s human-scale age based on an obscure footnote in Tolkien’s writings about Númenor).</p>
<p>Back in 2020, as I was polishing up my data visualization course page on visualizing spatial data, I stumbled across <a href="https://github.com/jvangeld/ME-GIS">a set of shapefiles for Middle Earth</a>, meaning that it was possible to use R and ggplot to make maps of Tolkien’s fictional world. I whipped up a quick example and <a href="https://twitter.com/andrewheiss/status/1291380121069330432">tweeted about it</a> back then, but then kind of forgot about it.</p>
<p>With Twitter dying, and with my recent read of <em>The Fall of Númenor</em>, Middle Earth maps have been on my mind again, so I figured I’d make a more formal didactic blog post about how to make and play with these maps. So consider this blog post a fun little playground for learning more about doing GIS work with {sf} and ggplot, and learn some neat data visualization tricks along the way.</p>
<p>Let’s put the R in “J. R. R.”</p>
<section id="lightning-quick-overview-of-sf-and-shapefiles" class="level1 page-columns page-full"><h1>Lightning quick overview of {sf} and shapefiles</h1>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is a wildly brief intro to the {sf} package. For more details, see my <a href="https://datavizs22.classes.andrewheiss.com/example/12-example/">data visualization lesson on visualizing space</a>, as well as the free <a href="https://r-spatial.org/book/"><em>Spatial Data Science</em></a> and <a href="https://r.geocompx.org/">Geocomputation with R</a> books.</p>
</div>
</div>
<p>Thanks to the magic of the <a href="https://r-spatial.github.io/sf/">{sf} package</a> (“sf” = <a href="https://en.wikipedia.org/wiki/Simple_Features">“simple features”</a>), working with geographic (or GIS) data in R is really really straightforward and fun.</p>
<p>Geographic data is a lot more complex than regular tabular spreadsheet-like data, since it includes information about points (latitude, longitude), paths (a bunch of connected latitudes and longitudes) and areas (a bunch of connected latitudes and longitudes that form a complete shape). Additionally, it has to keep track of units and distances and map projections (or methods for <a href="https://www.youtube.com/watch?v=kIID5FDi2JQ">flattening parts of a round globe onto a two-dimensional surface</a>). This kind of data is often stored in <a href="https://en.wikipedia.org/wiki/Shapefile">shapefile format</a> (though there are alternatives like <a href="https://en.wikipedia.org/wiki/GeoJSON">GeoJSON</a>), which consist of multiple files. For instance, here’s what the 2022 US Census’s shapefile for US states looks like when unzipped:</p>
<pre class="text"><code>cb_2022_us_state_20m
├── cb_2022_us_state_20m.cpg
├── cb_2022_us_state_20m.dbf
├── cb_2022_us_state_20m.prj
├── cb_2022_us_state_20m.shp
├── cb_2022_us_state_20m.shp.ea.iso.xml
├── cb_2022_us_state_20m.shp.iso.xml
└── cb_2022_us_state_20m.shx</code></pre>
<p>It has 7 different files, each with different purposes! Fortunately, it’s easy to read all these in with {sf}. Feed the name of the main <code>.shp</code> file to <code>read_sf()</code> and it’ll handle all the other secondary files (like <code>.dbf</code> and <code>.shx</code> and <code>.prj</code>).</p>
<p>Here I’ve downloaded the <a href="https://www.census.gov/geographies/mapping-files/time-series/geo/cartographic-boundary.html">US Census’s 1:20,000,000 Cartographic Boundary File shapefile</a> and put it in a folder named <code>data</code>. We can load it into R with <code>read_sf()</code>:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># https://www.census.gov/geographies/mapping-files/time-series/geo/cartographic-boundary.html</span></span>
<span><span class="va">us_states</span> <span class="op">&lt;-</span> <span class="fu">read_sf</span><span class="op">(</span><span class="st">"data/cb_2022_us_state_20m/cb_2022_us_state_20m.shp"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Just show some of the columns</span></span>
<span><span class="va">us_states</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">STATEFP</span>, <span class="va">STUSPS</span>, <span class="va">NAME</span>, <span class="va">geometry</span><span class="op">)</span></span>
<span><span class="co">## Simple feature collection with 52 features and 3 fields</span></span>
<span><span class="co">## Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: -179 ymin: 17.9 xmax: 180 ymax: 71.4</span></span>
<span><span class="co">## Geodetic CRS:  NAD83</span></span>
<span><span class="co">## # A tibble: 52 × 4</span></span>
<span><span class="co">##    STATEFP STUSPS NAME                                                                                      geometry</span></span>
<span><span class="co">##    &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;                                                                           &lt;MULTIPOLYGON [°]&gt;</span></span>
<span><span class="co">##  1 48      TX     Texas      (((-107 31.9, -107 32, -107 32, -107 32, -106 32, -106 32, -106 32, -106 32, -105 32...</span></span>
<span><span class="co">##  2 06      CA     California (((-119 33.5, -118 33.5, -118 33.4, -118 33.4, -118 33.3, -118 33.3, -118 33.3, -118...</span></span>
<span><span class="co">##  3 21      KY     Kentucky   (((-89.5 36.6, -89.5 36.6, -89.4 36.6, -89.4 36.6, -89.3 36.6, -89.3 36.6, -89.3 36....</span></span>
<span><span class="co">##  4 13      GA     Georgia    (((-85.6 35, -85.5 35, -85.4 35, -85.4 35, -85.3 35, -85.3 35, -85 35, -85 35, -85 3...</span></span>
<span><span class="co">##  5 55      WI     Wisconsin  (((-86.9 45.4, -86.8 45.5, -86.8 45.4, -86.9 45.4, -86.9 45.3, -87 45.4, -86.9 45.4)...</span></span>
<span><span class="co">##  6 41      OR     Oregon     (((-125 42.8, -124 43, -124 43, -124 43.1, -124 43.2, -124 43.2, -124 43.3, -124 43....</span></span>
<span><span class="co">##  7 29      MO     Missouri   (((-95.8 40.6, -95.5 40.6, -95.4 40.6, -95.3 40.6, -95.2 40.6, -95.1 40.6, -94.9 40....</span></span>
<span><span class="co">##  8 51      VA     Virginia   (((-76 37.3, -76 37.4, -76 37.4, -75.9 37.5, -75.9 37.6, -75.9 37.6, -75.9 37.7, -75...</span></span>
<span><span class="co">##  9 47      TN     Tennessee  (((-90.3 35, -90.3 35, -90.2 35.1, -90.2 35.1, -90.2 35.1, -90.1 35.1, -90.1 35.2, -...</span></span>
<span><span class="co">## 10 22      LA     Louisiana  (((-94 32.7, -94 32.8, -94 32.9, -94 33, -93.8 33, -93.8 33, -93.7 33, -93.5 33, -93...</span></span>
<span><span class="co">## # ℹ 42 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>It looks like a regular R dataframe, and it is (all the regular dplyr functions work on it), but it has one added part—there’s a special list column at the end named <code>geometry</code> that contains the actual geographic data, and the dataframe has special metadata with details about the map projection. As seen above, the data uses <a href="https://geodesy.noaa.gov/datums/horizontal/north-american-datum-1983.shtml">NAD 83</a>. We can change that to any projection we want, though, with <code>st_transform()</code>. To make life a little easier when calculating distances and combining maps later in this post, we’ll convert this US map to the WGS 84 projection, which is what Google Maps (and all GPS systems) use:</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="https://datavizs22.classes.andrewheiss.com/example/12-example/#projections-and-coordinate-reference-systems">See this for a short overview</a> of projections and coordinate reference systems (CRS). You can <a href="https://epsg.io/">look up their ID numbers here</a>.</p>
</div>
</div>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">us_states</span> <span class="op">&lt;-</span> <span class="va">us_states</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_transform</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4326"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># WGS 84</span></span>
<span></span>
<span><span class="co"># Just show some of the columns</span></span>
<span><span class="va">us_states</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">STATEFP</span>, <span class="va">STUSPS</span>, <span class="va">NAME</span>, <span class="va">geometry</span><span class="op">)</span></span>
<span><span class="co">## Simple feature collection with 52 features and 3 fields</span></span>
<span><span class="co">## Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: -179 ymin: 17.9 xmax: 180 ymax: 71.4</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span>
<span><span class="co">## # A tibble: 52 × 4</span></span>
<span><span class="co">##    STATEFP STUSPS NAME                                                                                      geometry</span></span>
<span><span class="co">##    &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;                                                                           &lt;MULTIPOLYGON [°]&gt;</span></span>
<span><span class="co">##  1 48      TX     Texas      (((-107 31.9, -107 32, -107 32, -107 32, -106 32, -106 32, -106 32, -106 32, -105 32...</span></span>
<span><span class="co">##  2 06      CA     California (((-119 33.5, -118 33.5, -118 33.4, -118 33.4, -118 33.3, -118 33.3, -118 33.3, -118...</span></span>
<span><span class="co">##  3 21      KY     Kentucky   (((-89.5 36.6, -89.5 36.6, -89.4 36.6, -89.4 36.6, -89.3 36.6, -89.3 36.6, -89.3 36....</span></span>
<span><span class="co">##  4 13      GA     Georgia    (((-85.6 35, -85.5 35, -85.4 35, -85.4 35, -85.3 35, -85.3 35, -85 35, -85 35, -85 3...</span></span>
<span><span class="co">##  5 55      WI     Wisconsin  (((-86.9 45.4, -86.8 45.5, -86.8 45.4, -86.9 45.4, -86.9 45.3, -87 45.4, -86.9 45.4)...</span></span>
<span><span class="co">##  6 41      OR     Oregon     (((-125 42.8, -124 43, -124 43, -124 43.1, -124 43.2, -124 43.2, -124 43.3, -124 43....</span></span>
<span><span class="co">##  7 29      MO     Missouri   (((-95.8 40.6, -95.5 40.6, -95.4 40.6, -95.3 40.6, -95.2 40.6, -95.1 40.6, -94.9 40....</span></span>
<span><span class="co">##  8 51      VA     Virginia   (((-76 37.3, -76 37.4, -76 37.4, -75.9 37.5, -75.9 37.6, -75.9 37.6, -75.9 37.7, -75...</span></span>
<span><span class="co">##  9 47      TN     Tennessee  (((-90.3 35, -90.3 35, -90.2 35.1, -90.2 35.1, -90.2 35.1, -90.1 35.1, -90.1 35.2, -...</span></span>
<span><span class="co">## 10 22      LA     Louisiana  (((-94 32.7, -94 32.8, -94 32.9, -94 33, -93.8 33, -93.8 33, -93.7 33, -93.5 33, -93...</span></span>
<span><span class="co">## # ℹ 42 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The data’s the same; the projection is different now. Neat.</p>
<p>Since this is just a dataframe, we can manipulate it like any other dataframe. Let’s filter it so that we only keep the 48 contiguous states:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lower_48</span> <span class="op">&lt;-</span> <span class="va">us_states</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">NAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Alaska"</span>, <span class="st">"Hawaii"</span>, <span class="st">"Puerto Rico"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>{sf} makes it incredibly easy to plot maps too. By relying on the geographic details embedded in the special <code>geometry</code> plot, the <code>geom_sf()</code> function automatically plots the correct kind of data (points, lines, or areas). And since we’re just working with a dataframe, everything in the grammar of graphics paradigm works too. We can map columns to specific aesthetics. For instance, the Census shapefile happened to come with a column named <code>ALAND</code> that measures the total land area in each state in square meters. We can fill by that column and create a choropleth map showing states by size:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lower_48</span>, <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">ALAND</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/us-map-basic-1.png" class="img-fluid figure-img" style="width:90.0%" alt="Basic map of the US, with states filled by area"></p>
<figcaption class="margin-caption">Basic map of the US, with states filled by area</figcaption></figure>
</div>
</div>
</div>
<p>Since this is just a regular ggplot geom, all other ggplot things work, like modifying themes, scales, etc. We can also change the projection on-the-fly with <code>coord_sf()</code> (here I use <a href="https://epsg.io/102003">Albers</a>):</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org">scales</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lower_48</span>, <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">ALAND</span><span class="op">)</span>,</span>
<span>          color <span class="op">=</span> <span class="st">"white"</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"rocket"</span>, end <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>                       labels <span class="op">=</span> <span class="fu">label_number</span><span class="op">(</span>scale_cut <span class="op">=</span> <span class="fu">cut_short_scale</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       guide <span class="op">=</span> <span class="fu">guide_colorbar</span><span class="op">(</span>barwidth <span class="op">=</span> <span class="fl">7</span>, barheight <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>                                              title.vjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"ESRI:102003"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Albers projection</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Land area (m²)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span>base_family <span class="op">=</span> <span class="st">"Overpass Light"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>        legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fu">rel</span><span class="op">(</span><span class="fl">0.6</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        legend.justification <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/us-map-fancy-1.png" class="img-fluid figure-img" style="width:90.0%" alt="Fancier map of the US, with states filled by area"></p>
<figcaption class="margin-caption">Fancier map of the US, with states filled by area</figcaption></figure>
</div>
</div>
</div>
<section id="getting-geographic-data" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="getting-geographic-data">Getting geographic data</h2>
<p>Shapefiles are everywhere. They’re one of the de facto standard formats for GIS data, and most government agencies provide them for their jurisdictions (<a href="https://datavizs22.classes.andrewheiss.com/example/12-example/#shapefiles">see here for a list of some different sources</a>). You can view and edit them graphically with the free and open source <a href="https://qgis.org/en/site/">QGIS</a> or with the expensive and industry-standard <a href="https://www.arcgis.com/index.html">ArcGIS</a>.</p>
<p>We’ve already seen how to load shapefiles into R with <code>sf::read_sf()</code>, and that works great. But doing that requires that you go and find and download the shapefiles that you want, which can involve hunting through complicated websites. There are also lots of different R packages that let you get shapefiles directly from different websites’ APIs.</p>
<p>For example, we’ve already loaded the 2022 US Census maps by downloading and unzipping the shapefile and using <code>read_sf()</code>. We could have also used the <a href="https://github.com/walkerke/tigris">{tigris}</a> package to access the data directly from the Census, like this:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/walkerke/tigris">tigris</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">us_states</span> <span class="op">&lt;-</span> <span class="fu">states</span><span class="op">(</span>resolution <span class="op">=</span> <span class="st">"20m"</span>, year <span class="op">=</span> <span class="fl">2022</span>, cb <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lower_48</span> <span class="op">&lt;-</span> <span class="va">us_states</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">NAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Alaska"</span>, <span class="st">"Hawaii"</span>, <span class="st">"Puerto Rico"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For world-level data, <a href="https://www.naturalearthdata.com/">Natural Earth</a> has incredibly well-made shapefiles. We could download the <a href="https://www.naturalearthdata.com/downloads/50m-cultural-vectors/">1:50m cultural data</a> from their website, unzip it, and load it with <code>read_sf()</code>:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Medium scale data, 1:50m Admin 0 - Countries</span></span>
<span><span class="co"># Download from https://www.naturalearthdata.com/downloads/50m-cultural-vectors/</span></span>
<span><span class="va">world_map</span> <span class="op">&lt;-</span> <span class="fu">read_sf</span><span class="op">(</span><span class="st">"ne_50m_admin_0_countries/ne_50m_admin_0_countries.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">iso_a3</span> <span class="op">!=</span> <span class="st">"ATA"</span><span class="op">)</span>  <span class="co"># Remove Antarctica</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Or we can use the <a href="https://github.com/ropensci/rnaturalearth">{rnaturalearth}</a> package to do the same thing:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rnaturalearth/">rnaturalearth</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># rerturnclass = "sf" makes it so the resulting dataframe has the special</span></span>
<span><span class="co"># sf-enabled geometry column</span></span>
<span><span class="va">world_map</span> <span class="op">&lt;-</span> <span class="fu">ne_countries</span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">50</span>, returnclass <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">iso_a3</span> <span class="op">!=</span> <span class="st">"ATA"</span><span class="op">)</span>  <span class="co"># Remove Antarctica</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Throughout this post, I use {rnaturalearth} for world-level shapefiles and downloaded shapefiles for the US, but that’s just for the sake of illustration. Both can be done with packages or through downloading.</p>
</div>
</div>
<p>And finally, for fun, here are some examples of different maps and projections and ggplot tinkering. I’m perpetually astounded by how easy it is to plot GIS data with <code>geom_sf()</code>! That <code>geometry</code> list column is truly magical.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lower_48</span>, fill <span class="op">=</span> <span class="st">"#0074D9"</span>, color <span class="op">=</span> <span class="st">"white"</span>, linewidth <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4269"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># NAD83</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"NAD83 projection"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, family <span class="op">=</span> <span class="st">"Overpass Light"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lower_48</span>, fill <span class="op">=</span> <span class="st">"#0074D9"</span>, color <span class="op">=</span> <span class="st">"white"</span>, linewidth <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"ESRI:102003"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Albers</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Albers projection"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, family <span class="op">=</span> <span class="st">"Overpass Light"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">world_map</span>, fill <span class="op">=</span> <span class="st">"#FF4136"</span>, color <span class="op">=</span> <span class="st">"white"</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:3395"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Mercator</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mercator projection"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, family <span class="op">=</span> <span class="st">"Overpass Light"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">world_map</span>, fill <span class="op">=</span> <span class="st">"#FF4136"</span>, color <span class="op">=</span> <span class="st">"white"</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"ESRI:54030"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Robinson</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Robinson projection"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, family <span class="op">=</span> <span class="st">"Overpass Light"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">p1</span> <span class="op">|</span> <span class="va">p2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">p3</span> <span class="op">|</span> <span class="va">p4</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/example-projections-1.png" class="img-fluid figure-img" style="width:90.0%" alt="Examples of different North American and world map projections"></p>
<figcaption class="margin-caption">Examples of different North American and world map projections</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="quick-reminder-latitude-vs.-longitude" class="level1 page-columns page-full"><h1>Quick reminder: latitude vs.&nbsp;longitude</h1>
<p>One last little GIS-related thing before going to Middle Earth. Geographic data doesn’t rely on the standard X/Y Cartesian plane. Instead, it uses latitudes and longitudes. I’ve loved maps and globes all my life, but I <em>can never remember</em> how latitudes and longitudes translate to X and Y, especially since coordinates are often reported as <code>lat, lon</code>, which is technically the reverse of <code>x, y</code>.</p>
<p>I have this graph printed and hanging on my office wall next to my computer and refer to it all the time. It’s my gift to all of you.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">point_example</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">2</span>, y <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>label <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"{x} x, {y} y\n{y} lat, {x} lon"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lat_labs</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="fl">3</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"Latitude"</span><span class="op">)</span></span>
<span><span class="va">lon_labs</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span>, y <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, label <span class="op">=</span> <span class="st">"Longitude"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">point_example</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_label</span><span class="op">(</span>data <span class="op">=</span> <span class="va">point_example</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, label <span class="op">=</span> <span class="va">label</span><span class="op">)</span>,</span>
<span>             nudge_y <span class="op">=</span> <span class="fl">0.6</span>, family <span class="op">=</span> <span class="st">"Overpass ExtraBold"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lat_labs</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, label <span class="op">=</span> <span class="va">label</span><span class="op">)</span>,</span>
<span>            hjust <span class="op">=</span> <span class="fl">0.5</span>, vjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.3</span>, family <span class="op">=</span> <span class="st">"Overpass Light"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lon_labs</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, label <span class="op">=</span> <span class="va">label</span><span class="op">)</span>,</span>
<span>            hjust <span class="op">=</span> <span class="fl">1.1</span>, vjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, angle <span class="op">=</span> <span class="fl">90</span>, family <span class="op">=</span> <span class="st">"Overpass Light"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_equal</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3.5</span>, <span class="fl">3</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/lat-lon-plot-1.png" class="img-fluid figure-img" style="width:65.0%" alt="Helpful diagram showing how latitude and longitude translate to x and y coordinates"></p>
<figcaption class="margin-caption">Helpful diagram showing how latitude and longitude translate to x and y coordinates</figcaption></figure>
</div>
</div>
</div>
</section><section id="loading-middle-earth-shapefiles" class="level1"><h1>Loading Middle Earth shapefiles</h1>
<p>Phew, okay. With that quick overview done, we can start playing with the <a href="https://github.com/jvangeld/ME-GIS">ME-GIS data</a>. There’s isn’t a pre-built R package for the data, so we’ll need to download the GitHub repository ourselves. I put all the files in a folder named <code>data/ME-GIS</code> relative to this document. I also downloaded the <a href="https://www.census.gov/geographies/mapping-files/time-series/geo/cartographic-boundary.html">2022 US Census cartographic boundary files</a> and put them in a folder named <code>data/cb_2022_us_state_20m</code>. If you’re following along, I suggest you do the same.</p>
<p>The ME-GIS project includes tons of different shapefile layers: data for coastline borders, elevation contours, forest boundaries, city locations, and so on. We’ll load a bunch of them here.</p>
<p>Notice the extra <code>iconv(., from = "ISO-8859-1", to = "UTF-8")</code> that I’ve added to each <code>read_sf()</code> call. This is necessary because the original data isn’t stored as Unicode, which is an issue because Tolkien used all sorts of accents (like “Lórien”), and R can choke on these characters. To make life easier, I use <code><a href="https://rdrr.io/r/base/iconv.html">iconv()</a></code> to convert all the character columns in each shapefile from <a href="https://en.wikipedia.org/wiki/ISO/IEC_8859-1">Latin 1 (ISO-8859-1)</a> to Unicode (UTF-8).</p>
<p>Make sure you download and install the <a href="https://fonts.google.com/specimen/Overpass">Overpass font from Google Fonts</a> if you want to use the custom fonts throughout the post.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rnaturalearth/">rnaturalearth</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://paleolimbot.github.io/ggspatial/">ggspatial</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org">scales</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/leaflet/">leaflet</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://glue.tidyverse.org/">glue</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">coastline</span> <span class="op">&lt;-</span> <span class="fu">read_sf</span><span class="op">(</span><span class="st">"data/ME-GIS/Coastline2.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/iconv.html">iconv</a></span><span class="op">(</span><span class="va">.</span>, from <span class="op">=</span> <span class="st">"ISO-8859-1"</span>, to <span class="op">=</span> <span class="st">"UTF-8"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">contours</span> <span class="op">&lt;-</span> <span class="fu">read_sf</span><span class="op">(</span><span class="st">"data/ME-GIS/Contours_18.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/iconv.html">iconv</a></span><span class="op">(</span><span class="va">.</span>, from <span class="op">=</span> <span class="st">"ISO-8859-1"</span>, to <span class="op">=</span> <span class="st">"UTF-8"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rivers</span> <span class="op">&lt;-</span> <span class="fu">read_sf</span><span class="op">(</span><span class="st">"data/ME-GIS/Rivers.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/iconv.html">iconv</a></span><span class="op">(</span><span class="va">.</span>, from <span class="op">=</span> <span class="st">"ISO-8859-1"</span>, to <span class="op">=</span> <span class="st">"UTF-8"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">roads</span> <span class="op">&lt;-</span> <span class="fu">read_sf</span><span class="op">(</span><span class="st">"data/ME-GIS/Roads.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/iconv.html">iconv</a></span><span class="op">(</span><span class="va">.</span>, from <span class="op">=</span> <span class="st">"ISO-8859-1"</span>, to <span class="op">=</span> <span class="st">"UTF-8"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lakes</span> <span class="op">&lt;-</span> <span class="fu">read_sf</span><span class="op">(</span><span class="st">"data/ME-GIS/Lakes.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/iconv.html">iconv</a></span><span class="op">(</span><span class="va">.</span>, from <span class="op">=</span> <span class="st">"ISO-8859-1"</span>, to <span class="op">=</span> <span class="st">"UTF-8"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">regions</span> <span class="op">&lt;-</span> <span class="fu">read_sf</span><span class="op">(</span><span class="st">"data/ME-GIS/Regions_Anno.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/iconv.html">iconv</a></span><span class="op">(</span><span class="va">.</span>, from <span class="op">=</span> <span class="st">"ISO-8859-1"</span>, to <span class="op">=</span> <span class="st">"UTF-8"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">forests</span> <span class="op">&lt;-</span> <span class="fu">read_sf</span><span class="op">(</span><span class="st">"data/ME-GIS/Forests.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/iconv.html">iconv</a></span><span class="op">(</span><span class="va">.</span>, from <span class="op">=</span> <span class="st">"ISO-8859-1"</span>, to <span class="op">=</span> <span class="st">"UTF-8"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mountains</span> <span class="op">&lt;-</span> <span class="fu">read_sf</span><span class="op">(</span><span class="st">"data/ME-GIS/Mountains_Anno.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/iconv.html">iconv</a></span><span class="op">(</span><span class="va">.</span>, from <span class="op">=</span> <span class="st">"ISO-8859-1"</span>, to <span class="op">=</span> <span class="st">"UTF-8"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">placenames</span> <span class="op">&lt;-</span> <span class="fu">read_sf</span><span class="op">(</span><span class="st">"data/ME-GIS/Combined_Placenames.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/iconv.html">iconv</a></span><span class="op">(</span><span class="va">.</span>, from <span class="op">=</span> <span class="st">"ISO-8859-1"</span>, to <span class="op">=</span> <span class="st">"UTF-8"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We’ll also load and process the Census data and Natural Earth data (we did this before in the overivew, but we’ll do it again here in case you skipped that part):</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Census data</span></span>
<span><span class="va">us_states</span> <span class="op">&lt;-</span> <span class="fu">read_sf</span><span class="op">(</span><span class="st">"data/cb_2022_us_state_20m/cb_2022_us_state_20m.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_transform</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4326"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lower_48</span> <span class="op">&lt;-</span> <span class="va">us_states</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">NAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Alaska"</span>, <span class="st">"Hawaii"</span>, <span class="st">"Puerto Rico"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Natural Earth data</span></span>
<span><span class="va">world_map</span> <span class="op">&lt;-</span> <span class="fu">ne_countries</span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">50</span>, returnclass <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">iso_a3</span> <span class="op">!=</span> <span class="st">"ATA"</span><span class="op">)</span>  <span class="co"># Remove Antarctica</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Finally, we’ll define a couple little helper functions to convert between meters and miles (the Middle Earth data is stored as meters), and define some colors that we’ll use in the maps.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">miles_to_meters</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">*</span> <span class="fl">1609.344</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">meters_to_miles</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">/</span> <span class="fl">1609.344</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">clr_green</span> <span class="op">&lt;-</span> <span class="st">"#035711"</span></span>
<span><span class="va">clr_blue</span> <span class="op">&lt;-</span> <span class="st">"#0776e0"</span></span>
<span><span class="va">clr_yellow</span> <span class="op">&lt;-</span> <span class="st">"#fffce3"</span></span>
<span></span>
<span><span class="co"># Format numeric coordinates with degree symbols and cardinal directions</span></span>
<span><span class="va">format_coords</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">coords</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">coords</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="st">"N"</span>, <span class="st">"S"</span><span class="op">)</span></span>
<span>  <span class="va">ew</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">coords</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="st">"E"</span>, <span class="st">"W"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"{latitude}°{ns} {longitude}°{ew}"</span>,</span>
<span>       latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.6f"</span>, <span class="va">coords</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>       longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.6f"</span>, <span class="va">coords</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="exploring-the-different-layers" class="level1 page-columns page-full"><h1>Exploring the different layers</h1>
<p>With all these shapefiles loaded, we can experiment with them and see what’s in them. Here’s the coastline:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">coastline</span>, linewidth <span class="op">=</span> <span class="fl">0.25</span>, color <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/basic-coastline-1.png" class="img-fluid figure-img" style="width:70.0%" alt="Middle Earth's coastline"></p>
<figcaption class="margin-caption">Middle Earth’s coastline</figcaption></figure>
</div>
</div>
</div>
<p>Neat. We can add some rivers and lakes to it:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">coastline</span>, linewidth <span class="op">=</span> <span class="fl">0.25</span>, color <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rivers</span>, linewidth <span class="op">=</span> <span class="fl">0.2</span>, color <span class="op">=</span> <span class="va">clr_blue</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lakes</span>, linewidth <span class="op">=</span> <span class="fl">0.2</span>, color <span class="op">=</span> <span class="va">clr_blue</span>, fill <span class="op">=</span> <span class="va">clr_blue</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/basic-coastline-rivers-1.png" class="img-fluid figure-img" style="width:70.0%" alt="Middle Earth with rivers and lakes"></p>
<figcaption class="margin-caption">Middle Earth with rivers and lakes</figcaption></figure>
</div>
</div>
</div>
<p>The level of detail in these coastlines and borders is <em>incredible</em>. Great work, ME-DEM team!</p>
<p>Let’s add placenames:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">coastline</span>, linewidth <span class="op">=</span> <span class="fl">0.25</span>, color <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rivers</span>, linewidth <span class="op">=</span> <span class="fl">0.2</span>, color <span class="op">=</span> <span class="va">clr_blue</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lakes</span>, linewidth <span class="op">=</span> <span class="fl">0.2</span>, color <span class="op">=</span> <span class="va">clr_blue</span>, fill <span class="op">=</span> <span class="va">clr_blue</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">placenames</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/basic-coastline-rivers-places-1.png" class="img-fluid figure-img" style="width:70.0%" alt="Middle Earth with rivers and lakes and too many places"></p>
<figcaption class="margin-caption">Middle Earth with rivers and lakes and too many places</figcaption></figure>
</div>
</div>
</div>
<p>Ha, that’s less than helpful. There are 785 different placenames in the data. Since the <code>placenames</code> object is just a fancy dataframe, we can filter it and just look at a few of the places: Hobbiton (the Shire), Rivendell, Edoras (capital of Rohan), and Minas Tirith (capital of Gondor). We’ll also add labels with <code>geom_sf_label()</code> and scoot the labels up a bit so that they’re not on top of the points. The geographic data here is measured in meters, so we can specify how many meters we want each label moved up. Because I don’t think in the metric system, and because there are 1,609 meters in a mile and that implies big numbers, I’ll specify the label offset in miles with the <code>miles_to_meters()</code> function we made earlier. We’ll push the labels up by 50 miles (or 80,467 meters):</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">places</span> <span class="op">&lt;-</span> <span class="va">placenames</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Hobbiton"</span>, <span class="st">"Rivendell"</span>, <span class="st">"Edoras"</span>, <span class="st">"Minas Tirith"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">coastline</span>, linewidth <span class="op">=</span> <span class="fl">0.25</span>, color <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rivers</span>, linewidth <span class="op">=</span> <span class="fl">0.2</span>, color <span class="op">=</span> <span class="va">clr_blue</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lakes</span>, linewidth <span class="op">=</span> <span class="fl">0.2</span>, color <span class="op">=</span> <span class="va">clr_blue</span>, fill <span class="op">=</span> <span class="va">clr_blue</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">places</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_label</span><span class="op">(</span>data <span class="op">=</span> <span class="va">places</span>, <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">NAME</span><span class="op">)</span>, nudge_y <span class="op">=</span> <span class="fu">miles_to_meters</span><span class="op">(</span><span class="fl">50</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/basic-coastline-rivers-places-small-1.png" class="img-fluid figure-img" style="width:70.0%" alt="Middle Earth with rivers, lakes, and four cities"></p>
<figcaption class="margin-caption">Middle Earth with rivers, lakes, and four cities</figcaption></figure>
</div>
</div>
</div>
</section><section id="fancy-map-of-middle-earth-with-lots-of-layers" class="level1 page-columns page-full"><h1>Fancy map of Middle Earth with lots of layers</h1>
<p>So far we’ve seen that we can stack up as many <code>geom_sf()</code> layers as we want to combine each of these shapefiles into a single plot, and we can modify each of the layers just like a standard ggplot geom. Here’s a more polished fancy final version of Middle Earth with better colors, fonts, elevation contours, and so on.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">places</span> <span class="op">&lt;-</span> <span class="va">placenames</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Hobbiton"</span>, <span class="st">"Rivendell"</span>, <span class="st">"Edoras"</span>, <span class="st">"Minas Tirith"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">contours</span>, linewidth <span class="op">=</span> <span class="fl">0.15</span>, color <span class="op">=</span> <span class="st">"grey90"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">coastline</span>, linewidth <span class="op">=</span> <span class="fl">0.25</span>, color <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rivers</span>, linewidth <span class="op">=</span> <span class="fl">0.2</span>, color <span class="op">=</span> <span class="va">clr_blue</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lakes</span>, linewidth <span class="op">=</span> <span class="fl">0.2</span>, color <span class="op">=</span> <span class="va">clr_blue</span>, fill <span class="op">=</span> <span class="va">clr_blue</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">forests</span>, linewidth <span class="op">=</span> <span class="fl">0</span>, fill <span class="op">=</span> <span class="va">clr_green</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">mountains</span>, linewidth <span class="op">=</span> <span class="fl">0.25</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">places</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_label</span><span class="op">(</span>data <span class="op">=</span> <span class="va">places</span>, <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">NAME</span><span class="op">)</span>, nudge_y <span class="op">=</span> <span class="fu">miles_to_meters</span><span class="op">(</span><span class="fl">40</span><span class="op">)</span>,</span>
<span>                family <span class="op">=</span> <span class="st">"Overpass ExtraBold"</span>, fontface <span class="op">=</span> <span class="st">"plain"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_yellow</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/full-nice-map-1.png" class="img-fluid figure-img" style="width:100.0%" alt="Complete fancy map of Middle Earth"></p>
<figcaption class="margin-caption">Complete fancy map of Middle Earth</figcaption></figure>
</div>
</div>
</div>
</section><section id="map-of-just-the-shire" class="level1 page-columns page-full"><h1>Map of just the Shire</h1>
<p>That’s a really neat map! We can get even fancier though! Given the quality of the geographic data, we can zoom in and get much more detail for specific regions. For instance, we can zoom in on just the Shire. We can specify a window of coordinates in <code>coord_sf()</code> to zoom the plot, and with actual real world data we could <a href="https://www.openstreetmap.org/export#map=4/54.47/12.79">use a tool like this</a> to find those coordinates on a map, but since this is fictional data, it’s a little bit trickier to define specific bounds.</p>
<p>To find the rough bounds of the Shire, we’ll first extract the coordinates for Hobbiton, home of Bilbo and Frodo Baggins. The geographic data is currently stuck in the <code>geometry</code> list column, but we can use <code>map_dbl()</code> from {purrr} to extract the values as numbers:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">hobbiton</span> <span class="op">&lt;-</span> <span class="va">places</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op">==</span> <span class="st">"Hobbiton"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>geometry_x <span class="op">=</span> <span class="fu">map_dbl</span><span class="op">(</span><span class="va">geometry</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>         geometry_y <span class="op">=</span> <span class="fu">map_dbl</span><span class="op">(</span><span class="va">geometry</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hobbiton</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">LAYER</span>, <span class="va">NAME</span>, <span class="va">geometry_x</span>, <span class="va">geometry_y</span><span class="op">)</span></span>
<span><span class="co">## Simple feature collection with 1 feature and 4 fields</span></span>
<span><span class="co">## Geometry type: POINT</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 516000 ymin: 1040000 xmax: 516000 ymax: 1040000</span></span>
<span><span class="co">## Projected CRS: UTM_Zone_31_Northern_Hemisphere</span></span>
<span><span class="co">## # A tibble: 1 × 5</span></span>
<span><span class="co">##   LAYER     NAME     geometry_x geometry_y         geometry</span></span>
<span><span class="co">##   &lt;chr&gt;     &lt;chr&gt;         &lt;dbl&gt;      &lt;dbl&gt;      &lt;POINT [m]&gt;</span></span>
<span><span class="co">## 1 TownNames Hobbiton    515948.   1043820. (515948 1043820)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Alternatively, we can avoid {purrr} stuff and pull out the numbers directly with <code>st_geometry()</code>. I prefer keeping everything inside the dataframe, though, so I typically use {purrr} for this kind of thing.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">hobbiton_no_df</span> <span class="op">&lt;-</span> <span class="va">places</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op">==</span> <span class="st">"Hobbiton"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_geometry</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">hobbiton_no_df</span></span>
<span><span class="co">## Geometry set for 1 feature </span></span>
<span><span class="co">## Geometry type: POINT</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 516000 ymin: 1040000 xmax: 516000 ymax: 1040000</span></span>
<span><span class="co">## Projected CRS: UTM_Zone_31_Northern_Hemisphere</span></span>
<span><span class="co">## POINT (515948 1043820)</span></span>
<span><span class="va">hobbiton_no_df</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="co">## [1] 515948</span></span>
<span><span class="va">hobbiton_no_df</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="co">## [1] 1043820</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Those (515948, 1043820) coordinates are the location of Hobbiton and they’re measured in meters. We can add and subtract some amount of meters to each side of the coordinates to build a window around Hobbiton and set the bounds of the map. Here I add 30 miles to the west, 60 miles to the east, 35 miles to the north, and 20 miles to the south of Hobbiton (I figured those out through a bunch of trial and error to get the main features and labels that I wanted to show in the fancier map below)</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">shire_towns</span> <span class="op">&lt;-</span> <span class="va">placenames</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">LAYER</span> <span class="op">==</span> <span class="st">"TownNames"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rivers</span>, linewidth <span class="op">=</span> <span class="fl">0.45</span>, color <span class="op">=</span> <span class="va">clr_blue</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">roads</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">shire_towns</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_label</span><span class="op">(</span>data <span class="op">=</span> <span class="va">shire_towns</span>, <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">NAME</span><span class="op">)</span>, nudge_y <span class="op">=</span> <span class="fu">miles_to_meters</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>                family <span class="op">=</span> <span class="st">"Overpass ExtraBold"</span>, fontface <span class="op">=</span> <span class="st">"plain"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">hobbiton</span><span class="op">$</span><span class="va">geometry_x</span> <span class="op">-</span> <span class="fu">miles_to_meters</span><span class="op">(</span><span class="fl">30</span><span class="op">)</span>, </span>
<span>                    <span class="va">hobbiton</span><span class="op">$</span><span class="va">geometry_x</span> <span class="op">+</span> <span class="fu">miles_to_meters</span><span class="op">(</span><span class="fl">60</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">hobbiton</span><span class="op">$</span><span class="va">geometry_y</span> <span class="op">-</span> <span class="fu">miles_to_meters</span><span class="op">(</span><span class="fl">35</span><span class="op">)</span>, </span>
<span>                    <span class="va">hobbiton</span><span class="op">$</span><span class="va">geometry_y</span> <span class="op">+</span> <span class="fu">miles_to_meters</span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/shire-zoomed-in-basic-1.png" class="img-fluid figure-img" style="width:100.0%" alt="Basic zoomed-in map of the Shire"></p>
<figcaption class="margin-caption">Basic zoomed-in map of the Shire</figcaption></figure>
</div>
</div>
</div>
<p>Using that window of coordinates, we can make the map extra fancy with some more enhancements. The roads data, for instance, includes a column that indicates if a road is primary, secondary, or tertiary, so we can size by road importance. We can also add some neat little annotations, like a compass indicator and a scale marker (using <code>annotation_scale()</code> and <code>annotation_north_arrow()</code> from the <a href="https://paleolimbot.github.io/ggspatial/">{ggspatial} package</a>). We’ll also add a Tolkienesque plot title with <a href="https://www.dafont.com/aniron.font">the Aniron font</a>:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">shire_towns</span> <span class="op">&lt;-</span> <span class="va">placenames</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">LAYER</span> <span class="op">==</span> <span class="st">"TownNames"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">roads</span>, <span class="fu">aes</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="va">TYPE</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">coastline</span>, linewidth <span class="op">=</span> <span class="fl">0.25</span>, color <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rivers</span>, linewidth <span class="op">=</span> <span class="fl">0.45</span>, color <span class="op">=</span> <span class="va">clr_blue</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_text</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rivers</span>, <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">NAME</span><span class="op">)</span>, color <span class="op">=</span> <span class="va">clr_blue</span>,</span>
<span>               family <span class="op">=</span> <span class="st">"Overpass SemiBold"</span>, fontface <span class="op">=</span> <span class="st">"italic"</span>, size <span class="op">=</span> <span class="fl">3.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_text</span><span class="op">(</span>data <span class="op">=</span> <span class="va">regions</span>, <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">name</span><span class="op">)</span>,</span>
<span>               family <span class="op">=</span> <span class="st">"Overpass Heavy"</span>, size <span class="op">=</span> <span class="fl">5</span>, color <span class="op">=</span> <span class="st">"grey30"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">forests</span>, linewidth <span class="op">=</span> <span class="fl">0</span>, fill <span class="op">=</span> <span class="va">clr_green</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_text</span><span class="op">(</span>data <span class="op">=</span> <span class="va">forests</span>, <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">NAME</span><span class="op">)</span>, nudge_y <span class="op">=</span> <span class="fu">miles_to_meters</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>               color <span class="op">=</span> <span class="va">clr_green</span>, family <span class="op">=</span> <span class="st">"Overpass ExtraBold"</span>, fontface <span class="op">=</span> <span class="st">"italic"</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">shire_towns</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_label</span><span class="op">(</span>data <span class="op">=</span> <span class="va">shire_towns</span>, <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">NAME</span><span class="op">)</span>, nudge_y <span class="op">=</span> <span class="fu">miles_to_meters</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>                family <span class="op">=</span> <span class="st">"Overpass ExtraBold"</span>, fontface <span class="op">=</span> <span class="st">"plain"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_linewidth_discrete</span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.3</span><span class="op">)</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotation_scale</span><span class="op">(</span>location <span class="op">=</span> <span class="st">"tl"</span>, bar_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey30"</span>, <span class="st">"white"</span><span class="op">)</span>,</span>
<span>                   text_family <span class="op">=</span> <span class="st">"Overpass"</span>,</span>
<span>                   unit_category <span class="op">=</span> <span class="st">"imperial"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotation_north_arrow</span><span class="op">(</span></span>
<span>    location <span class="op">=</span> <span class="st">"tl"</span>, pad_y <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1.5</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>    style <span class="op">=</span> <span class="fu">north_arrow_fancy_orienteering</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey30"</span>, <span class="st">"white"</span><span class="op">)</span>, </span>
<span>                                           line_col <span class="op">=</span> <span class="st">"grey30"</span>,</span>
<span>                                           text_family <span class="op">=</span> <span class="st">"Overpass"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">hobbiton</span><span class="op">$</span><span class="va">geometry_x</span> <span class="op">-</span> <span class="fu">miles_to_meters</span><span class="op">(</span><span class="fl">30</span><span class="op">)</span>, </span>
<span>                    <span class="va">hobbiton</span><span class="op">$</span><span class="va">geometry_x</span> <span class="op">+</span> <span class="fu">miles_to_meters</span><span class="op">(</span><span class="fl">60</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">hobbiton</span><span class="op">$</span><span class="va">geometry_y</span> <span class="op">-</span> <span class="fu">miles_to_meters</span><span class="op">(</span><span class="fl">35</span><span class="op">)</span>, </span>
<span>                    <span class="va">hobbiton</span><span class="op">$</span><span class="va">geometry_y</span> <span class="op">+</span> <span class="fu">miles_to_meters</span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"The Shire"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_yellow</span><span class="op">)</span>,</span>
<span>        plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Aniron"</span>, size <span class="op">=</span> <span class="fu">rel</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>                                  hjust <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/shire-zoomed-in-fancy-1.png" class="img-fluid figure-img" style="width:100.0%" alt="Fancy zoomed-in map of the Shire"></p>
<figcaption class="margin-caption">Fancy zoomed-in map of the Shire</figcaption></figure>
</div>
</div>
</div>
<p>ahhh that’s so cool!</p>
</section><section id="distances-between-places" class="level1"><h1>Distances between places</h1>
<p>We’re not done yet though! We can do a lot more GIS-related work with R. Let’s calculate some distances for fun!</p>
<p>In the first half of <em>The Fellowship of the Ring</em>, Frodo, Sam, Merry, and Pippin travel from the Shire to Rivendell. How long of a journey was that?</p>
<p>To figure this out we can extract the coordinates for Rivendell and then find the difference between it and Hobbiton. This doesn’t follow any roads or anything—it’s just as the Nazgûl flies—but it should be fairly accurate.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Find coordinates for Rivendell</span></span>
<span><span class="va">rivendell</span> <span class="op">&lt;-</span> <span class="va">places</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op">==</span> <span class="st">"Rivendell"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">st_distance</span><span class="op">(</span><span class="va">hobbiton</span>, <span class="va">rivendell</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">meters_to_miles</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## Units: [m]</span></span>
<span><span class="co">##      [,1]</span></span>
<span><span class="co">## [1,]  229</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>According to Karen Wynn Fonstad’s <a href="https://www.amazon.com/Atlas-Middle-Earth-Revised-Karen-Fonstad/dp/0618126996"><em>Atlas of Middle-earth</em></a>, though, this should be <a href="https://www.councilofelrond.com/craft/follow-the-fellowship-walk-to-rivendell-and-beyond/">458 miles</a>, which is exactly double the amount we just found! Somehow the distances between everything in the shapefiles are halved from regular-Earth miles.</p>
<p>To fix this we can double the distance between Hobbiton and everything else in the dataset, expanding the data from Hobbiton, which now acts like the center of the world</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">me_scaled</span> <span class="op">&lt;-</span> <span class="va">places</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Hobbiton"</span>, <span class="st">"Rivendell"</span>, <span class="st">"Edoras"</span>, <span class="st">"Minas Tirith"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># Take the existing coordinates, subtract the doubled Hobbiton coordinates,</span></span>
<span>  <span class="co"># and add the Hobbiton coordinates</span></span>
<span>  <span class="fu">st_set_geometry</span><span class="op">(</span><span class="op">(</span><span class="fu">st_geometry</span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">-</span> <span class="fu">st_geometry</span><span class="op">(</span><span class="va">hobbiton</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">+</span> <span class="fu">st_geometry</span><span class="op">(</span><span class="va">hobbiton</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract new coordinates from scaled-up version</span></span>
<span><span class="va">hobbiton_scaled</span> <span class="op">&lt;-</span> <span class="va">me_scaled</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op">==</span> <span class="st">"Hobbiton"</span><span class="op">)</span></span>
<span><span class="va">rivendell_scaled</span> <span class="op">&lt;-</span> <span class="va">me_scaled</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op">==</span> <span class="st">"Rivendell"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fixed!</span></span>
<span><span class="fu">st_distance</span><span class="op">(</span><span class="va">hobbiton_scaled</span>, <span class="va">rivendell_scaled</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">meters_to_miles</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">##      [,1]</span></span>
<span><span class="co">## [1,]  458</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>That’s correct now—it was 458 miles from the Shire to Rivendell.</p>
</section><section id="sticking-middle-earth-in-real-earth" class="level1 page-columns page-full"><h1>Sticking Middle Earth in Real Earth</h1>
<p>Now that we can work with correct distances, we can sick Middle Earth inside Real Earth to help visualize how far spread out Tolkien’s world is.</p>
<section id="in-the-united-states" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="in-the-united-states">In the United States</h2>
<p>First, let’s stick a scaled-up version of Middle Earth in the United States. For fun, we’ll put the Shire in the geographic center of the US, and we’ll calculate the coordinates for that with R just to show that it’s possible.</p>
<p>Currently we have a dataset with 49 rows (48 states + DC). We can use the <code>st_centroid()</code> function to find the center of geographic areas, but if we use it on our current data, we’ll get 49 separate centers. So instead, we’ll melt all the states into one big geographic shape with <code>group_by()</code> and <code>summarize()</code> (using <code>summarize()</code> on the <code>geometry</code> column in an <code>sf</code> dataset combines the geographic areas), and then use <code>st_centroid()</code> on that:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Melt the lower 48 states into one big shape first, then use st_centroid()</span></span>
<span><span class="va">us_dissolved</span> <span class="op">&lt;-</span> <span class="va">lower_48</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>country <span class="op">=</span> <span class="st">"US"</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># Create new column with the country name </span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># Group by that country name column</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span><span class="op">)</span>  <span class="co"># Collapse all the geographic data into one big blob</span></span>
<span><span class="va">us_dissolved</span></span>
<span><span class="co">## Simple feature collection with 1 feature and 1 field</span></span>
<span><span class="co">## Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: -125 ymin: 24.5 xmax: -66.9 ymax: 49.4</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span>
<span><span class="co">## # A tibble: 1 × 2</span></span>
<span><span class="co">##   country                                                                                geometry</span></span>
<span><span class="co">##   &lt;chr&gt;                                                                        &lt;MULTIPOLYGON [°]&gt;</span></span>
<span><span class="co">## 1 US      (((-68.9 43.8, -68.9 43.8, -68.8 43.8, -68.9 43.9, -68.9 43.9, -68.9 43.8)), ((-71.6...</span></span>
<span></span>
<span><span class="va">us_center</span> <span class="op">&lt;-</span> <span class="va">us_dissolved</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_geometry</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># Extract the geometry column</span></span>
<span>  <span class="fu">st_centroid</span><span class="op">(</span><span class="op">)</span>  <span class="co"># Find the center</span></span>
<span><span class="va">us_center</span></span>
<span><span class="co">## Geometry set for 1 feature </span></span>
<span><span class="co">## Geometry type: POINT</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: -99 ymin: 39.8 xmax: -99 ymax: 39.8</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span>
<span><span class="co">## POINT (-99 39.8)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>According to these calculations, the center of the contiguous US is 39.751441°N -98.965620°W. Technically that’s not 100% correct—<a href="https://en.wikipedia.org/wiki/Geographic_center_of_the_United_States#Contiguous_United_States">the true location</a> is at 39.833333°N -98.583333°W, but this is close enough (<a href="https://www.google.com/maps/dir/39.751441,+-98.965620/39.833333,-98.583333/@39.8236494,-98.9352692,11z/">according to Google, it’s 25 miles off</a>). I’m guessing the discrepancy is due to differences in the shapefile—I’m not using the highest resolution possible, and there might be islands I need to account for (or not account for). Who knows.</p>
<p>Here’s where that is. I’m using the <a href="https://rstudio.github.io/leaflet/">{leaflet} package</a> just for fun here (this post is a showcase of different R-based GIS things, so let’s showcase!):</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">us_center_plot</span> <span class="op">&lt;-</span> <span class="va">us_dissolved</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_centroid</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>fancy_coords <span class="op">=</span> <span class="fu">format_coords</span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"&lt;span style='display: block; text-align: center;'&gt;&lt;strong&gt;Roughly of the center of the contiguous US&lt;/strong&gt;"</span>,</span>
<span>                      <span class="st">"&lt;br&gt;{fancy_coords}&lt;/span&gt;"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">leaflet</span><span class="op">(</span><span class="va">us_center_plot</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">setView</span><span class="op">(</span>lng <span class="op">=</span> <span class="fu">st_geometry</span><span class="op">(</span><span class="va">us_center_plot</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>          lat <span class="op">=</span> <span class="fu">st_geometry</span><span class="op">(</span><span class="va">us_center_plot</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, </span>
<span>          zoom <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">addCircleMarkers</span><span class="op">(</span>label <span class="op">=</span> <span class="op">~</span><span class="fu">htmltools</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/htmltools/reference/HTML.html">HTML</a></span><span class="op">(</span><span class="va">label</span><span class="op">)</span>,</span>
<span>                   labelOptions <span class="op">=</span> <span class="fu">labelOptions</span><span class="op">(</span>noHide <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                               direction <span class="op">=</span> <span class="st">"top"</span>, </span>
<span>                                               textOnly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-cd58c04d1217b7d569e4" style="width:100%;height:355.995055624227px;"></div>
<script type="application/json" data-for="htmlwidget-cd58c04d1217b7d569e4">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"setView":[[39.7514407352008,-98.9656202327183],4,[]],"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addCircleMarkers","args":[39.7514407352008,-98.9656202327183,10,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},null,null,null,null,"<span style='display: block; text-align: center;'><strong>Roughly of the center of the contiguous US<\/strong><br>39.751441°N -98.965620°W<\/span>",{"interactive":false,"permanent":true,"direction":"top","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[39.7514407352008,39.7514407352008],"lng":[-98.9656202327183,-98.9656202327183]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Next, we need to transform the Middle Earth data so that it fits on the US map. We need to do a few things to make this work:</p>
<ol type="1">
<li>Double all the distances so they match Real World miles</li>
<li>Change the projection of each of the Middle Earth-related datasets to match the projection of <code>lower_48</code>, or <a href="https://en.wikipedia.org/wiki/World_Geodetic_System">WGS 84</a>, or <a href="https://epsg.io/4326">EPSG:4326</a>
</li>
<li>Shift the Middle Earth-related datasets so that Hobbiton aligns with the center of the US.</li>
</ol>
<p>Changing the projection of an {sf}-enabled dataset is super easy with <code>st_transform()</code>. Let’s first transform the CRS for the Hobbiton coordinates:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">hobbiton_in_us</span> <span class="op">&lt;-</span> <span class="va">hobbiton</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_transform</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="va">lower_48</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hobbiton_in_us</span> <span class="op">%&gt;%</span> <span class="fu">st_geometry</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## Geometry set for 1 feature </span></span>
<span><span class="co">## Geometry type: POINT</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 3.15 ymin: 9.44 xmax: 3.15 ymax: 9.44</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span>
<span><span class="co">## POINT (3.15 9.44)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Note how the coordinates are now on the <a href="https://en.wikipedia.org/wiki/Decimal_degrees">decimal degrees scale</a> (3.15, 9.44) instead of the meter scale (515948, 1043820). That’s how the US map is set up, so now we can do GIS math with the two maps.</p>
<p>Next, we need to calculate the offset from the center of the US and Hobbiton by finding the difference between the two sets of coordinates:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">me_to_us</span> <span class="op">&lt;-</span> <span class="fu">st_coordinates</span><span class="op">(</span><span class="va">us_center</span><span class="op">)</span> <span class="op">-</span> <span class="fu">st_coordinates</span><span class="op">(</span><span class="va">hobbiton_in_us</span><span class="op">)</span></span>
<span><span class="va">me_to_us</span></span>
<span><span class="co">##         X    Y</span></span>
<span><span class="co">## [1,] -102 30.3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now we can use that offset to redefine the geometry column in any Middle Earth-related {sf}-enabled dataset we have. Here’s the process for the <code>places</code> data—it’ll be the same for any of the other shapefiles.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">me_places_in_us</span> <span class="op">&lt;-</span> <span class="va">places</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># Make the Middle Earth data match the US projection</span></span>
<span>  <span class="fu">st_transform</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="va">lower_48</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># Just look at a handful of places</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Hobbiton"</span>, <span class="st">"Rivendell"</span>, <span class="st">"Edoras"</span>, <span class="st">"Minas Tirith"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># Double the distances</span></span>
<span>  <span class="fu">st_set_geometry</span><span class="op">(</span><span class="op">(</span><span class="fu">st_geometry</span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">-</span> <span class="fu">st_geometry</span><span class="op">(</span><span class="va">hobbiton_in_us</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">+</span> <span class="fu">st_geometry</span><span class="op">(</span><span class="va">hobbiton_in_us</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># Shift everything around so that Hobbiton is in the center of the US</span></span>
<span>  <span class="fu">st_set_geometry</span><span class="op">(</span><span class="fu">st_geometry</span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">+</span> <span class="va">me_to_us</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># All the geometry math made us lose the projection metadata; set it again</span></span>
<span>  <span class="fu">st_set_crs</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="va">lower_48</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can now stick this US-transformed set of place locations insde a map of the US. (Note the ±70000 values for nudging. I have no idea what scale these are on—they’re not meters or miles (maybe feet? maybe decimal degrees?). I had to tinker with different values until it looked okay.)</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lower_48</span>, fill <span class="op">=</span> <span class="st">"#FF851B"</span>, color <span class="op">=</span> <span class="st">"white"</span>, linewidth <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">me_places_in_us</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_label</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">me_places_in_us</span>, <span class="va">NAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Hobbiton"</span>, <span class="st">"Edoras"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">NAME</span><span class="op">)</span>, nudge_x <span class="op">=</span> <span class="op">-</span><span class="fl">70000</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_label</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">me_places_in_us</span>, <span class="va">NAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Rivendell"</span>, <span class="st">"Minas Tirith"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">NAME</span><span class="op">)</span>, nudge_x <span class="op">=</span> <span class="fl">70000</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"ESRI:102003"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Albers</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/basic-us-me-places-1.png" class="img-fluid figure-img" style="width:100.0%" alt="Middle Earth locations placed in the US"></p>
<figcaption class="margin-caption">Middle Earth locations placed in the US</figcaption></figure>
</div>
</div>
</div>
<p>Assuming the Shire is in the middle of Kansas, Rivendell would be near the Mississippi River in Missouri. Rohan is down in southern Arkansas, while Gondor is in southern Alabama.</p>
<p>We could be even fancier and reshift <em>all</em> the Middle Earth shapefiles to fit in the US, and then overlay all of Middle Earth on the US, but I won’t do that here. I’ll just stick the coastline on so we can compare the relative sizes of the US and Middle Earth:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">coastline_in_us</span> <span class="op">&lt;-</span> <span class="va">coastline</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_transform</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="va">lower_48</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">st_set_geometry</span><span class="op">(</span><span class="op">(</span><span class="fu">st_geometry</span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">-</span> <span class="fu">st_geometry</span><span class="op">(</span><span class="va">hobbiton_in_us</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">+</span> <span class="fu">st_geometry</span><span class="op">(</span><span class="va">hobbiton_in_us</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_set_geometry</span><span class="op">(</span><span class="fu">st_geometry</span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">+</span> <span class="va">me_to_us</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_set_crs</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="va">lower_48</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lower_48</span>, fill <span class="op">=</span> <span class="st">"#FF851B"</span>, color <span class="op">=</span> <span class="st">"white"</span>, linewidth <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">coastline_in_us</span>, linewidth <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">me_places_in_us</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_label</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">me_places_in_us</span>, <span class="va">NAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Hobbiton"</span>, <span class="st">"Edoras"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">NAME</span><span class="op">)</span>, nudge_x <span class="op">=</span> <span class="op">-</span><span class="fl">70000</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_label</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">me_places_in_us</span>, <span class="va">NAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Rivendell"</span>, <span class="st">"Minas Tirith"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">NAME</span><span class="op">)</span>, nudge_x <span class="op">=</span> <span class="fl">70000</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"ESRI:102003"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Albers</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/fancier-us-me-places-1.png" class="img-fluid figure-img" style="width:100.0%" alt="Middle Earth locations and borders placed in the US"></p>
<figcaption class="margin-caption">Middle Earth locations and borders placed in the US</figcaption></figure>
</div>
</div>
</div>
</section><section id="in-europe" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="in-europe">In Europe</h2>
<p>Sticking Middle Earth in the US makes sense because I live in the US, so these relative distances are straightforward to me. (I’m in Georgia, which is the middle of Mordor in the maps above).</p>
<p>But Tolkien was from England and lived in Oxford—at <a href="https://en.wikipedia.org/wiki/Northmoor_Road">20 Northmoor Road</a> to be precise, or at <a href="https://www.google.com/maps/place/20+Northmoor+Rd,+Oxford+OX2+6UR,+UK/@51.7710103,-1.2626846,17z/">51.771004°N -1.260142°W</a> to be even more precise (I found this by going to Google Maps, right clicking on Tolkien’s home, and copying the coordinates). Here’s where that is:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tolkien_home</span> <span class="op">&lt;-</span> <span class="fu">tribble</span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">place</span>, <span class="op">~</span><span class="va">lat</span>, <span class="op">~</span><span class="va">long</span>,</span>
<span>  <span class="st">"Tolkien's home"</span>, <span class="fl">51.771003605142724</span>, <span class="op">-</span><span class="fl">1.2601418874304429</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_as_sf</span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"long"</span>, <span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4326"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">tolkien_home_plot</span> <span class="op">&lt;-</span> <span class="va">tolkien_home</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>fancy_coords <span class="op">=</span> <span class="fu">format_coords</span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"&lt;span style='display: block; text-align: center;'&gt;&lt;strong&gt;{place}&lt;/strong&gt;"</span>,</span>
<span>                      <span class="st">"&lt;br&gt;{fancy_coords}&lt;/span&gt;"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">leaflet</span><span class="op">(</span><span class="va">tolkien_home_plot</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">setView</span><span class="op">(</span>lng <span class="op">=</span> <span class="fu">st_geometry</span><span class="op">(</span><span class="va">tolkien_home_plot</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>          lat <span class="op">=</span> <span class="fu">st_geometry</span><span class="op">(</span><span class="va">tolkien_home_plot</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, </span>
<span>          zoom <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">addCircleMarkers</span><span class="op">(</span>label <span class="op">=</span> <span class="op">~</span><span class="fu">htmltools</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/htmltools/reference/HTML.html">HTML</a></span><span class="op">(</span><span class="va">label</span><span class="op">)</span>,</span>
<span>                   labelOptions <span class="op">=</span> <span class="fu">labelOptions</span><span class="op">(</span>noHide <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                               direction <span class="op">=</span> <span class="st">"top"</span>, </span>
<span>                                               textOnly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-b025034012f814278eae" style="width:100%;height:355.995055624227px;"></div>
<script type="application/json" data-for="htmlwidget-b025034012f814278eae">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"setView":[[51.7710036051427,-1.26014188743044],14,[]],"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addCircleMarkers","args":[51.7710036051427,-1.26014188743044,10,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},null,null,null,null,"<span style='display: block; text-align: center;'><strong>Tolkien's home<\/strong><br>51.771004°N -1.260142°W<\/span>",{"interactive":false,"permanent":true,"direction":"top","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[51.7710036051427,51.7710036051427],"lng":[-1.26014188743044,-1.26014188743044]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>We can put Hobbiton in Tolkien’s home and then see the relative distances to the rest of Middle Earth from Oxford.</p>
<p>We’ll use the Natural Earth data that we loaded at the beginning of this post. We could theoretically filter it to only look at European countries, since it includes a column for continent, but doing so causes all sorts of issues:</p>
<ul>
<li>Russia is huuuuge</li>
<li>French Guiana is officially part of France, so the map includes a part of South America</li>
<li>Other countries like Denmark, Norway, and the UK have similar overseas province-like territories, so the map gets even more expanded</li>
</ul>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">europe</span> <span class="op">&lt;-</span> <span class="va">world_map</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Europe"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">europe</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/europe-only-not-great-1.png" class="img-fluid figure-img" style="width:100.0%" alt="Ugly map of all European countries"></p>
<figcaption class="margin-caption">Ugly map of all European countries</figcaption></figure>
</div>
</div>
</div>
<p>We could do some fancy filtering and <a href="https://github.com/nvkelso/natural-earth-vector/issues/196">use more detailed data that splits places like France into separate subdivisions</a> (i.e.&nbsp;one row for continental Europe France, one row for French Guiana, etc.), but that’s a lot of work. So instead, we’ll use <code>coord_sf()</code> to define a window so we can zoom in on just a chunk of Europe. Before, we added some arbitrary number of miles around the coordinates for Hobbiton. This time we’ll <a href="https://www.openstreetmap.org/export#map=4/54.47/12.79">use a helpful tool from OpenStreetMap</a> that lets you draw a bounding box on a world map to get coordinates to work with:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="img/osm-export.png" class="img-fluid figure-img" style="width:100.0%" alt="OpenStreetMap's site for exporting bounding box coordinates"></p>
<figcaption class="margin-caption">OpenStreetMap’s site for exporting bounding box coordinates</figcaption></figure>
</div>
</div>
</div>
<p>We can then create a <a href="https://felixanalytix.medium.com/how-to-map-any-region-of-the-world-using-r-programming-bb3c4146f97f">little matrix of coordinates</a>. We’re ultimately going to use the <a href="https://epsg.io/5633">PTRA08 / LAEA Europe projection</a>, which is centered in Portugal and is a good Europe-centric projection, so we’ll convert the list of coordinates to that projection.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">europe_window</span> <span class="op">&lt;-</span> <span class="fu">st_sfc</span><span class="op">(</span></span>
<span>  <span class="fu">st_point</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">12.4</span>, <span class="fl">29.31</span><span class="op">)</span><span class="op">)</span>,  <span class="co"># left (west), bottom (south)</span></span>
<span>  <span class="fu">st_point</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">44.74</span>, <span class="fl">64.62</span><span class="op">)</span><span class="op">)</span>,  <span class="co"># right (east), top (north)</span></span>
<span>  crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4326"</span><span class="op">)</span>   <span class="co"># WGS 84</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_transform</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:5633"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># LAEA Europe, centered in Portugal</span></span>
<span>  <span class="fu">st_coordinates</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">europe_window</span></span>
<span><span class="co">##            X       Y</span></span>
<span><span class="co">## [1,] 2135398 1019399</span></span>
<span><span class="co">## [2,] 5912220 5020959</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now we can plot the full world map data and use <code>coord_sf()</code> to limit it to just this window:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">world_map</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:5633"</span><span class="op">)</span>,</span>
<span>           xlim <span class="op">=</span> <span class="va">europe_window</span><span class="op">[</span>, <span class="st">"X"</span><span class="op">]</span>,</span>
<span>           ylim <span class="op">=</span> <span class="va">europe_window</span><span class="op">[</span>, <span class="st">"Y"</span><span class="op">]</span>,</span>
<span>           expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/try-europe-window-1.png" class="img-fluid figure-img" style="width:60.0%" alt="World map cropped to just show part of Europe"></p>
<figcaption class="margin-caption">World map cropped to just show part of Europe</figcaption></figure>
</div>
</div>
</div>
<p>Neat. Now that we know how to zoom in on Europe, we can go through the same process we did with the US—we’ll convert the Middle Earth shapefiles to the European projection, center Hobbiton on Tolkien’s home in Oxford, double all the distances, and shift everything around.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Convert the Tolkien home coordinates to European coordinates</span></span>
<span><span class="va">tolkien_home</span> <span class="op">&lt;-</span> <span class="va">tolkien_home</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_transform</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:5633"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert the Hobbiton coordinates to European coordinates</span></span>
<span><span class="va">hobbiton_in_europe</span> <span class="op">&lt;-</span> <span class="va">hobbiton</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_transform</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:5633"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Find the offset between Tolkien's home and Hobbiton</span></span>
<span><span class="va">me_to_europe</span> <span class="op">&lt;-</span> <span class="fu">st_coordinates</span><span class="op">(</span><span class="va">tolkien_home</span><span class="op">)</span> <span class="op">-</span> <span class="fu">st_coordinates</span><span class="op">(</span><span class="va">hobbiton_in_europe</span><span class="op">)</span></span>
<span></span>
<span><span class="va">me_places_in_europe</span> <span class="op">&lt;-</span> <span class="va">places</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># Make the Middle Earth data match the Europe projection</span></span>
<span>  <span class="fu">st_transform</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:5633"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># Just look at a handful of places</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Hobbiton"</span>, <span class="st">"Rivendell"</span>, <span class="st">"Edoras"</span>, <span class="st">"Minas Tirith"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># Double the distances</span></span>
<span>  <span class="fu">st_set_geometry</span><span class="op">(</span><span class="op">(</span><span class="fu">st_geometry</span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">-</span> <span class="fu">st_geometry</span><span class="op">(</span><span class="va">hobbiton_in_europe</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">+</span> <span class="fu">st_geometry</span><span class="op">(</span><span class="va">hobbiton_in_europe</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># Shift everything around so that Hobbiton is in Oxford</span></span>
<span>  <span class="fu">st_set_geometry</span><span class="op">(</span><span class="fu">st_geometry</span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">+</span> <span class="va">me_to_europe</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># All the geometry math made us lose the projection metadata; set it again</span></span>
<span>  <span class="fu">st_set_crs</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:5633"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">coastline_in_europe</span> <span class="op">&lt;-</span> <span class="va">coastline</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_transform</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:5633"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">st_set_geometry</span><span class="op">(</span><span class="op">(</span><span class="fu">st_geometry</span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">-</span> <span class="fu">st_geometry</span><span class="op">(</span><span class="va">hobbiton_in_europe</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">+</span> <span class="fu">st_geometry</span><span class="op">(</span><span class="va">hobbiton_in_europe</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_set_geometry</span><span class="op">(</span><span class="fu">st_geometry</span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">+</span> <span class="va">me_to_europe</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_set_crs</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:5633"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">world_map</span>, fill <span class="op">=</span> <span class="st">"#39CCCC"</span>, color <span class="op">=</span> <span class="st">"white"</span>, linewidth <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">coastline_in_europe</span>, linewidth <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">me_places_in_europe</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_label</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">me_places_in_europe</span>, <span class="va">NAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Hobbiton"</span>, <span class="st">"Edoras"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">NAME</span><span class="op">)</span>, nudge_x <span class="op">=</span> <span class="op">-</span><span class="fl">70000</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_label</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">me_places_in_europe</span>, <span class="va">NAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Rivendell"</span>, <span class="st">"Minas Tirith"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">NAME</span><span class="op">)</span>, nudge_x <span class="op">=</span> <span class="fl">70000</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:5633"</span><span class="op">)</span>,</span>
<span>           xlim <span class="op">=</span> <span class="va">europe_window</span><span class="op">[</span>, <span class="st">"X"</span><span class="op">]</span>,</span>
<span>           ylim <span class="op">=</span> <span class="va">europe_window</span><span class="op">[</span>, <span class="st">"Y"</span><span class="op">]</span>,</span>
<span>           expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/fancy-europe-me-places-1.png" class="img-fluid figure-img" style="width:100.0%" alt="Middle Earth locations and borders placed in Europe"></p>
<figcaption class="margin-caption">Middle Earth locations and borders placed in Europe</figcaption></figure>
</div>
</div>
</div>
<p>With Hobbiton in Oxford, Rivendell is in north central Germany (near Hanover?), with Rohan in Switzerland and Gondor on the border of Croatia and Bosnia.</p>
</section></section><section id="things-i-want-to-do-someday-but-am-not-smart-enough-to-do" class="level1 page-columns page-full"><h1>Things I want to do someday but am not smart enough to do</h1>
<p>And there’s our quick tour of {sf} and Middle Earth! It’s incredible how much GIS-related stuff you can do with R, and the plots are all beautiful thanks to the magic of ggplot!</p>
<section id="paths" class="level2"><h2 class="anchored" data-anchor-id="paths">Paths</h2>
<p>It would be really cool to be able to plot the pathways different characters took in each of the books (Bilbo and Thorin’s company; Frodo and Sam; Aragorn, Legolas, and Gimli, etc.). This data exists! <a href="http://lotrproject.com/map/#zoom=3&amp;lat=-1315.5&amp;lon=1500&amp;layers=BTTTTT">The LOTR Project has detailed maps</a> with the pathways of all of the main characters’ journeys. However, it’s not (as far as I can tell) open source or Creative Commons-licensed, and I don’t think the coordinates are directly comparable to the shapefiles from the ME-GIS project. Alas.</p>
</section><section id="first-and-second-ages" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="first-and-second-ages">First and Second Ages</h2>
<p>In addition to <em>The Lord of the Rings</em> and <em>The Hobbit</em>, Tolkien wrote a ton about other ages in Middle Earth (see this <a href="https://www.andrewheiss.com/blog/2023/03/21/aragorn-dunedan-numenorean-simulation/#super-quick-crash-course-in-the-ages-of-arda-n%C3%BAmenor">super quick crash course in the Ages of Arda from my post on Númenorean ages</a>). A separate mapping project—<a href="https://github.com/kwoxer/Arda-Maps">Arda-Maps</a>—has shapefiles for all three ages of Tolkien’s world, including Valinor, Beleriand, and Númenor.</p>
<p>However, the maps aren’t as detailed as the ME-GIS project, and they’re on a completely different scale. For example, here’s the island of Númenor (featured in Amazon’s <em>The Rings of Power</em>). I downloaded the shapefiles from their <a href="https://github.com/kwoxer/Arda-Maps">GitHub repository</a>—the Second Age shapefiles are buried in <code>QGIS/second age/arda2</code></p>
<p>Here I use <code>st_bbox()</code> to create a bounding box of coordinates that I then use to crop the underlying data. This is different from what we did with Europe, where we plotted the whole world map and then zoomed in on just a chunk of western Europe. Here, <code>st_crop()</code> cuts out the geographic data that doesn’t fall within the box (similar to filtering).</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">numenor_box</span> <span class="op">&lt;-</span> <span class="fu">st_bbox</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="fl">0.007</span>, xmax <span class="op">=</span> <span class="fl">0.017</span>, ymin <span class="op">=</span> <span class="op">-</span><span class="fl">0.025</span>, ymax <span class="op">=</span> <span class="op">-</span><span class="fl">0.015</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">numenor_outlines</span> <span class="op">&lt;-</span> <span class="fu">read_sf</span><span class="op">(</span><span class="st">"data/Arda-Maps/QGIS/second age/arda2/poly_outline.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Numenor"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">numenor_rivers</span> <span class="op">&lt;-</span> <span class="fu">read_sf</span><span class="op">(</span><span class="st">"data/Arda-Maps/QGIS/second age/arda2/line_river.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_crop</span><span class="op">(</span><span class="va">numenor_box</span><span class="op">)</span></span>
<span></span>
<span><span class="va">numenor_cities</span> <span class="op">&lt;-</span> <span class="fu">read_sf</span><span class="op">(</span><span class="st">"data/Arda-Maps/QGIS/second age/arda2/point_city.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_crop</span><span class="op">(</span><span class="va">numenor_box</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">numenor_outlines</span>, fill <span class="op">=</span> <span class="st">"#F2CB9B"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">numenor_rivers</span>, linewidth <span class="op">=</span> <span class="fl">0.4</span>, color <span class="op">=</span> <span class="va">clr_blue</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">numenor_cities</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Use geom_label_repel with the geometry column!</span></span>
<span>  <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu">geom_label_repel</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">numenor_cities</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">eventname</span>, geometry <span class="op">=</span> <span class="va">geometry</span><span class="op">)</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"sf_coordinates"</span>, seed <span class="op">=</span> <span class="fl">1234</span>,</span>
<span>    family <span class="op">=</span> <span class="st">"Overpass ExtraBold"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotation_scale</span><span class="op">(</span>location <span class="op">=</span> <span class="st">"tl"</span>, bar_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey30"</span>, <span class="st">"white"</span><span class="op">)</span>,</span>
<span>                   text_family <span class="op">=</span> <span class="st">"Overpass"</span>,</span>
<span>                   unit_category <span class="op">=</span> <span class="st">"imperial"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotation_north_arrow</span><span class="op">(</span></span>
<span>    location <span class="op">=</span> <span class="st">"tl"</span>, pad_y <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1.5</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>    style <span class="op">=</span> <span class="fu">north_arrow_fancy_orienteering</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey30"</span>, <span class="st">"white"</span><span class="op">)</span>, </span>
<span>                                           line_col <span class="op">=</span> <span class="st">"grey30"</span>,</span>
<span>                                           text_family <span class="op">=</span> <span class="st">"Overpass"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Númenor"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_yellow</span><span class="op">)</span>,</span>
<span>        plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Aniron"</span>, size <span class="op">=</span> <span class="fu">rel</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>                                  hjust <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/numenor-map-1.png" class="img-fluid figure-img" style="width:100.0%" alt="Fancy map of Númenor"></p>
<figcaption class="margin-caption">Fancy map of Númenor</figcaption></figure>
</div>
</div>
</div>
<p>The map looks fantastic! But notice the scale bar in the top left corner—in this data, Númenor is only a couple thousand feet wide—less than half a mile. The distances are all way wrong. I could probably scale it up by comparing the projection distances in the Arda Maps’ version of regular Middle Earth with the ME-GIS project’s version of regular Middle Earth and then do some fancy math, <del>but that goes beyond my skills</del>.</p>
</section></section><section id="update-second-age-maps-scaled-to-real-world-distances" class="level1 page-columns page-full"><h1>Update! Second Age maps scaled to Real World distances!</h1>
<p>Just kidding! Scaling stuff up doesn’t go beyond my skills. We’ll do it.</p>
<p>We already converted the data from ME-GIS into Real World miles by doubling all the coordinates centered on Hobbiton, which became the de facto center of the world. We’ll do it again here since all those calculations happened way earlier in this post:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load the shapefile</span></span>
<span><span class="va">placenames</span> <span class="op">&lt;-</span> <span class="fu">read_sf</span><span class="op">(</span><span class="st">"data/ME-GIS/Combined_Placenames.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/iconv.html">iconv</a></span><span class="op">(</span><span class="va">.</span>, from <span class="op">=</span> <span class="st">"ISO-8859-1"</span>, to <span class="op">=</span> <span class="st">"UTF-8"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Pull out Hobbiton</span></span>
<span><span class="va">hobbiton</span> <span class="op">&lt;-</span> <span class="va">placenames</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op">==</span> <span class="st">"Hobbiton"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Double all the distances</span></span>
<span><span class="va">places_ta_scaled</span> <span class="op">&lt;-</span> <span class="va">placenames</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># Take the existing coordinates, subtract the doubled Hobbiton coordinates,</span></span>
<span>  <span class="co"># and add the Hobbiton coordinates</span></span>
<span>  <span class="fu">st_set_geometry</span><span class="op">(</span><span class="op">(</span><span class="fu">st_geometry</span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">-</span> <span class="fu">st_geometry</span><span class="op">(</span><span class="va">hobbiton</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">+</span> <span class="fu">st_geometry</span><span class="op">(</span><span class="va">hobbiton</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">st_set_crs</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="va">placenames</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Confirm that it's 458 miles between Hobbiton and Rivendell</span></span>
<span><span class="va">hobbiton_ta</span> <span class="op">&lt;-</span> <span class="va">places_ta_scaled</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op">==</span> <span class="st">"Hobbiton"</span><span class="op">)</span></span>
<span><span class="va">rivendell_ta</span> <span class="op">&lt;-</span> <span class="va">places_ta_scaled</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op">==</span> <span class="st">"Rivendell"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use set_units() just for fun since st_distance returns the units as metadata</span></span>
<span><span class="fu">st_distance</span><span class="op">(</span><span class="va">hobbiton_ta</span>, <span class="va">rivendell_ta</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">units</span><span class="fu">::</span><span class="fu">set_units</span><span class="op">(</span><span class="st">"miles"</span><span class="op">)</span></span>
<span><span class="co">## Units: [miles]</span></span>
<span><span class="co">##      [,1]</span></span>
<span><span class="co">## [1,]  458</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The Second Age data doesn’t have Hobbiton in it since Hobbits didn’t exist yet (you can see the <a href="https://lotr.fandom.com/wiki/Harfoots">Harfoots</a>, Amazon’s version of proto-Hobbits, in <em>The Rings of Power</em>), but it does have Bree, which is a village near the Shire.</p>
<p>So first, we’ll find the distance between Bree and Rivendell:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bree_ta</span> <span class="op">&lt;-</span> <span class="va">places_ta_scaled</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op">==</span> <span class="st">"Bree"</span><span class="op">)</span></span>
<span><span class="va">bree_to_rivendell_ta</span> <span class="op">&lt;-</span> <span class="fu">st_distance</span><span class="op">(</span><span class="va">bree_ta</span>, <span class="va">rivendell_ta</span><span class="op">)</span></span>
<span><span class="va">bree_to_rivendell_ta</span> <span class="op">%&gt;%</span> <span class="fu">units</span><span class="fu">::</span><span class="fu">set_units</span><span class="op">(</span><span class="st">"miles"</span><span class="op">)</span></span>
<span><span class="co">## Units: [miles]</span></span>
<span><span class="co">##      [,1]</span></span>
<span><span class="co">## [1,]  360</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>360 miles. Lovely.</p>
<p>Next, let’s see how far apart Bree and Rivendell are in the Arda-Maps Second Age map. We’ll reload the data and convert the projection to use the same CRS as the ME-GIS map so that things are comparable.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sa_cities</span> <span class="op">&lt;-</span> <span class="fu">read_sf</span><span class="op">(</span><span class="st">"data/Arda-Maps/QGIS/second age/arda2/point_city.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_transform</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="va">placenames</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rivendell_sa</span> <span class="op">&lt;-</span> <span class="va">sa_cities</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">eventname</span> <span class="op">==</span> <span class="st">"Rivendell"</span><span class="op">)</span></span>
<span><span class="va">bree_sa</span> <span class="op">&lt;-</span> <span class="va">sa_cities</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">eventname</span> <span class="op">==</span> <span class="st">"Bree"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bree_to_rivendell_sa</span> <span class="op">&lt;-</span> <span class="fu">st_distance</span><span class="op">(</span><span class="va">bree_sa</span>, <span class="va">rivendell_sa</span><span class="op">)</span></span>
<span><span class="va">bree_to_rivendell_sa</span> <span class="op">%&gt;%</span> <span class="fu">units</span><span class="fu">::</span><span class="fu">set_units</span><span class="op">(</span><span class="st">"miles"</span><span class="op">)</span></span>
<span><span class="co">## Units: [miles]</span></span>
<span><span class="co">##       [,1]</span></span>
<span><span class="co">## [1,] 0.166</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Hahaha, in this tiny map, it’s only a sixth of a mile between Bree and Rivendell. Assuming there are 2,000 steps in a mile, that’s only 333 steps, which is just a little more than what Fitbits and Apple Watches try to make you do over the course of an hour.</p>
<p>We need to turn this sixth of a mile into 360 miles, which involves dividing by… something. I always forget how to rescale things, so I find it helpful to write out the algebra for it:</p>
<p><span class="math display">\[
\begin{aligned}
0.1666x &amp;= 360 \\
x &amp;= \frac{360}{0.1666} \\
x &amp;= 2160\text{ish}
\end{aligned}
\]</span></p>
<p>If we multiply everything in the Second Age map data by 2160ish, we should be good. First we’ll get the official, more precise number (since we’re missing decimals in the quick algebra above):</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sa_to_ta_conversion</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">bree_to_rivendell_ta</span> <span class="op">/</span> <span class="va">bree_to_rivendell_sa</span><span class="op">)</span></span>
<span><span class="va">sa_to_ta_conversion</span></span>
<span><span class="co">## [1] 2174</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Next we’ll scale up the Second Age map data, using Bree as the central reference point:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sa_cities_scaled</span> <span class="op">&lt;-</span> <span class="va">sa_cities</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_set_geometry</span><span class="op">(</span><span class="op">(</span><span class="fu">st_geometry</span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">-</span> <span class="fu">st_geometry</span><span class="op">(</span><span class="va">bree_sa</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="va">sa_to_ta_conversion</span> <span class="op">+</span> <span class="fu">st_geometry</span><span class="op">(</span><span class="va">bree_sa</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_set_crs</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="va">placenames</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Finally let’s make sure it worked. We’re looking for 360 miles:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rivendell_sa_scaled</span> <span class="op">&lt;-</span> <span class="va">sa_cities_scaled</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">eventname</span> <span class="op">==</span> <span class="st">"Rivendell"</span><span class="op">)</span></span>
<span><span class="va">bree_sa_scaled</span> <span class="op">&lt;-</span> <span class="va">sa_cities_scaled</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">eventname</span> <span class="op">==</span> <span class="st">"Bree"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">st_distance</span><span class="op">(</span><span class="va">bree_sa_scaled</span>, <span class="va">rivendell_sa_scaled</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">units</span><span class="fu">::</span><span class="fu">set_units</span><span class="op">(</span><span class="st">"miles"</span><span class="op">)</span></span>
<span><span class="co">## Units: [miles]</span></span>
<span><span class="co">##      [,1]</span></span>
<span><span class="co">## [1,]  360</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>It worked!</p>
<p>Now we can plot this thing. Since we’re working with a different projection, the bounding box (<code>numenor_box</code>) that we previously made for cropping the shapefiles won’t work. But we can be even more precise by extracting the bounding box from the Númenor outlines and then using <em>that</em> as the cropping box.</p>
<p>Also, we’ll add some more layers to the map for fun, but because this rescaling business can get repetitive and tedious, we’ll make a little function to cut down on repetition.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">numenor_outlines</span> <span class="op">&lt;-</span> <span class="fu">read_sf</span><span class="op">(</span><span class="st">"data/Arda-Maps/QGIS/second age/arda2/poly_outline.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_transform</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="va">placenames</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Numenor"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the bounds for Númenor so we can crop everything else with it</span></span>
<span><span class="va">numenor_bbox</span> <span class="op">&lt;-</span> <span class="fu">st_bbox</span><span class="op">(</span><span class="va">numenor_outlines</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Little helper function to scale things from the Second Age to the real world</span></span>
<span><span class="va">scale_sa_to_real_world</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu">st_set_geometry</span><span class="op">(</span><span class="op">(</span><span class="fu">st_geometry</span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">-</span> <span class="fu">st_geometry</span><span class="op">(</span><span class="va">bree_sa</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">sa_to_ta_conversion</span><span class="op">)</span> <span class="op">+</span> <span class="fu">st_geometry</span><span class="op">(</span><span class="va">bree_sa</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu">st_set_crs</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="va">placenames</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">numenor_outlines_scaled</span> <span class="op">&lt;-</span> <span class="va">numenor_outlines</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">scale_sa_to_real_world</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">numenor_rivers_scaled</span> <span class="op">&lt;-</span> <span class="fu">read_sf</span><span class="op">(</span><span class="st">"data/Arda-Maps/QGIS/second age/arda2/line_river.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_transform</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="va">placenames</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_crop</span><span class="op">(</span><span class="va">numenor_bbox</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">scale_sa_to_real_world</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">numenor_cities_scaled</span> <span class="op">&lt;-</span> <span class="fu">read_sf</span><span class="op">(</span><span class="st">"data/Arda-Maps/QGIS/second age/arda2/point_city.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_transform</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="va">placenames</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_crop</span><span class="op">(</span><span class="va">numenor_bbox</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">scale_sa_to_real_world</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">numenor_forests_scaled</span> <span class="op">&lt;-</span> <span class="fu">read_sf</span><span class="op">(</span><span class="st">"data/Arda-Maps/QGIS/second age/arda2/poly_forest.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_transform</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="va">placenames</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_crop</span><span class="op">(</span><span class="va">numenor_bbox</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">scale_sa_to_real_world</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">numenor_highlands_scaled</span> <span class="op">&lt;-</span> <span class="fu">read_sf</span><span class="op">(</span><span class="st">"data/Arda-Maps/QGIS/second age/arda2/poly_highland.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_transform</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="va">placenames</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_crop</span><span class="op">(</span><span class="va">numenor_bbox</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">scale_sa_to_real_world</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">numenor_regions_scaled</span> <span class="op">&lt;-</span> <span class="fu">read_sf</span><span class="op">(</span><span class="st">"data/Arda-Maps/QGIS/second age/arda2/poly_region.shp"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_transform</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="va">placenames</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">st_crop</span><span class="op">(</span><span class="va">numenor_bbox</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">scale_sa_to_real_world</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Mapping time!</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Background of the island</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">numenor_outlines_scaled</span>, linewidth <span class="op">=</span> <span class="fl">0</span>, fill <span class="op">=</span> <span class="st">"#F2CB9B"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">numenor_forests_scaled</span>, </span>
<span>          linewidth <span class="op">=</span> <span class="fl">0</span>, fill <span class="op">=</span> <span class="va">clr_green</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">numenor_highlands_scaled</span>, </span>
<span>          linewidth <span class="op">=</span> <span class="fl">0</span>, fill <span class="op">=</span> <span class="fu">colorspace</span><span class="fu">::</span><span class="fu">darken</span><span class="op">(</span><span class="st">"#F2CB9B"</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">numenor_rivers_scaled</span>, linewidth <span class="op">=</span> <span class="fl">0.4</span>, color <span class="op">=</span> <span class="va">clr_blue</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Region borders</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">numenor_regions_scaled</span>, linewidth <span class="op">=</span> <span class="fl">0.2</span>, linetype <span class="op">=</span> <span class="st">"33"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Island borders to cover up the dotted region lines on the coast</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">numenor_outlines_scaled</span>, linewidth <span class="op">=</span> <span class="fl">0.25</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_text</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">numenor_regions_scaled</span>, <span class="va">eventname</span> <span class="op">!=</span> <span class="st">"Mittalmar"</span><span class="op">)</span>, </span>
<span>               <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">eventname</span><span class="op">)</span>,</span>
<span>               family <span class="op">=</span> <span class="st">"Overpass Heavy"</span>, size <span class="op">=</span> <span class="fl">5</span>, color <span class="op">=</span> <span class="st">"grey30"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf_text</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">numenor_regions_scaled</span>, <span class="va">eventname</span> <span class="op">==</span> <span class="st">"Mittalmar"</span><span class="op">)</span>, </span>
<span>               <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">eventname</span><span class="op">)</span>,</span>
<span>               family <span class="op">=</span> <span class="st">"Overpass Heavy"</span>, size <span class="op">=</span> <span class="fl">5</span>, color <span class="op">=</span> <span class="st">"grey30"</span>,</span>
<span>               nudge_y <span class="op">=</span> <span class="fu">miles_to_meters</span><span class="op">(</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">numenor_cities_scaled</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu">geom_label_repel</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">numenor_cities_scaled</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">eventname</span>, geometry <span class="op">=</span> <span class="va">geometry</span><span class="op">)</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"sf_coordinates"</span>, seed <span class="op">=</span> <span class="fl">1234</span>,</span>
<span>    family <span class="op">=</span> <span class="st">"Overpass ExtraBold"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotation_scale</span><span class="op">(</span>location <span class="op">=</span> <span class="st">"tl"</span>, bar_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey30"</span>, <span class="st">"white"</span><span class="op">)</span>,</span>
<span>                   text_family <span class="op">=</span> <span class="st">"Overpass"</span>,</span>
<span>                   unit_category <span class="op">=</span> <span class="st">"imperial"</span>,</span>
<span>                   width_hint <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotation_north_arrow</span><span class="op">(</span></span>
<span>    location <span class="op">=</span> <span class="st">"tl"</span>, pad_y <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1.5</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>    style <span class="op">=</span> <span class="fu">north_arrow_fancy_orienteering</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey30"</span>, <span class="st">"white"</span><span class="op">)</span>, </span>
<span>                                           line_col <span class="op">=</span> <span class="st">"grey30"</span>,</span>
<span>                                           text_family <span class="op">=</span> <span class="st">"Overpass"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Númenor"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#bacdf7"</span><span class="op">)</span>,</span>
<span>        plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Aniron"</span>, size <span class="op">=</span> <span class="fu">rel</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>                                  hjust <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/numenor-map-correct-1.png" class="img-fluid figure-img" style="width:100.0%" alt="Correctly scaled fancy map of Númenor"></p>
<figcaption class="margin-caption">Correctly scaled fancy map of Númenor</figcaption></figure>
</div>
</div>
</div>
<p>We can compare it with Karen Wynn Fonstad’s map of Númenor from page 43 in <a href="https://www.amazon.com/Atlas-Middle-Earth-Revised-Karen-Fonstad/dp/0618126996"><em>Atlas of Middle-earth</em></a> and the scaling all seems correct—the island is about 600 miles wide in both the book and in the data.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="img/numenor-fonstad.png" class="img-fluid figure-img" style="width:100.0%" alt="Karen Wynn Fonstad's map of Númenor"></p>
<figcaption class="margin-caption">Karen Wynn Fonstad’s map of Númenor</figcaption></figure>
</div>
</div>
</div>
<p>Success!</p>


<!-- -->

</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{heiss2023,
  author = {Heiss, Andrew},
  title = {Making {Middle} {Earth} Maps with {R}},
  date = {2023-04-26},
  url = {https://www.andrewheiss.com/blog/2023/04/26/middle-earth-mapping-sf-r-gis/},
  doi = {10.59350/ccrtd-z3s22},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-heiss2023" class="csl-entry quarto-appendix-citeas" role="listitem">
Heiss, Andrew. 2023. <span>“Making Middle Earth Maps with R.”</span>
April 26, 2023. <a href="https://doi.org/10.59350/ccrtd-z3s22">https://doi.org/10.59350/ccrtd-z3s22</a>.
</div></div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.andrewheiss\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><script src="https://giscus.app/client.js" data-repo="andrewheiss/ath-quarto" data-repo-id="R_kgDOIg6EJQ" data-category="Blog comments" data-category-id="DIC_kwDOIg6EJc4CSz92" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><input type="hidden" id="giscus-base-theme" value="light"><input type="hidden" id="giscus-alt-theme" value="dark"><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb49" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Making Middle Earth maps with R"</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2023-04-26</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Explore Tolkien's Middle Earth with R-based GIS tools, including {ggplot2} and {sf}"</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> index_files/figure-html/shire-zoomed-in-fancy-1.png</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="an">twitter-card:</span><span class="co"> </span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co">    image: "index_files/figure-html/shire-zoomed-in-fancy-1.png"</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="an">open-graph:</span><span class="co"> </span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="co">    image: "index_files/figure-html/shire-zoomed-in-fancy-1.png"</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co">  - r</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="co">  - tidyverse</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="co">  - ggplot</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="co">  - gis</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a><span class="co">  - maps</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="co">  - nerdery</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a><span class="co">  html: </span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: show</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a><span class="an">doi:</span><span class="co"> 10.59350/ccrtd-z3s22</span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a><span class="an">citation:</span><span class="co"> true</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(fig.align = "center", fig.retina = 3,</span></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a><span class="in">                      fig.width = 6, fig.height = (6 / 1.618),</span></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a><span class="in">                      out.width = "90%", collapse = TRUE,</span></span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a><span class="in">                      dev = "ragg_png")</span></span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a><span class="in">options(digits = 3, width = 300)</span></span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>I've taught a course on data visualization with R since 2017, and it's become one of my more popular classes, especially since <span class="co">[</span><span class="ot">it's all available asynchronously online</span><span class="co">](https://datavizs22.classes.andrewheiss.com/)</span> with hours of Creative Commons-licensed videos and materials. One of the most popular sections of the class (as measured by my server logs and by how often I use it myself) is <span class="co">[</span><span class="ot">a section on GIS-related visualization</span><span class="co">](https://datavizs22.classes.andrewheiss.com/example/12-example/)</span>, or how to work with maps in {ggplot2}. Nowadays, since the advent of the <span class="co">[</span><span class="ot">{sf} package</span><span class="co">](https://r-spatial.github.io/sf/)</span>, I find that making maps with R is incredibly easy and fun.</span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a>I'm also a huge fan of J. R. R. Tolkien and his entire <span class="co">[</span><span class="ot">Legendarium</span><span class="co">](https://en.wikipedia.org/wiki/Tolkien%27s_legendarium)</span> (as evidenced by <span class="co">[</span><span class="ot">my previous blog post here</span><span class="co">](https://www.andrewheiss.com/blog/2023/03/21/aragorn-dunedan-numenorean-simulation/)</span> simulating Aragorn's human-scale age based on an obscure footnote in Tolkien's writings about Númenor).</span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a>Back in 2020, as I was polishing up my data visualization course page on visualizing spatial data, I stumbled across <span class="co">[</span><span class="ot">a set of shapefiles for Middle Earth</span><span class="co">](https://github.com/jvangeld/ME-GIS)</span>, meaning that it was possible to use R and ggplot to make maps of Tolkien's fictional world. I whipped up a quick example and <span class="co">[</span><span class="ot">tweeted about it</span><span class="co">](https://twitter.com/andrewheiss/status/1291380121069330432)</span> back then, but then kind of forgot about it.</span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a>With Twitter dying, and with my recent read of *The Fall of Númenor*, Middle Earth maps have been on my mind again, so I figured I'd make a more formal didactic blog post about how to make and play with these maps. So consider this blog post a fun little playground for learning more about doing GIS work with {sf} and ggplot, and learn some neat data visualization tricks along the way.</span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a>Let's put the R in "J. R. R."</span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a><span class="fu"># Lightning quick overview of {sf} and shapefiles</span></span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-45"><a href="#cb49-45" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb49-46"><a href="#cb49-46" aria-hidden="true" tabindex="-1"></a>This is a wildly brief intro to the {sf} package. For more details, see my <span class="co">[</span><span class="ot">data visualization lesson on visualizing space</span><span class="co">](https://datavizs22.classes.andrewheiss.com/example/12-example/)</span>, as well as the free <span class="co">[</span><span class="ot">*Spatial Data Science*</span><span class="co">](https://r-spatial.org/book/)</span> and <span class="co">[</span><span class="ot">Geocomputation with R</span><span class="co">](https://r.geocompx.org/)</span> books.</span>
<span id="cb49-47"><a href="#cb49-47" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb49-48"><a href="#cb49-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-49"><a href="#cb49-49" aria-hidden="true" tabindex="-1"></a>Thanks to the magic of the <span class="co">[</span><span class="ot">{sf} package</span><span class="co">](https://r-spatial.github.io/sf/)</span> ("sf" = <span class="co">[</span><span class="ot">"simple features"</span><span class="co">](https://en.wikipedia.org/wiki/Simple_Features)</span>), working with geographic (or GIS) data in R is really really straightforward and fun. </span>
<span id="cb49-50"><a href="#cb49-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-51"><a href="#cb49-51" aria-hidden="true" tabindex="-1"></a>Geographic data is a lot more complex than regular tabular spreadsheet-like data, since it includes information about points (latitude, longitude), paths (a bunch of connected latitudes and longitudes) and areas (a bunch of connected latitudes and longitudes that form a complete shape). Additionally, it has to keep track of units and distances and map projections (or methods for <span class="co">[</span><span class="ot">flattening parts of a round globe onto a two-dimensional surface</span><span class="co">](https://www.youtube.com/watch?v=kIID5FDi2JQ)</span>). This kind of data is often stored in <span class="co">[</span><span class="ot">shapefile format</span><span class="co">](https://en.wikipedia.org/wiki/Shapefile)</span> (though there are alternatives like <span class="co">[</span><span class="ot">GeoJSON</span><span class="co">](https://en.wikipedia.org/wiki/GeoJSON)</span>), which consist of multiple files. For instance, here's what the 2022 US Census's shapefile for US states looks like when unzipped:</span>
<span id="cb49-52"><a href="#cb49-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-53"><a href="#cb49-53" aria-hidden="true" tabindex="-1"></a><span class="in">```text</span></span>
<span id="cb49-54"><a href="#cb49-54" aria-hidden="true" tabindex="-1"></a><span class="in">cb_2022_us_state_20m</span></span>
<span id="cb49-55"><a href="#cb49-55" aria-hidden="true" tabindex="-1"></a><span class="in">├── cb_2022_us_state_20m.cpg</span></span>
<span id="cb49-56"><a href="#cb49-56" aria-hidden="true" tabindex="-1"></a><span class="in">├── cb_2022_us_state_20m.dbf</span></span>
<span id="cb49-57"><a href="#cb49-57" aria-hidden="true" tabindex="-1"></a><span class="in">├── cb_2022_us_state_20m.prj</span></span>
<span id="cb49-58"><a href="#cb49-58" aria-hidden="true" tabindex="-1"></a><span class="in">├── cb_2022_us_state_20m.shp</span></span>
<span id="cb49-59"><a href="#cb49-59" aria-hidden="true" tabindex="-1"></a><span class="in">├── cb_2022_us_state_20m.shp.ea.iso.xml</span></span>
<span id="cb49-60"><a href="#cb49-60" aria-hidden="true" tabindex="-1"></a><span class="in">├── cb_2022_us_state_20m.shp.iso.xml</span></span>
<span id="cb49-61"><a href="#cb49-61" aria-hidden="true" tabindex="-1"></a><span class="in">└── cb_2022_us_state_20m.shx</span></span>
<span id="cb49-62"><a href="#cb49-62" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-63"><a href="#cb49-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-64"><a href="#cb49-64" aria-hidden="true" tabindex="-1"></a>It has 7 different files, each with different purposes! Fortunately, it's easy to read all these in with {sf}. Feed the name of the main <span class="in">`.shp`</span> file to <span class="in">`read_sf()`</span> and it'll handle all the other secondary files (like <span class="in">`.dbf`</span> and <span class="in">`.shx`</span> and <span class="in">`.prj`</span>).</span>
<span id="cb49-65"><a href="#cb49-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-66"><a href="#cb49-66" aria-hidden="true" tabindex="-1"></a>Here I've downloaded the <span class="co">[</span><span class="ot">US Census's 1:20,000,000 Cartographic Boundary File shapefile</span><span class="co">](https://www.census.gov/geographies/mapping-files/time-series/geo/cartographic-boundary.html)</span> and put it in a folder named <span class="in">`data`</span>. We can load it into R with <span class="in">`read_sf()`</span>:</span>
<span id="cb49-67"><a href="#cb49-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-68"><a href="#cb49-68" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load-census-data, warning=FALSE, message=FALSE}</span></span>
<span id="cb49-69"><a href="#cb49-69" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb49-70"><a href="#cb49-70" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb49-71"><a href="#cb49-71" aria-hidden="true" tabindex="-1"></a><span class="in">library(sf)</span></span>
<span id="cb49-72"><a href="#cb49-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-73"><a href="#cb49-73" aria-hidden="true" tabindex="-1"></a><span class="in"># https://www.census.gov/geographies/mapping-files/time-series/geo/cartographic-boundary.html</span></span>
<span id="cb49-74"><a href="#cb49-74" aria-hidden="true" tabindex="-1"></a><span class="in">us_states &lt;- read_sf("data/cb_2022_us_state_20m/cb_2022_us_state_20m.shp")</span></span>
<span id="cb49-75"><a href="#cb49-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-76"><a href="#cb49-76" aria-hidden="true" tabindex="-1"></a><span class="in"># Just show some of the columns</span></span>
<span id="cb49-77"><a href="#cb49-77" aria-hidden="true" tabindex="-1"></a><span class="in">us_states %&gt;% </span></span>
<span id="cb49-78"><a href="#cb49-78" aria-hidden="true" tabindex="-1"></a><span class="in">  select(STATEFP, STUSPS, NAME, geometry)</span></span>
<span id="cb49-79"><a href="#cb49-79" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-80"><a href="#cb49-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-81"><a href="#cb49-81" aria-hidden="true" tabindex="-1"></a>It looks like a regular R dataframe, and it is (all the regular dplyr functions work on it), but it has one added part—there's a special list column at the end named <span class="in">`geometry`</span> that contains the actual geographic data, and the dataframe has special metadata with details about the map projection. As seen above, the data uses <span class="co">[</span><span class="ot">NAD 83</span><span class="co">](https://geodesy.noaa.gov/datums/horizontal/north-american-datum-1983.shtml)</span>. We can change that to any projection we want, though, with <span class="in">`st_transform()`</span>. To make life a little easier when calculating distances and combining maps later in this post, we'll convert this US map to the WGS 84 projection, which is what Google Maps (and all GPS systems) use:</span>
<span id="cb49-82"><a href="#cb49-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-83"><a href="#cb49-83" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb49-84"><a href="#cb49-84" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">See this for a short overview</span><span class="co">](https://datavizs22.classes.andrewheiss.com/example/12-example/#projections-and-coordinate-reference-systems)</span> of projections and coordinate reference systems (CRS). You can <span class="co">[</span><span class="ot">look up their ID numbers here</span><span class="co">](https://epsg.io/)</span>.</span>
<span id="cb49-85"><a href="#cb49-85" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb49-86"><a href="#cb49-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-87"><a href="#cb49-87" aria-hidden="true" tabindex="-1"></a><span class="in">```{r change-census-projection}</span></span>
<span id="cb49-88"><a href="#cb49-88" aria-hidden="true" tabindex="-1"></a><span class="in">us_states &lt;- us_states %&gt;% </span></span>
<span id="cb49-89"><a href="#cb49-89" aria-hidden="true" tabindex="-1"></a><span class="in">  st_transform(st_crs("EPSG:4326"))  # WGS 84</span></span>
<span id="cb49-90"><a href="#cb49-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-91"><a href="#cb49-91" aria-hidden="true" tabindex="-1"></a><span class="in"># Just show some of the columns</span></span>
<span id="cb49-92"><a href="#cb49-92" aria-hidden="true" tabindex="-1"></a><span class="in">us_states %&gt;% </span></span>
<span id="cb49-93"><a href="#cb49-93" aria-hidden="true" tabindex="-1"></a><span class="in">  select(STATEFP, STUSPS, NAME, geometry)</span></span>
<span id="cb49-94"><a href="#cb49-94" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-95"><a href="#cb49-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-96"><a href="#cb49-96" aria-hidden="true" tabindex="-1"></a>The data's the same; the projection is different now. Neat.</span>
<span id="cb49-97"><a href="#cb49-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-98"><a href="#cb49-98" aria-hidden="true" tabindex="-1"></a>Since this is just a dataframe, we can manipulate it like any other dataframe. Let's filter it so that we only keep the 48 contiguous states:</span>
<span id="cb49-99"><a href="#cb49-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-100"><a href="#cb49-100" aria-hidden="true" tabindex="-1"></a><span class="in">```{r filter-lower-48}</span></span>
<span id="cb49-101"><a href="#cb49-101" aria-hidden="true" tabindex="-1"></a><span class="in">lower_48 &lt;- us_states %&gt;% </span></span>
<span id="cb49-102"><a href="#cb49-102" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!(NAME %in% c("Alaska", "Hawaii", "Puerto Rico")))</span></span>
<span id="cb49-103"><a href="#cb49-103" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-104"><a href="#cb49-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-105"><a href="#cb49-105" aria-hidden="true" tabindex="-1"></a>{sf} makes it incredibly easy to plot maps too. By relying on the geographic details embedded in the special <span class="in">`geometry`</span> plot, the <span class="in">`geom_sf()`</span> function automatically plots the correct kind of data (points, lines, or areas). And since we're just working with a dataframe, everything in the grammar of graphics paradigm works too. We can map columns to specific aesthetics. For instance, the Census shapefile happened to come with a column named <span class="in">`ALAND`</span> that measures the total land area in each state in square meters. We can fill by that column and create a choropleth map showing states by size:</span>
<span id="cb49-106"><a href="#cb49-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-107"><a href="#cb49-107" aria-hidden="true" tabindex="-1"></a><span class="in">```{r us-map-basic}</span></span>
<span id="cb49-108"><a href="#cb49-108" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Basic map of the US, with states filled by area"</span></span>
<span id="cb49-109"><a href="#cb49-109" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: "Basic map of the US, with states filled by area"</span></span>
<span id="cb49-110"><a href="#cb49-110" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb49-111"><a href="#cb49-111" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = lower_48, aes(fill = ALAND))</span></span>
<span id="cb49-112"><a href="#cb49-112" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-113"><a href="#cb49-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-114"><a href="#cb49-114" aria-hidden="true" tabindex="-1"></a>Since this is just a regular ggplot geom, all other ggplot things work, like modifying themes, scales, etc. We can also change the projection on-the-fly with <span class="in">`coord_sf()`</span> (here I use <span class="co">[</span><span class="ot">Albers</span><span class="co">](https://epsg.io/102003)</span>):</span>
<span id="cb49-115"><a href="#cb49-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-116"><a href="#cb49-116" aria-hidden="true" tabindex="-1"></a><span class="in">```{r us-map-fancy}</span></span>
<span id="cb49-117"><a href="#cb49-117" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Fancier map of the US, with states filled by area"</span></span>
<span id="cb49-118"><a href="#cb49-118" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: "Fancier map of the US, with states filled by area"</span></span>
<span id="cb49-119"><a href="#cb49-119" aria-hidden="true" tabindex="-1"></a><span class="in">library(scales)</span></span>
<span id="cb49-120"><a href="#cb49-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-121"><a href="#cb49-121" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb49-122"><a href="#cb49-122" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = lower_48, aes(fill = ALAND),</span></span>
<span id="cb49-123"><a href="#cb49-123" aria-hidden="true" tabindex="-1"></a><span class="in">          color = "white", linewidth = 0.1) +</span></span>
<span id="cb49-124"><a href="#cb49-124" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_viridis_c(option = "rocket", end = 0.9,</span></span>
<span id="cb49-125"><a href="#cb49-125" aria-hidden="true" tabindex="-1"></a><span class="in">                       labels = label_number(scale_cut = cut_short_scale()),</span></span>
<span id="cb49-126"><a href="#cb49-126" aria-hidden="true" tabindex="-1"></a><span class="in">                       guide = guide_colorbar(barwidth = 7, barheight = 0.4,</span></span>
<span id="cb49-127"><a href="#cb49-127" aria-hidden="true" tabindex="-1"></a><span class="in">                                              title.vjust = 1)) +</span></span>
<span id="cb49-128"><a href="#cb49-128" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_sf(crs = st_crs("ESRI:102003")) +  # Albers projection</span></span>
<span id="cb49-129"><a href="#cb49-129" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(fill = "Land area (m²)") +</span></span>
<span id="cb49-130"><a href="#cb49-130" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void(base_family = "Overpass Light") +</span></span>
<span id="cb49-131"><a href="#cb49-131" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom",</span></span>
<span id="cb49-132"><a href="#cb49-132" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.title = element_text(face = "bold"),</span></span>
<span id="cb49-133"><a href="#cb49-133" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.text = element_text(size = rel(0.6)),</span></span>
<span id="cb49-134"><a href="#cb49-134" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.justification = "center")</span></span>
<span id="cb49-135"><a href="#cb49-135" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-136"><a href="#cb49-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-137"><a href="#cb49-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-138"><a href="#cb49-138" aria-hidden="true" tabindex="-1"></a><span class="fu">## Getting geographic data</span></span>
<span id="cb49-139"><a href="#cb49-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-140"><a href="#cb49-140" aria-hidden="true" tabindex="-1"></a>Shapefiles are everywhere. They're one of the de facto standard formats for GIS data, and most government agencies provide them for their jurisdictions (<span class="co">[</span><span class="ot">see here for a list of some different sources</span><span class="co">](https://datavizs22.classes.andrewheiss.com/example/12-example/#shapefiles)</span>). You can view and edit them graphically with the free and open source <span class="co">[</span><span class="ot">QGIS</span><span class="co">](https://qgis.org/en/site/)</span> or with the expensive and industry-standard <span class="co">[</span><span class="ot">ArcGIS</span><span class="co">](https://www.arcgis.com/index.html)</span>.</span>
<span id="cb49-141"><a href="#cb49-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-142"><a href="#cb49-142" aria-hidden="true" tabindex="-1"></a>We've already seen how to load shapefiles into R with <span class="in">`sf::read_sf()`</span>, and that works great. But doing that requires that you go and find and download the shapefiles that you want, which can involve hunting through complicated websites. There are also lots of different R packages that let you get shapefiles directly from different websites' APIs.</span>
<span id="cb49-143"><a href="#cb49-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-144"><a href="#cb49-144" aria-hidden="true" tabindex="-1"></a>For example, we've already loaded the 2022 US Census maps by downloading and unzipping the shapefile and using <span class="in">`read_sf()`</span>. We could have also used the <span class="co">[</span><span class="ot">{tigris}</span><span class="co">](https://github.com/walkerke/tigris)</span> package to access the data directly from the Census, like this:</span>
<span id="cb49-145"><a href="#cb49-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-146"><a href="#cb49-146" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tigris-example, eval=FALSE}</span></span>
<span id="cb49-147"><a href="#cb49-147" aria-hidden="true" tabindex="-1"></a><span class="in">library(tigris)</span></span>
<span id="cb49-148"><a href="#cb49-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-149"><a href="#cb49-149" aria-hidden="true" tabindex="-1"></a><span class="in">us_states &lt;- states(resolution = "20m", year = 2022, cb = TRUE)</span></span>
<span id="cb49-150"><a href="#cb49-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-151"><a href="#cb49-151" aria-hidden="true" tabindex="-1"></a><span class="in">lower_48 &lt;- us_states %&gt;% </span></span>
<span id="cb49-152"><a href="#cb49-152" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!(NAME %in% c("Alaska", "Hawaii", "Puerto Rico")))</span></span>
<span id="cb49-153"><a href="#cb49-153" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-154"><a href="#cb49-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-155"><a href="#cb49-155" aria-hidden="true" tabindex="-1"></a>For world-level data, <span class="co">[</span><span class="ot">Natural Earth</span><span class="co">](https://www.naturalearthdata.com/)</span> has incredibly well-made shapefiles. We could download the <span class="co">[</span><span class="ot">1:50m cultural data</span><span class="co">](https://www.naturalearthdata.com/downloads/50m-cultural-vectors/)</span> from their website, unzip it, and load it with <span class="in">`read_sf()`</span>:</span>
<span id="cb49-156"><a href="#cb49-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-157"><a href="#cb49-157" aria-hidden="true" tabindex="-1"></a><span class="in">```{r natural-earth-shapefile-example, eval=FALSE}</span></span>
<span id="cb49-158"><a href="#cb49-158" aria-hidden="true" tabindex="-1"></a><span class="in"># Medium scale data, 1:50m Admin 0 - Countries</span></span>
<span id="cb49-159"><a href="#cb49-159" aria-hidden="true" tabindex="-1"></a><span class="in"># Download from https://www.naturalearthdata.com/downloads/50m-cultural-vectors/</span></span>
<span id="cb49-160"><a href="#cb49-160" aria-hidden="true" tabindex="-1"></a><span class="in">world_map &lt;- read_sf("ne_50m_admin_0_countries/ne_50m_admin_0_countries.shp") %&gt;% </span></span>
<span id="cb49-161"><a href="#cb49-161" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(iso_a3 != "ATA")  # Remove Antarctica</span></span>
<span id="cb49-162"><a href="#cb49-162" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-163"><a href="#cb49-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-164"><a href="#cb49-164" aria-hidden="true" tabindex="-1"></a>Or we can use the <span class="co">[</span><span class="ot">{rnaturalearth}</span><span class="co">](https://github.com/ropensci/rnaturalearth)</span> package to do the same thing:</span>
<span id="cb49-165"><a href="#cb49-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-166"><a href="#cb49-166" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rnaturalearth-example}</span></span>
<span id="cb49-167"><a href="#cb49-167" aria-hidden="true" tabindex="-1"></a><span class="in">library(rnaturalearth)</span></span>
<span id="cb49-168"><a href="#cb49-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-169"><a href="#cb49-169" aria-hidden="true" tabindex="-1"></a><span class="in"># rerturnclass = "sf" makes it so the resulting dataframe has the special</span></span>
<span id="cb49-170"><a href="#cb49-170" aria-hidden="true" tabindex="-1"></a><span class="in"># sf-enabled geometry column</span></span>
<span id="cb49-171"><a href="#cb49-171" aria-hidden="true" tabindex="-1"></a><span class="in">world_map &lt;- ne_countries(scale = 50, returnclass = "sf") %&gt;% </span></span>
<span id="cb49-172"><a href="#cb49-172" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(iso_a3 != "ATA")  # Remove Antarctica</span></span>
<span id="cb49-173"><a href="#cb49-173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-174"><a href="#cb49-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-175"><a href="#cb49-175" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb49-176"><a href="#cb49-176" aria-hidden="true" tabindex="-1"></a>Throughout this post, I use {rnaturalearth} for world-level shapefiles and downloaded shapefiles for the US, but that's just for the sake of illustration. Both can be done with packages or through downloading.</span>
<span id="cb49-177"><a href="#cb49-177" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb49-178"><a href="#cb49-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-179"><a href="#cb49-179" aria-hidden="true" tabindex="-1"></a>And finally, for fun, here are some examples of different maps and projections and ggplot tinkering. I'm perpetually astounded by how easy it is to plot GIS data with <span class="in">`geom_sf()`</span>! That <span class="in">`geometry`</span> list column is truly magical.</span>
<span id="cb49-180"><a href="#cb49-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-181"><a href="#cb49-181" aria-hidden="true" tabindex="-1"></a><span class="in">```{r example-projections, fig.width=7, fig.height=4.5}</span></span>
<span id="cb49-182"><a href="#cb49-182" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Examples of different North American and world map projections"</span></span>
<span id="cb49-183"><a href="#cb49-183" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: "Examples of different North American and world map projections"</span></span>
<span id="cb49-184"><a href="#cb49-184" aria-hidden="true" tabindex="-1"></a><span class="in">library(patchwork)</span></span>
<span id="cb49-185"><a href="#cb49-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-186"><a href="#cb49-186" aria-hidden="true" tabindex="-1"></a><span class="in">p1 &lt;- ggplot() + </span></span>
<span id="cb49-187"><a href="#cb49-187" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = lower_48, fill = "#0074D9", color = "white", linewidth = 0.25) +</span></span>
<span id="cb49-188"><a href="#cb49-188" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_sf(crs = st_crs("EPSG:4269")) +  # NAD83</span></span>
<span id="cb49-189"><a href="#cb49-189" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "NAD83 projection") +</span></span>
<span id="cb49-190"><a href="#cb49-190" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void() +</span></span>
<span id="cb49-191"><a href="#cb49-191" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(plot.title = element_text(hjust = 0.5, family = "Overpass Light"))</span></span>
<span id="cb49-192"><a href="#cb49-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-193"><a href="#cb49-193" aria-hidden="true" tabindex="-1"></a><span class="in">p2 &lt;- ggplot() + </span></span>
<span id="cb49-194"><a href="#cb49-194" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = lower_48, fill = "#0074D9", color = "white", linewidth = 0.25) +</span></span>
<span id="cb49-195"><a href="#cb49-195" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_sf(crs = st_crs("ESRI:102003")) +  # Albers</span></span>
<span id="cb49-196"><a href="#cb49-196" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Albers projection") +</span></span>
<span id="cb49-197"><a href="#cb49-197" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void() +</span></span>
<span id="cb49-198"><a href="#cb49-198" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(plot.title = element_text(hjust = 0.5, family = "Overpass Light"))</span></span>
<span id="cb49-199"><a href="#cb49-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-200"><a href="#cb49-200" aria-hidden="true" tabindex="-1"></a><span class="in">p3 &lt;- ggplot() +</span></span>
<span id="cb49-201"><a href="#cb49-201" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = world_map, fill = "#FF4136", color = "white", linewidth = 0.1) +</span></span>
<span id="cb49-202"><a href="#cb49-202" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_sf(crs = st_crs("EPSG:3395")) +  # Mercator</span></span>
<span id="cb49-203"><a href="#cb49-203" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Mercator projection") +</span></span>
<span id="cb49-204"><a href="#cb49-204" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void() +</span></span>
<span id="cb49-205"><a href="#cb49-205" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(plot.title = element_text(hjust = 0.5, family = "Overpass Light"))</span></span>
<span id="cb49-206"><a href="#cb49-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-207"><a href="#cb49-207" aria-hidden="true" tabindex="-1"></a><span class="in">p4 &lt;- ggplot() +</span></span>
<span id="cb49-208"><a href="#cb49-208" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = world_map, fill = "#FF4136", color = "white", linewidth = 0.1) +</span></span>
<span id="cb49-209"><a href="#cb49-209" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_sf(crs = st_crs("ESRI:54030")) +  # Robinson</span></span>
<span id="cb49-210"><a href="#cb49-210" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Robinson projection") +</span></span>
<span id="cb49-211"><a href="#cb49-211" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void() +</span></span>
<span id="cb49-212"><a href="#cb49-212" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(plot.title = element_text(hjust = 0.5, family = "Overpass Light"))</span></span>
<span id="cb49-213"><a href="#cb49-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-214"><a href="#cb49-214" aria-hidden="true" tabindex="-1"></a><span class="in">(p1 | p2) / (p3 | p4)</span></span>
<span id="cb49-215"><a href="#cb49-215" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-216"><a href="#cb49-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-217"><a href="#cb49-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-218"><a href="#cb49-218" aria-hidden="true" tabindex="-1"></a><span class="fu"># Quick reminder: latitude vs. longitude</span></span>
<span id="cb49-219"><a href="#cb49-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-220"><a href="#cb49-220" aria-hidden="true" tabindex="-1"></a>One last little GIS-related thing before going to Middle Earth. Geographic data doesn't rely on the standard X/Y Cartesian plane. Instead, it uses latitudes and longitudes. I've loved maps and globes all my life, but I *can never remember* how latitudes and longitudes translate to X and Y, especially since coordinates are often reported as <span class="in">`lat, lon`</span>, which is technically the reverse of <span class="in">`x, y`</span>. </span>
<span id="cb49-221"><a href="#cb49-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-222"><a href="#cb49-222" aria-hidden="true" tabindex="-1"></a>I have this graph printed and hanging on my office wall next to my computer and refer to it all the time. It's my gift to all of you.</span>
<span id="cb49-223"><a href="#cb49-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-224"><a href="#cb49-224" aria-hidden="true" tabindex="-1"></a><span class="in">```{r lat-lon-plot, fig.width=5, fig.height=5, out.width="65%"}</span></span>
<span id="cb49-225"><a href="#cb49-225" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Helpful diagram showing how latitude and longitude translate to x and y coordinates"</span></span>
<span id="cb49-226"><a href="#cb49-226" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: "Helpful diagram showing how latitude and longitude translate to x and y coordinates"</span></span>
<span id="cb49-227"><a href="#cb49-227" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb49-228"><a href="#cb49-228" aria-hidden="true" tabindex="-1"></a><span class="in">point_example &lt;- tibble(x = 2, y = 1) %&gt;%</span></span>
<span id="cb49-229"><a href="#cb49-229" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(label = glue::glue("{x} x, {y} y\n{y} lat, {x} lon"))</span></span>
<span id="cb49-230"><a href="#cb49-230" aria-hidden="true" tabindex="-1"></a><span class="in">lat_labs &lt;- tibble(x = -3, y = seq(-2, 3, 1), label = "Latitude")</span></span>
<span id="cb49-231"><a href="#cb49-231" aria-hidden="true" tabindex="-1"></a><span class="in">lon_labs &lt;- tibble(x = seq(-2, 3, 1), y = -2, label = "Longitude")</span></span>
<span id="cb49-232"><a href="#cb49-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-233"><a href="#cb49-233" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb49-234"><a href="#cb49-234" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = point_example, aes(x = x, y = y), size = 5) +</span></span>
<span id="cb49-235"><a href="#cb49-235" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_label(data = point_example, aes(x = x, y = y, label = label),</span></span>
<span id="cb49-236"><a href="#cb49-236" aria-hidden="true" tabindex="-1"></a><span class="in">             nudge_y = 0.6, family = "Overpass ExtraBold") +</span></span>
<span id="cb49-237"><a href="#cb49-237" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text(data = lat_labs, aes(x = x, y = y, label = label),</span></span>
<span id="cb49-238"><a href="#cb49-238" aria-hidden="true" tabindex="-1"></a><span class="in">            hjust = 0.5, vjust = -0.3, family = "Overpass Light") +</span></span>
<span id="cb49-239"><a href="#cb49-239" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_text(data = lon_labs, aes(x = x, y = y, label = label),</span></span>
<span id="cb49-240"><a href="#cb49-240" aria-hidden="true" tabindex="-1"></a><span class="in">            hjust = 1.1, vjust = -0.5, angle = 90, family = "Overpass Light") +</span></span>
<span id="cb49-241"><a href="#cb49-241" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_hline(yintercept = 0) +</span></span>
<span id="cb49-242"><a href="#cb49-242" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = 0) +</span></span>
<span id="cb49-243"><a href="#cb49-243" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(breaks = seq(-2, 3, 1)) +</span></span>
<span id="cb49-244"><a href="#cb49-244" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(breaks = seq(-2, 3, 1)) +</span></span>
<span id="cb49-245"><a href="#cb49-245" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_equal(xlim = c(-3.5, 3), ylim = c(-3, 3)) +</span></span>
<span id="cb49-246"><a href="#cb49-246" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = NULL, y = NULL) +</span></span>
<span id="cb49-247"><a href="#cb49-247" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb49-248"><a href="#cb49-248" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(panel.grid.minor = element_blank(),</span></span>
<span id="cb49-249"><a href="#cb49-249" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text = element_blank())</span></span>
<span id="cb49-250"><a href="#cb49-250" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-251"><a href="#cb49-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-252"><a href="#cb49-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-253"><a href="#cb49-253" aria-hidden="true" tabindex="-1"></a><span class="fu"># Loading Middle Earth shapefiles</span></span>
<span id="cb49-254"><a href="#cb49-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-255"><a href="#cb49-255" aria-hidden="true" tabindex="-1"></a>Phew, okay. With that quick overview done, we can start playing with the <span class="co">[</span><span class="ot">ME-GIS data</span><span class="co">](https://github.com/jvangeld/ME-GIS)</span>. There's isn't a pre-built R package for the data, so we'll need to download the GitHub repository ourselves. I put all the files in a folder named <span class="in">`data/ME-GIS`</span> relative to this document. I also downloaded the <span class="co">[</span><span class="ot">2022 US Census cartographic boundary files</span><span class="co">](https://www.census.gov/geographies/mapping-files/time-series/geo/cartographic-boundary.html)</span> and put them in a folder named <span class="in">`data/cb_2022_us_state_20m`</span>. If you're following along, I suggest you do the same. </span>
<span id="cb49-256"><a href="#cb49-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-257"><a href="#cb49-257" aria-hidden="true" tabindex="-1"></a>The ME-GIS project includes tons of different shapefile layers: data for coastline borders, elevation contours, forest boundaries, city locations, and so on. We'll load a bunch of them here. </span>
<span id="cb49-258"><a href="#cb49-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-259"><a href="#cb49-259" aria-hidden="true" tabindex="-1"></a>Notice the extra <span class="in">`iconv(., from = "ISO-8859-1", to = "UTF-8")`</span> that I've added to each <span class="in">`read_sf()`</span> call. This is necessary because the original data isn't stored as Unicode, which is an issue because Tolkien used all sorts of accents (like "Lórien"), and R can choke on these characters. To make life easier, I use <span class="in">`iconv()`</span> to convert all the character columns in each shapefile from <span class="co">[</span><span class="ot">Latin 1 (ISO-8859-1)</span><span class="co">](https://en.wikipedia.org/wiki/ISO/IEC_8859-1)</span> to Unicode (UTF-8).</span>
<span id="cb49-260"><a href="#cb49-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-261"><a href="#cb49-261" aria-hidden="true" tabindex="-1"></a>Make sure you download and install the <span class="co">[</span><span class="ot">Overpass font from Google Fonts</span><span class="co">](https://fonts.google.com/specimen/Overpass)</span> if you want to use the custom fonts throughout the post.</span>
<span id="cb49-262"><a href="#cb49-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-263"><a href="#cb49-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-264"><a href="#cb49-264" aria-hidden="true" tabindex="-1"></a><span class="in">```{r packages-data, warning=FALSE, message=FALSE}</span></span>
<span id="cb49-265"><a href="#cb49-265" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb49-266"><a href="#cb49-266" aria-hidden="true" tabindex="-1"></a><span class="in">library(sf)</span></span>
<span id="cb49-267"><a href="#cb49-267" aria-hidden="true" tabindex="-1"></a><span class="in">library(rnaturalearth)</span></span>
<span id="cb49-268"><a href="#cb49-268" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggspatial)</span></span>
<span id="cb49-269"><a href="#cb49-269" aria-hidden="true" tabindex="-1"></a><span class="in">library(scales)</span></span>
<span id="cb49-270"><a href="#cb49-270" aria-hidden="true" tabindex="-1"></a><span class="in">library(patchwork)</span></span>
<span id="cb49-271"><a href="#cb49-271" aria-hidden="true" tabindex="-1"></a><span class="in">library(leaflet)</span></span>
<span id="cb49-272"><a href="#cb49-272" aria-hidden="true" tabindex="-1"></a><span class="in">library(glue)</span></span>
<span id="cb49-273"><a href="#cb49-273" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-274"><a href="#cb49-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-275"><a href="#cb49-275" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load-me-data}</span></span>
<span id="cb49-276"><a href="#cb49-276" aria-hidden="true" tabindex="-1"></a><span class="in">coastline &lt;- read_sf("data/ME-GIS/Coastline2.shp") %&gt;% </span></span>
<span id="cb49-277"><a href="#cb49-277" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(where(is.character), ~iconv(., from = "ISO-8859-1", to = "UTF-8")))</span></span>
<span id="cb49-278"><a href="#cb49-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-279"><a href="#cb49-279" aria-hidden="true" tabindex="-1"></a><span class="in">contours &lt;- read_sf("data/ME-GIS/Contours_18.shp") %&gt;% </span></span>
<span id="cb49-280"><a href="#cb49-280" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(where(is.character), ~iconv(., from = "ISO-8859-1", to = "UTF-8")))</span></span>
<span id="cb49-281"><a href="#cb49-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-282"><a href="#cb49-282" aria-hidden="true" tabindex="-1"></a><span class="in">rivers &lt;- read_sf("data/ME-GIS/Rivers.shp") %&gt;% </span></span>
<span id="cb49-283"><a href="#cb49-283" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(where(is.character), ~iconv(., from = "ISO-8859-1", to = "UTF-8")))</span></span>
<span id="cb49-284"><a href="#cb49-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-285"><a href="#cb49-285" aria-hidden="true" tabindex="-1"></a><span class="in">roads &lt;- read_sf("data/ME-GIS/Roads.shp") %&gt;% </span></span>
<span id="cb49-286"><a href="#cb49-286" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(where(is.character), ~iconv(., from = "ISO-8859-1", to = "UTF-8")))</span></span>
<span id="cb49-287"><a href="#cb49-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-288"><a href="#cb49-288" aria-hidden="true" tabindex="-1"></a><span class="in">lakes &lt;- read_sf("data/ME-GIS/Lakes.shp") %&gt;% </span></span>
<span id="cb49-289"><a href="#cb49-289" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(where(is.character), ~iconv(., from = "ISO-8859-1", to = "UTF-8")))</span></span>
<span id="cb49-290"><a href="#cb49-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-291"><a href="#cb49-291" aria-hidden="true" tabindex="-1"></a><span class="in">regions &lt;- read_sf("data/ME-GIS/Regions_Anno.shp") %&gt;% </span></span>
<span id="cb49-292"><a href="#cb49-292" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(where(is.character), ~iconv(., from = "ISO-8859-1", to = "UTF-8")))</span></span>
<span id="cb49-293"><a href="#cb49-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-294"><a href="#cb49-294" aria-hidden="true" tabindex="-1"></a><span class="in">forests &lt;- read_sf("data/ME-GIS/Forests.shp") %&gt;% </span></span>
<span id="cb49-295"><a href="#cb49-295" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(where(is.character), ~iconv(., from = "ISO-8859-1", to = "UTF-8")))</span></span>
<span id="cb49-296"><a href="#cb49-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-297"><a href="#cb49-297" aria-hidden="true" tabindex="-1"></a><span class="in">mountains &lt;- read_sf("data/ME-GIS/Mountains_Anno.shp") %&gt;% </span></span>
<span id="cb49-298"><a href="#cb49-298" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(where(is.character), ~iconv(., from = "ISO-8859-1", to = "UTF-8")))</span></span>
<span id="cb49-299"><a href="#cb49-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-300"><a href="#cb49-300" aria-hidden="true" tabindex="-1"></a><span class="in">placenames &lt;- read_sf("data/ME-GIS/Combined_Placenames.shp") %&gt;% </span></span>
<span id="cb49-301"><a href="#cb49-301" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(where(is.character), ~iconv(., from = "ISO-8859-1", to = "UTF-8")))</span></span>
<span id="cb49-302"><a href="#cb49-302" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-303"><a href="#cb49-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-304"><a href="#cb49-304" aria-hidden="true" tabindex="-1"></a>We'll also load and process the Census data and Natural Earth data (we did this before in the overivew, but we'll do it again here in case you skipped that part):</span>
<span id="cb49-305"><a href="#cb49-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-306"><a href="#cb49-306" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load-other-data}</span></span>
<span id="cb49-307"><a href="#cb49-307" aria-hidden="true" tabindex="-1"></a><span class="in"># Census data</span></span>
<span id="cb49-308"><a href="#cb49-308" aria-hidden="true" tabindex="-1"></a><span class="in">us_states &lt;- read_sf("data/cb_2022_us_state_20m/cb_2022_us_state_20m.shp") %&gt;% </span></span>
<span id="cb49-309"><a href="#cb49-309" aria-hidden="true" tabindex="-1"></a><span class="in">  st_transform(st_crs("EPSG:4326"))</span></span>
<span id="cb49-310"><a href="#cb49-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-311"><a href="#cb49-311" aria-hidden="true" tabindex="-1"></a><span class="in">lower_48 &lt;- us_states %&gt;% </span></span>
<span id="cb49-312"><a href="#cb49-312" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!(NAME %in% c("Alaska", "Hawaii", "Puerto Rico")))</span></span>
<span id="cb49-313"><a href="#cb49-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-314"><a href="#cb49-314" aria-hidden="true" tabindex="-1"></a><span class="in"># Natural Earth data</span></span>
<span id="cb49-315"><a href="#cb49-315" aria-hidden="true" tabindex="-1"></a><span class="in">world_map &lt;- ne_countries(scale = 50, returnclass = "sf") %&gt;% </span></span>
<span id="cb49-316"><a href="#cb49-316" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(iso_a3 != "ATA")  # Remove Antarctica</span></span>
<span id="cb49-317"><a href="#cb49-317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-318"><a href="#cb49-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-319"><a href="#cb49-319" aria-hidden="true" tabindex="-1"></a>Finally, we'll define a couple little helper functions to convert between meters and miles (the Middle Earth data is stored as meters), and define some colors that we'll use in the maps.</span>
<span id="cb49-320"><a href="#cb49-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-321"><a href="#cb49-321" aria-hidden="true" tabindex="-1"></a><span class="in">```{r helper-functions}</span></span>
<span id="cb49-322"><a href="#cb49-322" aria-hidden="true" tabindex="-1"></a><span class="in">miles_to_meters &lt;- function(x) {</span></span>
<span id="cb49-323"><a href="#cb49-323" aria-hidden="true" tabindex="-1"></a><span class="in">  x * 1609.344</span></span>
<span id="cb49-324"><a href="#cb49-324" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb49-325"><a href="#cb49-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-326"><a href="#cb49-326" aria-hidden="true" tabindex="-1"></a><span class="in">meters_to_miles &lt;- function(x) {</span></span>
<span id="cb49-327"><a href="#cb49-327" aria-hidden="true" tabindex="-1"></a><span class="in">  x / 1609.344</span></span>
<span id="cb49-328"><a href="#cb49-328" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb49-329"><a href="#cb49-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-330"><a href="#cb49-330" aria-hidden="true" tabindex="-1"></a><span class="in">clr_green &lt;- "#035711"</span></span>
<span id="cb49-331"><a href="#cb49-331" aria-hidden="true" tabindex="-1"></a><span class="in">clr_blue &lt;- "#0776e0"</span></span>
<span id="cb49-332"><a href="#cb49-332" aria-hidden="true" tabindex="-1"></a><span class="in">clr_yellow &lt;- "#fffce3"</span></span>
<span id="cb49-333"><a href="#cb49-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-334"><a href="#cb49-334" aria-hidden="true" tabindex="-1"></a><span class="in"># Format numeric coordinates with degree symbols and cardinal directions</span></span>
<span id="cb49-335"><a href="#cb49-335" aria-hidden="true" tabindex="-1"></a><span class="in">format_coords &lt;- function(coords) {</span></span>
<span id="cb49-336"><a href="#cb49-336" aria-hidden="true" tabindex="-1"></a><span class="in">  ns &lt;- ifelse(coords[[1]][2] &gt; 0, "N", "S")</span></span>
<span id="cb49-337"><a href="#cb49-337" aria-hidden="true" tabindex="-1"></a><span class="in">  ew &lt;- ifelse(coords[[1]][1] &gt; 0, "E", "W")</span></span>
<span id="cb49-338"><a href="#cb49-338" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb49-339"><a href="#cb49-339" aria-hidden="true" tabindex="-1"></a><span class="in">  glue("{latitude}°{ns} {longitude}°{ew}",</span></span>
<span id="cb49-340"><a href="#cb49-340" aria-hidden="true" tabindex="-1"></a><span class="in">       latitude = sprintf("%.6f", coords[[1]][2]),</span></span>
<span id="cb49-341"><a href="#cb49-341" aria-hidden="true" tabindex="-1"></a><span class="in">       longitude = sprintf("%.6f", coords[[1]][1]))</span></span>
<span id="cb49-342"><a href="#cb49-342" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb49-343"><a href="#cb49-343" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-344"><a href="#cb49-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-345"><a href="#cb49-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-346"><a href="#cb49-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-347"><a href="#cb49-347" aria-hidden="true" tabindex="-1"></a><span class="fu"># Exploring the different layers</span></span>
<span id="cb49-348"><a href="#cb49-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-349"><a href="#cb49-349" aria-hidden="true" tabindex="-1"></a>With all these shapefiles loaded, we can experiment with them and see what's in them. Here's the coastline:</span>
<span id="cb49-350"><a href="#cb49-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-351"><a href="#cb49-351" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basic-coastline, fig.width=4, fig.height=4, out.width="70%"}</span></span>
<span id="cb49-352"><a href="#cb49-352" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Middle Earth's coastline"</span></span>
<span id="cb49-353"><a href="#cb49-353" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: "Middle Earth's coastline"</span></span>
<span id="cb49-354"><a href="#cb49-354" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb49-355"><a href="#cb49-355" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = coastline, linewidth = 0.25, color = "grey50") </span></span>
<span id="cb49-356"><a href="#cb49-356" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-357"><a href="#cb49-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-358"><a href="#cb49-358" aria-hidden="true" tabindex="-1"></a>Neat. We can add some rivers and lakes to it:</span>
<span id="cb49-359"><a href="#cb49-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-360"><a href="#cb49-360" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basic-coastline-rivers, fig.width=4, fig.height=4, out.width="70%"}</span></span>
<span id="cb49-361"><a href="#cb49-361" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Middle Earth with rivers and lakes"</span></span>
<span id="cb49-362"><a href="#cb49-362" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: "Middle Earth with rivers and lakes"</span></span>
<span id="cb49-363"><a href="#cb49-363" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb49-364"><a href="#cb49-364" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = coastline, linewidth = 0.25, color = "grey50") +</span></span>
<span id="cb49-365"><a href="#cb49-365" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = rivers, linewidth = 0.2, color = clr_blue, alpha = 0.5) +</span></span>
<span id="cb49-366"><a href="#cb49-366" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = lakes, linewidth = 0.2, color = clr_blue, fill = clr_blue)</span></span>
<span id="cb49-367"><a href="#cb49-367" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-368"><a href="#cb49-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-369"><a href="#cb49-369" aria-hidden="true" tabindex="-1"></a>The level of detail in these coastlines and borders is *incredible*. Great work, ME-DEM team!</span>
<span id="cb49-370"><a href="#cb49-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-371"><a href="#cb49-371" aria-hidden="true" tabindex="-1"></a>Let's add placenames:</span>
<span id="cb49-372"><a href="#cb49-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-373"><a href="#cb49-373" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basic-coastline-rivers-places, fig.width=4, fig.height=4, out.width="70%"}</span></span>
<span id="cb49-374"><a href="#cb49-374" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Middle Earth with rivers and lakes and too many places"</span></span>
<span id="cb49-375"><a href="#cb49-375" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: "Middle Earth with rivers and lakes and too many places"</span></span>
<span id="cb49-376"><a href="#cb49-376" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb49-377"><a href="#cb49-377" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = coastline, linewidth = 0.25, color = "grey50") +</span></span>
<span id="cb49-378"><a href="#cb49-378" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = rivers, linewidth = 0.2, color = clr_blue, alpha = 0.5) +</span></span>
<span id="cb49-379"><a href="#cb49-379" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = lakes, linewidth = 0.2, color = clr_blue, fill = clr_blue) +</span></span>
<span id="cb49-380"><a href="#cb49-380" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = placenames, size = 0.5)</span></span>
<span id="cb49-381"><a href="#cb49-381" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-382"><a href="#cb49-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-383"><a href="#cb49-383" aria-hidden="true" tabindex="-1"></a>Ha, that's less than helpful. There are <span class="in">`r nrow(placenames)`</span> different placenames in the data. Since the <span class="in">`placenames`</span> object is just a fancy dataframe, we can filter it and just look at a few of the places: Hobbiton (the Shire), Rivendell, Edoras (capital of Rohan), and Minas Tirith (capital of Gondor). We'll also add labels with <span class="in">`geom_sf_label()`</span> and scoot the labels up a bit so that they're not on top of the points. The geographic data here is measured in meters, so we can specify how many meters we want each label moved up. Because I don't think in the metric system, and because there are <span class="in">`r scales::label_comma()(miles_to_meters(1))`</span> meters in a mile and that implies big numbers, I'll specify the label offset in miles with the <span class="in">`miles_to_meters()`</span> function we made earlier. We'll push the labels up by 50 miles (or <span class="in">`r scales::label_comma()(miles_to_meters(50))`</span> meters):</span>
<span id="cb49-384"><a href="#cb49-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-385"><a href="#cb49-385" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basic-coastline-rivers-places-small, fig.width=5, fig.height=5, out.width="70%"}</span></span>
<span id="cb49-386"><a href="#cb49-386" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Middle Earth with rivers, lakes, and four cities"</span></span>
<span id="cb49-387"><a href="#cb49-387" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: "Middle Earth with rivers, lakes, and four cities"</span></span>
<span id="cb49-388"><a href="#cb49-388" aria-hidden="true" tabindex="-1"></a><span class="in">places &lt;- placenames %&gt;% </span></span>
<span id="cb49-389"><a href="#cb49-389" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(NAME %in% c("Hobbiton", "Rivendell", "Edoras", "Minas Tirith"))</span></span>
<span id="cb49-390"><a href="#cb49-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-391"><a href="#cb49-391" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb49-392"><a href="#cb49-392" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = coastline, linewidth = 0.25, color = "grey50") +</span></span>
<span id="cb49-393"><a href="#cb49-393" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = rivers, linewidth = 0.2, color = clr_blue, alpha = 0.5) +</span></span>
<span id="cb49-394"><a href="#cb49-394" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = lakes, linewidth = 0.2, color = clr_blue, fill = clr_blue) +</span></span>
<span id="cb49-395"><a href="#cb49-395" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = places, size = 1) +</span></span>
<span id="cb49-396"><a href="#cb49-396" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf_label(data = places, aes(label = NAME), nudge_y = miles_to_meters(50))</span></span>
<span id="cb49-397"><a href="#cb49-397" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-398"><a href="#cb49-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-399"><a href="#cb49-399" aria-hidden="true" tabindex="-1"></a><span class="fu"># Fancy map of Middle Earth with lots of layers</span></span>
<span id="cb49-400"><a href="#cb49-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-401"><a href="#cb49-401" aria-hidden="true" tabindex="-1"></a>So far we've seen that we can stack up as many <span class="in">`geom_sf()`</span> layers as we want to combine each of these shapefiles into a single plot, and we can modify each of the layers just like a standard ggplot geom. Here's a more polished fancy final version of Middle Earth with better colors, fonts, elevation contours, and so on.</span>
<span id="cb49-402"><a href="#cb49-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-403"><a href="#cb49-403" aria-hidden="true" tabindex="-1"></a><span class="in">```{r full-nice-map, fig.width=6.5, fig.height=6.5, out.width="100%"}</span></span>
<span id="cb49-404"><a href="#cb49-404" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Complete fancy map of Middle Earth"</span></span>
<span id="cb49-405"><a href="#cb49-405" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: "Complete fancy map of Middle Earth"</span></span>
<span id="cb49-406"><a href="#cb49-406" aria-hidden="true" tabindex="-1"></a><span class="in">places &lt;- placenames %&gt;% </span></span>
<span id="cb49-407"><a href="#cb49-407" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(NAME %in% c("Hobbiton", "Rivendell", "Edoras", "Minas Tirith"))</span></span>
<span id="cb49-408"><a href="#cb49-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-409"><a href="#cb49-409" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb49-410"><a href="#cb49-410" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = contours, linewidth = 0.15, color = "grey90") +</span></span>
<span id="cb49-411"><a href="#cb49-411" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = coastline, linewidth = 0.25, color = "grey50") +</span></span>
<span id="cb49-412"><a href="#cb49-412" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = rivers, linewidth = 0.2, color = clr_blue, alpha = 0.5) +</span></span>
<span id="cb49-413"><a href="#cb49-413" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = lakes, linewidth = 0.2, color = clr_blue, fill = clr_blue) +</span></span>
<span id="cb49-414"><a href="#cb49-414" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = forests, linewidth = 0, fill = clr_green, alpha = 0.5) +</span></span>
<span id="cb49-415"><a href="#cb49-415" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = mountains, linewidth = 0.25, linetype = "dashed") +</span></span>
<span id="cb49-416"><a href="#cb49-416" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = places) +</span></span>
<span id="cb49-417"><a href="#cb49-417" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf_label(data = places, aes(label = NAME), nudge_y = miles_to_meters(40),</span></span>
<span id="cb49-418"><a href="#cb49-418" aria-hidden="true" tabindex="-1"></a><span class="in">                family = "Overpass ExtraBold", fontface = "plain") +</span></span>
<span id="cb49-419"><a href="#cb49-419" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void() +</span></span>
<span id="cb49-420"><a href="#cb49-420" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(plot.background = element_rect(fill = clr_yellow))</span></span>
<span id="cb49-421"><a href="#cb49-421" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-422"><a href="#cb49-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-423"><a href="#cb49-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-424"><a href="#cb49-424" aria-hidden="true" tabindex="-1"></a><span class="fu"># Map of just the Shire</span></span>
<span id="cb49-425"><a href="#cb49-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-426"><a href="#cb49-426" aria-hidden="true" tabindex="-1"></a>That's a really neat map! We can get even fancier though! Given the quality of the geographic data, we can zoom in and get much more detail for specific regions. For instance, we can zoom in on just the Shire. We can specify a window of coordinates in <span class="in">`coord_sf()`</span> to zoom the plot, and with actual real world data we could <span class="co">[</span><span class="ot">use a tool like this</span><span class="co">](https://www.openstreetmap.org/export#map=4/54.47/12.79)</span> to find those coordinates on a map, but since this is fictional data, it's a little bit trickier to define specific bounds. </span>
<span id="cb49-427"><a href="#cb49-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-428"><a href="#cb49-428" aria-hidden="true" tabindex="-1"></a>To find the rough bounds of the Shire, we'll first extract the coordinates for Hobbiton, home of Bilbo and Frodo Baggins. The geographic data is currently stuck in the <span class="in">`geometry`</span> list column, but we can use <span class="in">`map_dbl()`</span> from {purrr} to extract the values as numbers:</span>
<span id="cb49-429"><a href="#cb49-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-430"><a href="#cb49-430" aria-hidden="true" tabindex="-1"></a><span class="in">```{r extract-hobbiton-coords}</span></span>
<span id="cb49-431"><a href="#cb49-431" aria-hidden="true" tabindex="-1"></a><span class="in">hobbiton &lt;- places %&gt;% </span></span>
<span id="cb49-432"><a href="#cb49-432" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(NAME == "Hobbiton") %&gt;% </span></span>
<span id="cb49-433"><a href="#cb49-433" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(geometry_x = map_dbl(geometry, ~as.numeric(.)[1]),</span></span>
<span id="cb49-434"><a href="#cb49-434" aria-hidden="true" tabindex="-1"></a><span class="in">         geometry_y = map_dbl(geometry, ~as.numeric(.)[2]))</span></span>
<span id="cb49-435"><a href="#cb49-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-436"><a href="#cb49-436" aria-hidden="true" tabindex="-1"></a><span class="in">hobbiton %&gt;% </span></span>
<span id="cb49-437"><a href="#cb49-437" aria-hidden="true" tabindex="-1"></a><span class="in">  select(LAYER, NAME, geometry_x, geometry_y)</span></span>
<span id="cb49-438"><a href="#cb49-438" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-439"><a href="#cb49-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-440"><a href="#cb49-440" aria-hidden="true" tabindex="-1"></a>Alternatively, we can avoid {purrr} stuff and pull out the numbers directly with <span class="in">`st_geometry()`</span>. I prefer keeping everything inside the dataframe, though, so I typically use {purrr} for this kind of thing.</span>
<span id="cb49-441"><a href="#cb49-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-442"><a href="#cb49-442" aria-hidden="true" tabindex="-1"></a><span class="in">```{r extract-hobbiton-coords-geometry}</span></span>
<span id="cb49-443"><a href="#cb49-443" aria-hidden="true" tabindex="-1"></a><span class="in">hobbiton_no_df &lt;- places %&gt;% </span></span>
<span id="cb49-444"><a href="#cb49-444" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(NAME == "Hobbiton") %&gt;% </span></span>
<span id="cb49-445"><a href="#cb49-445" aria-hidden="true" tabindex="-1"></a><span class="in">  st_geometry()</span></span>
<span id="cb49-446"><a href="#cb49-446" aria-hidden="true" tabindex="-1"></a><span class="in">hobbiton_no_df</span></span>
<span id="cb49-447"><a href="#cb49-447" aria-hidden="true" tabindex="-1"></a><span class="in">hobbiton_no_df[[1]][1]</span></span>
<span id="cb49-448"><a href="#cb49-448" aria-hidden="true" tabindex="-1"></a><span class="in">hobbiton_no_df[[1]][2]</span></span>
<span id="cb49-449"><a href="#cb49-449" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-450"><a href="#cb49-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-451"><a href="#cb49-451" aria-hidden="true" tabindex="-1"></a>Those (<span class="in">`r label_number(big.mark = "")(hobbiton_no_df[[1]][1])`</span>, <span class="in">`r label_number(big.mark = "")(hobbiton_no_df[[1]][2])`</span>) coordinates are the location of Hobbiton and they're measured in meters. We can add and subtract some amount of meters to each side of the coordinates to build a window around Hobbiton and set the bounds of the map. Here I add 30 miles to the west, 60 miles to the east, 35 miles to the north, and 20 miles to the south of Hobbiton (I figured those out through a bunch of trial and error to get the main features and labels that I wanted to show in the fancier map below)</span>
<span id="cb49-452"><a href="#cb49-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-453"><a href="#cb49-453" aria-hidden="true" tabindex="-1"></a><span class="in">```{r shire-zoomed-in-basic, fig.width=6.5, fig.height=4.5, out.width="100%"}</span></span>
<span id="cb49-454"><a href="#cb49-454" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Basic zoomed-in map of the Shire"</span></span>
<span id="cb49-455"><a href="#cb49-455" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: "Basic zoomed-in map of the Shire"</span></span>
<span id="cb49-456"><a href="#cb49-456" aria-hidden="true" tabindex="-1"></a><span class="in">shire_towns &lt;- placenames %&gt;% filter(LAYER == "TownNames")</span></span>
<span id="cb49-457"><a href="#cb49-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-458"><a href="#cb49-458" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb49-459"><a href="#cb49-459" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = rivers, linewidth = 0.45, color = clr_blue, alpha = 0.5) +</span></span>
<span id="cb49-460"><a href="#cb49-460" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = roads) +</span></span>
<span id="cb49-461"><a href="#cb49-461" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = shire_towns, size = 2) +</span></span>
<span id="cb49-462"><a href="#cb49-462" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf_label(data = shire_towns, aes(label = NAME), nudge_y = miles_to_meters(3),</span></span>
<span id="cb49-463"><a href="#cb49-463" aria-hidden="true" tabindex="-1"></a><span class="in">                family = "Overpass ExtraBold", fontface = "plain") +</span></span>
<span id="cb49-464"><a href="#cb49-464" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_sf(xlim = c(hobbiton$geometry_x - miles_to_meters(30), </span></span>
<span id="cb49-465"><a href="#cb49-465" aria-hidden="true" tabindex="-1"></a><span class="in">                    hobbiton$geometry_x + miles_to_meters(60)),</span></span>
<span id="cb49-466"><a href="#cb49-466" aria-hidden="true" tabindex="-1"></a><span class="in">           ylim = c(hobbiton$geometry_y - miles_to_meters(35), </span></span>
<span id="cb49-467"><a href="#cb49-467" aria-hidden="true" tabindex="-1"></a><span class="in">                    hobbiton$geometry_y + miles_to_meters(20)))</span></span>
<span id="cb49-468"><a href="#cb49-468" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-469"><a href="#cb49-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-470"><a href="#cb49-470" aria-hidden="true" tabindex="-1"></a>Using that window of coordinates, we can make the map extra fancy with some more enhancements. The roads data, for instance, includes a column that indicates if a road is primary, secondary, or tertiary, so we can size by road importance. We can also add some neat little annotations, like a compass indicator and a scale marker (using <span class="in">`annotation_scale()`</span> and <span class="in">`annotation_north_arrow()`</span> from the <span class="co">[</span><span class="ot">{ggspatial} package</span><span class="co">](https://paleolimbot.github.io/ggspatial/)</span>). We'll also add a Tolkienesque plot title with <span class="co">[</span><span class="ot">the Aniron font</span><span class="co">](https://www.dafont.com/aniron.font)</span>:</span>
<span id="cb49-471"><a href="#cb49-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-472"><a href="#cb49-472" aria-hidden="true" tabindex="-1"></a><span class="in">```{r shire-zoomed-in-fancy, fig.width=6.5, fig.height=4.5, out.width="100%", warning=FALSE}</span></span>
<span id="cb49-473"><a href="#cb49-473" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Fancy zoomed-in map of the Shire"</span></span>
<span id="cb49-474"><a href="#cb49-474" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: "Fancy zoomed-in map of the Shire"</span></span>
<span id="cb49-475"><a href="#cb49-475" aria-hidden="true" tabindex="-1"></a><span class="in">shire_towns &lt;- placenames %&gt;% filter(LAYER == "TownNames")</span></span>
<span id="cb49-476"><a href="#cb49-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-477"><a href="#cb49-477" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb49-478"><a href="#cb49-478" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = roads, aes(linewidth = TYPE), color = "grey80") +</span></span>
<span id="cb49-479"><a href="#cb49-479" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = coastline, linewidth = 0.25, color = "grey50") +</span></span>
<span id="cb49-480"><a href="#cb49-480" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = rivers, linewidth = 0.45, color = clr_blue, alpha = 0.5) +</span></span>
<span id="cb49-481"><a href="#cb49-481" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf_text(data = rivers, aes(label = NAME), color = clr_blue,</span></span>
<span id="cb49-482"><a href="#cb49-482" aria-hidden="true" tabindex="-1"></a><span class="in">               family = "Overpass SemiBold", fontface = "italic", size = 3.5) +</span></span>
<span id="cb49-483"><a href="#cb49-483" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf_text(data = regions, aes(label = name),</span></span>
<span id="cb49-484"><a href="#cb49-484" aria-hidden="true" tabindex="-1"></a><span class="in">               family = "Overpass Heavy", size = 5, color = "grey30") +</span></span>
<span id="cb49-485"><a href="#cb49-485" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = forests, linewidth = 0, fill = clr_green, alpha = 0.4) +</span></span>
<span id="cb49-486"><a href="#cb49-486" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf_text(data = forests, aes(label = NAME), nudge_y = miles_to_meters(1),</span></span>
<span id="cb49-487"><a href="#cb49-487" aria-hidden="true" tabindex="-1"></a><span class="in">               color = clr_green, family = "Overpass ExtraBold", fontface = "italic", size = 4) +</span></span>
<span id="cb49-488"><a href="#cb49-488" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = shire_towns, size = 2) +</span></span>
<span id="cb49-489"><a href="#cb49-489" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf_label(data = shire_towns, aes(label = NAME), nudge_y = miles_to_meters(3),</span></span>
<span id="cb49-490"><a href="#cb49-490" aria-hidden="true" tabindex="-1"></a><span class="in">                family = "Overpass ExtraBold", fontface = "plain") +</span></span>
<span id="cb49-491"><a href="#cb49-491" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_linewidth_discrete(range = c(1, 0.3), guide = "none") +</span></span>
<span id="cb49-492"><a href="#cb49-492" aria-hidden="true" tabindex="-1"></a><span class="in">  annotation_scale(location = "tl", bar_cols = c("grey30", "white"),</span></span>
<span id="cb49-493"><a href="#cb49-493" aria-hidden="true" tabindex="-1"></a><span class="in">                   text_family = "Overpass",</span></span>
<span id="cb49-494"><a href="#cb49-494" aria-hidden="true" tabindex="-1"></a><span class="in">                   unit_category = "imperial") +</span></span>
<span id="cb49-495"><a href="#cb49-495" aria-hidden="true" tabindex="-1"></a><span class="in">  annotation_north_arrow(</span></span>
<span id="cb49-496"><a href="#cb49-496" aria-hidden="true" tabindex="-1"></a><span class="in">    location = "tl", pad_y = unit(1.5, "lines"),</span></span>
<span id="cb49-497"><a href="#cb49-497" aria-hidden="true" tabindex="-1"></a><span class="in">    style = north_arrow_fancy_orienteering(fill = c("grey30", "white"), </span></span>
<span id="cb49-498"><a href="#cb49-498" aria-hidden="true" tabindex="-1"></a><span class="in">                                           line_col = "grey30",</span></span>
<span id="cb49-499"><a href="#cb49-499" aria-hidden="true" tabindex="-1"></a><span class="in">                                           text_family = "Overpass")) +</span></span>
<span id="cb49-500"><a href="#cb49-500" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_sf(xlim = c(hobbiton$geometry_x - miles_to_meters(30), </span></span>
<span id="cb49-501"><a href="#cb49-501" aria-hidden="true" tabindex="-1"></a><span class="in">                    hobbiton$geometry_x + miles_to_meters(60)),</span></span>
<span id="cb49-502"><a href="#cb49-502" aria-hidden="true" tabindex="-1"></a><span class="in">           ylim = c(hobbiton$geometry_y - miles_to_meters(35), </span></span>
<span id="cb49-503"><a href="#cb49-503" aria-hidden="true" tabindex="-1"></a><span class="in">                    hobbiton$geometry_y + miles_to_meters(20))) +</span></span>
<span id="cb49-504"><a href="#cb49-504" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "The Shire") +</span></span>
<span id="cb49-505"><a href="#cb49-505" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void() +</span></span>
<span id="cb49-506"><a href="#cb49-506" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(plot.background = element_rect(fill = clr_yellow),</span></span>
<span id="cb49-507"><a href="#cb49-507" aria-hidden="true" tabindex="-1"></a><span class="in">        plot.title = element_text(family = "Aniron", size = rel(2), </span></span>
<span id="cb49-508"><a href="#cb49-508" aria-hidden="true" tabindex="-1"></a><span class="in">                                  hjust = 0.02))</span></span>
<span id="cb49-509"><a href="#cb49-509" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-510"><a href="#cb49-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-511"><a href="#cb49-511" aria-hidden="true" tabindex="-1"></a>ahhh that's so cool!</span>
<span id="cb49-512"><a href="#cb49-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-513"><a href="#cb49-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-514"><a href="#cb49-514" aria-hidden="true" tabindex="-1"></a><span class="fu"># Distances between places</span></span>
<span id="cb49-515"><a href="#cb49-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-516"><a href="#cb49-516" aria-hidden="true" tabindex="-1"></a>We're not done yet though! We can do a lot more GIS-related work with R. Let's calculate some distances for fun!</span>
<span id="cb49-517"><a href="#cb49-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-518"><a href="#cb49-518" aria-hidden="true" tabindex="-1"></a>In the first half of *The Fellowship of the Ring*, Frodo, Sam, Merry, and Pippin travel from the Shire to Rivendell. How long of a journey was that?</span>
<span id="cb49-519"><a href="#cb49-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-520"><a href="#cb49-520" aria-hidden="true" tabindex="-1"></a>To figure this out we can extract the coordinates for Rivendell and then find the difference between it and Hobbiton. This doesn't follow any roads or anything—it's just as the Nazgûl flies—but it should be fairly accurate.</span>
<span id="cb49-521"><a href="#cb49-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-522"><a href="#cb49-522" aria-hidden="true" tabindex="-1"></a><span class="in">```{r initial-distance}</span></span>
<span id="cb49-523"><a href="#cb49-523" aria-hidden="true" tabindex="-1"></a><span class="in"># Find coordinates for Rivendell</span></span>
<span id="cb49-524"><a href="#cb49-524" aria-hidden="true" tabindex="-1"></a><span class="in">rivendell &lt;- places %&gt;% filter(NAME == "Rivendell")</span></span>
<span id="cb49-525"><a href="#cb49-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-526"><a href="#cb49-526" aria-hidden="true" tabindex="-1"></a><span class="in">st_distance(hobbiton, rivendell) %&gt;% meters_to_miles()</span></span>
<span id="cb49-527"><a href="#cb49-527" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-528"><a href="#cb49-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-529"><a href="#cb49-529" aria-hidden="true" tabindex="-1"></a>According to Karen Wynn Fonstad's <span class="co">[</span><span class="ot">*Atlas of Middle-earth*</span><span class="co">](https://www.amazon.com/Atlas-Middle-Earth-Revised-Karen-Fonstad/dp/0618126996)</span>, though, this should be <span class="co">[</span><span class="ot">458 miles</span><span class="co">](https://www.councilofelrond.com/craft/follow-the-fellowship-walk-to-rivendell-and-beyond/)</span>, which is exactly double the amount we just found! Somehow the distances between everything in the shapefiles are halved from regular-Earth miles. </span>
<span id="cb49-530"><a href="#cb49-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-531"><a href="#cb49-531" aria-hidden="true" tabindex="-1"></a>To fix this we can double the distance between Hobbiton and everything else in the dataset, expanding the data from Hobbiton, which now acts like the center of the world</span>
<span id="cb49-532"><a href="#cb49-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-533"><a href="#cb49-533" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rescaled-distance}</span></span>
<span id="cb49-534"><a href="#cb49-534" aria-hidden="true" tabindex="-1"></a><span class="in">me_scaled &lt;- places %&gt;%</span></span>
<span id="cb49-535"><a href="#cb49-535" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(NAME %in% c("Hobbiton", "Rivendell", "Edoras", "Minas Tirith")) %&gt;% </span></span>
<span id="cb49-536"><a href="#cb49-536" aria-hidden="true" tabindex="-1"></a><span class="in">  # Take the existing coordinates, subtract the doubled Hobbiton coordinates,</span></span>
<span id="cb49-537"><a href="#cb49-537" aria-hidden="true" tabindex="-1"></a><span class="in">  # and add the Hobbiton coordinates</span></span>
<span id="cb49-538"><a href="#cb49-538" aria-hidden="true" tabindex="-1"></a><span class="in">  st_set_geometry((st_geometry(.) - st_geometry(hobbiton)) * 2 + st_geometry(hobbiton))</span></span>
<span id="cb49-539"><a href="#cb49-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-540"><a href="#cb49-540" aria-hidden="true" tabindex="-1"></a><span class="in"># Extract new coordinates from scaled-up version</span></span>
<span id="cb49-541"><a href="#cb49-541" aria-hidden="true" tabindex="-1"></a><span class="in">hobbiton_scaled &lt;- me_scaled %&gt;% filter(NAME == "Hobbiton")</span></span>
<span id="cb49-542"><a href="#cb49-542" aria-hidden="true" tabindex="-1"></a><span class="in">rivendell_scaled &lt;- me_scaled %&gt;% filter(NAME == "Rivendell")</span></span>
<span id="cb49-543"><a href="#cb49-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-544"><a href="#cb49-544" aria-hidden="true" tabindex="-1"></a><span class="in"># Fixed!</span></span>
<span id="cb49-545"><a href="#cb49-545" aria-hidden="true" tabindex="-1"></a><span class="in">st_distance(hobbiton_scaled, rivendell_scaled) %&gt;% meters_to_miles()</span></span>
<span id="cb49-546"><a href="#cb49-546" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-547"><a href="#cb49-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-548"><a href="#cb49-548" aria-hidden="true" tabindex="-1"></a>That's correct now—it was 458 miles from the Shire to Rivendell.</span>
<span id="cb49-549"><a href="#cb49-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-550"><a href="#cb49-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-551"><a href="#cb49-551" aria-hidden="true" tabindex="-1"></a><span class="fu"># Sticking Middle Earth in Real Earth</span></span>
<span id="cb49-552"><a href="#cb49-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-553"><a href="#cb49-553" aria-hidden="true" tabindex="-1"></a>Now that we can work with correct distances, we can sick Middle Earth inside Real Earth to help visualize how far spread out Tolkien's world is. </span>
<span id="cb49-554"><a href="#cb49-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-555"><a href="#cb49-555" aria-hidden="true" tabindex="-1"></a><span class="fu">## In the United States</span></span>
<span id="cb49-556"><a href="#cb49-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-557"><a href="#cb49-557" aria-hidden="true" tabindex="-1"></a>First, let's stick a scaled-up version of Middle Earth in the United States. For fun, we'll put the Shire in the geographic center of the US, and we'll calculate the coordinates for that with R just to show that it's possible.</span>
<span id="cb49-558"><a href="#cb49-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-559"><a href="#cb49-559" aria-hidden="true" tabindex="-1"></a>Currently we have a dataset with 49 rows (48 states + DC). We can use the <span class="in">`st_centroid()`</span> function to find the center of geographic areas, but if we use it on our current data, we'll get 49 separate centers. So instead, we'll melt all the states into one big geographic shape with <span class="in">`group_by()`</span> and <span class="in">`summarize()`</span> (using <span class="in">`summarize()`</span> on the <span class="in">`geometry`</span> column in an <span class="in">`sf`</span> dataset combines the geographic areas), and then use <span class="in">`st_centroid()`</span> on that: </span>
<span id="cb49-560"><a href="#cb49-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-561"><a href="#cb49-561" aria-hidden="true" tabindex="-1"></a><span class="in">```{r dissolve-us-center}</span></span>
<span id="cb49-562"><a href="#cb49-562" aria-hidden="true" tabindex="-1"></a><span class="in"># Melt the lower 48 states into one big shape first, then use st_centroid()</span></span>
<span id="cb49-563"><a href="#cb49-563" aria-hidden="true" tabindex="-1"></a><span class="in">us_dissolved &lt;- lower_48 %&gt;% </span></span>
<span id="cb49-564"><a href="#cb49-564" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(country = "US") %&gt;%  # Create new column with the country name </span></span>
<span id="cb49-565"><a href="#cb49-565" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(country) %&gt;%  # Group by that country name column</span></span>
<span id="cb49-566"><a href="#cb49-566" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize()  # Collapse all the geographic data into one big blob</span></span>
<span id="cb49-567"><a href="#cb49-567" aria-hidden="true" tabindex="-1"></a><span class="in">us_dissolved</span></span>
<span id="cb49-568"><a href="#cb49-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-569"><a href="#cb49-569" aria-hidden="true" tabindex="-1"></a><span class="in">us_center &lt;- us_dissolved %&gt;% </span></span>
<span id="cb49-570"><a href="#cb49-570" aria-hidden="true" tabindex="-1"></a><span class="in">  st_geometry() %&gt;%  # Extract the geometry column</span></span>
<span id="cb49-571"><a href="#cb49-571" aria-hidden="true" tabindex="-1"></a><span class="in">  st_centroid()  # Find the center</span></span>
<span id="cb49-572"><a href="#cb49-572" aria-hidden="true" tabindex="-1"></a><span class="in">us_center</span></span>
<span id="cb49-573"><a href="#cb49-573" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-574"><a href="#cb49-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-575"><a href="#cb49-575" aria-hidden="true" tabindex="-1"></a>According to these calculations, the center of the contiguous US is <span class="in">`r us_center %&gt;% st_geometry() %&gt;% format_coords()`</span>. Technically that's not 100% correct—<span class="co">[</span><span class="ot">the true location</span><span class="co">](https://en.wikipedia.org/wiki/Geographic_center_of_the_United_States#Contiguous_United_States)</span> is at <span class="in">`r st_point(c(-98.583333, 39.833333)) %&gt;% st_geometry() %&gt;% format_coords()`</span>, but this is close enough (<span class="co">[</span><span class="ot">according to Google, it's 25 miles off</span><span class="co">](https://www.google.com/maps/dir/39.751441,+-98.965620/39.833333,-98.583333/@39.8236494,-98.9352692,11z/)</span>). I'm guessing the discrepancy is due to differences in the shapefile—I'm not using the highest resolution possible, and there might be islands I need to account for (or not account for). Who knows.</span>
<span id="cb49-576"><a href="#cb49-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-577"><a href="#cb49-577" aria-hidden="true" tabindex="-1"></a>Here's where that is. I'm using the <span class="co">[</span><span class="ot">{leaflet} package</span><span class="co">](https://rstudio.github.io/leaflet/)</span> just for fun here (this post is a showcase of different R-based GIS things, so let's showcase!):</span>
<span id="cb49-578"><a href="#cb49-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-579"><a href="#cb49-579" aria-hidden="true" tabindex="-1"></a><span class="in">```{r map-us-center, warning=FALSE}</span></span>
<span id="cb49-580"><a href="#cb49-580" aria-hidden="true" tabindex="-1"></a><span class="in">#| out-width: 100%</span></span>
<span id="cb49-581"><a href="#cb49-581" aria-hidden="true" tabindex="-1"></a><span class="in">us_center_plot &lt;- us_dissolved %&gt;% </span></span>
<span id="cb49-582"><a href="#cb49-582" aria-hidden="true" tabindex="-1"></a><span class="in">  st_centroid() %&gt;% </span></span>
<span id="cb49-583"><a href="#cb49-583" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fancy_coords = format_coords(geometry)) %&gt;% </span></span>
<span id="cb49-584"><a href="#cb49-584" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(label = glue("&lt;span style='display: block; text-align: center;'&gt;&lt;strong&gt;Roughly of the center of the contiguous US&lt;/strong&gt;",</span></span>
<span id="cb49-585"><a href="#cb49-585" aria-hidden="true" tabindex="-1"></a><span class="in">                      "&lt;br&gt;{fancy_coords}&lt;/span&gt;"))</span></span>
<span id="cb49-586"><a href="#cb49-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-587"><a href="#cb49-587" aria-hidden="true" tabindex="-1"></a><span class="in">leaflet(us_center_plot) %&gt;% </span></span>
<span id="cb49-588"><a href="#cb49-588" aria-hidden="true" tabindex="-1"></a><span class="in">  setView(lng = st_geometry(us_center_plot)[[1]][1], </span></span>
<span id="cb49-589"><a href="#cb49-589" aria-hidden="true" tabindex="-1"></a><span class="in">          lat = st_geometry(us_center_plot)[[1]][2], </span></span>
<span id="cb49-590"><a href="#cb49-590" aria-hidden="true" tabindex="-1"></a><span class="in">          zoom = 4) %&gt;%</span></span>
<span id="cb49-591"><a href="#cb49-591" aria-hidden="true" tabindex="-1"></a><span class="in">  addTiles() %&gt;% </span></span>
<span id="cb49-592"><a href="#cb49-592" aria-hidden="true" tabindex="-1"></a><span class="in">  addCircleMarkers(label = ~htmltools::HTML(label),</span></span>
<span id="cb49-593"><a href="#cb49-593" aria-hidden="true" tabindex="-1"></a><span class="in">                   labelOptions = labelOptions(noHide = TRUE, </span></span>
<span id="cb49-594"><a href="#cb49-594" aria-hidden="true" tabindex="-1"></a><span class="in">                                               direction = "top", </span></span>
<span id="cb49-595"><a href="#cb49-595" aria-hidden="true" tabindex="-1"></a><span class="in">                                               textOnly = FALSE))</span></span>
<span id="cb49-596"><a href="#cb49-596" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-597"><a href="#cb49-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-598"><a href="#cb49-598" aria-hidden="true" tabindex="-1"></a>Next, we need to transform the Middle Earth data so that it fits on the US map. We need to do a few things to make this work:</span>
<span id="cb49-599"><a href="#cb49-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-600"><a href="#cb49-600" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Double all the distances so they match Real World miles</span>
<span id="cb49-601"><a href="#cb49-601" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Change the projection of each of the Middle Earth-related datasets to match the projection of <span class="in">`lower_48`</span>, or <span class="co">[</span><span class="ot">WGS 84</span><span class="co">](https://en.wikipedia.org/wiki/World_Geodetic_System)</span>, or <span class="co">[</span><span class="ot">EPSG:4326</span><span class="co">](https://epsg.io/4326)</span></span>
<span id="cb49-602"><a href="#cb49-602" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Shift the Middle Earth-related datasets so that Hobbiton aligns with the center of the US.</span>
<span id="cb49-603"><a href="#cb49-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-604"><a href="#cb49-604" aria-hidden="true" tabindex="-1"></a>Changing the projection of an {sf}-enabled dataset is super easy with <span class="in">`st_transform()`</span>. Let's first transform the CRS for the Hobbiton coordinates:</span>
<span id="cb49-605"><a href="#cb49-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-606"><a href="#cb49-606" aria-hidden="true" tabindex="-1"></a><span class="in">```{r convert-hobbiton-to-us}</span></span>
<span id="cb49-607"><a href="#cb49-607" aria-hidden="true" tabindex="-1"></a><span class="in">hobbiton_in_us &lt;- hobbiton %&gt;% </span></span>
<span id="cb49-608"><a href="#cb49-608" aria-hidden="true" tabindex="-1"></a><span class="in">  st_transform(st_crs(lower_48))</span></span>
<span id="cb49-609"><a href="#cb49-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-610"><a href="#cb49-610" aria-hidden="true" tabindex="-1"></a><span class="in">hobbiton_in_us %&gt;% st_geometry()</span></span>
<span id="cb49-611"><a href="#cb49-611" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-612"><a href="#cb49-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-613"><a href="#cb49-613" aria-hidden="true" tabindex="-1"></a>Note how the coordinates are now on the <span class="co">[</span><span class="ot">decimal degrees scale</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_degrees)</span> (3.15, 9.44) instead of the meter scale (<span class="in">`r label_number(big.mark = "")(hobbiton_no_df[[1]][1])`</span>, <span class="in">`r label_number(big.mark = "")(hobbiton_no_df[[1]][2])`</span>). That's how the US map is set up, so now we can do GIS math with the two maps.</span>
<span id="cb49-614"><a href="#cb49-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-615"><a href="#cb49-615" aria-hidden="true" tabindex="-1"></a>Next, we need to calculate the offset from the center of the US and Hobbiton by finding the difference between the two sets of coordinates:</span>
<span id="cb49-616"><a href="#cb49-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-617"><a href="#cb49-617" aria-hidden="true" tabindex="-1"></a><span class="in">```{r find-distance-between-us-center-and-hobbiton}</span></span>
<span id="cb49-618"><a href="#cb49-618" aria-hidden="true" tabindex="-1"></a><span class="in">me_to_us &lt;- st_coordinates(us_center) - st_coordinates(hobbiton_in_us)</span></span>
<span id="cb49-619"><a href="#cb49-619" aria-hidden="true" tabindex="-1"></a><span class="in">me_to_us</span></span>
<span id="cb49-620"><a href="#cb49-620" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-621"><a href="#cb49-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-622"><a href="#cb49-622" aria-hidden="true" tabindex="-1"></a>Now we can use that offset to redefine the geometry column in any Middle Earth-related {sf}-enabled dataset we have. Here's the process for the <span class="in">`places`</span> data—it'll be the same for any of the other shapefiles.</span>
<span id="cb49-623"><a href="#cb49-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-624"><a href="#cb49-624" aria-hidden="true" tabindex="-1"></a><span class="in">```{r convert-me-places-to-us}</span></span>
<span id="cb49-625"><a href="#cb49-625" aria-hidden="true" tabindex="-1"></a><span class="in">me_places_in_us &lt;- places %&gt;% </span></span>
<span id="cb49-626"><a href="#cb49-626" aria-hidden="true" tabindex="-1"></a><span class="in">  # Make the Middle Earth data match the US projection</span></span>
<span id="cb49-627"><a href="#cb49-627" aria-hidden="true" tabindex="-1"></a><span class="in">  st_transform(st_crs(lower_48)) %&gt;%</span></span>
<span id="cb49-628"><a href="#cb49-628" aria-hidden="true" tabindex="-1"></a><span class="in">  # Just look at a handful of places</span></span>
<span id="cb49-629"><a href="#cb49-629" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(NAME %in% c("Hobbiton", "Rivendell", "Edoras", "Minas Tirith")) %&gt;% </span></span>
<span id="cb49-630"><a href="#cb49-630" aria-hidden="true" tabindex="-1"></a><span class="in">  # Double the distances</span></span>
<span id="cb49-631"><a href="#cb49-631" aria-hidden="true" tabindex="-1"></a><span class="in">  st_set_geometry((st_geometry(.) - st_geometry(hobbiton_in_us)) * 2 + st_geometry(hobbiton_in_us)) %&gt;% </span></span>
<span id="cb49-632"><a href="#cb49-632" aria-hidden="true" tabindex="-1"></a><span class="in">  # Shift everything around so that Hobbiton is in the center of the US</span></span>
<span id="cb49-633"><a href="#cb49-633" aria-hidden="true" tabindex="-1"></a><span class="in">  st_set_geometry(st_geometry(.) + me_to_us) %&gt;% </span></span>
<span id="cb49-634"><a href="#cb49-634" aria-hidden="true" tabindex="-1"></a><span class="in">  # All the geometry math made us lose the projection metadata; set it again</span></span>
<span id="cb49-635"><a href="#cb49-635" aria-hidden="true" tabindex="-1"></a><span class="in">  st_set_crs(st_crs(lower_48))</span></span>
<span id="cb49-636"><a href="#cb49-636" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-637"><a href="#cb49-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-638"><a href="#cb49-638" aria-hidden="true" tabindex="-1"></a>We can now stick this US-transformed set of place locations insde a map of the US. (Note the ±70000 values for nudging. I have no idea what scale these are on—they're not meters or miles (maybe feet? maybe decimal degrees?). I had to tinker with different values until it looked okay.)</span>
<span id="cb49-639"><a href="#cb49-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-640"><a href="#cb49-640" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basic-us-me-places, fig.width=6.5, fig.height=4, out.width="100%"}</span></span>
<span id="cb49-641"><a href="#cb49-641" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Middle Earth locations placed in the US"</span></span>
<span id="cb49-642"><a href="#cb49-642" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: "Middle Earth locations placed in the US"</span></span>
<span id="cb49-643"><a href="#cb49-643" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() + </span></span>
<span id="cb49-644"><a href="#cb49-644" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = lower_48, fill = "#FF851B", color = "white", linewidth = 0.25) +</span></span>
<span id="cb49-645"><a href="#cb49-645" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = me_places_in_us) +</span></span>
<span id="cb49-646"><a href="#cb49-646" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf_label(data = filter(me_places_in_us, NAME %in% c("Hobbiton", "Edoras")),</span></span>
<span id="cb49-647"><a href="#cb49-647" aria-hidden="true" tabindex="-1"></a><span class="in">                aes(label = NAME), nudge_x = -70000, hjust = 1) +</span></span>
<span id="cb49-648"><a href="#cb49-648" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf_label(data = filter(me_places_in_us, NAME %in% c("Rivendell", "Minas Tirith")),</span></span>
<span id="cb49-649"><a href="#cb49-649" aria-hidden="true" tabindex="-1"></a><span class="in">                aes(label = NAME), nudge_x = 70000, hjust = 0) +</span></span>
<span id="cb49-650"><a href="#cb49-650" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_sf(crs = st_crs("ESRI:102003")) +  # Albers</span></span>
<span id="cb49-651"><a href="#cb49-651" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void()</span></span>
<span id="cb49-652"><a href="#cb49-652" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-653"><a href="#cb49-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-654"><a href="#cb49-654" aria-hidden="true" tabindex="-1"></a>Assuming the Shire is in the middle of Kansas, Rivendell would be near the Mississippi River in Missouri. Rohan is down in southern Arkansas, while Gondor is in southern Alabama. </span>
<span id="cb49-655"><a href="#cb49-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-656"><a href="#cb49-656" aria-hidden="true" tabindex="-1"></a>We could be even fancier and reshift *all* the Middle Earth shapefiles to fit in the US, and then overlay all of Middle Earth on the US, but I won't do that here. I'll just stick the coastline on so we can compare the relative sizes of the US and Middle Earth:</span>
<span id="cb49-657"><a href="#cb49-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-658"><a href="#cb49-658" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fancier-us-me-places, fig.width=6.5, fig.height=4, out.width="100%"}</span></span>
<span id="cb49-659"><a href="#cb49-659" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Middle Earth locations and borders placed in the US"</span></span>
<span id="cb49-660"><a href="#cb49-660" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: "Middle Earth locations and borders placed in the US"</span></span>
<span id="cb49-661"><a href="#cb49-661" aria-hidden="true" tabindex="-1"></a><span class="in">coastline_in_us &lt;- coastline %&gt;% </span></span>
<span id="cb49-662"><a href="#cb49-662" aria-hidden="true" tabindex="-1"></a><span class="in">  st_transform(st_crs(lower_48)) %&gt;%</span></span>
<span id="cb49-663"><a href="#cb49-663" aria-hidden="true" tabindex="-1"></a><span class="in">  st_set_geometry((st_geometry(.) - st_geometry(hobbiton_in_us)) * 2 + st_geometry(hobbiton_in_us)) %&gt;% </span></span>
<span id="cb49-664"><a href="#cb49-664" aria-hidden="true" tabindex="-1"></a><span class="in">  st_set_geometry(st_geometry(.) + me_to_us) %&gt;% </span></span>
<span id="cb49-665"><a href="#cb49-665" aria-hidden="true" tabindex="-1"></a><span class="in">  st_set_crs(st_crs(lower_48))</span></span>
<span id="cb49-666"><a href="#cb49-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-667"><a href="#cb49-667" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() + </span></span>
<span id="cb49-668"><a href="#cb49-668" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = lower_48, fill = "#FF851B", color = "white", linewidth = 0.25) +</span></span>
<span id="cb49-669"><a href="#cb49-669" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = coastline_in_us, linewidth = 0.25) +</span></span>
<span id="cb49-670"><a href="#cb49-670" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = me_places_in_us) +</span></span>
<span id="cb49-671"><a href="#cb49-671" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf_label(data = filter(me_places_in_us, NAME %in% c("Hobbiton", "Edoras")),</span></span>
<span id="cb49-672"><a href="#cb49-672" aria-hidden="true" tabindex="-1"></a><span class="in">                aes(label = NAME), nudge_x = -70000, hjust = 1) +</span></span>
<span id="cb49-673"><a href="#cb49-673" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf_label(data = filter(me_places_in_us, NAME %in% c("Rivendell", "Minas Tirith")),</span></span>
<span id="cb49-674"><a href="#cb49-674" aria-hidden="true" tabindex="-1"></a><span class="in">                aes(label = NAME), nudge_x = 70000, hjust = 0) +</span></span>
<span id="cb49-675"><a href="#cb49-675" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_sf(crs = st_crs("ESRI:102003")) +  # Albers</span></span>
<span id="cb49-676"><a href="#cb49-676" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void()</span></span>
<span id="cb49-677"><a href="#cb49-677" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-678"><a href="#cb49-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-679"><a href="#cb49-679" aria-hidden="true" tabindex="-1"></a><span class="fu">## In Europe</span></span>
<span id="cb49-680"><a href="#cb49-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-681"><a href="#cb49-681" aria-hidden="true" tabindex="-1"></a>Sticking Middle Earth in the US makes sense because I live in the US, so these relative distances are straightforward to me. (I'm in Georgia, which is the middle of Mordor in the maps above).</span>
<span id="cb49-682"><a href="#cb49-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-683"><a href="#cb49-683" aria-hidden="true" tabindex="-1"></a>But Tolkien was from England and lived in Oxford—at <span class="co">[</span><span class="ot">20 Northmoor Road</span><span class="co">](https://en.wikipedia.org/wiki/Northmoor_Road)</span> to be precise, or at <span class="co">[</span><span class="ot">`r st_point(c(-1.2601418874304429, 51.771003605142724)) %&gt;% st_geometry() %&gt;% format_coords()`</span><span class="co">](https://www.google.com/maps/place/20+Northmoor+Rd,+Oxford+OX2+6UR,+UK/@51.7710103,-1.2626846,17z/)</span> to be even more precise (I found this by going to Google Maps, right clicking on Tolkien's home, and copying the coordinates). Here's where that is:</span>
<span id="cb49-684"><a href="#cb49-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-685"><a href="#cb49-685" aria-hidden="true" tabindex="-1"></a><span class="in">```{r map-oxford, warning=FALSE}</span></span>
<span id="cb49-686"><a href="#cb49-686" aria-hidden="true" tabindex="-1"></a><span class="in">#| out-width: 100%</span></span>
<span id="cb49-687"><a href="#cb49-687" aria-hidden="true" tabindex="-1"></a><span class="in">tolkien_home &lt;- tribble(</span></span>
<span id="cb49-688"><a href="#cb49-688" aria-hidden="true" tabindex="-1"></a><span class="in">  ~place, ~lat, ~long,</span></span>
<span id="cb49-689"><a href="#cb49-689" aria-hidden="true" tabindex="-1"></a><span class="in">  "Tolkien's home", 51.771003605142724, -1.2601418874304429</span></span>
<span id="cb49-690"><a href="#cb49-690" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;% </span></span>
<span id="cb49-691"><a href="#cb49-691" aria-hidden="true" tabindex="-1"></a><span class="in">  st_as_sf(coords = c("long", "lat"), crs = st_crs("EPSG:4326")) </span></span>
<span id="cb49-692"><a href="#cb49-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-693"><a href="#cb49-693" aria-hidden="true" tabindex="-1"></a><span class="in">tolkien_home_plot &lt;- tolkien_home %&gt;% </span></span>
<span id="cb49-694"><a href="#cb49-694" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fancy_coords = format_coords(geometry)) %&gt;% </span></span>
<span id="cb49-695"><a href="#cb49-695" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(label = glue("&lt;span style='display: block; text-align: center;'&gt;&lt;strong&gt;{place}&lt;/strong&gt;",</span></span>
<span id="cb49-696"><a href="#cb49-696" aria-hidden="true" tabindex="-1"></a><span class="in">                      "&lt;br&gt;{fancy_coords}&lt;/span&gt;"))</span></span>
<span id="cb49-697"><a href="#cb49-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-698"><a href="#cb49-698" aria-hidden="true" tabindex="-1"></a><span class="in">leaflet(tolkien_home_plot) %&gt;% </span></span>
<span id="cb49-699"><a href="#cb49-699" aria-hidden="true" tabindex="-1"></a><span class="in">  setView(lng = st_geometry(tolkien_home_plot)[[1]][1], </span></span>
<span id="cb49-700"><a href="#cb49-700" aria-hidden="true" tabindex="-1"></a><span class="in">          lat = st_geometry(tolkien_home_plot)[[1]][2], </span></span>
<span id="cb49-701"><a href="#cb49-701" aria-hidden="true" tabindex="-1"></a><span class="in">          zoom = 14) %&gt;%</span></span>
<span id="cb49-702"><a href="#cb49-702" aria-hidden="true" tabindex="-1"></a><span class="in">  addTiles() %&gt;% </span></span>
<span id="cb49-703"><a href="#cb49-703" aria-hidden="true" tabindex="-1"></a><span class="in">  addCircleMarkers(label = ~htmltools::HTML(label),</span></span>
<span id="cb49-704"><a href="#cb49-704" aria-hidden="true" tabindex="-1"></a><span class="in">                   labelOptions = labelOptions(noHide = TRUE, </span></span>
<span id="cb49-705"><a href="#cb49-705" aria-hidden="true" tabindex="-1"></a><span class="in">                                               direction = "top", </span></span>
<span id="cb49-706"><a href="#cb49-706" aria-hidden="true" tabindex="-1"></a><span class="in">                                               textOnly = FALSE))</span></span>
<span id="cb49-707"><a href="#cb49-707" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-708"><a href="#cb49-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-709"><a href="#cb49-709" aria-hidden="true" tabindex="-1"></a>We can put Hobbiton in Tolkien's home and then see the relative distances to the rest of Middle Earth from Oxford.</span>
<span id="cb49-710"><a href="#cb49-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-711"><a href="#cb49-711" aria-hidden="true" tabindex="-1"></a>We'll use the Natural Earth data that we loaded at the beginning of this post. We could theoretically filter it to only look at European countries, since it includes a column for continent, but doing so causes all sorts of issues:</span>
<span id="cb49-712"><a href="#cb49-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-713"><a href="#cb49-713" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Russia is huuuuge</span>
<span id="cb49-714"><a href="#cb49-714" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>French Guiana is officially part of France, so the map includes a part of South America</span>
<span id="cb49-715"><a href="#cb49-715" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Other countries like Denmark, Norway, and the UK have similar overseas province-like territories, so the map gets even more expanded</span>
<span id="cb49-716"><a href="#cb49-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-717"><a href="#cb49-717" aria-hidden="true" tabindex="-1"></a><span class="in">```{r europe-only-not-great, fig.width=4.5, fig.height=2, out.width="100%"}</span></span>
<span id="cb49-718"><a href="#cb49-718" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Ugly map of all European countries"</span></span>
<span id="cb49-719"><a href="#cb49-719" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: "Ugly map of all European countries"</span></span>
<span id="cb49-720"><a href="#cb49-720" aria-hidden="true" tabindex="-1"></a><span class="in">europe &lt;- world_map %&gt;% </span></span>
<span id="cb49-721"><a href="#cb49-721" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(continent == "Europe")</span></span>
<span id="cb49-722"><a href="#cb49-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-723"><a href="#cb49-723" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb49-724"><a href="#cb49-724" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = europe)</span></span>
<span id="cb49-725"><a href="#cb49-725" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-726"><a href="#cb49-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-727"><a href="#cb49-727" aria-hidden="true" tabindex="-1"></a>We could do some fancy filtering and <span class="co">[</span><span class="ot">use more detailed data that splits places like France into separate subdivisions</span><span class="co">](https://github.com/nvkelso/natural-earth-vector/issues/196)</span> (i.e. one row for continental Europe France, one row for French Guiana, etc.), but that's a lot of work. So instead, we'll use <span class="in">`coord_sf()`</span> to define a window so we can zoom in on just a chunk of Europe. Before, we added some arbitrary number of miles around the coordinates for Hobbiton. This time we'll <span class="co">[</span><span class="ot">use a helpful tool from OpenStreetMap</span><span class="co">](https://www.openstreetmap.org/export#map=4/54.47/12.79)</span> that lets you draw a bounding box on a world map to get coordinates to work with:</span>
<span id="cb49-728"><a href="#cb49-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-729"><a href="#cb49-729" aria-hidden="true" tabindex="-1"></a><span class="in">```{r osm-export, echo=FALSE, out.width="100%"}</span></span>
<span id="cb49-730"><a href="#cb49-730" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "OpenStreetMap's site for exporting bounding box coordinates"</span></span>
<span id="cb49-731"><a href="#cb49-731" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: "OpenStreetMap's site for exporting bounding box coordinates"</span></span>
<span id="cb49-732"><a href="#cb49-732" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("img/osm-export.png")</span></span>
<span id="cb49-733"><a href="#cb49-733" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-734"><a href="#cb49-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-735"><a href="#cb49-735" aria-hidden="true" tabindex="-1"></a>We can then create a <span class="co">[</span><span class="ot">little matrix of coordinates</span><span class="co">](https://felixanalytix.medium.com/how-to-map-any-region-of-the-world-using-r-programming-bb3c4146f97f)</span>. We're ultimately going to use the <span class="co">[</span><span class="ot">PTRA08 / LAEA Europe projection</span><span class="co">](https://epsg.io/5633)</span>, which is centered in Portugal and is a good Europe-centric projection, so we'll convert the list of coordinates to that projection.</span>
<span id="cb49-736"><a href="#cb49-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-737"><a href="#cb49-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-738"><a href="#cb49-738" aria-hidden="true" tabindex="-1"></a><span class="in">```{r make-europe-window}</span></span>
<span id="cb49-739"><a href="#cb49-739" aria-hidden="true" tabindex="-1"></a><span class="in">europe_window &lt;- st_sfc(</span></span>
<span id="cb49-740"><a href="#cb49-740" aria-hidden="true" tabindex="-1"></a><span class="in">  st_point(c(-12.4, 29.31)),  # left (west), bottom (south)</span></span>
<span id="cb49-741"><a href="#cb49-741" aria-hidden="true" tabindex="-1"></a><span class="in">  st_point(c(44.74, 64.62)),  # right (east), top (north)</span></span>
<span id="cb49-742"><a href="#cb49-742" aria-hidden="true" tabindex="-1"></a><span class="in">  crs = st_crs("EPSG:4326")   # WGS 84</span></span>
<span id="cb49-743"><a href="#cb49-743" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;% </span></span>
<span id="cb49-744"><a href="#cb49-744" aria-hidden="true" tabindex="-1"></a><span class="in">  st_transform(crs = st_crs("EPSG:5633")) %&gt;%  # LAEA Europe, centered in Portugal</span></span>
<span id="cb49-745"><a href="#cb49-745" aria-hidden="true" tabindex="-1"></a><span class="in">  st_coordinates()</span></span>
<span id="cb49-746"><a href="#cb49-746" aria-hidden="true" tabindex="-1"></a><span class="in">europe_window</span></span>
<span id="cb49-747"><a href="#cb49-747" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-748"><a href="#cb49-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-749"><a href="#cb49-749" aria-hidden="true" tabindex="-1"></a>Now we can plot the full world map data and use <span class="in">`coord_sf()`</span> to limit it to just this window:</span>
<span id="cb49-750"><a href="#cb49-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-751"><a href="#cb49-751" aria-hidden="true" tabindex="-1"></a><span class="in">```{r try-europe-window, fig.width=4.7, fig.height=5, out.width="60%"}</span></span>
<span id="cb49-752"><a href="#cb49-752" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "World map cropped to just show part of Europe"</span></span>
<span id="cb49-753"><a href="#cb49-753" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: "World map cropped to just show part of Europe"</span></span>
<span id="cb49-754"><a href="#cb49-754" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb49-755"><a href="#cb49-755" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = world_map) +</span></span>
<span id="cb49-756"><a href="#cb49-756" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_sf(crs = st_crs("EPSG:5633"),</span></span>
<span id="cb49-757"><a href="#cb49-757" aria-hidden="true" tabindex="-1"></a><span class="in">           xlim = europe_window[, "X"],</span></span>
<span id="cb49-758"><a href="#cb49-758" aria-hidden="true" tabindex="-1"></a><span class="in">           ylim = europe_window[, "Y"],</span></span>
<span id="cb49-759"><a href="#cb49-759" aria-hidden="true" tabindex="-1"></a><span class="in">           expand = FALSE)</span></span>
<span id="cb49-760"><a href="#cb49-760" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-761"><a href="#cb49-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-762"><a href="#cb49-762" aria-hidden="true" tabindex="-1"></a>Neat. Now that we know how to zoom in on Europe, we can go through the same process we did with the US—we'll convert the Middle Earth shapefiles to the European projection, center Hobbiton on Tolkien's home in Oxford, double all the distances, and shift everything around.</span>
<span id="cb49-763"><a href="#cb49-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-764"><a href="#cb49-764" aria-hidden="true" tabindex="-1"></a><span class="in">```{r process-me-europe-stuff}</span></span>
<span id="cb49-765"><a href="#cb49-765" aria-hidden="true" tabindex="-1"></a><span class="in"># Convert the Tolkien home coordinates to European coordinates</span></span>
<span id="cb49-766"><a href="#cb49-766" aria-hidden="true" tabindex="-1"></a><span class="in">tolkien_home &lt;- tolkien_home %&gt;% </span></span>
<span id="cb49-767"><a href="#cb49-767" aria-hidden="true" tabindex="-1"></a><span class="in">  st_transform(crs = st_crs("EPSG:5633"))</span></span>
<span id="cb49-768"><a href="#cb49-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-769"><a href="#cb49-769" aria-hidden="true" tabindex="-1"></a><span class="in"># Convert the Hobbiton coordinates to European coordinates</span></span>
<span id="cb49-770"><a href="#cb49-770" aria-hidden="true" tabindex="-1"></a><span class="in">hobbiton_in_europe &lt;- hobbiton %&gt;% </span></span>
<span id="cb49-771"><a href="#cb49-771" aria-hidden="true" tabindex="-1"></a><span class="in">  st_transform(st_crs("EPSG:5633"))</span></span>
<span id="cb49-772"><a href="#cb49-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-773"><a href="#cb49-773" aria-hidden="true" tabindex="-1"></a><span class="in"># Find the offset between Tolkien's home and Hobbiton</span></span>
<span id="cb49-774"><a href="#cb49-774" aria-hidden="true" tabindex="-1"></a><span class="in">me_to_europe &lt;- st_coordinates(tolkien_home) - st_coordinates(hobbiton_in_europe)</span></span>
<span id="cb49-775"><a href="#cb49-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-776"><a href="#cb49-776" aria-hidden="true" tabindex="-1"></a><span class="in">me_places_in_europe &lt;- places %&gt;% </span></span>
<span id="cb49-777"><a href="#cb49-777" aria-hidden="true" tabindex="-1"></a><span class="in">  # Make the Middle Earth data match the Europe projection</span></span>
<span id="cb49-778"><a href="#cb49-778" aria-hidden="true" tabindex="-1"></a><span class="in">  st_transform(st_crs("EPSG:5633")) %&gt;%</span></span>
<span id="cb49-779"><a href="#cb49-779" aria-hidden="true" tabindex="-1"></a><span class="in">  # Just look at a handful of places</span></span>
<span id="cb49-780"><a href="#cb49-780" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(NAME %in% c("Hobbiton", "Rivendell", "Edoras", "Minas Tirith")) %&gt;% </span></span>
<span id="cb49-781"><a href="#cb49-781" aria-hidden="true" tabindex="-1"></a><span class="in">  # Double the distances</span></span>
<span id="cb49-782"><a href="#cb49-782" aria-hidden="true" tabindex="-1"></a><span class="in">  st_set_geometry((st_geometry(.) - st_geometry(hobbiton_in_europe)) * 2 + st_geometry(hobbiton_in_europe)) %&gt;% </span></span>
<span id="cb49-783"><a href="#cb49-783" aria-hidden="true" tabindex="-1"></a><span class="in">  # Shift everything around so that Hobbiton is in Oxford</span></span>
<span id="cb49-784"><a href="#cb49-784" aria-hidden="true" tabindex="-1"></a><span class="in">  st_set_geometry(st_geometry(.) + me_to_europe) %&gt;% </span></span>
<span id="cb49-785"><a href="#cb49-785" aria-hidden="true" tabindex="-1"></a><span class="in">  # All the geometry math made us lose the projection metadata; set it again</span></span>
<span id="cb49-786"><a href="#cb49-786" aria-hidden="true" tabindex="-1"></a><span class="in">  st_set_crs(st_crs("EPSG:5633"))</span></span>
<span id="cb49-787"><a href="#cb49-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-788"><a href="#cb49-788" aria-hidden="true" tabindex="-1"></a><span class="in">coastline_in_europe &lt;- coastline %&gt;% </span></span>
<span id="cb49-789"><a href="#cb49-789" aria-hidden="true" tabindex="-1"></a><span class="in">  st_transform(st_crs("EPSG:5633")) %&gt;%</span></span>
<span id="cb49-790"><a href="#cb49-790" aria-hidden="true" tabindex="-1"></a><span class="in">  st_set_geometry((st_geometry(.) - st_geometry(hobbiton_in_europe)) * 2 + st_geometry(hobbiton_in_europe)) %&gt;% </span></span>
<span id="cb49-791"><a href="#cb49-791" aria-hidden="true" tabindex="-1"></a><span class="in">  st_set_geometry(st_geometry(.) + me_to_europe) %&gt;% </span></span>
<span id="cb49-792"><a href="#cb49-792" aria-hidden="true" tabindex="-1"></a><span class="in">  st_set_crs(st_crs("EPSG:5633"))</span></span>
<span id="cb49-793"><a href="#cb49-793" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-794"><a href="#cb49-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-795"><a href="#cb49-795" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fancy-europe-me-places, fig.width=6.15, fig.height=6.5, out.width="100%"}</span></span>
<span id="cb49-796"><a href="#cb49-796" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Middle Earth locations and borders placed in Europe"</span></span>
<span id="cb49-797"><a href="#cb49-797" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: "Middle Earth locations and borders placed in Europe"</span></span>
<span id="cb49-798"><a href="#cb49-798" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() + </span></span>
<span id="cb49-799"><a href="#cb49-799" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = world_map, fill = "#39CCCC", color = "white", linewidth = 0.25) +</span></span>
<span id="cb49-800"><a href="#cb49-800" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = coastline_in_europe, linewidth = 0.25) +</span></span>
<span id="cb49-801"><a href="#cb49-801" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = me_places_in_europe) +</span></span>
<span id="cb49-802"><a href="#cb49-802" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf_label(data = filter(me_places_in_europe, NAME %in% c("Hobbiton", "Edoras")),</span></span>
<span id="cb49-803"><a href="#cb49-803" aria-hidden="true" tabindex="-1"></a><span class="in">                aes(label = NAME), nudge_x = -70000, hjust = 1) +</span></span>
<span id="cb49-804"><a href="#cb49-804" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf_label(data = filter(me_places_in_europe, NAME %in% c("Rivendell", "Minas Tirith")),</span></span>
<span id="cb49-805"><a href="#cb49-805" aria-hidden="true" tabindex="-1"></a><span class="in">                aes(label = NAME), nudge_x = 70000, hjust = 0) +</span></span>
<span id="cb49-806"><a href="#cb49-806" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_sf(crs = st_crs("EPSG:5633"),</span></span>
<span id="cb49-807"><a href="#cb49-807" aria-hidden="true" tabindex="-1"></a><span class="in">           xlim = europe_window[, "X"],</span></span>
<span id="cb49-808"><a href="#cb49-808" aria-hidden="true" tabindex="-1"></a><span class="in">           ylim = europe_window[, "Y"],</span></span>
<span id="cb49-809"><a href="#cb49-809" aria-hidden="true" tabindex="-1"></a><span class="in">           expand = FALSE) +</span></span>
<span id="cb49-810"><a href="#cb49-810" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void()</span></span>
<span id="cb49-811"><a href="#cb49-811" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-812"><a href="#cb49-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-813"><a href="#cb49-813" aria-hidden="true" tabindex="-1"></a>With Hobbiton in Oxford, Rivendell is in north central Germany (near Hanover?), with Rohan in Switzerland and Gondor on the border of Croatia and Bosnia.</span>
<span id="cb49-814"><a href="#cb49-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-815"><a href="#cb49-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-816"><a href="#cb49-816" aria-hidden="true" tabindex="-1"></a><span class="fu"># Things I want to do someday but am not smart enough to do</span></span>
<span id="cb49-817"><a href="#cb49-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-818"><a href="#cb49-818" aria-hidden="true" tabindex="-1"></a>And there's our quick tour of {sf} and Middle Earth! It's incredible how much GIS-related stuff you can do with R, and the plots are all beautiful thanks to the magic of ggplot!</span>
<span id="cb49-819"><a href="#cb49-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-820"><a href="#cb49-820" aria-hidden="true" tabindex="-1"></a><span class="fu">## Paths</span></span>
<span id="cb49-821"><a href="#cb49-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-822"><a href="#cb49-822" aria-hidden="true" tabindex="-1"></a>It would be really cool to be able to plot the pathways different characters took in each of the books (Bilbo and Thorin's company; Frodo and Sam; Aragorn, Legolas, and Gimli, etc.). This data exists! <span class="co">[</span><span class="ot">The LOTR Project has detailed maps</span><span class="co">](http://lotrproject.com/map/#zoom=3&amp;lat=-1315.5&amp;lon=1500&amp;layers=BTTTTT)</span> with the pathways of all of the main characters' journeys. However, it's not (as far as I can tell) open source or Creative Commons-licensed, and I don't think the coordinates are directly comparable to the shapefiles from the ME-GIS project. Alas.</span>
<span id="cb49-823"><a href="#cb49-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-824"><a href="#cb49-824" aria-hidden="true" tabindex="-1"></a><span class="fu">## First and Second Ages</span></span>
<span id="cb49-825"><a href="#cb49-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-826"><a href="#cb49-826" aria-hidden="true" tabindex="-1"></a>In addition to *The Lord of the Rings* and *The Hobbit*, Tolkien wrote a ton about other ages in Middle Earth (see this <span class="co">[</span><span class="ot">super quick crash course in the Ages of Arda from my post on Númenorean ages</span><span class="co">](https://www.andrewheiss.com/blog/2023/03/21/aragorn-dunedan-numenorean-simulation/#super-quick-crash-course-in-the-ages-of-arda-n%C3%BAmenor)</span>). A separate mapping project—<span class="co">[</span><span class="ot">Arda-Maps</span><span class="co">](https://github.com/kwoxer/Arda-Maps)</span>—has shapefiles for all three ages of Tolkien's world, including Valinor, Beleriand, and Númenor. </span>
<span id="cb49-827"><a href="#cb49-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-828"><a href="#cb49-828" aria-hidden="true" tabindex="-1"></a>However, the maps aren't as detailed as the ME-GIS project, and they're on a completely different scale. For example, here's the island of Númenor (featured in Amazon's *The Rings of Power*). I downloaded the shapefiles from their <span class="co">[</span><span class="ot">GitHub repository</span><span class="co">](https://github.com/kwoxer/Arda-Maps)</span>—the Second Age shapefiles are buried in <span class="in">`QGIS/second age/arda2`</span></span>
<span id="cb49-829"><a href="#cb49-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-830"><a href="#cb49-830" aria-hidden="true" tabindex="-1"></a>Here I use <span class="in">`st_bbox()`</span> to create a bounding box of coordinates that I then use to crop the underlying data. This is different from what we did with Europe, where we plotted the whole world map and then zoomed in on just a chunk of western Europe. Here, <span class="in">`st_crop()`</span> cuts out the geographic data that doesn't fall within the box (similar to filtering).</span>
<span id="cb49-831"><a href="#cb49-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-832"><a href="#cb49-832" aria-hidden="true" tabindex="-1"></a><span class="in">```{r numenor-map, warning=FALSE, fig.width=6.5, fig.height=6, out.width="100%"}</span></span>
<span id="cb49-833"><a href="#cb49-833" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Fancy map of Númenor"</span></span>
<span id="cb49-834"><a href="#cb49-834" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: "Fancy map of Númenor"</span></span>
<span id="cb49-835"><a href="#cb49-835" aria-hidden="true" tabindex="-1"></a><span class="in">numenor_box &lt;- st_bbox(c(xmin = 0.007, xmax = 0.017, ymin = -0.025, ymax = -0.015))</span></span>
<span id="cb49-836"><a href="#cb49-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-837"><a href="#cb49-837" aria-hidden="true" tabindex="-1"></a><span class="in">numenor_outlines &lt;- read_sf("data/Arda-Maps/QGIS/second age/arda2/poly_outline.shp") %&gt;% </span></span>
<span id="cb49-838"><a href="#cb49-838" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(name == "Numenor")</span></span>
<span id="cb49-839"><a href="#cb49-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-840"><a href="#cb49-840" aria-hidden="true" tabindex="-1"></a><span class="in">numenor_rivers &lt;- read_sf("data/Arda-Maps/QGIS/second age/arda2/line_river.shp") %&gt;% </span></span>
<span id="cb49-841"><a href="#cb49-841" aria-hidden="true" tabindex="-1"></a><span class="in">  st_crop(numenor_box)</span></span>
<span id="cb49-842"><a href="#cb49-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-843"><a href="#cb49-843" aria-hidden="true" tabindex="-1"></a><span class="in">numenor_cities &lt;- read_sf("data/Arda-Maps/QGIS/second age/arda2/point_city.shp") %&gt;% </span></span>
<span id="cb49-844"><a href="#cb49-844" aria-hidden="true" tabindex="-1"></a><span class="in">  st_crop(numenor_box)</span></span>
<span id="cb49-845"><a href="#cb49-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-846"><a href="#cb49-846" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb49-847"><a href="#cb49-847" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = numenor_outlines, fill = "#F2CB9B") +</span></span>
<span id="cb49-848"><a href="#cb49-848" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = numenor_rivers, linewidth = 0.4, color = clr_blue) +</span></span>
<span id="cb49-849"><a href="#cb49-849" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = numenor_cities) +</span></span>
<span id="cb49-850"><a href="#cb49-850" aria-hidden="true" tabindex="-1"></a><span class="in">  # Use geom_label_repel with the geometry column!</span></span>
<span id="cb49-851"><a href="#cb49-851" aria-hidden="true" tabindex="-1"></a><span class="in">  ggrepel::geom_label_repel(</span></span>
<span id="cb49-852"><a href="#cb49-852" aria-hidden="true" tabindex="-1"></a><span class="in">    data = numenor_cities, </span></span>
<span id="cb49-853"><a href="#cb49-853" aria-hidden="true" tabindex="-1"></a><span class="in">    aes(label = eventname, geometry = geometry),</span></span>
<span id="cb49-854"><a href="#cb49-854" aria-hidden="true" tabindex="-1"></a><span class="in">    stat = "sf_coordinates", seed = 1234,</span></span>
<span id="cb49-855"><a href="#cb49-855" aria-hidden="true" tabindex="-1"></a><span class="in">    family = "Overpass ExtraBold") +</span></span>
<span id="cb49-856"><a href="#cb49-856" aria-hidden="true" tabindex="-1"></a><span class="in">  annotation_scale(location = "tl", bar_cols = c("grey30", "white"),</span></span>
<span id="cb49-857"><a href="#cb49-857" aria-hidden="true" tabindex="-1"></a><span class="in">                   text_family = "Overpass",</span></span>
<span id="cb49-858"><a href="#cb49-858" aria-hidden="true" tabindex="-1"></a><span class="in">                   unit_category = "imperial") +</span></span>
<span id="cb49-859"><a href="#cb49-859" aria-hidden="true" tabindex="-1"></a><span class="in">  annotation_north_arrow(</span></span>
<span id="cb49-860"><a href="#cb49-860" aria-hidden="true" tabindex="-1"></a><span class="in">    location = "tl", pad_y = unit(1.5, "lines"),</span></span>
<span id="cb49-861"><a href="#cb49-861" aria-hidden="true" tabindex="-1"></a><span class="in">    style = north_arrow_fancy_orienteering(fill = c("grey30", "white"), </span></span>
<span id="cb49-862"><a href="#cb49-862" aria-hidden="true" tabindex="-1"></a><span class="in">                                           line_col = "grey30",</span></span>
<span id="cb49-863"><a href="#cb49-863" aria-hidden="true" tabindex="-1"></a><span class="in">                                           text_family = "Overpass")) +</span></span>
<span id="cb49-864"><a href="#cb49-864" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Númenor") +</span></span>
<span id="cb49-865"><a href="#cb49-865" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void() +</span></span>
<span id="cb49-866"><a href="#cb49-866" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(plot.background = element_rect(fill = clr_yellow),</span></span>
<span id="cb49-867"><a href="#cb49-867" aria-hidden="true" tabindex="-1"></a><span class="in">        plot.title = element_text(family = "Aniron", size = rel(2), </span></span>
<span id="cb49-868"><a href="#cb49-868" aria-hidden="true" tabindex="-1"></a><span class="in">                                  hjust = 0.02))</span></span>
<span id="cb49-869"><a href="#cb49-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-870"><a href="#cb49-870" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-871"><a href="#cb49-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-872"><a href="#cb49-872" aria-hidden="true" tabindex="-1"></a>The map looks fantastic! But notice the scale bar in the top left corner—in this data, Númenor is only a couple thousand feet wide—less than half a mile. The distances are all way wrong. I could probably scale it up by comparing the projection distances in the Arda Maps' version of regular Middle Earth with the ME-GIS project's version of regular Middle Earth and then do some fancy math, ~~but that goes beyond my skills~~. </span>
<span id="cb49-873"><a href="#cb49-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-874"><a href="#cb49-874" aria-hidden="true" tabindex="-1"></a><span class="fu"># Update! Second Age maps scaled to Real World distances!</span></span>
<span id="cb49-875"><a href="#cb49-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-876"><a href="#cb49-876" aria-hidden="true" tabindex="-1"></a>Just kidding! Scaling stuff up doesn't go beyond my skills. We'll do it.</span>
<span id="cb49-877"><a href="#cb49-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-878"><a href="#cb49-878" aria-hidden="true" tabindex="-1"></a>We already converted the data from ME-GIS into Real World miles by doubling all the coordinates centered on Hobbiton, which became the de facto center of the world. We'll do it again here since all those calculations happened way earlier in this post:</span>
<span id="cb49-879"><a href="#cb49-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-880"><a href="#cb49-880" aria-hidden="true" tabindex="-1"></a><span class="in">```{r convert-third-age-to-real-world}</span></span>
<span id="cb49-881"><a href="#cb49-881" aria-hidden="true" tabindex="-1"></a><span class="in"># Load the shapefile</span></span>
<span id="cb49-882"><a href="#cb49-882" aria-hidden="true" tabindex="-1"></a><span class="in">placenames &lt;- read_sf("data/ME-GIS/Combined_Placenames.shp") %&gt;% </span></span>
<span id="cb49-883"><a href="#cb49-883" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(where(is.character), ~iconv(., from = "ISO-8859-1", to = "UTF-8")))</span></span>
<span id="cb49-884"><a href="#cb49-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-885"><a href="#cb49-885" aria-hidden="true" tabindex="-1"></a><span class="in"># Pull out Hobbiton</span></span>
<span id="cb49-886"><a href="#cb49-886" aria-hidden="true" tabindex="-1"></a><span class="in">hobbiton &lt;- placenames %&gt;% filter(NAME == "Hobbiton")</span></span>
<span id="cb49-887"><a href="#cb49-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-888"><a href="#cb49-888" aria-hidden="true" tabindex="-1"></a><span class="in"># Double all the distances</span></span>
<span id="cb49-889"><a href="#cb49-889" aria-hidden="true" tabindex="-1"></a><span class="in">places_ta_scaled &lt;- placenames %&gt;%</span></span>
<span id="cb49-890"><a href="#cb49-890" aria-hidden="true" tabindex="-1"></a><span class="in">  # Take the existing coordinates, subtract the doubled Hobbiton coordinates,</span></span>
<span id="cb49-891"><a href="#cb49-891" aria-hidden="true" tabindex="-1"></a><span class="in">  # and add the Hobbiton coordinates</span></span>
<span id="cb49-892"><a href="#cb49-892" aria-hidden="true" tabindex="-1"></a><span class="in">  st_set_geometry((st_geometry(.) - st_geometry(hobbiton)) * 2 + st_geometry(hobbiton)) %&gt;%</span></span>
<span id="cb49-893"><a href="#cb49-893" aria-hidden="true" tabindex="-1"></a><span class="in">  st_set_crs(st_crs(placenames))</span></span>
<span id="cb49-894"><a href="#cb49-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-895"><a href="#cb49-895" aria-hidden="true" tabindex="-1"></a><span class="in"># Confirm that it's 458 miles between Hobbiton and Rivendell</span></span>
<span id="cb49-896"><a href="#cb49-896" aria-hidden="true" tabindex="-1"></a><span class="in">hobbiton_ta &lt;- places_ta_scaled %&gt;% filter(NAME == "Hobbiton")</span></span>
<span id="cb49-897"><a href="#cb49-897" aria-hidden="true" tabindex="-1"></a><span class="in">rivendell_ta &lt;- places_ta_scaled %&gt;% filter(NAME == "Rivendell")</span></span>
<span id="cb49-898"><a href="#cb49-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-899"><a href="#cb49-899" aria-hidden="true" tabindex="-1"></a><span class="in"># Use set_units() just for fun since st_distance returns the units as metadata</span></span>
<span id="cb49-900"><a href="#cb49-900" aria-hidden="true" tabindex="-1"></a><span class="in">st_distance(hobbiton_ta, rivendell_ta) %&gt;% units::set_units("miles")</span></span>
<span id="cb49-901"><a href="#cb49-901" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-902"><a href="#cb49-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-903"><a href="#cb49-903" aria-hidden="true" tabindex="-1"></a>The Second Age data doesn't have Hobbiton in it since Hobbits didn't exist yet (you can see the <span class="co">[</span><span class="ot">Harfoots</span><span class="co">](https://lotr.fandom.com/wiki/Harfoots)</span>, Amazon's version of proto-Hobbits, in *The Rings of Power*), but it does have Bree, which is a village near the Shire.</span>
<span id="cb49-904"><a href="#cb49-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-905"><a href="#cb49-905" aria-hidden="true" tabindex="-1"></a>So first, we'll find the distance between Bree and Rivendell:</span>
<span id="cb49-906"><a href="#cb49-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-907"><a href="#cb49-907" aria-hidden="true" tabindex="-1"></a><span class="in">```{r bree-to-rivendell-ta}</span></span>
<span id="cb49-908"><a href="#cb49-908" aria-hidden="true" tabindex="-1"></a><span class="in">bree_ta &lt;- places_ta_scaled %&gt;% filter(NAME == "Bree")</span></span>
<span id="cb49-909"><a href="#cb49-909" aria-hidden="true" tabindex="-1"></a><span class="in">bree_to_rivendell_ta &lt;- st_distance(bree_ta, rivendell_ta)</span></span>
<span id="cb49-910"><a href="#cb49-910" aria-hidden="true" tabindex="-1"></a><span class="in">bree_to_rivendell_ta %&gt;% units::set_units("miles")</span></span>
<span id="cb49-911"><a href="#cb49-911" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-912"><a href="#cb49-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-913"><a href="#cb49-913" aria-hidden="true" tabindex="-1"></a>360 miles. Lovely.</span>
<span id="cb49-914"><a href="#cb49-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-915"><a href="#cb49-915" aria-hidden="true" tabindex="-1"></a>Next, let's see how far apart Bree and Rivendell are in the Arda-Maps Second Age map. We'll reload the data and convert the projection to use the same CRS as the ME-GIS map so that things are comparable.</span>
<span id="cb49-916"><a href="#cb49-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-917"><a href="#cb49-917" aria-hidden="true" tabindex="-1"></a><span class="in">```{r find-distances-second-age}</span></span>
<span id="cb49-918"><a href="#cb49-918" aria-hidden="true" tabindex="-1"></a><span class="in">sa_cities &lt;- read_sf("data/Arda-Maps/QGIS/second age/arda2/point_city.shp") %&gt;% </span></span>
<span id="cb49-919"><a href="#cb49-919" aria-hidden="true" tabindex="-1"></a><span class="in">  st_transform(st_crs(placenames))</span></span>
<span id="cb49-920"><a href="#cb49-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-921"><a href="#cb49-921" aria-hidden="true" tabindex="-1"></a><span class="in">rivendell_sa &lt;- sa_cities %&gt;% filter(eventname == "Rivendell")</span></span>
<span id="cb49-922"><a href="#cb49-922" aria-hidden="true" tabindex="-1"></a><span class="in">bree_sa &lt;- sa_cities %&gt;% filter(eventname == "Bree")</span></span>
<span id="cb49-923"><a href="#cb49-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-924"><a href="#cb49-924" aria-hidden="true" tabindex="-1"></a><span class="in">bree_to_rivendell_sa &lt;- st_distance(bree_sa, rivendell_sa)</span></span>
<span id="cb49-925"><a href="#cb49-925" aria-hidden="true" tabindex="-1"></a><span class="in">bree_to_rivendell_sa %&gt;% units::set_units("miles")</span></span>
<span id="cb49-926"><a href="#cb49-926" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-927"><a href="#cb49-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-928"><a href="#cb49-928" aria-hidden="true" tabindex="-1"></a>Hahaha, in this tiny map, it's only a sixth of a mile between Bree and Rivendell. Assuming there are 2,000 steps in a mile, that's only 333 steps, which is just a little more than what Fitbits and Apple Watches try to make you do over the course of an hour. </span>
<span id="cb49-929"><a href="#cb49-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-930"><a href="#cb49-930" aria-hidden="true" tabindex="-1"></a>We need to turn this sixth of a mile into 360 miles, which involves dividing by… something. I always forget how to rescale things, so I find it helpful to write out the algebra for it:</span>
<span id="cb49-931"><a href="#cb49-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-932"><a href="#cb49-932" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb49-933"><a href="#cb49-933" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb49-934"><a href="#cb49-934" aria-hidden="true" tabindex="-1"></a>0.1666x &amp;= 360 <span class="sc">\\</span></span>
<span id="cb49-935"><a href="#cb49-935" aria-hidden="true" tabindex="-1"></a>x &amp;= \frac{360}{0.1666} <span class="sc">\\</span></span>
<span id="cb49-936"><a href="#cb49-936" aria-hidden="true" tabindex="-1"></a>x &amp;= 2160\text{ish}</span>
<span id="cb49-937"><a href="#cb49-937" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb49-938"><a href="#cb49-938" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb49-939"><a href="#cb49-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-940"><a href="#cb49-940" aria-hidden="true" tabindex="-1"></a>If we multiply everything in the Second Age map data by 2160ish, we should be good. First we'll get the official, more precise number (since we're missing decimals in the quick algebra above):</span>
<span id="cb49-941"><a href="#cb49-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-942"><a href="#cb49-942" aria-hidden="true" tabindex="-1"></a><span class="in">```{r find-sa-to-ta-conversion-factor}</span></span>
<span id="cb49-943"><a href="#cb49-943" aria-hidden="true" tabindex="-1"></a><span class="in">sa_to_ta_conversion &lt;- as.numeric(bree_to_rivendell_ta / bree_to_rivendell_sa)</span></span>
<span id="cb49-944"><a href="#cb49-944" aria-hidden="true" tabindex="-1"></a><span class="in">sa_to_ta_conversion</span></span>
<span id="cb49-945"><a href="#cb49-945" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-946"><a href="#cb49-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-947"><a href="#cb49-947" aria-hidden="true" tabindex="-1"></a>Next we'll scale up the Second Age map data, using Bree as the central reference point:</span>
<span id="cb49-948"><a href="#cb49-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-949"><a href="#cb49-949" aria-hidden="true" tabindex="-1"></a><span class="in">```{r convert-second-age-to-real-world}</span></span>
<span id="cb49-950"><a href="#cb49-950" aria-hidden="true" tabindex="-1"></a><span class="in">sa_cities_scaled &lt;- sa_cities %&gt;% </span></span>
<span id="cb49-951"><a href="#cb49-951" aria-hidden="true" tabindex="-1"></a><span class="in">  st_set_geometry((st_geometry(.) - st_geometry(bree_sa)) * sa_to_ta_conversion + st_geometry(bree_sa)) %&gt;% </span></span>
<span id="cb49-952"><a href="#cb49-952" aria-hidden="true" tabindex="-1"></a><span class="in">  st_set_crs(st_crs(placenames))</span></span>
<span id="cb49-953"><a href="#cb49-953" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-954"><a href="#cb49-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-955"><a href="#cb49-955" aria-hidden="true" tabindex="-1"></a>Finally let's make sure it worked. We're looking for 360 miles:</span>
<span id="cb49-956"><a href="#cb49-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-957"><a href="#cb49-957" aria-hidden="true" tabindex="-1"></a><span class="in">```{r check-second-age-conversion}</span></span>
<span id="cb49-958"><a href="#cb49-958" aria-hidden="true" tabindex="-1"></a><span class="in">rivendell_sa_scaled &lt;- sa_cities_scaled %&gt;% filter(eventname == "Rivendell")</span></span>
<span id="cb49-959"><a href="#cb49-959" aria-hidden="true" tabindex="-1"></a><span class="in">bree_sa_scaled &lt;- sa_cities_scaled %&gt;% filter(eventname == "Bree")</span></span>
<span id="cb49-960"><a href="#cb49-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-961"><a href="#cb49-961" aria-hidden="true" tabindex="-1"></a><span class="in">st_distance(bree_sa_scaled, rivendell_sa_scaled) %&gt;% units::set_units("miles")</span></span>
<span id="cb49-962"><a href="#cb49-962" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-963"><a href="#cb49-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-964"><a href="#cb49-964" aria-hidden="true" tabindex="-1"></a>It worked!</span>
<span id="cb49-965"><a href="#cb49-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-966"><a href="#cb49-966" aria-hidden="true" tabindex="-1"></a>Now we can plot this thing. Since we're working with a different projection, the bounding box (<span class="in">`numenor_box`</span>) that we previously made for cropping the shapefiles won't work. But we can be even more precise by extracting the bounding box from the Númenor outlines and then using *that* as the cropping box.</span>
<span id="cb49-967"><a href="#cb49-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-968"><a href="#cb49-968" aria-hidden="true" tabindex="-1"></a>Also, we'll add some more layers to the map for fun, but because this rescaling business can get repetitive and tedious, we'll make a little function to cut down on repetition.</span>
<span id="cb49-969"><a href="#cb49-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-970"><a href="#cb49-970" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load-convert-second-age-data, warning=FALSE}</span></span>
<span id="cb49-971"><a href="#cb49-971" aria-hidden="true" tabindex="-1"></a><span class="in">numenor_outlines &lt;- read_sf("data/Arda-Maps/QGIS/second age/arda2/poly_outline.shp") %&gt;% </span></span>
<span id="cb49-972"><a href="#cb49-972" aria-hidden="true" tabindex="-1"></a><span class="in">  st_transform(st_crs(placenames)) %&gt;% </span></span>
<span id="cb49-973"><a href="#cb49-973" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(name == "Numenor")</span></span>
<span id="cb49-974"><a href="#cb49-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-975"><a href="#cb49-975" aria-hidden="true" tabindex="-1"></a><span class="in"># Extract the bounds for Númenor so we can crop everything else with it</span></span>
<span id="cb49-976"><a href="#cb49-976" aria-hidden="true" tabindex="-1"></a><span class="in">numenor_bbox &lt;- st_bbox(numenor_outlines)</span></span>
<span id="cb49-977"><a href="#cb49-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-978"><a href="#cb49-978" aria-hidden="true" tabindex="-1"></a><span class="in"># Little helper function to scale things from the Second Age to the real world</span></span>
<span id="cb49-979"><a href="#cb49-979" aria-hidden="true" tabindex="-1"></a><span class="in">scale_sa_to_real_world &lt;- function(x) {</span></span>
<span id="cb49-980"><a href="#cb49-980" aria-hidden="true" tabindex="-1"></a><span class="in">  x %&gt;% </span></span>
<span id="cb49-981"><a href="#cb49-981" aria-hidden="true" tabindex="-1"></a><span class="in">    st_set_geometry((st_geometry(.) - st_geometry(bree_sa)) * as.numeric(sa_to_ta_conversion) + st_geometry(bree_sa)) %&gt;% </span></span>
<span id="cb49-982"><a href="#cb49-982" aria-hidden="true" tabindex="-1"></a><span class="in">    st_set_crs(st_crs(placenames))</span></span>
<span id="cb49-983"><a href="#cb49-983" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb49-984"><a href="#cb49-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-985"><a href="#cb49-985" aria-hidden="true" tabindex="-1"></a><span class="in">numenor_outlines_scaled &lt;- numenor_outlines %&gt;% </span></span>
<span id="cb49-986"><a href="#cb49-986" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_sa_to_real_world()</span></span>
<span id="cb49-987"><a href="#cb49-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-988"><a href="#cb49-988" aria-hidden="true" tabindex="-1"></a><span class="in">numenor_rivers_scaled &lt;- read_sf("data/Arda-Maps/QGIS/second age/arda2/line_river.shp") %&gt;% </span></span>
<span id="cb49-989"><a href="#cb49-989" aria-hidden="true" tabindex="-1"></a><span class="in">  st_transform(st_crs(placenames)) %&gt;% </span></span>
<span id="cb49-990"><a href="#cb49-990" aria-hidden="true" tabindex="-1"></a><span class="in">  st_crop(numenor_bbox) %&gt;% </span></span>
<span id="cb49-991"><a href="#cb49-991" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_sa_to_real_world()</span></span>
<span id="cb49-992"><a href="#cb49-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-993"><a href="#cb49-993" aria-hidden="true" tabindex="-1"></a><span class="in">numenor_cities_scaled &lt;- read_sf("data/Arda-Maps/QGIS/second age/arda2/point_city.shp") %&gt;% </span></span>
<span id="cb49-994"><a href="#cb49-994" aria-hidden="true" tabindex="-1"></a><span class="in">  st_transform(st_crs(placenames)) %&gt;% </span></span>
<span id="cb49-995"><a href="#cb49-995" aria-hidden="true" tabindex="-1"></a><span class="in">  st_crop(numenor_bbox) %&gt;% </span></span>
<span id="cb49-996"><a href="#cb49-996" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_sa_to_real_world()</span></span>
<span id="cb49-997"><a href="#cb49-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-998"><a href="#cb49-998" aria-hidden="true" tabindex="-1"></a><span class="in">numenor_forests_scaled &lt;- read_sf("data/Arda-Maps/QGIS/second age/arda2/poly_forest.shp") %&gt;% </span></span>
<span id="cb49-999"><a href="#cb49-999" aria-hidden="true" tabindex="-1"></a><span class="in">  st_transform(st_crs(placenames)) %&gt;% </span></span>
<span id="cb49-1000"><a href="#cb49-1000" aria-hidden="true" tabindex="-1"></a><span class="in">  st_crop(numenor_bbox) %&gt;% </span></span>
<span id="cb49-1001"><a href="#cb49-1001" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_sa_to_real_world()</span></span>
<span id="cb49-1002"><a href="#cb49-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-1003"><a href="#cb49-1003" aria-hidden="true" tabindex="-1"></a><span class="in">numenor_highlands_scaled &lt;- read_sf("data/Arda-Maps/QGIS/second age/arda2/poly_highland.shp") %&gt;% </span></span>
<span id="cb49-1004"><a href="#cb49-1004" aria-hidden="true" tabindex="-1"></a><span class="in">  st_transform(st_crs(placenames)) %&gt;% </span></span>
<span id="cb49-1005"><a href="#cb49-1005" aria-hidden="true" tabindex="-1"></a><span class="in">  st_crop(numenor_bbox) %&gt;% </span></span>
<span id="cb49-1006"><a href="#cb49-1006" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_sa_to_real_world()</span></span>
<span id="cb49-1007"><a href="#cb49-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-1008"><a href="#cb49-1008" aria-hidden="true" tabindex="-1"></a><span class="in">numenor_regions_scaled &lt;- read_sf("data/Arda-Maps/QGIS/second age/arda2/poly_region.shp") %&gt;% </span></span>
<span id="cb49-1009"><a href="#cb49-1009" aria-hidden="true" tabindex="-1"></a><span class="in">  st_transform(st_crs(placenames)) %&gt;% </span></span>
<span id="cb49-1010"><a href="#cb49-1010" aria-hidden="true" tabindex="-1"></a><span class="in">  st_crop(numenor_bbox) %&gt;% </span></span>
<span id="cb49-1011"><a href="#cb49-1011" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_sa_to_real_world()</span></span>
<span id="cb49-1012"><a href="#cb49-1012" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-1013"><a href="#cb49-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-1014"><a href="#cb49-1014" aria-hidden="true" tabindex="-1"></a>Mapping time!</span>
<span id="cb49-1015"><a href="#cb49-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-1016"><a href="#cb49-1016" aria-hidden="true" tabindex="-1"></a><span class="in">```{r numenor-map-correct, warning=FALSE, fig.width=6.5, fig.height=6, out.width="100%"}</span></span>
<span id="cb49-1017"><a href="#cb49-1017" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Correctly scaled fancy map of Númenor"</span></span>
<span id="cb49-1018"><a href="#cb49-1018" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: "Correctly scaled fancy map of Númenor"</span></span>
<span id="cb49-1019"><a href="#cb49-1019" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb49-1020"><a href="#cb49-1020" aria-hidden="true" tabindex="-1"></a><span class="in">  # Background of the island</span></span>
<span id="cb49-1021"><a href="#cb49-1021" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = numenor_outlines_scaled, linewidth = 0, fill = "#F2CB9B") +</span></span>
<span id="cb49-1022"><a href="#cb49-1022" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = numenor_forests_scaled, </span></span>
<span id="cb49-1023"><a href="#cb49-1023" aria-hidden="true" tabindex="-1"></a><span class="in">          linewidth = 0, fill = clr_green, alpha = 0.4) +</span></span>
<span id="cb49-1024"><a href="#cb49-1024" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = numenor_highlands_scaled, </span></span>
<span id="cb49-1025"><a href="#cb49-1025" aria-hidden="true" tabindex="-1"></a><span class="in">          linewidth = 0, fill = colorspace::darken("#F2CB9B", 0.1)) +</span></span>
<span id="cb49-1026"><a href="#cb49-1026" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = numenor_rivers_scaled, linewidth = 0.4, color = clr_blue) +</span></span>
<span id="cb49-1027"><a href="#cb49-1027" aria-hidden="true" tabindex="-1"></a><span class="in">  # Region borders</span></span>
<span id="cb49-1028"><a href="#cb49-1028" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = numenor_regions_scaled, linewidth = 0.2, linetype = "33", fill = NA) +</span></span>
<span id="cb49-1029"><a href="#cb49-1029" aria-hidden="true" tabindex="-1"></a><span class="in">  # Island borders to cover up the dotted region lines on the coast</span></span>
<span id="cb49-1030"><a href="#cb49-1030" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = numenor_outlines_scaled, linewidth = 0.25, fill = NA) +</span></span>
<span id="cb49-1031"><a href="#cb49-1031" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf_text(data = filter(numenor_regions_scaled, eventname != "Mittalmar"), </span></span>
<span id="cb49-1032"><a href="#cb49-1032" aria-hidden="true" tabindex="-1"></a><span class="in">               aes(label = eventname),</span></span>
<span id="cb49-1033"><a href="#cb49-1033" aria-hidden="true" tabindex="-1"></a><span class="in">               family = "Overpass Heavy", size = 5, color = "grey30") +</span></span>
<span id="cb49-1034"><a href="#cb49-1034" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf_text(data = filter(numenor_regions_scaled, eventname == "Mittalmar"), </span></span>
<span id="cb49-1035"><a href="#cb49-1035" aria-hidden="true" tabindex="-1"></a><span class="in">               aes(label = eventname),</span></span>
<span id="cb49-1036"><a href="#cb49-1036" aria-hidden="true" tabindex="-1"></a><span class="in">               family = "Overpass Heavy", size = 5, color = "grey30",</span></span>
<span id="cb49-1037"><a href="#cb49-1037" aria-hidden="true" tabindex="-1"></a><span class="in">               nudge_y = miles_to_meters(30)) +</span></span>
<span id="cb49-1038"><a href="#cb49-1038" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_sf(data = numenor_cities_scaled) +</span></span>
<span id="cb49-1039"><a href="#cb49-1039" aria-hidden="true" tabindex="-1"></a><span class="in">  ggrepel::geom_label_repel(</span></span>
<span id="cb49-1040"><a href="#cb49-1040" aria-hidden="true" tabindex="-1"></a><span class="in">    data = numenor_cities_scaled, </span></span>
<span id="cb49-1041"><a href="#cb49-1041" aria-hidden="true" tabindex="-1"></a><span class="in">    aes(label = eventname, geometry = geometry),</span></span>
<span id="cb49-1042"><a href="#cb49-1042" aria-hidden="true" tabindex="-1"></a><span class="in">    stat = "sf_coordinates", seed = 1234,</span></span>
<span id="cb49-1043"><a href="#cb49-1043" aria-hidden="true" tabindex="-1"></a><span class="in">    family = "Overpass ExtraBold") +</span></span>
<span id="cb49-1044"><a href="#cb49-1044" aria-hidden="true" tabindex="-1"></a><span class="in">  annotation_scale(location = "tl", bar_cols = c("grey30", "white"),</span></span>
<span id="cb49-1045"><a href="#cb49-1045" aria-hidden="true" tabindex="-1"></a><span class="in">                   text_family = "Overpass",</span></span>
<span id="cb49-1046"><a href="#cb49-1046" aria-hidden="true" tabindex="-1"></a><span class="in">                   unit_category = "imperial",</span></span>
<span id="cb49-1047"><a href="#cb49-1047" aria-hidden="true" tabindex="-1"></a><span class="in">                   width_hint = 0.3) +</span></span>
<span id="cb49-1048"><a href="#cb49-1048" aria-hidden="true" tabindex="-1"></a><span class="in">  annotation_north_arrow(</span></span>
<span id="cb49-1049"><a href="#cb49-1049" aria-hidden="true" tabindex="-1"></a><span class="in">    location = "tl", pad_y = unit(1.5, "lines"),</span></span>
<span id="cb49-1050"><a href="#cb49-1050" aria-hidden="true" tabindex="-1"></a><span class="in">    style = north_arrow_fancy_orienteering(fill = c("grey30", "white"), </span></span>
<span id="cb49-1051"><a href="#cb49-1051" aria-hidden="true" tabindex="-1"></a><span class="in">                                           line_col = "grey30",</span></span>
<span id="cb49-1052"><a href="#cb49-1052" aria-hidden="true" tabindex="-1"></a><span class="in">                                           text_family = "Overpass")) +</span></span>
<span id="cb49-1053"><a href="#cb49-1053" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Númenor") +</span></span>
<span id="cb49-1054"><a href="#cb49-1054" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void() +</span></span>
<span id="cb49-1055"><a href="#cb49-1055" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(plot.background = element_rect(fill = "#bacdf7"),</span></span>
<span id="cb49-1056"><a href="#cb49-1056" aria-hidden="true" tabindex="-1"></a><span class="in">        plot.title = element_text(family = "Aniron", size = rel(2), </span></span>
<span id="cb49-1057"><a href="#cb49-1057" aria-hidden="true" tabindex="-1"></a><span class="in">                                  hjust = 0.02))</span></span>
<span id="cb49-1058"><a href="#cb49-1058" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-1059"><a href="#cb49-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-1060"><a href="#cb49-1060" aria-hidden="true" tabindex="-1"></a>We can compare it with Karen Wynn Fonstad's map of Númenor from page 43 in <span class="co">[</span><span class="ot">*Atlas of Middle-earth*</span><span class="co">](https://www.amazon.com/Atlas-Middle-Earth-Revised-Karen-Fonstad/dp/0618126996)</span> and the scaling all seems correct—the island is about 600 miles wide in both the book and in the data.</span>
<span id="cb49-1061"><a href="#cb49-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-1062"><a href="#cb49-1062" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fonstad-numenor, echo=FALSE, out.width="100%"}</span></span>
<span id="cb49-1063"><a href="#cb49-1063" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Karen Wynn Fonstad's map of Númenor"</span></span>
<span id="cb49-1064"><a href="#cb49-1064" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: "Karen Wynn Fonstad's map of Númenor"</span></span>
<span id="cb49-1065"><a href="#cb49-1065" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("img/numenor-fonstad.png")</span></span>
<span id="cb49-1066"><a href="#cb49-1066" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-1067"><a href="#cb49-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-1068"><a href="#cb49-1068" aria-hidden="true" tabindex="-1"></a>Success!</span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p><span class="faux-block"><i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> 2007–2024 Andrew Heiss</span> <span class="faux-block">All content licensed under<br><a href="https://creativecommons.org/licenses/by/4.0/"><i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> <i class="fa-brands fa-creative-commons-by" aria-label="creative-commons-by"></i> Creative Commons CC BY 4.0</a></span></p>
</div>   
    <div class="nav-footer-center">
<p><span class="faux-block"><i class="fa-brands fa-orcid" aria-label="orcid"></i> <strong>ORCID</strong> <a href="https://orcid.org/0000-0002-3948-3914">0000-0002-3948-3914</a></span> <span class="faux-block"><i class="fa-solid fa-key" aria-label="key"></i> <a href="../../../../../pgp_ath.asc.txt">PGP public key</a>   <i class="fa-solid fa-fingerprint" aria-label="fingerprint"></i> Fingerprint:<br><span class="fingerprint">4AA2 FA83 A8B2 05A4 E30F<br> 610D 1382 6216 9178 36AB</span></span></p>
</div>
    <div class="nav-footer-right">
<p><span class="faux-block">Made with <i class="fa-brands fa-r-project" aria-label="r-project"></i> and <a href="https://quarto.org/">Quarto</a></span> <span class="faux-block"><a href="https://github.com/andrewheiss/ath-quarto">View the source at <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></span></p>
</div>
  </div>
</footer>


</body></html>