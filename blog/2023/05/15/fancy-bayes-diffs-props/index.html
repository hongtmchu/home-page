<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Andrew Heiss">
<meta name="description" content="Use R, Stan, and {brms} to calculate differences between categorical proportions in a principled Bayesian way">
<title>A guide to Bayesian proportion tests with R and {brms} | Andrew Heiss – Andrew Heiss</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../../">
<link href="../../../../..//files/favicon-512.png" rel="icon" type="image/png">
<script src="../../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting-17c909d5fd25ae21b861c0c7a49b2096.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../site_libs/bootstrap/bootstrap-5cd0811f461c8271ae6bab49df9501be.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script src="../../../../../site_libs/quarto-contrib/iconify-2.0.0/iconify-icon.min.js"></script><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-527449-5', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script><style>

      .quarto-title-block .quarto-title-banner {
        background: #170C3A;
      }
</style>
<script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
<meta property="og:title" content="A guide to Bayesian proportion tests with R and {brms} | Andrew Heiss">
<meta property="og:description" content="Use R, Stan, and {brms} to calculate differences between categorical proportions in a principled Bayesian way">
<meta property="og:image" content="https://www.andrewheiss.com/blog/2023/05/15/fancy-bayes-diffs-props/index_files/figure-html/q2-plot-final-1.png">
<meta property="og:site_name" content="Andrew Heiss">
<meta property="og:locale" content="en_US">
<meta property="og:image:height" content="864">
<meta property="og:image:width" content="1872">
<meta name="twitter:title" content="A guide to Bayesian proportion tests with R and {brms} | Andrew Heiss">
<meta name="twitter:description" content="Use R, Stan, and {brms} to calculate differences between categorical proportions in a principled Bayesian way">
<meta name="twitter:image" content="https://www.andrewheiss.com/blog/2023/05/15/fancy-bayes-diffs-props/index_files/figure-html/q2-plot-final-1.png">
<meta name="twitter:creator" content="@andrewheiss">
<meta name="twitter:site" content="@andrewheiss">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image-height" content="864">
<meta name="twitter:image-width" content="1872">
</head>
<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../../index.html">
    <span class="navbar-title">Andrew Heiss</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../../../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../cv/index.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../research/index.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../teaching/index.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../talks/index.html"> 
<span class="menu-text">Talks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../now/index.html"> 
<span class="menu-text">Now</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../uses/index.html"> 
<span class="menu-text">Uses</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../../../../../atom.xml"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:rss" style="font-size: 1.1em;" aria-label="Icon rss from bi Iconify.design set." title="RSS"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="mailto:aheiss@gsu.edu"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:envelope" style="font-size: 1.1em;" aria-label="Icon envelope from bi Iconify.design set." title="E-mail"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://bsky.app/profile/andrew.heiss.phd" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="fa6-brands:bluesky" style="font-size: 1.1em;" aria-label="Icon bluesky from fa6-brands Iconify.design set." title="Bluesky"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://fediscience.org/users/andrew/" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:mastodon" style="font-size: 1.1em;" aria-label="Icon mastodon from bi Iconify.design set." title="Mastodon"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/andrewheiss" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:github" style="font-size: 1.1em;" aria-label="Icon github from bi Iconify.design set." title="GitHub"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.youtube.com/andrewheiss" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:youtube" style="font-size: 1.1em;" aria-label="Icon youtube from bi Iconify.design set." title="YouTube"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.heissatopia.com/"> 
<span class="menu-text"><iconify-icon inline="" icon="fa6-brands:blogger" style="font-size: 1.15em;" aria-label="Icon blogger from fa6-brands Iconify.design set." title="Blogger"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/andrewheiss" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:linkedin" style="font-size: 1.1em;" aria-label="Icon linkedin from bi Iconify.design set." title="LinkedIn"></iconify-icon></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default blog-post page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">A guide to Bayesian proportion tests with R and {brms}</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                  <div>
        <div class="description">
          Use R, Stan, and {brms} to calculate differences between categorical proportions in a principled Bayesian way
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">r</div>
                <div class="quarto-category">tidyverse</div>
                <div class="quarto-category">ggplot</div>
                <div class="quarto-category">bayes</div>
                <div class="quarto-category">brms</div>
                <div class="quarto-category">stan</div>
                <div class="quarto-category">surveys</div>
                <div class="quarto-category">categorical data</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://www.andrewheiss.com/">Andrew Heiss</a> <a href="https://orcid.org/0000-0002-3948-3914" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">Monday, May 15, 2023</p>
      </div>
    </div>
    
      
      <div>
      <div class="quarto-title-meta-heading">Doi</div>
      <div class="quarto-title-meta-contents">
        <p class="doi">
          <a href="https://doi.org/10.59350/kw2gj-kw740">10.59350/kw2gj-kw740</a>
        </p>
      </div>
    </div>
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Contents</h2>
   
  <ul>
<li><a href="#who-this-post-is-for" id="toc-who-this-post-is-for" class="nav-link active" data-scroll-target="#who-this-post-is-for">Who this post is for</a></li>
  <li><a href="#wrangling-and-exploring-the-data" id="toc-wrangling-and-exploring-the-data" class="nav-link" data-scroll-target="#wrangling-and-exploring-the-data">Wrangling and exploring the data</a></li>
  <li><a href="#the-questions" id="toc-the-questions" class="nav-link" data-scroll-target="#the-questions">The questions</a></li>
  <li>
<a href="#question-1-comic-book-readership-in-the-us-vs.-mexico" id="toc-question-1-comic-book-readership-in-the-us-vs.-mexico" class="nav-link" data-scroll-target="#question-1-comic-book-readership-in-the-us-vs.-mexico">Question 1: Comic book readership in the US vs.&nbsp;Mexico</a>
  <ul class="collapse">
<li><a href="#estimand" id="toc-estimand" class="nav-link" data-scroll-target="#estimand">Estimand</a></li>
  <li><a href="#classically" id="toc-classically" class="nav-link" data-scroll-target="#classically">Classically</a></li>
  <li>
<a href="#bayesianly-with-stan" id="toc-bayesianly-with-stan" class="nav-link" data-scroll-target="#bayesianly-with-stan">Bayesianly with Stan</a>
  <ul class="collapse">
<li><a href="#why-bayesian-modeling" id="toc-why-bayesian-modeling" class="nav-link" data-scroll-target="#why-bayesian-modeling">Why Bayesian modeling?</a></li>
  <li><a href="#formal-model" id="toc-formal-model" class="nav-link" data-scroll-target="#formal-model">Formal model</a></li>
  <li><a href="#basic-stan-model" id="toc-basic-stan-model" class="nav-link" data-scroll-target="#basic-stan-model">Basic Stan model</a></li>
  <li><a href="#stan-model-improvements" id="toc-stan-model-improvements" class="nav-link" data-scroll-target="#stan-model-improvements">Stan model improvements</a></li>
  </ul>
</li>
  <li>
<a href="#bayesianly-with-brms" id="toc-bayesianly-with-brms" class="nav-link" data-scroll-target="#bayesianly-with-brms">Bayesianly with {brms}</a>
  <ul class="collapse">
<li><a href="#counts-and-trials-as-formula-outcomes" id="toc-counts-and-trials-as-formula-outcomes" class="nav-link" data-scroll-target="#counts-and-trials-as-formula-outcomes">Counts and trials as formula outcomes</a></li>
  <li><a href="#binomial-model-with-logistic-link" id="toc-binomial-model-with-logistic-link" class="nav-link" data-scroll-target="#binomial-model-with-logistic-link">Binomial model with logistic link</a></li>
  <li><a href="#binomial-model-with-identity-link" id="toc-binomial-model-with-identity-link" class="nav-link" data-scroll-target="#binomial-model-with-identity-link">Binomial model with identity link</a></li>
  <li><a href="#intercept-free-binomial-model-with-identity-link" id="toc-intercept-free-binomial-model-with-identity-link" class="nav-link" data-scroll-target="#intercept-free-binomial-model-with-identity-link">Intercept-free binomial model with identity link</a></li>
  <li><a href="#actual-beta-binomial-model" id="toc-actual-beta-binomial-model" class="nav-link" data-scroll-target="#actual-beta-binomial-model">Actual beta-binomial model</a></li>
  </ul>
</li>
  <li><a href="#final-answer-to-the-question" id="toc-final-answer-to-the-question" class="nav-link" data-scroll-target="#final-answer-to-the-question">Final answer to the question</a></li>
  </ul>
</li>
  <li>
<a href="#question-2-frequency-of-newspaper-readership-in-the-us" id="toc-question-2-frequency-of-newspaper-readership-in-the-us" class="nav-link" data-scroll-target="#question-2-frequency-of-newspaper-readership-in-the-us">Question 2: Frequency of newspaper readership in the US</a>
  <ul class="collapse">
<li><a href="#estimand-1" id="toc-estimand-1" class="nav-link" data-scroll-target="#estimand-1">Estimand</a></li>
  <li><a href="#bayesianly-with-brms-1" id="toc-bayesianly-with-brms-1" class="nav-link" data-scroll-target="#bayesianly-with-brms-1">Bayesianly with {brms}</a></li>
  <li><a href="#better-fill-colors" id="toc-better-fill-colors" class="nav-link" data-scroll-target="#better-fill-colors">Better fill colors</a></li>
  <li><a href="#final-answer-to-the-question-1" id="toc-final-answer-to-the-question-1" class="nav-link" data-scroll-target="#final-answer-to-the-question-1">Final answer to the question</a></li>
  </ul>
</li>
  </ul></nav>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content"><div class="cell" data-layout-align="center">
<style type="text/css">
.magic-block {
  font-style: normal;
  user-select: none;
  padding: 0 0.1em 0 0.15em;
  line-height: 1;
  font-size: 120%;
}
</style>
</div>
<p>I’ve been working on converting a couple of my dissertation chapters into standalone articles, so I’ve been revisiting and improving my older R code. As part of my dissertation work, I ran a global survey of international NGOs to see how they adjust their programs and strategies when working under authoritarian legal restrictions in dictatorship. In the survey, I asked a bunch of questions with categorical responses (like “How would you characterize your organization’s relationship with your host-country government?”, with the possible responses “Positive,” “Negative”, and “Neither”).</p>
<p>Analyzing this kind of categorical data can be tricky. What I ended up doing (and what people typically do) is looking at the differences in proportions of responses (i.e.&nbsp;is there a substantial difference in the proportion reporting “Positive” or “Negative” in different subgroups?). But doing this requires a little bit of extra work because of how proportions work. We can’t just treat proportions like continuous values. Denominators matter and help determine the level of uncertainty in the proportions. We need to account for these disparate sample sizes underlying the proportions.</p>
<p>Additionally, it’s tempting to treat <a href="https://en.wikipedia.org/wiki/Likert_scale">Likert scale responses</a><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> (i.e.&nbsp;things like “strongly agree”, “agree”, “neutral”, etc.) as numbers (e.g.&nbsp;make “strongly agree” a 2, “agree” a 1, “neutral” a 0, and so on), and then find things like averages (e.g.&nbsp;“the average response is a 1.34”), but those summary statistics aren’t actually that accurate. What would a 1.34 mean? A little higher than agree? What does that even mean?</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;Pronounced “lick-ert”!</p></div></div><p>We need to treat these kinds of survey questions as the categories that they are, which requires a different set of analytical tools than just findings averages and running linear regressions. We instead need to use things like frequencies, proportions, <a href="https://en.wikipedia.org/wiki/Contingency_table">contingency tables and crosstabs</a>, and fancier regression like ordered logistic models.</p>
<p>I’m a fan of Bayesian statistical inference—I find it way more intuitive and straightforward than frequentist null hypothesis testing. I first “converted” to Bayesianism back when I first analyzed my dissertation data in 2017 and used the newly-invented <a href="https://mc-stan.org/rstanarm/">{rstanarm} package</a> to calculate the difference in proportions of my various survey responses in Bayesian ways, based on <a href="https://www.sumsar.net/blog/2014/06/bayesian-first-aid-prop-test/">a blog post and package for Bayesian proportion tests by Rasmus Bååth</a>. He used <a href="https://mcmc-jags.sourceforge.io/">JAGS</a>, though, and I prefer to use <a href="https://mc-stan.org/">Stan</a>, hence my use of {rstanarm} back then.</p>
<p>Since 2017, though, I’ve learned a lot more about Bayesianism. I’ve <a href="https://bayesf22.classes.andrewheiss.com/">worked</a> <a href="https://bayesf22-notebook.classes.andrewheiss.com/">through</a> both <a href="https://xcelab.net/rm/statistical-rethinking/">Richard McElreath’s <em>Statistical Rethinking</em></a> and <a href="https://www.bayesrulesbook.com/">the gloriously accessible <em>Bayes Rules!</em></a>, and I no longer use {rstanarm}. I instead use <a href="https://paul-buerkner.github.io/brms/">{brms}</a> for everything (or raw Stan if I’m feeling extra fancy).</p>
<p>So, as a reference for myself while rewriting these chapters, and as a way to consolidate everything I’ve learned about Bayesian-flavored proportion tests, here’s a guide to thinking about differences in proportions in a principled Bayesian way. I explore two different questions (explained in detail below). For the first one I’ll be super pedagogical and long-winded, showing how to find differences in proportions with classical frequentist statistical tests, with different variations of Stan code, and with different variations of {brms} code. For the second one I’ll be less pedagogical and just show the code and results.</p>
<section id="who-this-post-is-for" class="level1"><h1>Who this post is for</h1>
<p>Here’s what I assume you know:</p>
<ul>
<li>You’re familiar with <a href="https://www.r-project.org/">R</a> and the <a href="https://www.tidyverse.org/">tidyverse</a> (particularly <a href="https://dplyr.tidyverse.org/">{dplyr}</a> and <a href="https://ggplot2.tidyverse.org/">{ggplot2}</a>).</li>
<li>You’re familiar with <a href="https://paul-buerkner.github.io/brms/">{brms}</a> for running Bayesian regression models and <a href="https://mjskay.github.io/tidybayes/">{tidybayes}</a> and <a href="https://mjskay.github.io/ggdist/">{ggdist}</a> for manipulating and plotting posterior draws</li>
</ul></section><section id="wrangling-and-exploring-the-data" class="level1 page-columns page-full"><h1>Wrangling and exploring the data</h1>
<p>Before getting started, let’s load all the packages we need and create some helpful functions and variables:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>    <span class="co"># ggplot, dplyr, and friends</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://gt.rstudio.com">gt</a></span><span class="op">)</span>           <span class="co"># Fancy tables</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://glue.tidyverse.org/">glue</a></span><span class="op">)</span>         <span class="co"># Easier string interpolation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org">scales</a></span><span class="op">)</span>       <span class="co"># Nicer labeling functions</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/haleyjeppson/ggmosaic">ggmosaic</a></span><span class="op">)</span>     <span class="co"># Mosaic plots with ggplot</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/trevorld/ggpattern">ggpattern</a></span><span class="op">)</span>    <span class="co"># Pattern fills in ggplot</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span>    <span class="co"># Combine plots nicely</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/parameters/">parameters</a></span><span class="op">)</span>   <span class="co"># Extract model parameters as data frames</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">cmdstanr</span><span class="op">)</span>     <span class="co"># Run Stan code from R</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms">brms</a></span><span class="op">)</span>         <span class="co"># Nice frontend for Stan</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/tidybayes/">tidybayes</a></span><span class="op">)</span>    <span class="co"># Manipulate MCMC chains in a tidy way</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://jason.bryer.org/likert">likert</a></span><span class="op">)</span>       <span class="co"># Contains the pisaitems data</span></span>
<span></span>
<span><span class="co"># Use the cmdstanr backend for brms because it's faster and more modern than the</span></span>
<span><span class="co"># default rstan backend. You need to install the cmdstanr package first</span></span>
<span><span class="co"># (https://mc-stan.org/cmdstanr/) and then run cmdstanr::install_cmdstan() to</span></span>
<span><span class="co"># install cmdstan on your computer.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fl">4</span>,</span>
<span>        brms.backend <span class="op">=</span> <span class="st">"cmdstanr"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set some global Stan options</span></span>
<span><span class="va">CHAINS</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">ITER</span> <span class="op">&lt;-</span> <span class="fl">2000</span></span>
<span><span class="va">WARMUP</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">BAYES_SEED</span> <span class="op">&lt;-</span> <span class="fl">1234</span></span>
<span></span>
<span><span class="co"># Custom ggplot theme to make pretty plots</span></span>
<span><span class="co"># Get the font at https://fonts.google.com/specimen/Jost</span></span>
<span><span class="va">theme_nice</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span>base_family <span class="op">=</span> <span class="st">"Jost"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>          plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Jost"</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>          axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Jost Medium"</span><span class="op">)</span>,</span>
<span>          axis.title.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>          axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>          strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Jost"</span>, face <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>                                    size <span class="op">=</span> <span class="fu">rel</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>          strip.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Function for formatting axes as percentage points</span></span>
<span><span class="va">label_pp</span> <span class="op">&lt;-</span> <span class="fu">label_number</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">1</span>, scale <span class="op">=</span> <span class="fl">100</span>, </span>
<span>                         suffix <span class="op">=</span> <span class="st">" pp."</span>, style_negative <span class="op">=</span> <span class="st">"minus"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Throughout this guide, we’ll use data from the 2009 <a href="https://en.wikipedia.org/wiki/Programme_for_International_Student_Assessment">Programme of International Student Assessment (PISA) survey</a>, which is available in the <a href="https://github.com/jbryer/likert">{likert} package</a>. PISA is administered every three years to 15-year-old students in dozens of countries, and it tracks academic performance, outcomes, and student attitudes cross-nationally.</p>
<p>One of the questions on the <a href="https://www.oecd.org/pisa/pisaproducts/PISA09_Student_questionnaire.pdf">PISA student questionnaire</a> (Q25) asks respondents how often they read different types of materials:</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="img/pisa.png" class="img-fluid figure-img"></p>
<figcaption class="margin-caption">2009 PISA Q25</figcaption></figure>
</div>
<p>The excerpt of PISA data included in the {likert} package only includes responses from Canada, Mexico, and the United States, and for this question it seems to omit data from Canada, so we’ll compare the reading frequencies of American and Mexican students. Specifically we’ll look at how these students read comic books and newspapers. My wife is currently finishing her masters thesis on religious representation in graphic novels, and I’m a fan of comics in general, so it’ll be interesting to see how students in the two countries read these books. We’ll look at newspapers because it’s an interesting category with some helpful variation (reading trends for magazines, fiction, and nonfiction look basically the same in both countries so we’ll ignore them here.)</p>
<p>First we’ll load and clean the data. For the sake of illustration in this post, I collapse the five possible responses into just three:</p>
<ul>
<li>Rarely = Never or almost never</li>
<li>Sometimes = A few times a year &amp; About once a month</li>
<li>Often = Several times a month &amp; Several times a week</li>
</ul>
<p>In real life it’s typically a bad idea to collapse categories like this, and I’m not an education researcher so this collapsing is probably bad and wrong, but whatever—just go with it :)</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"pisaitems"</span>, package <span class="op">=</span> <span class="st">"likert"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make a clean wide version of the data</span></span>
<span><span class="va">reading_wide</span> <span class="op">&lt;-</span> <span class="va">pisaitems</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># Add ID column</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># Only keep a few columns</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">id</span>, country <span class="op">=</span> <span class="va">CNT</span>, `Comic books` <span class="op">=</span> <span class="va">ST25Q02</span>, Newspapers <span class="op">=</span> <span class="va">ST25Q05</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># Collapse these categories</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">`Comic books`</span>, <span class="va">Newspapers</span><span class="op">)</span>, </span>
<span>                <span class="op">~</span><span class="fu">fct_collapse</span><span class="op">(</span></span>
<span>                  <span class="va">.</span>,</span>
<span>                  <span class="st">"Rarely"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Never or almost never"</span><span class="op">)</span>,</span>
<span>                  <span class="st">"Sometimes"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A few times a year"</span>, <span class="st">"About once a month"</span><span class="op">)</span>,</span>
<span>                  <span class="st">"Often"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Several times a month"</span>, <span class="st">"Several times a week"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># Make sure the new categories are ordered correctly</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">`Comic books`</span>, <span class="va">Newspapers</span><span class="op">)</span>, </span>
<span>                <span class="op">~</span><span class="fu">fct_relevel</span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Rarely"</span>, <span class="st">"Sometimes"</span>, <span class="st">"Often"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># Only keep the US and Mexico and get rid of the empty Canada level</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"United States"</span>, <span class="st">"Mexico"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>country <span class="op">=</span> <span class="fu">fct_drop</span><span class="op">(</span><span class="va">country</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">reading_wide</span><span class="op">)</span></span>
<span><span class="co">##      id country Comic books Newspapers</span></span>
<span><span class="co">## 1 23208  Mexico   Sometimes      Often</span></span>
<span><span class="co">## 2 23209  Mexico      Rarely      Often</span></span>
<span><span class="co">## 3 23210  Mexico       Often      Often</span></span>
<span><span class="co">## 4 23211  Mexico   Sometimes  Sometimes</span></span>
<span><span class="co">## 5 23212  Mexico      Rarely      Often</span></span>
<span><span class="co">## 6 23213  Mexico   Sometimes  Sometimes</span></span>
<span></span>
<span><span class="co"># Make a tidy (long) version</span></span>
<span><span class="va">reading</span> <span class="op">&lt;-</span> <span class="va">reading_wide</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">country</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"book_type"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"frequency"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">drop_na</span><span class="op">(</span><span class="va">frequency</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">reading</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 6 × 4</span></span>
<span><span class="co">##      id country book_type   frequency</span></span>
<span><span class="co">##   &lt;int&gt; &lt;fct&gt;   &lt;chr&gt;       &lt;fct&gt;    </span></span>
<span><span class="co">## 1 23208 Mexico  Comic books Sometimes</span></span>
<span><span class="co">## 2 23208 Mexico  Newspapers  Often    </span></span>
<span><span class="co">## 3 23209 Mexico  Comic books Rarely   </span></span>
<span><span class="co">## 4 23209 Mexico  Newspapers  Often    </span></span>
<span><span class="co">## 5 23210 Mexico  Comic books Often    </span></span>
<span><span class="co">## 6 23210 Mexico  Newspapers  Often</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Since we created a tidy (long) version of the data, we can use {dplyr} to create some overall group summaries of reading frequency by type of material across countries. Having data in this format, with a column for the specific total (i.e.&nbsp;Mexico + Comic books + Rarely, and so on, or <code>n</code> here) and the overall country total (or <code>total</code> here), allows us to calculate group proportions (<code>n / total</code>):</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">reading_counts</span> <span class="op">&lt;-</span> <span class="va">reading</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">country</span>, <span class="va">book_type</span>, <span class="va">frequency</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span>n <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">country</span>, <span class="va">book_type</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,</span>
<span>         prop <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">reading_counts</span></span>
<span><span class="co">## # A tibble: 12 × 6</span></span>
<span><span class="co">##    country       book_type   frequency     n total  prop</span></span>
<span><span class="co">##    &lt;fct&gt;         &lt;chr&gt;       &lt;fct&gt;     &lt;int&gt; &lt;int&gt; &lt;dbl&gt;</span></span>
<span><span class="co">##  1 Mexico        Comic books Rarely     9897 37641 0.263</span></span>
<span><span class="co">##  2 Mexico        Comic books Sometimes 17139 37641 0.455</span></span>
<span><span class="co">##  3 Mexico        Comic books Often     10605 37641 0.282</span></span>
<span><span class="co">##  4 Mexico        Newspapers  Rarely     6812 37794 0.180</span></span>
<span><span class="co">##  5 Mexico        Newspapers  Sometimes 12369 37794 0.327</span></span>
<span><span class="co">##  6 Mexico        Newspapers  Often     18613 37794 0.492</span></span>
<span><span class="co">##  7 United States Comic books Rarely     3237  5142 0.630</span></span>
<span><span class="co">##  8 United States Comic books Sometimes  1381  5142 0.269</span></span>
<span><span class="co">##  9 United States Comic books Often       524  5142 0.102</span></span>
<span><span class="co">## 10 United States Newspapers  Rarely     1307  5172 0.253</span></span>
<span><span class="co">## 11 United States Newspapers  Sometimes  1925  5172 0.372</span></span>
<span><span class="co">## 12 United States Newspapers  Often      1940  5172 0.375</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And we can do a little pivoting and formatting and make this nice little contingency table / crosstab summarizing the data across the two countries:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fancy_table</span> <span class="op">&lt;-</span> <span class="va">reading_counts</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>nice <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"{prop}&lt;br&gt;&lt;span style='font-size:70%'&gt;({n})&lt;/span&gt;"</span>,</span>
<span>                     prop <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="va">prop</span><span class="op">)</span>,</span>
<span>                     n <span class="op">=</span> <span class="fu">label_comma</span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">n</span>, <span class="op">-</span><span class="va">prop</span>, <span class="op">-</span><span class="va">total</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="st">"frequency"</span>,</span>
<span>              values_from <span class="op">=</span> <span class="st">"nice"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">gt</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">cols_label</span><span class="op">(</span></span>
<span>    book_type <span class="op">=</span> <span class="st">""</span>,</span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">fmt_markdown</span><span class="op">(</span></span>
<span>    columns <span class="op">=</span> <span class="fu">everything</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">opt_horizontal_padding</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">opt_table_font</span><span class="op">(</span>font <span class="op">=</span> <span class="st">"Fira Sans"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tab_options</span><span class="op">(</span>column_labels.font.weight <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>              row_group.font.weight <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span></span>
<span><span class="va">fancy_table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fontnxdduh" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#fontnxdduh table {
  font-family: 'Fira Sans', system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#fontnxdduh thead, #fontnxdduh tbody, #fontnxdduh tfoot, #fontnxdduh tr, #fontnxdduh td, #fontnxdduh th {
  border-style: none;
}

#fontnxdduh p {
  margin: 0;
  padding: 0;
}

#fontnxdduh .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#fontnxdduh .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#fontnxdduh .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 15px;
  padding-right: 15px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#fontnxdduh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 15px;
  padding-right: 15px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#fontnxdduh .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fontnxdduh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fontnxdduh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fontnxdduh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 15px;
  padding-right: 15px;
  overflow-x: hidden;
}

#fontnxdduh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#fontnxdduh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#fontnxdduh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#fontnxdduh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#fontnxdduh .gt_spanner_row {
  border-bottom-style: hidden;
}

#fontnxdduh .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#fontnxdduh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#fontnxdduh .gt_from_md > :first-child {
  margin-top: 0;
}

#fontnxdduh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#fontnxdduh .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#fontnxdduh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 15px;
  padding-right: 15px;
}

#fontnxdduh .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 15px;
  padding-right: 15px;
  vertical-align: top;
}

#fontnxdduh .gt_row_group_first td {
  border-top-width: 2px;
}

#fontnxdduh .gt_row_group_first th {
  border-top-width: 2px;
}

#fontnxdduh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
}

#fontnxdduh .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#fontnxdduh .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#fontnxdduh .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fontnxdduh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
}

#fontnxdduh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#fontnxdduh .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#fontnxdduh .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#fontnxdduh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fontnxdduh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fontnxdduh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 15px;
  padding-right: 15px;
}

#fontnxdduh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fontnxdduh .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 15px;
  padding-right: 15px;
}

#fontnxdduh .gt_left {
  text-align: left;
}

#fontnxdduh .gt_center {
  text-align: center;
}

#fontnxdduh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#fontnxdduh .gt_font_normal {
  font-weight: normal;
}

#fontnxdduh .gt_font_bold {
  font-weight: bold;
}

#fontnxdduh .gt_font_italic {
  font-style: italic;
}

#fontnxdduh .gt_super {
  font-size: 65%;
}

#fontnxdduh .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#fontnxdduh .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#fontnxdduh .gt_indent_1 {
  text-indent: 5px;
}

#fontnxdduh .gt_indent_2 {
  text-indent: 10px;
}

#fontnxdduh .gt_indent_3 {
  text-indent: 15px;
}

#fontnxdduh .gt_indent_4 {
  text-indent: 20px;
}

#fontnxdduh .gt_indent_5 {
  text-indent: 25px;
}

#fontnxdduh .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#fontnxdduh div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead><tr class="gt_col_headings header">
<th class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="Rarely" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Rarely</th>
<th id="Sometimes" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Sometimes</th>
<th id="Often" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Often</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="gt_group_heading_row odd">
<td colspan="4" id="Mexico" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">Mexico</td>
</tr>
<tr class="gt_row_group_first even">
<td class="gt_row gt_left" headers="Mexico  book_type"><p>Comic books</p></td>
<td class="gt_row gt_center" headers="Mexico  Rarely"><p>26.29%<br><span style="font-size:70%">(9,897)</span></p></td>
<td class="gt_row gt_center" headers="Mexico  Sometimes"><p>45.53%<br><span style="font-size:70%">(17,139)</span></p></td>
<td class="gt_row gt_center" headers="Mexico  Often"><p>28.17%<br><span style="font-size:70%">(10,605)</span></p></td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Mexico  book_type"><p>Newspapers</p></td>
<td class="gt_row gt_center" headers="Mexico  Rarely"><p>18.02%<br><span style="font-size:70%">(6,812)</span></p></td>
<td class="gt_row gt_center" headers="Mexico  Sometimes"><p>32.73%<br><span style="font-size:70%">(12,369)</span></p></td>
<td class="gt_row gt_center" headers="Mexico  Often"><p>49.25%<br><span style="font-size:70%">(18,613)</span></p></td>
</tr>
<tr class="gt_group_heading_row even">
<td colspan="4" id="United States" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">United States</td>
</tr>
<tr class="gt_row_group_first odd">
<td class="gt_row gt_left" headers="United States  book_type"><p>Comic books</p></td>
<td class="gt_row gt_center" headers="United States  Rarely"><p>62.95%<br><span style="font-size:70%">(3,237)</span></p></td>
<td class="gt_row gt_center" headers="United States  Sometimes"><p>26.86%<br><span style="font-size:70%">(1,381)</span></p></td>
<td class="gt_row gt_center" headers="United States  Often"><p>10.19%<br><span style="font-size:70%">(524)</span></p></td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="United States  book_type"><p>Newspapers</p></td>
<td class="gt_row gt_center" headers="United States  Rarely"><p>25.27%<br><span style="font-size:70%">(1,307)</span></p></td>
<td class="gt_row gt_center" headers="United States  Sometimes"><p>37.22%<br><span style="font-size:70%">(1,925)</span></p></td>
<td class="gt_row gt_center" headers="United States  Often"><p>37.51%<br><span style="font-size:70%">(1,940)</span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>This table has a lot of numbers and it’s hard to immediately see what’s going on, so we’ll visualize it really quick to get a sense for some of the initial trends. Visualizing this is a little tricky though. It’s easy enough to make a bar chart of the percentages, but doing that is a little misleading. Notice the huge differences in the numbers of respondents here—there are thousands of Mexican students and only hundreds of American students. <a href="https://clauswilke.com/dataviz/nested-proportions.html">We should probably visualize the data in a way that accounts for these different denominators</a>, and percentages by themselves don’t do that.</p>
<p>We can use a <a href="https://en.wikipedia.org/wiki/Mosaic_plot">mosaic plot</a> (also known as a <a href="https://datavizcatalogue.com/methods/marimekko_chart.html">Marimekko chart</a>) to visualize both the distribution of proportions of responses (Rarely, Sometimes, Often) and the proportions of respondents from each country (Mexico and the United States). We can use the <a href="https://haleyjeppson.github.io/ggmosaic/">{ggmosaic} package</a> to create ggplot-flavored mosaic plots:</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Base R works too!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Mosaic plots are actually also built into base R!</p>
<p>Try running <code>plot(table(mtcars$cyl, mtcars$am))</code>.</p>
</div>
</div>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">reading</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_mosaic</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">product</span><span class="op">(</span><span class="va">frequency</span>, <span class="va">country</span><span class="op">)</span>,  <span class="co"># Look at combination of frequency by country</span></span>
<span>                  fill <span class="op">=</span> <span class="va">frequency</span>, alpha <span class="op">=</span> <span class="va">country</span><span class="op">)</span>,</span>
<span>              divider <span class="op">=</span> <span class="fu">mosaic</span><span class="op">(</span><span class="st">"v"</span><span class="op">)</span>,  <span class="co"># Make the plot divide vertically</span></span>
<span>              offset <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"white"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Add thin white border around boxes</span></span>
<span>  <span class="fu">scale_x_productlist</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.02</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Make the x-axis take up almost the full panel width, with 2% spacing on each side</span></span>
<span>  <span class="fu">scale_y_productlist</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Make the y-axis take up the full panel width</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#E51B24"</span>, <span class="st">"#FFDE00"</span>, <span class="st">"#009DDC"</span><span class="op">)</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_alpha_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">1</span><span class="op">)</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">book_type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_nice</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>panel.grid.major.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.major.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        <span class="co"># Using labs(x = NULL) with scale_x_productlist() apparently doesn't</span></span>
<span>        <span class="co"># work, so we can turn off the axis title with theme() instead</span></span>
<span>        axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/plot-mosaic-1.png" class="img-fluid figure-img" style="width:90.0%" alt="Mosaic plot of the proportions of comic book and newspaper reading frequency in the United States and Mexico"></p>
<figcaption class="margin-caption">Mosaic plot of the proportions of comic book and newspaper reading frequency in the United States and Mexico</figcaption></figure>
</div>
</div>
</div>
<p>There are a few quick things to point out here in this plot. The Mexico rectangles are super tall, since there are so many more respondents from Mexico than from the United States. It looks like the majority of American students only rarely read comic books, while their Mexican counterparts do it either sometimes or often. Mexican students also read newspapers a lot more than Americans do, with “Often” the clear most common category. For Americans, the “Sometimes” and “Often” newspaper responses look about the same.</p>
</section><section id="the-questions" class="level1"><h1>The questions</h1>
<p>Throughout this post, I’ll illustrate the logic of Bayesian proportion tests by answering two questions that I had while looking at the contingency table and mosaic plot above:</p>
<ol type="1">
<li>Do students in Mexico read comic books more often than students in the United States? (the <span style="color: #CD8A39"><i class="magic-block" aria-hidden="true">■</i>two yellow cells in the “Often” column</span>)</li>
<li>Do students in the United States vary in their frequency of reading newspapers? (the <span style="color: #009DDC"><i class="magic-block" aria-hidden="true">■</i>blue row for newspapers in the United States</span>)</li>
</ol>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fancy_table</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tab_style</span><span class="op">(</span></span>
<span>    style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      <span class="fu">cell_fill</span><span class="op">(</span>color <span class="op">=</span> <span class="fu">colorspace</span><span class="fu">::</span><span class="fu">lighten</span><span class="op">(</span><span class="st">"#CD8A39"</span>, <span class="fl">0.7</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="fu">cell_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#CD8A39"</span>, weight <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    locations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      <span class="fu">cells_body</span><span class="op">(</span>columns <span class="op">=</span> <span class="st">"Often"</span>, rows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tab_style</span><span class="op">(</span></span>
<span>    style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      <span class="fu">cell_fill</span><span class="op">(</span>color <span class="op">=</span> <span class="fu">colorspace</span><span class="fu">::</span><span class="fu">lighten</span><span class="op">(</span><span class="st">"#009DDC"</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="fu">cell_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#009DDC"</span>, weight <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    locations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      <span class="fu">cells_body</span><span class="op">(</span>columns <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">5</span>, rows <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="wvxmycsrux" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#wvxmycsrux table {
  font-family: 'Fira Sans', system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#wvxmycsrux thead, #wvxmycsrux tbody, #wvxmycsrux tfoot, #wvxmycsrux tr, #wvxmycsrux td, #wvxmycsrux th {
  border-style: none;
}

#wvxmycsrux p {
  margin: 0;
  padding: 0;
}

#wvxmycsrux .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wvxmycsrux .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#wvxmycsrux .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 15px;
  padding-right: 15px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wvxmycsrux .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 15px;
  padding-right: 15px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wvxmycsrux .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wvxmycsrux .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wvxmycsrux .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wvxmycsrux .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 15px;
  padding-right: 15px;
  overflow-x: hidden;
}

#wvxmycsrux .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wvxmycsrux .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wvxmycsrux .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wvxmycsrux .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wvxmycsrux .gt_spanner_row {
  border-bottom-style: hidden;
}

#wvxmycsrux .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#wvxmycsrux .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wvxmycsrux .gt_from_md > :first-child {
  margin-top: 0;
}

#wvxmycsrux .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wvxmycsrux .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wvxmycsrux .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 15px;
  padding-right: 15px;
}

#wvxmycsrux .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 15px;
  padding-right: 15px;
  vertical-align: top;
}

#wvxmycsrux .gt_row_group_first td {
  border-top-width: 2px;
}

#wvxmycsrux .gt_row_group_first th {
  border-top-width: 2px;
}

#wvxmycsrux .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
}

#wvxmycsrux .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#wvxmycsrux .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#wvxmycsrux .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wvxmycsrux .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
}

#wvxmycsrux .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wvxmycsrux .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#wvxmycsrux .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wvxmycsrux .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wvxmycsrux .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wvxmycsrux .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 15px;
  padding-right: 15px;
}

#wvxmycsrux .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wvxmycsrux .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 15px;
  padding-right: 15px;
}

#wvxmycsrux .gt_left {
  text-align: left;
}

#wvxmycsrux .gt_center {
  text-align: center;
}

#wvxmycsrux .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wvxmycsrux .gt_font_normal {
  font-weight: normal;
}

#wvxmycsrux .gt_font_bold {
  font-weight: bold;
}

#wvxmycsrux .gt_font_italic {
  font-style: italic;
}

#wvxmycsrux .gt_super {
  font-size: 65%;
}

#wvxmycsrux .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#wvxmycsrux .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#wvxmycsrux .gt_indent_1 {
  text-indent: 5px;
}

#wvxmycsrux .gt_indent_2 {
  text-indent: 10px;
}

#wvxmycsrux .gt_indent_3 {
  text-indent: 15px;
}

#wvxmycsrux .gt_indent_4 {
  text-indent: 20px;
}

#wvxmycsrux .gt_indent_5 {
  text-indent: 25px;
}

#wvxmycsrux .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#wvxmycsrux div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead><tr class="gt_col_headings header">
<th class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="Rarely" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Rarely</th>
<th id="Sometimes" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Sometimes</th>
<th id="Often" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Often</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="gt_group_heading_row odd">
<td colspan="4" id="Mexico" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">Mexico</td>
</tr>
<tr class="gt_row_group_first even">
<td class="gt_row gt_left" headers="Mexico  book_type"><p>Comic books</p></td>
<td class="gt_row gt_center" headers="Mexico  Rarely"><p>26.29%<br><span style="font-size:70%">(9,897)</span></p></td>
<td class="gt_row gt_center" headers="Mexico  Sometimes"><p>45.53%<br><span style="font-size:70%">(17,139)</span></p></td>
<td class="gt_row gt_center" headers="Mexico  Often" style="background-color: #FFD8BB; color: #CD8A39; font-weight: bold"><p>28.17%<br><span style="font-size:70%">(10,605)</span></p></td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Mexico  book_type"><p>Newspapers</p></td>
<td class="gt_row gt_center" headers="Mexico  Rarely"><p>18.02%<br><span style="font-size:70%">(6,812)</span></p></td>
<td class="gt_row gt_center" headers="Mexico  Sometimes"><p>32.73%<br><span style="font-size:70%">(12,369)</span></p></td>
<td class="gt_row gt_center" headers="Mexico  Often"><p>49.25%<br><span style="font-size:70%">(18,613)</span></p></td>
</tr>
<tr class="gt_group_heading_row even">
<td colspan="4" id="United States" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">United States</td>
</tr>
<tr class="gt_row_group_first odd">
<td class="gt_row gt_left" headers="United States  book_type"><p>Comic books</p></td>
<td class="gt_row gt_center" headers="United States  Rarely"><p>62.95%<br><span style="font-size:70%">(3,237)</span></p></td>
<td class="gt_row gt_center" headers="United States  Sometimes"><p>26.86%<br><span style="font-size:70%">(1,381)</span></p></td>
<td class="gt_row gt_center" headers="United States  Often" style="background-color: #FFD8BB; color: #CD8A39; font-weight: bold"><p>10.19%<br><span style="font-size:70%">(524)</span></p></td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="United States  book_type"><p>Newspapers</p></td>
<td class="gt_row gt_center" headers="United States  Rarely" style="background-color: #D7EBFF; color: #009DDC; font-weight: bold"><p>25.27%<br><span style="font-size:70%">(1,307)</span></p></td>
<td class="gt_row gt_center" headers="United States  Sometimes" style="background-color: #D7EBFF; color: #009DDC; font-weight: bold"><p>37.22%<br><span style="font-size:70%">(1,925)</span></p></td>
<td class="gt_row gt_center" headers="United States  Often" style="background-color: #D7EBFF; color: #009DDC; font-weight: bold"><p>37.51%<br><span style="font-size:70%">(1,940)</span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section><section id="question-1-comic-book-readership-in-the-us-vs.-mexico" class="level1 page-columns page-full"><h1>Question 1: Comic book readership in the US vs.&nbsp;Mexico</h1>
<section id="estimand" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="estimand">Estimand</h2>
<p>For our first question, we want to know if there’s a substantial difference in the proportion of students who read comic books often in the United States and Mexico, or whether the difference between the <span style="color: #CD8A39"><i class="magic-block" aria-hidden="true">■</i>two yellow cells</span> is greater than zero:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fancy_table</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tab_style</span><span class="op">(</span></span>
<span>    style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      <span class="fu">cell_fill</span><span class="op">(</span>color <span class="op">=</span> <span class="fu">colorspace</span><span class="fu">::</span><span class="fu">lighten</span><span class="op">(</span><span class="st">"#CD8A39"</span>, <span class="fl">0.7</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="fu">cell_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#CD8A39"</span>, weight <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    locations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      <span class="fu">cells_body</span><span class="op">(</span>columns <span class="op">=</span> <span class="st">"Often"</span>, rows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="ksyvnhqmyp" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ksyvnhqmyp table {
  font-family: 'Fira Sans', system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ksyvnhqmyp thead, #ksyvnhqmyp tbody, #ksyvnhqmyp tfoot, #ksyvnhqmyp tr, #ksyvnhqmyp td, #ksyvnhqmyp th {
  border-style: none;
}

#ksyvnhqmyp p {
  margin: 0;
  padding: 0;
}

#ksyvnhqmyp .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ksyvnhqmyp .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ksyvnhqmyp .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 15px;
  padding-right: 15px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ksyvnhqmyp .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 15px;
  padding-right: 15px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ksyvnhqmyp .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ksyvnhqmyp .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ksyvnhqmyp .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ksyvnhqmyp .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 15px;
  padding-right: 15px;
  overflow-x: hidden;
}

#ksyvnhqmyp .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ksyvnhqmyp .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ksyvnhqmyp .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ksyvnhqmyp .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ksyvnhqmyp .gt_spanner_row {
  border-bottom-style: hidden;
}

#ksyvnhqmyp .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ksyvnhqmyp .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ksyvnhqmyp .gt_from_md > :first-child {
  margin-top: 0;
}

#ksyvnhqmyp .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ksyvnhqmyp .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ksyvnhqmyp .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 15px;
  padding-right: 15px;
}

#ksyvnhqmyp .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 15px;
  padding-right: 15px;
  vertical-align: top;
}

#ksyvnhqmyp .gt_row_group_first td {
  border-top-width: 2px;
}

#ksyvnhqmyp .gt_row_group_first th {
  border-top-width: 2px;
}

#ksyvnhqmyp .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
}

#ksyvnhqmyp .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ksyvnhqmyp .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ksyvnhqmyp .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ksyvnhqmyp .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
}

#ksyvnhqmyp .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ksyvnhqmyp .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ksyvnhqmyp .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ksyvnhqmyp .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ksyvnhqmyp .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ksyvnhqmyp .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 15px;
  padding-right: 15px;
}

#ksyvnhqmyp .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ksyvnhqmyp .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 15px;
  padding-right: 15px;
}

#ksyvnhqmyp .gt_left {
  text-align: left;
}

#ksyvnhqmyp .gt_center {
  text-align: center;
}

#ksyvnhqmyp .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ksyvnhqmyp .gt_font_normal {
  font-weight: normal;
}

#ksyvnhqmyp .gt_font_bold {
  font-weight: bold;
}

#ksyvnhqmyp .gt_font_italic {
  font-style: italic;
}

#ksyvnhqmyp .gt_super {
  font-size: 65%;
}

#ksyvnhqmyp .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ksyvnhqmyp .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ksyvnhqmyp .gt_indent_1 {
  text-indent: 5px;
}

#ksyvnhqmyp .gt_indent_2 {
  text-indent: 10px;
}

#ksyvnhqmyp .gt_indent_3 {
  text-indent: 15px;
}

#ksyvnhqmyp .gt_indent_4 {
  text-indent: 20px;
}

#ksyvnhqmyp .gt_indent_5 {
  text-indent: 25px;
}

#ksyvnhqmyp .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#ksyvnhqmyp div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead><tr class="gt_col_headings header">
<th class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="Rarely" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Rarely</th>
<th id="Sometimes" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Sometimes</th>
<th id="Often" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Often</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="gt_group_heading_row odd">
<td colspan="4" id="Mexico" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">Mexico</td>
</tr>
<tr class="gt_row_group_first even">
<td class="gt_row gt_left" headers="Mexico  book_type"><p>Comic books</p></td>
<td class="gt_row gt_center" headers="Mexico  Rarely"><p>26.29%<br><span style="font-size:70%">(9,897)</span></p></td>
<td class="gt_row gt_center" headers="Mexico  Sometimes"><p>45.53%<br><span style="font-size:70%">(17,139)</span></p></td>
<td class="gt_row gt_center" headers="Mexico  Often" style="background-color: #FFD8BB; color: #CD8A39; font-weight: bold"><p>28.17%<br><span style="font-size:70%">(10,605)</span></p></td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Mexico  book_type"><p>Newspapers</p></td>
<td class="gt_row gt_center" headers="Mexico  Rarely"><p>18.02%<br><span style="font-size:70%">(6,812)</span></p></td>
<td class="gt_row gt_center" headers="Mexico  Sometimes"><p>32.73%<br><span style="font-size:70%">(12,369)</span></p></td>
<td class="gt_row gt_center" headers="Mexico  Often"><p>49.25%<br><span style="font-size:70%">(18,613)</span></p></td>
</tr>
<tr class="gt_group_heading_row even">
<td colspan="4" id="United States" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">United States</td>
</tr>
<tr class="gt_row_group_first odd">
<td class="gt_row gt_left" headers="United States  book_type"><p>Comic books</p></td>
<td class="gt_row gt_center" headers="United States  Rarely"><p>62.95%<br><span style="font-size:70%">(3,237)</span></p></td>
<td class="gt_row gt_center" headers="United States  Sometimes"><p>26.86%<br><span style="font-size:70%">(1,381)</span></p></td>
<td class="gt_row gt_center" headers="United States  Often" style="background-color: #FFD8BB; color: #CD8A39; font-weight: bold"><p>10.19%<br><span style="font-size:70%">(524)</span></p></td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="United States  book_type"><p>Newspapers</p></td>
<td class="gt_row gt_center" headers="United States  Rarely"><p>25.27%<br><span style="font-size:70%">(1,307)</span></p></td>
<td class="gt_row gt_center" headers="United States  Sometimes"><p>37.22%<br><span style="font-size:70%">(1,925)</span></p></td>
<td class="gt_row gt_center" headers="United States  Often"><p>37.51%<br><span style="font-size:70%">(1,940)</span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>To be more formal about this, we’ll call this estimand <span class="math inline">\(\theta\)</span>, which is the difference between the two proportions <span class="math inline">\(\pi\)</span>:</p>
<p><span class="math display">\[
\theta = \pi_\text{Mexico, comic books, often} - \pi_\text{United States, comic books, often}
\]</span></p>
<p>When visualizing this, we’ll use colors to help communicate the idea of between-group differences. We’ll get fancier with the colors in question 2, where we’ll look at three sets of pairwise differences, but here we’re just looking at a single pairwise difference (the difference between the US and Mexico), so we’ll use a bit of subtle and not-quite-correct color theory. In kindergarten we all learned the <a href="https://en.wikipedia.org/wiki/RYB_color_model">RYB color model</a>, where primary pigments can be mixed to create secondary pigments. For instance</p>
<blockquote class="blockquote">
<p><span style="color: #0074D9"><i class="magic-block" aria-hidden="true">■</i>blue</span> + <span style="color: #FFDC00"><i class="magic-block" aria-hidden="true">■</i>yellow</span> = <span style="color: #2ECC40"><i class="magic-block" aria-hidden="true">■</i>green</span>.</p>
</blockquote>
<p>If we do some (wrong color-theory-wise) algebra, we can rearrange the formula so that</p>
<blockquote class="blockquote">
<p><span style="color: #0074D9"><i class="magic-block" aria-hidden="true">■</i>blue</span> − <span style="color: #2ECC40"><i class="magic-block" aria-hidden="true">■</i>green</span> = <span style="color: #FFDC00"><i class="magic-block" aria-hidden="true">■</i>yellow</span></p>
</blockquote>
<p>If we make the United States <span style="color: #0074D9"><i class="magic-block" aria-hidden="true">■</i>blue</span> and Mexico <span style="color: #2ECC40"><i class="magic-block" aria-hidden="true">■</i>green</span>, the ostensible color for their difference is <span style="color: #FFDC00"><i class="magic-block" aria-hidden="true">■</i>yellow</span>. This is TOTALLY WRONG and <a href="https://xkcd.com/1882/">a lot more complicated</a> according to actual color theory, but it’s a cute and subtle visual cue, so we’ll use it.</p>
<p>These primary colors are a little too bright for my taste though, so let’s artsty them up a bit. We’re looking at data about the US and Mexico, so we’ll use the Saguaro palette from <a href="https://github.com/kevinsblake/NatParksPalettes">the {NatParksPalettes} package</a>, since <a href="https://en.wikipedia.org/wiki/Saguaro_National_Park">Saguaro National Park</a> is near the US-Mexico border and it has a nice blue, yellow, and green.</p>
<p>We’ll use <span style="color: #CD8A39"><i class="magic-block" aria-hidden="true">■</i>yellow for the difference (θ)</span> between the <span style="color: #127088"><i class="magic-block" aria-hidden="true">■</i>United States</span> and <span style="color: #57643C"><i class="magic-block" aria-hidden="true">■</i>Mexico</span>.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p><img src="img/saguaro.jpg" class="img-fluid"></p>
<p><a href="https://www.nps.gov/media/photo/gallery-item.htm?pg=1937068&amp;id=D0458FC7-155D-451F-678551BE57482110&amp;gid=D0377EAB-155D-451F-67573A9D0FD80A08">“Saguaro Fruit Ripens in June”</a> by the <a href="https://www.nps.gov/">US National Park Service</a></p>
</div></div><div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># US/Mexico question colors</span></span>
<span><span class="va">clrs_saguaro</span> <span class="op">&lt;-</span> <span class="fu">NatParksPalettes</span><span class="fu">::</span><span class="fu">natparks.pals</span><span class="op">(</span><span class="st">"Saguaro"</span><span class="op">)</span></span>
<span><span class="va">clr_usa</span> <span class="op">&lt;-</span> <span class="va">clrs_saguaro</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">clr_mex</span> <span class="op">&lt;-</span> <span class="va">clrs_saguaro</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span></span>
<span><span class="va">clr_diff</span> <span class="op">&lt;-</span> <span class="va">clrs_saguaro</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/show-saguaro-pal-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section><section id="classically" class="level2"><h2 class="anchored" data-anchor-id="classically">Classically</h2>
<p>In classical frequentist statistics, there are lots of ways to test for the significance of a difference in proportions of counts, rates, proportions, and other categorical-related things, like chi-squared tests, <a href="https://www.tjmahr.com/bayesian-fisher-exact-test/">Fisher’s exact test</a>, or proportion tests. Each of these tests have special corresponding “flavors” that apply to specific conditions within the data being tested or the estimand being calculated (corrections for sample sizes, etc.). In standard stats classes, you memorize <a href="https://www.google.com/search?q=statistical+test+flow+chart">big flowcharts of possible statistical operations</a> and select the correct one for the situation.</p>
<p>Since we want to test the difference between two group proportions, we’ll use R’s <code><a href="https://rdrr.io/r/stats/prop.test.html">prop.test()</a></code>, which tests the null hypothesis that the proportions in some number of groups are the same:</p>
<p><span class="math display">\[
H_0: \theta = 0
\]</span></p>
<p>Our job with null hypothesis significance testing is to calculate a test statistic (<span class="math inline">\(\chi^2\)</span> in this case) for <span class="math inline">\(\theta\)</span>, determine the probability of seeing that statistic in a world where <span class="math inline">\(\theta\)</span> is actually 0, and infer whether the value we see could plausibly fit in a world where the null hypothesis is true.</p>
<p>We need to feed <code><a href="https://rdrr.io/r/stats/prop.test.html">prop.test()</a></code> either a matrix with a column of counts of successes (students who read comic books often) and failures (students who do not read comic books often) or two separate vectors: one of counts of successes (students who read comic books often) and one of counts of totals (all students). We’ll do it both ways for fun.</p>
<p>First we’ll make a matrix of the counts of students from Mexico and the United States, with columns for the counts of those who read often and of those who don’t read often.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">often_matrix</span> <span class="op">&lt;-</span> <span class="va">reading_counts</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">book_type</span> <span class="op">==</span> <span class="st">"Comic books"</span>, <span class="va">frequency</span> <span class="op">==</span> <span class="st">"Often"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>n_not_often <span class="op">=</span> <span class="va">total</span> <span class="op">-</span> <span class="va">n</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span>n_often <span class="op">=</span> <span class="va">n</span>, <span class="va">n_not_often</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">often_matrix</span></span>
<span><span class="co">##      n_often n_not_often</span></span>
<span><span class="co">## [1,]   10605       27036</span></span>
<span><span class="co">## [2,]     524        4618</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now we can feed that to <code><a href="https://rdrr.io/r/stats/prop.test.html">prop.test()</a></code>:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/prop.test.html">prop.test</a></span><span class="op">(</span><span class="va">often_matrix</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  2-sample test for equality of proportions with continuity correction</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  often_matrix</span></span>
<span><span class="co">## X-squared = 759, df = 1, p-value &lt;2e-16</span></span>
<span><span class="co">## alternative hypothesis: two.sided</span></span>
<span><span class="co">## 95 percent confidence interval:</span></span>
<span><span class="co">##  0.170 0.189</span></span>
<span><span class="co">## sample estimates:</span></span>
<span><span class="co">## prop 1 prop 2 </span></span>
<span><span class="co">##  0.282  0.102</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This gives us some helpful information. The “flavor” of the formal test is a “2-sample test for equality of proportions with continuity correction”, which is fine, I guess.</p>
<p>We have proportions that are the same as what we have in the highlighted cells in the contingency table (28.17% / 10.19%) and we have 95% confidence interval for the difference. Oddly, R doesn’t show the actual difference in these results, but we can see that difference if we use <code>model_parameters()</code> from <a href="https://easystats.github.io/parameters/">the {parameters} package</a> (which is the apparent successor to <code>broom::tidy()</code>?). Here we can see that the difference in proportions is 18 percentage points:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/prop.test.html">prop.test</a></span><span class="op">(</span><span class="va">often_matrix</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">model_parameters</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## 2-sample test for equality of proportions</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Proportion      | Difference |       95% CI | Chi2(1) |      p</span></span>
<span><span class="co">## --------------------------------------------------------------</span></span>
<span><span class="co">## 28.17% / 10.19% |     17.98% | [0.17, 0.19] |  759.26 | &lt; .001</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Alternative hypothesis: two.sided</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And finally we have a test statistic: a <span class="math inline">\(\chi^2\)</span> value of 759.265, which is huge and definitely statistically significant. In a hypothetical world where there’s no difference in the proportions, the probability of seeing a difference of at least 18 percentage points is super tiny (p &lt; 0.001). We have enough evidence to confidently reject the null hypothesis and declare that the proportions of the groups are not the same. With the confidence interval, we can say that we are 95% confident that the interval 0.17–0.189 captures the true population parameter. We can’t say that there’s a 95% chance that the true value falls in this range—we can only talk about the range.</p>
<p>We can also do this without using a matrix by feeding <code><a href="https://rdrr.io/r/stats/prop.test.html">prop.test()</a></code> two vectors: one with counts of people who read comics often and one with counts of total respondents:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">often_values</span> <span class="op">&lt;-</span> <span class="va">reading_counts</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">book_type</span> <span class="op">==</span> <span class="st">"Comic books"</span>, <span class="va">frequency</span> <span class="op">==</span> <span class="st">"Often"</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">n_often</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">often_values</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">]</span>, <span class="va">often_values</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] 10605   524</span></span>
<span><span class="op">(</span><span class="va">n_respondents</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">often_values</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">]</span>, <span class="va">often_values</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] 37641  5142</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/prop.test.html">prop.test</a></span><span class="op">(</span><span class="va">n_often</span>, <span class="va">n_respondents</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  2-sample test for equality of proportions with continuity correction</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  n_often out of n_respondents</span></span>
<span><span class="co">## X-squared = 759, df = 1, p-value &lt;2e-16</span></span>
<span><span class="co">## alternative hypothesis: two.sided</span></span>
<span><span class="co">## 95 percent confidence interval:</span></span>
<span><span class="co">##  0.170 0.189</span></span>
<span><span class="co">## sample estimates:</span></span>
<span><span class="co">## prop 1 prop 2 </span></span>
<span><span class="co">##  0.282  0.102</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The results are the same.</p>
</section><section id="bayesianly-with-stan" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="bayesianly-with-stan">Bayesianly with Stan</h2>
<section id="why-bayesian-modeling" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="why-bayesian-modeling">Why Bayesian modeling?</h3>
<p>I don’t like null hypotheses and I don’t like flowcharts.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p><img src="img/golem.jpg" class="img-fluid"></p>
<p><a href="https://www.flickr.com/photos/botosynthetic/5837348219">“Golem”</a> by <a href="https://www.flickr.com/people/botosynthetic/">smokeghost</a></p>
</div></div><p>Regular classical statistics classes teach about null hypotheses and flowcharts, but there’s a better way. In his magisterial <a href="https://xcelab.net/rm/statistical-rethinking/"><em>Statistical Rethinking</em></a>, Richard McElreath <a href="https://www.youtube.com/watch?v=cclUd_HoRlo">describes how in legends people created mythological clay robots called golems that could protect cities from attacks</a>, but that could also spin out of control and wreak all sorts of havoc. McElreath uses the idea of golems as a metaphor for classical statistical models focused on null hypothesis significance testing, which also consist of powerful quasi-alchemical procedures that have to be followed precisely with specific flowcharts:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="img/golem-flowchart.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="margin-caption">Statistical models as golems (slide 9 in <a href="https://speakerdeck.com/rmcelreath/statistical-rethinking-2022-lecture-01?slide=9">Statistical Rethinking 2022 Lecture 01</a>)</figcaption></figure>
</div>
</div>
</div>
<p>McElreath argues that this golem-based approach to statistics is incredibly limiting, since (1) you have to choose the right test, and if it doesn’t exist, you have to wait for some fancy statistician to invent it, and (2) you have to focus on rejecting null hypotheses instead of exploring research hypotheses.</p>
<p>For instance, in the null hypothesis framework section above, this was the actual question undergirding the analysis:</p>
<blockquote class="blockquote">
<p>In a hypothetical world where <span class="math inline">\(\theta = 0\)</span> (or where there’s no difference between the proportions) what’s the probability that this one-time collection of data fits in that world—and if the probability is low, is there enough evidence to confidently reject that hypothetical world of no difference?</p>
</blockquote>
<p>oof. We set our <code><a href="https://rdrr.io/r/stats/prop.test.html">prop.test()</a></code> golem to work and got a p-value for the probability of seeing the 18 percentage point difference in a world where there’s actually no difference. That p-value was low, so we confidently declared <span class="math inline">\(\theta\)</span> to be statistically significant and not zero. But that was it. We rejected the null world. Yay. But that doesn’t say much about our main research hypothesis. Boo.</p>
<p>Our <em>actual</em> main question is far simpler:</p>
<blockquote class="blockquote">
<p>Given the data here, what’s the probability that there’s no difference between the proportions, or that <span class="math inline">\(\theta \neq 0\)</span>?</p>
</blockquote>
<p>Bayesian-flavored statistics lets us answer this question and avoid null hypotheses and convoluted inference. Instead of calculating the probability of seeing some data given a null hypothesis (<span class="math inline">\(P(\text{Data} \mid H_0)\)</span>), we can use <a href="https://en.wikipedia.org/wiki/Bayesian_inference">Bayesian inference</a> to calculate the probability of a hypothesis given some data (<span class="math inline">\(P(\theta \neq 0 \mid \text{Data})\)</span>).</p>
</section><section id="formal-model" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="formal-model">Formal model</h3>
<p>So instead of thinking about a specific statistical golem, we can think about modeling the data-generating process that could create the counts and proportions that we see in the PISA data.</p>
<p>Remember that our data looks like this, with <code>n</code> showing a count of the people who read comic books often in each country and <code>total</code> showing a count of the people who responded to the question.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">reading_counts</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">book_type</span> <span class="op">==</span> <span class="st">"Comic books"</span>, <span class="va">frequency</span> <span class="op">==</span> <span class="st">"Often"</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 2 × 6</span></span>
<span><span class="co">##   country       book_type   frequency     n total  prop</span></span>
<span><span class="co">##   &lt;fct&gt;         &lt;chr&gt;       &lt;fct&gt;     &lt;int&gt; &lt;int&gt; &lt;dbl&gt;</span></span>
<span><span class="co">## 1 Mexico        Comic books Often     10605 37641 0.282</span></span>
<span><span class="co">## 2 United States Comic books Often       524  5142 0.102</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The actual process for generating that <code>n</code> involved asking thousands of individual, independent people if they read comic books often. If someone says yes, it’s counted as a “success” (or marked as “often”); if they say no, it’s not marked as “often”. It’s a binary choice repeated across thousands of independent questions, or “trials.” There’s also an underlying overall probability for reporting “often,” which corresponds to the proportion of people selecting it.</p>
<p>The official statistical term for this kind of data-generating processes (a bunch of independent trials with some probability of success) is a <a href="https://en.wikipedia.org/wiki/Binomial_distribution">binomial distribution</a>, and it’s defined like this, with three parameters:</p>
<p><span class="math display">\[
y \sim \operatorname{Binomial}(n, \pi)
\]</span></p>
<ol type="1">
<li>Number of successes (<span class="math inline">\(y\)</span>: the number of people responding yes to “often,” or <code>n</code> in our data</li>
<li>Probability of success (<span class="math inline">\(\pi\)</span>): the probability someone says yes to “often,” or the thing we want to model for each country</li>
<li>Number of trials (<span class="math inline">\(n\)</span>): the total number of people asked the question, or <code>total</code> in our data</li>
</ol>
<p>The number of successes and trials are just integers—they’re counts—and we already know those, since they’re in the data. The probability of success <span class="math inline">\(\pi\)</span> is a percentage and ranges somewhere between 0 and 1. We don’t know this value, but we can estimate it with Bayesian methods by defining a prior and a likelihood, churning through a bunch of Monte Carlo Markov Chain (MCMC) simulations, and finding a posterior distribution of <span class="math inline">\(\pi\)</span>.</p>
<p>We can use a Beta distribution to model <span class="math inline">\(\pi\)</span>, since Beta distributions are naturally bound between 0 and 1 and they work well for probability-scale things. Beta distributions are defined by two parameters: (1) <span class="math inline">\(\alpha\)</span> or <span class="math inline">\(a\)</span> or <code>shape1</code> in R and (2) <span class="math inline">\(\beta\)</span> or <span class="math inline">\(b\)</span> or <code>shape2</code> in R. <a href="https://www.andrewheiss.com/blog/2021/11/08/beta-regression-guide/#beta-distributions-and-shape-parameters">See this section of my blog post</a> on zero-inflated Beta regression for way more details about how these parameters work and what they mean.</p>
<p>Super quickly, we’re interested in the probability of a “success” (or where “often” is yes), which is the number of “often”s divided by the total number of responses:</p>
<p><span class="math display">\[
\frac{\text{Number of successes}}{\text{Number of trials}}
\]</span></p>
<p>or</p>
<p><span class="math display">\[
\frac{\text{Number of often = yes}}{\text{Number of responses}}
\]</span></p>
<p>We can separate that denominator into two parts:</p>
<p><span class="math display">\[
\frac{\text{Number of often = yes}}{(\text{Number of often = yes}) + (\text{Number of often } \neq \text{yes})}
\]</span></p>
<p>The <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> parameters correspond to the counts of successes and failures::</p>
<p><span class="math display">\[
\frac{\alpha}{\alpha + \beta}
\]</span></p>
<p>With these two shape parameters, we can create any percentage or fraction we want. We can also control the uncertainty of the distribution by tinkering with the scale of the parameters. For instance, if we think there’s a 40% chance of something happening, this could be represented with <span class="math inline">\(\alpha = 4\)</span> and <span class="math inline">\(\beta = 6\)</span>, since <span class="math inline">\(\frac{4}{4 + 6} = 0.4\)</span>. We could also write it as <span class="math inline">\(\alpha = 40\)</span> and <span class="math inline">\(\beta = 60\)</span>, since <span class="math inline">\(\frac{40}{40 + 60} = 0.4\)</span> too. Both are centered at 40%, but Beta(40, 60) is a lot narrower and less uncertain.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">dbeta</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">4</span>, <span class="fl">6</span><span class="op">)</span>, geom <span class="op">=</span> <span class="st">"area"</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Beta(4, 6)"</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">dbeta</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">40</span>, <span class="fl">60</span><span class="op">)</span>, geom <span class="op">=</span> <span class="st">"area"</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Beta(40, 60)"</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Beta(4, 6)"</span> <span class="op">=</span> <span class="st">"#FFDC00"</span>,</span>
<span>                               <span class="st">"Beta(40, 60)"</span> <span class="op">=</span> <span class="st">"#F012BE"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"π"</span>, y <span class="op">=</span> <span class="cn">NULL</span>, fill <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_nice</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/plot-beta-example-1.png" class="img-fluid figure-img" style="width:90.0%" alt="Beta(4, 6) and Beta(40, 60) distributions"></p>
<figcaption class="margin-caption">Beta(4, 6) and Beta(40, 60) distributions</figcaption></figure>
</div>
</div>
</div>
<p>We’ve already seen the data and know that the proportion of students who read comic books often is 10ish% in the United States and 30ish% in Mexico, but we’ll cheat and say that we think that around 25% of students read comic books often, ± some big amount. This implies something like a Beta(2, 6) distribution (since <span class="math inline">\(\frac{2}{2+6} = 0.25\)</span>), with lots of low possible values, but not a lot of <span class="math inline">\(\pi\)</span>s are above 50%. We could narrow this down by scaling up the parameters (like Beta(20, 60) or Beta(10, 40), etc.), but leaving the prior distribution of <span class="math inline">\(\pi\)</span> wide like this allows for more possible responses (maybe 75% of students in one country read comic books often!).</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">dbeta</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">2</span>, <span class="fl">6</span><span class="op">)</span>, geom <span class="op">=</span> <span class="st">"area"</span>, fill <span class="op">=</span> <span class="st">"#AC3414"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Possible values for π"</span>, y <span class="op">=</span> <span class="cn">NULL</span>, fill <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_nice</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/plot-beta-prior-1.png" class="img-fluid figure-img" style="width:90.0%" alt="Prior distribution for π using Beta(2, 6)"></p>
<figcaption class="margin-caption">Prior distribution for π using Beta(2, 6)</figcaption></figure>
</div>
</div>
</div>
<p>Okay, so with our Beta(2, 6) prior, we now have all the information we need to specify the official formal model of the data generating process for our estimand <span class="math inline">\(\theta\)</span> without any flowchart golems or null hypotheses:</p>
<p><span class="math display">\[
\begin{aligned}
&amp;\ \textbf{Estimand} \\
\theta =&amp;\ \pi_{\text{comic books, often}_\text{Mexico}} - \pi_{\text{comic books, often}_\text{US}} \\[10pt]
&amp;\ \textbf{Beta-binomial model for Mexico} \\
y_{n \text{ comic books, often}_\text{Mexico}} \sim&amp;\ \operatorname{Binomial}(n_{\text{Total students}_\text{Mexico}}, \pi_{\text{comic books, often}_\text{Mexico}}) \\
\pi_{\text{comic books, often}_\text{Mexico}} \sim&amp;\ \operatorname{Beta}(\alpha_\text{Mexico}, \beta_\text{Mexico}) \\[10pt]
&amp;\ \textbf{Beta-binomial model for the United States} \\
y_{n \text{ comic books, often}_\text{US}} \sim&amp;\ \operatorname{Binomial}(n_{\text{Total students}_\text{US}}, \pi_{\text{comic books, often}_\text{US}}) \\
\pi_{\text{comic books, often}_\text{US}} \sim&amp;\ \operatorname{Beta}(\alpha_\text{US}, \beta_\text{US}) \\[10pt]
&amp;\ \textbf{Priors} \\
\alpha_\text{Mexico}, \alpha_\text{US} =&amp;\ 2 \\
\beta_\text{Mexico}, \beta_\text{US} =&amp;\ 6
\end{aligned}
\]</span></p>
</section><section id="basic-stan-model" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="basic-stan-model">Basic Stan model</h3>
<p>The neat thing about Stan is that it translates fairly directly from this mathematical model notation into code. Here we’ll define three different blocks in a Stan program:</p>
<ol type="1">
<li>Data that gets fed into the model, or the counts of respondents (or <span class="math inline">\(y\)</span> and <span class="math inline">\(n\)</span>)</li>
<li>Parameters to estimate, or <span class="math inline">\(\pi_\text{US}\)</span> and <span class="math inline">\(\pi_\text{Mexico}\)</span>
</li>
<li>The prior and model for estimating those parameters, or <span class="math inline">\(\operatorname{Beta}(2, 6)\)</span> and <span class="math inline">\(y \sim \operatorname{Binomial}(n, \pi)\)</span>
</li>
</ol>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>props-basic.stan</strong></pre>
</div>
<div class="sourceCode" id="cb16" data-filename="props-basic.stan"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stuff from R</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; often_us;</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; total_us;</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; often_mexico;</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; total_mexico;</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Things to estimate</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>, <span class="kw">upper</span>=<span class="dv">1</span>&gt; pi_us;</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>, <span class="kw">upper</span>=<span class="dv">1</span>&gt; pi_mexico;</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Prior and likelihood</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  pi_us ~ beta(<span class="dv">2</span>, <span class="dv">6</span>);</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  pi_mexico ~ beta(<span class="dv">2</span>, <span class="dv">6</span>);</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  often_us ~ binomial(total_us, pi_us);</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  often_mexico ~ binomial(total_mexico, pi_mexico);</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using {cmdstanr} as our interface with Stan, we first have to compile the script into an executable file:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_props_basic</span> <span class="op">&lt;-</span> <span class="fu">cmdstan_model</span><span class="op">(</span><span class="st">"props-basic.stan"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can then feed it a list of data and run a bunch of MCMC chains:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">often_values</span> <span class="op">&lt;-</span> <span class="va">reading_counts</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">book_type</span> <span class="op">==</span> <span class="st">"Comic books"</span>, <span class="va">frequency</span> <span class="op">==</span> <span class="st">"Often"</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">n_often</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">often_values</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">]</span>, <span class="va">often_values</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] 10605   524</span></span>
<span><span class="op">(</span><span class="va">n_respondents</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">often_values</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">]</span>, <span class="va">often_values</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] 37641  5142</span></span>
<span></span>
<span><span class="va">props_basic_samples</span> <span class="op">&lt;-</span> <span class="va">model_props_basic</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>often_us <span class="op">=</span> <span class="va">n_often</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>              total_us <span class="op">=</span> <span class="va">n_respondents</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>              often_mexico <span class="op">=</span> <span class="va">n_often</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>              total_mexico <span class="op">=</span> <span class="va">n_respondents</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="va">CHAINS</span>, iter_warmup <span class="op">=</span> <span class="va">WARMUP</span>, iter_sampling <span class="op">=</span> <span class="op">(</span><span class="va">ITER</span> <span class="op">-</span> <span class="va">WARMUP</span><span class="op">)</span>, seed <span class="op">=</span> <span class="va">BAYES_SEED</span>,</span>
<span>  refresh <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## Running MCMC with 4 parallel chains...</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Chain 1 finished in 0.0 seconds.</span></span>
<span><span class="co">## Chain 2 finished in 0.0 seconds.</span></span>
<span><span class="co">## Chain 3 finished in 0.0 seconds.</span></span>
<span><span class="co">## Chain 4 finished in 0.0 seconds.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## All 4 chains finished successfully.</span></span>
<span><span class="co">## Mean chain execution time: 0.0 seconds.</span></span>
<span><span class="co">## Total execution time: 0.3 seconds.</span></span>
<span></span>
<span><span class="va">props_basic_samples</span><span class="op">$</span><span class="fu">print</span><span class="op">(</span></span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"pi_us"</span>, <span class="st">"pi_mexico"</span><span class="op">)</span>, </span>
<span>  <span class="st">"mean"</span>, <span class="st">"median"</span>, <span class="st">"sd"</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">.x</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">##   variable mean median   sd 2.5% 97.5%</span></span>
<span><span class="co">##  pi_us     0.10   0.10 0.00 0.09  0.11</span></span>
<span><span class="co">##  pi_mexico 0.28   0.28 0.00 0.28  0.29</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We have the two proportions—10% and 28%—and they match what we found in the original table and in the frequentist <code><a href="https://rdrr.io/r/stats/prop.test.html">prop.test()</a></code> results (yay!). Let’s visualize these things:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">props_basic_samples</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">gather_draws</span><span class="op">(</span><span class="va">pi_us</span>, <span class="va">pi_mexico</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.value</span>, y <span class="op">=</span> <span class="va">.variable</span>, fill <span class="op">=</span> <span class="va">.variable</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Multiply axis limits by 1.5% so that the right "%" isn't cut off</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.015</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">clr_usa</span>, <span class="va">clr_mex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Proportion of students who read comic books often"</span>,</span>
<span>       y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_nice</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/plot-props-basic-stan-1.png" class="img-fluid figure-img" style="width:90.0%" alt="Posterior distributions of the proportion of students who read comic books often in the United States and Mexico"></p>
<figcaption class="margin-caption">Posterior distributions of the proportion of students who read comic books often in the United States and Mexico</figcaption></figure>
</div>
</div>
</div>
<p>This plot is neat for a couple reasons. First it shows the difference in variance across these two distributions. The sample size for Mexican respondents is huge, so the average is a lot more precise and <span style="color: #57643C"><i class="magic-block" aria-hidden="true">■</i>the distribution</span> is narrower than <span style="color: #127088"><i class="magic-block" aria-hidden="true">■</i>the American one</span>. Second, by just eyeballing the plot we can see that there’s definitely no overlap between the two distributions, which implies that <span style="color: #CD8A39"><i class="magic-block" aria-hidden="true">■</i>the difference (θ) between the two</span> is definitely not zero—Mexican respondents are way more likely than Americans to read comic books often. We can find <span style="color: #CD8A39"><i class="magic-block" aria-hidden="true">■</i>that difference</span> by taking the pairwise difference between the two with <code>compare_levels()</code> from {tidybayes}, which subtracts one group’s posterior from the other:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">basic_diffs</span> <span class="op">&lt;-</span> <span class="va">props_basic_samples</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">gather_draws</span><span class="op">(</span><span class="va">pi_us</span>, <span class="va">pi_mexico</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># compare_levels() subtracts things using alphabetical order, so by default it</span></span>
<span>  <span class="co"># would calculate pi_us - pi_mexico, but we want the opposite, so we have to</span></span>
<span>  <span class="co"># make pi_us the first level</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>.variable <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">.variable</span>, <span class="st">"pi_us"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">compare_levels</span><span class="op">(</span><span class="va">.value</span>, by <span class="op">=</span> <span class="va">.variable</span>, comparison <span class="op">=</span> <span class="st">"pairwise"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">basic_diffs</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_diff</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Multiply axis limits by 0.5% so that the right "pp." isn't cut off</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">label_pp</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.005</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Percentage point difference in proportions"</span>,</span>
<span>       y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_nice</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.major.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/plot-diffs-basic-stan-1.png" class="img-fluid figure-img" style="width:90.0%" alt="Posterior distribution of the difference in proportions of students who read comic books often in the United States and Mexico"></p>
<figcaption class="margin-caption">Posterior distribution of the difference in proportions of students who read comic books often in the United States and Mexico</figcaption></figure>
</div>
</div>
</div>
<p>We can also do some Bayesian inference and find the probability that <span style="color: #CD8A39"><i class="magic-block" aria-hidden="true">■</i>that difference between the two groups</span> is greater than 0 (or a kind of Bayesian p-value, but way more logical than null hypothesis p-values). We can calculate how many posterior draws are bigger than 0 and divide that by the number of draws to get the official proportion.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">basic_diffs</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span>median <span class="op">=</span> <span class="fu">median_qi</span><span class="op">(</span><span class="va">.value</span><span class="op">)</span>,</span>
<span>            p_gt_0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">.value</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">/</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">unnest</span><span class="op">(</span><span class="va">median</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 8</span></span>
<span><span class="co">##   .variable             y  ymin  ymax .width .point .interval p_gt_0</span></span>
<span><span class="co">##   &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt;</span></span>
<span><span class="co">## 1 pi_mexico - pi_us 0.180 0.170 0.189   0.95 median qi             1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>There’s a 100% chance that <span style="color: #CD8A39"><i class="magic-block" aria-hidden="true">■</i>that difference</span> is not zero, or a 100% chance that Mexican respondents are way more likely than their American counterparts to read comic books often.</p>
</section><section id="stan-model-improvements" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="stan-model-improvements">Stan model improvements</h3>
<p>This basic Stan model is neat, but we can do a couple things to make it better:</p>
<ol type="1">
<li>Right now we have to feed it 4 separate numbers (counts and totals for the US and Mexico). It would be nice to just feed it a vector of counts and a vector of totals (or even a whole matrix like we did with <code><a href="https://rdrr.io/r/stats/prop.test.html">prop.test()</a></code>).</li>
<li>Right now we have to manually calculate the difference between the two groups (0.28 − 0.10). It would be nice to have Stan do that work for us.</li>
</ol>
<p>We’ll tackle each of these issues in turn.</p>
<p>First we’ll change how the script handles the data so that it’s more dynamic. Now instead of defining explicit variables and parameters as <code>total_us</code> or <code>pi_mexico</code> or whatever, we’ll use arrays and vectors so that we can use any arbitrary number of groups if we want:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>props-better.stan</strong></pre>
</div>
<div class="sourceCode" id="cb22" data-filename="props-better.stan"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stuff from R</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; n;</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">array</span>[n] <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; often;</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">array</span>[n] <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; total;</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Things to estimate</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>, <span class="kw">upper</span>=<span class="dv">1</span>&gt;[n] pi;</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Prior and likelihood</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  pi ~ beta(<span class="dv">2</span>, <span class="dv">6</span>);</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">// We could specify separate priors like this</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">// pi[1] ~ beta(2, 6);</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">// pi[2] ~ beta(2, 6);</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>  often ~ binomial(total, pi);</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s make sure it works. Note how we now have to feed it an <code>n</code> for the number of countries and vectors of counts for <code>often</code> and <code>total</code>:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_props_better</span> <span class="op">&lt;-</span> <span class="fu">cmdstan_model</span><span class="op">(</span><span class="st">"props-better.stan"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">props_better_samples</span> <span class="op">&lt;-</span> <span class="va">model_props_better</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">2</span>,</span>
<span>              often <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">n_often</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">n_often</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>              total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">n_respondents</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">n_respondents</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="va">CHAINS</span>, iter_warmup <span class="op">=</span> <span class="va">WARMUP</span>, iter_sampling <span class="op">=</span> <span class="op">(</span><span class="va">ITER</span> <span class="op">-</span> <span class="va">WARMUP</span><span class="op">)</span>, seed <span class="op">=</span> <span class="va">BAYES_SEED</span>,</span>
<span>  refresh <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## Running MCMC with 4 parallel chains...</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Chain 1 finished in 0.0 seconds.</span></span>
<span><span class="co">## Chain 2 finished in 0.0 seconds.</span></span>
<span><span class="co">## Chain 3 finished in 0.0 seconds.</span></span>
<span><span class="co">## Chain 4 finished in 0.0 seconds.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## All 4 chains finished successfully.</span></span>
<span><span class="co">## Mean chain execution time: 0.0 seconds.</span></span>
<span><span class="co">## Total execution time: 0.2 seconds.</span></span>
<span></span>
<span><span class="va">props_better_samples</span><span class="op">$</span><span class="fu">print</span><span class="op">(</span></span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"pi[1]"</span>, <span class="st">"pi[2]"</span><span class="op">)</span>, </span>
<span>  <span class="st">"mean"</span>, <span class="st">"median"</span>, <span class="st">"sd"</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">.x</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">##  variable mean median   sd 2.5% 97.5%</span></span>
<span><span class="co">##     pi[1] 0.10   0.10 0.00 0.09  0.11</span></span>
<span><span class="co">##     pi[2] 0.28   0.28 0.00 0.28  0.29</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>It worked and the results are the same! The parameter names are now <span style="color: #127088"><i class="magic-block" aria-hidden="true">■</i>“<code>pi[1]</code>”</span> and <span style="color: #57643C"><i class="magic-block" aria-hidden="true">■</i>“<code>pi[2]</code>”</span> and we’re responsible for keeping track of which subscripts correspond to which countries, which is annoying, but that’s Stan :shrug:.</p>
<p>Finally, we can modify the script a little more to automatically calculate <span style="color: #CD8A39"><i class="magic-block" aria-hidden="true">■</i>θ</span>. We’ll add a <code>generated quantities</code> block for that:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>props-best.stan</strong></pre>
</div>
<div class="sourceCode" id="cb25" data-filename="props-best.stan"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Stuff from R</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; n;</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">array</span>[n] <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; often;</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">array</span>[n] <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; total;</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Things to estimate</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>, <span class="kw">upper</span>=<span class="dv">1</span>&gt;[n] pi;</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Prior and likelihood</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  pi ~ beta(<span class="dv">2</span>, <span class="dv">6</span>);</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  often ~ binomial(total, pi);</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="co">// Stuff Stan will calculate before sending back to R</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="kw">generated quantities</span> {</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> theta;</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  theta = pi[<span class="dv">2</span>] - pi[<span class="dv">1</span>];</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_props_best</span> <span class="op">&lt;-</span> <span class="fu">cmdstan_model</span><span class="op">(</span><span class="st">"props-best.stan"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">props_best_samples</span> <span class="op">&lt;-</span> <span class="va">model_props_best</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">2</span>,</span>
<span>              often <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">n_often</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">n_often</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>              total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">n_respondents</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">n_respondents</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="va">CHAINS</span>, iter_warmup <span class="op">=</span> <span class="va">WARMUP</span>, iter_sampling <span class="op">=</span> <span class="op">(</span><span class="va">ITER</span> <span class="op">-</span> <span class="va">WARMUP</span><span class="op">)</span>, seed <span class="op">=</span> <span class="va">BAYES_SEED</span>,</span>
<span>  refresh <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## Running MCMC with 4 parallel chains...</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Chain 1 finished in 0.0 seconds.</span></span>
<span><span class="co">## Chain 2 finished in 0.0 seconds.</span></span>
<span><span class="co">## Chain 3 finished in 0.0 seconds.</span></span>
<span><span class="co">## Chain 4 finished in 0.0 seconds.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## All 4 chains finished successfully.</span></span>
<span><span class="co">## Mean chain execution time: 0.0 seconds.</span></span>
<span><span class="co">## Total execution time: 0.3 seconds.</span></span>
<span></span>
<span><span class="va">props_best_samples</span><span class="op">$</span><span class="fu">print</span><span class="op">(</span></span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"pi[1]"</span>, <span class="st">"pi[2]"</span>, <span class="st">"theta"</span><span class="op">)</span>, </span>
<span>  <span class="st">"mean"</span>, <span class="st">"median"</span>, <span class="st">"sd"</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">.x</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">##  variable mean median   sd 2.5% 97.5%</span></span>
<span><span class="co">##     pi[1] 0.10   0.10 0.00 0.09  0.11</span></span>
<span><span class="co">##     pi[2] 0.28   0.28 0.00 0.28  0.29</span></span>
<span><span class="co">##     theta 0.18   0.18 0.00 0.17  0.19</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Check that out! Stan returned our <span style="color: #CD8A39"><i class="magic-block" aria-hidden="true">■</i>18 percentage point difference</span> and we didn’t need to use <code>compare_levels()</code>! We can plot it directly:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Raw Stan doesn't preserve the original country names or order, so we have to</span></span>
<span><span class="co"># do a bunch of reversing and relabeling on our own here</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">props_best_samples</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">spread_draws</span><span class="op">(</span><span class="va">pi</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">pi</span>, y <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="va">i</span><span class="op">)</span>, fill <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Multiply axis limits by 1.5% so that the right "%" isn't cut off</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.015</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_discrete</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"United States"</span>, <span class="st">"Mexico"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">clr_usa</span>, <span class="va">clr_mex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Proportion of students who read comic books often"</span>,</span>
<span>       y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_nice</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">props_best_samples</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">spread_draws</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">theta</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_diff</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Multiply axis limits by 0.5% so that the right "pp." isn't cut off</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">label_pp</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.005</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Percentage point difference in proportions"</span>,</span>
<span>       y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_nice</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.major.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">p1</span> <span class="op">/</span> <span class="fu">plot_spacer</span><span class="op">(</span><span class="op">)</span> <span class="op">/</span> <span class="va">p2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">plot_layout</span><span class="op">(</span>heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.785</span>, <span class="fl">0.03</span>, <span class="fl">0.185</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/plot-diffs-best-stan-1.png" class="img-fluid figure-img" style="width:90.0%" alt="Posterior distribution of the proportions and difference in proportions of students who read comic books often in the United States and Mexico; results from raw Stan code"></p>
<figcaption class="margin-caption">Posterior distribution of the proportions and difference in proportions of students who read comic books often in the United States and Mexico; results from raw Stan code</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="bayesianly-with-brms" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="bayesianly-with-brms">Bayesianly with {brms}</h2>
<p>Working with raw Stan code like that is fun and exciting—understanding the inner workings of these models is really neat and important! But in practice, I rarely use raw Stan. It takes too much pre- and post-processing for my taste (the data has to be fed in a list instead of a nice rectangular data frame; the variable names get lost unless you do some extra programming work; etc.).</p>
<p>Instead, I use <a href="https://paul-buerkner.github.io/brms/">{brms}</a> for pretty much all my Bayesian models. It uses R’s familiar formula syntax, it works with regular data frames, it maintains variable names, and it’s just an all-around super-nice-and-polished frontend for working with Stan.</p>
<p>With a little formula finagling, we can create the same beta binomial model we built with raw Stan using {brms}</p>
<section id="counts-and-trials-as-formula-outcomes" class="level3"><h3 class="anchored" data-anchor-id="counts-and-trials-as-formula-outcomes">Counts and trials as formula outcomes</h3>
<p>In R’s standard formula syntax, you put the outcome on the left-hand side of a <code>~</code> and the explanatory variables on the right-hand side:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">whatever</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You typically feed the model function a data frame with columns for each of the variables included. One neat and underappreciated feature of the <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> function is that you can feed function aggregated count data (instead of long data with lots of rows) by specifying the number of successes and the total number of failures as the outcome part of the formula. This runs something called aggregated logistic regression or aggregated binomial regression.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">n_successes</span>, <span class="va">n_failures</span><span class="op">)</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">whatever</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>{brms} uses slightly different syntax for <a href="https://bookdown.org/content/4857/god-spiked-the-integers.html#binomial-regression">aggregated logistic regression</a>. Instead of the number of failures, it needs the total number of trials, and it doesn’t use <code>cbind(...)</code>—it uses <code>n | trials(total)</code>, like this:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">brm</span>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(n <span class="sc">|</span> <span class="fu">trials</span>(total) <span class="sc">~</span> x)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> whatever,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Our comic book data is already in this count form, and we have columns for the number of “successes” (number of respondents reading comic books often) and the total number of “trials” (number of respondents reading comic books):</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">often_comics_only</span> <span class="op">&lt;-</span> <span class="va">reading_counts</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">book_type</span> <span class="op">==</span> <span class="st">"Comic books"</span>, <span class="va">frequency</span> <span class="op">==</span> <span class="st">"Often"</span><span class="op">)</span></span>
<span><span class="va">often_comics_only</span></span>
<span><span class="co">## # A tibble: 2 × 6</span></span>
<span><span class="co">##   country       book_type   frequency     n total  prop</span></span>
<span><span class="co">##   &lt;fct&gt;         &lt;chr&gt;       &lt;fct&gt;     &lt;int&gt; &lt;int&gt; &lt;dbl&gt;</span></span>
<span><span class="co">## 1 Mexico        Comic books Often     10605 37641 0.282</span></span>
<span><span class="co">## 2 United States Comic books Often       524  5142 0.102</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="binomial-model-with-logistic-link" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="binomial-model-with-logistic-link">Binomial model with logistic link</h3>
<p>Since we have columns for <code>n</code>, <code>total</code>, and <code>country</code>, we can run an aggregated binomial logistic regression model like this:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">often_comics_model_logit</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span></span>
<span>  <span class="fu">bf</span><span class="op">(</span><span class="va">n</span> <span class="op">|</span> <span class="fu">trials</span><span class="op">(</span><span class="va">total</span><span class="op">)</span> <span class="op">~</span> <span class="va">country</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">often_comics_only</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="va">CHAINS</span>, warmup <span class="op">=</span> <span class="va">WARMUP</span>, iter <span class="op">=</span> <span class="va">ITER</span>, seed <span class="op">=</span> <span class="va">BAYES_SEED</span>,</span>
<span>  refresh <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## Start sampling</span></span>
<span><span class="co">## Running MCMC with 4 parallel chains...</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Chain 1 finished in 0.0 seconds.</span></span>
<span><span class="co">## Chain 2 finished in 0.0 seconds.</span></span>
<span><span class="co">## Chain 3 finished in 0.0 seconds.</span></span>
<span><span class="co">## Chain 4 finished in 0.0 seconds.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## All 4 chains finished successfully.</span></span>
<span><span class="co">## Mean chain execution time: 0.0 seconds.</span></span>
<span><span class="co">## Total execution time: 0.2 seconds.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">often_comics_model_logit</span></span>
<span><span class="co">##  Family: binomial </span></span>
<span><span class="co">##   Links: mu = logit </span></span>
<span><span class="co">## Formula: n | trials(total) ~ country </span></span>
<span><span class="co">##    Data: often_comics_only (Number of observations: 2) </span></span>
<span><span class="co">##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;</span></span>
<span><span class="co">##          total post-warmup draws = 4000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Regression Coefficients:</span></span>
<span><span class="co">##                     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">## Intercept              -0.94      0.01    -0.96    -0.91 1.00     4316     2499</span></span>
<span><span class="co">## countryUnitedStates    -1.24      0.05    -1.33    -1.15 1.01      966      721</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span></span>
<span><span class="co">## and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">## scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Because we used a logit link for the binomial family, these results are on the log odds scale, which, ew. We can’t really interpret them directly unless we do some extra math with <code><a href="https://rdrr.io/r/stats/Logistic.html">plogis()</a></code> (<a href="https://www.andrewheiss.com/blog/2021/11/08/beta-regression-guide/#fractional-logistic-regression">see here for more about how to do that</a>). The logistic-ness of the results is also apparent in the formal mathy model for this approach, which no longer uses a Beta distribution for estimating <span class="math inline">\(\pi\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
y_{n \text{ comic books, often}} \sim&amp;\ \operatorname{Binomial}(n_{\text{Total students}}, \pi_{\text{comic books, often}}) \\
\operatorname{logit}(\pi_{\text{comic books, often}}) =&amp;\ \beta_0 + \beta_1 \text{United States} \\[5pt]
\beta_0, \beta_1 =&amp; \text{Whatever brms uses as default priors}\\
\end{aligned}
\]</span></p>
<p>We can still work with percentage point values if we use <code>epred_draws()</code> and a bit of data wrangling, since that automatically back-transforms <span class="math inline">\(\operatorname{logit}(\pi)\)</span> from log odds to counts (<a href="https://www.andrewheiss.com/blog/2022/09/26/guide-visualizing-types-posteriors/">see here for an explanation of how and why</a>). We can convert these posterior counts to a proportion again by dividing each predicted count by the total for each row.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># brms keeps all the original factor/category names, so there's no need for</span></span>
<span><span class="co"># extra manual work here!</span></span>
<span><span class="va">draws_logit</span> <span class="op">&lt;-</span> <span class="va">often_comics_model_logit</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># This gives us counts...</span></span>
<span>  <span class="fu">epred_draws</span><span class="op">(</span>newdata <span class="op">=</span> <span class="va">often_comics_only</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># ...so divide by the original total to get proportions again</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>.epred_prop <span class="op">=</span> <span class="va">.epred</span> <span class="op">/</span> <span class="va">total</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">draws_logit</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.epred_prop</span>, y <span class="op">=</span> <span class="va">country</span>, fill <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.015</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">clr_usa</span>, <span class="va">clr_mex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Proportion of students who read comic books often"</span>,</span>
<span>       y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_nice</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">draws_logit</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># compare_levels() subtracts things using alphabetical order, so so we have to</span></span>
<span>  <span class="co"># make the United States the first level</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>country <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">country</span>, <span class="st">"United States"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">compare_levels</span><span class="op">(</span><span class="va">.epred_prop</span>, by <span class="op">=</span> <span class="st">"country"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.epred_prop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_diff</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Multiply axis limits by 0.5% so that the right "pp." isn't cut off</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">label_pp</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.005</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Percentage point difference in proportions"</span>,</span>
<span>       y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Make it so the pointrange doesn't get cropped</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>clip <span class="op">=</span> <span class="st">"off"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme_nice</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.major.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">p1</span> <span class="op">/</span> <span class="fu">plot_spacer</span><span class="op">(</span><span class="op">)</span> <span class="op">/</span> <span class="va">p2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">plot_layout</span><span class="op">(</span>heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.785</span>, <span class="fl">0.03</span>, <span class="fl">0.185</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/q1-plot-logit-1.png" class="img-fluid figure-img" style="width:90.0%" alt="Posterior distribution of the proportions and difference in proportions of students who read comic books often in the United States and Mexico; results from logistic regression model in {brms}"></p>
<figcaption class="margin-caption">Posterior distribution of the proportions and difference in proportions of students who read comic books often in the United States and Mexico; results from logistic regression model in {brms}</figcaption></figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">draws_logit</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">median_qi</span><span class="op">(</span><span class="va">.epred_prop</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 2 × 7</span></span>
<span><span class="co">##   country       .epred_prop .lower .upper .width .point .interval</span></span>
<span><span class="co">##   &lt;fct&gt;               &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    </span></span>
<span><span class="co">## 1 Mexico              0.282 0.277   0.286   0.95 median qi       </span></span>
<span><span class="co">## 2 United States       0.102 0.0942  0.111   0.95 median qi</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Cool cool, all the results are the same as using raw Stan.</p>
</section><section id="binomial-model-with-identity-link" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="binomial-model-with-identity-link">Binomial model with identity link</h3>
<p>We didn’t set any priors here, and if we want to be good Bayesians, we should. However, given the logit link, we’d need to specify priors on the log odds scale, and I can’t naturally think in logits. I <em>can</em> think about percentages though, which is why I like the Beta distribution for priors for proportions—it just makes sense.</p>
<p>Also, the raw Stan models spat out percentage-point scale parameters—it’d be neat if {brms} could too.</p>
<p>And it can! We just have to change the link function for the binomial family from <code>"logit"</code> to <code>"identity"</code>. This isn’t really documented anywhere (I don’t think?), and it feels weird and wrong, but it works. Note how we take the “logit” out of the second line of the model—we’re no longer using a link function:</p>
<p><span class="math display">\[
\begin{aligned}
y_{n \text{ comic books, often}} \sim&amp;\ \operatorname{Binomial}(n_{\text{Total students}}, \pi_{\text{comic books, often}}) \\
\pi_{\text{comic books, often}} =&amp;\ \beta_0 + \beta_1 \text{United States} \\[5pt]
\beta_0, \beta_1 =&amp;\ \text{Whatever brms uses as default priors}\\
\end{aligned}
\]</span></p>
<p>Doing this works, but there are some issues. The identity link in a binomial model means that the model parameters won’t be transformed to the logit scale and will instead stay on the proportion scale. We’ll get some errors related to MCMC values because the outcome needs to be constrained between 0 and 1, and the MCMC chains will occasionally wander down into negative numbers and make Stan mad. The model will mostly fit if we specify initial MCMC values at 0.1 or something, but it’ll still complain.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">often_comics_model_identity</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span></span>
<span>  <span class="fu">bf</span><span class="op">(</span><span class="va">n</span> <span class="op">|</span> <span class="fu">trials</span><span class="op">(</span><span class="va">total</span><span class="op">)</span> <span class="op">~</span> <span class="va">country</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">often_comics_only</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span>,</span>
<span>  init <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  chains <span class="op">=</span> <span class="va">CHAINS</span>, warmup <span class="op">=</span> <span class="va">WARMUP</span>, iter <span class="op">=</span> <span class="va">ITER</span>, seed <span class="op">=</span> <span class="va">BAYES_SEED</span>,</span>
<span>  refresh <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## Start sampling</span></span>
<span><span class="co">## Running MCMC with 4 parallel chains...</span></span>
<span><span class="co">## Chain 1 Rejecting initial value:</span></span>
<span><span class="co">## Chain 1   Error evaluating the log probability at the initial value.</span></span>
<span><span class="co">## Chain 1 Exception: binomial_lpmf: Probability parameter[2] is -0.00152456, but must be in the interval [0, 1] (in '/var/folders/17/g3pw3lvj2h30gwm67tbtx98c0000gn/T/RtmpC5PR8i/model-6fd51f72abc7.stan', line 35, column 4 to column 44)</span></span>
<span><span class="co">## Chain 1 Rejecting initial value:</span></span>
<span><span class="co">## Chain 1   Error evaluating the log probability at the initial value.</span></span>
<span><span class="co">## Chain 1 Exception: binomial_lpmf: Probability parameter[2] is -0.0379836, but must be in the interval [0, 1] (in '/var/folders/17/g3pw3lvj2h30gwm67tbtx98c0000gn/T/RtmpC5PR8i/model-6fd51f72abc7.stan', line 35, column 4 to column 44)</span></span>
<span><span class="co">## Chain 2 Rejecting initial value:</span></span>
<span><span class="co">## Chain 2   Error evaluating the log probability at the initial value.</span></span>
<span><span class="co">## Chain 2 Exception: binomial_lpmf: Probability parameter[2] is -0.00730659, but must be in the interval [0, 1] (in '/var/folders/17/g3pw3lvj2h30gwm67tbtx98c0000gn/T/RtmpC5PR8i/model-6fd51f72abc7.stan', line 35, column 4 to column 44)</span></span>
<span><span class="co">## Chain 3 Rejecting initial value:</span></span>
<span><span class="co">## Chain 3   Error evaluating the log probability at the initial value.</span></span>
<span><span class="co">## Chain 3 Exception: binomial_lpmf: Probability parameter[1] is -0.0734376, but must be in the interval [0, 1] (in '/var/folders/17/g3pw3lvj2h30gwm67tbtx98c0000gn/T/RtmpC5PR8i/model-6fd51f72abc7.stan', line 35, column 4 to column 44)</span></span>
<span><span class="co">## Chain 3 Rejecting initial value:</span></span>
<span><span class="co">## Chain 3   Error evaluating the log probability at the initial value.</span></span>
<span><span class="co">## Chain 3 Exception: binomial_lpmf: Probability parameter[1] is -0.084938, but must be in the interval [0, 1] (in '/var/folders/17/g3pw3lvj2h30gwm67tbtx98c0000gn/T/RtmpC5PR8i/model-6fd51f72abc7.stan', line 35, column 4 to column 44)</span></span>
<span><span class="co">## Chain 4 Rejecting initial value:</span></span>
<span><span class="co">## Chain 4   Error evaluating the log probability at the initial value.</span></span>
<span><span class="co">## Chain 4 Exception: binomial_lpmf: Probability parameter[1] is -0.0585092, but must be in the interval [0, 1] (in '/var/folders/17/g3pw3lvj2h30gwm67tbtx98c0000gn/T/RtmpC5PR8i/model-6fd51f72abc7.stan', line 35, column 4 to column 44)</span></span>
<span><span class="co">## Chain 1 finished in 0.0 seconds.</span></span>
<span><span class="co">## Chain 3 finished in 0.0 seconds.</span></span>
<span><span class="co">## Chain 4 finished in 0.0 seconds.</span></span>
<span><span class="co">## Chain 2 finished in 0.2 seconds.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## All 4 chains finished successfully.</span></span>
<span><span class="co">## Mean chain execution time: 0.1 seconds.</span></span>
<span><span class="co">## Total execution time: 0.4 seconds.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">often_comics_model_identity</span></span>
<span><span class="co">##  Family: binomial </span></span>
<span><span class="co">##   Links: mu = identity </span></span>
<span><span class="co">## Formula: n | trials(total) ~ country </span></span>
<span><span class="co">##    Data: often_comics_only (Number of observations: 2) </span></span>
<span><span class="co">##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;</span></span>
<span><span class="co">##          total post-warmup draws = 4000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Regression Coefficients:</span></span>
<span><span class="co">##                     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">## Intercept               0.28      0.00     0.28     0.29 1.00     3372     2728</span></span>
<span><span class="co">## countryUnitedStates    -0.18      0.00    -0.19    -0.17 1.00     1292     1659</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span></span>
<span><span class="co">## and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">## scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>One really nice thing about this identity-link model is that the coefficient for <code>countryUnitedStates</code> shows us the percentage-point-scale difference in proportions: −0.18! This is just a regular regression model, so the intercept shows us the average proportion when United States is false (i.e.&nbsp;for Mexico), and the United States coefficient shows the offset from the intercept.</p>
<p>Working with the <code>countryUnitedStates</code> coefficient directly is convenient—there’s no need to divide predicted values by totals or use <code>compare_levels()</code> to find the difference between the United States and Mexico. We have <span style="color: #CD8A39"><i class="magic-block" aria-hidden="true">■</i>our estimand</span> immediately.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">draws_diffs_identity</span> <span class="op">&lt;-</span> <span class="va">often_comics_model_identity</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">gather_draws</span><span class="op">(</span><span class="va">b_countryUnitedStates</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># Reverse the value since our theta is Mexico - US, not US - Mexico</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>.value <span class="op">=</span> <span class="op">-</span><span class="va">.value</span><span class="op">)</span></span>
<span></span>
<span><span class="va">draws_diffs_identity</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_diff</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Multiply axis limits by 0.5% so that the right "pp." isn't cut off</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">label_pp</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.005</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Percentage point difference in proportions"</span>,</span>
<span>       y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_nice</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.major.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/q1-plot-model-identity-intercept-1.png" class="img-fluid figure-img" style="width:90.0%" alt="Posterior distribution of the difference in proportions of students who read comic books often in the United States and Mexico; results from binomial model with identity link in {brms}"></p>
<figcaption class="margin-caption">Posterior distribution of the difference in proportions of students who read comic books often in the United States and Mexico; results from binomial model with identity link in {brms}</figcaption></figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">draws_diffs_identity</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">median_qi</span><span class="op">(</span><span class="va">.value</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 7</span></span>
<span><span class="co">##   .variable             .value .lower .upper .width .point .interval</span></span>
<span><span class="co">##   &lt;chr&gt;                  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    </span></span>
<span><span class="co">## 1 b_countryUnitedStates  0.179  0.170  0.189   0.95 median qi</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="intercept-free-binomial-model-with-identity-link" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="intercept-free-binomial-model-with-identity-link">Intercept-free binomial model with identity link</h3>
<p>However, I’m still not entirely happy with it. For one thing, I don’t like all the initial MCMC errors. The model still eventually fit, but I’d prefer it to have a less rocky start. I could probably tinker with more options to get it working, but that’s a hassle.</p>
<p>More importantly, though, is the issue of priors. We still haven’t set any. Also, we’re no longer using a beta-binomial model—this is just regular old logistic regression, which means we’re working with intercepts and slopes. If we use the <code>n | trials(total) ~ country</code> model with an identity link, we’d need to set priors for the intercept and for the difference, which means we need to think about two types of values: (1) the prior average percentage for Mexico and (2) the prior average difference between Mexico and the United States. In the earlier raw Stan model, we set priors for the average percentages for each country and didn’t worry about thinking about the difference. Conceptually, I think this is easier. In my own work, I can think about the prior distributions for specific survey response categories (30% might agree, 50% might disagree, 20% might be neutral), but thinking about differences is less natural and straightforward (there might be a 20 percentage point difference between agree and disagree? that feels weird).</p>
<p>To get percentages for each country <em>and</em> avoid the odd initial value errors <em>and</em> set more natural priors, and ultimately use a beta-binomial model, we can fit an intercept-free model by including a 0 in the right-hand side of the formula. This disables the Mexico reference category and returns estimates for both Mexico and the United States. Now we can finally set a prior too. Here, as I did with the Stan model earlier, I use Beta(2, 6) for both countries, but it could easily be different for each country too. This is one way to force {brms} to essentially use a beta-binomial model, and results in something like this:</p>
<p><span class="math display">\[
\begin{aligned}
y_{n \text{ comic books, often}} \sim&amp;\ \operatorname{Binomial}(n_{\text{Total students}}, \pi_{\text{comic books, often}}) \\
\pi_{\text{comic books, often}} =&amp;\ \beta_\text{Mexico} + \beta_\text{United States} \\[10pt]
\beta_\text{Mexico}, \beta_\text{United States} =&amp;\ \operatorname{Beta}(2, 6)\\
\end{aligned}
\]</span></p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">often_comics_model</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span></span>
<span>  <span class="fu">bf</span><span class="op">(</span><span class="va">n</span> <span class="op">|</span> <span class="fu">trials</span><span class="op">(</span><span class="va">total</span><span class="op">)</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">country</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">often_comics_only</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span>,</span>
<span>  prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">prior</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Special.html">beta</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span>, lb <span class="op">=</span> <span class="fl">0</span>, ub <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="va">CHAINS</span>, warmup <span class="op">=</span> <span class="va">WARMUP</span>, iter <span class="op">=</span> <span class="va">ITER</span>, seed <span class="op">=</span> <span class="va">BAYES_SEED</span>,</span>
<span>  refresh <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## Start sampling</span></span>
<span><span class="co">## Running MCMC with 4 parallel chains...</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Chain 1 finished in 0.0 seconds.</span></span>
<span><span class="co">## Chain 2 finished in 0.0 seconds.</span></span>
<span><span class="co">## Chain 3 finished in 0.0 seconds.</span></span>
<span><span class="co">## Chain 4 finished in 0.0 seconds.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## All 4 chains finished successfully.</span></span>
<span><span class="co">## Mean chain execution time: 0.0 seconds.</span></span>
<span><span class="co">## Total execution time: 0.2 seconds.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">often_comics_model</span></span>
<span><span class="co">##  Family: binomial </span></span>
<span><span class="co">##   Links: mu = identity </span></span>
<span><span class="co">## Formula: n | trials(total) ~ 0 + country </span></span>
<span><span class="co">##    Data: often_comics_only (Number of observations: 2) </span></span>
<span><span class="co">##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;</span></span>
<span><span class="co">##          total post-warmup draws = 4000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Regression Coefficients:</span></span>
<span><span class="co">##                     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">## countryMexico           0.28      0.00     0.28     0.29 1.00     3627     2727</span></span>
<span><span class="co">## countryUnitedStates     0.10      0.00     0.09     0.11 1.00     3632     2560</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span></span>
<span><span class="co">## and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">## scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The coefficients here represent the average proportions for each country. The <span style="color: #CD8A39"><i class="magic-block" aria-hidden="true">■</i>main estimand we care about</span> is still the difference between the two, so we need to do a little bit of data manipulation to calculate that, just like we did with the first logit version of the model:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">often_comics_model</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">epred_draws</span><span class="op">(</span>newdata <span class="op">=</span> <span class="va">often_comics_only</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>.epred_prop <span class="op">=</span> <span class="va">.epred</span> <span class="op">/</span> <span class="va">total</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.epred_prop</span>, y <span class="op">=</span> <span class="va">country</span>, fill <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.015</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">clr_usa</span>, <span class="va">clr_mex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Proportion of students who read comic books often"</span>,</span>
<span>       y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_nice</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">often_comics_model</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">epred_draws</span><span class="op">(</span>newdata <span class="op">=</span> <span class="va">often_comics_only</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>.epred_prop <span class="op">=</span> <span class="va">.epred</span> <span class="op">/</span> <span class="va">total</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># compare_levels() subtracts things using alphabetical order, so so we have to</span></span>
<span>  <span class="co"># make the United States the first level</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>country <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">country</span>, <span class="st">"United States"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">compare_levels</span><span class="op">(</span><span class="va">.epred_prop</span>, by <span class="op">=</span> <span class="va">country</span>,</span>
<span>                 comparison <span class="op">=</span> <span class="st">"pairwise"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.epred_prop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_diff</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Multiply axis limits by 0.5% so that the right "pp." isn't cut off</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">label_pp</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.005</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Percentage point difference in proportions"</span>,</span>
<span>       y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Make it so the pointrange doesn't get cropped</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>clip <span class="op">=</span> <span class="st">"off"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme_nice</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.major.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">p1</span> <span class="op">/</span> <span class="fu">plot_spacer</span><span class="op">(</span><span class="op">)</span> <span class="op">/</span> <span class="va">p2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">plot_layout</span><span class="op">(</span>heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.785</span>, <span class="fl">0.03</span>, <span class="fl">0.185</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/q1-plot-model-identity-1.png" class="img-fluid figure-img" style="width:90.0%" alt="Posterior distribution of the proportions and difference in proportions of students who read comic books often in the United States and Mexico; results from an intercept-free binomial model with identity link in {brms}"></p>
<figcaption class="margin-caption">Posterior distribution of the proportions and difference in proportions of students who read comic books often in the United States and Mexico; results from an intercept-free binomial model with identity link in {brms}</figcaption></figure>
</div>
</div>
</div>
</section><section id="actual-beta-binomial-model" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="actual-beta-binomial-model">Actual beta-binomial model</h3>
<p>Until {brms} 2.17, there wasn’t an official beta-binomial distribution for {brms}, but it was used as <a href="https://cran.r-project.org/web/packages/brms/vignettes/brms_customfamilies.html">the example for creating your own custom family</a>. It is now implemented in {brms} and allows you to define both a mean (<span class="math inline">\(\mu\)</span>) and precision (<span class="math inline">\(\phi\)</span>) for a Beta distribution, just like {brms}’s other Beta-related models (like zero-inflated, etc.—<a href="https://www.andrewheiss.com/blog/2021/11/08/beta-regression-guide/">see here for a lot more about those</a>). This means that we can model both parts of the distribution simultaneously, which is neat, since it allows us to deal with potential overdispersion in outcomes. <a href="https://discourse.mc-stan.org/t/beta-binomial-why-not-a-default-family-in-the-package/10625/2">Paul Bürkner’s original rationale for not including it</a> was that a regular binomial model with a random effect for the observation id also allows you to account for overdispersion, so there’s not really a need for an official beta-binomial family. <a href="https://github.com/paul-buerkner/brms/pull/1319">But in March 2022</a> the <code>beta_binomial</code> family was added as an official distributional family, which is neat.</p>
<p>We can use it here instead of <code>family = binomial(link = "identity")</code> with a few adjustments. The family uses a different mean/precision parameterization of the Beta distribution instead of the two shapes <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>, but we can switch between them with some algebra (<a href="https://www.andrewheiss.com/blog/2021/11/08/beta-regression-guide/#mean-and-precision-instead-of-shapes">see this for more details</a>):</p>
<p><span class="math display">\[
\begin{equation}
\begin{aligned}[t]
\text{Shape 1:} &amp;&amp; \alpha &amp;= \mu \phi \\
\text{Shape 2:} &amp;&amp; \beta &amp;= (1 - \mu) \phi
\end{aligned}
\qquad\qquad\qquad
\begin{aligned}[t]
\text{Mean:} &amp;&amp; \mu &amp;= \frac{\alpha}{\alpha + \beta} \\
\text{Precision:} &amp;&amp; \phi &amp;= \alpha + \beta
\end{aligned}
\end{equation}
\]</span></p>
<p>By default, <span class="math inline">\(\mu\)</span> is modeled on the log odds scale and <span class="math inline">\(\phi\)</span> is modeled on the log scale, but I find both of those really hard to think about, so we can use an identity link for both parameters like we did before with <code><a href="https://rdrr.io/r/stats/family.html">binomial()</a></code> to think about counts and proportions instead. This makes it so the <span class="math inline">\(\phi\)</span> parameter measures the standard deviation of the count on the count scale, so a prior like Exponential(1 / 1000) would imply that the precision (or variance-ish) of the count could vary by mostly low numbers, but maybe up to ±5000ish, which seems reasonable, especially since the Mexico part of the survey has so many respondents:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">dexp</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">0.001</span><span class="op">)</span>, geom <span class="op">=</span> <span class="st">"area"</span>, fill <span class="op">=</span> <span class="st">"#AC3414"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_number</span><span class="op">(</span>big.mark <span class="op">=</span> <span class="st">","</span><span class="op">)</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5000</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Possible values for φ"</span>, y <span class="op">=</span> <span class="cn">NULL</span>, fill <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_nice</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/plot-exponential-prior-1.png" class="img-fluid figure-img" style="width:90.0%" alt="Exponential(1/1000) distribution"></p>
<figcaption class="margin-caption">Exponential(1/1000) distribution</figcaption></figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">often_comics_model_beta_binomial</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span></span>
<span>  <span class="fu">bf</span><span class="op">(</span><span class="va">n</span> <span class="op">|</span> <span class="fu">trials</span><span class="op">(</span><span class="va">total</span><span class="op">)</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">country</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">often_comics_only</span>,</span>
<span>  family <span class="op">=</span> <span class="fu">beta_binomial</span><span class="op">(</span>link <span class="op">=</span> <span class="st">"identity"</span>, link_phi <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span>,</span>
<span>  prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">prior</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Special.html">beta</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"b"</span>, dpar <span class="op">=</span> <span class="st">"mu"</span>, lb <span class="op">=</span> <span class="fl">0</span>, ub <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>            <span class="fu">prior</span><span class="op">(</span><span class="fu">exponential</span><span class="op">(</span><span class="fl">0.001</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"phi"</span>, lb <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="va">CHAINS</span>, warmup <span class="op">=</span> <span class="va">WARMUP</span>, iter <span class="op">=</span> <span class="va">ITER</span>, seed <span class="op">=</span> <span class="va">BAYES_SEED</span>,</span>
<span>  refresh <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## Start sampling</span></span>
<span><span class="co">## Running MCMC with 4 parallel chains...</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Chain 1 finished in 0.0 seconds.</span></span>
<span><span class="co">## Chain 2 finished in 0.0 seconds.</span></span>
<span><span class="co">## Chain 3 finished in 0.0 seconds.</span></span>
<span><span class="co">## Chain 4 finished in 0.0 seconds.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## All 4 chains finished successfully.</span></span>
<span><span class="co">## Mean chain execution time: 0.0 seconds.</span></span>
<span><span class="co">## Total execution time: 0.2 seconds.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Separate model for <span class="math inline">\(\phi\)</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>If we wanted to be super fancy, we could define a completely separate model for the <span class="math inline">\(\phi\)</span> part of the distribution like this, but we don’t need to here:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">often_comics_model_beta_binomial</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span></span>
<span>  <span class="fu">bf</span><span class="op">(</span><span class="va">n</span> <span class="op">|</span> <span class="fu">trials</span><span class="op">(</span><span class="va">total</span><span class="op">)</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">country</span>,</span>
<span>     <span class="va">phi</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">country</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">often_comics_only</span>,</span>
<span>  family <span class="op">=</span> <span class="fu">beta_binomial</span><span class="op">(</span>link <span class="op">=</span> <span class="st">"identity"</span>, link_phi <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span>,</span>
<span>  prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">prior</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Special.html">beta</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"b"</span>, dpar <span class="op">=</span> <span class="st">"mu"</span>, lb <span class="op">=</span> <span class="fl">0</span>, ub <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>            <span class="fu">prior</span><span class="op">(</span><span class="fu">exponential</span><span class="op">(</span><span class="fl">0.001</span><span class="op">)</span>, dpar <span class="op">=</span> <span class="st">"phi"</span>, lb <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="va">CHAINS</span>, warmup <span class="op">=</span> <span class="va">WARMUP</span>, iter <span class="op">=</span> <span class="va">ITER</span>, seed <span class="op">=</span> <span class="va">BAYES_SEED</span>,</span>
<span>  refresh <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Check out the results:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">often_comics_model_beta_binomial</span></span>
<span><span class="co">##  Family: beta_binomial </span></span>
<span><span class="co">##   Links: mu = identity; phi = identity </span></span>
<span><span class="co">## Formula: n | trials(total) ~ 0 + country </span></span>
<span><span class="co">##    Data: often_comics_only (Number of observations: 2) </span></span>
<span><span class="co">##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;</span></span>
<span><span class="co">##          total post-warmup draws = 4000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Regression Coefficients:</span></span>
<span><span class="co">##                     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">## countryMexico           0.28      0.03     0.22     0.33 1.00     1563      812</span></span>
<span><span class="co">## countryUnitedStates     0.11      0.02     0.08     0.15 1.00     1686     1441</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Further Distributional Parameters:</span></span>
<span><span class="co">##     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">## phi  1011.93    993.85    35.55  3647.19 1.00      761      790</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span></span>
<span><span class="co">## and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">## scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Those coefficients are the group proportions, as expected, and we have a <span class="math inline">\(\phi\)</span> parameter representing the overall variation in counts. The proportions here are a little more uncertain than before, though, which is apparent if we plot the distributions. The distributions have a much wider range now (note that the x-axis now goes all the way up to 60%), and the densities are a lot bumpier and jankier. I don’t know why though! This is weird! I’m probably doing something wrong!</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">often_comics_model_beta_binomial</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">epred_draws</span><span class="op">(</span>newdata <span class="op">=</span> <span class="va">often_comics_only</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>.epred_prop <span class="op">=</span> <span class="va">.epred</span> <span class="op">/</span> <span class="va">total</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.epred_prop</span>, y <span class="op">=</span> <span class="va">country</span>, fill <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.015</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">clr_usa</span>, <span class="va">clr_mex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Proportion of students who read comic books often"</span>,</span>
<span>       y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_nice</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/q1-plot-model-beta-binomial-1.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption class="margin-caption">Posterior distributions of the proportion of students who read comic books often in the United States and Mexico</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="final-answer-to-the-question" class="level2"><h2 class="anchored" data-anchor-id="final-answer-to-the-question">Final answer to the question</h2>
<p>Phew, that was a lot of slow pedagogical exposure. What’s our <span style="color: #CD8A39"><i class="magic-block" aria-hidden="true">■</i>official estimand</span>? What’s our final answer to the question “Do respondents in Mexico read comic books more often than respondents in the United States?”?</p>
<p>Yes. They most definitely do.</p>
<p>In an official sort of report or article, I’d write something like this:</p>
<blockquote class="blockquote">
<p>Students in Mexico are far more likely to read comic books often than students in the United States. On average, 28.2% (between 27.7% and 28.6%) of PISA respondents in Mexico read comic books often, compared to 10.2% (between 9.4% and 11.1%) in the United States. There is a 95% posterior probability that the difference between these proportions is between 17.0 and 18.9 percentage points, with a median of 18.0 percentage points. This difference is substantial, and there’s a 100% chance that the difference is not zero.</p>
</blockquote>
</section></section><section id="question-2-frequency-of-newspaper-readership-in-the-us" class="level1 page-columns page-full"><h1>Question 2: Frequency of newspaper readership in the US</h1>
<p>Now that we’ve got the gist of proportion tests with {brms}, we’ll go a lot faster for this second question. We’ll forgo all frequentist stuff and the raw Stan stuff and just skip straight to the intercept-free binomial model with an identity link.</p>
<section id="estimand-1" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="estimand-1">Estimand</h2>
<p>For this question, we want to know the differences in the the proportions of American newspaper-reading frequencies, or whether the differences between (1) <span style="color: #E51B24"><i class="magic-block" aria-hidden="true">■</i>rarely</span> and <span style="color: #FFDE00"><i class="magic-block" aria-hidden="true">■</i>sometimes</span>, (2) <span style="color: #FFDE00"><i class="magic-block" aria-hidden="true">■</i>sometimes</span> and <span style="color: #009DDC"><i class="magic-block" aria-hidden="true">■</i>often</span>, and (3) <span style="color: #E51B24"><i class="magic-block" aria-hidden="true">■</i>rarely</span> and <span style="color: #009DDC"><i class="magic-block" aria-hidden="true">■</i>often</span> are greater than zero:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fancy_table</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tab_style</span><span class="op">(</span></span>
<span>    style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      <span class="fu">cell_fill</span><span class="op">(</span>color <span class="op">=</span> <span class="fu">colorspace</span><span class="fu">::</span><span class="fu">lighten</span><span class="op">(</span><span class="st">"#E51B24"</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="fu">cell_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#E51B24"</span>, weight <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    locations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      <span class="fu">cells_body</span><span class="op">(</span>columns <span class="op">=</span> <span class="fl">3</span>, rows <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tab_style</span><span class="op">(</span></span>
<span>    style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      <span class="fu">cell_fill</span><span class="op">(</span>color <span class="op">=</span> <span class="fu">colorspace</span><span class="fu">::</span><span class="fu">lighten</span><span class="op">(</span><span class="st">"#FFDE00"</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="fu">cell_text</span><span class="op">(</span>color <span class="op">=</span> <span class="fu">colorspace</span><span class="fu">::</span><span class="fu">darken</span><span class="op">(</span><span class="st">"#FFDE00"</span>, <span class="fl">0.1</span><span class="op">)</span>, weight <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    locations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      <span class="fu">cells_body</span><span class="op">(</span>columns <span class="op">=</span> <span class="fl">4</span>, rows <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tab_style</span><span class="op">(</span></span>
<span>    style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      <span class="fu">cell_fill</span><span class="op">(</span>color <span class="op">=</span> <span class="fu">colorspace</span><span class="fu">::</span><span class="fu">lighten</span><span class="op">(</span><span class="st">"#009DDC"</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="fu">cell_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#009DDC"</span>, weight <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    locations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      <span class="fu">cells_body</span><span class="op">(</span>columns <span class="op">=</span> <span class="fl">5</span>, rows <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fnscrdhkzv" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#fnscrdhkzv table {
  font-family: 'Fira Sans', system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#fnscrdhkzv thead, #fnscrdhkzv tbody, #fnscrdhkzv tfoot, #fnscrdhkzv tr, #fnscrdhkzv td, #fnscrdhkzv th {
  border-style: none;
}

#fnscrdhkzv p {
  margin: 0;
  padding: 0;
}

#fnscrdhkzv .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#fnscrdhkzv .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#fnscrdhkzv .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 15px;
  padding-right: 15px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#fnscrdhkzv .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 15px;
  padding-right: 15px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#fnscrdhkzv .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fnscrdhkzv .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fnscrdhkzv .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fnscrdhkzv .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 15px;
  padding-right: 15px;
  overflow-x: hidden;
}

#fnscrdhkzv .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#fnscrdhkzv .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#fnscrdhkzv .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#fnscrdhkzv .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#fnscrdhkzv .gt_spanner_row {
  border-bottom-style: hidden;
}

#fnscrdhkzv .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#fnscrdhkzv .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#fnscrdhkzv .gt_from_md > :first-child {
  margin-top: 0;
}

#fnscrdhkzv .gt_from_md > :last-child {
  margin-bottom: 0;
}

#fnscrdhkzv .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#fnscrdhkzv .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 15px;
  padding-right: 15px;
}

#fnscrdhkzv .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 15px;
  padding-right: 15px;
  vertical-align: top;
}

#fnscrdhkzv .gt_row_group_first td {
  border-top-width: 2px;
}

#fnscrdhkzv .gt_row_group_first th {
  border-top-width: 2px;
}

#fnscrdhkzv .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
}

#fnscrdhkzv .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#fnscrdhkzv .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#fnscrdhkzv .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fnscrdhkzv .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
}

#fnscrdhkzv .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#fnscrdhkzv .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 15px;
  padding-right: 15px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#fnscrdhkzv .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#fnscrdhkzv .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fnscrdhkzv .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fnscrdhkzv .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 15px;
  padding-right: 15px;
}

#fnscrdhkzv .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fnscrdhkzv .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 15px;
  padding-right: 15px;
}

#fnscrdhkzv .gt_left {
  text-align: left;
}

#fnscrdhkzv .gt_center {
  text-align: center;
}

#fnscrdhkzv .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#fnscrdhkzv .gt_font_normal {
  font-weight: normal;
}

#fnscrdhkzv .gt_font_bold {
  font-weight: bold;
}

#fnscrdhkzv .gt_font_italic {
  font-style: italic;
}

#fnscrdhkzv .gt_super {
  font-size: 65%;
}

#fnscrdhkzv .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#fnscrdhkzv .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#fnscrdhkzv .gt_indent_1 {
  text-indent: 5px;
}

#fnscrdhkzv .gt_indent_2 {
  text-indent: 10px;
}

#fnscrdhkzv .gt_indent_3 {
  text-indent: 15px;
}

#fnscrdhkzv .gt_indent_4 {
  text-indent: 20px;
}

#fnscrdhkzv .gt_indent_5 {
  text-indent: 25px;
}

#fnscrdhkzv .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#fnscrdhkzv div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead><tr class="gt_col_headings header">
<th class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="Rarely" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Rarely</th>
<th id="Sometimes" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Sometimes</th>
<th id="Often" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Often</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="gt_group_heading_row odd">
<td colspan="4" id="Mexico" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">Mexico</td>
</tr>
<tr class="gt_row_group_first even">
<td class="gt_row gt_left" headers="Mexico  book_type"><p>Comic books</p></td>
<td class="gt_row gt_center" headers="Mexico  Rarely"><p>26.29%<br><span style="font-size:70%">(9,897)</span></p></td>
<td class="gt_row gt_center" headers="Mexico  Sometimes"><p>45.53%<br><span style="font-size:70%">(17,139)</span></p></td>
<td class="gt_row gt_center" headers="Mexico  Often"><p>28.17%<br><span style="font-size:70%">(10,605)</span></p></td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Mexico  book_type"><p>Newspapers</p></td>
<td class="gt_row gt_center" headers="Mexico  Rarely"><p>18.02%<br><span style="font-size:70%">(6,812)</span></p></td>
<td class="gt_row gt_center" headers="Mexico  Sometimes"><p>32.73%<br><span style="font-size:70%">(12,369)</span></p></td>
<td class="gt_row gt_center" headers="Mexico  Often"><p>49.25%<br><span style="font-size:70%">(18,613)</span></p></td>
</tr>
<tr class="gt_group_heading_row even">
<td colspan="4" id="United States" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">United States</td>
</tr>
<tr class="gt_row_group_first odd">
<td class="gt_row gt_left" headers="United States  book_type"><p>Comic books</p></td>
<td class="gt_row gt_center" headers="United States  Rarely"><p>62.95%<br><span style="font-size:70%">(3,237)</span></p></td>
<td class="gt_row gt_center" headers="United States  Sometimes"><p>26.86%<br><span style="font-size:70%">(1,381)</span></p></td>
<td class="gt_row gt_center" headers="United States  Often"><p>10.19%<br><span style="font-size:70%">(524)</span></p></td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="United States  book_type"><p>Newspapers</p></td>
<td class="gt_row gt_center" headers="United States  Rarely" style="background-color: #FFD9D9; color: #E51B24; font-weight: bold"><p>25.27%<br><span style="font-size:70%">(1,307)</span></p></td>
<td class="gt_row gt_center" headers="United States  Sometimes" style="background-color: #FFF8E4; color: #E3C508; font-weight: bold"><p>37.22%<br><span style="font-size:70%">(1,925)</span></p></td>
<td class="gt_row gt_center" headers="United States  Often" style="background-color: #D7EBFF; color: #009DDC; font-weight: bold"><p>37.51%<br><span style="font-size:70%">(1,940)</span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We’ll again call this estimand <span class="math inline">\(\theta\)</span>, but have three different versions of it:</p>
<p><span class="math display">\[
\begin{aligned}
\theta_1 &amp;= \pi_\text{US, newspapers, often} - \pi_\text{US, newspapers, sometimes} \\
\theta_2 &amp;= \pi_\text{US, newspapers, sometimes} - \pi_\text{US, newspapers, rarely} \\
\theta_3 &amp;= \pi_\text{US, newspapers, often} - \pi_\text{US, newspapers, rarely}
\end{aligned}
\]</span> We just spent a bunch of time talking about comic books, and now we’re looking at data about newspapers and America. Who represents all three of these things simultaneously? Clark Kent / Superman, obviously, the <em>Daily Planet</em> journalist and superpowered alien dedicated to <a href="https://variety.com/2021/film/news/superman-new-motto-dc-fandome-1235090712/">truth, justice, and <del>the American way</del> a better tomorrow</a>. I found this palette at <a href="https://color.adobe.com/Copy%20of%20Superman-color-theme-11627723">Adobe Color</a>.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># US newspaper question colors</span></span>
<span><span class="va">clr_often</span> <span class="op">&lt;-</span> <span class="st">"#009DDC"</span></span>
<span><span class="va">clr_sometimes</span> <span class="op">&lt;-</span> <span class="st">"#FFDE00"</span></span>
<span><span class="va">clr_rarely</span> <span class="op">&lt;-</span> <span class="st">"#E51B24"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p><img src="img/superman.jpg" class="img-fluid"></p>
<p><a href="https://www.flickr.com/photos/27745117@N00/25903472957">“Superman”</a> by <a href="https://www.flickr.com/photos/27745117@N00/">Hannaford</a></p>
</div></div><div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/show-superman-pal-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section><section id="bayesianly-with-brms-1" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="bayesianly-with-brms-1">Bayesianly with {brms}</h2>
<p>Let’s first extract the aggregated data we’ll work with—newspaper frequency in the United States only:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">newspapers_only</span> <span class="op">&lt;-</span> <span class="va">reading_counts</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">book_type</span> <span class="op">==</span> <span class="st">"Newspapers"</span>, <span class="va">country</span> <span class="op">==</span> <span class="st">"United States"</span><span class="op">)</span></span>
<span><span class="va">newspapers_only</span></span>
<span><span class="co">## # A tibble: 3 × 6</span></span>
<span><span class="co">##   country       book_type  frequency     n total  prop</span></span>
<span><span class="co">##   &lt;fct&gt;         &lt;chr&gt;      &lt;fct&gt;     &lt;int&gt; &lt;int&gt; &lt;dbl&gt;</span></span>
<span><span class="co">## 1 United States Newspapers Rarely     1307  5172 0.253</span></span>
<span><span class="co">## 2 United States Newspapers Sometimes  1925  5172 0.372</span></span>
<span><span class="co">## 3 United States Newspapers Often      1940  5172 0.375</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We’ll define this formal beta-binomial model for each of the group proportions and we’ll use a Beta(2, 6) prior again (so 25% ± a bunch):</p>
<p><span class="math display">\[
\begin{aligned}
&amp;\ \textbf{Estimands} \\
\theta_1 =&amp;\ \pi_{\text{newspapers, often}_\text{US}} - \pi_{\text{newspapers, sometimes}_\text{US}} \\
\theta_2 =&amp;\ \pi_{\text{newspapers, sometimes}_\text{US}} - \pi_{\text{newspapers, rarely}_\text{US}} \\
\theta_3 =&amp;\ \pi_{\text{newspapers, often}_\text{US}} - \pi_{\text{newspapers, rarely}_\text{US}} \\[10pt]
&amp;\ \textbf{Beta-binomial model} \\
y_{n \text{ newspapers, [frequency]}_\text{US}} \sim&amp;\ \operatorname{Binomial}(n_{\text{Total students}_\text{US}}, \pi_{\text{newspapers, [frequency]}_\text{US}}) \\
\pi_{\text{newspapers, [frequency]}_\text{US}} \sim&amp;\ \operatorname{Beta}(\alpha, \beta) \\[10pt]
&amp;\ \textbf{Priors} \\
\alpha =&amp;\ 2 \\
\beta =&amp;\ 6
\end{aligned}
\]</span></p>
<p>We can estimate this model with {brms} using an intercept-free binomial model with an identity link:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">freq_newspapers_model</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span></span>
<span>  <span class="fu">bf</span><span class="op">(</span><span class="va">n</span> <span class="op">|</span> <span class="fu">trials</span><span class="op">(</span><span class="va">total</span><span class="op">)</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">frequency</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">newspapers_only</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span>,</span>
<span>  prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">prior</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Special.html">beta</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span>, lb <span class="op">=</span> <span class="fl">0</span>, ub <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="va">CHAINS</span>, warmup <span class="op">=</span> <span class="va">WARMUP</span>, iter <span class="op">=</span> <span class="va">ITER</span>, seed <span class="op">=</span> <span class="va">BAYES_SEED</span>,</span>
<span>  refresh <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## Start sampling</span></span>
<span><span class="co">## Running MCMC with 4 parallel chains...</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Chain 1 finished in 0.0 seconds.</span></span>
<span><span class="co">## Chain 2 finished in 0.0 seconds.</span></span>
<span><span class="co">## Chain 3 finished in 0.0 seconds.</span></span>
<span><span class="co">## Chain 4 finished in 0.0 seconds.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## All 4 chains finished successfully.</span></span>
<span><span class="co">## Mean chain execution time: 0.0 seconds.</span></span>
<span><span class="co">## Total execution time: 0.2 seconds.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">freq_newspapers_model</span></span>
<span><span class="co">##  Family: binomial </span></span>
<span><span class="co">##   Links: mu = identity </span></span>
<span><span class="co">## Formula: n | trials(total) ~ 0 + frequency </span></span>
<span><span class="co">##    Data: newspapers_only (Number of observations: 3) </span></span>
<span><span class="co">##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;</span></span>
<span><span class="co">##          total post-warmup draws = 4000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Regression Coefficients:</span></span>
<span><span class="co">##                    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">## frequencyRarely        0.25      0.01     0.24     0.26 1.00     4059     2461</span></span>
<span><span class="co">## frequencySometimes     0.37      0.01     0.36     0.39 1.00     4577     2890</span></span>
<span><span class="co">## frequencyOften         0.37      0.01     0.36     0.39 1.00     4055     2824</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span></span>
<span><span class="co">## and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">## scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>It works! These group proportions are the same as what we found in the contingency table:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plot_props_newspaper</span> <span class="op">&lt;-</span> <span class="va">freq_newspapers_model</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">epred_draws</span><span class="op">(</span>newdata <span class="op">=</span> <span class="va">newspapers_only</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>.epred_prop <span class="op">=</span> <span class="va">.epred</span> <span class="op">/</span> <span class="va">total</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.epred_prop</span>, y <span class="op">=</span> <span class="va">frequency</span>, fill <span class="op">=</span> <span class="va">frequency</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">clr_rarely</span>, <span class="va">clr_sometimes</span>, <span class="va">clr_often</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Proportion of frequencies of newspaper reading"</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_nice</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">plot_props_newspaper</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/q2-plot-model-identity-1.png" class="img-fluid figure-img" style="width:90.0%" alt="Posterior distributions of the proportions of the frequency of reading newspapers among American students"></p>
<figcaption class="margin-caption">Posterior distributions of the proportions of the frequency of reading newspapers among American students</figcaption></figure>
</div>
</div>
</div>
<p>We’re interested in our three <span class="math inline">\(\theta\)</span>s, or the posterior differences between each of these proportions. We can again use <code>compare_levels()</code> to find these all at once. If we specify <code>comparison = "pairwise"</code>, {tidybayes} will calculate the differences between each pair of proportions.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">freq_newspapers_diffs</span> <span class="op">&lt;-</span> <span class="va">freq_newspapers_model</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">epred_draws</span><span class="op">(</span>newdata <span class="op">=</span> <span class="va">newspapers_only</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>.epred_prop <span class="op">=</span> <span class="va">.epred</span> <span class="op">/</span> <span class="va">total</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">compare_levels</span><span class="op">(</span><span class="va">.epred_prop</span>, by <span class="op">=</span> <span class="va">frequency</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># Put these in the right order</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>frequency <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">frequency</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Often - Sometimes"</span>, </span>
<span>                                                  <span class="st">"Sometimes - Rarely"</span>,</span>
<span>                                                  <span class="st">"Often - Rarely"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">freq_newspapers_diffs</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.epred_prop</span>, y <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="va">frequency</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">frequency</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_diff</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"#F012BE"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Multiply axis limits by 0.5% so that the right "pp." isn't cut off</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">label_pp</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.005</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Percentage point difference in proportions"</span>,</span>
<span>       y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_nice</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/q2-plot-model-identity-diffs-1.png" class="img-fluid figure-img" style="width:90.0%" alt="Posterior distributions of the differences between various frequencies of reading newspapers among American students; all density plots are filled with the same color for now"></p>
<figcaption class="margin-caption">Posterior distributions of the differences between various frequencies of reading newspapers among American students; all density plots are filled with the same color for now</figcaption></figure>
</div>
</div>
</div>
<p>We can also calculate the official median differences and the probabilities that the posteriors are greater than 0:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">freq_newspapers_diffs</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span>median <span class="op">=</span> <span class="fu">median_qi</span><span class="op">(</span><span class="va">.epred_prop</span>, .width <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span>,</span>
<span>            p_gt_0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">.epred_prop</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">/</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">unnest</span><span class="op">(</span><span class="va">median</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 3 × 8</span></span>
<span><span class="co">##   frequency                y    ymin   ymax .width .point .interval p_gt_0</span></span>
<span><span class="co">##   &lt;fct&gt;                &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt;</span></span>
<span><span class="co">## 1 Often - Sometimes  0.00296 -0.0158 0.0215   0.95 median qi         0.622</span></span>
<span><span class="co">## 2 Sometimes - Rarely 0.119    0.101  0.137    0.95 median qi         1    </span></span>
<span><span class="co">## 3 Often - Rarely     0.122    0.105  0.140    0.95 median qi         1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>There’s only a 60ish% chance that the difference between <span style="color: #009DDC"><i class="magic-block" aria-hidden="true">■</i>often</span> and <span style="color: #FFDE00"><i class="magic-block" aria-hidden="true">■</i>sometimes</span> is bigger than zero, so there’s probably not an actual difference between those two categories, but there’s a 100% chance that the differences between <span style="color: #FFDE00"><i class="magic-block" aria-hidden="true">■</i>sometimes</span> and <span style="color: #E51B24"><i class="magic-block" aria-hidden="true">■</i>rarely</span> and <span style="color: #009DDC"><i class="magic-block" aria-hidden="true">■</i>often</span> and <span style="color: #E51B24"><i class="magic-block" aria-hidden="true">■</i>rarely</span> are bigger than zero.</p>
</section><section id="better-fill-colors" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="better-fill-colors">Better fill colors</h2>
<p>Before writing up the final official answer, we need to tweak the plot of differences. With the comic book question, we used some overly-simplified-and-wrong color theory and created a <span style="color: #CD8A39"><i class="magic-block" aria-hidden="true">■</i>yellow</span> color for the difference (since <span style="color: #127088"><i class="magic-block" aria-hidden="true">■</i>blue</span> − <span style="color: #57643C"><i class="magic-block" aria-hidden="true">■</i>green</span> = <span style="color: #CD8A39"><i class="magic-block" aria-hidden="true">■</i>yellow</span>). We could maybe do that here too, but we’ve actually used all primary colors in our Superman palette. I don’t know what <span style="color: #009DDC"><i class="magic-block" aria-hidden="true">■</i>blue</span> − <span style="color: #FFDE00"><i class="magic-block" aria-hidden="true">■</i>yellow</span> or <span style="color: #FFDE00"><i class="magic-block" aria-hidden="true">■</i>yellow</span> − <span style="color: #E51B24"><i class="magic-block" aria-hidden="true">■</i>red</span> would be, and even if I calculated it somehow, it wouldn’t be as cutely intuitive as blue minus green.</p>
<p>So instead, we’ll do some fancy fill work with the neat <a href="https://coolbutuseless.github.io/package/ggpattern/">{ggpattern} package</a>, which lets us fill ggplot geoms with multiply-colored patterns. We’ll fill each distribution of <span class="math inline">\(\theta\)</span>s with the combination of the two colors: we’ll fill the difference between <span style="color: #009DDC"><i class="magic-block" aria-hidden="true">■</i>often</span> and <span style="color: #FFDE00"><i class="magic-block" aria-hidden="true">■</i>sometimes</span> with stripes of those two colors, and so on.</p>
<p>We can’t use <code>geom/stat_halfeye()</code> because {tidybayes} does fancier geom work when plotting its density slabs, but we can use <code>geom_density_pattern()</code> to create normal density plots:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">freq_newspapers_diffs</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.epred_prop</span>, fill <span class="op">=</span> <span class="va">frequency</span>, pattern_fill <span class="op">=</span> <span class="va">frequency</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_density_pattern</span><span class="op">(</span></span>
<span>    pattern <span class="op">=</span> <span class="st">"stripe"</span>,  <span class="co"># Stripes</span></span>
<span>    pattern_density <span class="op">=</span> <span class="fl">0.5</span>,  <span class="co"># Take up 50% of the pattern (i.e. stripes equally sized)</span></span>
<span>    pattern_spacing <span class="op">=</span> <span class="fl">0.2</span>,  <span class="co"># Thicker stripes</span></span>
<span>    pattern_size <span class="op">=</span> <span class="fl">0</span>,  <span class="co"># No border on the stripes</span></span>
<span>    trim <span class="op">=</span> <span class="cn">TRUE</span>,  <span class="co"># Trim the ends of the distributions</span></span>
<span>    linewidth <span class="op">=</span> <span class="fl">0</span>  <span class="co"># No border on the distributions</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"#F012BE"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Multiply axis limits by 0.5% so that the right "pp." isn't cut off</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">label_pp</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.005</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Set colors for fills and pattern fills</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">clr_often</span>, <span class="va">clr_sometimes</span>, <span class="va">clr_often</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_pattern_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">clr_sometimes</span>, <span class="va">clr_rarely</span>, <span class="va">clr_rarely</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span>, pattern_fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Turn off legends</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Percentage point difference in proportions"</span>,</span>
<span>       y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">frequency</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_nice</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.major.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/q2-diffs-plot-patterns-1.png" class="img-fluid figure-img" style="width:90.0%" alt="Posterior distributions of the differences between various frequencies of reading newspapers among American students; all density plots are filled with two stripes corresponding to the difference of their two categories"></p>
<figcaption class="margin-caption">Posterior distributions of the differences between various frequencies of reading newspapers among American students; all density plots are filled with two stripes corresponding to the difference of their two categories</figcaption></figure>
</div>
</div>
</div>
<p>Ahhh that’s so cool!</p>
<p>The only thing that’s missing is the pointrange that we get from <code>stat_halfeye()</code> that shows the median and the 50%, 80%, and 95% credible intervals. We can calculate those ourselves and add them with <code>geom_pointinterval()</code>:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Find medians and credible intervals</span></span>
<span><span class="va">freq_newspapers_intervals</span> <span class="op">&lt;-</span> <span class="va">freq_newspapers_diffs</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">frequency</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">median_qi</span><span class="op">(</span><span class="va">.epred_prop</span>, .width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_diffs_nice</span> <span class="op">&lt;-</span> <span class="va">freq_newspapers_diffs</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.epred_prop</span>, fill <span class="op">=</span> <span class="va">frequency</span>, pattern_fill <span class="op">=</span> <span class="va">frequency</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_density_pattern</span><span class="op">(</span></span>
<span>    pattern <span class="op">=</span> <span class="st">"stripe"</span>,  <span class="co"># Stripes</span></span>
<span>    pattern_density <span class="op">=</span> <span class="fl">0.5</span>,  <span class="co"># Take up 50% of the pattern (i.e. stripes equally sized)</span></span>
<span>    pattern_spacing <span class="op">=</span> <span class="fl">0.2</span>,  <span class="co"># Thicker stripes</span></span>
<span>    pattern_size <span class="op">=</span> <span class="fl">0</span>,  <span class="co"># No border on the stripes</span></span>
<span>    trim <span class="op">=</span> <span class="cn">TRUE</span>,  <span class="co"># Trim the ends of the distributions</span></span>
<span>    linewidth <span class="op">=</span> <span class="fl">0</span>  <span class="co"># No border on the distributions</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Add 50%, 80%, and 95% intervals + median</span></span>
<span>  <span class="fu">geom_pointinterval</span><span class="op">(</span>data <span class="op">=</span> <span class="va">freq_newspapers_intervals</span>, </span>
<span>                     <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.epred_prop</span>, xmin <span class="op">=</span> <span class="va">.lower</span>, xmax <span class="op">=</span> <span class="va">.upper</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"#F012BE"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Multiply axis limits by 0.5% so that the right "pp." isn't cut off</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">label_pp</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.005</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Set colors for fills and pattern fills</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">clr_often</span>, <span class="va">clr_sometimes</span>, <span class="va">clr_often</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_pattern_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">clr_sometimes</span>, <span class="va">clr_rarely</span>, <span class="va">clr_rarely</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span>, pattern_fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Turn off legends</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Percentage point difference in proportions"</span>,</span>
<span>       y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">frequency</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Make it so the pointrange doesn't get cropped</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>clip <span class="op">=</span> <span class="st">"off"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme_nice</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.major.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">plot_diffs_nice</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/q2-diffs-plot-patterns-pointrange-1.png" class="img-fluid figure-img" style="width:90.0%" alt="Posterior distributions of the differences between various frequencies of reading newspapers among American students; density plots are filled with stripes and a pointrange shows the median and 50%, 80%, and 95% credible intervals"></p>
<figcaption class="margin-caption">Posterior distributions of the differences between various frequencies of reading newspapers among American students; density plots are filled with stripes and a pointrange shows the median and 50%, 80%, and 95% credible intervals</figcaption></figure>
</div>
</div>
</div>
<p>Perfect!</p>
</section><section id="final-answer-to-the-question-1" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="final-answer-to-the-question-1">Final answer to the question</h2>
<p>So, given these results, what’s the answer to the question “Do students in the United States vary in their frequency of reading newspapers?”? What are our three <span class="math inline">\(\theta\)</span>s? The frequencies vary, but only between <span style="color: #E51B24"><i class="magic-block" aria-hidden="true">■</i>rarely</span> and the other two categories. There’s no difference between <span style="color: #FFDE00"><i class="magic-block" aria-hidden="true">■</i>sometimes</span> and <span style="color: #009DDC"><i class="magic-block" aria-hidden="true">■</i>often</span></p>
<div class="cell page-columns page-full" data-layout-align="center">
<details open="" class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span></span>
<span>  <span class="op">(</span><span class="va">plot_props_newspaper</span> <span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Proportions"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>     <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="st">"Response proportions"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span> </span>
<span>    <span class="fu">plot_spacer</span><span class="op">(</span><span class="op">)</span> <span class="op">|</span></span>
<span>    <span class="op">(</span><span class="va">plot_diffs_nice</span> <span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Percentage point differences"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">plot_layout</span><span class="op">(</span>widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.475</span>, <span class="fl">0.05</span>, <span class="fl">0.475</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="index_files/figure-html/q2-plot-final-1.png" class="img-fluid figure-img" style="width:100.0%" alt="Posterior distribution of the proportions and difference in proportions of the frequency of reading newspapers among American students"></p>
<figcaption class="margin-caption">Posterior distribution of the proportions and difference in proportions of the frequency of reading newspapers among American students</figcaption></figure>
</div>
</div>
</div>
<p>Here’s how I’d write about the results:</p>
<blockquote class="blockquote">
<p>Students in the United States tend to read the newspaper at least sometimes, and are least likely to read it rarely. On average, 25.3% of American PISA respondents report reading the newspaper rarely (with a 95% credible interval of between 24.1% and 26.4%), compared to 37.2% reading sometimes (35.9%–38.5%) and 37.5% reading sometimes (36.1%–38.8%).</p>
<p>There is no substantial difference in proportions between those reporting reading newspapers often and sometimes. The posterior median difference is between −1.6 and 2.2 percentage points, with a median of 0.3 percentage points, and there’s only a 62.2% probability that this difference is greater than 0, which implies that the two categories are indistinguishable from each other.</p>
<p>There <em>is</em> a clear substantial difference between the proportion reading newspapers rarely and the other two responses, though. The posterior median difference between sometimes and rarely is between 10.1 and 13.7 percentage points (median = 11.9), while the difference between often and rarely is between 10.5 and 14.0 percentage points (median = 12.2). The probability that each of these differences is greater than 0 is 100%.</p>
</blockquote>
<hr>
<p>Et voila! Principled, easily interpretable, non-golem-based tests of differences in proportions using Bayesian statistics!</p>


<!-- -->

</section></section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{heiss2023,
  author = {Heiss, Andrew},
  title = {A Guide to {Bayesian} Proportion Tests with {R} and \{Brms\}},
  date = {2023-05-15},
  url = {https://www.andrewheiss.com/blog/2023/05/15/fancy-bayes-diffs-props/},
  doi = {10.59350/kw2gj-kw740},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-heiss2023" class="csl-entry quarto-appendix-citeas" role="listitem">
Heiss, Andrew. 2023. <span>“A Guide to Bayesian Proportion Tests with R
and {Brms}.”</span> May 15, 2023. <a href="https://doi.org/10.59350/kw2gj-kw740">https://doi.org/10.59350/kw2gj-kw740</a>.
</div></div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.andrewheiss\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><script src="https://giscus.app/client.js" data-repo="andrewheiss/ath-quarto" data-repo-id="R_kgDOIg6EJQ" data-category="Blog comments" data-category-id="DIC_kwDOIg6EJc4CSz92" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><input type="hidden" id="giscus-base-theme" value="light"><input type="hidden" id="giscus-alt-theme" value="dark"><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb60" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "A guide to Bayesian proportion tests with R and {brms}"</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2023-05-15</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Use R, Stan, and {brms} to calculate differences between categorical proportions in a principled Bayesian way"</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> index_files/figure-html/q2-plot-final-1.png</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="an">twitter-card:</span><span class="co"> </span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co">    image: "index_files/figure-html/q2-plot-final-1.png"</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="an">open-graph:</span><span class="co"> </span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="co">    image: "index_files/figure-html/q2-plot-final-1.png"</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="co">  - r</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a><span class="co">  - tidyverse</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="co">  - ggplot</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a><span class="co">  - bayes</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a><span class="co">  - brms</span></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a><span class="co">  - stan</span></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a><span class="co">  - surveys</span></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a><span class="co">  - categorical data</span></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a><span class="co">    reference-location: margin</span></span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: show</span></span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a><span class="an">doi:</span><span class="co"> 10.59350/kw2gj-kw740</span></span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a><span class="an">citation:</span><span class="co"> true</span></span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(fig.align = "center", fig.retina = 3,</span></span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a><span class="in">                      fig.width = 6, fig.height = (6 / 1.618),</span></span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a><span class="in">                      out.width = "90%", collapse = TRUE,</span></span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a><span class="in">                      dev = "ragg_png",</span></span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a><span class="in">                      cache.extra = 1234)  # Change number to invalidate cache</span></span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a><span class="in">options(digits = 3, width = 300,</span></span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a><span class="in">        dplyr.summarise.inform = FALSE)</span></span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(1234)</span></span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-39"><a href="#cb60-39" aria-hidden="true" tabindex="-1"></a><span class="in">```{css echo=FALSE}</span></span>
<span id="cb60-40"><a href="#cb60-40" aria-hidden="true" tabindex="-1"></a><span class="in">.magic-block {</span></span>
<span id="cb60-41"><a href="#cb60-41" aria-hidden="true" tabindex="-1"></a><span class="in">  font-style: normal;</span></span>
<span id="cb60-42"><a href="#cb60-42" aria-hidden="true" tabindex="-1"></a><span class="in">  user-select: none;</span></span>
<span id="cb60-43"><a href="#cb60-43" aria-hidden="true" tabindex="-1"></a><span class="in">  padding: 0 0.1em 0 0.15em;</span></span>
<span id="cb60-44"><a href="#cb60-44" aria-hidden="true" tabindex="-1"></a><span class="in">  line-height: 1;</span></span>
<span id="cb60-45"><a href="#cb60-45" aria-hidden="true" tabindex="-1"></a><span class="in">  font-size: 120%;</span></span>
<span id="cb60-46"><a href="#cb60-46" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb60-47"><a href="#cb60-47" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-48"><a href="#cb60-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-49"><a href="#cb60-49" aria-hidden="true" tabindex="-1"></a>I've been working on converting a couple of my dissertation chapters into standalone articles, so I've been revisiting and improving my older R code. As part of my dissertation work, I ran a global survey of international NGOs to see how they adjust their programs and strategies when working under authoritarian legal restrictions in dictatorship. In the survey, I asked a bunch of questions with categorical responses (like "How would you characterize your organization's relationship with your host-country government?", with the possible responses "Positive," "Negative", and "Neither"). </span>
<span id="cb60-50"><a href="#cb60-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-51"><a href="#cb60-51" aria-hidden="true" tabindex="-1"></a>Analyzing this kind of categorical data can be tricky. What I ended up doing (and what people typically do) is looking at the differences in proportions of responses (i.e. is there a substantial difference in the proportion reporting "Positive" or "Negative" in different subgroups?). But doing this requires a little bit of extra work because of how proportions work. We can't just treat proportions like continuous values. Denominators matter and help determine the level of uncertainty in the proportions. We need to account for these disparate sample sizes underlying the proportions.</span>
<span id="cb60-52"><a href="#cb60-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-53"><a href="#cb60-53" aria-hidden="true" tabindex="-1"></a>Additionally, it's tempting to treat <span class="co">[</span><span class="ot">Likert scale responses</span><span class="co">](https://en.wikipedia.org/wiki/Likert_scale)</span>^<span class="co">[</span><span class="ot">Pronounced "lick-ert"!</span><span class="co">]</span> (i.e. things like "strongly agree", "agree", "neutral", etc.) as numbers (e.g. make "strongly agree" a 2, "agree" a 1, "neutral" a 0, and so on), and then find things like averages (e.g. "the average response is a 1.34"), but those summary statistics aren't actually that accurate. What would a 1.34 mean? A little higher than agree? What does that even mean?</span>
<span id="cb60-54"><a href="#cb60-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-55"><a href="#cb60-55" aria-hidden="true" tabindex="-1"></a>We need to treat these kinds of survey questions as the categories that they are, which requires a different set of analytical tools than just findings averages and running linear regressions. We instead need to use things like frequencies, proportions, <span class="co">[</span><span class="ot">contingency tables and crosstabs</span><span class="co">](https://en.wikipedia.org/wiki/Contingency_table)</span>, and fancier regression like ordered logistic models.</span>
<span id="cb60-56"><a href="#cb60-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-57"><a href="#cb60-57" aria-hidden="true" tabindex="-1"></a>I'm a fan of Bayesian statistical inference—I find it way more intuitive and straightforward than frequentist null hypothesis testing. I first "converted" to Bayesianism back when I first analyzed my dissertation data in 2017 and used the newly-invented <span class="co">[</span><span class="ot">{rstanarm} package</span><span class="co">](https://mc-stan.org/rstanarm/)</span> to calculate the difference in proportions of my various survey responses in Bayesian ways, based on <span class="co">[</span><span class="ot">a blog post and package for Bayesian proportion tests by Rasmus Bååth</span><span class="co">](https://www.sumsar.net/blog/2014/06/bayesian-first-aid-prop-test/)</span>. He used <span class="co">[</span><span class="ot">JAGS</span><span class="co">](https://mcmc-jags.sourceforge.io/)</span>, though, and I prefer to use <span class="co">[</span><span class="ot">Stan</span><span class="co">](https://mc-stan.org/)</span>, hence my use of {rstanarm} back then.</span>
<span id="cb60-58"><a href="#cb60-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-59"><a href="#cb60-59" aria-hidden="true" tabindex="-1"></a>Since 2017, though, I've learned a lot more about Bayesianism. I've <span class="co">[</span><span class="ot">worked</span><span class="co">](https://bayesf22.classes.andrewheiss.com/)</span> <span class="co">[</span><span class="ot">through</span><span class="co">](https://bayesf22-notebook.classes.andrewheiss.com/)</span> both <span class="co">[</span><span class="ot">Richard McElreath's *Statistical Rethinking*</span><span class="co">](https://xcelab.net/rm/statistical-rethinking/)</span> and <span class="co">[</span><span class="ot">the gloriously accessible *Bayes Rules!*</span><span class="co">](https://www.bayesrulesbook.com/)</span>, and I no longer use {rstanarm}. I instead use <span class="co">[</span><span class="ot">{brms}</span><span class="co">](https://paul-buerkner.github.io/brms/)</span> for everything (or raw Stan if I'm feeling extra fancy).</span>
<span id="cb60-60"><a href="#cb60-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-61"><a href="#cb60-61" aria-hidden="true" tabindex="-1"></a>So, as a reference for myself while rewriting these chapters, and as a way to consolidate everything I've learned about Bayesian-flavored proportion tests, here's a guide to thinking about differences in proportions in a principled Bayesian way. I explore two different questions (explained in detail below). For the first one I'll be super pedagogical and long-winded, showing how to find differences in proportions with classical frequentist statistical tests, with different variations of Stan code, and with different variations of {brms} code. For the second one I'll be less pedagogical and just show the code and results.</span>
<span id="cb60-62"><a href="#cb60-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-63"><a href="#cb60-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-64"><a href="#cb60-64" aria-hidden="true" tabindex="-1"></a><span class="fu"># Who this post is for</span></span>
<span id="cb60-65"><a href="#cb60-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-66"><a href="#cb60-66" aria-hidden="true" tabindex="-1"></a>Here's what I assume you know:</span>
<span id="cb60-67"><a href="#cb60-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-68"><a href="#cb60-68" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You're familiar with <span class="co">[</span><span class="ot">R</span><span class="co">](https://www.r-project.org/)</span> and the <span class="co">[</span><span class="ot">tidyverse</span><span class="co">](https://www.tidyverse.org/)</span> (particularly <span class="co">[</span><span class="ot">{dplyr}</span><span class="co">](https://dplyr.tidyverse.org/)</span> and <span class="co">[</span><span class="ot">{ggplot2}</span><span class="co">](https://ggplot2.tidyverse.org/)</span>).</span>
<span id="cb60-69"><a href="#cb60-69" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You're familiar with <span class="co">[</span><span class="ot">{brms}</span><span class="co">](https://paul-buerkner.github.io/brms/)</span> for running Bayesian regression models and <span class="co">[</span><span class="ot">{tidybayes}</span><span class="co">](https://mjskay.github.io/tidybayes/)</span> and <span class="co">[</span><span class="ot">{ggdist}</span><span class="co">](https://mjskay.github.io/ggdist/)</span> for manipulating and plotting posterior draws</span>
<span id="cb60-70"><a href="#cb60-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-71"><a href="#cb60-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-72"><a href="#cb60-72" aria-hidden="true" tabindex="-1"></a><span class="fu"># Wrangling and exploring the data</span></span>
<span id="cb60-73"><a href="#cb60-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-74"><a href="#cb60-74" aria-hidden="true" tabindex="-1"></a>Before getting started, let's load all the packages we need and create some helpful functions and variables:</span>
<span id="cb60-75"><a href="#cb60-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-76"><a href="#cb60-76" aria-hidden="true" tabindex="-1"></a><span class="in">```{r libraries, warning=FALSE, message=FALSE}</span></span>
<span id="cb60-77"><a href="#cb60-77" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)    # ggplot, dplyr, and friends</span></span>
<span id="cb60-78"><a href="#cb60-78" aria-hidden="true" tabindex="-1"></a><span class="in">library(gt)           # Fancy tables</span></span>
<span id="cb60-79"><a href="#cb60-79" aria-hidden="true" tabindex="-1"></a><span class="in">library(glue)         # Easier string interpolation</span></span>
<span id="cb60-80"><a href="#cb60-80" aria-hidden="true" tabindex="-1"></a><span class="in">library(scales)       # Nicer labeling functions</span></span>
<span id="cb60-81"><a href="#cb60-81" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggmosaic)     # Mosaic plots with ggplot</span></span>
<span id="cb60-82"><a href="#cb60-82" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggpattern)    # Pattern fills in ggplot</span></span>
<span id="cb60-83"><a href="#cb60-83" aria-hidden="true" tabindex="-1"></a><span class="in">library(patchwork)    # Combine plots nicely</span></span>
<span id="cb60-84"><a href="#cb60-84" aria-hidden="true" tabindex="-1"></a><span class="in">library(parameters)   # Extract model parameters as data frames</span></span>
<span id="cb60-85"><a href="#cb60-85" aria-hidden="true" tabindex="-1"></a><span class="in">library(cmdstanr)     # Run Stan code from R</span></span>
<span id="cb60-86"><a href="#cb60-86" aria-hidden="true" tabindex="-1"></a><span class="in">library(brms)         # Nice frontend for Stan</span></span>
<span id="cb60-87"><a href="#cb60-87" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidybayes)    # Manipulate MCMC chains in a tidy way</span></span>
<span id="cb60-88"><a href="#cb60-88" aria-hidden="true" tabindex="-1"></a><span class="in">library(likert)       # Contains the pisaitems data</span></span>
<span id="cb60-89"><a href="#cb60-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-90"><a href="#cb60-90" aria-hidden="true" tabindex="-1"></a><span class="in"># Use the cmdstanr backend for brms because it's faster and more modern than the</span></span>
<span id="cb60-91"><a href="#cb60-91" aria-hidden="true" tabindex="-1"></a><span class="in"># default rstan backend. You need to install the cmdstanr package first</span></span>
<span id="cb60-92"><a href="#cb60-92" aria-hidden="true" tabindex="-1"></a><span class="in"># (https://mc-stan.org/cmdstanr/) and then run cmdstanr::install_cmdstan() to</span></span>
<span id="cb60-93"><a href="#cb60-93" aria-hidden="true" tabindex="-1"></a><span class="in"># install cmdstan on your computer.</span></span>
<span id="cb60-94"><a href="#cb60-94" aria-hidden="true" tabindex="-1"></a><span class="in">options(mc.cores = 4,</span></span>
<span id="cb60-95"><a href="#cb60-95" aria-hidden="true" tabindex="-1"></a><span class="in">        brms.backend = "cmdstanr")</span></span>
<span id="cb60-96"><a href="#cb60-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-97"><a href="#cb60-97" aria-hidden="true" tabindex="-1"></a><span class="in"># Set some global Stan options</span></span>
<span id="cb60-98"><a href="#cb60-98" aria-hidden="true" tabindex="-1"></a><span class="in">CHAINS &lt;- 4</span></span>
<span id="cb60-99"><a href="#cb60-99" aria-hidden="true" tabindex="-1"></a><span class="in">ITER &lt;- 2000</span></span>
<span id="cb60-100"><a href="#cb60-100" aria-hidden="true" tabindex="-1"></a><span class="in">WARMUP &lt;- 1000</span></span>
<span id="cb60-101"><a href="#cb60-101" aria-hidden="true" tabindex="-1"></a><span class="in">BAYES_SEED &lt;- 1234</span></span>
<span id="cb60-102"><a href="#cb60-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-103"><a href="#cb60-103" aria-hidden="true" tabindex="-1"></a><span class="in"># Custom ggplot theme to make pretty plots</span></span>
<span id="cb60-104"><a href="#cb60-104" aria-hidden="true" tabindex="-1"></a><span class="in"># Get the font at https://fonts.google.com/specimen/Jost</span></span>
<span id="cb60-105"><a href="#cb60-105" aria-hidden="true" tabindex="-1"></a><span class="in">theme_nice &lt;- function() {</span></span>
<span id="cb60-106"><a href="#cb60-106" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal(base_family = "Jost") +</span></span>
<span id="cb60-107"><a href="#cb60-107" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(panel.grid.minor = element_blank(),</span></span>
<span id="cb60-108"><a href="#cb60-108" aria-hidden="true" tabindex="-1"></a><span class="in">          plot.title = element_text(family = "Jost", face = "bold"),</span></span>
<span id="cb60-109"><a href="#cb60-109" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.title = element_text(family = "Jost Medium"),</span></span>
<span id="cb60-110"><a href="#cb60-110" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.title.x = element_text(hjust = 0),</span></span>
<span id="cb60-111"><a href="#cb60-111" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.title.y = element_text(hjust = 1),</span></span>
<span id="cb60-112"><a href="#cb60-112" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.text = element_text(family = "Jost", face = "bold",</span></span>
<span id="cb60-113"><a href="#cb60-113" aria-hidden="true" tabindex="-1"></a><span class="in">                                    size = rel(1), hjust = 0),</span></span>
<span id="cb60-114"><a href="#cb60-114" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.background = element_rect(fill = NA, color = NA))</span></span>
<span id="cb60-115"><a href="#cb60-115" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb60-116"><a href="#cb60-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-117"><a href="#cb60-117" aria-hidden="true" tabindex="-1"></a><span class="in"># Function for formatting axes as percentage points</span></span>
<span id="cb60-118"><a href="#cb60-118" aria-hidden="true" tabindex="-1"></a><span class="in">label_pp &lt;- label_number(accuracy = 1, scale = 100, </span></span>
<span id="cb60-119"><a href="#cb60-119" aria-hidden="true" tabindex="-1"></a><span class="in">                         suffix = " pp.", style_negative = "minus")</span></span>
<span id="cb60-120"><a href="#cb60-120" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-121"><a href="#cb60-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-122"><a href="#cb60-122" aria-hidden="true" tabindex="-1"></a><span class="in">```{r show-nice-pal, include=FALSE}</span></span>
<span id="cb60-123"><a href="#cb60-123" aria-hidden="true" tabindex="-1"></a><span class="in"># US/Mexico question colors</span></span>
<span id="cb60-124"><a href="#cb60-124" aria-hidden="true" tabindex="-1"></a><span class="in">clrs_saguaro &lt;- NatParksPalettes::natparks.pals("Saguaro")</span></span>
<span id="cb60-125"><a href="#cb60-125" aria-hidden="true" tabindex="-1"></a><span class="in">clr_usa &lt;- clrs_saguaro[1]</span></span>
<span id="cb60-126"><a href="#cb60-126" aria-hidden="true" tabindex="-1"></a><span class="in">clr_mex &lt;- clrs_saguaro[6]</span></span>
<span id="cb60-127"><a href="#cb60-127" aria-hidden="true" tabindex="-1"></a><span class="in">clr_diff &lt;- clrs_saguaro[4]</span></span>
<span id="cb60-128"><a href="#cb60-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-129"><a href="#cb60-129" aria-hidden="true" tabindex="-1"></a><span class="in"># US newspaper question colors</span></span>
<span id="cb60-130"><a href="#cb60-130" aria-hidden="true" tabindex="-1"></a><span class="in">clr_often &lt;- "#009DDC"</span></span>
<span id="cb60-131"><a href="#cb60-131" aria-hidden="true" tabindex="-1"></a><span class="in">clr_sometimes &lt;- "#FFDE00"</span></span>
<span id="cb60-132"><a href="#cb60-132" aria-hidden="true" tabindex="-1"></a><span class="in">clr_rarely &lt;- "#E51B24"</span></span>
<span id="cb60-133"><a href="#cb60-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-134"><a href="#cb60-134" aria-hidden="true" tabindex="-1"></a><span class="in">show_nice_pal &lt;- function(pal, nrow = 1, use_names = FALSE, show_text = TRUE) {</span></span>
<span id="cb60-135"><a href="#cb60-135" aria-hidden="true" tabindex="-1"></a><span class="in">  out &lt;- tibble(x = 1:length(pal),</span></span>
<span id="cb60-136"><a href="#cb60-136" aria-hidden="true" tabindex="-1"></a><span class="in">                names = names(pal),</span></span>
<span id="cb60-137"><a href="#cb60-137" aria-hidden="true" tabindex="-1"></a><span class="in">                color = pal) %&gt;% </span></span>
<span id="cb60-138"><a href="#cb60-138" aria-hidden="true" tabindex="-1"></a><span class="in">    rowwise() %&gt;% </span></span>
<span id="cb60-139"><a href="#cb60-139" aria-hidden="true" tabindex="-1"></a><span class="in">    mutate(color_title = ifelse(use_names, names, glue::glue("[{x}]"))) %&gt;% </span></span>
<span id="cb60-140"><a href="#cb60-140" aria-hidden="true" tabindex="-1"></a><span class="in">    ungroup() %&gt;% </span></span>
<span id="cb60-141"><a href="#cb60-141" aria-hidden="true" tabindex="-1"></a><span class="in">    mutate(across(c(color, color_title), ~fct_inorder(.))) %&gt;% </span></span>
<span id="cb60-142"><a href="#cb60-142" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot(aes(x = color, y = 1, fill = color)) +</span></span>
<span id="cb60-143"><a href="#cb60-143" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_tile() +</span></span>
<span id="cb60-144"><a href="#cb60-144" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_x_discrete(expand = c(0, 0)) +</span></span>
<span id="cb60-145"><a href="#cb60-145" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_fill_identity() +</span></span>
<span id="cb60-146"><a href="#cb60-146" aria-hidden="true" tabindex="-1"></a><span class="in">    facet_wrap(vars(color_title), scales = "free_x", nrow = nrow) +</span></span>
<span id="cb60-147"><a href="#cb60-147" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_void(base_family = "Inconsolata") +</span></span>
<span id="cb60-148"><a href="#cb60-148" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(panel.spacing.x = unit(-1, units = "pt"),</span></span>
<span id="cb60-149"><a href="#cb60-149" aria-hidden="true" tabindex="-1"></a><span class="in">          panel.spacing.y = unit(-0.5, units = "lines"),</span></span>
<span id="cb60-150"><a href="#cb60-150" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.text = element_blank())</span></span>
<span id="cb60-151"><a href="#cb60-151" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb60-152"><a href="#cb60-152" aria-hidden="true" tabindex="-1"></a><span class="in">  if (show_text) {</span></span>
<span id="cb60-153"><a href="#cb60-153" aria-hidden="true" tabindex="-1"></a><span class="in">    out &lt;- out + </span></span>
<span id="cb60-154"><a href="#cb60-154" aria-hidden="true" tabindex="-1"></a><span class="in">      theme(axis.text.x = element_text(margin = margin(b = 5)),</span></span>
<span id="cb60-155"><a href="#cb60-155" aria-hidden="true" tabindex="-1"></a><span class="in">            strip.text = element_text(family = ifelse(use_names, "Jost", "Inconsolata"),</span></span>
<span id="cb60-156"><a href="#cb60-156" aria-hidden="true" tabindex="-1"></a><span class="in">                                      size = rel(1.1), margin = margin(t = 5)),</span></span>
<span id="cb60-157"><a href="#cb60-157" aria-hidden="true" tabindex="-1"></a><span class="in">            panel.spacing.y = unit(0, units = "lines"))</span></span>
<span id="cb60-158"><a href="#cb60-158" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb60-159"><a href="#cb60-159" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb60-160"><a href="#cb60-160" aria-hidden="true" tabindex="-1"></a><span class="in">  return(out)</span></span>
<span id="cb60-161"><a href="#cb60-161" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb60-162"><a href="#cb60-162" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-163"><a href="#cb60-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-164"><a href="#cb60-164" aria-hidden="true" tabindex="-1"></a><span class="in">```{r html-helpers, include=FALSE}</span></span>
<span id="cb60-165"><a href="#cb60-165" aria-hidden="true" tabindex="-1"></a><span class="in">span_col &lt;- function(text, color) {</span></span>
<span id="cb60-166"><a href="#cb60-166" aria-hidden="true" tabindex="-1"></a><span class="in">  glue::glue('&lt;span style="color: {color}"&gt;',</span></span>
<span id="cb60-167"><a href="#cb60-167" aria-hidden="true" tabindex="-1"></a><span class="in">             '&lt;i class="magic-block" aria-hidden="true"&gt;■&lt;/i&gt;',</span></span>
<span id="cb60-168"><a href="#cb60-168" aria-hidden="true" tabindex="-1"></a><span class="in">             '{text}',</span></span>
<span id="cb60-169"><a href="#cb60-169" aria-hidden="true" tabindex="-1"></a><span class="in">             '&lt;/span&gt;')</span></span>
<span id="cb60-170"><a href="#cb60-170" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb60-171"><a href="#cb60-171" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-172"><a href="#cb60-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-173"><a href="#cb60-173" aria-hidden="true" tabindex="-1"></a>Throughout this guide, we'll use data from the 2009 <span class="co">[</span><span class="ot">Programme of International Student Assessment (PISA) survey</span><span class="co">](https://en.wikipedia.org/wiki/Programme_for_International_Student_Assessment)</span>, which is available in the <span class="co">[</span><span class="ot">{likert} package</span><span class="co">](https://github.com/jbryer/likert)</span>. PISA is administered every three years to 15-year-old students in dozens of countries, and it tracks academic performance, outcomes, and student attitudes cross-nationally. </span>
<span id="cb60-174"><a href="#cb60-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-175"><a href="#cb60-175" aria-hidden="true" tabindex="-1"></a>One of the questions on the <span class="co">[</span><span class="ot">PISA student questionnaire</span><span class="co">](https://www.oecd.org/pisa/pisaproducts/PISA09_Student_questionnaire.pdf)</span> (Q25) asks respondents how often they read different types of materials:</span>
<span id="cb60-176"><a href="#cb60-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-177"><a href="#cb60-177" aria-hidden="true" tabindex="-1"></a><span class="al">![2009 PISA Q25](img/pisa.png)</span></span>
<span id="cb60-178"><a href="#cb60-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-179"><a href="#cb60-179" aria-hidden="true" tabindex="-1"></a>The excerpt of PISA data included in the {likert} package only includes responses from Canada, Mexico, and the United States, and for this question it seems to omit data from Canada, so we'll compare the reading frequencies of American and Mexican students. Specifically we'll look at how these students read comic books and newspapers. My wife is currently finishing her masters thesis on religious representation in graphic novels, and I'm a fan of comics in general, so it'll be interesting to see how students in the two countries read these books. We'll look at newspapers because it's an interesting category with some helpful variation (reading trends for magazines, fiction, and nonfiction look basically the same in both countries so we'll ignore them here.)</span>
<span id="cb60-180"><a href="#cb60-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-181"><a href="#cb60-181" aria-hidden="true" tabindex="-1"></a>First we'll load and clean the data. For the sake of illustration in this post, I collapse the five possible responses into just three:</span>
<span id="cb60-182"><a href="#cb60-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-183"><a href="#cb60-183" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Rarely = Never or almost never</span>
<span id="cb60-184"><a href="#cb60-184" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Sometimes = A few times a year &amp; About once a month</span>
<span id="cb60-185"><a href="#cb60-185" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Often = Several times a month &amp; Several times a week</span>
<span id="cb60-186"><a href="#cb60-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-187"><a href="#cb60-187" aria-hidden="true" tabindex="-1"></a>In real life it's typically a bad idea to collapse categories like this, and I'm not an education researcher so this collapsing is probably bad and wrong, but whatever—just go with it :)</span>
<span id="cb60-188"><a href="#cb60-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-189"><a href="#cb60-189" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load-clean-data}</span></span>
<span id="cb60-190"><a href="#cb60-190" aria-hidden="true" tabindex="-1"></a><span class="in"># Load the data</span></span>
<span id="cb60-191"><a href="#cb60-191" aria-hidden="true" tabindex="-1"></a><span class="in">data("pisaitems", package = "likert")</span></span>
<span id="cb60-192"><a href="#cb60-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-193"><a href="#cb60-193" aria-hidden="true" tabindex="-1"></a><span class="in"># Make a clean wide version of the data</span></span>
<span id="cb60-194"><a href="#cb60-194" aria-hidden="true" tabindex="-1"></a><span class="in">reading_wide &lt;- pisaitems %&gt;% </span></span>
<span id="cb60-195"><a href="#cb60-195" aria-hidden="true" tabindex="-1"></a><span class="in">  # Add ID column</span></span>
<span id="cb60-196"><a href="#cb60-196" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(id = 1:n()) %&gt;%</span></span>
<span id="cb60-197"><a href="#cb60-197" aria-hidden="true" tabindex="-1"></a><span class="in">  # Only keep a few columns</span></span>
<span id="cb60-198"><a href="#cb60-198" aria-hidden="true" tabindex="-1"></a><span class="in">  select(id, country = CNT, `Comic books` = ST25Q02, Newspapers = ST25Q05) %&gt;% </span></span>
<span id="cb60-199"><a href="#cb60-199" aria-hidden="true" tabindex="-1"></a><span class="in">  # Collapse these categories</span></span>
<span id="cb60-200"><a href="#cb60-200" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(c(`Comic books`, Newspapers), </span></span>
<span id="cb60-201"><a href="#cb60-201" aria-hidden="true" tabindex="-1"></a><span class="in">                ~fct_collapse(</span></span>
<span id="cb60-202"><a href="#cb60-202" aria-hidden="true" tabindex="-1"></a><span class="in">                  .,</span></span>
<span id="cb60-203"><a href="#cb60-203" aria-hidden="true" tabindex="-1"></a><span class="in">                  "Rarely" = c("Never or almost never"),</span></span>
<span id="cb60-204"><a href="#cb60-204" aria-hidden="true" tabindex="-1"></a><span class="in">                  "Sometimes" = c("A few times a year", "About once a month"),</span></span>
<span id="cb60-205"><a href="#cb60-205" aria-hidden="true" tabindex="-1"></a><span class="in">                  "Often" = c("Several times a month", "Several times a week")))) %&gt;% </span></span>
<span id="cb60-206"><a href="#cb60-206" aria-hidden="true" tabindex="-1"></a><span class="in">  # Make sure the new categories are ordered correctly</span></span>
<span id="cb60-207"><a href="#cb60-207" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(c(`Comic books`, Newspapers), </span></span>
<span id="cb60-208"><a href="#cb60-208" aria-hidden="true" tabindex="-1"></a><span class="in">                ~fct_relevel(., c("Rarely", "Sometimes", "Often")))) %&gt;% </span></span>
<span id="cb60-209"><a href="#cb60-209" aria-hidden="true" tabindex="-1"></a><span class="in">  # Only keep the US and Mexico and get rid of the empty Canada level</span></span>
<span id="cb60-210"><a href="#cb60-210" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(country %in% c("United States", "Mexico")) %&gt;% </span></span>
<span id="cb60-211"><a href="#cb60-211" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(country = fct_drop(country))</span></span>
<span id="cb60-212"><a href="#cb60-212" aria-hidden="true" tabindex="-1"></a><span class="in">head(reading_wide)</span></span>
<span id="cb60-213"><a href="#cb60-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-214"><a href="#cb60-214" aria-hidden="true" tabindex="-1"></a><span class="in"># Make a tidy (long) version</span></span>
<span id="cb60-215"><a href="#cb60-215" aria-hidden="true" tabindex="-1"></a><span class="in">reading &lt;- reading_wide %&gt;% </span></span>
<span id="cb60-216"><a href="#cb60-216" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_longer(-c(id, country),</span></span>
<span id="cb60-217"><a href="#cb60-217" aria-hidden="true" tabindex="-1"></a><span class="in">               names_to = "book_type",</span></span>
<span id="cb60-218"><a href="#cb60-218" aria-hidden="true" tabindex="-1"></a><span class="in">               values_to = "frequency") %&gt;% </span></span>
<span id="cb60-219"><a href="#cb60-219" aria-hidden="true" tabindex="-1"></a><span class="in">  drop_na(frequency)</span></span>
<span id="cb60-220"><a href="#cb60-220" aria-hidden="true" tabindex="-1"></a><span class="in">head(reading)</span></span>
<span id="cb60-221"><a href="#cb60-221" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-222"><a href="#cb60-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-223"><a href="#cb60-223" aria-hidden="true" tabindex="-1"></a>Since we created a tidy (long) version of the data, we can use {dplyr} to create some overall group summaries of reading frequency by type of material across countries. Having data in this format, with a column for the specific total (i.e. Mexico + Comic books + Rarely, and so on, or <span class="in">`n`</span> here) and the overall country total (or <span class="in">`total`</span> here), allows us to calculate group proportions (<span class="in">`n / total`</span>):</span>
<span id="cb60-224"><a href="#cb60-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-225"><a href="#cb60-225" aria-hidden="true" tabindex="-1"></a><span class="in">```{r collapse-data-counts}</span></span>
<span id="cb60-226"><a href="#cb60-226" aria-hidden="true" tabindex="-1"></a><span class="in">reading_counts &lt;- reading %&gt;% </span></span>
<span id="cb60-227"><a href="#cb60-227" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(country, book_type, frequency) %&gt;% </span></span>
<span id="cb60-228"><a href="#cb60-228" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(n = n()) %&gt;% </span></span>
<span id="cb60-229"><a href="#cb60-229" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(country, book_type) %&gt;% </span></span>
<span id="cb60-230"><a href="#cb60-230" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(total = sum(n),</span></span>
<span id="cb60-231"><a href="#cb60-231" aria-hidden="true" tabindex="-1"></a><span class="in">         prop = n / sum(n)) %&gt;% </span></span>
<span id="cb60-232"><a href="#cb60-232" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup()</span></span>
<span id="cb60-233"><a href="#cb60-233" aria-hidden="true" tabindex="-1"></a><span class="in">reading_counts</span></span>
<span id="cb60-234"><a href="#cb60-234" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-235"><a href="#cb60-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-236"><a href="#cb60-236" aria-hidden="true" tabindex="-1"></a>And we can do a little pivoting and formatting and make this nice little contingency table / crosstab summarizing the data across the two countries:</span>
<span id="cb60-237"><a href="#cb60-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-238"><a href="#cb60-238" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tab-fancy-initial}</span></span>
<span id="cb60-239"><a href="#cb60-239" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb60-240"><a href="#cb60-240" aria-hidden="true" tabindex="-1"></a><span class="in">fancy_table &lt;- reading_counts %&gt;% </span></span>
<span id="cb60-241"><a href="#cb60-241" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(nice = glue("{prop}&lt;br&gt;&lt;span style='font-size:70%'&gt;({n})&lt;/span&gt;",</span></span>
<span id="cb60-242"><a href="#cb60-242" aria-hidden="true" tabindex="-1"></a><span class="in">                     prop = label_percent()(prop),</span></span>
<span id="cb60-243"><a href="#cb60-243" aria-hidden="true" tabindex="-1"></a><span class="in">                     n = label_comma()(n))) %&gt;% </span></span>
<span id="cb60-244"><a href="#cb60-244" aria-hidden="true" tabindex="-1"></a><span class="in">  select(-n, -prop, -total) %&gt;% </span></span>
<span id="cb60-245"><a href="#cb60-245" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_wider(names_from = "frequency",</span></span>
<span id="cb60-246"><a href="#cb60-246" aria-hidden="true" tabindex="-1"></a><span class="in">              values_from = "nice") %&gt;% </span></span>
<span id="cb60-247"><a href="#cb60-247" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(country) %&gt;%</span></span>
<span id="cb60-248"><a href="#cb60-248" aria-hidden="true" tabindex="-1"></a><span class="in">  gt() %&gt;%</span></span>
<span id="cb60-249"><a href="#cb60-249" aria-hidden="true" tabindex="-1"></a><span class="in">  cols_label(</span></span>
<span id="cb60-250"><a href="#cb60-250" aria-hidden="true" tabindex="-1"></a><span class="in">    book_type = "",</span></span>
<span id="cb60-251"><a href="#cb60-251" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb60-252"><a href="#cb60-252" aria-hidden="true" tabindex="-1"></a><span class="in">  fmt_markdown(</span></span>
<span id="cb60-253"><a href="#cb60-253" aria-hidden="true" tabindex="-1"></a><span class="in">    columns = everything()</span></span>
<span id="cb60-254"><a href="#cb60-254" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb60-255"><a href="#cb60-255" aria-hidden="true" tabindex="-1"></a><span class="in">  opt_horizontal_padding(3) %&gt;% </span></span>
<span id="cb60-256"><a href="#cb60-256" aria-hidden="true" tabindex="-1"></a><span class="in">  opt_table_font(font = "Fira Sans") %&gt;% </span></span>
<span id="cb60-257"><a href="#cb60-257" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_options(column_labels.font.weight = "bold",</span></span>
<span id="cb60-258"><a href="#cb60-258" aria-hidden="true" tabindex="-1"></a><span class="in">              row_group.font.weight = "bold")</span></span>
<span id="cb60-259"><a href="#cb60-259" aria-hidden="true" tabindex="-1"></a><span class="in">fancy_table</span></span>
<span id="cb60-260"><a href="#cb60-260" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-261"><a href="#cb60-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-262"><a href="#cb60-262" aria-hidden="true" tabindex="-1"></a>This table has a lot of numbers and it's hard to immediately see what's going on, so we'll visualize it really quick to get a sense for some of the initial trends. Visualizing this is a little tricky though. It's easy enough to make a bar chart of the percentages, but doing that is a little misleading. Notice the huge differences in the numbers of respondents here—there are thousands of Mexican students and only hundreds of American students. <span class="co">[</span><span class="ot">We should probably visualize the data in a way that accounts for these different denominators</span><span class="co">](https://clauswilke.com/dataviz/nested-proportions.html)</span>, and percentages by themselves don't do that.</span>
<span id="cb60-263"><a href="#cb60-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-264"><a href="#cb60-264" aria-hidden="true" tabindex="-1"></a>We can use a <span class="co">[</span><span class="ot">mosaic plot</span><span class="co">](https://en.wikipedia.org/wiki/Mosaic_plot)</span> (also known as a <span class="co">[</span><span class="ot">Marimekko chart</span><span class="co">](https://datavizcatalogue.com/methods/marimekko_chart.html)</span>) to visualize both the distribution of proportions of responses (Rarely, Sometimes, Often) and the proportions of respondents from each country (Mexico and the United States). We can use the <span class="co">[</span><span class="ot">{ggmosaic} package</span><span class="co">](https://haleyjeppson.github.io/ggmosaic/)</span> to create ggplot-flavored mosaic plots:</span>
<span id="cb60-265"><a href="#cb60-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-266"><a href="#cb60-266" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb60-267"><a href="#cb60-267" aria-hidden="true" tabindex="-1"></a><span class="fu">## Base R works too!</span></span>
<span id="cb60-268"><a href="#cb60-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-269"><a href="#cb60-269" aria-hidden="true" tabindex="-1"></a>Mosaic plots are actually also built into base R! </span>
<span id="cb60-270"><a href="#cb60-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-271"><a href="#cb60-271" aria-hidden="true" tabindex="-1"></a>Try running <span class="in">`plot(table(mtcars$cyl, mtcars$am))`</span>.</span>
<span id="cb60-272"><a href="#cb60-272" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb60-273"><a href="#cb60-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-274"><a href="#cb60-274" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-mosaic, warning=FALSE}</span></span>
<span id="cb60-275"><a href="#cb60-275" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Mosaic plot of the proportions of comic book and newspaper reading frequency in the United States and Mexico"</span></span>
<span id="cb60-276"><a href="#cb60-276" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: "Mosaic plot of the proportions of comic book and newspaper reading frequency in the United States and Mexico"</span></span>
<span id="cb60-277"><a href="#cb60-277" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(reading) +</span></span>
<span id="cb60-278"><a href="#cb60-278" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_mosaic(aes(x = product(frequency, country),  # Look at combination of frequency by country</span></span>
<span id="cb60-279"><a href="#cb60-279" aria-hidden="true" tabindex="-1"></a><span class="in">                  fill = frequency, alpha = country),</span></span>
<span id="cb60-280"><a href="#cb60-280" aria-hidden="true" tabindex="-1"></a><span class="in">              divider = mosaic("v"),  # Make the plot divide vertically</span></span>
<span id="cb60-281"><a href="#cb60-281" aria-hidden="true" tabindex="-1"></a><span class="in">              offset = 0, color = "white", linewidth = 1) +  # Add thin white border around boxes</span></span>
<span id="cb60-282"><a href="#cb60-282" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_productlist(expand = c(0, 0.02)) +  # Make the x-axis take up almost the full panel width, with 2% spacing on each side</span></span>
<span id="cb60-283"><a href="#cb60-283" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_productlist(expand = c(0, 0)) +  # Make the y-axis take up the full panel width</span></span>
<span id="cb60-284"><a href="#cb60-284" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = c("#E51B24", "#FFDE00", "#009DDC"), guide = "none") +</span></span>
<span id="cb60-285"><a href="#cb60-285" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_alpha_manual(values = c(0.6, 1), guide = "none") +</span></span>
<span id="cb60-286"><a href="#cb60-286" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(book_type)) +</span></span>
<span id="cb60-287"><a href="#cb60-287" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_nice() +</span></span>
<span id="cb60-288"><a href="#cb60-288" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(panel.grid.major.x = element_blank(),</span></span>
<span id="cb60-289"><a href="#cb60-289" aria-hidden="true" tabindex="-1"></a><span class="in">        panel.grid.major.y = element_blank(),</span></span>
<span id="cb60-290"><a href="#cb60-290" aria-hidden="true" tabindex="-1"></a><span class="in">        # Using labs(x = NULL) with scale_x_productlist() apparently doesn't</span></span>
<span id="cb60-291"><a href="#cb60-291" aria-hidden="true" tabindex="-1"></a><span class="in">        # work, so we can turn off the axis title with theme() instead</span></span>
<span id="cb60-292"><a href="#cb60-292" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.title.x = element_blank(),</span></span>
<span id="cb60-293"><a href="#cb60-293" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.title.y = element_blank())</span></span>
<span id="cb60-294"><a href="#cb60-294" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-295"><a href="#cb60-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-296"><a href="#cb60-296" aria-hidden="true" tabindex="-1"></a>There are a few quick things to point out here in this plot. The Mexico rectangles are super tall, since there are so many more respondents from Mexico than from the United States. It looks like the majority of American students only rarely read comic books, while their Mexican counterparts do it either sometimes or often. Mexican students also read newspapers a lot more than Americans do, with "Often" the clear most common category. For Americans, the "Sometimes" and "Often" newspaper responses look about the same.</span>
<span id="cb60-297"><a href="#cb60-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-298"><a href="#cb60-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-299"><a href="#cb60-299" aria-hidden="true" tabindex="-1"></a><span class="fu"># The questions</span></span>
<span id="cb60-300"><a href="#cb60-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-301"><a href="#cb60-301" aria-hidden="true" tabindex="-1"></a>Throughout this post, I'll illustrate the logic of Bayesian proportion tests by answering two questions that I had while looking at the contingency table and mosaic plot above:</span>
<span id="cb60-302"><a href="#cb60-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-303"><a href="#cb60-303" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Do students in Mexico read comic books more often than students in the United States? (the <span class="in">`r span_col('two yellow cells in the "Often" column', clr_diff)`</span>)</span>
<span id="cb60-304"><a href="#cb60-304" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Do students in the United States vary in their frequency of reading newspapers? (the <span class="in">`r span_col("blue row for newspapers in the United States", clr_often)`</span>)</span>
<span id="cb60-305"><a href="#cb60-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-306"><a href="#cb60-306" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tab-fancy-questions-all}</span></span>
<span id="cb60-307"><a href="#cb60-307" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb60-308"><a href="#cb60-308" aria-hidden="true" tabindex="-1"></a><span class="in">fancy_table %&gt;% </span></span>
<span id="cb60-309"><a href="#cb60-309" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_style(</span></span>
<span id="cb60-310"><a href="#cb60-310" aria-hidden="true" tabindex="-1"></a><span class="in">    style = list(</span></span>
<span id="cb60-311"><a href="#cb60-311" aria-hidden="true" tabindex="-1"></a><span class="in">      cell_fill(color = colorspace::lighten("#CD8A39", 0.7)),</span></span>
<span id="cb60-312"><a href="#cb60-312" aria-hidden="true" tabindex="-1"></a><span class="in">      cell_text(color = "#CD8A39", weight = "bold")</span></span>
<span id="cb60-313"><a href="#cb60-313" aria-hidden="true" tabindex="-1"></a><span class="in">    ),</span></span>
<span id="cb60-314"><a href="#cb60-314" aria-hidden="true" tabindex="-1"></a><span class="in">    locations = list(</span></span>
<span id="cb60-315"><a href="#cb60-315" aria-hidden="true" tabindex="-1"></a><span class="in">      cells_body(columns = "Often", rows = c(1, 3))</span></span>
<span id="cb60-316"><a href="#cb60-316" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb60-317"><a href="#cb60-317" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb60-318"><a href="#cb60-318" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_style(</span></span>
<span id="cb60-319"><a href="#cb60-319" aria-hidden="true" tabindex="-1"></a><span class="in">    style = list(</span></span>
<span id="cb60-320"><a href="#cb60-320" aria-hidden="true" tabindex="-1"></a><span class="in">      cell_fill(color = colorspace::lighten("#009DDC", 0.8)),</span></span>
<span id="cb60-321"><a href="#cb60-321" aria-hidden="true" tabindex="-1"></a><span class="in">      cell_text(color = "#009DDC", weight = "bold")</span></span>
<span id="cb60-322"><a href="#cb60-322" aria-hidden="true" tabindex="-1"></a><span class="in">    ),</span></span>
<span id="cb60-323"><a href="#cb60-323" aria-hidden="true" tabindex="-1"></a><span class="in">    locations = list(</span></span>
<span id="cb60-324"><a href="#cb60-324" aria-hidden="true" tabindex="-1"></a><span class="in">      cells_body(columns = 3:5, rows = 4)</span></span>
<span id="cb60-325"><a href="#cb60-325" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb60-326"><a href="#cb60-326" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-327"><a href="#cb60-327" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-328"><a href="#cb60-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-329"><a href="#cb60-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-330"><a href="#cb60-330" aria-hidden="true" tabindex="-1"></a><span class="fu"># Question 1: Comic book readership in the US vs. Mexico</span></span>
<span id="cb60-331"><a href="#cb60-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-332"><a href="#cb60-332" aria-hidden="true" tabindex="-1"></a><span class="fu">## Estimand</span></span>
<span id="cb60-333"><a href="#cb60-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-334"><a href="#cb60-334" aria-hidden="true" tabindex="-1"></a>For our first question, we want to know if there's a substantial difference in the proportion of students who read comic books often in the United States and Mexico, or whether the difference between the <span class="in">`r span_col('two yellow cells', clr_diff)`</span> is greater than zero:</span>
<span id="cb60-335"><a href="#cb60-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-336"><a href="#cb60-336" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tab-fancy-questions-q1}</span></span>
<span id="cb60-337"><a href="#cb60-337" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb60-338"><a href="#cb60-338" aria-hidden="true" tabindex="-1"></a><span class="in">fancy_table %&gt;% </span></span>
<span id="cb60-339"><a href="#cb60-339" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_style(</span></span>
<span id="cb60-340"><a href="#cb60-340" aria-hidden="true" tabindex="-1"></a><span class="in">    style = list(</span></span>
<span id="cb60-341"><a href="#cb60-341" aria-hidden="true" tabindex="-1"></a><span class="in">      cell_fill(color = colorspace::lighten("#CD8A39", 0.7)),</span></span>
<span id="cb60-342"><a href="#cb60-342" aria-hidden="true" tabindex="-1"></a><span class="in">      cell_text(color = "#CD8A39", weight = "bold")</span></span>
<span id="cb60-343"><a href="#cb60-343" aria-hidden="true" tabindex="-1"></a><span class="in">    ),</span></span>
<span id="cb60-344"><a href="#cb60-344" aria-hidden="true" tabindex="-1"></a><span class="in">    locations = list(</span></span>
<span id="cb60-345"><a href="#cb60-345" aria-hidden="true" tabindex="-1"></a><span class="in">      cells_body(columns = "Often", rows = c(1, 3))</span></span>
<span id="cb60-346"><a href="#cb60-346" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb60-347"><a href="#cb60-347" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-348"><a href="#cb60-348" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-349"><a href="#cb60-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-350"><a href="#cb60-350" aria-hidden="true" tabindex="-1"></a>To be more formal about this, we'll call this estimand $\theta$, which is the difference between the two proportions $\pi$:</span>
<span id="cb60-351"><a href="#cb60-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-352"><a href="#cb60-352" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-353"><a href="#cb60-353" aria-hidden="true" tabindex="-1"></a>\theta = \pi_\text{Mexico, comic books, often} - \pi_\text{United States, comic books, often}</span>
<span id="cb60-354"><a href="#cb60-354" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-355"><a href="#cb60-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-356"><a href="#cb60-356" aria-hidden="true" tabindex="-1"></a>When visualizing this, we'll use colors to help communicate the idea of between-group differences. We'll get fancier with the colors in question 2, where we'll look at three sets of pairwise differences, but here we're just looking at a single pairwise difference (the difference between the US and Mexico), so we'll use a bit of subtle and not-quite-correct color theory. In kindergarten we all learned the <span class="co">[</span><span class="ot">RYB color model</span><span class="co">](https://en.wikipedia.org/wiki/RYB_color_model)</span>, where primary pigments can be mixed to create secondary pigments. For instance</span>
<span id="cb60-357"><a href="#cb60-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-358"><a href="#cb60-358" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;</span><span class="in">`r span_col('blue', "#0074D9")`</span><span class="at"> + </span><span class="in">`r span_col('yellow', "#FFDC00")`</span><span class="at"> = </span><span class="in">`r span_col('green', "#2ECC40")`</span><span class="at">. </span></span>
<span id="cb60-359"><a href="#cb60-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-360"><a href="#cb60-360" aria-hidden="true" tabindex="-1"></a>If we do some (wrong color-theory-wise) algebra, we can rearrange the formula so that </span>
<span id="cb60-361"><a href="#cb60-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-362"><a href="#cb60-362" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; </span><span class="in">`r span_col('blue', "#0074D9")`</span><span class="at"> − </span><span class="in">`r span_col('green', "#2ECC40")`</span><span class="at"> = </span><span class="in">`r span_col('yellow', "#FFDC00")`</span></span>
<span id="cb60-363"><a href="#cb60-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-364"><a href="#cb60-364" aria-hidden="true" tabindex="-1"></a>If we make the United States <span class="in">`r span_col('blue', "#0074D9")`</span> and Mexico <span class="in">`r span_col('green', "#2ECC40")`</span>, the ostensible color for their difference is <span class="in">`r span_col('yellow', "#FFDC00")`</span>. This is TOTALLY WRONG and <span class="co">[</span><span class="ot">a lot more complicated</span><span class="co">](https://xkcd.com/1882/)</span> according to actual color theory, but it's a cute and subtle visual cue, so we'll use it.</span>
<span id="cb60-365"><a href="#cb60-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-366"><a href="#cb60-366" aria-hidden="true" tabindex="-1"></a>These primary colors are a little too bright for my taste though, so let's artsty them up a bit. We're looking at data about the US and Mexico, so we'll use the Saguaro palette from <span class="co">[</span><span class="ot">the {NatParksPalettes} package</span><span class="co">](https://github.com/kevinsblake/NatParksPalettes)</span>, since <span class="co">[</span><span class="ot">Saguaro National Park</span><span class="co">](https://en.wikipedia.org/wiki/Saguaro_National_Park)</span> is near the US-Mexico border and it has a nice blue, yellow, and green.</span>
<span id="cb60-367"><a href="#cb60-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-368"><a href="#cb60-368" aria-hidden="true" tabindex="-1"></a>We'll use <span class="in">`r span_col('yellow for the difference (θ)', clr_diff)`</span> between the <span class="in">`r span_col("United States", clr_usa)`</span> and <span class="in">`r span_col("Mexico", clr_mex)`</span>.</span>
<span id="cb60-369"><a href="#cb60-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-370"><a href="#cb60-370" aria-hidden="true" tabindex="-1"></a>::: {.column-margin}</span>
<span id="cb60-371"><a href="#cb60-371" aria-hidden="true" tabindex="-1"></a><span class="al">![](img/saguaro.jpg)</span></span>
<span id="cb60-372"><a href="#cb60-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-373"><a href="#cb60-373" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">"Saguaro Fruit Ripens in June"</span><span class="co">](https://www.nps.gov/media/photo/gallery-item.htm?pg=1937068&amp;id=D0458FC7-155D-451F-678551BE57482110&amp;gid=D0377EAB-155D-451F-67573A9D0FD80A08)</span> by the <span class="co">[</span><span class="ot">US National Park Service</span><span class="co">](https://www.nps.gov/)</span></span>
<span id="cb60-374"><a href="#cb60-374" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb60-375"><a href="#cb60-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-376"><a href="#cb60-376" aria-hidden="true" tabindex="-1"></a><span class="in">```{r clrs-us-mexico}</span></span>
<span id="cb60-377"><a href="#cb60-377" aria-hidden="true" tabindex="-1"></a><span class="in"># US/Mexico question colors</span></span>
<span id="cb60-378"><a href="#cb60-378" aria-hidden="true" tabindex="-1"></a><span class="in">clrs_saguaro &lt;- NatParksPalettes::natparks.pals("Saguaro")</span></span>
<span id="cb60-379"><a href="#cb60-379" aria-hidden="true" tabindex="-1"></a><span class="in">clr_usa &lt;- clrs_saguaro[1]</span></span>
<span id="cb60-380"><a href="#cb60-380" aria-hidden="true" tabindex="-1"></a><span class="in">clr_mex &lt;- clrs_saguaro[6]</span></span>
<span id="cb60-381"><a href="#cb60-381" aria-hidden="true" tabindex="-1"></a><span class="in">clr_diff &lt;- clrs_saguaro[4]</span></span>
<span id="cb60-382"><a href="#cb60-382" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-383"><a href="#cb60-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-384"><a href="#cb60-384" aria-hidden="true" tabindex="-1"></a><span class="in">```{r show-saguaro-pal, fig.height=1, fig.width=8, out.width="100%", echo=FALSE}</span></span>
<span id="cb60-385"><a href="#cb60-385" aria-hidden="true" tabindex="-1"></a><span class="in">show_nice_pal(c("United States" = clr_usa, "Mexico" = clr_mex, "Difference" = clr_diff),</span></span>
<span id="cb60-386"><a href="#cb60-386" aria-hidden="true" tabindex="-1"></a><span class="in">              use_names = TRUE)</span></span>
<span id="cb60-387"><a href="#cb60-387" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-388"><a href="#cb60-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-389"><a href="#cb60-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-390"><a href="#cb60-390" aria-hidden="true" tabindex="-1"></a><span class="fu">## Classically</span></span>
<span id="cb60-391"><a href="#cb60-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-392"><a href="#cb60-392" aria-hidden="true" tabindex="-1"></a>In classical frequentist statistics, there are lots of ways to test for the significance of a difference in proportions of counts, rates, proportions, and other categorical-related things, like chi-squared tests, <span class="co">[</span><span class="ot">Fisher's exact test</span><span class="co">](https://www.tjmahr.com/bayesian-fisher-exact-test/)</span>, or proportion tests. Each of these tests have special corresponding "flavors" that apply to specific conditions within the data being tested or the estimand being calculated (corrections for sample sizes, etc.). In standard stats classes, you memorize <span class="co">[</span><span class="ot">big flowcharts of possible statistical operations</span><span class="co">](https://www.google.com/search?q=statistical+test+flow+chart)</span> and select the correct one for the situation.</span>
<span id="cb60-393"><a href="#cb60-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-394"><a href="#cb60-394" aria-hidden="true" tabindex="-1"></a>Since we want to test the difference between two group proportions, we'll use R's <span class="in">`prop.test()`</span>, which tests the null hypothesis that the proportions in some number of groups are the same:</span>
<span id="cb60-395"><a href="#cb60-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-396"><a href="#cb60-396" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-397"><a href="#cb60-397" aria-hidden="true" tabindex="-1"></a>H_0: \theta = 0</span>
<span id="cb60-398"><a href="#cb60-398" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-399"><a href="#cb60-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-400"><a href="#cb60-400" aria-hidden="true" tabindex="-1"></a>Our job with null hypothesis significance testing is to calculate a test statistic ($\chi^2$ in this case) for $\theta$, determine the probability of seeing that statistic in a world where $\theta$ is actually 0, and infer whether the value we see could plausibly fit in a world where the null hypothesis is true. </span>
<span id="cb60-401"><a href="#cb60-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-402"><a href="#cb60-402" aria-hidden="true" tabindex="-1"></a>We need to feed <span class="in">`prop.test()`</span> either a matrix with a column of counts of successes (students who read comic books often) and failures (students who do not read comic books often) or two separate vectors: one of counts of successes (students who read comic books often) and one of counts of totals (all students). We'll do it both ways for fun.</span>
<span id="cb60-403"><a href="#cb60-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-404"><a href="#cb60-404" aria-hidden="true" tabindex="-1"></a>First we'll make a matrix of the counts of students from Mexico and the United States, with columns for the counts of those who read often and of those who don't read often.</span>
<span id="cb60-405"><a href="#cb60-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-406"><a href="#cb60-406" aria-hidden="true" tabindex="-1"></a><span class="in">```{r q1-prop-test-make-matrix}</span></span>
<span id="cb60-407"><a href="#cb60-407" aria-hidden="true" tabindex="-1"></a><span class="in">often_matrix &lt;- reading_counts %&gt;% </span></span>
<span id="cb60-408"><a href="#cb60-408" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_type == "Comic books", frequency == "Often") %&gt;% </span></span>
<span id="cb60-409"><a href="#cb60-409" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(n_not_often = total - n) %&gt;% </span></span>
<span id="cb60-410"><a href="#cb60-410" aria-hidden="true" tabindex="-1"></a><span class="in">  select(n_often = n, n_not_often) %&gt;% </span></span>
<span id="cb60-411"><a href="#cb60-411" aria-hidden="true" tabindex="-1"></a><span class="in">  as.matrix()</span></span>
<span id="cb60-412"><a href="#cb60-412" aria-hidden="true" tabindex="-1"></a><span class="in">often_matrix</span></span>
<span id="cb60-413"><a href="#cb60-413" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-414"><a href="#cb60-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-415"><a href="#cb60-415" aria-hidden="true" tabindex="-1"></a>Now we can feed that to <span class="in">`prop.test()`</span>:</span>
<span id="cb60-416"><a href="#cb60-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-417"><a href="#cb60-417" aria-hidden="true" tabindex="-1"></a><span class="in">```{r q1-prop-test-matrix}</span></span>
<span id="cb60-418"><a href="#cb60-418" aria-hidden="true" tabindex="-1"></a><span class="in">prop.test(often_matrix)</span></span>
<span id="cb60-419"><a href="#cb60-419" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-420"><a href="#cb60-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-421"><a href="#cb60-421" aria-hidden="true" tabindex="-1"></a>This gives us some helpful information. The "flavor" of the formal test is a "2-sample test for equality of proportions with continuity correction", which is fine, I guess. </span>
<span id="cb60-422"><a href="#cb60-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-423"><a href="#cb60-423" aria-hidden="true" tabindex="-1"></a><span class="in">```{r q1-prop-test-parameters-extract, include=FALSE}</span></span>
<span id="cb60-424"><a href="#cb60-424" aria-hidden="true" tabindex="-1"></a><span class="in">q1_prop_params &lt;- prop.test(often_matrix) %&gt;% </span></span>
<span id="cb60-425"><a href="#cb60-425" aria-hidden="true" tabindex="-1"></a><span class="in">  model_parameters() %&gt;% </span></span>
<span id="cb60-426"><a href="#cb60-426" aria-hidden="true" tabindex="-1"></a><span class="in">  as.list()</span></span>
<span id="cb60-427"><a href="#cb60-427" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-428"><a href="#cb60-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-429"><a href="#cb60-429" aria-hidden="true" tabindex="-1"></a>We have proportions that are the same as what we have in the highlighted cells in the contingency table (<span class="in">`r q1_prop_params$Proportion`</span>) and we have 95% confidence interval for the difference. Oddly, R doesn't show the actual difference in these results, but we can see that difference if we use <span class="in">`model_parameters()`</span> from <span class="co">[</span><span class="ot">the {parameters} package</span><span class="co">](https://easystats.github.io/parameters/)</span> (which is the apparent successor to <span class="in">`broom::tidy()`</span>?). Here we can see that the difference in proportions is 18 percentage points:</span>
<span id="cb60-430"><a href="#cb60-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-431"><a href="#cb60-431" aria-hidden="true" tabindex="-1"></a><span class="in">```{r q1-prop-test-parameters}</span></span>
<span id="cb60-432"><a href="#cb60-432" aria-hidden="true" tabindex="-1"></a><span class="in">prop.test(often_matrix) %&gt;% </span></span>
<span id="cb60-433"><a href="#cb60-433" aria-hidden="true" tabindex="-1"></a><span class="in">  model_parameters()</span></span>
<span id="cb60-434"><a href="#cb60-434" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-435"><a href="#cb60-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-436"><a href="#cb60-436" aria-hidden="true" tabindex="-1"></a>And finally we have a test statistic: a $\chi^2$ value of <span class="in">`r q1_prop_params$Chi2`</span>, which is huge and definitely statistically significant. In a hypothetical world where there's no difference in the proportions, the probability of seeing a difference of at least 18 percentage points is super tiny (p <span class="in">`r label_pvalue(prefix = c("&lt; ", "", "&gt; "))(q1_prop_params$p)`</span>). We have enough evidence to confidently reject the null hypothesis and declare that the proportions of the groups are not the same. With the confidence interval, we can say that we are 95% confident that the interval <span class="in">`r q1_prop_params$CI_low`</span>–<span class="in">`r q1_prop_params$CI_high`</span> captures the true population parameter. We can't say that there's a 95% chance that the true value falls in this range—we can only talk about the range.</span>
<span id="cb60-437"><a href="#cb60-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-438"><a href="#cb60-438" aria-hidden="true" tabindex="-1"></a>We can also do this without using a matrix by feeding <span class="in">`prop.test()`</span> two vectors: one with counts of people who read comics often and one with counts of total respondents:</span>
<span id="cb60-439"><a href="#cb60-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-440"><a href="#cb60-440" aria-hidden="true" tabindex="-1"></a><span class="in">```{r q1-prop-test-vectors}</span></span>
<span id="cb60-441"><a href="#cb60-441" aria-hidden="true" tabindex="-1"></a><span class="in">often_values &lt;- reading_counts %&gt;% </span></span>
<span id="cb60-442"><a href="#cb60-442" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_type == "Comic books", frequency == "Often")</span></span>
<span id="cb60-443"><a href="#cb60-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-444"><a href="#cb60-444" aria-hidden="true" tabindex="-1"></a><span class="in">(n_often &lt;- as.numeric(c(often_values[1, 4], often_values[2, 4])))</span></span>
<span id="cb60-445"><a href="#cb60-445" aria-hidden="true" tabindex="-1"></a><span class="in">(n_respondents &lt;- as.numeric(c(often_values[1, 5], often_values[2, 5])))</span></span>
<span id="cb60-446"><a href="#cb60-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-447"><a href="#cb60-447" aria-hidden="true" tabindex="-1"></a><span class="in">prop.test(n_often, n_respondents)</span></span>
<span id="cb60-448"><a href="#cb60-448" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-449"><a href="#cb60-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-450"><a href="#cb60-450" aria-hidden="true" tabindex="-1"></a>The results are the same.</span>
<span id="cb60-451"><a href="#cb60-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-452"><a href="#cb60-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-453"><a href="#cb60-453" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bayesianly with Stan</span></span>
<span id="cb60-454"><a href="#cb60-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-455"><a href="#cb60-455" aria-hidden="true" tabindex="-1"></a><span class="fu">### Why Bayesian modeling?</span></span>
<span id="cb60-456"><a href="#cb60-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-457"><a href="#cb60-457" aria-hidden="true" tabindex="-1"></a>I don't like null hypotheses and I don't like flowcharts.</span>
<span id="cb60-458"><a href="#cb60-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-459"><a href="#cb60-459" aria-hidden="true" tabindex="-1"></a>::: {.column-margin}</span>
<span id="cb60-460"><a href="#cb60-460" aria-hidden="true" tabindex="-1"></a><span class="al">![](img/golem.jpg)</span></span>
<span id="cb60-461"><a href="#cb60-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-462"><a href="#cb60-462" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">"Golem"</span><span class="co">](https://www.flickr.com/photos/botosynthetic/5837348219)</span> by <span class="co">[</span><span class="ot">smokeghost</span><span class="co">](https://www.flickr.com/people/botosynthetic/)</span></span>
<span id="cb60-463"><a href="#cb60-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-464"><a href="#cb60-464" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb60-465"><a href="#cb60-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-466"><a href="#cb60-466" aria-hidden="true" tabindex="-1"></a>Regular classical statistics classes teach about null hypotheses and flowcharts, but there's a better way. In his magisterial <span class="co">[</span><span class="ot">*Statistical Rethinking*</span><span class="co">](https://xcelab.net/rm/statistical-rethinking/)</span>, Richard McElreath <span class="co">[</span><span class="ot">describes how in legends people created mythological clay robots called golems that could protect cities from attacks</span><span class="co">](https://www.youtube.com/watch?v=cclUd_HoRlo)</span>, but that could also spin out of control and wreak all sorts of havoc. McElreath uses the idea of golems as a metaphor for classical statistical models focused on null hypothesis significance testing, which also consist of powerful quasi-alchemical procedures that have to be followed precisely with specific flowcharts:</span>
<span id="cb60-467"><a href="#cb60-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-468"><a href="#cb60-468" aria-hidden="true" tabindex="-1"></a><span class="in">```{r golem-slide, echo=FALSE, out.width="100%"}</span></span>
<span id="cb60-469"><a href="#cb60-469" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: Statistical models as golems (slide 9 in [Statistical Rethinking 2022 Lecture 01](https://speakerdeck.com/rmcelreath/statistical-rethinking-2022-lecture-01?slide=9))</span></span>
<span id="cb60-470"><a href="#cb60-470" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("img/golem-flowchart.png")</span></span>
<span id="cb60-471"><a href="#cb60-471" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-472"><a href="#cb60-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-473"><a href="#cb60-473" aria-hidden="true" tabindex="-1"></a>McElreath argues that this golem-based approach to statistics is incredibly limiting, since (1) you have to choose the right test, and if it doesn't exist, you have to wait for some fancy statistician to invent it, and (2) you have to focus on rejecting null hypotheses instead of exploring research hypotheses.</span>
<span id="cb60-474"><a href="#cb60-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-475"><a href="#cb60-475" aria-hidden="true" tabindex="-1"></a>For instance, in the null hypothesis framework section above, this was the actual question undergirding the analysis:</span>
<span id="cb60-476"><a href="#cb60-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-477"><a href="#cb60-477" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; In a hypothetical world where $\theta = 0$ (or where there's no difference between the proportions) what's the probability that this one-time collection of data fits in that world—and if the probability is low, is there enough evidence to confidently reject that hypothetical world of no difference?</span></span>
<span id="cb60-478"><a href="#cb60-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-479"><a href="#cb60-479" aria-hidden="true" tabindex="-1"></a>oof. We set our <span class="in">`prop.test()`</span> golem to work and got a p-value for the probability of seeing the 18 percentage point difference in a world where there's actually no difference. That p-value was low, so we confidently declared $\theta$ to be statistically significant and not zero. But that was it. We rejected the null world. Yay. But that doesn't say much about our main research hypothesis. Boo.</span>
<span id="cb60-480"><a href="#cb60-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-481"><a href="#cb60-481" aria-hidden="true" tabindex="-1"></a>Our *actual* main question is far simpler:</span>
<span id="cb60-482"><a href="#cb60-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-483"><a href="#cb60-483" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Given the data here, what's the probability that there's no difference between the proportions, or that $\theta \neq 0$?</span></span>
<span id="cb60-484"><a href="#cb60-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-485"><a href="#cb60-485" aria-hidden="true" tabindex="-1"></a>Bayesian-flavored statistics lets us answer this question and avoid null hypotheses and convoluted inference. Instead of calculating the probability of seeing some data given a null hypothesis ($P(\text{Data} \mid H_0)$), we can use <span class="co">[</span><span class="ot">Bayesian inference</span><span class="co">](https://en.wikipedia.org/wiki/Bayesian_inference)</span> to calculate the probability of a hypothesis given some data ($P(\theta \neq 0 \mid \text{Data})$).</span>
<span id="cb60-486"><a href="#cb60-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-487"><a href="#cb60-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-488"><a href="#cb60-488" aria-hidden="true" tabindex="-1"></a><span class="fu">### Formal model</span></span>
<span id="cb60-489"><a href="#cb60-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-490"><a href="#cb60-490" aria-hidden="true" tabindex="-1"></a>So instead of thinking about a specific statistical golem, we can think about modeling the data-generating process that could create the counts and proportions that we see in the PISA data.</span>
<span id="cb60-491"><a href="#cb60-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-492"><a href="#cb60-492" aria-hidden="true" tabindex="-1"></a>Remember that our data looks like this, with <span class="in">`n`</span> showing a count of the people who read comic books often in each country and <span class="in">`total`</span> showing a count of the people who responded to the question.</span>
<span id="cb60-493"><a href="#cb60-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-494"><a href="#cb60-494" aria-hidden="true" tabindex="-1"></a><span class="in">```{r show-pisa-data}</span></span>
<span id="cb60-495"><a href="#cb60-495" aria-hidden="true" tabindex="-1"></a><span class="in">reading_counts %&gt;% </span></span>
<span id="cb60-496"><a href="#cb60-496" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_type == "Comic books", frequency == "Often")</span></span>
<span id="cb60-497"><a href="#cb60-497" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-498"><a href="#cb60-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-499"><a href="#cb60-499" aria-hidden="true" tabindex="-1"></a>The actual process for generating that <span class="in">`n`</span> involved asking thousands of individual, independent people if they read comic books often. If someone says yes, it's counted as a "success" (or marked as "often"); if they say no, it's not marked as "often". It's a binary choice repeated across thousands of independent questions, or "trials." There's also an underlying overall probability for reporting "often," which corresponds to the proportion of people selecting it.</span>
<span id="cb60-500"><a href="#cb60-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-501"><a href="#cb60-501" aria-hidden="true" tabindex="-1"></a>The official statistical term for this kind of data-generating processes (a bunch of independent trials with some probability of success) is a <span class="co">[</span><span class="ot">binomial distribution</span><span class="co">](https://en.wikipedia.org/wiki/Binomial_distribution)</span>, and it's defined like this, with three parameters:</span>
<span id="cb60-502"><a href="#cb60-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-503"><a href="#cb60-503" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-504"><a href="#cb60-504" aria-hidden="true" tabindex="-1"></a>y \sim \operatorname{Binomial}(n, \pi)</span>
<span id="cb60-505"><a href="#cb60-505" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-506"><a href="#cb60-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-507"><a href="#cb60-507" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Number of successes ($y$: the number of people responding yes to "often," or <span class="in">`n`</span> in our data</span>
<span id="cb60-508"><a href="#cb60-508" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Probability of success ($\pi$): the probability someone says yes to "often," or the thing we want to model for each country</span>
<span id="cb60-509"><a href="#cb60-509" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Number of trials ($n$): the total number of people asked the question, or <span class="in">`total`</span> in our data</span>
<span id="cb60-510"><a href="#cb60-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-511"><a href="#cb60-511" aria-hidden="true" tabindex="-1"></a>The number of successes and trials are just integers—they're counts—and we already know those, since they're in the data. The probability of success $\pi$ is a percentage and ranges somewhere between 0 and 1. We don't know this value, but we can estimate it with Bayesian methods by defining a prior and a likelihood, churning through a bunch of Monte Carlo Markov Chain (MCMC) simulations, and finding a posterior distribution of $\pi$.</span>
<span id="cb60-512"><a href="#cb60-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-513"><a href="#cb60-513" aria-hidden="true" tabindex="-1"></a>We can use a Beta distribution to model $\pi$, since Beta distributions are naturally bound between 0 and 1 and they work well for probability-scale things. Beta distributions are defined by two parameters: (1) $\alpha$ or $a$ or <span class="in">`shape1`</span> in R and (2) $\beta$ or $b$ or <span class="in">`shape2`</span> in R. <span class="co">[</span><span class="ot">See this section of my blog post</span><span class="co">](https://www.andrewheiss.com/blog/2021/11/08/beta-regression-guide/#beta-distributions-and-shape-parameters)</span> on zero-inflated Beta regression for way more details about how these parameters work and what they mean.</span>
<span id="cb60-514"><a href="#cb60-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-515"><a href="#cb60-515" aria-hidden="true" tabindex="-1"></a>Super quickly, we're interested in the probability of a "success" (or where "often" is yes), which is the number of "often"s divided by the total number of responses:</span>
<span id="cb60-516"><a href="#cb60-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-517"><a href="#cb60-517" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-518"><a href="#cb60-518" aria-hidden="true" tabindex="-1"></a>\frac{\text{Number of successes}}{\text{Number of trials}}</span>
<span id="cb60-519"><a href="#cb60-519" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-520"><a href="#cb60-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-521"><a href="#cb60-521" aria-hidden="true" tabindex="-1"></a>or</span>
<span id="cb60-522"><a href="#cb60-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-523"><a href="#cb60-523" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-524"><a href="#cb60-524" aria-hidden="true" tabindex="-1"></a>\frac{\text{Number of often = yes}}{\text{Number of responses}}</span>
<span id="cb60-525"><a href="#cb60-525" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-526"><a href="#cb60-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-527"><a href="#cb60-527" aria-hidden="true" tabindex="-1"></a>We can separate that denominator into two parts:</span>
<span id="cb60-528"><a href="#cb60-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-529"><a href="#cb60-529" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-530"><a href="#cb60-530" aria-hidden="true" tabindex="-1"></a>\frac{\text{Number of often = yes}}{(\text{Number of often = yes}) + (\text{Number of often } \neq \text{yes})}</span>
<span id="cb60-531"><a href="#cb60-531" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-532"><a href="#cb60-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-533"><a href="#cb60-533" aria-hidden="true" tabindex="-1"></a>The $\alpha$ and $\beta$ parameters correspond to the counts of successes and failures::</span>
<span id="cb60-534"><a href="#cb60-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-535"><a href="#cb60-535" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-536"><a href="#cb60-536" aria-hidden="true" tabindex="-1"></a>\frac{\alpha}{\alpha + \beta}</span>
<span id="cb60-537"><a href="#cb60-537" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-538"><a href="#cb60-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-539"><a href="#cb60-539" aria-hidden="true" tabindex="-1"></a>With these two shape parameters, we can create any percentage or fraction we want. We can also control the uncertainty of the distribution by tinkering with the scale of the parameters. For instance, if we think there's a 40% chance of something happening, this could be represented with $\alpha = 4$ and $\beta = 6$, since $\frac{4}{4 + 6} = 0.4$. We could also write it as $\alpha = 40$ and $\beta = 60$, since $\frac{40}{40 + 60} = 0.4$ too. Both are centered at 40%, but Beta(40, 60) is a lot narrower and less uncertain.</span>
<span id="cb60-540"><a href="#cb60-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-541"><a href="#cb60-541" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-beta-example}</span></span>
<span id="cb60-542"><a href="#cb60-542" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: Beta(4, 6) and Beta(40, 60) distributions</span></span>
<span id="cb60-543"><a href="#cb60-543" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: Beta(4, 6) and Beta(40, 60) distributions</span></span>
<span id="cb60-544"><a href="#cb60-544" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb60-545"><a href="#cb60-545" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_function(fun = ~dbeta(., 4, 6), geom = "area",</span></span>
<span id="cb60-546"><a href="#cb60-546" aria-hidden="true" tabindex="-1"></a><span class="in">                aes(fill = "Beta(4, 6)"), alpha = 0.5) +</span></span>
<span id="cb60-547"><a href="#cb60-547" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_function(fun = ~dbeta(., 40, 60), geom = "area",</span></span>
<span id="cb60-548"><a href="#cb60-548" aria-hidden="true" tabindex="-1"></a><span class="in">                aes(fill = "Beta(40, 60)"), alpha = 0.5) +</span></span>
<span id="cb60-549"><a href="#cb60-549" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_percent()) +</span></span>
<span id="cb60-550"><a href="#cb60-550" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = c("Beta(4, 6)" = "#FFDC00",</span></span>
<span id="cb60-551"><a href="#cb60-551" aria-hidden="true" tabindex="-1"></a><span class="in">                               "Beta(40, 60)" = "#F012BE")) +</span></span>
<span id="cb60-552"><a href="#cb60-552" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "π", y = NULL, fill = NULL) +</span></span>
<span id="cb60-553"><a href="#cb60-553" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_nice() +</span></span>
<span id="cb60-554"><a href="#cb60-554" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.y = element_blank(),</span></span>
<span id="cb60-555"><a href="#cb60-555" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.position = "top")</span></span>
<span id="cb60-556"><a href="#cb60-556" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-557"><a href="#cb60-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-558"><a href="#cb60-558" aria-hidden="true" tabindex="-1"></a>We've already seen the data and know that the proportion of students who read comic books often is 10ish% in the United States and 30ish% in Mexico, but we'll cheat and say that we think that around 25% of students read comic books often, ± some big amount. This implies something like a Beta(2, 6) distribution (since $\frac{2}{2+6} = 0.25$), with lots of low possible values, but not a lot of $\pi$s are above 50%. We could narrow this down by scaling up the parameters (like Beta(20, 60) or Beta(10, 40), etc.), but leaving the prior distribution of $\pi$ wide like this allows for more possible responses (maybe 75% of students in one country read comic books often!).</span>
<span id="cb60-559"><a href="#cb60-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-560"><a href="#cb60-560" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-beta-prior}</span></span>
<span id="cb60-561"><a href="#cb60-561" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: Prior distribution for π using Beta(2, 6)</span></span>
<span id="cb60-562"><a href="#cb60-562" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: Prior distribution for π using Beta(2, 6)</span></span>
<span id="cb60-563"><a href="#cb60-563" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb60-564"><a href="#cb60-564" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_function(fun = ~dbeta(., 2, 6), geom = "area", fill = "#AC3414") +</span></span>
<span id="cb60-565"><a href="#cb60-565" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_percent()) +</span></span>
<span id="cb60-566"><a href="#cb60-566" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Possible values for π", y = NULL, fill = NULL) +</span></span>
<span id="cb60-567"><a href="#cb60-567" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_nice() +</span></span>
<span id="cb60-568"><a href="#cb60-568" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.y = element_blank())</span></span>
<span id="cb60-569"><a href="#cb60-569" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-570"><a href="#cb60-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-571"><a href="#cb60-571" aria-hidden="true" tabindex="-1"></a>Okay, so with our Beta(2, 6) prior, we now have all the information we need to specify the official formal model of the data generating process for our estimand $\theta$ without any flowchart golems or null hypotheses:</span>
<span id="cb60-572"><a href="#cb60-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-573"><a href="#cb60-573" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-574"><a href="#cb60-574" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb60-575"><a href="#cb60-575" aria-hidden="true" tabindex="-1"></a>&amp;\ \textbf{Estimand} <span class="sc">\\</span></span>
<span id="cb60-576"><a href="#cb60-576" aria-hidden="true" tabindex="-1"></a>\theta =&amp;\ \pi_{\text{comic books, often}_\text{Mexico}} - \pi_{\text{comic books, often}_\text{US}} <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb60-577"><a href="#cb60-577" aria-hidden="true" tabindex="-1"></a>&amp;\ \textbf{Beta-binomial model for Mexico} <span class="sc">\\</span></span>
<span id="cb60-578"><a href="#cb60-578" aria-hidden="true" tabindex="-1"></a>y_{n \text{ comic books, often}_\text{Mexico}} \sim&amp;\ \operatorname{Binomial}(n_{\text{Total students}_\text{Mexico}}, \pi_{\text{comic books, often}_\text{Mexico}}) <span class="sc">\\</span></span>
<span id="cb60-579"><a href="#cb60-579" aria-hidden="true" tabindex="-1"></a>\pi_{\text{comic books, often}_\text{Mexico}} \sim&amp;\ \operatorname{Beta}(\alpha_\text{Mexico}, \beta_\text{Mexico}) <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb60-580"><a href="#cb60-580" aria-hidden="true" tabindex="-1"></a>&amp;\ \textbf{Beta-binomial model for the United States} <span class="sc">\\</span></span>
<span id="cb60-581"><a href="#cb60-581" aria-hidden="true" tabindex="-1"></a>y_{n \text{ comic books, often}_\text{US}} \sim&amp;\ \operatorname{Binomial}(n_{\text{Total students}_\text{US}}, \pi_{\text{comic books, often}_\text{US}}) <span class="sc">\\</span></span>
<span id="cb60-582"><a href="#cb60-582" aria-hidden="true" tabindex="-1"></a>\pi_{\text{comic books, often}_\text{US}} \sim&amp;\ \operatorname{Beta}(\alpha_\text{US}, \beta_\text{US}) <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb60-583"><a href="#cb60-583" aria-hidden="true" tabindex="-1"></a>&amp;\ \textbf{Priors} <span class="sc">\\</span></span>
<span id="cb60-584"><a href="#cb60-584" aria-hidden="true" tabindex="-1"></a>\alpha_\text{Mexico}, \alpha_\text{US} =&amp;\ 2 <span class="sc">\\</span></span>
<span id="cb60-585"><a href="#cb60-585" aria-hidden="true" tabindex="-1"></a>\beta_\text{Mexico}, \beta_\text{US} =&amp;\ 6</span>
<span id="cb60-586"><a href="#cb60-586" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb60-587"><a href="#cb60-587" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-588"><a href="#cb60-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-589"><a href="#cb60-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-590"><a href="#cb60-590" aria-hidden="true" tabindex="-1"></a><span class="fu">### Basic Stan model</span></span>
<span id="cb60-591"><a href="#cb60-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-592"><a href="#cb60-592" aria-hidden="true" tabindex="-1"></a>The neat thing about Stan is that it translates fairly directly from this mathematical model notation into code. Here we'll define three different blocks in a Stan program: </span>
<span id="cb60-593"><a href="#cb60-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-594"><a href="#cb60-594" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Data that gets fed into the model, or the counts of respondents (or $y$ and $n$)</span>
<span id="cb60-595"><a href="#cb60-595" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Parameters to estimate, or $\pi_\text{US}$ and $\pi_\text{Mexico}$</span>
<span id="cb60-596"><a href="#cb60-596" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>The prior and model for estimating those parameters, or $\operatorname{Beta}(2, 6)$ and $y \sim \operatorname{Binomial}(n, \pi)$</span>
<span id="cb60-597"><a href="#cb60-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-598"><a href="#cb60-598" aria-hidden="true" tabindex="-1"></a><span class="in">```{.stan filename="props-basic.stan"}</span></span>
<span id="cb60-599"><a href="#cb60-599" aria-hidden="true" tabindex="-1"></a><span class="in">// Stuff from R</span></span>
<span id="cb60-600"><a href="#cb60-600" aria-hidden="true" tabindex="-1"></a><span class="in">data {</span></span>
<span id="cb60-601"><a href="#cb60-601" aria-hidden="true" tabindex="-1"></a><span class="in">  int&lt;lower=0&gt; often_us;</span></span>
<span id="cb60-602"><a href="#cb60-602" aria-hidden="true" tabindex="-1"></a><span class="in">  int&lt;lower=0&gt; total_us;</span></span>
<span id="cb60-603"><a href="#cb60-603" aria-hidden="true" tabindex="-1"></a><span class="in">  int&lt;lower=0&gt; often_mexico;</span></span>
<span id="cb60-604"><a href="#cb60-604" aria-hidden="true" tabindex="-1"></a><span class="in">  int&lt;lower=0&gt; total_mexico;</span></span>
<span id="cb60-605"><a href="#cb60-605" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb60-606"><a href="#cb60-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-607"><a href="#cb60-607" aria-hidden="true" tabindex="-1"></a><span class="in">// Things to estimate</span></span>
<span id="cb60-608"><a href="#cb60-608" aria-hidden="true" tabindex="-1"></a><span class="in">parameters {</span></span>
<span id="cb60-609"><a href="#cb60-609" aria-hidden="true" tabindex="-1"></a><span class="in">  real&lt;lower=0, upper=1&gt; pi_us;</span></span>
<span id="cb60-610"><a href="#cb60-610" aria-hidden="true" tabindex="-1"></a><span class="in">  real&lt;lower=0, upper=1&gt; pi_mexico;</span></span>
<span id="cb60-611"><a href="#cb60-611" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb60-612"><a href="#cb60-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-613"><a href="#cb60-613" aria-hidden="true" tabindex="-1"></a><span class="in">// Prior and likelihood</span></span>
<span id="cb60-614"><a href="#cb60-614" aria-hidden="true" tabindex="-1"></a><span class="in">model {</span></span>
<span id="cb60-615"><a href="#cb60-615" aria-hidden="true" tabindex="-1"></a><span class="in">  pi_us ~ beta(2, 6);</span></span>
<span id="cb60-616"><a href="#cb60-616" aria-hidden="true" tabindex="-1"></a><span class="in">  pi_mexico ~ beta(2, 6);</span></span>
<span id="cb60-617"><a href="#cb60-617" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb60-618"><a href="#cb60-618" aria-hidden="true" tabindex="-1"></a><span class="in">  often_us ~ binomial(total_us, pi_us);</span></span>
<span id="cb60-619"><a href="#cb60-619" aria-hidden="true" tabindex="-1"></a><span class="in">  often_mexico ~ binomial(total_mexico, pi_mexico);</span></span>
<span id="cb60-620"><a href="#cb60-620" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb60-621"><a href="#cb60-621" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-622"><a href="#cb60-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-623"><a href="#cb60-623" aria-hidden="true" tabindex="-1"></a>Using {cmdstanr} as our interface with Stan, we first have to compile the script into an executable file:</span>
<span id="cb60-624"><a href="#cb60-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-625"><a href="#cb60-625" aria-hidden="true" tabindex="-1"></a><span class="in">```{r compile-model-props-basic, cache=TRUE}</span></span>
<span id="cb60-626"><a href="#cb60-626" aria-hidden="true" tabindex="-1"></a><span class="in">model_props_basic &lt;- cmdstan_model("props-basic.stan")</span></span>
<span id="cb60-627"><a href="#cb60-627" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-628"><a href="#cb60-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-629"><a href="#cb60-629" aria-hidden="true" tabindex="-1"></a>We can then feed it a list of data and run a bunch of MCMC chains:</span>
<span id="cb60-630"><a href="#cb60-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-631"><a href="#cb60-631" aria-hidden="true" tabindex="-1"></a><span class="in">```{r samples-model-props-basic}</span></span>
<span id="cb60-632"><a href="#cb60-632" aria-hidden="true" tabindex="-1"></a><span class="in">often_values &lt;- reading_counts %&gt;% </span></span>
<span id="cb60-633"><a href="#cb60-633" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_type == "Comic books", frequency == "Often")</span></span>
<span id="cb60-634"><a href="#cb60-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-635"><a href="#cb60-635" aria-hidden="true" tabindex="-1"></a><span class="in">(n_often &lt;- as.numeric(c(often_values[1, 4], often_values[2, 4])))</span></span>
<span id="cb60-636"><a href="#cb60-636" aria-hidden="true" tabindex="-1"></a><span class="in">(n_respondents &lt;- as.numeric(c(often_values[1, 5], often_values[2, 5])))</span></span>
<span id="cb60-637"><a href="#cb60-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-638"><a href="#cb60-638" aria-hidden="true" tabindex="-1"></a><span class="in">props_basic_samples &lt;- model_props_basic$sample(</span></span>
<span id="cb60-639"><a href="#cb60-639" aria-hidden="true" tabindex="-1"></a><span class="in">  data = list(often_us = n_often[2],</span></span>
<span id="cb60-640"><a href="#cb60-640" aria-hidden="true" tabindex="-1"></a><span class="in">              total_us = n_respondents[2],</span></span>
<span id="cb60-641"><a href="#cb60-641" aria-hidden="true" tabindex="-1"></a><span class="in">              often_mexico = n_often[1],</span></span>
<span id="cb60-642"><a href="#cb60-642" aria-hidden="true" tabindex="-1"></a><span class="in">              total_mexico = n_respondents[1]),</span></span>
<span id="cb60-643"><a href="#cb60-643" aria-hidden="true" tabindex="-1"></a><span class="in">  chains = CHAINS, iter_warmup = WARMUP, iter_sampling = (ITER - WARMUP), seed = BAYES_SEED,</span></span>
<span id="cb60-644"><a href="#cb60-644" aria-hidden="true" tabindex="-1"></a><span class="in">  refresh = 0</span></span>
<span id="cb60-645"><a href="#cb60-645" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb60-646"><a href="#cb60-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-647"><a href="#cb60-647" aria-hidden="true" tabindex="-1"></a><span class="in">props_basic_samples$print(</span></span>
<span id="cb60-648"><a href="#cb60-648" aria-hidden="true" tabindex="-1"></a><span class="in">  variables = c("pi_us", "pi_mexico"), </span></span>
<span id="cb60-649"><a href="#cb60-649" aria-hidden="true" tabindex="-1"></a><span class="in">  "mean", "median", "sd", ~quantile(.x, probs = c(0.025, 0.975))</span></span>
<span id="cb60-650"><a href="#cb60-650" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb60-651"><a href="#cb60-651" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-652"><a href="#cb60-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-653"><a href="#cb60-653" aria-hidden="true" tabindex="-1"></a>We have the two proportions—10% and 28%—and they match what we found in the original table and in the frequentist <span class="in">`prop.test()`</span> results (yay!). Let's visualize these things:</span>
<span id="cb60-654"><a href="#cb60-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-655"><a href="#cb60-655" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-props-basic-stan}</span></span>
<span id="cb60-656"><a href="#cb60-656" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: Posterior distributions of the proportion of students who read comic books often in the United States and Mexico</span></span>
<span id="cb60-657"><a href="#cb60-657" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: Posterior distributions of the proportion of students who read comic books often in the United States and Mexico</span></span>
<span id="cb60-658"><a href="#cb60-658" aria-hidden="true" tabindex="-1"></a><span class="in">props_basic_samples %&gt;% </span></span>
<span id="cb60-659"><a href="#cb60-659" aria-hidden="true" tabindex="-1"></a><span class="in">  gather_draws(pi_us, pi_mexico) %&gt;% </span></span>
<span id="cb60-660"><a href="#cb60-660" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = .value, y = .variable, fill = .variable)) +</span></span>
<span id="cb60-661"><a href="#cb60-661" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye() +</span></span>
<span id="cb60-662"><a href="#cb60-662" aria-hidden="true" tabindex="-1"></a><span class="in">  # Multiply axis limits by 1.5% so that the right "%" isn't cut off</span></span>
<span id="cb60-663"><a href="#cb60-663" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_percent(), expand = c(0, 0.015)) +</span></span>
<span id="cb60-664"><a href="#cb60-664" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = c(clr_usa, clr_mex)) +</span></span>
<span id="cb60-665"><a href="#cb60-665" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(fill = "none") +</span></span>
<span id="cb60-666"><a href="#cb60-666" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Proportion of students who read comic books often",</span></span>
<span id="cb60-667"><a href="#cb60-667" aria-hidden="true" tabindex="-1"></a><span class="in">       y = NULL) +</span></span>
<span id="cb60-668"><a href="#cb60-668" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_nice()</span></span>
<span id="cb60-669"><a href="#cb60-669" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-670"><a href="#cb60-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-671"><a href="#cb60-671" aria-hidden="true" tabindex="-1"></a>This plot is neat for a couple reasons. First it shows the difference in variance across these two distributions. The sample size for Mexican respondents is huge, so the average is a lot more precise and <span class="in">`r span_col("the distribution", clr_mex)`</span> is narrower than <span class="in">`r span_col("the American one", clr_usa)`</span>. Second, by just eyeballing the plot we can see that there's definitely no overlap between the two distributions, which implies that <span class="in">`r span_col('the difference (θ) between the two', clr_diff)`</span> is definitely not zero—Mexican respondents are way more likely than Americans to read comic books often. We can find <span class="in">`r span_col('that difference', clr_diff)`</span> by taking the pairwise difference between the two with <span class="in">`compare_levels()`</span> from {tidybayes}, which subtracts one group's posterior from the other:</span>
<span id="cb60-672"><a href="#cb60-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-673"><a href="#cb60-673" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-diffs-basic-stan}</span></span>
<span id="cb60-674"><a href="#cb60-674" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: Posterior distribution of the difference in proportions of students who read comic books often in the United States and Mexico</span></span>
<span id="cb60-675"><a href="#cb60-675" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: Posterior distribution of the difference in proportions of students who read comic books often in the United States and Mexico</span></span>
<span id="cb60-676"><a href="#cb60-676" aria-hidden="true" tabindex="-1"></a><span class="in">basic_diffs &lt;- props_basic_samples %&gt;% </span></span>
<span id="cb60-677"><a href="#cb60-677" aria-hidden="true" tabindex="-1"></a><span class="in">  gather_draws(pi_us, pi_mexico) %&gt;% </span></span>
<span id="cb60-678"><a href="#cb60-678" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb60-679"><a href="#cb60-679" aria-hidden="true" tabindex="-1"></a><span class="in">  # compare_levels() subtracts things using alphabetical order, so by default it</span></span>
<span id="cb60-680"><a href="#cb60-680" aria-hidden="true" tabindex="-1"></a><span class="in">  # would calculate pi_us - pi_mexico, but we want the opposite, so we have to</span></span>
<span id="cb60-681"><a href="#cb60-681" aria-hidden="true" tabindex="-1"></a><span class="in">  # make pi_us the first level</span></span>
<span id="cb60-682"><a href="#cb60-682" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(.variable = fct_relevel(.variable, "pi_us")) %&gt;% </span></span>
<span id="cb60-683"><a href="#cb60-683" aria-hidden="true" tabindex="-1"></a><span class="in">  compare_levels(.value, by = .variable, comparison = "pairwise")</span></span>
<span id="cb60-684"><a href="#cb60-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-685"><a href="#cb60-685" aria-hidden="true" tabindex="-1"></a><span class="in">basic_diffs %&gt;% </span></span>
<span id="cb60-686"><a href="#cb60-686" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = .value)) +</span></span>
<span id="cb60-687"><a href="#cb60-687" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye(fill = clr_diff) +</span></span>
<span id="cb60-688"><a href="#cb60-688" aria-hidden="true" tabindex="-1"></a><span class="in">  # Multiply axis limits by 0.5% so that the right "pp." isn't cut off</span></span>
<span id="cb60-689"><a href="#cb60-689" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_pp, expand = c(0, 0.005)) +</span></span>
<span id="cb60-690"><a href="#cb60-690" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Percentage point difference in proportions",</span></span>
<span id="cb60-691"><a href="#cb60-691" aria-hidden="true" tabindex="-1"></a><span class="in">       y = NULL) +</span></span>
<span id="cb60-692"><a href="#cb60-692" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_nice() +</span></span>
<span id="cb60-693"><a href="#cb60-693" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.y = element_blank(),</span></span>
<span id="cb60-694"><a href="#cb60-694" aria-hidden="true" tabindex="-1"></a><span class="in">        panel.grid.major.y = element_blank())</span></span>
<span id="cb60-695"><a href="#cb60-695" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-696"><a href="#cb60-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-697"><a href="#cb60-697" aria-hidden="true" tabindex="-1"></a>We can also do some Bayesian inference and find the probability that <span class="in">`r span_col('that difference between the two groups', clr_diff)`</span> is greater than 0 (or a kind of Bayesian p-value, but way more logical than null hypothesis p-values). We can calculate how many posterior draws are bigger than 0 and divide that by the number of draws to get the official proportion.</span>
<span id="cb60-698"><a href="#cb60-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-699"><a href="#cb60-699" aria-hidden="true" tabindex="-1"></a><span class="in">```{r calc-inference-basic-stan}</span></span>
<span id="cb60-700"><a href="#cb60-700" aria-hidden="true" tabindex="-1"></a><span class="in">basic_diffs %&gt;% </span></span>
<span id="cb60-701"><a href="#cb60-701" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(median = median_qi(.value),</span></span>
<span id="cb60-702"><a href="#cb60-702" aria-hidden="true" tabindex="-1"></a><span class="in">            p_gt_0 = sum(.value &gt; 0) / n()) %&gt;% </span></span>
<span id="cb60-703"><a href="#cb60-703" aria-hidden="true" tabindex="-1"></a><span class="in">  unnest(median)</span></span>
<span id="cb60-704"><a href="#cb60-704" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-705"><a href="#cb60-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-706"><a href="#cb60-706" aria-hidden="true" tabindex="-1"></a>There's a 100% chance that <span class="in">`r span_col('that difference', clr_diff)`</span> is not zero, or a 100% chance that Mexican respondents are way more likely than their American counterparts to read comic books often. </span>
<span id="cb60-707"><a href="#cb60-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-708"><a href="#cb60-708" aria-hidden="true" tabindex="-1"></a><span class="fu">### Stan model improvements</span></span>
<span id="cb60-709"><a href="#cb60-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-710"><a href="#cb60-710" aria-hidden="true" tabindex="-1"></a>This basic Stan model is neat, but we can do a couple things to make it better:</span>
<span id="cb60-711"><a href="#cb60-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-712"><a href="#cb60-712" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Right now we have to feed it 4 separate numbers (counts and totals for the US and Mexico). It would be nice to just feed it a vector of counts and a vector of totals (or even a whole matrix like we did with <span class="in">`prop.test()`</span>).</span>
<span id="cb60-713"><a href="#cb60-713" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Right now we have to manually calculate the difference between the two groups (0.28 − 0.10). It would be nice to have Stan do that work for us.</span>
<span id="cb60-714"><a href="#cb60-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-715"><a href="#cb60-715" aria-hidden="true" tabindex="-1"></a>We'll tackle each of these issues in turn.</span>
<span id="cb60-716"><a href="#cb60-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-717"><a href="#cb60-717" aria-hidden="true" tabindex="-1"></a>First we'll change how the script handles the data so that it's more dynamic. Now instead of defining explicit variables and parameters as <span class="in">`total_us`</span> or <span class="in">`pi_mexico`</span> or whatever, we'll use arrays and vectors so that we can use any arbitrary number of groups if we want:</span>
<span id="cb60-718"><a href="#cb60-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-719"><a href="#cb60-719" aria-hidden="true" tabindex="-1"></a><span class="in">```{.stan filename="props-better.stan"}</span></span>
<span id="cb60-720"><a href="#cb60-720" aria-hidden="true" tabindex="-1"></a><span class="in">// Stuff from R</span></span>
<span id="cb60-721"><a href="#cb60-721" aria-hidden="true" tabindex="-1"></a><span class="in">data {</span></span>
<span id="cb60-722"><a href="#cb60-722" aria-hidden="true" tabindex="-1"></a><span class="in">  int&lt;lower=0&gt; n;</span></span>
<span id="cb60-723"><a href="#cb60-723" aria-hidden="true" tabindex="-1"></a><span class="in">  array[n] int&lt;lower=0&gt; often;</span></span>
<span id="cb60-724"><a href="#cb60-724" aria-hidden="true" tabindex="-1"></a><span class="in">  array[n] int&lt;lower=0&gt; total;</span></span>
<span id="cb60-725"><a href="#cb60-725" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb60-726"><a href="#cb60-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-727"><a href="#cb60-727" aria-hidden="true" tabindex="-1"></a><span class="in">// Things to estimate</span></span>
<span id="cb60-728"><a href="#cb60-728" aria-hidden="true" tabindex="-1"></a><span class="in">parameters {</span></span>
<span id="cb60-729"><a href="#cb60-729" aria-hidden="true" tabindex="-1"></a><span class="in">  vector&lt;lower=0, upper=1&gt;[n] pi;</span></span>
<span id="cb60-730"><a href="#cb60-730" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb60-731"><a href="#cb60-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-732"><a href="#cb60-732" aria-hidden="true" tabindex="-1"></a><span class="in">// Prior and likelihood</span></span>
<span id="cb60-733"><a href="#cb60-733" aria-hidden="true" tabindex="-1"></a><span class="in">model {</span></span>
<span id="cb60-734"><a href="#cb60-734" aria-hidden="true" tabindex="-1"></a><span class="in">  pi ~ beta(2, 6);</span></span>
<span id="cb60-735"><a href="#cb60-735" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb60-736"><a href="#cb60-736" aria-hidden="true" tabindex="-1"></a><span class="in">  // We could specify separate priors like this</span></span>
<span id="cb60-737"><a href="#cb60-737" aria-hidden="true" tabindex="-1"></a><span class="in">  // pi[1] ~ beta(2, 6);</span></span>
<span id="cb60-738"><a href="#cb60-738" aria-hidden="true" tabindex="-1"></a><span class="in">  // pi[2] ~ beta(2, 6);</span></span>
<span id="cb60-739"><a href="#cb60-739" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb60-740"><a href="#cb60-740" aria-hidden="true" tabindex="-1"></a><span class="in">  often ~ binomial(total, pi);</span></span>
<span id="cb60-741"><a href="#cb60-741" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb60-742"><a href="#cb60-742" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-743"><a href="#cb60-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-744"><a href="#cb60-744" aria-hidden="true" tabindex="-1"></a>Let's make sure it works. Note how we now have to feed it an <span class="in">`n`</span> for the number of countries and vectors of counts for <span class="in">`often`</span> and <span class="in">`total`</span>:</span>
<span id="cb60-745"><a href="#cb60-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-746"><a href="#cb60-746" aria-hidden="true" tabindex="-1"></a><span class="in">```{r compile-model-props-better, cache=TRUE}</span></span>
<span id="cb60-747"><a href="#cb60-747" aria-hidden="true" tabindex="-1"></a><span class="in">model_props_better &lt;- cmdstan_model("props-better.stan")</span></span>
<span id="cb60-748"><a href="#cb60-748" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-749"><a href="#cb60-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-750"><a href="#cb60-750" aria-hidden="true" tabindex="-1"></a><span class="in">```{r samples-model-props-better}</span></span>
<span id="cb60-751"><a href="#cb60-751" aria-hidden="true" tabindex="-1"></a><span class="in">props_better_samples &lt;- model_props_better$sample(</span></span>
<span id="cb60-752"><a href="#cb60-752" aria-hidden="true" tabindex="-1"></a><span class="in">  data = list(n = 2,</span></span>
<span id="cb60-753"><a href="#cb60-753" aria-hidden="true" tabindex="-1"></a><span class="in">              often = c(n_often[2], n_often[1]),</span></span>
<span id="cb60-754"><a href="#cb60-754" aria-hidden="true" tabindex="-1"></a><span class="in">              total = c(n_respondents[2], n_respondents[1])),</span></span>
<span id="cb60-755"><a href="#cb60-755" aria-hidden="true" tabindex="-1"></a><span class="in">  chains = CHAINS, iter_warmup = WARMUP, iter_sampling = (ITER - WARMUP), seed = BAYES_SEED,</span></span>
<span id="cb60-756"><a href="#cb60-756" aria-hidden="true" tabindex="-1"></a><span class="in">  refresh = 0</span></span>
<span id="cb60-757"><a href="#cb60-757" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb60-758"><a href="#cb60-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-759"><a href="#cb60-759" aria-hidden="true" tabindex="-1"></a><span class="in">props_better_samples$print(</span></span>
<span id="cb60-760"><a href="#cb60-760" aria-hidden="true" tabindex="-1"></a><span class="in">  variables = c("pi[1]", "pi[2]"), </span></span>
<span id="cb60-761"><a href="#cb60-761" aria-hidden="true" tabindex="-1"></a><span class="in">  "mean", "median", "sd", ~quantile(.x, probs = c(0.025, 0.975))</span></span>
<span id="cb60-762"><a href="#cb60-762" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb60-763"><a href="#cb60-763" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-764"><a href="#cb60-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-765"><a href="#cb60-765" aria-hidden="true" tabindex="-1"></a><span class="in">```{r highlight-code-backticks, include=FALSE}</span></span>
<span id="cb60-766"><a href="#cb60-766" aria-hidden="true" tabindex="-1"></a><span class="in">pi1 &lt;- span_col('"`pi[1]`"', clr_usa)</span></span>
<span id="cb60-767"><a href="#cb60-767" aria-hidden="true" tabindex="-1"></a><span class="in">pi2 &lt;- span_col('"`pi[2]`"', clr_mex)</span></span>
<span id="cb60-768"><a href="#cb60-768" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-769"><a href="#cb60-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-770"><a href="#cb60-770" aria-hidden="true" tabindex="-1"></a>It worked and the results are the same! The parameter names are now <span class="in">`r pi1`</span> and <span class="in">`r pi2`</span> and we're responsible for keeping track of which subscripts correspond to which countries, which is annoying, but that's Stan :shrug:.</span>
<span id="cb60-771"><a href="#cb60-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-772"><a href="#cb60-772" aria-hidden="true" tabindex="-1"></a>Finally, we can modify the script a little more to automatically calculate <span class="in">`r span_col('θ', clr_diff)`</span>. We'll add a <span class="in">`generated quantities`</span> block for that:</span>
<span id="cb60-773"><a href="#cb60-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-774"><a href="#cb60-774" aria-hidden="true" tabindex="-1"></a><span class="in">```{.stan filename="props-best.stan"}</span></span>
<span id="cb60-775"><a href="#cb60-775" aria-hidden="true" tabindex="-1"></a><span class="in">// Stuff from R</span></span>
<span id="cb60-776"><a href="#cb60-776" aria-hidden="true" tabindex="-1"></a><span class="in">data {</span></span>
<span id="cb60-777"><a href="#cb60-777" aria-hidden="true" tabindex="-1"></a><span class="in">  int&lt;lower=0&gt; n;</span></span>
<span id="cb60-778"><a href="#cb60-778" aria-hidden="true" tabindex="-1"></a><span class="in">  array[n] int&lt;lower=0&gt; often;</span></span>
<span id="cb60-779"><a href="#cb60-779" aria-hidden="true" tabindex="-1"></a><span class="in">  array[n] int&lt;lower=0&gt; total;</span></span>
<span id="cb60-780"><a href="#cb60-780" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb60-781"><a href="#cb60-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-782"><a href="#cb60-782" aria-hidden="true" tabindex="-1"></a><span class="in">// Things to estimate</span></span>
<span id="cb60-783"><a href="#cb60-783" aria-hidden="true" tabindex="-1"></a><span class="in">parameters {</span></span>
<span id="cb60-784"><a href="#cb60-784" aria-hidden="true" tabindex="-1"></a><span class="in">  vector&lt;lower=0, upper=1&gt;[n] pi;</span></span>
<span id="cb60-785"><a href="#cb60-785" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb60-786"><a href="#cb60-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-787"><a href="#cb60-787" aria-hidden="true" tabindex="-1"></a><span class="in">// Prior and likelihood</span></span>
<span id="cb60-788"><a href="#cb60-788" aria-hidden="true" tabindex="-1"></a><span class="in">model {</span></span>
<span id="cb60-789"><a href="#cb60-789" aria-hidden="true" tabindex="-1"></a><span class="in">  pi ~ beta(2, 6);</span></span>
<span id="cb60-790"><a href="#cb60-790" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb60-791"><a href="#cb60-791" aria-hidden="true" tabindex="-1"></a><span class="in">  often ~ binomial(total, pi);</span></span>
<span id="cb60-792"><a href="#cb60-792" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb60-793"><a href="#cb60-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-794"><a href="#cb60-794" aria-hidden="true" tabindex="-1"></a><span class="in">// Stuff Stan will calculate before sending back to R</span></span>
<span id="cb60-795"><a href="#cb60-795" aria-hidden="true" tabindex="-1"></a><span class="in">generated quantities {</span></span>
<span id="cb60-796"><a href="#cb60-796" aria-hidden="true" tabindex="-1"></a><span class="in">  real theta;</span></span>
<span id="cb60-797"><a href="#cb60-797" aria-hidden="true" tabindex="-1"></a><span class="in">  theta = pi[2] - pi[1];</span></span>
<span id="cb60-798"><a href="#cb60-798" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb60-799"><a href="#cb60-799" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-800"><a href="#cb60-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-801"><a href="#cb60-801" aria-hidden="true" tabindex="-1"></a><span class="in">```{r compile-model-props-best, cache=TRUE}</span></span>
<span id="cb60-802"><a href="#cb60-802" aria-hidden="true" tabindex="-1"></a><span class="in">model_props_best &lt;- cmdstan_model("props-best.stan")</span></span>
<span id="cb60-803"><a href="#cb60-803" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-804"><a href="#cb60-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-805"><a href="#cb60-805" aria-hidden="true" tabindex="-1"></a><span class="in">```{r samples-model-props-best}</span></span>
<span id="cb60-806"><a href="#cb60-806" aria-hidden="true" tabindex="-1"></a><span class="in">props_best_samples &lt;- model_props_best$sample(</span></span>
<span id="cb60-807"><a href="#cb60-807" aria-hidden="true" tabindex="-1"></a><span class="in">  data = list(n = 2,</span></span>
<span id="cb60-808"><a href="#cb60-808" aria-hidden="true" tabindex="-1"></a><span class="in">              often = c(n_often[2], n_often[1]),</span></span>
<span id="cb60-809"><a href="#cb60-809" aria-hidden="true" tabindex="-1"></a><span class="in">              total = c(n_respondents[2], n_respondents[1])),</span></span>
<span id="cb60-810"><a href="#cb60-810" aria-hidden="true" tabindex="-1"></a><span class="in">  chains = CHAINS, iter_warmup = WARMUP, iter_sampling = (ITER - WARMUP), seed = BAYES_SEED,</span></span>
<span id="cb60-811"><a href="#cb60-811" aria-hidden="true" tabindex="-1"></a><span class="in">  refresh = 0</span></span>
<span id="cb60-812"><a href="#cb60-812" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb60-813"><a href="#cb60-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-814"><a href="#cb60-814" aria-hidden="true" tabindex="-1"></a><span class="in">props_best_samples$print(</span></span>
<span id="cb60-815"><a href="#cb60-815" aria-hidden="true" tabindex="-1"></a><span class="in">  variables = c("pi[1]", "pi[2]", "theta"), </span></span>
<span id="cb60-816"><a href="#cb60-816" aria-hidden="true" tabindex="-1"></a><span class="in">  "mean", "median", "sd", ~quantile(.x, probs = c(0.025, 0.975))</span></span>
<span id="cb60-817"><a href="#cb60-817" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb60-818"><a href="#cb60-818" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-819"><a href="#cb60-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-820"><a href="#cb60-820" aria-hidden="true" tabindex="-1"></a>Check that out! Stan returned our <span class="in">`r span_col('18 percentage point difference', clr_diff)`</span> and we didn't need to use <span class="in">`compare_levels()`</span>! We can plot it directly:</span>
<span id="cb60-821"><a href="#cb60-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-822"><a href="#cb60-822" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-diffs-best-stan}</span></span>
<span id="cb60-823"><a href="#cb60-823" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: Posterior distribution of the proportions and difference in proportions of students who read comic books often in the United States and Mexico; results from raw Stan code</span></span>
<span id="cb60-824"><a href="#cb60-824" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: Posterior distribution of the proportions and difference in proportions of students who read comic books often in the United States and Mexico; results from raw Stan code</span></span>
<span id="cb60-825"><a href="#cb60-825" aria-hidden="true" tabindex="-1"></a><span class="in"># Raw Stan doesn't preserve the original country names or order, so we have to</span></span>
<span id="cb60-826"><a href="#cb60-826" aria-hidden="true" tabindex="-1"></a><span class="in"># do a bunch of reversing and relabeling on our own here</span></span>
<span id="cb60-827"><a href="#cb60-827" aria-hidden="true" tabindex="-1"></a><span class="in">p1 &lt;- props_best_samples %&gt;% </span></span>
<span id="cb60-828"><a href="#cb60-828" aria-hidden="true" tabindex="-1"></a><span class="in">  spread_draws(pi[i]) %&gt;% </span></span>
<span id="cb60-829"><a href="#cb60-829" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(i = factor(i)) %&gt;% </span></span>
<span id="cb60-830"><a href="#cb60-830" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = pi, y = fct_rev(i), fill = fct_rev(i))) +</span></span>
<span id="cb60-831"><a href="#cb60-831" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye() +</span></span>
<span id="cb60-832"><a href="#cb60-832" aria-hidden="true" tabindex="-1"></a><span class="in">  # Multiply axis limits by 1.5% so that the right "%" isn't cut off</span></span>
<span id="cb60-833"><a href="#cb60-833" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_percent(), expand = c(0, 0.015)) +</span></span>
<span id="cb60-834"><a href="#cb60-834" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_discrete(labels = rev(c("United States", "Mexico"))) +</span></span>
<span id="cb60-835"><a href="#cb60-835" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = c(clr_usa, clr_mex)) +</span></span>
<span id="cb60-836"><a href="#cb60-836" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(fill = "none") +</span></span>
<span id="cb60-837"><a href="#cb60-837" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Proportion of students who read comic books often",</span></span>
<span id="cb60-838"><a href="#cb60-838" aria-hidden="true" tabindex="-1"></a><span class="in">       y = NULL) +</span></span>
<span id="cb60-839"><a href="#cb60-839" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_nice()</span></span>
<span id="cb60-840"><a href="#cb60-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-841"><a href="#cb60-841" aria-hidden="true" tabindex="-1"></a><span class="in">p2 &lt;- props_best_samples %&gt;% </span></span>
<span id="cb60-842"><a href="#cb60-842" aria-hidden="true" tabindex="-1"></a><span class="in">  spread_draws(theta) %&gt;% </span></span>
<span id="cb60-843"><a href="#cb60-843" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = theta)) +</span></span>
<span id="cb60-844"><a href="#cb60-844" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye(fill = clr_diff) +</span></span>
<span id="cb60-845"><a href="#cb60-845" aria-hidden="true" tabindex="-1"></a><span class="in">  # Multiply axis limits by 0.5% so that the right "pp." isn't cut off</span></span>
<span id="cb60-846"><a href="#cb60-846" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_pp, expand = c(0, 0.005)) +</span></span>
<span id="cb60-847"><a href="#cb60-847" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Percentage point difference in proportions",</span></span>
<span id="cb60-848"><a href="#cb60-848" aria-hidden="true" tabindex="-1"></a><span class="in">       y = NULL) +</span></span>
<span id="cb60-849"><a href="#cb60-849" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_nice() +</span></span>
<span id="cb60-850"><a href="#cb60-850" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.y = element_blank(),</span></span>
<span id="cb60-851"><a href="#cb60-851" aria-hidden="true" tabindex="-1"></a><span class="in">        panel.grid.major.y = element_blank())</span></span>
<span id="cb60-852"><a href="#cb60-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-853"><a href="#cb60-853" aria-hidden="true" tabindex="-1"></a><span class="in">(p1 / plot_spacer() / p2) + </span></span>
<span id="cb60-854"><a href="#cb60-854" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_layout(heights = c(0.785, 0.03, 0.185))</span></span>
<span id="cb60-855"><a href="#cb60-855" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-856"><a href="#cb60-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-857"><a href="#cb60-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-858"><a href="#cb60-858" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bayesianly with {brms}</span></span>
<span id="cb60-859"><a href="#cb60-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-860"><a href="#cb60-860" aria-hidden="true" tabindex="-1"></a>Working with raw Stan code like that is fun and exciting—understanding the inner workings of these models is really neat and important! But in practice, I rarely use raw Stan. It takes too much pre- and post-processing for my taste (the data has to be fed in a list instead of a nice rectangular data frame; the variable names get lost unless you do some extra programming work; etc.). </span>
<span id="cb60-861"><a href="#cb60-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-862"><a href="#cb60-862" aria-hidden="true" tabindex="-1"></a>Instead, I use <span class="co">[</span><span class="ot">{brms}</span><span class="co">](https://paul-buerkner.github.io/brms/)</span> for pretty much all my Bayesian models. It uses R's familiar formula syntax, it works with regular data frames, it maintains variable names, and it's just an all-around super-nice-and-polished frontend for working with Stan.</span>
<span id="cb60-863"><a href="#cb60-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-864"><a href="#cb60-864" aria-hidden="true" tabindex="-1"></a>With a little formula finagling, we can create the same beta binomial model we built with raw Stan using {brms}</span>
<span id="cb60-865"><a href="#cb60-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-866"><a href="#cb60-866" aria-hidden="true" tabindex="-1"></a><span class="fu">### Counts and trials as formula outcomes</span></span>
<span id="cb60-867"><a href="#cb60-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-868"><a href="#cb60-868" aria-hidden="true" tabindex="-1"></a>In R's standard formula syntax, you put the outcome on the left-hand side of a <span class="in">`~`</span> and the explanatory variables on the right-hand side: </span>
<span id="cb60-869"><a href="#cb60-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-870"><a href="#cb60-870" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb60-871"><a href="#cb60-871" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> whatever)</span>
<span id="cb60-872"><a href="#cb60-872" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-873"><a href="#cb60-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-874"><a href="#cb60-874" aria-hidden="true" tabindex="-1"></a>You typically feed the model function a data frame with columns for each of the variables included. One neat and underappreciated feature of the <span class="in">`glm()`</span> function is that you can feed function aggregated count data (instead of long data with lots of rows) by specifying the number of successes and the total number of failures as the outcome part of the formula. This runs something called aggregated logistic regression or aggregated binomial regression.</span>
<span id="cb60-875"><a href="#cb60-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-876"><a href="#cb60-876" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb60-877"><a href="#cb60-877" aria-hidden="true" tabindex="-1"></a><span class="fu">glm</span>(<span class="fu">cbind</span>(n_successes, n_failures) <span class="sc">~</span> x, <span class="at">data =</span> whatever, <span class="at">family =</span> binomial)</span>
<span id="cb60-878"><a href="#cb60-878" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-879"><a href="#cb60-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-880"><a href="#cb60-880" aria-hidden="true" tabindex="-1"></a>{brms} uses slightly different syntax for <span class="co">[</span><span class="ot">aggregated logistic regression</span><span class="co">](https://bookdown.org/content/4857/god-spiked-the-integers.html#binomial-regression)</span>. Instead of the number of failures, it needs the total number of trials, and it doesn't use <span class="in">`cbind(...)`</span>—it uses <span class="in">`n | trials(total)`</span>, like this:</span>
<span id="cb60-881"><a href="#cb60-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-882"><a href="#cb60-882" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb60-883"><a href="#cb60-883" aria-hidden="true" tabindex="-1"></a><span class="fu">brm</span>(</span>
<span id="cb60-884"><a href="#cb60-884" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(n <span class="sc">|</span> <span class="fu">trials</span>(total) <span class="sc">~</span> x)</span>
<span id="cb60-885"><a href="#cb60-885" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> whatever,</span>
<span id="cb60-886"><a href="#cb60-886" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial</span>
<span id="cb60-887"><a href="#cb60-887" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-888"><a href="#cb60-888" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-889"><a href="#cb60-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-890"><a href="#cb60-890" aria-hidden="true" tabindex="-1"></a>Our comic book data is already in this count form, and we have columns for the number of "successes" (number of respondents reading comic books often) and the total number of "trials" (number of respondents reading comic books):</span>
<span id="cb60-891"><a href="#cb60-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-892"><a href="#cb60-892" aria-hidden="true" tabindex="-1"></a><span class="in">```{r make-show-count-data-again}</span></span>
<span id="cb60-893"><a href="#cb60-893" aria-hidden="true" tabindex="-1"></a><span class="in">often_comics_only &lt;- reading_counts %&gt;% </span></span>
<span id="cb60-894"><a href="#cb60-894" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_type == "Comic books", frequency == "Often")</span></span>
<span id="cb60-895"><a href="#cb60-895" aria-hidden="true" tabindex="-1"></a><span class="in">often_comics_only</span></span>
<span id="cb60-896"><a href="#cb60-896" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-897"><a href="#cb60-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-898"><a href="#cb60-898" aria-hidden="true" tabindex="-1"></a><span class="fu">### Binomial model with logistic link</span></span>
<span id="cb60-899"><a href="#cb60-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-900"><a href="#cb60-900" aria-hidden="true" tabindex="-1"></a>Since we have columns for <span class="in">`n`</span>, <span class="in">`total`</span>, and <span class="in">`country`</span>, we can run an aggregated binomial logistic regression model like this:</span>
<span id="cb60-901"><a href="#cb60-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-902"><a href="#cb60-902" aria-hidden="true" tabindex="-1"></a><span class="in">```{r q1-model-logit, cache=TRUE, warning=FALSE}</span></span>
<span id="cb60-903"><a href="#cb60-903" aria-hidden="true" tabindex="-1"></a><span class="in">often_comics_model_logit &lt;- brm(</span></span>
<span id="cb60-904"><a href="#cb60-904" aria-hidden="true" tabindex="-1"></a><span class="in">  bf(n | trials(total) ~ country),</span></span>
<span id="cb60-905"><a href="#cb60-905" aria-hidden="true" tabindex="-1"></a><span class="in">  data = often_comics_only,</span></span>
<span id="cb60-906"><a href="#cb60-906" aria-hidden="true" tabindex="-1"></a><span class="in">  family = binomial(link = "logit"),</span></span>
<span id="cb60-907"><a href="#cb60-907" aria-hidden="true" tabindex="-1"></a><span class="in">  chains = CHAINS, warmup = WARMUP, iter = ITER, seed = BAYES_SEED,</span></span>
<span id="cb60-908"><a href="#cb60-908" aria-hidden="true" tabindex="-1"></a><span class="in">  refresh = 0</span></span>
<span id="cb60-909"><a href="#cb60-909" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb60-910"><a href="#cb60-910" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-911"><a href="#cb60-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-912"><a href="#cb60-912" aria-hidden="true" tabindex="-1"></a><span class="in">```{r q1-show-model-logit}</span></span>
<span id="cb60-913"><a href="#cb60-913" aria-hidden="true" tabindex="-1"></a><span class="in">often_comics_model_logit</span></span>
<span id="cb60-914"><a href="#cb60-914" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-915"><a href="#cb60-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-916"><a href="#cb60-916" aria-hidden="true" tabindex="-1"></a>Because we used a logit link for the binomial family, these results are on the log odds scale, which, ew. We can't really interpret them directly unless we do some extra math with <span class="in">`plogis()`</span> (<span class="co">[</span><span class="ot">see here for more about how to do that</span><span class="co">](https://www.andrewheiss.com/blog/2021/11/08/beta-regression-guide/#fractional-logistic-regression)</span>). The logistic-ness of the results is also apparent in the formal mathy model for this approach, which no longer uses a Beta distribution for estimating $\pi$:</span>
<span id="cb60-917"><a href="#cb60-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-918"><a href="#cb60-918" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-919"><a href="#cb60-919" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb60-920"><a href="#cb60-920" aria-hidden="true" tabindex="-1"></a>y_{n \text{ comic books, often}} \sim&amp;\ \operatorname{Binomial}(n_{\text{Total students}}, \pi_{\text{comic books, often}}) <span class="sc">\\</span></span>
<span id="cb60-921"><a href="#cb60-921" aria-hidden="true" tabindex="-1"></a>\operatorname{logit}(\pi_{\text{comic books, often}}) =&amp;\ \beta_0 + \beta_1 \text{United States} <span class="sc">\\</span><span class="co">[</span><span class="ot">5pt</span><span class="co">]</span></span>
<span id="cb60-922"><a href="#cb60-922" aria-hidden="true" tabindex="-1"></a>\beta_0, \beta_1 =&amp; \text{Whatever brms uses as default priors}<span class="sc">\\</span></span>
<span id="cb60-923"><a href="#cb60-923" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb60-924"><a href="#cb60-924" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-925"><a href="#cb60-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-926"><a href="#cb60-926" aria-hidden="true" tabindex="-1"></a>We can still work with percentage point values if we use <span class="in">`epred_draws()`</span> and a bit of data wrangling, since that automatically back-transforms $\operatorname{logit}(\pi)$ from log odds to counts (<span class="co">[</span><span class="ot">see here for an explanation of how and why</span><span class="co">](https://www.andrewheiss.com/blog/2022/09/26/guide-visualizing-types-posteriors/)</span>). We can convert these posterior counts to a proportion again by dividing each predicted count by the total for each row.</span>
<span id="cb60-927"><a href="#cb60-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-928"><a href="#cb60-928" aria-hidden="true" tabindex="-1"></a><span class="in">```{r q1-plot-logit}</span></span>
<span id="cb60-929"><a href="#cb60-929" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: Posterior distribution of the proportions and difference in proportions of students who read comic books often in the United States and Mexico; results from logistic regression model in {brms}</span></span>
<span id="cb60-930"><a href="#cb60-930" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: Posterior distribution of the proportions and difference in proportions of students who read comic books often in the United States and Mexico; results from logistic regression model in {brms}</span></span>
<span id="cb60-931"><a href="#cb60-931" aria-hidden="true" tabindex="-1"></a><span class="in"># brms keeps all the original factor/category names, so there's no need for</span></span>
<span id="cb60-932"><a href="#cb60-932" aria-hidden="true" tabindex="-1"></a><span class="in"># extra manual work here!</span></span>
<span id="cb60-933"><a href="#cb60-933" aria-hidden="true" tabindex="-1"></a><span class="in">draws_logit &lt;- often_comics_model_logit %&gt;% </span></span>
<span id="cb60-934"><a href="#cb60-934" aria-hidden="true" tabindex="-1"></a><span class="in">  # This gives us counts...</span></span>
<span id="cb60-935"><a href="#cb60-935" aria-hidden="true" tabindex="-1"></a><span class="in">  epred_draws(newdata = often_comics_only) %&gt;% </span></span>
<span id="cb60-936"><a href="#cb60-936" aria-hidden="true" tabindex="-1"></a><span class="in">  # ...so divide by the original total to get proportions again</span></span>
<span id="cb60-937"><a href="#cb60-937" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(.epred_prop = .epred / total)</span></span>
<span id="cb60-938"><a href="#cb60-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-939"><a href="#cb60-939" aria-hidden="true" tabindex="-1"></a><span class="in">p1 &lt;- draws_logit %&gt;% </span></span>
<span id="cb60-940"><a href="#cb60-940" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = .epred_prop, y = country, fill = country)) +</span></span>
<span id="cb60-941"><a href="#cb60-941" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye() +</span></span>
<span id="cb60-942"><a href="#cb60-942" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_percent(), expand = c(0, 0.015)) +</span></span>
<span id="cb60-943"><a href="#cb60-943" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = c(clr_usa, clr_mex)) +</span></span>
<span id="cb60-944"><a href="#cb60-944" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(fill = "none") +</span></span>
<span id="cb60-945"><a href="#cb60-945" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Proportion of students who read comic books often",</span></span>
<span id="cb60-946"><a href="#cb60-946" aria-hidden="true" tabindex="-1"></a><span class="in">       y = NULL) +</span></span>
<span id="cb60-947"><a href="#cb60-947" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_nice()</span></span>
<span id="cb60-948"><a href="#cb60-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-949"><a href="#cb60-949" aria-hidden="true" tabindex="-1"></a><span class="in">p2 &lt;- draws_logit %&gt;% </span></span>
<span id="cb60-950"><a href="#cb60-950" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb60-951"><a href="#cb60-951" aria-hidden="true" tabindex="-1"></a><span class="in">  # compare_levels() subtracts things using alphabetical order, so so we have to</span></span>
<span id="cb60-952"><a href="#cb60-952" aria-hidden="true" tabindex="-1"></a><span class="in">  # make the United States the first level</span></span>
<span id="cb60-953"><a href="#cb60-953" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(country = fct_relevel(country, "United States")) %&gt;% </span></span>
<span id="cb60-954"><a href="#cb60-954" aria-hidden="true" tabindex="-1"></a><span class="in">  compare_levels(.epred_prop, by = "country") %&gt;% </span></span>
<span id="cb60-955"><a href="#cb60-955" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = .epred_prop)) +</span></span>
<span id="cb60-956"><a href="#cb60-956" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye(fill = clr_diff) +</span></span>
<span id="cb60-957"><a href="#cb60-957" aria-hidden="true" tabindex="-1"></a><span class="in">  # Multiply axis limits by 0.5% so that the right "pp." isn't cut off</span></span>
<span id="cb60-958"><a href="#cb60-958" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_pp, expand = c(0, 0.005)) +</span></span>
<span id="cb60-959"><a href="#cb60-959" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Percentage point difference in proportions",</span></span>
<span id="cb60-960"><a href="#cb60-960" aria-hidden="true" tabindex="-1"></a><span class="in">       y = NULL) +</span></span>
<span id="cb60-961"><a href="#cb60-961" aria-hidden="true" tabindex="-1"></a><span class="in">  # Make it so the pointrange doesn't get cropped</span></span>
<span id="cb60-962"><a href="#cb60-962" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_cartesian(clip = "off") + </span></span>
<span id="cb60-963"><a href="#cb60-963" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_nice() +</span></span>
<span id="cb60-964"><a href="#cb60-964" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.y = element_blank(),</span></span>
<span id="cb60-965"><a href="#cb60-965" aria-hidden="true" tabindex="-1"></a><span class="in">        panel.grid.major.y = element_blank())</span></span>
<span id="cb60-966"><a href="#cb60-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-967"><a href="#cb60-967" aria-hidden="true" tabindex="-1"></a><span class="in">(p1 / plot_spacer() / p2) + </span></span>
<span id="cb60-968"><a href="#cb60-968" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_layout(heights = c(0.785, 0.03, 0.185))</span></span>
<span id="cb60-969"><a href="#cb60-969" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-970"><a href="#cb60-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-971"><a href="#cb60-971" aria-hidden="true" tabindex="-1"></a><span class="in">```{r q1-post-medians-logit}</span></span>
<span id="cb60-972"><a href="#cb60-972" aria-hidden="true" tabindex="-1"></a><span class="in">draws_logit %&gt;% </span></span>
<span id="cb60-973"><a href="#cb60-973" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(country) %&gt;% </span></span>
<span id="cb60-974"><a href="#cb60-974" aria-hidden="true" tabindex="-1"></a><span class="in">  median_qi(.epred_prop)</span></span>
<span id="cb60-975"><a href="#cb60-975" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-976"><a href="#cb60-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-977"><a href="#cb60-977" aria-hidden="true" tabindex="-1"></a>Cool cool, all the results are the same as using raw Stan.</span>
<span id="cb60-978"><a href="#cb60-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-979"><a href="#cb60-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-980"><a href="#cb60-980" aria-hidden="true" tabindex="-1"></a><span class="fu">### Binomial model with identity link</span></span>
<span id="cb60-981"><a href="#cb60-981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-982"><a href="#cb60-982" aria-hidden="true" tabindex="-1"></a>We didn't set any priors here, and if we want to be good Bayesians, we should. However, given the logit link, we'd need to specify priors on the log odds scale, and I can't naturally think in logits. I *can* think about percentages though, which is why I like the Beta distribution for priors for proportions—it just makes sense.</span>
<span id="cb60-983"><a href="#cb60-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-984"><a href="#cb60-984" aria-hidden="true" tabindex="-1"></a>Also, the raw Stan models spat out percentage-point scale parameters—it'd be neat if {brms} could too.</span>
<span id="cb60-985"><a href="#cb60-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-986"><a href="#cb60-986" aria-hidden="true" tabindex="-1"></a>And it can! We just have to change the link function for the binomial family from <span class="in">`"logit"`</span> to <span class="in">`"identity"`</span>. This isn't really documented anywhere (I don't think?), and it feels weird and wrong, but it works. Note how we take the "logit" out of the second line of the model—we're no longer using a link function:</span>
<span id="cb60-987"><a href="#cb60-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-988"><a href="#cb60-988" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-989"><a href="#cb60-989" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb60-990"><a href="#cb60-990" aria-hidden="true" tabindex="-1"></a>y_{n \text{ comic books, often}} \sim&amp;\ \operatorname{Binomial}(n_{\text{Total students}}, \pi_{\text{comic books, often}}) <span class="sc">\\</span></span>
<span id="cb60-991"><a href="#cb60-991" aria-hidden="true" tabindex="-1"></a>\pi_{\text{comic books, often}} =&amp;\ \beta_0 + \beta_1 \text{United States} <span class="sc">\\</span><span class="co">[</span><span class="ot">5pt</span><span class="co">]</span></span>
<span id="cb60-992"><a href="#cb60-992" aria-hidden="true" tabindex="-1"></a>\beta_0, \beta_1 =&amp;\ \text{Whatever brms uses as default priors}<span class="sc">\\</span></span>
<span id="cb60-993"><a href="#cb60-993" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb60-994"><a href="#cb60-994" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-995"><a href="#cb60-995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-996"><a href="#cb60-996" aria-hidden="true" tabindex="-1"></a>Doing this works, but there are some issues. The identity link in a binomial model means that the model parameters won't be transformed to the logit scale and will instead stay on the proportion scale. We'll get some errors related to MCMC values because the outcome needs to be constrained between 0 and 1, and the MCMC chains will occasionally wander down into negative numbers and make Stan mad. The model will mostly fit if we specify initial MCMC values at 0.1 or something, but it'll still complain.</span>
<span id="cb60-997"><a href="#cb60-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-998"><a href="#cb60-998" aria-hidden="true" tabindex="-1"></a><span class="in">```{r q1-model-identity-intercept, cache=TRUE}</span></span>
<span id="cb60-999"><a href="#cb60-999" aria-hidden="true" tabindex="-1"></a><span class="in">often_comics_model_identity &lt;- brm(</span></span>
<span id="cb60-1000"><a href="#cb60-1000" aria-hidden="true" tabindex="-1"></a><span class="in">  bf(n | trials(total) ~ country),</span></span>
<span id="cb60-1001"><a href="#cb60-1001" aria-hidden="true" tabindex="-1"></a><span class="in">  data = often_comics_only,</span></span>
<span id="cb60-1002"><a href="#cb60-1002" aria-hidden="true" tabindex="-1"></a><span class="in">  family = binomial(link = "identity"),</span></span>
<span id="cb60-1003"><a href="#cb60-1003" aria-hidden="true" tabindex="-1"></a><span class="in">  init = 0.1,</span></span>
<span id="cb60-1004"><a href="#cb60-1004" aria-hidden="true" tabindex="-1"></a><span class="in">  chains = CHAINS, warmup = WARMUP, iter = ITER, seed = BAYES_SEED,</span></span>
<span id="cb60-1005"><a href="#cb60-1005" aria-hidden="true" tabindex="-1"></a><span class="in">  refresh = 0</span></span>
<span id="cb60-1006"><a href="#cb60-1006" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb60-1007"><a href="#cb60-1007" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1008"><a href="#cb60-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1009"><a href="#cb60-1009" aria-hidden="true" tabindex="-1"></a><span class="in">```{r q1-show-model-identity-intercept}</span></span>
<span id="cb60-1010"><a href="#cb60-1010" aria-hidden="true" tabindex="-1"></a><span class="in">often_comics_model_identity</span></span>
<span id="cb60-1011"><a href="#cb60-1011" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1012"><a href="#cb60-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1013"><a href="#cb60-1013" aria-hidden="true" tabindex="-1"></a>One really nice thing about this identity-link model is that the coefficient for <span class="in">`countryUnitedStates`</span> shows us the percentage-point-scale difference in proportions: −0.18! This is just a regular regression model, so the intercept shows us the average proportion when United States is false (i.e. for Mexico), and the United States coefficient shows the offset from the intercept.</span>
<span id="cb60-1014"><a href="#cb60-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1015"><a href="#cb60-1015" aria-hidden="true" tabindex="-1"></a>Working with the <span class="in">`countryUnitedStates`</span> coefficient directly is convenient—there's no need to divide predicted values by totals or use <span class="in">`compare_levels()`</span> to find the difference between the United States and Mexico. We have <span class="in">`r span_col('our estimand', clr_diff)`</span> immediately.</span>
<span id="cb60-1016"><a href="#cb60-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1017"><a href="#cb60-1017" aria-hidden="true" tabindex="-1"></a><span class="in">```{r q1-plot-model-identity-intercept}</span></span>
<span id="cb60-1018"><a href="#cb60-1018" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: Posterior distribution of the difference in proportions of students who read comic books often in the United States and Mexico; results from binomial model with identity link in {brms}</span></span>
<span id="cb60-1019"><a href="#cb60-1019" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: Posterior distribution of the difference in proportions of students who read comic books often in the United States and Mexico; results from binomial model with identity link in {brms}</span></span>
<span id="cb60-1020"><a href="#cb60-1020" aria-hidden="true" tabindex="-1"></a><span class="in">draws_diffs_identity &lt;- often_comics_model_identity %&gt;% </span></span>
<span id="cb60-1021"><a href="#cb60-1021" aria-hidden="true" tabindex="-1"></a><span class="in">  gather_draws(b_countryUnitedStates) %&gt;% </span></span>
<span id="cb60-1022"><a href="#cb60-1022" aria-hidden="true" tabindex="-1"></a><span class="in">  # Reverse the value since our theta is Mexico - US, not US - Mexico</span></span>
<span id="cb60-1023"><a href="#cb60-1023" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(.value = -.value)</span></span>
<span id="cb60-1024"><a href="#cb60-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1025"><a href="#cb60-1025" aria-hidden="true" tabindex="-1"></a><span class="in">draws_diffs_identity %&gt;% </span></span>
<span id="cb60-1026"><a href="#cb60-1026" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = .value)) +</span></span>
<span id="cb60-1027"><a href="#cb60-1027" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye(fill = clr_diff) +</span></span>
<span id="cb60-1028"><a href="#cb60-1028" aria-hidden="true" tabindex="-1"></a><span class="in">  # Multiply axis limits by 0.5% so that the right "pp." isn't cut off</span></span>
<span id="cb60-1029"><a href="#cb60-1029" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_pp, expand = c(0, 0.005)) +</span></span>
<span id="cb60-1030"><a href="#cb60-1030" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Percentage point difference in proportions",</span></span>
<span id="cb60-1031"><a href="#cb60-1031" aria-hidden="true" tabindex="-1"></a><span class="in">       y = NULL) +</span></span>
<span id="cb60-1032"><a href="#cb60-1032" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_nice() +</span></span>
<span id="cb60-1033"><a href="#cb60-1033" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.y = element_blank(),</span></span>
<span id="cb60-1034"><a href="#cb60-1034" aria-hidden="true" tabindex="-1"></a><span class="in">        panel.grid.major.y = element_blank())</span></span>
<span id="cb60-1035"><a href="#cb60-1035" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1036"><a href="#cb60-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1037"><a href="#cb60-1037" aria-hidden="true" tabindex="-1"></a><span class="in">```{r q1-post-medians-identity-intercept}</span></span>
<span id="cb60-1038"><a href="#cb60-1038" aria-hidden="true" tabindex="-1"></a><span class="in">draws_diffs_identity %&gt;% </span></span>
<span id="cb60-1039"><a href="#cb60-1039" aria-hidden="true" tabindex="-1"></a><span class="in">  median_qi(.value)</span></span>
<span id="cb60-1040"><a href="#cb60-1040" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1041"><a href="#cb60-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1042"><a href="#cb60-1042" aria-hidden="true" tabindex="-1"></a><span class="fu">### Intercept-free binomial model with identity link</span></span>
<span id="cb60-1043"><a href="#cb60-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1044"><a href="#cb60-1044" aria-hidden="true" tabindex="-1"></a>However, I'm still not entirely happy with it. For one thing, I don't like all the initial MCMC errors. The model still eventually fit, but I'd prefer it to have a less rocky start. I could probably tinker with more options to get it working, but that's a hassle.</span>
<span id="cb60-1045"><a href="#cb60-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1046"><a href="#cb60-1046" aria-hidden="true" tabindex="-1"></a>More importantly, though, is the issue of priors. We still haven't set any. Also, we're no longer using a beta-binomial model—this is just regular old logistic regression, which means we're working with intercepts and slopes. If we use the <span class="in">`n | trials(total) ~ country`</span> model with an identity link, we'd need to set priors for the intercept and for the difference, which means we need to think about two types of values: (1) the prior average percentage for Mexico and (2) the prior average difference between Mexico and the United States. In the earlier raw Stan model, we set priors for the average percentages for each country and didn't worry about thinking about the difference. Conceptually, I think this is easier. In my own work, I can think about the prior distributions for specific survey response categories (30% might agree, 50% might disagree, 20% might be neutral), but thinking about differences is less natural and straightforward (there might be a 20 percentage point difference between agree and disagree? that feels weird).</span>
<span id="cb60-1047"><a href="#cb60-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1048"><a href="#cb60-1048" aria-hidden="true" tabindex="-1"></a>To get percentages for each country *and* avoid the odd initial value errors *and* set more natural priors, and ultimately use a beta-binomial model, we can fit an intercept-free model by including a 0 in the right-hand side of the formula. This disables the Mexico reference category and returns estimates for both Mexico and the United States. Now we can finally set a prior too. Here, as I did with the Stan model earlier, I use Beta(2, 6) for both countries, but it could easily be different for each country too. This is one way to force {brms} to essentially use a beta-binomial model, and results in something like this:</span>
<span id="cb60-1049"><a href="#cb60-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1050"><a href="#cb60-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1051"><a href="#cb60-1051" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-1052"><a href="#cb60-1052" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb60-1053"><a href="#cb60-1053" aria-hidden="true" tabindex="-1"></a>y_{n \text{ comic books, often}} \sim&amp;\ \operatorname{Binomial}(n_{\text{Total students}}, \pi_{\text{comic books, often}}) <span class="sc">\\</span></span>
<span id="cb60-1054"><a href="#cb60-1054" aria-hidden="true" tabindex="-1"></a>\pi_{\text{comic books, often}} =&amp;\ \beta_\text{Mexico} + \beta_\text{United States} <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb60-1055"><a href="#cb60-1055" aria-hidden="true" tabindex="-1"></a>\beta_\text{Mexico}, \beta_\text{United States} =&amp;\ \operatorname{Beta}(2, 6)<span class="sc">\\</span></span>
<span id="cb60-1056"><a href="#cb60-1056" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb60-1057"><a href="#cb60-1057" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-1058"><a href="#cb60-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1059"><a href="#cb60-1059" aria-hidden="true" tabindex="-1"></a><span class="in">```{r q1-model-identity, cache=TRUE}</span></span>
<span id="cb60-1060"><a href="#cb60-1060" aria-hidden="true" tabindex="-1"></a><span class="in">often_comics_model &lt;- brm(</span></span>
<span id="cb60-1061"><a href="#cb60-1061" aria-hidden="true" tabindex="-1"></a><span class="in">  bf(n | trials(total) ~ 0 + country),</span></span>
<span id="cb60-1062"><a href="#cb60-1062" aria-hidden="true" tabindex="-1"></a><span class="in">  data = often_comics_only,</span></span>
<span id="cb60-1063"><a href="#cb60-1063" aria-hidden="true" tabindex="-1"></a><span class="in">  family = binomial(link = "identity"),</span></span>
<span id="cb60-1064"><a href="#cb60-1064" aria-hidden="true" tabindex="-1"></a><span class="in">  prior = c(prior(beta(2, 6), class = b, lb = 0, ub = 1)),</span></span>
<span id="cb60-1065"><a href="#cb60-1065" aria-hidden="true" tabindex="-1"></a><span class="in">  chains = CHAINS, warmup = WARMUP, iter = ITER, seed = BAYES_SEED,</span></span>
<span id="cb60-1066"><a href="#cb60-1066" aria-hidden="true" tabindex="-1"></a><span class="in">  refresh = 0</span></span>
<span id="cb60-1067"><a href="#cb60-1067" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb60-1068"><a href="#cb60-1068" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1069"><a href="#cb60-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1070"><a href="#cb60-1070" aria-hidden="true" tabindex="-1"></a><span class="in">```{r q1-show-model-identity}</span></span>
<span id="cb60-1071"><a href="#cb60-1071" aria-hidden="true" tabindex="-1"></a><span class="in">often_comics_model</span></span>
<span id="cb60-1072"><a href="#cb60-1072" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1073"><a href="#cb60-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1074"><a href="#cb60-1074" aria-hidden="true" tabindex="-1"></a>The coefficients here represent the average proportions for each country. The <span class="in">`r span_col('main estimand we care about', clr_diff)`</span> is still the difference between the two, so we need to do a little bit of data manipulation to calculate that, just like we did with the first logit version of the model:</span>
<span id="cb60-1075"><a href="#cb60-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1076"><a href="#cb60-1076" aria-hidden="true" tabindex="-1"></a><span class="in">```{r q1-plot-model-identity}</span></span>
<span id="cb60-1077"><a href="#cb60-1077" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: Posterior distribution of the proportions and difference in proportions of students who read comic books often in the United States and Mexico; results from an intercept-free binomial model with identity link in {brms}</span></span>
<span id="cb60-1078"><a href="#cb60-1078" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: Posterior distribution of the proportions and difference in proportions of students who read comic books often in the United States and Mexico; results from an intercept-free binomial model with identity link in {brms}</span></span>
<span id="cb60-1079"><a href="#cb60-1079" aria-hidden="true" tabindex="-1"></a><span class="in">p1 &lt;- often_comics_model %&gt;% </span></span>
<span id="cb60-1080"><a href="#cb60-1080" aria-hidden="true" tabindex="-1"></a><span class="in">  epred_draws(newdata = often_comics_only) %&gt;% </span></span>
<span id="cb60-1081"><a href="#cb60-1081" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(.epred_prop = .epred / total) %&gt;% </span></span>
<span id="cb60-1082"><a href="#cb60-1082" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = .epred_prop, y = country, fill = country)) +</span></span>
<span id="cb60-1083"><a href="#cb60-1083" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye() +</span></span>
<span id="cb60-1084"><a href="#cb60-1084" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_percent(), expand = c(0, 0.015)) +</span></span>
<span id="cb60-1085"><a href="#cb60-1085" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = c(clr_usa, clr_mex)) +</span></span>
<span id="cb60-1086"><a href="#cb60-1086" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(fill = "none") +</span></span>
<span id="cb60-1087"><a href="#cb60-1087" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Proportion of students who read comic books often",</span></span>
<span id="cb60-1088"><a href="#cb60-1088" aria-hidden="true" tabindex="-1"></a><span class="in">       y = NULL) +</span></span>
<span id="cb60-1089"><a href="#cb60-1089" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_nice()</span></span>
<span id="cb60-1090"><a href="#cb60-1090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1091"><a href="#cb60-1091" aria-hidden="true" tabindex="-1"></a><span class="in">p2 &lt;- often_comics_model %&gt;% </span></span>
<span id="cb60-1092"><a href="#cb60-1092" aria-hidden="true" tabindex="-1"></a><span class="in">  epred_draws(newdata = often_comics_only) %&gt;% </span></span>
<span id="cb60-1093"><a href="#cb60-1093" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(.epred_prop = .epred / total) %&gt;% </span></span>
<span id="cb60-1094"><a href="#cb60-1094" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb60-1095"><a href="#cb60-1095" aria-hidden="true" tabindex="-1"></a><span class="in">  # compare_levels() subtracts things using alphabetical order, so so we have to</span></span>
<span id="cb60-1096"><a href="#cb60-1096" aria-hidden="true" tabindex="-1"></a><span class="in">  # make the United States the first level</span></span>
<span id="cb60-1097"><a href="#cb60-1097" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(country = fct_relevel(country, "United States")) %&gt;% </span></span>
<span id="cb60-1098"><a href="#cb60-1098" aria-hidden="true" tabindex="-1"></a><span class="in">  compare_levels(.epred_prop, by = country,</span></span>
<span id="cb60-1099"><a href="#cb60-1099" aria-hidden="true" tabindex="-1"></a><span class="in">                 comparison = "pairwise") %&gt;% </span></span>
<span id="cb60-1100"><a href="#cb60-1100" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = .epred_prop)) +</span></span>
<span id="cb60-1101"><a href="#cb60-1101" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye(fill = clr_diff) +</span></span>
<span id="cb60-1102"><a href="#cb60-1102" aria-hidden="true" tabindex="-1"></a><span class="in">  # Multiply axis limits by 0.5% so that the right "pp." isn't cut off</span></span>
<span id="cb60-1103"><a href="#cb60-1103" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_pp, expand = c(0, 0.005)) +</span></span>
<span id="cb60-1104"><a href="#cb60-1104" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Percentage point difference in proportions",</span></span>
<span id="cb60-1105"><a href="#cb60-1105" aria-hidden="true" tabindex="-1"></a><span class="in">       y = NULL) +</span></span>
<span id="cb60-1106"><a href="#cb60-1106" aria-hidden="true" tabindex="-1"></a><span class="in">  # Make it so the pointrange doesn't get cropped</span></span>
<span id="cb60-1107"><a href="#cb60-1107" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_cartesian(clip = "off") + </span></span>
<span id="cb60-1108"><a href="#cb60-1108" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_nice() +</span></span>
<span id="cb60-1109"><a href="#cb60-1109" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.y = element_blank(),</span></span>
<span id="cb60-1110"><a href="#cb60-1110" aria-hidden="true" tabindex="-1"></a><span class="in">        panel.grid.major.y = element_blank())</span></span>
<span id="cb60-1111"><a href="#cb60-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1112"><a href="#cb60-1112" aria-hidden="true" tabindex="-1"></a><span class="in">(p1 / plot_spacer() / p2) + </span></span>
<span id="cb60-1113"><a href="#cb60-1113" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_layout(heights = c(0.785, 0.03, 0.185))</span></span>
<span id="cb60-1114"><a href="#cb60-1114" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1115"><a href="#cb60-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1116"><a href="#cb60-1116" aria-hidden="true" tabindex="-1"></a><span class="fu">### Actual beta-binomial model</span></span>
<span id="cb60-1117"><a href="#cb60-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1118"><a href="#cb60-1118" aria-hidden="true" tabindex="-1"></a>Until {brms} 2.17, there wasn't an official beta-binomial distribution for {brms}, but it was used as <span class="co">[</span><span class="ot">the example for creating your own custom family</span><span class="co">](https://cran.r-project.org/web/packages/brms/vignettes/brms_customfamilies.html)</span>. It is now implemented in {brms} and allows you to define both a mean ($\mu$) and precision ($\phi$) for a Beta distribution, just like {brms}'s other Beta-related models (like zero-inflated, etc.—<span class="co">[</span><span class="ot">see here for a lot more about those</span><span class="co">](https://www.andrewheiss.com/blog/2021/11/08/beta-regression-guide/)</span>). This means that we can model both parts of the distribution simultaneously, which is neat, since it allows us to deal with potential overdispersion in outcomes.  <span class="co">[</span><span class="ot">Paul Bürkner's original rationale for not including it</span><span class="co">](https://discourse.mc-stan.org/t/beta-binomial-why-not-a-default-family-in-the-package/10625/2)</span> was that a regular binomial model with a random effect for the observation id also allows you to account for overdispersion, so there's not really a need for an official beta-binomial family. <span class="co">[</span><span class="ot">But in March 2022</span><span class="co">](https://github.com/paul-buerkner/brms/pull/1319)</span> the <span class="in">`beta_binomial`</span> family was added as an official distributional family, which is neat.</span>
<span id="cb60-1119"><a href="#cb60-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1120"><a href="#cb60-1120" aria-hidden="true" tabindex="-1"></a>We can use it here instead of <span class="in">`family = binomial(link = "identity")`</span> with a few adjustments. The family uses a different mean/precision parameterization of the Beta distribution instead of the two shapes $\alpha$ and $\beta$, but we can switch between them with some algebra (<span class="co">[</span><span class="ot">see this for more details</span><span class="co">](https://www.andrewheiss.com/blog/2021/11/08/beta-regression-guide/#mean-and-precision-instead-of-shapes)</span>):</span>
<span id="cb60-1121"><a href="#cb60-1121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1122"><a href="#cb60-1122" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-1123"><a href="#cb60-1123" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb60-1124"><a href="#cb60-1124" aria-hidden="true" tabindex="-1"></a>\begin{aligned}<span class="co">[</span><span class="ot">t</span><span class="co">]</span></span>
<span id="cb60-1125"><a href="#cb60-1125" aria-hidden="true" tabindex="-1"></a>\text{Shape 1:} &amp;&amp; \alpha &amp;= \mu \phi <span class="sc">\\</span></span>
<span id="cb60-1126"><a href="#cb60-1126" aria-hidden="true" tabindex="-1"></a>\text{Shape 2:} &amp;&amp; \beta &amp;= (1 - \mu) \phi</span>
<span id="cb60-1127"><a href="#cb60-1127" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb60-1128"><a href="#cb60-1128" aria-hidden="true" tabindex="-1"></a>\qquad\qquad\qquad</span>
<span id="cb60-1129"><a href="#cb60-1129" aria-hidden="true" tabindex="-1"></a>\begin{aligned}<span class="co">[</span><span class="ot">t</span><span class="co">]</span></span>
<span id="cb60-1130"><a href="#cb60-1130" aria-hidden="true" tabindex="-1"></a>\text{Mean:} &amp;&amp; \mu &amp;= \frac{\alpha}{\alpha + \beta} <span class="sc">\\</span></span>
<span id="cb60-1131"><a href="#cb60-1131" aria-hidden="true" tabindex="-1"></a>\text{Precision:} &amp;&amp; \phi &amp;= \alpha + \beta</span>
<span id="cb60-1132"><a href="#cb60-1132" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb60-1133"><a href="#cb60-1133" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb60-1134"><a href="#cb60-1134" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-1135"><a href="#cb60-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1136"><a href="#cb60-1136" aria-hidden="true" tabindex="-1"></a>By default, $\mu$ is modeled on the log odds scale and $\phi$ is modeled on the log scale, but I find both of those really hard to think about, so we can use an identity link for both parameters like we did before with <span class="in">`binomial()`</span> to think about counts and proportions instead. This makes it so the $\phi$ parameter measures the standard deviation of the count on the count scale, so a prior like Exponential(1 / 1000) would imply that the precision (or variance-ish) of the count could vary by mostly low numbers, but maybe up to ±5000ish, which seems reasonable, especially since the Mexico part of the survey has so many respondents:</span>
<span id="cb60-1137"><a href="#cb60-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1138"><a href="#cb60-1138" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-exponential-prior}</span></span>
<span id="cb60-1139"><a href="#cb60-1139" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: Exponential(1/1000) distribution</span></span>
<span id="cb60-1140"><a href="#cb60-1140" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: Exponential(1/1000) distribution</span></span>
<span id="cb60-1141"><a href="#cb60-1141" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb60-1142"><a href="#cb60-1142" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_function(fun = ~dexp(., 0.001), geom = "area", fill = "#AC3414") +</span></span>
<span id="cb60-1143"><a href="#cb60-1143" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_number(big.mark = ","), limits = c(0, 5000)) +</span></span>
<span id="cb60-1144"><a href="#cb60-1144" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Possible values for φ", y = NULL, fill = NULL) +</span></span>
<span id="cb60-1145"><a href="#cb60-1145" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_nice() +</span></span>
<span id="cb60-1146"><a href="#cb60-1146" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.y = element_blank())</span></span>
<span id="cb60-1147"><a href="#cb60-1147" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1148"><a href="#cb60-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1149"><a href="#cb60-1149" aria-hidden="true" tabindex="-1"></a><span class="in">```{r q1-model-beta-binomial, cache=TRUE}</span></span>
<span id="cb60-1150"><a href="#cb60-1150" aria-hidden="true" tabindex="-1"></a><span class="in">often_comics_model_beta_binomial &lt;- brm(</span></span>
<span id="cb60-1151"><a href="#cb60-1151" aria-hidden="true" tabindex="-1"></a><span class="in">  bf(n | trials(total) ~ 0 + country),</span></span>
<span id="cb60-1152"><a href="#cb60-1152" aria-hidden="true" tabindex="-1"></a><span class="in">  data = often_comics_only,</span></span>
<span id="cb60-1153"><a href="#cb60-1153" aria-hidden="true" tabindex="-1"></a><span class="in">  family = beta_binomial(link = "identity", link_phi = "identity"),</span></span>
<span id="cb60-1154"><a href="#cb60-1154" aria-hidden="true" tabindex="-1"></a><span class="in">  prior = c(prior(beta(2, 6), class = "b", dpar = "mu", lb = 0, ub = 1),</span></span>
<span id="cb60-1155"><a href="#cb60-1155" aria-hidden="true" tabindex="-1"></a><span class="in">            prior(exponential(0.001), class = "phi", lb = 0)),</span></span>
<span id="cb60-1156"><a href="#cb60-1156" aria-hidden="true" tabindex="-1"></a><span class="in">  chains = CHAINS, warmup = WARMUP, iter = ITER, seed = BAYES_SEED,</span></span>
<span id="cb60-1157"><a href="#cb60-1157" aria-hidden="true" tabindex="-1"></a><span class="in">  refresh = 0</span></span>
<span id="cb60-1158"><a href="#cb60-1158" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb60-1159"><a href="#cb60-1159" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1160"><a href="#cb60-1160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1161"><a href="#cb60-1161" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb60-1162"><a href="#cb60-1162" aria-hidden="true" tabindex="-1"></a><span class="fu">### Separate model for $\phi$</span></span>
<span id="cb60-1163"><a href="#cb60-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1164"><a href="#cb60-1164" aria-hidden="true" tabindex="-1"></a>If we wanted to be super fancy, we could define a completely separate model for the $\phi$ part of the distribution like this, but we don't need to here:</span>
<span id="cb60-1165"><a href="#cb60-1165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1166"><a href="#cb60-1166" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb60-1167"><a href="#cb60-1167" aria-hidden="true" tabindex="-1"></a>often_comics_model_beta_binomial <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb60-1168"><a href="#cb60-1168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(n <span class="sc">|</span> <span class="fu">trials</span>(total) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> country,</span>
<span id="cb60-1169"><a href="#cb60-1169" aria-hidden="true" tabindex="-1"></a>     phi <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> country),</span>
<span id="cb60-1170"><a href="#cb60-1170" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> often_comics_only,</span>
<span id="cb60-1171"><a href="#cb60-1171" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">beta_binomial</span>(<span class="at">link =</span> <span class="st">"identity"</span>, <span class="at">link_phi =</span> <span class="st">"identity"</span>),</span>
<span id="cb60-1172"><a href="#cb60-1172" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">beta</span>(<span class="dv">2</span>, <span class="dv">6</span>), <span class="at">class =</span> <span class="st">"b"</span>, <span class="at">dpar =</span> <span class="st">"mu"</span>, <span class="at">lb =</span> <span class="dv">0</span>, <span class="at">ub =</span> <span class="dv">1</span>),</span>
<span id="cb60-1173"><a href="#cb60-1173" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="fl">0.001</span>), <span class="at">dpar =</span> <span class="st">"phi"</span>, <span class="at">lb =</span> <span class="dv">0</span>)),</span>
<span id="cb60-1174"><a href="#cb60-1174" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> CHAINS, <span class="at">warmup =</span> WARMUP, <span class="at">iter =</span> ITER, <span class="at">seed =</span> BAYES_SEED,</span>
<span id="cb60-1175"><a href="#cb60-1175" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb60-1176"><a href="#cb60-1176" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-1177"><a href="#cb60-1177" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1178"><a href="#cb60-1178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1179"><a href="#cb60-1179" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb60-1180"><a href="#cb60-1180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1181"><a href="#cb60-1181" aria-hidden="true" tabindex="-1"></a>Check out the results:</span>
<span id="cb60-1182"><a href="#cb60-1182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1183"><a href="#cb60-1183" aria-hidden="true" tabindex="-1"></a><span class="in">```{r q1-model-beta-binomial-show}</span></span>
<span id="cb60-1184"><a href="#cb60-1184" aria-hidden="true" tabindex="-1"></a><span class="in">often_comics_model_beta_binomial</span></span>
<span id="cb60-1185"><a href="#cb60-1185" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1186"><a href="#cb60-1186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1187"><a href="#cb60-1187" aria-hidden="true" tabindex="-1"></a>Those coefficients are the group proportions, as expected, and we have a $\phi$ parameter representing the overall variation in counts. The proportions here are a little more uncertain than before, though, which is apparent if we plot the distributions. The distributions have a much wider range now (note that the x-axis now goes all the way up to 60%), and the densities are a lot bumpier and jankier. I don't know why though! This is weird! I'm probably doing something wrong!</span>
<span id="cb60-1188"><a href="#cb60-1188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1189"><a href="#cb60-1189" aria-hidden="true" tabindex="-1"></a><span class="in">```{r q1-plot-model-beta-binomial}</span></span>
<span id="cb60-1190"><a href="#cb60-1190" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: Posterior distributions of the proportion of students who read comic books often in the United States and Mexico</span></span>
<span id="cb60-1191"><a href="#cb60-1191" aria-hidden="true" tabindex="-1"></a><span class="in">often_comics_model_beta_binomial %&gt;% </span></span>
<span id="cb60-1192"><a href="#cb60-1192" aria-hidden="true" tabindex="-1"></a><span class="in">  epred_draws(newdata = often_comics_only) %&gt;% </span></span>
<span id="cb60-1193"><a href="#cb60-1193" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(.epred_prop = .epred / total) %&gt;% </span></span>
<span id="cb60-1194"><a href="#cb60-1194" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = .epred_prop, y = country, fill = country)) +</span></span>
<span id="cb60-1195"><a href="#cb60-1195" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye() +</span></span>
<span id="cb60-1196"><a href="#cb60-1196" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_percent(), expand = c(0, 0.015)) +</span></span>
<span id="cb60-1197"><a href="#cb60-1197" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = c(clr_usa, clr_mex)) +</span></span>
<span id="cb60-1198"><a href="#cb60-1198" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(fill = "none") +</span></span>
<span id="cb60-1199"><a href="#cb60-1199" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Proportion of students who read comic books often",</span></span>
<span id="cb60-1200"><a href="#cb60-1200" aria-hidden="true" tabindex="-1"></a><span class="in">       y = NULL) +</span></span>
<span id="cb60-1201"><a href="#cb60-1201" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_nice()</span></span>
<span id="cb60-1202"><a href="#cb60-1202" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1203"><a href="#cb60-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1204"><a href="#cb60-1204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1205"><a href="#cb60-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1206"><a href="#cb60-1206" aria-hidden="true" tabindex="-1"></a><span class="fu">## Final answer to the question</span></span>
<span id="cb60-1207"><a href="#cb60-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1208"><a href="#cb60-1208" aria-hidden="true" tabindex="-1"></a><span class="in">```{r extract-details, include=FALSE}</span></span>
<span id="cb60-1209"><a href="#cb60-1209" aria-hidden="true" tabindex="-1"></a><span class="in">group_medians &lt;- often_comics_model %&gt;% </span></span>
<span id="cb60-1210"><a href="#cb60-1210" aria-hidden="true" tabindex="-1"></a><span class="in">  epred_draws(newdata = often_comics_only) %&gt;% </span></span>
<span id="cb60-1211"><a href="#cb60-1211" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(.epred_prop = .epred / total) %&gt;% </span></span>
<span id="cb60-1212"><a href="#cb60-1212" aria-hidden="true" tabindex="-1"></a><span class="in">  median_qi(.epred_prop) %&gt;% </span></span>
<span id="cb60-1213"><a href="#cb60-1213" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(c(.epred_prop, .lower, .upper),</span></span>
<span id="cb60-1214"><a href="#cb60-1214" aria-hidden="true" tabindex="-1"></a><span class="in">                list(nice = ~label_percent(accuracy = 0.1)(.)))) %&gt;% </span></span>
<span id="cb60-1215"><a href="#cb60-1215" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(country = janitor::make_clean_names(country)) %&gt;% </span></span>
<span id="cb60-1216"><a href="#cb60-1216" aria-hidden="true" tabindex="-1"></a><span class="in">  split(~country)</span></span>
<span id="cb60-1217"><a href="#cb60-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1218"><a href="#cb60-1218" aria-hidden="true" tabindex="-1"></a><span class="in">group_diffs &lt;- often_comics_model %&gt;% </span></span>
<span id="cb60-1219"><a href="#cb60-1219" aria-hidden="true" tabindex="-1"></a><span class="in">  epred_draws(newdata = often_comics_only) %&gt;% </span></span>
<span id="cb60-1220"><a href="#cb60-1220" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(.epred_prop = .epred / total) %&gt;% </span></span>
<span id="cb60-1221"><a href="#cb60-1221" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb60-1222"><a href="#cb60-1222" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(country = fct_relevel(country, "United States")) %&gt;% </span></span>
<span id="cb60-1223"><a href="#cb60-1223" aria-hidden="true" tabindex="-1"></a><span class="in">  compare_levels(.epred_prop, by = country,</span></span>
<span id="cb60-1224"><a href="#cb60-1224" aria-hidden="true" tabindex="-1"></a><span class="in">                 comparison = "pairwise") %&gt;% </span></span>
<span id="cb60-1225"><a href="#cb60-1225" aria-hidden="true" tabindex="-1"></a><span class="in">  median_qi(.epred_prop) %&gt;% </span></span>
<span id="cb60-1226"><a href="#cb60-1226" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(c(.epred_prop, .lower, .upper),</span></span>
<span id="cb60-1227"><a href="#cb60-1227" aria-hidden="true" tabindex="-1"></a><span class="in">                list(nice = ~label_number(accuracy = 0.1, scale = 100)(.)))) %&gt;% </span></span>
<span id="cb60-1228"><a href="#cb60-1228" aria-hidden="true" tabindex="-1"></a><span class="in">  as.list()</span></span>
<span id="cb60-1229"><a href="#cb60-1229" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1230"><a href="#cb60-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1231"><a href="#cb60-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1232"><a href="#cb60-1232" aria-hidden="true" tabindex="-1"></a>Phew, that was a lot of slow pedagogical exposure. What's our <span class="in">`r span_col('official estimand', clr_diff)`</span>? What's our final answer to the question "Do respondents in Mexico read comic books more often than respondents in the United States?"?</span>
<span id="cb60-1233"><a href="#cb60-1233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1234"><a href="#cb60-1234" aria-hidden="true" tabindex="-1"></a>Yes. They most definitely do.</span>
<span id="cb60-1235"><a href="#cb60-1235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1236"><a href="#cb60-1236" aria-hidden="true" tabindex="-1"></a>In an official sort of report or article, I'd write something like this:</span>
<span id="cb60-1237"><a href="#cb60-1237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1238"><a href="#cb60-1238" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Students in Mexico are far more likely to read comic books often than students in the United States. On average, </span><span class="in">`r group_medians$mexico$.epred_prop_nice`</span><span class="at"> (between </span><span class="in">`r group_medians$mexico$.lower_nice`</span><span class="at"> and </span><span class="in">`r group_medians$mexico$.upper_nice`</span><span class="at">) of PISA respondents in Mexico read comic books often, compared to </span><span class="in">`r group_medians$united_states$.epred_prop_nice`</span><span class="at"> (between </span><span class="in">`r group_medians$united_states$.lower_nice`</span><span class="at"> and </span><span class="in">`r group_medians$united_states$.upper_nice`</span><span class="at">) in the United States. There is a 95% posterior probability that the difference between these proportions is between </span><span class="in">`r group_diffs$.lower_nice`</span><span class="at"> and </span><span class="in">`r group_diffs$.upper_nice`</span><span class="at"> percentage points, with a median of </span><span class="in">`r group_diffs$.epred_prop_nice`</span><span class="at"> percentage points. This difference is substantial, and there's a 100% chance that the difference is not zero.</span></span>
<span id="cb60-1239"><a href="#cb60-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1240"><a href="#cb60-1240" aria-hidden="true" tabindex="-1"></a><span class="fu"># Question 2: Frequency of newspaper readership in the US</span></span>
<span id="cb60-1241"><a href="#cb60-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1242"><a href="#cb60-1242" aria-hidden="true" tabindex="-1"></a>Now that we've got the gist of proportion tests with {brms}, we'll go a lot faster for this second question. We'll forgo all frequentist stuff and the raw Stan stuff and just skip straight to the intercept-free binomial model with an identity link.</span>
<span id="cb60-1243"><a href="#cb60-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1244"><a href="#cb60-1244" aria-hidden="true" tabindex="-1"></a><span class="fu">## Estimand</span></span>
<span id="cb60-1245"><a href="#cb60-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1246"><a href="#cb60-1246" aria-hidden="true" tabindex="-1"></a>For this question, we want to know the differences in the the proportions of American newspaper-reading frequencies, or whether the differences between (1) <span class="in">`r span_col('rarely', clr_rarely)`</span> and <span class="in">`r span_col('sometimes', clr_sometimes)`</span>, (2) <span class="in">`r span_col('sometimes', clr_sometimes)`</span> and <span class="in">`r span_col('often', clr_often)`</span>, and (3) <span class="in">`r span_col('rarely', clr_rarely)`</span> and <span class="in">`r span_col('often', clr_often)`</span> are greater than zero:</span>
<span id="cb60-1247"><a href="#cb60-1247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1248"><a href="#cb60-1248" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tab-fancy-questions-q2}</span></span>
<span id="cb60-1249"><a href="#cb60-1249" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb60-1250"><a href="#cb60-1250" aria-hidden="true" tabindex="-1"></a><span class="in">fancy_table %&gt;% </span></span>
<span id="cb60-1251"><a href="#cb60-1251" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_style(</span></span>
<span id="cb60-1252"><a href="#cb60-1252" aria-hidden="true" tabindex="-1"></a><span class="in">    style = list(</span></span>
<span id="cb60-1253"><a href="#cb60-1253" aria-hidden="true" tabindex="-1"></a><span class="in">      cell_fill(color = colorspace::lighten("#E51B24", 0.8)),</span></span>
<span id="cb60-1254"><a href="#cb60-1254" aria-hidden="true" tabindex="-1"></a><span class="in">      cell_text(color = "#E51B24", weight = "bold")</span></span>
<span id="cb60-1255"><a href="#cb60-1255" aria-hidden="true" tabindex="-1"></a><span class="in">    ),</span></span>
<span id="cb60-1256"><a href="#cb60-1256" aria-hidden="true" tabindex="-1"></a><span class="in">    locations = list(</span></span>
<span id="cb60-1257"><a href="#cb60-1257" aria-hidden="true" tabindex="-1"></a><span class="in">      cells_body(columns = 3, rows = 4)</span></span>
<span id="cb60-1258"><a href="#cb60-1258" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb60-1259"><a href="#cb60-1259" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb60-1260"><a href="#cb60-1260" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_style(</span></span>
<span id="cb60-1261"><a href="#cb60-1261" aria-hidden="true" tabindex="-1"></a><span class="in">    style = list(</span></span>
<span id="cb60-1262"><a href="#cb60-1262" aria-hidden="true" tabindex="-1"></a><span class="in">      cell_fill(color = colorspace::lighten("#FFDE00", 0.8)),</span></span>
<span id="cb60-1263"><a href="#cb60-1263" aria-hidden="true" tabindex="-1"></a><span class="in">      cell_text(color = colorspace::darken("#FFDE00", 0.1), weight = "bold")</span></span>
<span id="cb60-1264"><a href="#cb60-1264" aria-hidden="true" tabindex="-1"></a><span class="in">    ),</span></span>
<span id="cb60-1265"><a href="#cb60-1265" aria-hidden="true" tabindex="-1"></a><span class="in">    locations = list(</span></span>
<span id="cb60-1266"><a href="#cb60-1266" aria-hidden="true" tabindex="-1"></a><span class="in">      cells_body(columns = 4, rows = 4)</span></span>
<span id="cb60-1267"><a href="#cb60-1267" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb60-1268"><a href="#cb60-1268" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb60-1269"><a href="#cb60-1269" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_style(</span></span>
<span id="cb60-1270"><a href="#cb60-1270" aria-hidden="true" tabindex="-1"></a><span class="in">    style = list(</span></span>
<span id="cb60-1271"><a href="#cb60-1271" aria-hidden="true" tabindex="-1"></a><span class="in">      cell_fill(color = colorspace::lighten("#009DDC", 0.8)),</span></span>
<span id="cb60-1272"><a href="#cb60-1272" aria-hidden="true" tabindex="-1"></a><span class="in">      cell_text(color = "#009DDC", weight = "bold")</span></span>
<span id="cb60-1273"><a href="#cb60-1273" aria-hidden="true" tabindex="-1"></a><span class="in">    ),</span></span>
<span id="cb60-1274"><a href="#cb60-1274" aria-hidden="true" tabindex="-1"></a><span class="in">    locations = list(</span></span>
<span id="cb60-1275"><a href="#cb60-1275" aria-hidden="true" tabindex="-1"></a><span class="in">      cells_body(columns = 5, rows = 4)</span></span>
<span id="cb60-1276"><a href="#cb60-1276" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb60-1277"><a href="#cb60-1277" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-1278"><a href="#cb60-1278" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1279"><a href="#cb60-1279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1280"><a href="#cb60-1280" aria-hidden="true" tabindex="-1"></a>We'll again call this estimand $\theta$, but have three different versions of it:</span>
<span id="cb60-1281"><a href="#cb60-1281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1282"><a href="#cb60-1282" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-1283"><a href="#cb60-1283" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb60-1284"><a href="#cb60-1284" aria-hidden="true" tabindex="-1"></a>\theta_1 &amp;= \pi_\text{US, newspapers, often} - \pi_\text{US, newspapers, sometimes} <span class="sc">\\</span></span>
<span id="cb60-1285"><a href="#cb60-1285" aria-hidden="true" tabindex="-1"></a>\theta_2 &amp;= \pi_\text{US, newspapers, sometimes} - \pi_\text{US, newspapers, rarely} <span class="sc">\\</span></span>
<span id="cb60-1286"><a href="#cb60-1286" aria-hidden="true" tabindex="-1"></a>\theta_3 &amp;= \pi_\text{US, newspapers, often} - \pi_\text{US, newspapers, rarely}</span>
<span id="cb60-1287"><a href="#cb60-1287" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb60-1288"><a href="#cb60-1288" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-1289"><a href="#cb60-1289" aria-hidden="true" tabindex="-1"></a>We just spent a bunch of time talking about comic books, and now we're looking at data about newspapers and America. Who represents all three of these things simultaneously? Clark Kent / Superman, obviously, the *Daily Planet* journalist and superpowered alien dedicated to <span class="co">[</span><span class="ot">truth, justice, and ~~the American way~~ a better tomorrow</span><span class="co">](https://variety.com/2021/film/news/superman-new-motto-dc-fandome-1235090712/)</span>. I found this palette at <span class="co">[</span><span class="ot">Adobe Color</span><span class="co">](https://color.adobe.com/Copy%20of%20Superman-color-theme-11627723)</span>.</span>
<span id="cb60-1290"><a href="#cb60-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1293"><a href="#cb60-1293" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb60-1294"><a href="#cb60-1294" aria-hidden="true" tabindex="-1"></a><span class="co"># US newspaper question colors</span></span>
<span id="cb60-1295"><a href="#cb60-1295" aria-hidden="true" tabindex="-1"></a>clr_often <span class="ot">&lt;-</span> <span class="st">"#009DDC"</span></span>
<span id="cb60-1296"><a href="#cb60-1296" aria-hidden="true" tabindex="-1"></a>clr_sometimes <span class="ot">&lt;-</span> <span class="st">"#FFDE00"</span></span>
<span id="cb60-1297"><a href="#cb60-1297" aria-hidden="true" tabindex="-1"></a>clr_rarely <span class="ot">&lt;-</span> <span class="st">"#E51B24"</span></span>
<span id="cb60-1298"><a href="#cb60-1298" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1299"><a href="#cb60-1299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1300"><a href="#cb60-1300" aria-hidden="true" tabindex="-1"></a>::: {.column-margin}</span>
<span id="cb60-1301"><a href="#cb60-1301" aria-hidden="true" tabindex="-1"></a><span class="al">![](img/superman.jpg)</span></span>
<span id="cb60-1302"><a href="#cb60-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1303"><a href="#cb60-1303" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">"Superman"</span><span class="co">](https://www.flickr.com/photos/27745117@N00/25903472957)</span> by <span class="co">[</span><span class="ot">Hannaford</span><span class="co">](https://www.flickr.com/photos/27745117@N00/)</span></span>
<span id="cb60-1304"><a href="#cb60-1304" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb60-1305"><a href="#cb60-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1306"><a href="#cb60-1306" aria-hidden="true" tabindex="-1"></a><span class="in">```{r show-superman-pal, fig.height=1, fig.width=8, out.width="100%", echo=FALSE}</span></span>
<span id="cb60-1307"><a href="#cb60-1307" aria-hidden="true" tabindex="-1"></a><span class="in">show_nice_pal(c("Often" = clr_often, "Sometimes" = clr_sometimes, "Rarely" = clr_rarely),</span></span>
<span id="cb60-1308"><a href="#cb60-1308" aria-hidden="true" tabindex="-1"></a><span class="in">              use_names = TRUE)</span></span>
<span id="cb60-1309"><a href="#cb60-1309" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1310"><a href="#cb60-1310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1311"><a href="#cb60-1311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1312"><a href="#cb60-1312" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bayesianly with {brms}</span></span>
<span id="cb60-1313"><a href="#cb60-1313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1314"><a href="#cb60-1314" aria-hidden="true" tabindex="-1"></a>Let's first extract the aggregated data we'll work with—newspaper frequency in the United States only:</span>
<span id="cb60-1315"><a href="#cb60-1315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1316"><a href="#cb60-1316" aria-hidden="true" tabindex="-1"></a><span class="in">```{r make-newspaper-counts-data}</span></span>
<span id="cb60-1317"><a href="#cb60-1317" aria-hidden="true" tabindex="-1"></a><span class="in">newspapers_only &lt;- reading_counts %&gt;% </span></span>
<span id="cb60-1318"><a href="#cb60-1318" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_type == "Newspapers", country == "United States")</span></span>
<span id="cb60-1319"><a href="#cb60-1319" aria-hidden="true" tabindex="-1"></a><span class="in">newspapers_only</span></span>
<span id="cb60-1320"><a href="#cb60-1320" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1321"><a href="#cb60-1321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1322"><a href="#cb60-1322" aria-hidden="true" tabindex="-1"></a>We'll define this formal beta-binomial model for each of the group proportions and we'll use a Beta(2, 6) prior again (so 25% ± a bunch):</span>
<span id="cb60-1323"><a href="#cb60-1323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1324"><a href="#cb60-1324" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-1325"><a href="#cb60-1325" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb60-1326"><a href="#cb60-1326" aria-hidden="true" tabindex="-1"></a>&amp;\ \textbf{Estimands} <span class="sc">\\</span></span>
<span id="cb60-1327"><a href="#cb60-1327" aria-hidden="true" tabindex="-1"></a>\theta_1 =&amp;\ \pi_{\text{newspapers, often}_\text{US}} - \pi_{\text{newspapers, sometimes}_\text{US}} <span class="sc">\\</span></span>
<span id="cb60-1328"><a href="#cb60-1328" aria-hidden="true" tabindex="-1"></a>\theta_2 =&amp;\ \pi_{\text{newspapers, sometimes}_\text{US}} - \pi_{\text{newspapers, rarely}_\text{US}} <span class="sc">\\</span></span>
<span id="cb60-1329"><a href="#cb60-1329" aria-hidden="true" tabindex="-1"></a>\theta_3 =&amp;\ \pi_{\text{newspapers, often}_\text{US}} - \pi_{\text{newspapers, rarely}_\text{US}} <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb60-1330"><a href="#cb60-1330" aria-hidden="true" tabindex="-1"></a>&amp;\ \textbf{Beta-binomial model} <span class="sc">\\</span></span>
<span id="cb60-1331"><a href="#cb60-1331" aria-hidden="true" tabindex="-1"></a>y_{n \text{ newspapers, <span class="co">[</span><span class="ot">frequency</span><span class="co">]</span>}_\text{US}} \sim&amp;\ \operatorname{Binomial}(n_{\text{Total students}_\text{US}}, \pi_{\text{newspapers, [frequency]}_\text{US}}) <span class="sc">\\</span></span>
<span id="cb60-1332"><a href="#cb60-1332" aria-hidden="true" tabindex="-1"></a>\pi_{\text{newspapers, <span class="co">[</span><span class="ot">frequency</span><span class="co">]</span>}_\text{US}} \sim&amp;\ \operatorname{Beta}(\alpha, \beta) <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb60-1333"><a href="#cb60-1333" aria-hidden="true" tabindex="-1"></a>&amp;\ \textbf{Priors} <span class="sc">\\</span></span>
<span id="cb60-1334"><a href="#cb60-1334" aria-hidden="true" tabindex="-1"></a>\alpha =&amp;\ 2 <span class="sc">\\</span></span>
<span id="cb60-1335"><a href="#cb60-1335" aria-hidden="true" tabindex="-1"></a>\beta =&amp;\ 6</span>
<span id="cb60-1336"><a href="#cb60-1336" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb60-1337"><a href="#cb60-1337" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb60-1338"><a href="#cb60-1338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1339"><a href="#cb60-1339" aria-hidden="true" tabindex="-1"></a>We can estimate this model with {brms} using an intercept-free binomial model with an identity link:</span>
<span id="cb60-1340"><a href="#cb60-1340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1341"><a href="#cb60-1341" aria-hidden="true" tabindex="-1"></a><span class="in">```{r q2-model-identity, cache=TRUE}</span></span>
<span id="cb60-1342"><a href="#cb60-1342" aria-hidden="true" tabindex="-1"></a><span class="in">freq_newspapers_model &lt;- brm(</span></span>
<span id="cb60-1343"><a href="#cb60-1343" aria-hidden="true" tabindex="-1"></a><span class="in">  bf(n | trials(total) ~ 0 + frequency),</span></span>
<span id="cb60-1344"><a href="#cb60-1344" aria-hidden="true" tabindex="-1"></a><span class="in">  data = newspapers_only,</span></span>
<span id="cb60-1345"><a href="#cb60-1345" aria-hidden="true" tabindex="-1"></a><span class="in">  family = binomial(link = "identity"),</span></span>
<span id="cb60-1346"><a href="#cb60-1346" aria-hidden="true" tabindex="-1"></a><span class="in">  prior = c(prior(beta(2, 6), class = b, lb = 0, ub = 1)),</span></span>
<span id="cb60-1347"><a href="#cb60-1347" aria-hidden="true" tabindex="-1"></a><span class="in">  chains = CHAINS, warmup = WARMUP, iter = ITER, seed = BAYES_SEED,</span></span>
<span id="cb60-1348"><a href="#cb60-1348" aria-hidden="true" tabindex="-1"></a><span class="in">  refresh = 0</span></span>
<span id="cb60-1349"><a href="#cb60-1349" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb60-1350"><a href="#cb60-1350" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1351"><a href="#cb60-1351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1352"><a href="#cb60-1352" aria-hidden="true" tabindex="-1"></a><span class="in">```{r q2-model-identity-show}</span></span>
<span id="cb60-1353"><a href="#cb60-1353" aria-hidden="true" tabindex="-1"></a><span class="in">freq_newspapers_model</span></span>
<span id="cb60-1354"><a href="#cb60-1354" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1355"><a href="#cb60-1355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1356"><a href="#cb60-1356" aria-hidden="true" tabindex="-1"></a>It works! These group proportions are the same as what we found in the contingency table:</span>
<span id="cb60-1357"><a href="#cb60-1357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1358"><a href="#cb60-1358" aria-hidden="true" tabindex="-1"></a><span class="in">```{r q2-plot-model-identity}</span></span>
<span id="cb60-1359"><a href="#cb60-1359" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: Posterior distributions of the proportions of the frequency of reading newspapers among American students</span></span>
<span id="cb60-1360"><a href="#cb60-1360" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: Posterior distributions of the proportions of the frequency of reading newspapers among American students</span></span>
<span id="cb60-1361"><a href="#cb60-1361" aria-hidden="true" tabindex="-1"></a><span class="in">plot_props_newspaper &lt;- freq_newspapers_model %&gt;% </span></span>
<span id="cb60-1362"><a href="#cb60-1362" aria-hidden="true" tabindex="-1"></a><span class="in">  epred_draws(newdata = newspapers_only) %&gt;% </span></span>
<span id="cb60-1363"><a href="#cb60-1363" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(.epred_prop = .epred / total) %&gt;% </span></span>
<span id="cb60-1364"><a href="#cb60-1364" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = .epred_prop, y = frequency, fill = frequency)) +</span></span>
<span id="cb60-1365"><a href="#cb60-1365" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye() +</span></span>
<span id="cb60-1366"><a href="#cb60-1366" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_percent()) +</span></span>
<span id="cb60-1367"><a href="#cb60-1367" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = c(clr_rarely, clr_sometimes, clr_often)) +</span></span>
<span id="cb60-1368"><a href="#cb60-1368" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Proportion of frequencies of newspaper reading", y = NULL) +</span></span>
<span id="cb60-1369"><a href="#cb60-1369" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(fill = "none") +</span></span>
<span id="cb60-1370"><a href="#cb60-1370" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_nice()</span></span>
<span id="cb60-1371"><a href="#cb60-1371" aria-hidden="true" tabindex="-1"></a><span class="in">plot_props_newspaper</span></span>
<span id="cb60-1372"><a href="#cb60-1372" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1373"><a href="#cb60-1373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1374"><a href="#cb60-1374" aria-hidden="true" tabindex="-1"></a>We're interested in our three $\theta$s, or the posterior differences between each of these proportions. We can again use <span class="in">`compare_levels()`</span> to find these all at once. If we specify <span class="in">`comparison = "pairwise"`</span>, {tidybayes} will calculate the differences between each pair of proportions.</span>
<span id="cb60-1375"><a href="#cb60-1375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1376"><a href="#cb60-1376" aria-hidden="true" tabindex="-1"></a><span class="in">```{r q2-plot-model-identity-diffs}</span></span>
<span id="cb60-1377"><a href="#cb60-1377" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: Posterior distributions of the differences between various frequencies of reading newspapers among American students; all density plots are filled with the same color for now</span></span>
<span id="cb60-1378"><a href="#cb60-1378" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: Posterior distributions of the differences between various frequencies of reading newspapers among American students; all density plots are filled with the same color for now</span></span>
<span id="cb60-1379"><a href="#cb60-1379" aria-hidden="true" tabindex="-1"></a><span class="in">freq_newspapers_diffs &lt;- freq_newspapers_model %&gt;% </span></span>
<span id="cb60-1380"><a href="#cb60-1380" aria-hidden="true" tabindex="-1"></a><span class="in">  epred_draws(newdata = newspapers_only) %&gt;% </span></span>
<span id="cb60-1381"><a href="#cb60-1381" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(.epred_prop = .epred / total) %&gt;% </span></span>
<span id="cb60-1382"><a href="#cb60-1382" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb60-1383"><a href="#cb60-1383" aria-hidden="true" tabindex="-1"></a><span class="in">  compare_levels(.epred_prop, by = frequency) %&gt;% </span></span>
<span id="cb60-1384"><a href="#cb60-1384" aria-hidden="true" tabindex="-1"></a><span class="in">  # Put these in the right order</span></span>
<span id="cb60-1385"><a href="#cb60-1385" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(frequency = factor(frequency, levels = c("Often - Sometimes", </span></span>
<span id="cb60-1386"><a href="#cb60-1386" aria-hidden="true" tabindex="-1"></a><span class="in">                                                  "Sometimes - Rarely",</span></span>
<span id="cb60-1387"><a href="#cb60-1387" aria-hidden="true" tabindex="-1"></a><span class="in">                                                  "Often - Rarely")))</span></span>
<span id="cb60-1388"><a href="#cb60-1388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1389"><a href="#cb60-1389" aria-hidden="true" tabindex="-1"></a><span class="in">freq_newspapers_diffs %&gt;% </span></span>
<span id="cb60-1390"><a href="#cb60-1390" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = .epred_prop, y = fct_rev(frequency), fill = frequency)) +</span></span>
<span id="cb60-1391"><a href="#cb60-1391" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye(fill = clr_diff) +</span></span>
<span id="cb60-1392"><a href="#cb60-1392" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = 0, color = "#F012BE") +</span></span>
<span id="cb60-1393"><a href="#cb60-1393" aria-hidden="true" tabindex="-1"></a><span class="in">  # Multiply axis limits by 0.5% so that the right "pp." isn't cut off</span></span>
<span id="cb60-1394"><a href="#cb60-1394" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_pp, expand = c(0, 0.005)) +</span></span>
<span id="cb60-1395"><a href="#cb60-1395" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Percentage point difference in proportions",</span></span>
<span id="cb60-1396"><a href="#cb60-1396" aria-hidden="true" tabindex="-1"></a><span class="in">       y = NULL) +</span></span>
<span id="cb60-1397"><a href="#cb60-1397" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(fill = "none") +</span></span>
<span id="cb60-1398"><a href="#cb60-1398" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_nice()</span></span>
<span id="cb60-1399"><a href="#cb60-1399" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1400"><a href="#cb60-1400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1401"><a href="#cb60-1401" aria-hidden="true" tabindex="-1"></a>We can also calculate the official median differences and the probabilities that the posteriors are greater than 0:</span>
<span id="cb60-1402"><a href="#cb60-1402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1403"><a href="#cb60-1403" aria-hidden="true" tabindex="-1"></a><span class="in">```{r q2-model-p-gt-0}</span></span>
<span id="cb60-1404"><a href="#cb60-1404" aria-hidden="true" tabindex="-1"></a><span class="in">freq_newspapers_diffs %&gt;% </span></span>
<span id="cb60-1405"><a href="#cb60-1405" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(median = median_qi(.epred_prop, .width = 0.95),</span></span>
<span id="cb60-1406"><a href="#cb60-1406" aria-hidden="true" tabindex="-1"></a><span class="in">            p_gt_0 = sum(.epred_prop &gt; 0) / n()) %&gt;% </span></span>
<span id="cb60-1407"><a href="#cb60-1407" aria-hidden="true" tabindex="-1"></a><span class="in">  unnest(median)</span></span>
<span id="cb60-1408"><a href="#cb60-1408" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1409"><a href="#cb60-1409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1410"><a href="#cb60-1410" aria-hidden="true" tabindex="-1"></a>There's only a 60ish% chance that the difference between <span class="in">`r span_col("often", clr_often)`</span> and <span class="in">`r span_col("sometimes", clr_sometimes)`</span> is bigger than zero, so there's probably not an actual difference between those two categories, but there's a 100% chance that the differences between <span class="in">`r span_col("sometimes", clr_sometimes)`</span> and <span class="in">`r span_col("rarely", clr_rarely)`</span> and <span class="in">`r span_col("often", clr_often)`</span> and <span class="in">`r span_col("rarely", clr_rarely)`</span> are bigger than zero.</span>
<span id="cb60-1411"><a href="#cb60-1411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1412"><a href="#cb60-1412" aria-hidden="true" tabindex="-1"></a><span class="fu">## Better fill colors</span></span>
<span id="cb60-1413"><a href="#cb60-1413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1414"><a href="#cb60-1414" aria-hidden="true" tabindex="-1"></a>Before writing up the final official answer, we need to tweak the plot of differences. With the comic book question, we used some overly-simplified-and-wrong color theory and created a <span class="in">`r span_col("yellow", clr_diff)`</span> color for the difference (since <span class="in">`r span_col("blue", clr_usa)`</span> − <span class="in">`r span_col("green", clr_mex)`</span> = <span class="in">`r span_col("yellow", clr_diff)`</span>). We could maybe do that here too, but we've actually used all primary colors in our Superman palette. I don't know what <span class="in">`r span_col("blue", clr_often)`</span> − <span class="in">`r span_col("yellow", clr_sometimes)`</span> or <span class="in">`r span_col("yellow", clr_sometimes)`</span> − <span class="in">`r span_col("red", clr_rarely)`</span> would be, and even if I calculated it somehow, it wouldn't be as cutely intuitive as blue minus green.</span>
<span id="cb60-1415"><a href="#cb60-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1416"><a href="#cb60-1416" aria-hidden="true" tabindex="-1"></a>So instead, we'll do some fancy fill work with the neat <span class="co">[</span><span class="ot">{ggpattern} package</span><span class="co">](https://coolbutuseless.github.io/package/ggpattern/)</span>, which lets us fill ggplot geoms with multiply-colored patterns. We'll fill each distribution of $\theta$s with the combination of the two colors: we'll fill the difference between <span class="in">`r span_col("often", clr_often)`</span> and <span class="in">`r span_col("sometimes", clr_sometimes)`</span> with stripes of those two colors, and so on.</span>
<span id="cb60-1417"><a href="#cb60-1417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1418"><a href="#cb60-1418" aria-hidden="true" tabindex="-1"></a>We can't use <span class="in">`geom/stat_halfeye()`</span> because {tidybayes} does fancier geom work when plotting its density slabs, but we can use <span class="in">`geom_density_pattern()`</span> to create normal density plots:</span>
<span id="cb60-1419"><a href="#cb60-1419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1420"><a href="#cb60-1420" aria-hidden="true" tabindex="-1"></a><span class="in">```{r q2-diffs-plot-patterns}</span></span>
<span id="cb60-1421"><a href="#cb60-1421" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: Posterior distributions of the differences between various frequencies of reading newspapers among American students; all density plots are filled with two stripes corresponding to the difference of their two categories</span></span>
<span id="cb60-1422"><a href="#cb60-1422" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: Posterior distributions of the differences between various frequencies of reading newspapers among American students; all density plots are filled with two stripes corresponding to the difference of their two categories</span></span>
<span id="cb60-1423"><a href="#cb60-1423" aria-hidden="true" tabindex="-1"></a><span class="in">freq_newspapers_diffs %&gt;% </span></span>
<span id="cb60-1424"><a href="#cb60-1424" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = .epred_prop, fill = frequency, pattern_fill = frequency)) +</span></span>
<span id="cb60-1425"><a href="#cb60-1425" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_density_pattern(</span></span>
<span id="cb60-1426"><a href="#cb60-1426" aria-hidden="true" tabindex="-1"></a><span class="in">    pattern = "stripe",  # Stripes</span></span>
<span id="cb60-1427"><a href="#cb60-1427" aria-hidden="true" tabindex="-1"></a><span class="in">    pattern_density = 0.5,  # Take up 50% of the pattern (i.e. stripes equally sized)</span></span>
<span id="cb60-1428"><a href="#cb60-1428" aria-hidden="true" tabindex="-1"></a><span class="in">    pattern_spacing = 0.2,  # Thicker stripes</span></span>
<span id="cb60-1429"><a href="#cb60-1429" aria-hidden="true" tabindex="-1"></a><span class="in">    pattern_size = 0,  # No border on the stripes</span></span>
<span id="cb60-1430"><a href="#cb60-1430" aria-hidden="true" tabindex="-1"></a><span class="in">    trim = TRUE,  # Trim the ends of the distributions</span></span>
<span id="cb60-1431"><a href="#cb60-1431" aria-hidden="true" tabindex="-1"></a><span class="in">    linewidth = 0  # No border on the distributions</span></span>
<span id="cb60-1432"><a href="#cb60-1432" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb60-1433"><a href="#cb60-1433" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = 0, color = "#F012BE") +</span></span>
<span id="cb60-1434"><a href="#cb60-1434" aria-hidden="true" tabindex="-1"></a><span class="in">  # Multiply axis limits by 0.5% so that the right "pp." isn't cut off</span></span>
<span id="cb60-1435"><a href="#cb60-1435" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_pp, expand = c(0, 0.005)) +</span></span>
<span id="cb60-1436"><a href="#cb60-1436" aria-hidden="true" tabindex="-1"></a><span class="in">  # Set colors for fills and pattern fills</span></span>
<span id="cb60-1437"><a href="#cb60-1437" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = c(clr_often, clr_sometimes, clr_often)) +</span></span>
<span id="cb60-1438"><a href="#cb60-1438" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_pattern_fill_manual(values = c(clr_sometimes, clr_rarely, clr_rarely)) +</span></span>
<span id="cb60-1439"><a href="#cb60-1439" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(fill = "none", pattern_fill = "none") +  # Turn off legends</span></span>
<span id="cb60-1440"><a href="#cb60-1440" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Percentage point difference in proportions",</span></span>
<span id="cb60-1441"><a href="#cb60-1441" aria-hidden="true" tabindex="-1"></a><span class="in">       y = NULL) +</span></span>
<span id="cb60-1442"><a href="#cb60-1442" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(frequency), ncol = 1) +</span></span>
<span id="cb60-1443"><a href="#cb60-1443" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_nice() +</span></span>
<span id="cb60-1444"><a href="#cb60-1444" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.y = element_blank(),</span></span>
<span id="cb60-1445"><a href="#cb60-1445" aria-hidden="true" tabindex="-1"></a><span class="in">        panel.grid.major.y = element_blank())</span></span>
<span id="cb60-1446"><a href="#cb60-1446" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1447"><a href="#cb60-1447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1448"><a href="#cb60-1448" aria-hidden="true" tabindex="-1"></a>Ahhh that's so cool!</span>
<span id="cb60-1449"><a href="#cb60-1449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1450"><a href="#cb60-1450" aria-hidden="true" tabindex="-1"></a>The only thing that's missing is the pointrange that we get from <span class="in">`stat_halfeye()`</span> that shows the median and the 50%, 80%, and 95% credible intervals. We can calculate those ourselves and add them with <span class="in">`geom_pointinterval()`</span>:</span>
<span id="cb60-1451"><a href="#cb60-1451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1452"><a href="#cb60-1452" aria-hidden="true" tabindex="-1"></a><span class="in">```{r q2-diffs-plot-patterns-pointrange}</span></span>
<span id="cb60-1453"><a href="#cb60-1453" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: Posterior distributions of the differences between various frequencies of reading newspapers among American students; density plots are filled with stripes and a pointrange shows the median and 50%, 80%, and 95% credible intervals</span></span>
<span id="cb60-1454"><a href="#cb60-1454" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: Posterior distributions of the differences between various frequencies of reading newspapers among American students; density plots are filled with stripes and a pointrange shows the median and 50%, 80%, and 95% credible intervals</span></span>
<span id="cb60-1455"><a href="#cb60-1455" aria-hidden="true" tabindex="-1"></a><span class="in"># Find medians and credible intervals</span></span>
<span id="cb60-1456"><a href="#cb60-1456" aria-hidden="true" tabindex="-1"></a><span class="in">freq_newspapers_intervals &lt;- freq_newspapers_diffs %&gt;% </span></span>
<span id="cb60-1457"><a href="#cb60-1457" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(frequency) %&gt;% </span></span>
<span id="cb60-1458"><a href="#cb60-1458" aria-hidden="true" tabindex="-1"></a><span class="in">  median_qi(.epred_prop, .width = c(0.5, 0.8, 0.95))</span></span>
<span id="cb60-1459"><a href="#cb60-1459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1460"><a href="#cb60-1460" aria-hidden="true" tabindex="-1"></a><span class="in">plot_diffs_nice &lt;- freq_newspapers_diffs %&gt;% </span></span>
<span id="cb60-1461"><a href="#cb60-1461" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = .epred_prop, fill = frequency, pattern_fill = frequency)) +</span></span>
<span id="cb60-1462"><a href="#cb60-1462" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_density_pattern(</span></span>
<span id="cb60-1463"><a href="#cb60-1463" aria-hidden="true" tabindex="-1"></a><span class="in">    pattern = "stripe",  # Stripes</span></span>
<span id="cb60-1464"><a href="#cb60-1464" aria-hidden="true" tabindex="-1"></a><span class="in">    pattern_density = 0.5,  # Take up 50% of the pattern (i.e. stripes equally sized)</span></span>
<span id="cb60-1465"><a href="#cb60-1465" aria-hidden="true" tabindex="-1"></a><span class="in">    pattern_spacing = 0.2,  # Thicker stripes</span></span>
<span id="cb60-1466"><a href="#cb60-1466" aria-hidden="true" tabindex="-1"></a><span class="in">    pattern_size = 0,  # No border on the stripes</span></span>
<span id="cb60-1467"><a href="#cb60-1467" aria-hidden="true" tabindex="-1"></a><span class="in">    trim = TRUE,  # Trim the ends of the distributions</span></span>
<span id="cb60-1468"><a href="#cb60-1468" aria-hidden="true" tabindex="-1"></a><span class="in">    linewidth = 0  # No border on the distributions</span></span>
<span id="cb60-1469"><a href="#cb60-1469" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb60-1470"><a href="#cb60-1470" aria-hidden="true" tabindex="-1"></a><span class="in">  # Add 50%, 80%, and 95% intervals + median</span></span>
<span id="cb60-1471"><a href="#cb60-1471" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_pointinterval(data = freq_newspapers_intervals, </span></span>
<span id="cb60-1472"><a href="#cb60-1472" aria-hidden="true" tabindex="-1"></a><span class="in">                     aes(x = .epred_prop, xmin = .lower, xmax = .upper)) +</span></span>
<span id="cb60-1473"><a href="#cb60-1473" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = 0, color = "#F012BE") +</span></span>
<span id="cb60-1474"><a href="#cb60-1474" aria-hidden="true" tabindex="-1"></a><span class="in">  # Multiply axis limits by 0.5% so that the right "pp." isn't cut off</span></span>
<span id="cb60-1475"><a href="#cb60-1475" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_pp, expand = c(0, 0.005)) +</span></span>
<span id="cb60-1476"><a href="#cb60-1476" aria-hidden="true" tabindex="-1"></a><span class="in">  # Set colors for fills and pattern fills</span></span>
<span id="cb60-1477"><a href="#cb60-1477" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = c(clr_often, clr_sometimes, clr_often)) +</span></span>
<span id="cb60-1478"><a href="#cb60-1478" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_pattern_fill_manual(values = c(clr_sometimes, clr_rarely, clr_rarely)) +</span></span>
<span id="cb60-1479"><a href="#cb60-1479" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(fill = "none", pattern_fill = "none") +  # Turn off legends</span></span>
<span id="cb60-1480"><a href="#cb60-1480" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Percentage point difference in proportions",</span></span>
<span id="cb60-1481"><a href="#cb60-1481" aria-hidden="true" tabindex="-1"></a><span class="in">       y = NULL) +</span></span>
<span id="cb60-1482"><a href="#cb60-1482" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(frequency), ncol = 1) +</span></span>
<span id="cb60-1483"><a href="#cb60-1483" aria-hidden="true" tabindex="-1"></a><span class="in">  # Make it so the pointrange doesn't get cropped</span></span>
<span id="cb60-1484"><a href="#cb60-1484" aria-hidden="true" tabindex="-1"></a><span class="in">  coord_cartesian(clip = "off") + </span></span>
<span id="cb60-1485"><a href="#cb60-1485" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_nice() +</span></span>
<span id="cb60-1486"><a href="#cb60-1486" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.y = element_blank(),</span></span>
<span id="cb60-1487"><a href="#cb60-1487" aria-hidden="true" tabindex="-1"></a><span class="in">        panel.grid.major.y = element_blank())</span></span>
<span id="cb60-1488"><a href="#cb60-1488" aria-hidden="true" tabindex="-1"></a><span class="in">plot_diffs_nice</span></span>
<span id="cb60-1489"><a href="#cb60-1489" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1490"><a href="#cb60-1490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1491"><a href="#cb60-1491" aria-hidden="true" tabindex="-1"></a>Perfect!</span>
<span id="cb60-1492"><a href="#cb60-1492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1493"><a href="#cb60-1493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1494"><a href="#cb60-1494" aria-hidden="true" tabindex="-1"></a><span class="fu">## Final answer to the question</span></span>
<span id="cb60-1495"><a href="#cb60-1495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1496"><a href="#cb60-1496" aria-hidden="true" tabindex="-1"></a><span class="in">```{r extract-details-newspapers, include=FALSE}</span></span>
<span id="cb60-1497"><a href="#cb60-1497" aria-hidden="true" tabindex="-1"></a><span class="in">newspaper_medians &lt;- freq_newspapers_model %&gt;% </span></span>
<span id="cb60-1498"><a href="#cb60-1498" aria-hidden="true" tabindex="-1"></a><span class="in">  epred_draws(newdata = newspapers_only) %&gt;% </span></span>
<span id="cb60-1499"><a href="#cb60-1499" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(.epred_prop = .epred / total) %&gt;% </span></span>
<span id="cb60-1500"><a href="#cb60-1500" aria-hidden="true" tabindex="-1"></a><span class="in">  median_qi(.epred_prop) %&gt;% </span></span>
<span id="cb60-1501"><a href="#cb60-1501" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(frequency) %&gt;% </span></span>
<span id="cb60-1502"><a href="#cb60-1502" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(c(.epred_prop, .lower, .upper),</span></span>
<span id="cb60-1503"><a href="#cb60-1503" aria-hidden="true" tabindex="-1"></a><span class="in">                list(nice = ~label_percent(accuracy = 0.1, style_negative = "minus")(.)))) %&gt;% </span></span>
<span id="cb60-1504"><a href="#cb60-1504" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(frequency = janitor::make_clean_names(frequency)) %&gt;% </span></span>
<span id="cb60-1505"><a href="#cb60-1505" aria-hidden="true" tabindex="-1"></a><span class="in">  split(~frequency)</span></span>
<span id="cb60-1506"><a href="#cb60-1506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1507"><a href="#cb60-1507" aria-hidden="true" tabindex="-1"></a><span class="in">freq_newspapers_diffs %&gt;% </span></span>
<span id="cb60-1508"><a href="#cb60-1508" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(median = median_qi(.epred_prop, .width = 0.95),</span></span>
<span id="cb60-1509"><a href="#cb60-1509" aria-hidden="true" tabindex="-1"></a><span class="in">            p_gt_0 = sum(.epred_prop &gt; 0) / n()) %&gt;% </span></span>
<span id="cb60-1510"><a href="#cb60-1510" aria-hidden="true" tabindex="-1"></a><span class="in">  unnest(median)</span></span>
<span id="cb60-1511"><a href="#cb60-1511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1512"><a href="#cb60-1512" aria-hidden="true" tabindex="-1"></a><span class="in">newspaper_diffs &lt;- freq_newspapers_diffs %&gt;% </span></span>
<span id="cb60-1513"><a href="#cb60-1513" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(frequency) %&gt;%</span></span>
<span id="cb60-1514"><a href="#cb60-1514" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(median = median_qi(.epred_prop, .width = 0.95),</span></span>
<span id="cb60-1515"><a href="#cb60-1515" aria-hidden="true" tabindex="-1"></a><span class="in">            p_gt_0 = sum(.epred_prop &gt; 0) / n()) %&gt;% </span></span>
<span id="cb60-1516"><a href="#cb60-1516" aria-hidden="true" tabindex="-1"></a><span class="in">  unnest(median) %&gt;% </span></span>
<span id="cb60-1517"><a href="#cb60-1517" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(c(y, ymin, ymax),</span></span>
<span id="cb60-1518"><a href="#cb60-1518" aria-hidden="true" tabindex="-1"></a><span class="in">                list(nice = ~label_number(accuracy = 0.1, scale = 100, style_negative = "minus")(.)))) %&gt;% </span></span>
<span id="cb60-1519"><a href="#cb60-1519" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(p_gt_0_nice = label_percent(accuracy = 0.1)(p_gt_0)) %&gt;% </span></span>
<span id="cb60-1520"><a href="#cb60-1520" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(frequency = janitor::make_clean_names(frequency)) %&gt;% </span></span>
<span id="cb60-1521"><a href="#cb60-1521" aria-hidden="true" tabindex="-1"></a><span class="in">  split(~frequency)</span></span>
<span id="cb60-1522"><a href="#cb60-1522" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1523"><a href="#cb60-1523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1524"><a href="#cb60-1524" aria-hidden="true" tabindex="-1"></a>So, given these results, what's the answer to the question "Do students in the United States vary in their frequency of reading newspapers?"? What are our three $\theta$s? The frequencies vary, but only between <span class="in">`r span_col('rarely', clr_rarely)`</span> and the other two categories. There's no difference between <span class="in">`r span_col('sometimes', clr_sometimes)`</span> and <span class="in">`r span_col('often', clr_often)`</span></span>
<span id="cb60-1525"><a href="#cb60-1525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1526"><a href="#cb60-1526" aria-hidden="true" tabindex="-1"></a><span class="in">```{r q2-plot-final, fig.width=6.5, fig.height=3, out.width="100%"}</span></span>
<span id="cb60-1527"><a href="#cb60-1527" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: Posterior distribution of the proportions and difference in proportions of the frequency of reading newspapers among American students</span></span>
<span id="cb60-1528"><a href="#cb60-1528" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: Posterior distribution of the proportions and difference in proportions of the frequency of reading newspapers among American students</span></span>
<span id="cb60-1529"><a href="#cb60-1529" aria-hidden="true" tabindex="-1"></a><span class="in">(</span></span>
<span id="cb60-1530"><a href="#cb60-1530" aria-hidden="true" tabindex="-1"></a><span class="in">  (plot_props_newspaper + labs(x = "Proportions") + </span></span>
<span id="cb60-1531"><a href="#cb60-1531" aria-hidden="true" tabindex="-1"></a><span class="in">     facet_wrap(vars("Response proportions"))) | </span></span>
<span id="cb60-1532"><a href="#cb60-1532" aria-hidden="true" tabindex="-1"></a><span class="in">    plot_spacer() |</span></span>
<span id="cb60-1533"><a href="#cb60-1533" aria-hidden="true" tabindex="-1"></a><span class="in">    (plot_diffs_nice + labs(x = "Percentage point differences"))</span></span>
<span id="cb60-1534"><a href="#cb60-1534" aria-hidden="true" tabindex="-1"></a><span class="in">) +</span></span>
<span id="cb60-1535"><a href="#cb60-1535" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_layout(widths = c(0.475, 0.05, 0.475))</span></span>
<span id="cb60-1536"><a href="#cb60-1536" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1537"><a href="#cb60-1537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1538"><a href="#cb60-1538" aria-hidden="true" tabindex="-1"></a>Here's how I'd write about the results:</span>
<span id="cb60-1539"><a href="#cb60-1539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1540"><a href="#cb60-1540" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Students in the United States tend to read the newspaper at least sometimes, and are least likely to read it rarely. On average, </span><span class="in">`r newspaper_medians$rarely$.epred_prop_nice`</span><span class="at"> of American PISA respondents report reading the newspaper rarely (with a 95% credible interval of between </span><span class="in">`r newspaper_medians$rarely$.lower_nice`</span><span class="at"> and </span><span class="in">`r newspaper_medians$rarely$.upper_nice`</span><span class="at">), compared to </span><span class="in">`r newspaper_medians$sometimes$.epred_prop_nice`</span><span class="at"> reading sometimes (</span><span class="in">`r newspaper_medians$sometimes$.lower_nice`</span><span class="at">–</span><span class="in">`r newspaper_medians$sometimes$.upper_nice`</span><span class="at">) and </span><span class="in">`r newspaper_medians$often$.epred_prop_nice`</span><span class="at"> reading sometimes (</span><span class="in">`r newspaper_medians$often$.lower_nice`</span><span class="at">–</span><span class="in">`r newspaper_medians$often$.upper_nice`</span><span class="at">). </span></span>
<span id="cb60-1541"><a href="#cb60-1541" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; </span></span>
<span id="cb60-1542"><a href="#cb60-1542" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; There is no substantial difference in proportions between those reporting reading newspapers often and sometimes. The posterior median difference is between </span><span class="in">`r newspaper_diffs$often_sometimes$ymin_nice`</span><span class="at"> and </span><span class="in">`r newspaper_diffs$often_sometimes$ymax_nice`</span><span class="at"> percentage points, with a median of </span><span class="in">`r newspaper_diffs$often_sometimes$y_nice`</span><span class="at"> percentage points, and there's only a </span><span class="in">`r newspaper_diffs$often_sometimes$p_gt_0_nice`</span><span class="at"> probability that this difference is greater than 0, which implies that the two categories are indistinguishable from each other. </span></span>
<span id="cb60-1543"><a href="#cb60-1543" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; </span></span>
<span id="cb60-1544"><a href="#cb60-1544" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; There *is* a clear substantial difference between the proportion reading newspapers rarely and the other two responses, though. The posterior median difference between sometimes and rarely is between </span><span class="in">`r newspaper_diffs$sometimes_rarely$ymin_nice`</span><span class="at"> and </span><span class="in">`r newspaper_diffs$sometimes_rarely$ymax_nice`</span><span class="at"> percentage points (median = </span><span class="in">`r newspaper_diffs$sometimes_rarely$y_nice`</span><span class="at">), while the difference between often and rarely is between </span><span class="in">`r newspaper_diffs$often_rarely$ymin_nice`</span><span class="at"> and </span><span class="in">`r newspaper_diffs$often_rarely$ymax_nice`</span><span class="at"> percentage points (median = </span><span class="in">`r newspaper_diffs$often_rarely$y_nice`</span><span class="at">). The probability that each of these differences is greater than 0 is 100%.</span></span>
<span id="cb60-1545"><a href="#cb60-1545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1546"><a href="#cb60-1546" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb60-1547"><a href="#cb60-1547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1548"><a href="#cb60-1548" aria-hidden="true" tabindex="-1"></a>Et voila! Principled, easily interpretable, non-golem-based tests of differences in proportions using Bayesian statistics!</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p><span class="faux-block"><i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> 2007–2024 Andrew Heiss</span> <span class="faux-block">All content licensed under<br><a href="https://creativecommons.org/licenses/by/4.0/"><i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> <i class="fa-brands fa-creative-commons-by" aria-label="creative-commons-by"></i> Creative Commons CC BY 4.0</a></span></p>
</div>   
    <div class="nav-footer-center">
<p><span class="faux-block"><i class="fa-brands fa-orcid" aria-label="orcid"></i> <strong>ORCID</strong> <a href="https://orcid.org/0000-0002-3948-3914">0000-0002-3948-3914</a></span> <span class="faux-block"><i class="fa-solid fa-key" aria-label="key"></i> <a href="../../../../../pgp_ath.asc.txt">PGP public key</a>   <i class="fa-solid fa-fingerprint" aria-label="fingerprint"></i> Fingerprint:<br><span class="fingerprint">4AA2 FA83 A8B2 05A4 E30F<br> 610D 1382 6216 9178 36AB</span></span></p>
</div>
    <div class="nav-footer-right">
<p><span class="faux-block">Made with <i class="fa-brands fa-r-project" aria-label="r-project"></i> and <a href="https://quarto.org/">Quarto</a></span> <span class="faux-block"><a href="https://github.com/andrewheiss/ath-quarto">View the source at <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></span></p>
</div>
  </div>
</footer>


</body></html>