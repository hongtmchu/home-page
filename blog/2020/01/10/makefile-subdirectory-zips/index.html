<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Andrew Heiss">
<meta name="description" content="Use a Makefile to automatically zip up all subdirectories in a given folder while also accounting for dependencies">

<title>Automatically zip up subdirectories with Make | Andrew Heiss – Andrew Heiss</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../../">
<link href="../../../../..//files/favicon-512.png" rel="icon" type="image/png">
<script src="../../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting-17c909d5fd25ae21b861c0c7a49b2096.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../site_libs/bootstrap/bootstrap-5cd0811f461c8271ae6bab49df9501be.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script src="../../../../../site_libs/quarto-contrib/iconify-2.0.0/iconify-icon.min.js"></script>
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-527449-5', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background: #170C3A;
      }
</style>


<meta property="og:title" content="Automatically zip up subdirectories with Make | Andrew Heiss">
<meta property="og:description" content="Use a Makefile to automatically zip up all subdirectories in a given folder while also accounting for dependencies">
<meta property="og:image" content="https://www.andrewheiss.com/blog/2020/01/10/makefile-subdirectory-zips/makefile-subdirectory-zips.png">
<meta property="og:site_name" content="Andrew Heiss">
<meta property="og:locale" content="en_US">
<meta property="og:image:height" content="675">
<meta property="og:image:width" content="1200">
<meta name="twitter:title" content="Automatically zip up subdirectories with Make | Andrew Heiss">
<meta name="twitter:description" content="Use a Makefile to automatically zip up all subdirectories in a given folder while also accounting for dependencies">
<meta name="twitter:image" content="https://www.andrewheiss.com/blog/2020/01/10/makefile-subdirectory-zips/makefile-subdirectory-zips.png">
<meta name="twitter:creator" content="@andrewheiss">
<meta name="twitter:site" content="@andrewheiss">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image-height" content="675">
<meta name="twitter:image-width" content="1200">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../../index.html">
    <span class="navbar-title">Andrew Heiss</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../cv/index.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../research/index.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../teaching/index.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../talks/index.html"> 
<span class="menu-text">Talks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../now/index.html"> 
<span class="menu-text">Now</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../uses/index.html"> 
<span class="menu-text">Uses</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../../atom.xml"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:rss" style="font-size: 1.1em;" aria-label="Icon rss from bi Iconify.design set." title="RSS"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="mailto:aheiss@gsu.edu"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:envelope" style="font-size: 1.1em;" aria-label="Icon envelope from bi Iconify.design set." title="E-mail"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://bsky.app/profile/andrew.heiss.phd" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="fa6-brands:bluesky" style="font-size: 1.1em;" aria-label="Icon bluesky from fa6-brands Iconify.design set." title="Bluesky"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://fediscience.org/users/andrew/" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:mastodon" style="font-size: 1.1em;" aria-label="Icon mastodon from bi Iconify.design set." title="Mastodon"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/andrewheiss" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:github" style="font-size: 1.1em;" aria-label="Icon github from bi Iconify.design set." title="GitHub"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.youtube.com/andrewheiss" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:youtube" style="font-size: 1.1em;" aria-label="Icon youtube from bi Iconify.design set." title="YouTube"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.heissatopia.com/"> 
<span class="menu-text"><iconify-icon inline="" icon="fa6-brands:blogger" style="font-size: 1.15em;" aria-label="Icon blogger from fa6-brands Iconify.design set." title="Blogger"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/andrewheiss" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:linkedin" style="font-size: 1.1em;" aria-label="Icon linkedin from bi Iconify.design set." title="LinkedIn"></iconify-icon></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default blog-post page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Automatically zip up subdirectories with Make</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
                  <div>
        <div class="description">
          Use a Makefile to automatically zip up all subdirectories in a given folder <em>while also</em> accounting for dependencies
        </div>
      </div>
                </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://www.andrewheiss.com/">Andrew Heiss</a> <a href="https://orcid.org/0000-0002-3948-3914" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">Friday, January 10, 2020</p>
      </div>
    </div>
    
      
      <div>
      <div class="quarto-title-meta-heading">Doi</div>
      <div class="quarto-title-meta-contents">
        <p class="doi">
          <a href="https://doi.org/10.59350/t1hra-4a041">10.59350/t1hra-4a041</a>
        </p>
      </div>
    </div>
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#folder-structure" id="toc-folder-structure" class="nav-link active" data-scroll-target="#folder-structure">Folder structure</a></li>
  <li><a href="#basic-approach" id="toc-basic-approach" class="nav-link" data-scroll-target="#basic-approach">Basic approach</a></li>
  <li><a href="#problems-with-the-basic-approach" id="toc-problems-with-the-basic-approach" class="nav-link" data-scroll-target="#problems-with-the-basic-approach">Problems with the basic approach</a></li>
  <li><a href="#tweaking-the-zip-recipe" id="toc-tweaking-the-zip-recipe" class="nav-link" data-scroll-target="#tweaking-the-zip-recipe">Tweaking the <code>zip</code> recipe</a></li>
  <li><a href="#adding-dependencies" id="toc-adding-dependencies" class="nav-link" data-scroll-target="#adding-dependencies">Adding dependencies</a></li>
  <li><a href="#automatic-variables" id="toc-automatic-variables" class="nav-link" data-scroll-target="#automatic-variables">Automatic variables</a>
  <ul class="collapse">
  <li><a href="#tldr-final-makefile" id="toc-tldr-final-makefile" class="nav-link" data-scroll-target="#tldr-final-makefile">tl;dr final <code>Makefile</code></a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p><a href="https://github.com/andrewheiss/makefile-subdirectory-zips">See this notebook on GitHub</a>. You can (and should) download the project from there if you want to follow along and try this out.</p>
<hr>
<p><a href="#tldr-final-makefile">tl;dr: Skip to the completed example.</a></p>
<hr>
<p>I use <a href="https://bookdown.org/yihui/blogdown"><strong>blogdown</strong></a> to generate the websites for <a href="https://www.andrewheiss.com/teaching/">all the courses I teach</a>, and it’s delightful to not have to worry about databases and server configurations. I use a <a href="https://www.gnu.org/software/make/"><code>Makefile</code></a> to run the requisite commands with <code>make deploy</code>, which creates a magical incantation: R, <a href="https://bookdown.org/yihui/blogdown"><strong>blogdown</strong></a>, and <a href="https://gohugo.io/">Hugo</a> parse <a href="https://rmarkdown.rstudio.com/">R Markdown</a> files and generate a complete HTML site, which then gets synced <a href="https://evalsp20.classes.andrewheiss.com/">to my server</a>, all with minimal input from me.</p>
<p>There are occasional points of friction, though. One that I’ve suffered through for the past few years is the creation and distribution of zipped files. I teach students R, and R projects rarely consist of a single file. To make it easier to distribute problem sets and projects to students, I zip these subfolders into single files like <code>problem_set_1.zip</code>, so they just have to download one thing. Creating <code>.zip</code> files on macOS is trivial—right click on a folder, choose “Compress {foldername}”, and you’re done.</p>
<p>But it’s tedious when you have lots of folders to zip, and even more tedious to remember to rezip folders where you’ve made changes. SO MANY TIMES I’ve fixed errors in R scripts or data but then have forgotten to rezip the project, and students end up downloading the uncorrected version of projects. Moreover, macOS includes hidden <code>.DS_Store</code> files when it zips up folders, and R and RStudio create their own invisible files and folders, like <code>.Rhistory</code> and <code>.Rproj.user/</code>. To avoid shipping these out to students, I typically go to the terminal, manually delete the unwanted invisible files, and <em>then</em> zip up the directory. But once again, I regularly forget to do this and end up including unwanted files.</p>
<p>I figured that since I’m already using a <code>Makefile</code> to generate and upload the course website, I’d try to use the magical power of Make to automatically zip up project folders as I build the site <em>and</em> update them only if there are any changes. And it turns out that it’s possible, though the end result looks really cryptic (as do all <code>Makefiles</code>, really).</p>
<p>What follows here is a step-by-step didactic explanation of how I built a set of <code>Makefile</code> recipes to automatically zip up all the directories within a given directory, excluding invisible files (i.e.&nbsp;any file or directory that begins with a <code>.</code>), and only zipping up directories that have been modified since the last time Make was run. <a href="#tldr-final-makefile">You can also skip to the end to see the finished <code>Makefile</code>.</a></p>
<section id="folder-structure" class="level2">
<h2 class="anchored" data-anchor-id="folder-structure">Folder structure</h2>
<p>The example here assumes the project subdirectories live in a folder called <code>static/projects/</code>, since that mimics <strong>blogdown</strong>/Hugo (any files in the <code>static/</code> directory do not get processed by knitr when you build the site). Here’s the example folder structure with three problem set projects:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">static</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> projects</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> problem_set_1</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── data</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> │&nbsp;&nbsp; └── stuff.csv</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── problem_set_1.Rproj</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> └── work.Rmd</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> problem_set_2</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── data</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> │&nbsp;&nbsp; └── other_stuff.csv</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── problem_set_2.Rproj</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> └── work.Rmd</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> problem_set_3</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> code.R</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> data</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        <span class="ex">│&nbsp;&nbsp;</span> └── more_stuff.csv</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> problem_set_3.Rproj</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> work.Rmd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In the end, what I want is something like this, with <code>.zip</code> files for each of the problem set folders (starred):</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">static</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> projects</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> problem_set_1</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── data</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> │&nbsp;&nbsp; └── stuff.csv</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── problem_set_1.Rproj</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> └── work.Rmd</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> ⭐️ problem_set_1.zip</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> problem_set_2</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── data</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> │&nbsp;&nbsp; └── other_stuff.csv</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── problem_set_2.Rproj</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> └── work.Rmd</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> ⭐️ problem_set_2.zip</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> problem_set_3</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── code.R</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── data</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> │&nbsp;&nbsp; └── more_stuff.csv</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── problem_set_3.Rproj</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> └── work.Rmd</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> ⭐️ problem_set_3.zip</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="basic-approach" class="level2">
<h2 class="anchored" data-anchor-id="basic-approach">Basic approach</h2>
<p>The basic syntax for <code>Makefile</code> recipes is fairly simple:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="dv">file_to_create:</span><span class="dt"> dependencies</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>stuff to run to create file using dependencies</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If I want to create a zipped file of one problem set project, I can add this to a file named <code>Makefile</code> (no extension), and then run <code>make static/projects/problem_set_1.zip</code> from the terminal:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dv">static/projects/problem_set_1.zip:</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>zip -r static/projects/problem_set_1.zip static/projects/problem_set_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>-r</code> flag means that all subdirectories in <code>static/projects/problem_set_1</code> will be included. If I type <code>make static/projects/problem_set_1.zip</code> from the terminal, it should compress the folder and all its subfolders into a single <code>.zip</code> file.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> make <span class="ex">static/projects/problem_set_1.zip</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">zip</span> <span class="at">-r</span> static/projects/problem_set_1.zip static/projects/problem_set_1</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> static/projects/problem_set_1/ <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> static/projects/problem_set_1/work.Rmd <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> static/projects/problem_set_1/.DS_Store <span class="er">(</span><span class="ex">deflated</span> 97%<span class="kw">)</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> static/projects/problem_set_1/problem_set_1.Rproj <span class="er">(</span><span class="ex">deflated</span> 28%<span class="kw">)</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> static/projects/problem_set_1/data/ <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> static/projects/problem_set_1/data/stuff.csv <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="problems-with-the-basic-approach" class="level2">
<h2 class="anchored" data-anchor-id="problems-with-the-basic-approach">Problems with the basic approach</h2>
<p>However, there are a few issues:</p>
<ol type="1">
<li>If I run this again, <code>zip</code> will add files to the <code>.zip</code>. If any were deleted from the actual folder, they’ll stay inside the <code>.zip</code> file (i.e.&nbsp;the folder and the <code>.zip</code> file won’t be synchronized).</li>
<li>This will include files and folders that begin with <code>.</code> (like <code>.Rhistory</code> and <code>.Rproj.user/</code>), and I don’t want those.</li>
<li>The command will include all the parent folders in the zipped file. After I extract it, the actual files will be nested inside <code>static/projects/</code>.</li>
<li>There are no dependencies, so this will happen every time I run <code>make static/projects/problem_set_1.zip</code>, even if nothing changed.</li>
<li>This is for a single target only. In theory, I’d need to manually add separate entries for each folder in <code>static/projects</code>, and that’s tedious.</li>
</ol>
</section>
<section id="tweaking-the-zip-recipe" class="level2">
<h2 class="anchored" data-anchor-id="tweaking-the-zip-recipe">Tweaking the <code>zip</code> recipe</h2>
<p>We can fix the first two issues with some adjustments to the <code>zip</code> command. Adding the <code>-FS</code> flag (<em>f</em>ile <em>s</em>ync) will ensure that <code>zip</code> syncs the files between the source directory and the zipped files, and including the <code>-x</code> flag allows us to exclude patterns of files from the zipped file. Doing this will both sync files and exclude files/folders with a <code>.</code> prefix:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="dv">static/projects/problem_set_1.zip:</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>zip -FSr static/projects/problem_set_1.zip static/projects/problem_set_1 -x static/projects/problem_set_1/.\*</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> make <span class="ex">static/projects/problem_set_1.zip</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">zip</span> <span class="at">-FSr</span> static/projects/problem_set_1.zip static/projects/problem_set_1 <span class="at">-x</span> static/projects/problem_set_1/.\*</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> static/projects/problem_set_1/ <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> static/projects/problem_set_1/work.Rmd <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> static/projects/problem_set_1/problem_set_1.Rproj <span class="er">(</span><span class="ex">deflated</span> 28%<span class="kw">)</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> static/projects/problem_set_1/data/ <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> static/projects/problem_set_1/data/stuff.csv <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The third issue with parent folders can’t be solved directly with <code>zip</code>. The problem occurs because we’re running <code>make</code> from the root of the project, so it’s including the whole nested file structure. To solve this, we can have <code>make</code> navigate to <code>static/projects</code> before zipping anything, which then simplifies the filenames in the command:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="dv">static/projects/problem_set_1.zip:</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>cd static/projects &amp;&amp; zip -FSr problem_set_1.zip problem_set_1 -x problem_set_1/.\*</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> make <span class="ex">static/projects/problem_set_1.zip</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> static/projects <span class="kw">&amp;&amp;</span> <span class="fu">zip</span> <span class="at">-FSr</span> problem_set_1.zip problem_set_1 <span class="at">-x</span> problem_set_1/.\*</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_1/ <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_1/work.Rmd <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_1/problem_set_1.Rproj <span class="er">(</span><span class="ex">deflated</span> 28%<span class="kw">)</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_1/data/ <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_1/data/stuff.csv <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>No more nested parent folders!</p>
</section>
<section id="adding-dependencies" class="level2">
<h2 class="anchored" data-anchor-id="adding-dependencies">Adding dependencies</h2>
<p>Right now, there are no dependencies, which means that <code>make</code> will run <code>zip</code> regardless of whether it needs to. Even if nothing is changed in the <code>problem_set_1</code> folder, a new <code>.zip</code> file will get created (and it’ll get reuploaded to the server because it’ll have a new creation date, which means there will be a lot of unnecessary uploading of potentially large files).</p>
<p>Normally, we’d have to define dependencies like this:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="dv">static/projects/problem_set_1.zip:</span><span class="dt"> {DEPENDENT FILES}</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>cd static/projects &amp;&amp; zip -FSr problem_set_1.zip problem_set_1 -x problem_set_1/.\*</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>There’s no way to use a folder as a dependency, which means we need to list all the possible files in the project:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="dv">static/projects/problem_set_1.zip:</span><span class="dt"> static/projects/problem_set_1/work.Rmd static/projects/problem_set_1/problem_set_1.Rproj static/projects/problem_set_1/data/stuff.csv</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>cd static/projects &amp;&amp; zip -FSr problem_set_1.zip problem_set_1 -x problem_set_1/.\*</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And that’s horrifically long and awful.</p>
<p>Instead of manually typing out all the dependencies, we can use a little <code>bash</code> trick to get a list of all the files in the folder and generate the list of dependencies using <a href="https://www.gnu.org/software/make/manual/html_node/Shell-Function.html"><code>$(shell ...)</code></a>. To see this in action more easily, it’s helpful to assign this shell command to a variable and create a new temporary target to show it</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="dt">FILES_IN_FOLDER</span> <span class="ch">=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> find static/projects/problem_set_1 -type f</span><span class="ch">)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="dv">debug:</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">FILES_IN_FOLDER</span><span class="ch">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now if you run <code>make debug</code>, you should see a list of all the files in the given folder (since that list was stored as <code>FILES_IN_FOLDER</code>; the <code>@</code> in front of <code>echo</code> suppresses the actual call to <code>echo</code>, so you should just see the output of the command).</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> make <span class="ex">debug</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="ex">static/projects/problem_set_1/work.Rmd</span> static/projects/problem_set_1/.DS_Store static/projects/problem_set_1/problem_set_1.Rproj static/projects/problem_set_1/data/stuff.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You might see that it found invisible files like <code>static/projects/problem_set_1/.DS_Store</code>. We don’t want to include those as dependencies (especially files in <code>.Rproj.user</code>, since those get modified every time you do anything in RStudio), so we can modify the <code>find</code> command to exclude files that start with <code>.</code>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="dt">FILES_IN_FOLDER</span> <span class="ch">=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> find static/projects/problem_set_1 -type f ! -path "static/projects/problem_set_1/.*"</span><span class="ch">)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="dv">debug:</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">FILES_IN_FOLDER</span><span class="ch">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> make <span class="ex">debug</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="ex">static/projects/problem_set_1/work.Rmd</span> static/projects/problem_set_1/problem_set_1.Rproj static/projects/problem_set_1/data/stuff.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With that <code>$(shell ...)</code> magic working, we can include it in the recipe as a dependency:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="dv">static/projects/problem_set_1.zip:</span><span class="dt"> </span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> find static/projects/problem_set_1 -type f ! -path "static/projects/problem_set_1/.*"</span><span class="ch">)</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>cd static/projects &amp;&amp; zip -FSr problem_set_1.zip problem_set_1 -x problem_set_1/.\*</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>HOWEVER, this still won’t quite work. Put simply (and likely incorrectly, but it makes sense) <code>make</code> expands <code>$()</code> variables after it determines dependency rules, so it will treat <code>$(shell ...)</code> like an actual dependency instead of treating the <em>output</em> of <code>$(shell ...)</code> as dependencies. To get around this, we can enable <a href="http://www.gnu.org/software/make/manual/make.html#Secondary-Expansion">secondary expansion</a> (<a href="https://stackoverflow.com/a/21950971/120898">see also</a>), which delays the creation of dependency rules until after <code>$(shell ...)</code> is run. To enable it, include <code>.SECONDEXPANSION:</code> somewhere and then use <code>$$()</code> instead of <code>$()</code> when expanding variables:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ot">.SECONDEXPANSION:</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="dv">static/projects/problem_set_1.zip:</span><span class="dt"> </span><span class="ch">$$</span><span class="dt">(shell find static/projects/problem_set_1 -type f ! -path "static/projects/problem_set_1/.*")</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>cd static/projects &amp;&amp; zip -FSr problem_set_1.zip problem_set_1 -x problem_set_1/.\*</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> make <span class="ex">static/projects/problem_set_1.zip</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> static/projects <span class="kw">&amp;&amp;</span> <span class="fu">zip</span> <span class="at">-FSr</span> problem_set_1.zip problem_set_1 <span class="at">-x</span> problem_set_1/.\*</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_1/ <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_1/work.Rmd <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_1/problem_set_1.Rproj <span class="er">(</span><span class="ex">deflated</span> 28%<span class="kw">)</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_1/data/ <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_1/data/stuff.csv <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Phew. Now all the non-invisible files inside <code>problem_set_1/</code> are dependencies. If I run it again without changing anything, nothing should get zipped:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> make <span class="ex">static/projects/problem_set_1.zip</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="ex">make:</span> <span class="kw">`</span><span class="ex">static/projects/problem_set_1.zip</span><span class="st">' is up to date.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="automatic-variables" class="level2">
<h2 class="anchored" data-anchor-id="automatic-variables">Automatic variables</h2>
<p>Everything’s working great so far! We’ve addressed <a href="#problems-with-the-basic-approach">the first 4 of the 5 issues we found before</a>. The only thing we have left is automating this so we don’t have to make another target recipe for <code>static/projects/problem_set_2.zip</code> and <code>static/projects/problem_set_3.zip</code> and so on. In the end, we want to be able to type <code>make zip_projects</code> and have <code>make</code> compress each of the subfolders automatically, based on changes in dependencies. To do this, we can use <a href="http://www.gnu.org/software/make/manual/html_node/Automatic-Variables.html">automatic variables</a> (<a href="https://stackoverflow.com/a/3220288/120898">see also</a>) to generate targets on the fly. Here’s how we do this.</p>
<p>First, we can generate a list of all the subdirectories we want to compress, and then modify that list so that it becomes a list of all the targets we want to create (i.e.&nbsp;<code>problem_set_1.zip</code>, <code>problem_set_2.zip</code>, and so on). We’ll use some built-in <code>make</code> functions for manipulating text and searching for files to create some variables. Again, it’s easiest to see what these variables actually are if you create a temporary target like debug. Check the documentation for <a href="https://www.gnu.org/software/make/manual/html_node/Text-Functions.html"><code>$(filter ...)</code></a>, <a href="https://www.gnu.org/software/make/manual/html_node/File-Name-Functions.html"><code>$(wildcard ...)</code></a>, <a href="https://www.gnu.org/software/make/manual/html_node/Text-Functions.html"><code>$(patsubst ...)</code></a>, and <a href="https://www.gnu.org/software/make/manual/html_node/File-Name-Functions.html"><code>$(addsuffix ...)</code></a> for more details about what these functions do.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="dt">TO_ZIP_DIRS</span> <span class="ch">=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">filter</span><span class="st"> %/</span><span class="kw">,</span><span class="st"> </span><span class="ch">$(</span><span class="kw">wildcard</span><span class="st"> static/projects/*/</span><span class="ch">))</span><span class="st">  </span><span class="co"># Find all directories in static/projects</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="dt">TO_ZIP_NAMES</span> <span class="ch">=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">patsubst</span><span class="st"> %/</span><span class="kw">,</span><span class="st">%</span><span class="kw">,</span><span class="ch">$(</span><span class="dt">TO_ZIP_DIRS</span><span class="ch">))</span><span class="st">  </span><span class="co"># Remove trailing /</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="dt">ZIP_TARGETS</span> <span class="ch">=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">addsuffix</span><span class="st"> .zip</span><span class="kw">,</span><span class="ch">$(</span><span class="dt">TO_ZIP_NAMES</span><span class="ch">))</span><span class="st">  </span><span class="co"># Add .zip</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="dv">debug:</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">TO_ZIP_DIRS</span><span class="ch">)</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">TO_ZIP_NAMES</span><span class="ch">)</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="dt">ZIP_TARGETS</span><span class="ch">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> make <span class="ex">debug</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="ex">static/projects/problem_set_1/</span> static/projects/problem_set_2/ static/projects/problem_set_3/</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="ex">static/projects/problem_set_1</span> static/projects/problem_set_2 static/projects/problem_set_3</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="ex">static/projects/problem_set_1.zip</span> static/projects/problem_set_2.zip static/projects/problem_set_3.zip</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Neat. <code>$(ZIP_TARGETS)</code> now has a list of zipped files that we want to create. We can use that list as an actual target in a recipe. For now, we’ll just use <code>echo</code> so we can see what’s going on with the variable names. Note how I created a new target called <code>zip_projects</code>—this is what we’ll actually run in the terminal. It will look at the list in <code>$(ZIP_TARGETS)</code> and run the appropriate recipe for each one (which for now means it’ll just print the name of the file). Also notice the <code>$@</code>. This represents the name of the target that is passed to the recipe. Run <code>make zip_projects</code> and you should see a list of future filenames:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="dv">$(ZIP_TARGETS):</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">echo </span><span class="ch">$@</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="dv">zip_projects:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">ZIP_TARGETS</span><span class="ch">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> make <span class="ex">zip_projects</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="ex">static/projects/problem_set_1.zip</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="ex">static/projects/problem_set_2.zip</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="ex">static/projects/problem_set_3.zip</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next we need to modify the big hairy <code>cd static/projects &amp;&amp; zip -FSr problem_set_1.zip problem_set_1 -x problem_set_1/.\*</code> command to use the automatic names in <code>$(ZIP_TARGETS)</code>. We have access to the full target name (<code>static/projects/problem_set_1.zip</code>) as the special <code>$@</code> variable. We can use other built-in functions to extract pieces of that string. Specifically, we need these things:</p>
<ul>
<li><code>static/projects</code>, or the level below the base name of the future <code>.zip</code> file</li>
<li><code>problem_set_1.zip</code>, or the parent-directory-less name of the future <code>.zip</code> file</li>
<li><code>problem_set_1</code>, or the parent-directory-less and extension-less name of the future <code>.zip</code> file</li>
</ul>
<p>We can extract each of those with different <a href="https://www.gnu.org/software/make/manual/html_node/File-Name-Functions.html">file name functions</a>:</p>
<ul>
<li><code>$(basename $@)</code> will lead to <code>static/projects/problem_set_1</code>. We can navigate to this folder with <code>cd</code> and then move back a level with <code>..</code> to get <code>static/projects</code></li>
<li><code>$(notdir $@)</code> will lead to <code>problem_set_1.zip</code></li>
<li><code>$(notdir $(basename $@))</code> will lead to <code>problem_set_1</code></li>
</ul>
<p>You can check all these by adding them to the recipe temporarily:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="dv">$(ZIP_TARGETS):</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">echo </span><span class="ch">$@</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="kw">basename</span><span class="st"> </span><span class="ch">$@)</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="kw">notdir</span><span class="st"> </span><span class="ch">$@)</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu">echo </span><span class="ch">$(</span><span class="kw">notdir</span><span class="st"> </span><span class="ch">$(</span><span class="kw">basename</span><span class="st"> </span><span class="ch">$@))</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="dv">zip_projects:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">ZIP_TARGETS</span><span class="ch">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> make <span class="ex">zip_projects</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="ex">static/projects/problem_set_1.zip</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="ex">static/projects/problem_set_1</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="ex">problem_set_1.zip</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="ex">problem_set_1</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="ex">static/projects/problem_set_2.zip</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="ex">static/projects/problem_set_2</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="ex">problem_set_2.zip</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="ex">problem_set_2</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="ex">static/projects/problem_set_3.zip</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="ex">static/projects/problem_set_3</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="ex">problem_set_3.zip</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="ex">problem_set_3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With all those pieces of filenames, we can replace the hardcoded values of our hairy <code>zip</code> command with automatic versions:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="dv">$(ZIP_TARGETS):</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>cd <span class="ch">$(</span><span class="kw">basename</span><span class="st"> </span><span class="ch">$@)</span>/.. &amp;&amp; zip -FSr <span class="ch">$(</span><span class="kw">notdir</span><span class="st"> </span><span class="ch">$@)</span> <span class="ch">$(</span><span class="kw">notdir</span><span class="st"> </span><span class="ch">$(</span><span class="kw">basename</span><span class="st"> </span><span class="ch">$*))</span> -x <span class="ch">$(</span><span class="kw">notdir</span><span class="st"> </span><span class="ch">$(</span><span class="kw">basename</span><span class="st"> </span><span class="ch">$*))</span>/.\*</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> make <span class="ex">zip_projects</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> static/projects/problem_set_1/.. <span class="kw">&amp;&amp;</span> <span class="fu">zip</span> <span class="at">-FSr</span> problem_set_1.zip problem_set_1 <span class="at">-x</span> problem_set_1/.\*</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_1/ <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_1/work.Rmd <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_1/problem_set_1.Rproj <span class="er">(</span><span class="ex">deflated</span> 28%<span class="kw">)</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_1/data/ <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_1/data/stuff.csv <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> static/projects/problem_set_2/.. <span class="kw">&amp;&amp;</span> <span class="fu">zip</span> <span class="at">-FSr</span> problem_set_2.zip problem_set_2 <span class="at">-x</span> problem_set_2/.\*</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_2/ <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_2/work.Rmd <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_2/problem_set_2.Rproj <span class="er">(</span><span class="ex">deflated</span> 28%<span class="kw">)</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_2/data/ <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_2/data/other_stuff.csv <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> static/projects/problem_set_3/.. <span class="kw">&amp;&amp;</span> <span class="fu">zip</span> <span class="at">-FSr</span> problem_set_3.zip problem_set_3 <span class="at">-x</span> problem_set_3/.\*</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_3/ <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_3/work.Rmd <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_3/code.R <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_3/problem_set_3.Rproj <span class="er">(</span><span class="ex">deflated</span> 28%<span class="kw">)</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_3/data/ <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_3/data/more_stuff.csv <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Holy moly! It zipped each individual folder! We’re almost done! The only thing we’re missing is dependencies—right now, if we run this again, it’ll rezip everything again, which we don’t want. We need to add our <code>$$(shell ..)</code> incantation as a dependency, but we need to make it specific to each target: i.e.&nbsp;it needs to generate a list of dependent files for each of the future zip files (only the contents of <code>problem_set_1</code> when making <code>problem_set_1.zip</code>, etc.). To make that work, we can use a <code>%</code> wildcard in the dependency definition:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="dv">$(ZIP_TARGETS):</span><span class="dt"> %.zip : </span><span class="ch">$$</span><span class="dt">(shell find % -type f ! -path "%/.*")</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>cd <span class="ch">$(</span><span class="kw">basename</span><span class="st"> </span><span class="ch">$@)</span>/.. &amp;&amp; zip -FSr <span class="ch">$(</span><span class="kw">notdir</span><span class="st"> </span><span class="ch">$@)</span> <span class="ch">$(</span><span class="kw">notdir</span><span class="st"> </span><span class="ch">$(</span><span class="kw">basename</span><span class="st"> </span><span class="ch">$@))</span> -x <span class="ch">$(</span><span class="kw">notdir</span><span class="st"> </span><span class="ch">$(</span><span class="kw">basename</span><span class="st"> </span><span class="ch">$@))</span>/.\*</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If we manually delete any zipped files and run <code>make zip_projects</code>, it’ll generate them as expected. Where this is magical, though, is if I edit one of the files (like <code>word.Rmd</code> in <code>problem_set_1</code>) and then rerun <code>make zip_projects</code>, it will <em>only</em> rezip that project:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> make <span class="ex">zip_projects</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> static/projects/problem_set_1/.. <span class="kw">&amp;&amp;</span> <span class="fu">zip</span> <span class="at">-FSr</span> problem_set_1.zip problem_set_1 <span class="at">-x</span> problem_set_1/.\*</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="ex">updating:</span> problem_set_1/work.Rmd <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And that’s it! We’re done!</p>
<p>The final recipe is <em>extraordinarily</em> cryptic, but because we built it up slowly, we should know what each of the pieces (<code>$@</code>, <code>%</code>, <code>$(ZIP_TARGETS)</code>, <code>$(basename $@)</code>, etc.) are.</p>
<section id="tldr-final-makefile" class="level3">
<h3 class="anchored" data-anchor-id="tldr-final-makefile">tl;dr final <code>Makefile</code></h3>
<p>Here’s the complete final <code>Makefile</code> without all the intermediate steps:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="dt">TO_ZIP_DIRS</span> <span class="ch">=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">filter</span><span class="st"> %/</span><span class="kw">,</span><span class="st"> </span><span class="ch">$(</span><span class="kw">wildcard</span><span class="st"> static/projects/*/</span><span class="ch">))</span><span class="st">  </span><span class="co"># Find all directories in static/projects</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="dt">TO_ZIP_NAMES</span> <span class="ch">=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">patsubst</span><span class="st"> %/</span><span class="kw">,</span><span class="st">%</span><span class="kw">,</span><span class="ch">$(</span><span class="dt">TO_ZIP_DIRS</span><span class="ch">))</span><span class="st">  </span><span class="co"># Remove trailing /</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="dt">ZIP_TARGETS</span> <span class="ch">=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">addsuffix</span><span class="st"> .zip</span><span class="kw">,</span><span class="ch">$(</span><span class="dt">TO_ZIP_NAMES</span><span class="ch">))</span><span class="st">  </span><span class="co"># Add .zip</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="ot">.SECONDEXPANSION:</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="dv">$(ZIP_TARGETS):</span><span class="dt"> %.zip : </span><span class="ch">$$</span><span class="dt">(shell find % -type f ! -path "%/.*")</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>cd <span class="ch">$(</span><span class="kw">basename</span><span class="st"> </span><span class="ch">$@)</span>/.. &amp;&amp; zip -FSr <span class="ch">$(</span><span class="kw">notdir</span><span class="st"> </span><span class="ch">$@)</span> <span class="ch">$(</span><span class="kw">notdir</span><span class="st"> </span><span class="ch">$(</span><span class="kw">basename</span><span class="st"> </span><span class="ch">$@))</span> -x <span class="ch">$(</span><span class="kw">notdir</span><span class="st"> </span><span class="ch">$(</span><span class="kw">basename</span><span class="st"> </span><span class="ch">$@))</span>/.\*</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="dv">zip_projects:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">ZIP_TARGETS</span><span class="ch">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can incorporate this into any other <code>Makefile</code>, <a href="https://github.com/andrewheiss/evalsp20.classes.andrewheiss.com/blob/master/Makefile">like this one that I use for building a course website</a>. There, the <code>zip_projects</code> target is a dependency of the <code>build</code> target, so I just have to run <code>make build</code> to automatically zip everything up <em>and</em> build the site with <strong>blogdown</strong>.</p>
<p>Perfection. Any subfolder in <code>static/projects/</code> will automatically be zipped up with no input from me. No more accidentally forgetting to zip up things or include invisible files!</p>


<!-- -->

</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{heiss2020,
  author = {Heiss, Andrew},
  title = {Automatically Zip up Subdirectories with {Make}},
  date = {2020-01-10},
  url = {https://www.andrewheiss.com/blog/2020/01/10/makefile-subdirectory-zips/},
  doi = {10.59350/t1hra-4a041},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-heiss2020" class="csl-entry quarto-appendix-citeas" role="listitem">
Heiss, Andrew. 2020. <span>“Automatically Zip up Subdirectories with
Make.”</span> January 10, 2020. <a href="https://doi.org/10.59350/t1hra-4a041">https://doi.org/10.59350/t1hra-4a041</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.andrewheiss\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="andrewheiss/ath-quarto" data-repo-id="R_kgDOIg6EJQ" data-category="Blog comments" data-category-id="DIC_kwDOIg6EJc4CSz92" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark"><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb31" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Automatically zip up subdirectories with Make"</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2020-01-10</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> Use a Makefile to automatically zip up all subdirectories in a given folder &lt;em&gt;while also&lt;/em&gt; accounting for dependencies</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> makefile-subdirectory-zips.png</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="an">tags:</span><span class="co"> </span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co">  - blogdown</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - r</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co">  - rmarkdown</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - markdown</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co">  - make</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="an">doi:</span><span class="co"> 10.59350/t1hra-4a041</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="an">citation:</span><span class="co"> true</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">See this notebook on GitHub</span><span class="co">](https://github.com/andrewheiss/makefile-subdirectory-zips)</span>. You can (and should) download the project from there if you want to follow along and try this out.</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>-----</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">tl;dr: Skip to the completed example.</span><span class="co">](#tldr-final-makefile)</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>-----</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>I use <span class="co">[</span><span class="ot">**blogdown**</span><span class="co">](https://bookdown.org/yihui/blogdown)</span> to generate the websites for <span class="co">[</span><span class="ot">all the courses I teach</span><span class="co">](https://www.andrewheiss.com/teaching/)</span>, and it’s delightful to not have to worry about databases and server configurations. I use a <span class="co">[</span><span class="ot">`Makefile`</span><span class="co">](https://www.gnu.org/software/make/)</span> to run the requisite commands with <span class="in">`make deploy`</span>, which creates a magical incantation: R, <span class="co">[</span><span class="ot">**blogdown**</span><span class="co">](https://bookdown.org/yihui/blogdown)</span>, and <span class="co">[</span><span class="ot">Hugo</span><span class="co">](https://gohugo.io/)</span> parse <span class="co">[</span><span class="ot">R Markdown</span><span class="co">](https://rmarkdown.rstudio.com/)</span> files and generate a complete HTML site, which then gets synced <span class="co">[</span><span class="ot">to my server</span><span class="co">](https://evalsp20.classes.andrewheiss.com/)</span>, all with minimal input from me.</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>There are occasional points of friction, though. One that I’ve suffered through for the past few years is the creation and distribution of zipped files. I teach students R, and R projects rarely consist of a single file. To make it easier to distribute problem sets and projects to students, I zip these subfolders into single files like <span class="in">`problem_set_1.zip`</span>, so they just have to download one thing. Creating <span class="in">`.zip`</span> files on macOS is trivial—right click on a folder, choose “Compress {foldername}”, and you’re done.</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>But it’s tedious when you have lots of folders to zip, and even more tedious to remember to rezip folders where you’ve made changes. SO MANY TIMES I’ve fixed errors in R scripts or data but then have forgotten to rezip the project, and students end up downloading the uncorrected version of projects. Moreover, macOS includes hidden <span class="in">`.DS_Store`</span> files when it zips up folders, and R and RStudio create their own invisible files and folders, like <span class="in">`.Rhistory`</span> and <span class="in">`.Rproj.user/`</span>. To avoid shipping these out to students, I typically go to the terminal, manually delete the unwanted invisible files, and *then* zip up the directory. But once again, I regularly forget to do this and end up including unwanted files.</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>I figured that since I’m already using a <span class="in">`Makefile`</span> to generate and upload the course website, I’d try to use the magical power of Make to automatically zip up project folders as I build the site *and* update them only if there are any changes. And it turns out that it’s possible, though the end result looks really cryptic (as do all <span class="in">`Makefiles`</span>, really).</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>What follows here is a step-by-step didactic explanation of how I built a set of <span class="in">`Makefile`</span> recipes to automatically zip up all the directories within a given directory, excluding invisible files (i.e.&nbsp;any file or directory that begins with a <span class="in">`.`</span>), and only zipping up directories that have been modified since the last time Make was run. <span class="co">[</span><span class="ot">You can also skip to the end to see the finished `Makefile`.</span><span class="co">](#tldr-final-makefile)</span></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a><span class="fu">## Folder structure</span></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>The example here assumes the project subdirectories live in a folder called <span class="in">`static/projects/`</span>, since that mimics **blogdown**/Hugo (any files in the <span class="in">`static/`</span> directory do not get processed by knitr when you build the site). Here’s the example folder structure with three problem set projects:</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a><span class="in">``` sh</span></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a><span class="ex">static</span></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> projects</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> problem_set_1</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── data</span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> │&nbsp;&nbsp; └── stuff.csv</span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── problem_set_1.Rproj</span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> └── work.Rmd</span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> problem_set_2</span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── data</span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> │&nbsp;&nbsp; └── other_stuff.csv</span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── problem_set_2.Rproj</span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> └── work.Rmd</span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> problem_set_3</span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> code.R</span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> data</span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a>        <span class="ex">│&nbsp;&nbsp;</span> └── more_stuff.csv</span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> problem_set_3.Rproj</span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> work.Rmd</span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a>In the end, what I want is something like this, with <span class="in">`.zip`</span> files for each of the problem set folders (starred):</span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a><span class="in">``` sh</span></span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a><span class="ex">static</span></span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> projects</span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> problem_set_1</span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── data</span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> │&nbsp;&nbsp; └── stuff.csv</span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── problem_set_1.Rproj</span>
<span id="cb31-69"><a href="#cb31-69" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> └── work.Rmd</span>
<span id="cb31-70"><a href="#cb31-70" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> ⭐️ problem_set_1.zip</span>
<span id="cb31-71"><a href="#cb31-71" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> problem_set_2</span>
<span id="cb31-72"><a href="#cb31-72" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── data</span>
<span id="cb31-73"><a href="#cb31-73" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> │&nbsp;&nbsp; └── other_stuff.csv</span>
<span id="cb31-74"><a href="#cb31-74" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── problem_set_2.Rproj</span>
<span id="cb31-75"><a href="#cb31-75" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> └── work.Rmd</span>
<span id="cb31-76"><a href="#cb31-76" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> ⭐️ problem_set_2.zip</span>
<span id="cb31-77"><a href="#cb31-77" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> problem_set_3</span>
<span id="cb31-78"><a href="#cb31-78" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── code.R</span>
<span id="cb31-79"><a href="#cb31-79" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── data</span>
<span id="cb31-80"><a href="#cb31-80" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> │&nbsp;&nbsp; └── more_stuff.csv</span>
<span id="cb31-81"><a href="#cb31-81" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> ├── problem_set_3.Rproj</span>
<span id="cb31-82"><a href="#cb31-82" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│&nbsp;&nbsp;</span> └── work.Rmd</span>
<span id="cb31-83"><a href="#cb31-83" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> ⭐️ problem_set_3.zip</span>
<span id="cb31-84"><a href="#cb31-84" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-85"><a href="#cb31-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-86"><a href="#cb31-86" aria-hidden="true" tabindex="-1"></a><span class="fu">## Basic approach</span></span>
<span id="cb31-87"><a href="#cb31-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-88"><a href="#cb31-88" aria-hidden="true" tabindex="-1"></a>The basic syntax for <span class="in">`Makefile`</span> recipes is fairly simple:</span>
<span id="cb31-89"><a href="#cb31-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-90"><a href="#cb31-90" aria-hidden="true" tabindex="-1"></a><span class="in">``` makefile</span></span>
<span id="cb31-91"><a href="#cb31-91" aria-hidden="true" tabindex="-1"></a><span class="in">file_to_create: dependencies</span></span>
<span id="cb31-92"><a href="#cb31-92" aria-hidden="true" tabindex="-1"></a><span class="in">    stuff to run to create file using dependencies</span></span>
<span id="cb31-93"><a href="#cb31-93" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-94"><a href="#cb31-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-95"><a href="#cb31-95" aria-hidden="true" tabindex="-1"></a>If I want to create a zipped file of one problem set project, I can add this to a file named <span class="in">`Makefile`</span> (no extension), and then run <span class="in">`make static/projects/problem_set_1.zip`</span> from the terminal:</span>
<span id="cb31-96"><a href="#cb31-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-97"><a href="#cb31-97" aria-hidden="true" tabindex="-1"></a><span class="in">``` makefile</span></span>
<span id="cb31-98"><a href="#cb31-98" aria-hidden="true" tabindex="-1"></a><span class="in">static/projects/problem_set_1.zip:</span></span>
<span id="cb31-99"><a href="#cb31-99" aria-hidden="true" tabindex="-1"></a><span class="in">    zip -r static/projects/problem_set_1.zip static/projects/problem_set_1</span></span>
<span id="cb31-100"><a href="#cb31-100" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-101"><a href="#cb31-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-102"><a href="#cb31-102" aria-hidden="true" tabindex="-1"></a>The <span class="in">`-r`</span> flag means that all subdirectories in <span class="in">`static/projects/problem_set_1`</span> will be included. If I type <span class="in">`make static/projects/problem_set_1.zip`</span> from the terminal, it should compress the folder and all its subfolders into a single <span class="in">`.zip`</span> file.</span>
<span id="cb31-103"><a href="#cb31-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-104"><a href="#cb31-104" aria-hidden="true" tabindex="-1"></a><span class="in">``` sh</span></span>
<span id="cb31-105"><a href="#cb31-105" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> make <span class="ex">static/projects/problem_set_1.zip</span></span>
<span id="cb31-106"><a href="#cb31-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-107"><a href="#cb31-107" aria-hidden="true" tabindex="-1"></a><span class="fu">zip</span> <span class="at">-r</span> static/projects/problem_set_1.zip static/projects/problem_set_1</span>
<span id="cb31-108"><a href="#cb31-108" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> static/projects/problem_set_1/ <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb31-109"><a href="#cb31-109" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> static/projects/problem_set_1/work.Rmd <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb31-110"><a href="#cb31-110" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> static/projects/problem_set_1/.DS_Store <span class="er">(</span><span class="ex">deflated</span> 97%<span class="kw">)</span></span>
<span id="cb31-111"><a href="#cb31-111" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> static/projects/problem_set_1/problem_set_1.Rproj <span class="er">(</span><span class="ex">deflated</span> 28%<span class="kw">)</span></span>
<span id="cb31-112"><a href="#cb31-112" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> static/projects/problem_set_1/data/ <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb31-113"><a href="#cb31-113" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> static/projects/problem_set_1/data/stuff.csv <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb31-114"><a href="#cb31-114" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-115"><a href="#cb31-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-116"><a href="#cb31-116" aria-hidden="true" tabindex="-1"></a><span class="fu">## Problems with the basic approach</span></span>
<span id="cb31-117"><a href="#cb31-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-118"><a href="#cb31-118" aria-hidden="true" tabindex="-1"></a>However, there are a few issues:</span>
<span id="cb31-119"><a href="#cb31-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-120"><a href="#cb31-120" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>If I run this again, <span class="in">`zip`</span> will add files to the <span class="in">`.zip`</span>. If any were deleted from the actual folder, they’ll stay inside the <span class="in">`.zip`</span> file (i.e.&nbsp;the folder and the <span class="in">`.zip`</span> file won’t be synchronized).</span>
<span id="cb31-121"><a href="#cb31-121" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>This will include files and folders that begin with <span class="in">`.`</span> (like <span class="in">`.Rhistory`</span> and <span class="in">`.Rproj.user/`</span>), and I don’t want those.</span>
<span id="cb31-122"><a href="#cb31-122" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>The command will include all the parent folders in the zipped file. After I extract it, the actual files will be nested inside <span class="in">`static/projects/`</span>.</span>
<span id="cb31-123"><a href="#cb31-123" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>There are no dependencies, so this will happen every time I run <span class="in">`make static/projects/problem_set_1.zip`</span>, even if nothing changed.</span>
<span id="cb31-124"><a href="#cb31-124" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>This is for a single target only. In theory, I’d need to manually add separate entries for each folder in <span class="in">`static/projects`</span>, and that’s tedious.</span>
<span id="cb31-125"><a href="#cb31-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-126"><a href="#cb31-126" aria-hidden="true" tabindex="-1"></a><span class="fu">## Tweaking the `zip` recipe</span></span>
<span id="cb31-127"><a href="#cb31-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-128"><a href="#cb31-128" aria-hidden="true" tabindex="-1"></a>We can fix the first two issues with some adjustments to the <span class="in">`zip`</span> command. Adding the <span class="in">`-FS`</span> flag (*f*ile *s*ync) will ensure that <span class="in">`zip`</span> syncs the files between the source directory and the zipped files, and including the <span class="in">`-x`</span> flag allows us to exclude patterns of files from the zipped file. Doing this will both sync files and exclude files/folders with a <span class="in">`.`</span> prefix:</span>
<span id="cb31-129"><a href="#cb31-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-130"><a href="#cb31-130" aria-hidden="true" tabindex="-1"></a><span class="in">``` makefile</span></span>
<span id="cb31-131"><a href="#cb31-131" aria-hidden="true" tabindex="-1"></a><span class="in">static/projects/problem_set_1.zip:</span></span>
<span id="cb31-132"><a href="#cb31-132" aria-hidden="true" tabindex="-1"></a><span class="in">    zip -FSr static/projects/problem_set_1.zip static/projects/problem_set_1 -x static/projects/problem_set_1/.\*</span></span>
<span id="cb31-133"><a href="#cb31-133" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-134"><a href="#cb31-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-135"><a href="#cb31-135" aria-hidden="true" tabindex="-1"></a><span class="in">``` sh</span></span>
<span id="cb31-136"><a href="#cb31-136" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> make <span class="ex">static/projects/problem_set_1.zip</span></span>
<span id="cb31-137"><a href="#cb31-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-138"><a href="#cb31-138" aria-hidden="true" tabindex="-1"></a><span class="fu">zip</span> <span class="at">-FSr</span> static/projects/problem_set_1.zip static/projects/problem_set_1 <span class="at">-x</span> static/projects/problem_set_1/.\*</span>
<span id="cb31-139"><a href="#cb31-139" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> static/projects/problem_set_1/ <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb31-140"><a href="#cb31-140" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> static/projects/problem_set_1/work.Rmd <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb31-141"><a href="#cb31-141" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> static/projects/problem_set_1/problem_set_1.Rproj <span class="er">(</span><span class="ex">deflated</span> 28%<span class="kw">)</span></span>
<span id="cb31-142"><a href="#cb31-142" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> static/projects/problem_set_1/data/ <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb31-143"><a href="#cb31-143" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> static/projects/problem_set_1/data/stuff.csv <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb31-144"><a href="#cb31-144" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-145"><a href="#cb31-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-146"><a href="#cb31-146" aria-hidden="true" tabindex="-1"></a>The third issue with parent folders can’t be solved directly with <span class="in">`zip`</span>. The problem occurs because we’re running <span class="in">`make`</span> from the root of the project, so it’s including the whole nested file structure. To solve this, we can have <span class="in">`make`</span> navigate to <span class="in">`static/projects`</span> before zipping anything, which then simplifies the filenames in the command:</span>
<span id="cb31-147"><a href="#cb31-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-148"><a href="#cb31-148" aria-hidden="true" tabindex="-1"></a><span class="in">``` makefile</span></span>
<span id="cb31-149"><a href="#cb31-149" aria-hidden="true" tabindex="-1"></a><span class="in">static/projects/problem_set_1.zip:</span></span>
<span id="cb31-150"><a href="#cb31-150" aria-hidden="true" tabindex="-1"></a><span class="in">    cd static/projects &amp;&amp; zip -FSr problem_set_1.zip problem_set_1 -x problem_set_1/.\*</span></span>
<span id="cb31-151"><a href="#cb31-151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-152"><a href="#cb31-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-153"><a href="#cb31-153" aria-hidden="true" tabindex="-1"></a><span class="in">``` sh</span></span>
<span id="cb31-154"><a href="#cb31-154" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> make <span class="ex">static/projects/problem_set_1.zip</span></span>
<span id="cb31-155"><a href="#cb31-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-156"><a href="#cb31-156" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> static/projects <span class="kw">&amp;&amp;</span> <span class="fu">zip</span> <span class="at">-FSr</span> problem_set_1.zip problem_set_1 <span class="at">-x</span> problem_set_1/.\*</span>
<span id="cb31-157"><a href="#cb31-157" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_1/ <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb31-158"><a href="#cb31-158" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_1/work.Rmd <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb31-159"><a href="#cb31-159" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_1/problem_set_1.Rproj <span class="er">(</span><span class="ex">deflated</span> 28%<span class="kw">)</span></span>
<span id="cb31-160"><a href="#cb31-160" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_1/data/ <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb31-161"><a href="#cb31-161" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_1/data/stuff.csv <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb31-162"><a href="#cb31-162" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-163"><a href="#cb31-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-164"><a href="#cb31-164" aria-hidden="true" tabindex="-1"></a>No more nested parent folders<span class="sc">\!</span></span>
<span id="cb31-165"><a href="#cb31-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-166"><a href="#cb31-166" aria-hidden="true" tabindex="-1"></a><span class="fu">## Adding dependencies</span></span>
<span id="cb31-167"><a href="#cb31-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-168"><a href="#cb31-168" aria-hidden="true" tabindex="-1"></a>Right now, there are no dependencies, which means that <span class="in">`make`</span> will run <span class="in">`zip`</span> regardless of whether it needs to. Even if nothing is changed in the <span class="in">`problem_set_1`</span> folder, a new <span class="in">`.zip`</span> file will get created (and it’ll get reuploaded to the server because it’ll have a new creation date, which means there will be a lot of unnecessary uploading of potentially large files).</span>
<span id="cb31-169"><a href="#cb31-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-170"><a href="#cb31-170" aria-hidden="true" tabindex="-1"></a>Normally, we’d have to define dependencies like this:</span>
<span id="cb31-171"><a href="#cb31-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-172"><a href="#cb31-172" aria-hidden="true" tabindex="-1"></a><span class="in">``` makefile</span></span>
<span id="cb31-173"><a href="#cb31-173" aria-hidden="true" tabindex="-1"></a><span class="in">static/projects/problem_set_1.zip: {DEPENDENT FILES}</span></span>
<span id="cb31-174"><a href="#cb31-174" aria-hidden="true" tabindex="-1"></a><span class="in">    cd static/projects &amp;&amp; zip -FSr problem_set_1.zip problem_set_1 -x problem_set_1/.\*</span></span>
<span id="cb31-175"><a href="#cb31-175" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-176"><a href="#cb31-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-177"><a href="#cb31-177" aria-hidden="true" tabindex="-1"></a>There’s no way to use a folder as a dependency, which means we need to list all the possible files in the project:</span>
<span id="cb31-178"><a href="#cb31-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-179"><a href="#cb31-179" aria-hidden="true" tabindex="-1"></a><span class="in">``` makefile</span></span>
<span id="cb31-180"><a href="#cb31-180" aria-hidden="true" tabindex="-1"></a><span class="in">static/projects/problem_set_1.zip: static/projects/problem_set_1/work.Rmd static/projects/problem_set_1/problem_set_1.Rproj static/projects/problem_set_1/data/stuff.csv</span></span>
<span id="cb31-181"><a href="#cb31-181" aria-hidden="true" tabindex="-1"></a><span class="in">    cd static/projects &amp;&amp; zip -FSr problem_set_1.zip problem_set_1 -x problem_set_1/.\*</span></span>
<span id="cb31-182"><a href="#cb31-182" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-183"><a href="#cb31-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-184"><a href="#cb31-184" aria-hidden="true" tabindex="-1"></a>And that’s horrifically long and awful.</span>
<span id="cb31-185"><a href="#cb31-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-186"><a href="#cb31-186" aria-hidden="true" tabindex="-1"></a>Instead of manually typing out all the dependencies, we can use a little <span class="in">`bash`</span> trick to get a list of all the files in the folder and generate the list of dependencies using <span class="co">[</span><span class="ot">`$(shell ...)`</span><span class="co">](https://www.gnu.org/software/make/manual/html_node/Shell-Function.html)</span>. To see this in action more easily, it’s helpful to assign this shell command to a variable and create a new temporary target to show it</span>
<span id="cb31-187"><a href="#cb31-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-188"><a href="#cb31-188" aria-hidden="true" tabindex="-1"></a><span class="in">``` makefile</span></span>
<span id="cb31-189"><a href="#cb31-189" aria-hidden="true" tabindex="-1"></a><span class="in">FILES_IN_FOLDER = $(shell find static/projects/problem_set_1 -type f)</span></span>
<span id="cb31-190"><a href="#cb31-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-191"><a href="#cb31-191" aria-hidden="true" tabindex="-1"></a><span class="in">debug:</span></span>
<span id="cb31-192"><a href="#cb31-192" aria-hidden="true" tabindex="-1"></a><span class="in">    @echo $(FILES_IN_FOLDER)</span></span>
<span id="cb31-193"><a href="#cb31-193" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-194"><a href="#cb31-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-195"><a href="#cb31-195" aria-hidden="true" tabindex="-1"></a>Now if you run <span class="in">`make debug`</span>, you should see a list of all the files in the given folder (since that list was stored as <span class="in">`FILES_IN_FOLDER`</span>; the <span class="in">`@`</span> in front of <span class="in">`echo`</span> suppresses the actual call to <span class="in">`echo`</span>, so you should just see the output of the command).</span>
<span id="cb31-196"><a href="#cb31-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-197"><a href="#cb31-197" aria-hidden="true" tabindex="-1"></a><span class="in">``` sh</span></span>
<span id="cb31-198"><a href="#cb31-198" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> make <span class="ex">debug</span></span>
<span id="cb31-199"><a href="#cb31-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-200"><a href="#cb31-200" aria-hidden="true" tabindex="-1"></a><span class="ex">static/projects/problem_set_1/work.Rmd</span> static/projects/problem_set_1/.DS_Store static/projects/problem_set_1/problem_set_1.Rproj static/projects/problem_set_1/data/stuff.csv</span>
<span id="cb31-201"><a href="#cb31-201" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-202"><a href="#cb31-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-203"><a href="#cb31-203" aria-hidden="true" tabindex="-1"></a>You might see that it found invisible files like <span class="in">`static/projects/problem_set_1/.DS_Store`</span>. We don’t want to include those as dependencies (especially files in <span class="in">`.Rproj.user`</span>, since those get modified every time you do anything in RStudio), so we can modify the <span class="in">`find`</span> command to exclude files that start with <span class="in">`.`</span>:</span>
<span id="cb31-204"><a href="#cb31-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-205"><a href="#cb31-205" aria-hidden="true" tabindex="-1"></a><span class="in">``` makefile</span></span>
<span id="cb31-206"><a href="#cb31-206" aria-hidden="true" tabindex="-1"></a><span class="in">FILES_IN_FOLDER = $(shell find static/projects/problem_set_1 -type f ! -path "static/projects/problem_set_1/.*")</span></span>
<span id="cb31-207"><a href="#cb31-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-208"><a href="#cb31-208" aria-hidden="true" tabindex="-1"></a><span class="in">debug:</span></span>
<span id="cb31-209"><a href="#cb31-209" aria-hidden="true" tabindex="-1"></a><span class="in">    @echo $(FILES_IN_FOLDER)</span></span>
<span id="cb31-210"><a href="#cb31-210" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-211"><a href="#cb31-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-212"><a href="#cb31-212" aria-hidden="true" tabindex="-1"></a><span class="in">``` sh</span></span>
<span id="cb31-213"><a href="#cb31-213" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> make <span class="ex">debug</span></span>
<span id="cb31-214"><a href="#cb31-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-215"><a href="#cb31-215" aria-hidden="true" tabindex="-1"></a><span class="ex">static/projects/problem_set_1/work.Rmd</span> static/projects/problem_set_1/problem_set_1.Rproj static/projects/problem_set_1/data/stuff.csv</span>
<span id="cb31-216"><a href="#cb31-216" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-217"><a href="#cb31-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-218"><a href="#cb31-218" aria-hidden="true" tabindex="-1"></a>With that <span class="in">`$(shell ...)`</span> magic working, we can include it in the recipe as a dependency:</span>
<span id="cb31-219"><a href="#cb31-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-220"><a href="#cb31-220" aria-hidden="true" tabindex="-1"></a><span class="in">``` makefile</span></span>
<span id="cb31-221"><a href="#cb31-221" aria-hidden="true" tabindex="-1"></a><span class="in">static/projects/problem_set_1.zip: $(shell find static/projects/problem_set_1 -type f ! -path "static/projects/problem_set_1/.*")</span></span>
<span id="cb31-222"><a href="#cb31-222" aria-hidden="true" tabindex="-1"></a><span class="in">    cd static/projects &amp;&amp; zip -FSr problem_set_1.zip problem_set_1 -x problem_set_1/.\*</span></span>
<span id="cb31-223"><a href="#cb31-223" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-224"><a href="#cb31-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-225"><a href="#cb31-225" aria-hidden="true" tabindex="-1"></a>HOWEVER, this still won’t quite work. Put simply (and likely incorrectly, but it makes sense) <span class="in">`make`</span> expands <span class="in">`$()`</span> variables after it determines dependency rules, so it will treat <span class="in">`$(shell ...)`</span> like an actual dependency instead of treating the *output* of <span class="in">`$(shell ...)`</span> as dependencies. To get around this, we can enable <span class="co">[</span><span class="ot">secondary expansion</span><span class="co">](http://www.gnu.org/software/make/manual/make.html#Secondary-Expansion)</span> (<span class="co">[</span><span class="ot">see also</span><span class="co">](https://stackoverflow.com/a/21950971/120898)</span>), which delays the creation of dependency rules until after <span class="in">`$(shell ...)`</span> is run. To enable it, include <span class="in">`.SECONDEXPANSION:`</span> somewhere and then use <span class="in">`$$()`</span> instead of <span class="in">`$()`</span> when expanding variables:</span>
<span id="cb31-226"><a href="#cb31-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-227"><a href="#cb31-227" aria-hidden="true" tabindex="-1"></a><span class="in">``` makefile</span></span>
<span id="cb31-228"><a href="#cb31-228" aria-hidden="true" tabindex="-1"></a><span class="in">.SECONDEXPANSION:</span></span>
<span id="cb31-229"><a href="#cb31-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-230"><a href="#cb31-230" aria-hidden="true" tabindex="-1"></a><span class="in">static/projects/problem_set_1.zip: $$(shell find static/projects/problem_set_1 -type f ! -path "static/projects/problem_set_1/.*")</span></span>
<span id="cb31-231"><a href="#cb31-231" aria-hidden="true" tabindex="-1"></a><span class="in">    cd static/projects &amp;&amp; zip -FSr problem_set_1.zip problem_set_1 -x problem_set_1/.\*</span></span>
<span id="cb31-232"><a href="#cb31-232" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-233"><a href="#cb31-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-234"><a href="#cb31-234" aria-hidden="true" tabindex="-1"></a><span class="in">``` sh</span></span>
<span id="cb31-235"><a href="#cb31-235" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> make <span class="ex">static/projects/problem_set_1.zip</span></span>
<span id="cb31-236"><a href="#cb31-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-237"><a href="#cb31-237" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> static/projects <span class="kw">&amp;&amp;</span> <span class="fu">zip</span> <span class="at">-FSr</span> problem_set_1.zip problem_set_1 <span class="at">-x</span> problem_set_1/.\*</span>
<span id="cb31-238"><a href="#cb31-238" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_1/ <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb31-239"><a href="#cb31-239" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_1/work.Rmd <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb31-240"><a href="#cb31-240" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_1/problem_set_1.Rproj <span class="er">(</span><span class="ex">deflated</span> 28%<span class="kw">)</span></span>
<span id="cb31-241"><a href="#cb31-241" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_1/data/ <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb31-242"><a href="#cb31-242" aria-hidden="true" tabindex="-1"></a>  <span class="ex">adding:</span> problem_set_1/data/stuff.csv <span class="er">(</span><span class="ex">stored</span> 0%<span class="kw">)</span></span>
<span id="cb31-243"><a href="#cb31-243" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb31-244"><a href="#cb31-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-245"><a href="#cb31-245" aria-hidden="true" tabindex="-1"></a>Phew. Now all the non-invisible files inside <span class="in">`problem_set_1/`</span> are dependencies. If I run it again without changing anything, nothing should get zipped:</span>
<span id="cb31-246"><a href="#cb31-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-247"><a href="#cb31-247" aria-hidden="true" tabindex="-1"></a><span class="in">``` sh</span></span>
<span id="cb31-248"><a href="#cb31-248" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> make <span class="ex">static/projects/problem_set_1.zip</span></span>
<span id="cb31-249"><a href="#cb31-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-250"><a href="#cb31-250" aria-hidden="true" tabindex="-1"></a><span class="ex">make:</span> <span class="kw">`</span><span class="ex">static/projects/problem_set_1.zip</span><span class="st">' is up to date.</span></span>
<span id="cb31-251"><a href="#cb31-251" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb31-252"><a href="#cb31-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-253"><a href="#cb31-253" aria-hidden="true" tabindex="-1"></a><span class="st">## Automatic variables</span></span>
<span id="cb31-254"><a href="#cb31-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-255"><a href="#cb31-255" aria-hidden="true" tabindex="-1"></a><span class="st">Everything’s working great so far\! We’ve addressed [the first 4 of the 5 issues we found before](#problems-with-the-basic-approach). The only thing we have left is automating this so we don’t have to make another target recipe for `static/projects/problem_set_2.zip` and `static/projects/problem_set_3.zip` and so on. In the end, we want to be able to type `make zip_projects` and have `make` compress each of the subfolders automatically, based on changes in dependencies. To do this, we can use [automatic variables](http://www.gnu.org/software/make/manual/html_node/Automatic-Variables.html) ([see also](https://stackoverflow.com/a/3220288/120898)) to generate targets on the fly. Here’s how we do this.</span></span>
<span id="cb31-256"><a href="#cb31-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-257"><a href="#cb31-257" aria-hidden="true" tabindex="-1"></a><span class="st">First, we can generate a list of all the subdirectories we want to compress, and then modify that list so that it becomes a list of all the targets we want to create (i.e.&nbsp;`problem_set_1.zip`, `problem_set_2.zip`, and so on). We’ll use some built-in `make` functions for manipulating text and searching for files to create some variables. Again, it’s easiest to see what these variables actually are if you create a temporary target like debug. Check the documentation for [`$(filter ...)`](https://www.gnu.org/software/make/manual/html_node/Text-Functions.html), [`$(wildcard ...)`](https://www.gnu.org/software/make/manual/html_node/File-Name-Functions.html), [`$(patsubst ...)`](https://www.gnu.org/software/make/manual/html_node/Text-Functions.html), and [`$(addsuffix ...)`](https://www.gnu.org/software/make/manual/html_node/File-Name-Functions.html) for more details about what these functions do.</span></span>
<span id="cb31-258"><a href="#cb31-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-259"><a href="#cb31-259" aria-hidden="true" tabindex="-1"></a><span class="st">``` makefile</span></span>
<span id="cb31-260"><a href="#cb31-260" aria-hidden="true" tabindex="-1"></a><span class="st">TO_ZIP_DIRS = $(filter %/, $(wildcard static/projects/*/))  # Find all directories in static/projects</span></span>
<span id="cb31-261"><a href="#cb31-261" aria-hidden="true" tabindex="-1"></a><span class="st">TO_ZIP_NAMES = $(patsubst %/,%,$(TO_ZIP_DIRS))  # Remove trailing /</span></span>
<span id="cb31-262"><a href="#cb31-262" aria-hidden="true" tabindex="-1"></a><span class="st">ZIP_TARGETS = $(addsuffix .zip,$(TO_ZIP_NAMES))  # Add .zip</span></span>
<span id="cb31-263"><a href="#cb31-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-264"><a href="#cb31-264" aria-hidden="true" tabindex="-1"></a><span class="st">debug:</span></span>
<span id="cb31-265"><a href="#cb31-265" aria-hidden="true" tabindex="-1"></a><span class="st">    @echo $(TO_ZIP_DIRS)</span></span>
<span id="cb31-266"><a href="#cb31-266" aria-hidden="true" tabindex="-1"></a><span class="st">    @echo $(TO_ZIP_NAMES)</span></span>
<span id="cb31-267"><a href="#cb31-267" aria-hidden="true" tabindex="-1"></a><span class="st">    @echo $(ZIP_TARGETS)</span></span>
<span id="cb31-268"><a href="#cb31-268" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb31-269"><a href="#cb31-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-270"><a href="#cb31-270" aria-hidden="true" tabindex="-1"></a><span class="st">``` sh</span></span>
<span id="cb31-271"><a href="#cb31-271" aria-hidden="true" tabindex="-1"></a><span class="st">&gt; make debug</span></span>
<span id="cb31-272"><a href="#cb31-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-273"><a href="#cb31-273" aria-hidden="true" tabindex="-1"></a><span class="st">static/projects/problem_set_1/ static/projects/problem_set_2/ static/projects/problem_set_3/</span></span>
<span id="cb31-274"><a href="#cb31-274" aria-hidden="true" tabindex="-1"></a><span class="st">static/projects/problem_set_1 static/projects/problem_set_2 static/projects/problem_set_3</span></span>
<span id="cb31-275"><a href="#cb31-275" aria-hidden="true" tabindex="-1"></a><span class="st">static/projects/problem_set_1.zip static/projects/problem_set_2.zip static/projects/problem_set_3.zip</span></span>
<span id="cb31-276"><a href="#cb31-276" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb31-277"><a href="#cb31-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-278"><a href="#cb31-278" aria-hidden="true" tabindex="-1"></a><span class="st">Neat. `$(ZIP_TARGETS)` now has a list of zipped files that we want to create. We can use that list as an actual target in a recipe. For now, we’ll just use `echo` so we can see what’s going on with the variable names. Note how I created a new target called `zip_projects`—this is what we’ll actually run in the terminal. It will look at the list in `$(ZIP_TARGETS)` and run the appropriate recipe for each one (which for now means it’ll just print the name of the file). Also notice the `$@`. This represents the name of the target that is passed to the recipe. Run `make zip_projects` and you should see a list of future filenames:</span></span>
<span id="cb31-279"><a href="#cb31-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-280"><a href="#cb31-280" aria-hidden="true" tabindex="-1"></a><span class="st">``` makefile</span></span>
<span id="cb31-281"><a href="#cb31-281" aria-hidden="true" tabindex="-1"></a><span class="st">$(ZIP_TARGETS):</span></span>
<span id="cb31-282"><a href="#cb31-282" aria-hidden="true" tabindex="-1"></a><span class="st">    @echo $@</span></span>
<span id="cb31-283"><a href="#cb31-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-284"><a href="#cb31-284" aria-hidden="true" tabindex="-1"></a><span class="st">zip_projects: $(ZIP_TARGETS)</span></span>
<span id="cb31-285"><a href="#cb31-285" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb31-286"><a href="#cb31-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-287"><a href="#cb31-287" aria-hidden="true" tabindex="-1"></a><span class="st">``` sh</span></span>
<span id="cb31-288"><a href="#cb31-288" aria-hidden="true" tabindex="-1"></a><span class="st">&gt; make zip_projects</span></span>
<span id="cb31-289"><a href="#cb31-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-290"><a href="#cb31-290" aria-hidden="true" tabindex="-1"></a><span class="st">static/projects/problem_set_1.zip</span></span>
<span id="cb31-291"><a href="#cb31-291" aria-hidden="true" tabindex="-1"></a><span class="st">static/projects/problem_set_2.zip</span></span>
<span id="cb31-292"><a href="#cb31-292" aria-hidden="true" tabindex="-1"></a><span class="st">static/projects/problem_set_3.zip</span></span>
<span id="cb31-293"><a href="#cb31-293" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb31-294"><a href="#cb31-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-295"><a href="#cb31-295" aria-hidden="true" tabindex="-1"></a><span class="st">Next we need to modify the big hairy `cd static/projects &amp;&amp; zip -FSr problem_set_1.zip problem_set_1 -x problem_set_1/.\*` command to use the automatic names in `$(ZIP_TARGETS)`. We have access to the full target name (`static/projects/problem_set_1.zip`) as the special `$@` variable. We can use other built-in functions to extract pieces of that string. Specifically, we need these things:</span></span>
<span id="cb31-296"><a href="#cb31-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-297"><a href="#cb31-297" aria-hidden="true" tabindex="-1"></a><span class="st">  - `static/projects`, or the level below the base name of the future `.zip` file</span></span>
<span id="cb31-298"><a href="#cb31-298" aria-hidden="true" tabindex="-1"></a><span class="st">  - `problem_set_1.zip`, or the parent-directory-less name of the future `.zip` file</span></span>
<span id="cb31-299"><a href="#cb31-299" aria-hidden="true" tabindex="-1"></a><span class="st">  - `problem_set_1`, or the parent-directory-less and extension-less name of the future `.zip` file</span></span>
<span id="cb31-300"><a href="#cb31-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-301"><a href="#cb31-301" aria-hidden="true" tabindex="-1"></a><span class="st">We can extract each of those with different [file name functions](https://www.gnu.org/software/make/manual/html_node/File-Name-Functions.html):</span></span>
<span id="cb31-302"><a href="#cb31-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-303"><a href="#cb31-303" aria-hidden="true" tabindex="-1"></a><span class="st">  - `$(basename $@)` will lead to `static/projects/problem_set_1`. We can navigate to this folder with `cd` and then move back a level with `..` to get `static/projects`</span></span>
<span id="cb31-304"><a href="#cb31-304" aria-hidden="true" tabindex="-1"></a><span class="st">  - `$(notdir $@)` will lead to `problem_set_1.zip`</span></span>
<span id="cb31-305"><a href="#cb31-305" aria-hidden="true" tabindex="-1"></a><span class="st">  - `$(notdir $(basename $@))` will lead to `problem_set_1`</span></span>
<span id="cb31-306"><a href="#cb31-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-307"><a href="#cb31-307" aria-hidden="true" tabindex="-1"></a><span class="st">You can check all these by adding them to the recipe temporarily:</span></span>
<span id="cb31-308"><a href="#cb31-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-309"><a href="#cb31-309" aria-hidden="true" tabindex="-1"></a><span class="st">``` makefile</span></span>
<span id="cb31-310"><a href="#cb31-310" aria-hidden="true" tabindex="-1"></a><span class="st">$(ZIP_TARGETS):</span></span>
<span id="cb31-311"><a href="#cb31-311" aria-hidden="true" tabindex="-1"></a><span class="st">    @echo $@</span></span>
<span id="cb31-312"><a href="#cb31-312" aria-hidden="true" tabindex="-1"></a><span class="st">    @echo $(basename $@)</span></span>
<span id="cb31-313"><a href="#cb31-313" aria-hidden="true" tabindex="-1"></a><span class="st">    @echo $(notdir $@)</span></span>
<span id="cb31-314"><a href="#cb31-314" aria-hidden="true" tabindex="-1"></a><span class="st">    @echo $(notdir $(basename $@))</span></span>
<span id="cb31-315"><a href="#cb31-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-316"><a href="#cb31-316" aria-hidden="true" tabindex="-1"></a><span class="st">zip_projects: $(ZIP_TARGETS)</span></span>
<span id="cb31-317"><a href="#cb31-317" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb31-318"><a href="#cb31-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-319"><a href="#cb31-319" aria-hidden="true" tabindex="-1"></a><span class="st">``` sh</span></span>
<span id="cb31-320"><a href="#cb31-320" aria-hidden="true" tabindex="-1"></a><span class="st">&gt; make zip_projects</span></span>
<span id="cb31-321"><a href="#cb31-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-322"><a href="#cb31-322" aria-hidden="true" tabindex="-1"></a><span class="st">static/projects/problem_set_1.zip</span></span>
<span id="cb31-323"><a href="#cb31-323" aria-hidden="true" tabindex="-1"></a><span class="st">static/projects/problem_set_1</span></span>
<span id="cb31-324"><a href="#cb31-324" aria-hidden="true" tabindex="-1"></a><span class="st">problem_set_1.zip</span></span>
<span id="cb31-325"><a href="#cb31-325" aria-hidden="true" tabindex="-1"></a><span class="st">problem_set_1</span></span>
<span id="cb31-326"><a href="#cb31-326" aria-hidden="true" tabindex="-1"></a><span class="st">static/projects/problem_set_2.zip</span></span>
<span id="cb31-327"><a href="#cb31-327" aria-hidden="true" tabindex="-1"></a><span class="st">static/projects/problem_set_2</span></span>
<span id="cb31-328"><a href="#cb31-328" aria-hidden="true" tabindex="-1"></a><span class="st">problem_set_2.zip</span></span>
<span id="cb31-329"><a href="#cb31-329" aria-hidden="true" tabindex="-1"></a><span class="st">problem_set_2</span></span>
<span id="cb31-330"><a href="#cb31-330" aria-hidden="true" tabindex="-1"></a><span class="st">static/projects/problem_set_3.zip</span></span>
<span id="cb31-331"><a href="#cb31-331" aria-hidden="true" tabindex="-1"></a><span class="st">static/projects/problem_set_3</span></span>
<span id="cb31-332"><a href="#cb31-332" aria-hidden="true" tabindex="-1"></a><span class="st">problem_set_3.zip</span></span>
<span id="cb31-333"><a href="#cb31-333" aria-hidden="true" tabindex="-1"></a><span class="st">problem_set_3</span></span>
<span id="cb31-334"><a href="#cb31-334" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb31-335"><a href="#cb31-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-336"><a href="#cb31-336" aria-hidden="true" tabindex="-1"></a><span class="st">With all those pieces of filenames, we can replace the hardcoded values of our hairy `zip` command with automatic versions:</span></span>
<span id="cb31-337"><a href="#cb31-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-338"><a href="#cb31-338" aria-hidden="true" tabindex="-1"></a><span class="st">``` makefile</span></span>
<span id="cb31-339"><a href="#cb31-339" aria-hidden="true" tabindex="-1"></a><span class="st">$(ZIP_TARGETS):</span></span>
<span id="cb31-340"><a href="#cb31-340" aria-hidden="true" tabindex="-1"></a><span class="st">    cd $(basename $@)/.. &amp;&amp; zip -FSr $(notdir $@) $(notdir $(basename $*)) -x $(notdir $(basename $*))/.\*</span></span>
<span id="cb31-341"><a href="#cb31-341" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb31-342"><a href="#cb31-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-343"><a href="#cb31-343" aria-hidden="true" tabindex="-1"></a><span class="st">``` sh</span></span>
<span id="cb31-344"><a href="#cb31-344" aria-hidden="true" tabindex="-1"></a><span class="st">&gt; make zip_projects</span></span>
<span id="cb31-345"><a href="#cb31-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-346"><a href="#cb31-346" aria-hidden="true" tabindex="-1"></a><span class="st">cd static/projects/problem_set_1/.. &amp;&amp; zip -FSr problem_set_1.zip problem_set_1 -x problem_set_1/.\*</span></span>
<span id="cb31-347"><a href="#cb31-347" aria-hidden="true" tabindex="-1"></a><span class="st">  adding: problem_set_1/ (stored 0%)</span></span>
<span id="cb31-348"><a href="#cb31-348" aria-hidden="true" tabindex="-1"></a><span class="st">  adding: problem_set_1/work.Rmd (stored 0%)</span></span>
<span id="cb31-349"><a href="#cb31-349" aria-hidden="true" tabindex="-1"></a><span class="st">  adding: problem_set_1/problem_set_1.Rproj (deflated 28%)</span></span>
<span id="cb31-350"><a href="#cb31-350" aria-hidden="true" tabindex="-1"></a><span class="st">  adding: problem_set_1/data/ (stored 0%)</span></span>
<span id="cb31-351"><a href="#cb31-351" aria-hidden="true" tabindex="-1"></a><span class="st">  adding: problem_set_1/data/stuff.csv (stored 0%)</span></span>
<span id="cb31-352"><a href="#cb31-352" aria-hidden="true" tabindex="-1"></a><span class="st">cd static/projects/problem_set_2/.. &amp;&amp; zip -FSr problem_set_2.zip problem_set_2 -x problem_set_2/.\*</span></span>
<span id="cb31-353"><a href="#cb31-353" aria-hidden="true" tabindex="-1"></a><span class="st">  adding: problem_set_2/ (stored 0%)</span></span>
<span id="cb31-354"><a href="#cb31-354" aria-hidden="true" tabindex="-1"></a><span class="st">  adding: problem_set_2/work.Rmd (stored 0%)</span></span>
<span id="cb31-355"><a href="#cb31-355" aria-hidden="true" tabindex="-1"></a><span class="st">  adding: problem_set_2/problem_set_2.Rproj (deflated 28%)</span></span>
<span id="cb31-356"><a href="#cb31-356" aria-hidden="true" tabindex="-1"></a><span class="st">  adding: problem_set_2/data/ (stored 0%)</span></span>
<span id="cb31-357"><a href="#cb31-357" aria-hidden="true" tabindex="-1"></a><span class="st">  adding: problem_set_2/data/other_stuff.csv (stored 0%)</span></span>
<span id="cb31-358"><a href="#cb31-358" aria-hidden="true" tabindex="-1"></a><span class="st">cd static/projects/problem_set_3/.. &amp;&amp; zip -FSr problem_set_3.zip problem_set_3 -x problem_set_3/.\*</span></span>
<span id="cb31-359"><a href="#cb31-359" aria-hidden="true" tabindex="-1"></a><span class="st">  adding: problem_set_3/ (stored 0%)</span></span>
<span id="cb31-360"><a href="#cb31-360" aria-hidden="true" tabindex="-1"></a><span class="st">  adding: problem_set_3/work.Rmd (stored 0%)</span></span>
<span id="cb31-361"><a href="#cb31-361" aria-hidden="true" tabindex="-1"></a><span class="st">  adding: problem_set_3/code.R (stored 0%)</span></span>
<span id="cb31-362"><a href="#cb31-362" aria-hidden="true" tabindex="-1"></a><span class="st">  adding: problem_set_3/problem_set_3.Rproj (deflated 28%)</span></span>
<span id="cb31-363"><a href="#cb31-363" aria-hidden="true" tabindex="-1"></a><span class="st">  adding: problem_set_3/data/ (stored 0%)</span></span>
<span id="cb31-364"><a href="#cb31-364" aria-hidden="true" tabindex="-1"></a><span class="st">  adding: problem_set_3/data/more_stuff.csv (stored 0%)</span></span>
<span id="cb31-365"><a href="#cb31-365" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb31-366"><a href="#cb31-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-367"><a href="#cb31-367" aria-hidden="true" tabindex="-1"></a><span class="st">Holy moly\! It zipped each individual folder\! We’re almost done\! The only thing we’re missing is dependencies—right now, if we run this again, it’ll rezip everything again, which we don’t want. We need to add our `$$(shell ..)` incantation as a dependency, but we need to make it specific to each target: i.e.&nbsp;it needs to generate a list of dependent files for each of the future zip files (only the contents of `problem_set_1` when making `problem_set_1.zip`, etc.). To make that work, we can use a `%` wildcard in the dependency definition:</span></span>
<span id="cb31-368"><a href="#cb31-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-369"><a href="#cb31-369" aria-hidden="true" tabindex="-1"></a><span class="st">``` makefile</span></span>
<span id="cb31-370"><a href="#cb31-370" aria-hidden="true" tabindex="-1"></a><span class="st">$(ZIP_TARGETS): %.zip : $$(shell find % -type f ! -path "%/.*")</span></span>
<span id="cb31-371"><a href="#cb31-371" aria-hidden="true" tabindex="-1"></a><span class="st">    cd $(basename $@)/.. &amp;&amp; zip -FSr $(notdir $@) $(notdir $(basename $@)) -x $(notdir $(basename $@))/.\*</span></span>
<span id="cb31-372"><a href="#cb31-372" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb31-373"><a href="#cb31-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-374"><a href="#cb31-374" aria-hidden="true" tabindex="-1"></a><span class="st">If we manually delete any zipped files and run `make zip_projects`, it’ll generate them as expected. Where this is magical, though, is if I edit one of the files (like `word.Rmd` in `problem_set_1`) and then rerun `make zip_projects`, it will *only* rezip that project:</span></span>
<span id="cb31-375"><a href="#cb31-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-376"><a href="#cb31-376" aria-hidden="true" tabindex="-1"></a><span class="st">``` sh</span></span>
<span id="cb31-377"><a href="#cb31-377" aria-hidden="true" tabindex="-1"></a><span class="st">&gt; make zip_projects</span></span>
<span id="cb31-378"><a href="#cb31-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-379"><a href="#cb31-379" aria-hidden="true" tabindex="-1"></a><span class="st">cd static/projects/problem_set_1/.. &amp;&amp; zip -FSr problem_set_1.zip problem_set_1 -x problem_set_1/.\*</span></span>
<span id="cb31-380"><a href="#cb31-380" aria-hidden="true" tabindex="-1"></a><span class="st">updating: problem_set_1/work.Rmd (stored 0%)</span></span>
<span id="cb31-381"><a href="#cb31-381" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb31-382"><a href="#cb31-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-383"><a href="#cb31-383" aria-hidden="true" tabindex="-1"></a><span class="st">And that’s it\! We’re done\!</span></span>
<span id="cb31-384"><a href="#cb31-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-385"><a href="#cb31-385" aria-hidden="true" tabindex="-1"></a><span class="st">The final recipe is *extraordinarily* cryptic, but because we built it up slowly, we should know what each of the pieces (`$@`, `%`, `$(ZIP_TARGETS)`, `$(basename $@)`, etc.) are.</span></span>
<span id="cb31-386"><a href="#cb31-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-387"><a href="#cb31-387" aria-hidden="true" tabindex="-1"></a><span class="st">### tl;dr final `Makefile`</span></span>
<span id="cb31-388"><a href="#cb31-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-389"><a href="#cb31-389" aria-hidden="true" tabindex="-1"></a><span class="st">Here’s the complete final `Makefile` without all the intermediate steps:</span></span>
<span id="cb31-390"><a href="#cb31-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-391"><a href="#cb31-391" aria-hidden="true" tabindex="-1"></a><span class="st">``` makefile</span></span>
<span id="cb31-392"><a href="#cb31-392" aria-hidden="true" tabindex="-1"></a><span class="st">TO_ZIP_DIRS = $(filter %/, $(wildcard static/projects/*/))  # Find all directories in static/projects</span></span>
<span id="cb31-393"><a href="#cb31-393" aria-hidden="true" tabindex="-1"></a><span class="st">TO_ZIP_NAMES = $(patsubst %/,%,$(TO_ZIP_DIRS))  # Remove trailing /</span></span>
<span id="cb31-394"><a href="#cb31-394" aria-hidden="true" tabindex="-1"></a><span class="st">ZIP_TARGETS = $(addsuffix .zip,$(TO_ZIP_NAMES))  # Add .zip</span></span>
<span id="cb31-395"><a href="#cb31-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-396"><a href="#cb31-396" aria-hidden="true" tabindex="-1"></a><span class="st">.SECONDEXPANSION:</span></span>
<span id="cb31-397"><a href="#cb31-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-398"><a href="#cb31-398" aria-hidden="true" tabindex="-1"></a><span class="st">$(ZIP_TARGETS): %.zip : $$(shell find % -type f ! -path "%/.*")</span></span>
<span id="cb31-399"><a href="#cb31-399" aria-hidden="true" tabindex="-1"></a><span class="st">    cd $(basename $@)/.. &amp;&amp; zip -FSr $(notdir $@) $(notdir $(basename $@)) -x $(notdir $(basename $@))/.\*</span></span>
<span id="cb31-400"><a href="#cb31-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-401"><a href="#cb31-401" aria-hidden="true" tabindex="-1"></a><span class="st">zip_projects: $(ZIP_TARGETS)</span></span>
<span id="cb31-402"><a href="#cb31-402" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb31-403"><a href="#cb31-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-404"><a href="#cb31-404" aria-hidden="true" tabindex="-1"></a><span class="st">You can incorporate this into any other `Makefile`, [like this one that I use for building a course website](https://github.com/andrewheiss/evalsp20.classes.andrewheiss.com/blob/master/Makefile). There, the `zip_projects` target is a dependency of the `build` target, so I just have to run `make build` to automatically zip everything up *and* build the site with **blogdown**.</span></span>
<span id="cb31-405"><a href="#cb31-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-406"><a href="#cb31-406" aria-hidden="true" tabindex="-1"></a><span class="st">Perfection. Any subfolder in `static/projects/` will automatically be zipped up with no input from me. No more accidentally forgetting to zip up things or include invisible files\!</span></span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><span class="faux-block"><i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> 2007–2024 Andrew Heiss</span> <span class="faux-block">All content licensed under<br><a href="https://creativecommons.org/licenses/by/4.0/"><i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> <i class="fa-brands fa-creative-commons-by" aria-label="creative-commons-by"></i> Creative Commons CC BY 4.0</a></span></p>
</div>   
    <div class="nav-footer-center">
<p><span class="faux-block"><i class="fa-brands fa-orcid" aria-label="orcid"></i> <strong>ORCID</strong> <a href="https://orcid.org/0000-0002-3948-3914">0000-0002-3948-3914</a></span> <span class="faux-block"><i class="fa-solid fa-key" aria-label="key"></i> <a href="../../../../../pgp_ath.asc.txt">PGP public key</a>   <i class="fa-solid fa-fingerprint" aria-label="fingerprint"></i> Fingerprint:<br><span class="fingerprint">4AA2 FA83 A8B2 05A4 E30F<br> 610D 1382 6216 9178 36AB</span></span></p>
</div>
    <div class="nav-footer-right">
<p><span class="faux-block">Made with <i class="fa-brands fa-r-project" aria-label="r-project"></i> and <a href="https://quarto.org/">Quarto</a></span> <span class="faux-block"><a href="https://github.com/andrewheiss/ath-quarto">View the source at <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></span></p>
</div>
  </div>
</footer>




</body></html>