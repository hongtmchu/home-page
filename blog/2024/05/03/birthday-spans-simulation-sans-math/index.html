<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Hong T.M. Chu">
<meta name="description" content="Probability math is hard. Use brute force simulation to find the probability that a household has a cluster of birthdays.">
<title>Calculating birthday probabilities with R instead of math | Hong T.M. Chu – Hong T.M. Chu</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../../">
<link href="../../../../..//files/favicon-512.png" rel="icon" type="image/png">
<script src="../../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting-17c909d5fd25ae21b861c0c7a49b2096.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../site_libs/bootstrap/bootstrap-5cd0811f461c8271ae6bab49df9501be.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script src="../../../../../site_libs/quarto-contrib/iconify-2.0.0/iconify-icon.min.js"></script><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-527449-5', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script><style>

      .quarto-title-block .quarto-title-banner {
        background: #170C3A;
      }
</style>
<style type="text/css">
hr.dinkus {
    width: 50px;
    margin: 2em auto 2em;
    border-top: 5px dotted #454545;
}

div.column-margin+hr.dinkus {
    margin: 1em auto 2em;
}
</style>
<script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
<meta property="og:title" content="Calculating birthday probabilities with R instead of math | Hong T.M. Chu">
<meta property="og:description" content="Probability math is hard. Use brute force simulation to find the probability that a household has a cluster of birthdays.">
<meta property="og:image" content="https://www.andrewheiss.com/blog/2024/05/03/birthday-spans-simulation-sans-math/index_files/figure-html/plot-heiss-birthday-cycle-1.png">
<meta property="og:site_name" content="Hong T.M. Chu">
<meta property="og:locale" content="en_US">
<meta property="og:image:height" content="1440">
<meta property="og:image:width" content="1440">
<meta name="twitter:title" content="Calculating birthday probabilities with R instead of math | Hong T.M. Chu">
<meta name="twitter:description" content="Probability math is hard. Use brute force simulation to find the probability that a household has a cluster of birthdays.">
<meta name="twitter:image" content="https://www.andrewheiss.com/blog/2024/05/03/birthday-spans-simulation-sans-math/index_files/figure-html/plot-heiss-birthday-cycle-1.png">
<meta name="twitter:creator" content="@andrewheiss">
<meta name="twitter:site" content="@andrewheiss">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image-height" content="1440">
<meta name="twitter:image-width" content="1440">
</head>
<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../../index.html">
    <span class="navbar-title">Hong T.M. Chu</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../../../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../cv/index.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../research/index.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../teaching/index.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="mailto:hong.ctm@vinuni.edu.vn"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:envelope" style="font-size: 1.1em;" aria-label="Icon envelope from bi Iconify.design set." title="E-mail"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/andrewheiss" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:github" style="font-size: 1.1em;" aria-label="Icon github from bi Iconify.design set." title="GitHub"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/hongtmchu" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:linkedin" style="font-size: 1.1em;" aria-label="Icon linkedin from bi Iconify.design set." title="LinkedIn"></iconify-icon></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default blog-post page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Calculating birthday probabilities with R instead of math</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
                  <div>
        <div class="description">
          Probability math is hard. Use brute force simulation to find the probability that a household has a cluster of birthdays.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">r</div>
                <div class="quarto-category">tidyverse</div>
                <div class="quarto-category">simulations</div>
                <div class="quarto-category">probability</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://www.andrewheiss.com/">Andrew Heiss</a> <a href="https://orcid.org/0000-0002-3948-3914" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">Friday, May 3, 2024</p>
      </div>
    </div>
    
      
      <div>
      <div class="quarto-title-meta-heading">Doi</div>
      <div class="quarto-title-meta-contents">
        <p class="doi">
          <a href="https://doi.org/10.59350/r419r-zqj73">10.59350/r419r-zqj73</a>
        </p>
      </div>
    </div>
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Contents</h2>
   
  <ul>
<li>
<a href="#why-simulate" id="toc-why-simulate" class="nav-link active" data-scroll-target="#why-simulate">Why simulate?</a>
  <ul class="collapse">
<li><a href="#ew-probability-math" id="toc-ew-probability-math" class="nav-link" data-scroll-target="#ew-probability-math">ew probability math</a></li>
  <li><a href="#yay-brute-force-simulation" id="toc-yay-brute-force-simulation" class="nav-link" data-scroll-target="#yay-brute-force-simulation">yay brute force simulation</a></li>
  </ul>
</li>
  <li><a href="#birthday-probabilities" id="toc-birthday-probabilities" class="nav-link" data-scroll-target="#birthday-probabilities">Birthday probabilities</a></li>
  <li>
<a href="#visualizing-birthday-distributions-and-spans" id="toc-visualizing-birthday-distributions-and-spans" class="nav-link" data-scroll-target="#visualizing-birthday-distributions-and-spans">Visualizing birthday distributions and spans</a>
  <ul class="collapse">
<li><a href="#all-birthdays-within-6-month-span" id="toc-all-birthdays-within-6-month-span" class="nav-link" data-scroll-target="#all-birthdays-within-6-month-span">All birthdays within 6-month span</a></li>
  <li><a href="#all-birthdays-within-6-month-span-but-tricky" id="toc-all-birthdays-within-6-month-span-but-tricky" class="nav-link" data-scroll-target="#all-birthdays-within-6-month-span-but-tricky">All birthdays within 6-month span, but tricky</a></li>
  <li><a href="#some-birthdays-outside-a-6-month-span" id="toc-some-birthdays-outside-a-6-month-span" class="nav-link" data-scroll-target="#some-birthdays-outside-a-6-month-span">Some birthdays outside a 6-month span</a></li>
  </ul>
</li>
  <li>
<a href="#simulation-time" id="toc-simulation-time" class="nav-link" data-scroll-target="#simulation-time">Simulation time!</a>
  <ul class="collapse">
<li><a href="#counting-simulated-birthdays-and-measuring-spans" id="toc-counting-simulated-birthdays-and-measuring-spans" class="nav-link" data-scroll-target="#counting-simulated-birthdays-and-measuring-spans">Counting simulated birthdays and measuring spans</a></li>
  <li><a href="#actual-simulation" id="toc-actual-simulation" class="nav-link" data-scroll-target="#actual-simulation">Actual simulation</a></li>
  </ul>
</li>
  <li>
<a href="#but-birthdays-arent-uniformly-distributed" id="toc-but-birthdays-arent-uniformly-distributed" class="nav-link" data-scroll-target="#but-birthdays-arent-uniformly-distributed">But birthdays aren’t uniformly distributed!</a>
  <ul class="collapse">
<li><a href="#uneven-birthday-disributions" id="toc-uneven-birthday-disributions" class="nav-link" data-scroll-target="#uneven-birthday-disributions">Uneven birthday disributions</a></li>
  <li><a href="#using-actual-birthday-probabilities" id="toc-using-actual-birthday-probabilities" class="nav-link" data-scroll-target="#using-actual-birthday-probabilities">Using actual birthday probabilities</a></li>
  </ul>
</li>
  </ul></nav>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content"><p>Even though I’ve been teaching R and statistical programming since 2017, and despite the fact that I do all sorts of heavily quantitative research, <em>I’m really really bad at probability math</em>.</p>
<p>Like super bad.</p>
<p>The last time I truly had to do set theory and probability math was in my first PhD-level stats class in 2012. The professor cancelled classes after the first month and gave us all of October to re-teach ourselves calculus and probability theory (thank you <a href="https://www.khanacademy.org/">Sal Khan</a>), and then the rest of the class was pretty much all about pure set theory stuff. It was… not fun.</p>
<p>But I learned a valuable secret power from the class. During the final couple weeks of the course, the professor mentioned in passing that it’s possible to skip most of this probability math and instead use simulations to get the same answers. That one throwaway comment changed my whole approach to doing anything based on probabilities.</p>
<section id="why-simulate" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="why-simulate">Why simulate?</h2>
<p>In one problem set from November 2012<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, we had to answer this question using both actual probability math and R simulation:</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;I wrote this in a <code>.Rnw</code> file! R Markdown wasn’t even a thing yet!</p></div></div><blockquote class="blockquote">
<p>An urn contains 10 red balls, 10 blue balls, and 20 green balls. If 5 balls are selected at random without replacement, what is the probability that at least 1 ball of each color will be selected?</p>
</blockquote>
<section id="ew-probability-math" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="ew-probability-math">ew probability math</h3>
<p>We can find this probability by finding the probability of <em>not</em> selecting one or more of the colors in the draw and subtracting it from 1. We need to find the probability of selecting no red balls, no blue balls, and no green balls, and then subtract the probability of the overlapping situations (i.e.&nbsp;no red or blue balls, no red or green balls, and no blue or green balls).</p>
<p>To do this, we can use <em>n</em>-choose-<em>k</em> notation from combinatorics to represent the number of choices from a pool of possible combinations. This notation looks like this:</p>
<p><span class="math display">\[
\dbinom{n}{k} = \frac{n!}{k! (n-k)!}
\]</span></p>
<p>If we’re selecting 5 balls from a pool of 40, we can say “40 choose 5”, or <span class="math inline">\(\binom{40}{5}\)</span>. To calculate that, we get this gross mess:</p>
<p><span class="math display">\[
\begin{aligned}
\dbinom{40}{5} &amp;= \frac{40!}{5! (40-5)!} \\[10pt]
&amp;= \frac{40!}{5!\ 35!} \\[10pt]
&amp;= \frac{40 \times 39 \times 38 \times 37 \times 36}{5!} \qquad \text{(cancel out the 35!)} \\[10pt]
&amp;= \frac{78,960,960}{120} \\[10pt]
&amp;= 658,008
\end{aligned}
\]</span></p>
<p>Or we can do it with R:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Special.html">choose</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">## [1] 658008</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So with this binomial choose notation, we can calculate the official formal probability of drawing at least one red, blue, and green ball from this urn:</p>
<div class="column-screen-inset">
<p><span class="math display">\[
\begin{aligned}
\text{Pr}(\text{at least one red, blue, and green}) &amp;= 1 - \frac{\text{Ways to get no red or no blue or no green}}{\text{Ways to get 5 balls from 40}} \\[10pt]
&amp;= 1 - \dfrac{
    \begin{array}{@{}c@{}}
        (\text{Ways to get no red}) + (\text{Ways to get no blue}) + (\text{Ways to get no green}) - \\
        (\text{Ways to get no red or blue}) - (\text{Ways to get no red or green}) - (\text{Ways to get no blue or green})
    \end{array}
  }{\text{Ways to get 5 balls from 40}} \\[10pt]
&amp;= 1 - \dfrac{
    \dbinom{30}{5} + \dbinom{30}{5} + \dbinom{20}{5} - \dbinom{20}{5} - \dbinom{10}{5} - \dbinom{10}{5}
  }{
    \dbinom{40}{5}
}
\end{aligned}
\]</span></p>
</div>
<p>If we <em>really</em> really wanted, we could then calculate all of that by hand, but ew.</p>
<p>We can just use R instead:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Ways to draw 5 balls without getting a specific color</span></span>
<span><span class="va">no_red</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">choose</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">no_blue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">choose</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">no_green</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">choose</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Ways to draw 5 balls without getting two specific colors</span></span>
<span><span class="va">no_red_blue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">choose</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">no_red_green</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">choose</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">no_blue_green</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">choose</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Ways to draw 5 balls in general</span></span>
<span><span class="va">total_ways</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">choose</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Probability of drawing at least 1 of each color</span></span>
<span><span class="va">prob_real</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="op">(</span><span class="va">no_red</span> <span class="op">+</span> <span class="va">no_blue</span> <span class="op">+</span> <span class="va">no_green</span> <span class="op">-</span> <span class="va">no_red_blue</span> <span class="op">-</span> <span class="va">no_red_green</span> <span class="op">-</span> <span class="va">no_blue_green</span><span class="op">)</span> <span class="op">/</span> <span class="va">total_ways</span></span>
<span><span class="va">prob_real</span></span>
<span><span class="co">## [1] 0.5676</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great. There’s a 56.76% chance of drawing at least one of each color. We have an answer, but this was really hard, and I could only do it because I dug up my old problem sets from 2012.</p>
</section><section id="yay-brute-force-simulation" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="yay-brute-force-simulation">yay brute force simulation</h3>
<p>I really don’t like formal probability math. Fortunately there’s a way I find a heck of a lot easier to use. Brute force simulation.</p>
<p>Instead of figuring out all these weird <em>n</em>-choose-<em>k</em> probabilities, we’ll use the power of computers to literally draw from a hypothetical urn over and over and over again until we come to the right answer.</p>
<p>Here’s one way to do it:<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;Again, this is 2012-era R code; nowadays I’d forgo the loop and use something like <code>purrr::map()</code> or <code><a href="https://rdrr.io/r/base/lapply.html">sapply()</a></code>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Make this randomness consistent</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">12345</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make an urn with balls in it</span></span>
<span><span class="va">urn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'red'</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'blue'</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'green'</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># How many times we'll draw from the urn</span></span>
<span><span class="va">simulations</span> <span class="op">&lt;-</span> <span class="fl">100000</span></span>
<span></span>
<span><span class="va">count</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">simulations</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Pick 5 balls from the urn</span></span>
<span>  <span class="va">draw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">urn</span>, <span class="fl">5</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># See if there's a red, blue, and green; if so, record it</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">'red'</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">draw</span> <span class="op">&amp;&amp;</span> <span class="st">'blue'</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">draw</span> <span class="op">&amp;&amp;</span> <span class="st">'green'</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">draw</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">count</span> <span class="op">&lt;-</span> <span class="va">count</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Find the simulated probability</span></span>
<span><span class="va">prob_simulated</span> <span class="op">&lt;-</span> <span class="va">count</span> <span class="op">/</span> <span class="va">simulations</span></span>
<span><span class="va">prob_simulated</span></span>
<span><span class="co">## [1] 0.5681</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Sweet. The simulation spat out 0.5681, which is shockingly close to 0.5676. If we boosted the number of simulations from 100,000 to something even higher,<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> we’d eventually converge on the true answer.</p>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;Going up to 2,000,000 got me to 0.5676.</p></div></div><hr class="dinkus">
<p>I use this simulation-based approach to anything mathy as much as I can. Personally, I find it far more intuitive to re-create the data generating process rather than think in set theory and combinatorics. In my program evaluation class, we do an <a href="https://evalsp24.classes.andrewheiss.com/resource/zilch.html">in-class activity with the dice game Zilch</a> where we figure out the probability of scoring something in a given dice roll. Instead of finding real probabilities, we just simulate thousands of dice rolls and mark if something was rolled. We essentially recreate the exact data generating process.</p>
<p>This approach is also the core of modern Bayesian statistics. Calculating complex integrals to find posterior distributions is too hard, so we can use Markov Chain Monte Carlo (MCMC) processes bounce around the plausible space for a posterior distribution until they settle on a stable value.</p>
</section></section><section id="birthday-probabilities" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="birthday-probabilities">Birthday probabilities</h2>
<p>A couple days ago, I came across <a href="https://bsky.app/profile/karlrohe.bsky.social/post/3krgobe22kt2k">this post on Bluesky</a>:</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="karl-rohe-skeet.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="margin-caption">Post by Karl Rohe (@karlrohe.bsky.social)</figcaption></figure>
</div>
<p>This is neat because it’s also the case in my household. We have “birthday season” from May to November, and have a dearth of birthdays from November to May. They’re all clustered in half the year. I’d never thought about how unlikely that was.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-heiss-birthday-cycle-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>There’s probably some formal probability math that can answer Karl’s question precisely, but that’s hard. So instead, I decided to figure this out with my old friend—brute force simulation.</p>
<p>The data generating process is a little more complicated than just drawing balls from urns, and the cyclical nature of calendars adds an extra wrinkle to simulating everything, but it’s doable (and fun!), so I figured I’d share the details of the simulation process here. And with the recent release of <a href="https://www.tidyverse.org/blog/2024/02/ggplot2-3-5-0/">{ggplot2} 3.5</a> and its <a href="https://www.tidyverse.org/blog/2024/03/ggplot2-3-5-0-coord-radial/">new <code>coord_radial()</code></a> and <a href="https://www.tidyverse.org/blog/2024/02/ggplot2-3-5-0-legends/#placement">legend placement settings</a> and <a href="https://www.tidyverse.org/blog/2024/02/ggplot2-3-5-0-legends/#placement">point-based text sizing</a> and <a href="https://www.tidyverse.org/blog/2024/02/ggplot2-3-5-0/#ignoring-scales">absolute plot-based positioning</a>, I figured I’d make some pretty plots along the way.</p>
<p>Let’s load some libraries, make a custom theme, and get started!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/ggtext/">ggtext</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">clrs</span> <span class="op">&lt;-</span> <span class="fu">MetBrewer</span><span class="fu">::</span><span class="fu">met.brewer</span><span class="op">(</span><span class="st">"Demuth"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Custom ggplot theme to make pretty plots</span></span>
<span><span class="co"># Get the font at https://fonts.google.com/specimen/Montserrat</span></span>
<span><span class="va">theme_calendar</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span>base_family <span class="op">=</span> <span class="st">"Montserrat"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span></span>
<span>      axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      axis.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>      plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">update_geom_defaults</span><span class="op">(</span><span class="st">"text"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Montserrat"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="visualizing-birthday-distributions-and-spans" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="visualizing-birthday-distributions-and-spans">Visualizing birthday distributions and spans</h2>
<section id="all-birthdays-within-6-month-span" class="level3"><h3 class="anchored" data-anchor-id="all-birthdays-within-6-month-span">All birthdays within 6-month span</h3>
<p>First, let’s work with a hypothetical household with four people in it with birthdays on January 4, March 10, April 28, and May 21. We’ll plot these on a radial plot and add a 6-month span starting at the first birthday:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># All these happen within a 6-month span</span></span>
<span><span class="va">birthdays_yes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-01-04"</span><span class="op">)</span>,</span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-03-10"</span><span class="op">)</span>,</span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-04-28"</span><span class="op">)</span>,</span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-05-21"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="va">birthdays_yes</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"segment"</span>, </span>
<span>    x <span class="op">=</span> <span class="va">birthdays_yes</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, xend <span class="op">=</span> <span class="va">birthdays_yes</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html">months</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span>, y <span class="op">=</span> <span class="st">""</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">5</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"white"</span>, pch <span class="op">=</span> <span class="fl">21</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    <span class="st">"text"</span>, </span>
<span>    label <span class="op">=</span> <span class="st">"Yep"</span>, fontface <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">14</span>, size.unit <span class="op">=</span> <span class="st">"pt"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%B"</span>,</span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-01-01"</span><span class="op">)</span>, <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-12-31"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    expand <span class="op">=</span> <span class="fu">expansion</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_discrete</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu">expansion</span><span class="op">(</span>add <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_radial</span><span class="op">(</span>inner.radius <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_calendar</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-yes-easy-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>The four birthdays all fit comfortably within the 6-month span. Neat.</p>
</section><section id="all-birthdays-within-6-month-span-but-tricky" class="level3"><h3 class="anchored" data-anchor-id="all-birthdays-within-6-month-span-but-tricky">All birthdays within 6-month span, but tricky</h3>
<p>Next, let’s change the May birthday to December 1. These four birthdays still all fit within a 6-month span, but it’s trickier to see because the calendar year resets in the middle. Earlier, we plotted the yellow span with <code>annotate()</code>, but if we do that now, it breaks and we get a warning. We can’t draw a line segment from December 1 to six months later:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">birthdays_yes_but_tricky</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-01-04"</span><span class="op">)</span>,</span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-03-10"</span><span class="op">)</span>,</span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-04-28"</span><span class="op">)</span>,</span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-12-01"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="va">birthdays_yes_but_tricky</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"segment"</span>,</span>
<span>    x <span class="op">=</span> <span class="va">birthdays_yes_but_tricky</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>,</span>
<span>    xend <span class="op">=</span> <span class="va">birthdays_yes_but_tricky</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html">months</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="st">""</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">5</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"white"</span>, pch <span class="op">=</span> <span class="fl">21</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    <span class="st">"text"</span>, </span>
<span>    label <span class="op">=</span> <span class="st">"Yep\n(but broken)"</span>, fontface <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">14</span>, size.unit <span class="op">=</span> <span class="st">"pt"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%B"</span>,</span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-01-01"</span><span class="op">)</span>, <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-12-31"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    expand <span class="op">=</span> <span class="fu">expansion</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_discrete</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu">expansion</span><span class="op">(</span>add <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_radial</span><span class="op">(</span>inner.radius <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_calendar</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## Warning: Removed 1 row containing missing values or values outside the scale range (`geom_segment()`).</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-yes-tricky-annotate-no-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>Instead, we can draw two line segments—one from December 1 to December 31, and one from January 1 to whatever six months from December 1 is. Since this plot represents all of 2024, we’ll force the continued time after January 1 to also be in 2024 (even though it’s technically 2025). Here I colored the segments a little differently to highlight the fact that they’re two separate lines:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="va">birthdays_yes_but_tricky</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"segment"</span>,</span>
<span>    x <span class="op">=</span> <span class="va">birthdays_yes_but_tricky</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, </span>
<span>    xend <span class="op">=</span> <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-12-31"</span><span class="op">)</span>, </span>
<span>    y <span class="op">=</span> <span class="st">""</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"segment"</span>,</span>
<span>    x <span class="op">=</span> <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-01-01"</span><span class="op">)</span>, </span>
<span>    xend <span class="op">=</span> <span class="op">(</span><span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-01-01"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html">months</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> </span>
<span>      <span class="op">(</span><span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-12-31"</span><span class="op">)</span> <span class="op">-</span> <span class="va">birthdays_yes_but_tricky</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>, </span>
<span>    y <span class="op">=</span> <span class="st">""</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">5</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"white"</span>, pch <span class="op">=</span> <span class="fl">21</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    <span class="st">"text"</span>, </span>
<span>    label <span class="op">=</span> <span class="st">"Yep\n(but tricky)"</span>, fontface <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">14</span>, size.unit <span class="op">=</span> <span class="st">"pt"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%B"</span>,</span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-01-01"</span><span class="op">)</span>, <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-12-31"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    expand <span class="op">=</span> <span class="fu">expansion</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_discrete</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu">expansion</span><span class="op">(</span>add <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_radial</span><span class="op">(</span>inner.radius <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_calendar</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-yes-tricky-annotate-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>Writing two separate <code>annotate()</code> layers feels repetitive, though, and it’s easy to make mistakes. So instead, we can make a little helper function that will create a data frame with the start and end date of a six-month span. If the span crosses December 31, it returns two spans; if not, it returns one span:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">calc_date_arc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">start_date</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">days_till_end</span> <span class="op">&lt;-</span> <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-12-31"</span><span class="op">)</span> <span class="op">-</span> <span class="va">start_date</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">days_till_end</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html">months</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">start_date</span></span>
<span>    <span class="va">xend</span> <span class="op">&lt;-</span> <span class="va">start_date</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html">months</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">start_date</span>, <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-01-01"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">xend</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>      <span class="va">start_date</span> <span class="op">+</span> <span class="va">days_till_end</span>, </span>
<span>      <span class="op">(</span><span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-01-01"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html">months</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="va">days_till_end</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, xend <span class="op">=</span> <span class="va">xend</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s make sure it works. Six months from March 15 is September 15, which doesn’t cross into a new year, so we get just one start and end date:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">calc_date_arc</span><span class="op">(</span><span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-03-15"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 2</span></span>
<span><span class="co">##   x          xend      </span></span>
<span><span class="co">##   &lt;date&gt;     &lt;date&gt;    </span></span>
<span><span class="co">## 1 2024-03-15 2024-09-15</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Six months from November 15 is sometime in May, which means we <em>do</em> cross into a new year. We thus get two spans: (1) a segment from November to the end of December, and (2) a segment from January to May:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">calc_date_arc</span><span class="op">(</span><span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-11-15"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 2 × 2</span></span>
<span><span class="co">##   x          xend      </span></span>
<span><span class="co">##   &lt;date&gt;     &lt;date&gt;    </span></span>
<span><span class="co">## 1 2024-11-15 2024-12-31</span></span>
<span><span class="co">## 2 2024-01-01 2024-05-16</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plotting with this function is a lot easier, since it returns a data frame. We don’t need to worry about using <code>annotate()</code> anymore and can instead map the <code>x</code> and <code>xend</code> aesthetics from the data to the plot:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="va">birthdays_yes_but_tricky</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_segment</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu">calc_date_arc</span><span class="op">(</span><span class="va">birthdays_yes_but_tricky</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>xend <span class="op">=</span> <span class="va">xend</span><span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">5</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"white"</span>, pch <span class="op">=</span> <span class="fl">21</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    <span class="st">"text"</span>, </span>
<span>    label <span class="op">=</span> <span class="st">"Yep\n(but tricky)"</span>, fontface <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">14</span>, size.unit <span class="op">=</span> <span class="st">"pt"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%B"</span>,</span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-01-01"</span><span class="op">)</span>, <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-12-31"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    expand <span class="op">=</span> <span class="fu">expansion</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_discrete</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu">expansion</span><span class="op">(</span>add <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_radial</span><span class="op">(</span>inner.radius <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_calendar</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-yes-tricky-good-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
</section><section id="some-birthdays-outside-a-6-month-span" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="some-birthdays-outside-a-6-month-span">Some birthdays outside a 6-month span</h3>
<p>Let’s change the set of birthdays again so that one of them falls outside the six-month window. Regardless of where we start the span, we can’t collect all the points within a continuous six-month period:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">birthdays_no</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-01-04"</span><span class="op">)</span>,</span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-03-10"</span><span class="op">)</span>,</span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-04-28"</span><span class="op">)</span>,</span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-09-21"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="va">birthdays_no</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_segment</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu">calc_date_arc</span><span class="op">(</span><span class="va">birthdays_no</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>xend <span class="op">=</span> <span class="va">xend</span><span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">5</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"white"</span>, pch <span class="op">=</span> <span class="fl">21</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    <span class="st">"text"</span>, </span>
<span>    label <span class="op">=</span> <span class="st">"Nope"</span>, fontface <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">14</span>, size.unit <span class="op">=</span> <span class="st">"pt"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%B"</span>,</span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-01-01"</span><span class="op">)</span>, <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-12-31"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    expand <span class="op">=</span> <span class="fu">expansion</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_discrete</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu">expansion</span><span class="op">(</span>add <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_radial</span><span class="op">(</span>inner.radius <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_calendar</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="va">birthdays_no</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_segment</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu">calc_date_arc</span><span class="op">(</span><span class="va">birthdays_no</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>xend <span class="op">=</span> <span class="va">xend</span><span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">5</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"white"</span>, pch <span class="op">=</span> <span class="fl">21</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    <span class="st">"text"</span>, </span>
<span>    label <span class="op">=</span> <span class="st">"Still nope"</span>, fontface <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">14</span>, size.unit <span class="op">=</span> <span class="st">"pt"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%B"</span>,</span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-01-01"</span><span class="op">)</span>, <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-12-31"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    expand <span class="op">=</span> <span class="fu">expansion</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_discrete</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu">expansion</span><span class="op">(</span>add <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_radial</span><span class="op">(</span>inner.radius <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_calendar</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">p1</span> <span class="op">|</span> <span class="fu">plot_spacer</span><span class="op">(</span><span class="op">)</span> <span class="op">|</span> <span class="va">p2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">plot_layout</span><span class="op">(</span>widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.45</span>, <span class="fl">0.1</span>, <span class="fl">0.45</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p class="page-columns page-full"><img src="index_files/figure-html/plot-no-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-screen-inset" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="simulation-time" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="simulation-time">Simulation time!</h2>
<p>So far, we’ve been working with a hypothetical household of 4, with arbitrarily chosen birthdays. For the simulation, we’ll need to work with randomly selected birthdays for households of varying sizes.</p>
<section id="counting-simulated-birthdays-and-measuring-spans" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="counting-simulated-birthdays-and-measuring-spans">Counting simulated birthdays and measuring spans</h3>
<p>But before we build the full simulation, we need to build a way to programmatically detect if a set of dates fit within a six-month span, which—as we saw with the plotting—is surprisingly tricky because of the possible change in year.</p>
<p>If we didn’t need to contend with a change in year, we could convert all the birthdays to their corresponding day of the year, sort them, find the difference between the first and the last, and see if it’s less than 183 days (366/2; we’re working with a leap year). This would work great:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">birthdays_yes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-01-04"</span><span class="op">)</span>,</span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-03-10"</span><span class="op">)</span>,</span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-04-28"</span><span class="op">)</span>,</span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-05-21"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">birthdays_sorted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu">yday</span><span class="op">(</span><span class="va">birthdays_yes</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">birthdays_sorted</span></span>
<span><span class="co">## [1]   4  70 119 142</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">birthdays_sorted</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">birthdays_sorted</span><span class="op">)</span></span>
<span><span class="co">## [1] 138</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>But time is a circle. If we look at a set of birthdays that crosses a new year, we can’t just look at <code>max - min</code>. Also, there’s no guarantee that the six-month span will go from the first to the last; it could go from the last to the first.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">birthdays_yes_but_tricky</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-01-04"</span><span class="op">)</span>,</span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-03-10"</span><span class="op">)</span>,</span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-04-28"</span><span class="op">)</span>,</span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-12-01"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">birthdays_sorted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu">yday</span><span class="op">(</span><span class="va">birthdays_yes_but_tricky</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">birthdays_sorted</span></span>
<span><span class="co">## [1]   4  70 119 336</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">birthdays_sorted</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">birthdays_sorted</span><span class="op">)</span></span>
<span><span class="co">## [1] 332</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So we need to do something a little trickier to account for the year looping over. There are several potential ways to do this, and there’s no one right way. Here’s the approach I settled on.</p>
<p>We need to check the span between each possible window of dates. In a household of 4, this means finding the distance between the 4th (or last) date and the 1st date, which we did with <code>max - min</code>. But we also need to check on the distance between the 1st date in the next cycle (i.e.&nbsp;2025) and the 2nd date (in 2024), and so on, or this:</p>
<ul>
<li>Distance between 4th and 1st:
<ul>
<li>
<code>ymd("2024-12-01") - ymd("2024-01-04")</code> or 332 days</li>
</ul>
</li>
<li>Distance between (1st + 1 year) and 2nd:
<ul>
<li>
<code>ymd("2025-01-04") - ymd("2024-03-10")</code> or 300 days</li>
</ul>
</li>
<li>Distance between (2nd + 1 year) and 3rd:
<ul>
<li>
<code>ymd("2025-03-10") - ymd("2024-04-28")</code> or 316 days</li>
</ul>
</li>
<li>Distance between (3rd + 1 year) and 4th:
<ul>
<li>
<code>ymd("2025-04-28") - ymd("2024-12-01")</code> or 148 days</li>
</ul>
</li>
</ul>
<p>That last one, from December 1 to April 28, is less than 180 days, which means that the dates fit within a six-month span. We saw this in the plot earlier too—if we start the span in December, it more than covers the remaining birthdays.</p>
<p>One easy way to look at dates in the next year is to double up the vector of birthday days-of-the-year, adding 366 to the first set, like this:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">birthdays_doubled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu">yday</span><span class="op">(</span><span class="va">birthdays_yes_but_tricky</span><span class="op">)</span><span class="op">)</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu">yday</span><span class="op">(</span><span class="va">birthdays_yes_but_tricky</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">366</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">birthdays_doubled</span></span>
<span><span class="co">## [1]   4  70 119 336 370 436 485 702</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The first four represent the regular real birthdays; the next four are the same values, just shifted up a year (so 4 and 370 are both January 1, etc.)</p>
<p>With this vector, we can now find differences between dates that cross years more easily:<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<div class="no-row-height column-margin column-container"><div id="fn4"><p><sup>4</sup>&nbsp;Some of these differences aren’t the same as before (317 instead of 361; 149 instead of 148). This is because 2024 is a leap year and 2025 is not, and {lubridate} accounts for that. By adding 366, we’re pretending 2025 is also a leap year. But that’s okay, because we want to pretend that February 29 happens each year.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">birthdays_doubled</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">-</span> <span class="va">birthdays_doubled</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="co">## [1] 332</span></span>
<span><span class="va">birthdays_doubled</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span> <span class="op">-</span> <span class="va">birthdays_doubled</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="co">## [1] 300</span></span>
<span><span class="va">birthdays_doubled</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span> <span class="op">-</span> <span class="va">birthdays_doubled</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="co">## [1] 317</span></span>
<span><span class="va">birthdays_doubled</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span> <span class="op">-</span> <span class="va">birthdays_doubled</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="co">## [1] 149</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Or instead of repeating lots of lines like that, we can auto-increment the different indices:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">birthdays_yes_but_tricky</span><span class="op">)</span></span>
<span><span class="fu">map_dbl</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="op">~</span> <span class="va">birthdays_doubled</span><span class="op">[</span><span class="va">.x</span> <span class="op">+</span> <span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">birthdays_doubled</span><span class="op">[</span><span class="va">.x</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## [1] 332 300 317 149</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If any of those values are less than 183, the birthdays fit in a six-month span:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="fu">map_lgl</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="op">~</span> <span class="va">birthdays_doubled</span><span class="op">[</span><span class="va">.x</span> <span class="op">+</span> <span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">birthdays_doubled</span><span class="op">[</span><span class="va">.x</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="fl">183</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s check it with the other two test sets of birthdays. Here’s the easy set of birthdays without any cross-year loops:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">birthdays_yes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-01-04"</span><span class="op">)</span>,</span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-03-10"</span><span class="op">)</span>,</span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-04-28"</span><span class="op">)</span>,</span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-05-21"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">birthdays_doubled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu">yday</span><span class="op">(</span><span class="va">birthdays_yes</span><span class="op">)</span><span class="op">)</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu">yday</span><span class="op">(</span><span class="va">birthdays_yes</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">366</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">map_dbl</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="op">~</span> <span class="va">birthdays_doubled</span><span class="op">[</span><span class="va">.x</span> <span class="op">+</span> <span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">birthdays_doubled</span><span class="op">[</span><span class="va">.x</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## [1] 138 300 317 343</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="fu">map_lgl</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="op">~</span> <span class="va">birthdays_doubled</span><span class="op">[</span><span class="va">.x</span> <span class="op">+</span> <span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">birthdays_doubled</span><span class="op">[</span><span class="va">.x</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="fl">183</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And here’s the set we know doesn’t fit:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">birthdays_no</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-01-04"</span><span class="op">)</span>,</span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-03-10"</span><span class="op">)</span>,</span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-04-28"</span><span class="op">)</span>,</span>
<span>  <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-09-21"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">birthdays_doubled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu">yday</span><span class="op">(</span><span class="va">birthdays_no</span><span class="op">)</span><span class="op">)</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu">yday</span><span class="op">(</span><span class="va">birthdays_no</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">366</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">map_dbl</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="op">~</span> <span class="va">birthdays_doubled</span><span class="op">[</span><span class="va">.x</span> <span class="op">+</span> <span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">birthdays_doubled</span><span class="op">[</span><span class="va">.x</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## [1] 261 300 317 220</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="fu">map_lgl</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="op">~</span> <span class="va">birthdays_doubled</span><span class="op">[</span><span class="va">.x</span> <span class="op">+</span> <span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">birthdays_doubled</span><span class="op">[</span><span class="va">.x</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="fl">183</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It works!</p>
</section><section id="actual-simulation" class="level3"><h3 class="anchored" data-anchor-id="actual-simulation">Actual simulation</h3>
<p>Now that we have the ability to check if any set of dates fits within six months, we can generalize this to any household size. To make life a little easier, we’ll stop working with days of the year for. Leap years are tricky, and the results changed a little bit above if we added 366 or 365 to the repeated years. So instead, we’ll think about 360° in a circle—circles don’t suddenly have 361° every four years or anything weird like that.</p>
<p>In this simulation, we’ll generate <code>n</code> random numbers between 0 and 360 (where <code>n</code> is the household size we’re interested in). We’ll then do the doubling and sorting thing and check to see if the distance between any of the 4-number spans is less than 180.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">simulate_prob</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">num_simulations</span> <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">map_lgl</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num_simulations</span>, <span class="op">~</span><span class="op">{</span></span>
<span>    <span class="va">birthdays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="fl">360</span><span class="op">)</span></span>
<span>    <span class="va">birthdays_doubled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">birthdays</span>, <span class="va">birthdays</span> <span class="op">+</span> <span class="fl">360</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="fu">map_lgl</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="op">~</span> <span class="va">birthdays_doubled</span><span class="op">[</span><span class="va">.x</span> <span class="op">+</span> <span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">birthdays_doubled</span><span class="op">[</span><span class="va">.x</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="fl">180</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here’s the probability of seeing all the birthdays in a six-month span in a household of 4:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html">with_seed</a></span><span class="op">(</span><span class="fl">1234</span>, <span class="op">{</span></span>
<span>  <span class="fu">simulate_prob</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.522</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>About 50%!</p>
<p>What about a household of 6, like in Karl’s original post?</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html">with_seed</a></span><span class="op">(</span><span class="fl">1234</span>, <span class="op">{</span></span>
<span>  <span class="fu">simulate_prob</span><span class="op">(</span><span class="fl">6</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.189</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>About 18%!</p>
<p>We can get this more precise and consistent by boosting the number of simulations:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html">with_seed</a></span><span class="op">(</span><span class="fl">1234</span>, <span class="op">{</span></span>
<span>  <span class="fu">simulate_prob</span><span class="op">(</span><span class="fl">6</span>, <span class="fl">50000</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.1866</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that this function is working, we can use it to simulate a bunch of possible household sizes, like from 2 to 10:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">simulated_households</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>household_size <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>prob_in_arc <span class="op">=</span> <span class="fu">map_dbl</span><span class="op">(</span><span class="va">household_size</span>, <span class="op">~</span><span class="fu">simulate_prob</span><span class="op">(</span><span class="va">.x</span>, <span class="fl">10000</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>nice_prob <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu">label_percent</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">(</span><span class="va">prob_in_arc</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">simulated_households</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">household_size</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">prob_in_arc</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_pointrange</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="fl">0</span>, ymax <span class="op">=</span> <span class="va">prob_in_arc</span><span class="op">)</span>, color <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">nice_prob</span><span class="op">)</span>, nudge_y <span class="op">=</span> <span class="fl">0.07</span>, size <span class="op">=</span> <span class="fl">8</span>, size.unit <span class="op">=</span> <span class="st">"pt"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Household size"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Probability"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Probability that all birthdays occur within \na single six-month span across household size"</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"10,000 simulations"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span>base_family <span class="op">=</span> <span class="st">"Montserrat"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.major.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span>,</span>
<span>    axis.title.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-household-probability-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="but-birthdays-arent-uniformly-distributed" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="but-birthdays-arent-uniformly-distributed">But birthdays aren’t uniformly distributed!</h2>
<p>We just answered Karl’s original question: “Suppose n points are uniformly distributed on a circle. What is the probability that they belong to a connected half circle”. There’s probably some official mathy combinatorial way to build a real formula to describe this pattern, but that’s too hard. Simulation gets us there.</p>
<section id="uneven-birthday-disributions" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="uneven-birthday-disributions">Uneven birthday disributions</h3>
<p>But in real life, birthdays aren’t actually normally distributed. There are some <em>fascinating</em> patterns in days of birth. Instead of drawing birthdays from a uniform distribution where every day is equally likely, let’s draw from the actual distribution. There’s no official probability-math way to do this—the only way to do this kind of calculation is with simulation.</p>
<p>The CDC and the Social Security Administration track the counts of daily births in the Unitd States. In 2016, <a href="https://fivethirtyeight.com/features/some-people-are-too-superstitious-to-have-a-baby-on-friday-the-13th/">FiveThirtyEight reported a story</a> about patterns in daily birthrate frequencies and they <a href="https://github.com/fivethirtyeight/data/tree/master/births">posted their CSV files on GitHub</a>, so we’ll load their data and figure out daily probabilities of birthdays.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">births_1994_1999</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span></span>
<span>  <span class="st">"https://raw.githubusercontent.com/fivethirtyeight/data/master/births/US_births_1994-2003_CDC_NCHS.csv"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Ignore anything after 2000</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&lt;</span> <span class="fl">2000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">births_2000_2014</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span></span>
<span>  <span class="st">"https://raw.githubusercontent.com/fivethirtyeight/data/master/births/US_births_2000-2014_SSA.csv"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">births_combined</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">births_1994_1999</span>, <span class="va">births_2000_2014</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    full_date <span class="op">=</span> <span class="fu">make_date</span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2024</span>, month <span class="op">=</span> <span class="va">month</span>, day <span class="op">=</span> <span class="va">date_of_month</span><span class="op">)</span>,</span>
<span>    day_of_year <span class="op">=</span> <span class="fu">yday</span><span class="op">(</span><span class="va">full_date</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    month_cateogrical <span class="op">=</span> <span class="fu">month</span><span class="op">(</span><span class="va">full_date</span>, label <span class="op">=</span> <span class="cn">TRUE</span>, abbr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">births_combined</span><span class="op">)</span></span>
<span><span class="co">## Rows: 7,670</span></span>
<span><span class="co">## Columns: 8</span></span>
<span><span class="co">## $ year              &lt;dbl&gt; 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 1994, 19…</span></span>
<span><span class="co">## $ month             &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4,…</span></span>
<span><span class="co">## $ date_of_month     &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16,…</span></span>
<span><span class="co">## $ day_of_week       &lt;dbl&gt; 6, 7, 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5,…</span></span>
<span><span class="co">## $ births            &lt;dbl&gt; 8096, 7772, 10142, 11248, 11053, 11406, 11251, 8653, 7910, 10498, 11706, 11567, 11212, 11570, 8660, 8123, 10567, 11541, 11257, 11682, 11811, 8833, 8310, 11125, 11981, 11514, 11702, 11666, 8988, 8096, 10765, 11755, 11483, 11523, 11677, 8991, 8309, 10984, 12152, 11515, 1162…</span></span>
<span><span class="co">## $ full_date         &lt;date&gt; 2024-01-01, 2024-01-02, 2024-01-03, 2024-01-04, 2024-01-05, 2024-01-06, 2024-01-07, 2024-01-08, 2024-01-09, 2024-01-10, 2024-01-11, 2024-01-12, 2024-01-13, 2024-01-14, 2024-01-15, 2024-01-16, 2024-01-17, 2024-01-18, 2024-01-19, 2024-01-20, 2024-01-21, 2024-01-22, 2024-01…</span></span>
<span><span class="co">## $ day_of_year       &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 7…</span></span>
<span><span class="co">## $ month_cateogrical &lt;ord&gt; January, January, January, January, January, January, January, January, January, January, January, January, January, January, January, January, January, January, January, January, January, January, January, January, January, January, January, January, January, January, Ja…</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>But first, just because this is one of my favorite graphs ever, let’s visualize the data! Here’s a heatmap showing the daily average births for 366 days:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">avg_births_month_day</span> <span class="op">&lt;-</span> <span class="va">births_combined</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">month_cateogrical</span>, <span class="va">date_of_month</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span>avg_births <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">births</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span></span>
<span>  <span class="va">avg_births_month_day</span>, </span>
<span>  <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">date_of_month</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="va">month_cateogrical</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">avg_births</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_tile</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span></span>
<span>    option <span class="op">=</span> <span class="st">"rocket"</span>, labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu">label_comma</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    guide <span class="op">=</span> <span class="fu">guide_colorbar</span><span class="op">(</span>barwidth <span class="op">=</span> <span class="fl">20</span>, barheight <span class="op">=</span> <span class="fl">0.5</span>, position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Average births per day"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"1994–2014"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Average births"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span>base_family <span class="op">=</span> <span class="st">"Montserrat"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    legend.justification.bottom <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>    legend.title.position <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>    panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.title.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p class="page-columns page-full"><img src="index_files/figure-html/plot-births-heatmap-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-body-outset" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>There are some really fascinating stories here!</p>
<ul>
<li>Nobody wants to have babies during Christmas or New Year’s. Christmas Day, Christmas Eve, and New Year’s Day seem to have the lowest average births.</li>
<li>New Year’s Eve, Halloween, July 4, April 1,<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> and the whole week of Thanksgiving<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a> also have really low averages.</li>
<li>The 13th of every month has slightly fewer births than average—the column at the 13th is really obvious here.</li>
<li>The days with the highest average counts are in mid-September, from the 9th to the 20th—except for September 11.</li>
</ul>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;No one wants joke babies?</p></div><div id="fn6"><p><sup>6</sup>&nbsp;American Thanksgiving is the fourth Thursday of November, so the exact day of the month moves around each year</p></div></div><p>With this data, we can calculate the daily probability of having a birthday:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prob_per_day</span> <span class="op">&lt;-</span> <span class="va">births_combined</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">day_of_year</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span>total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">births</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>prob <span class="op">=</span> <span class="va">total</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">total</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>full_date <span class="op">=</span> <span class="fu">ymd</span><span class="op">(</span><span class="st">"2024-01-01"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">days</span><span class="op">(</span><span class="va">day_of_year</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>yearless_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">full_date</span>, <span class="st">"%B %d"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">prob_per_day</span><span class="op">)</span></span>
<span><span class="co">## Rows: 366</span></span>
<span><span class="co">## Columns: 5</span></span>
<span><span class="co">## $ day_of_year   &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 7…</span></span>
<span><span class="co">## $ total         &lt;dbl&gt; 164362, 196481, 228259, 232354, 230826, 229776, 230233, 223766, 224116, 232521, 231414, 230499, 223803, 231343, 222374, 224055, 230038, 229465, 225387, 228138, 228190, 225098, 229163, 233021, 230897, 228394, 228012, 228365, 222831, 226669, 229472, 230364, 230984, 228433, 2298…</span></span>
<span><span class="co">## $ prob          &lt;dbl&gt; 0.0019176, 0.0022923, 0.0026631, 0.0027108, 0.0026930, 0.0026808, 0.0026861, 0.0026107, 0.0026147, 0.0027128, 0.0026999, 0.0026892, 0.0026111, 0.0026991, 0.0025944, 0.0026140, 0.0026838, 0.0026771, 0.0026296, 0.0026617, 0.0026623, 0.0026262, 0.0026736, 0.0027186, 0.0026938, 0…</span></span>
<span><span class="co">## $ full_date     &lt;date&gt; 2024-01-01, 2024-01-02, 2024-01-03, 2024-01-04, 2024-01-05, 2024-01-06, 2024-01-07, 2024-01-08, 2024-01-09, 2024-01-10, 2024-01-11, 2024-01-12, 2024-01-13, 2024-01-14, 2024-01-15, 2024-01-16, 2024-01-17, 2024-01-18, 2024-01-19, 2024-01-20, 2024-01-21, 2024-01-22, 2024-01-23,…</span></span>
<span><span class="co">## $ yearless_date &lt;chr&gt; "January 01", "January 02", "January 03", "January 04", "January 05", "January 06", "January 07", "January 08", "January 09", "January 10", "January 11", "January 12", "January 13", "January 14", "January 15", "January 16", "January 17", "January 18", "January 19", "January 2…</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here are the 5 most common days:<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></p>
<div class="no-row-height column-margin column-container"><div id="fn7"><p><sup>7</sup>&nbsp;There’s me on September 19.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prob_per_day</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">yearless_date</span>, <span class="va">prob</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">slice_max</span><span class="op">(</span>order_by <span class="op">=</span> <span class="va">prob</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 5 × 2</span></span>
<span><span class="co">##   yearless_date    prob</span></span>
<span><span class="co">##   &lt;chr&gt;           &lt;dbl&gt;</span></span>
<span><span class="co">## 1 September 09  0.00302</span></span>
<span><span class="co">## 2 September 19  0.00301</span></span>
<span><span class="co">## 3 September 12  0.00301</span></span>
<span><span class="co">## 4 September 17  0.00299</span></span>
<span><span class="co">## 5 September 10  0.00299</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And the 5 least probable days—Leap Day, Christmas Day, New Year’s Day, Christmas Eve, and July 4th:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prob_per_day</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">yearless_date</span>, <span class="va">prob</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">slice_min</span><span class="op">(</span>order_by <span class="op">=</span> <span class="va">prob</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 5 × 2</span></span>
<span><span class="co">##   yearless_date     prob</span></span>
<span><span class="co">##   &lt;chr&gt;            &lt;dbl&gt;</span></span>
<span><span class="co">## 1 February 29   0.000613</span></span>
<span><span class="co">## 2 December 25   0.00162 </span></span>
<span><span class="co">## 3 January 01    0.00192 </span></span>
<span><span class="co">## 4 December 24   0.00199 </span></span>
<span><span class="co">## 5 July 04       0.00216</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="using-actual-birthday-probabilities" class="level3"><h3 class="anchored" data-anchor-id="using-actual-birthday-probabilities">Using actual birthday probabilities</h3>
<p>Instead of drawing random numbers between 0 and 360 from a uniform distribution, we can draw day-of-the-year numbers. This is easy with <code><a href="https://rdrr.io/r/base/sample.html">sample()</a></code>. Here’s a random 4-person household:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html">with_seed</a></span><span class="op">(</span><span class="fl">1234</span>, <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">366</span>, size <span class="op">=</span> <span class="fl">4</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">## [1] 284 336 101 111</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That gives us a uniform probability distribution—all the numbers between 1 and 366 are equally likely. <code><a href="https://rdrr.io/r/base/sample.html">sample()</a></code> has a <code>prob</code> argument that we can use to feed a vector of probabilities:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html">with_seed</a></span><span class="op">(</span><span class="fl">1234</span>, <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span></span>
<span>    <span class="va">prob_per_day</span><span class="op">$</span><span class="va">day_of_year</span>, </span>
<span>    size <span class="op">=</span> <span class="fl">4</span>, </span>
<span>    replace <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    prob <span class="op">=</span> <span class="va">prob_per_day</span><span class="op">$</span><span class="va">prob</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">## [1] 284 101 111 133</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These days of the year now match the actual distribution of birthdays in the United States. If we simulated thousands of birthdays, we’d get more in September, fewer on the 13th of each month, and far fewer around Thanksgiving and Christmas.</p>
<p>We can now update our simulation to use this more realistic distribution of birthdays:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">simulate_prob_real</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">num_simulations</span> <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">map_lgl</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num_simulations</span>, <span class="op">~</span><span class="op">{</span></span>
<span>    <span class="va">birthdays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span></span>
<span>      <span class="va">prob_per_day</span><span class="op">$</span><span class="va">day_of_year</span>, </span>
<span>      size <span class="op">=</span> <span class="va">n</span>, </span>
<span>      replace <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>      prob <span class="op">=</span> <span class="va">prob_per_day</span><span class="op">$</span><span class="va">prob</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">birthdays_doubled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">birthdays</span>, <span class="va">birthdays</span> <span class="op">+</span> <span class="fl">366</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="fu">map_lgl</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="op">~</span> <span class="va">birthdays_doubled</span><span class="op">[</span><span class="va">.x</span> <span class="op">+</span> <span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">birthdays_doubled</span><span class="op">[</span><span class="va">.x</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="op">(</span><span class="fl">366</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here’s the probability of having all the birthdays within the same six months for a household of 4:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html">with_seed</a></span><span class="op">(</span><span class="fl">1234</span>, <span class="op">{</span></span>
<span>  <span class="fu">simulate_prob_real</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.495</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And 6:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html">with_seed</a></span><span class="op">(</span><span class="fl">1234</span>, <span class="op">{</span></span>
<span>  <span class="fu">simulate_prob_real</span><span class="op">(</span><span class="fl">6</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.202</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And here’s the probability across different household sizes:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sims_real</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>household_size <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>prob_in_arc <span class="op">=</span> <span class="fu">map_dbl</span><span class="op">(</span><span class="va">household_size</span>, <span class="op">~</span><span class="fu">simulate_prob_real</span><span class="op">(</span><span class="va">.x</span>, <span class="fl">10000</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>nice_prob <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu">label_percent</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">(</span><span class="va">prob_in_arc</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">sims_real</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">household_size</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">prob_in_arc</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_pointrange</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="fl">0</span>, ymax <span class="op">=</span> <span class="va">prob_in_arc</span><span class="op">)</span>, color <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">9</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">nice_prob</span><span class="op">)</span>, nudge_y <span class="op">=</span> <span class="fl">0.07</span>, size <span class="op">=</span> <span class="fl">8</span>, size.unit <span class="op">=</span> <span class="st">"pt"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Household size"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Probability"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Probability that all birthdays occur within a\nsingle 6-month span across household size"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Based on average daily birth probabilities from 1994–2014"</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"10,000 simulations; daily probabilities from the CDC and SSA"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span>base_family <span class="op">=</span> <span class="st">"Montserrat"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.major.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span>,</span>
<span>    plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span>,</span>
<span>    axis.title.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    axis.title.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-household-probability-real-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>In the end, these are all roughly the same as the uniform birthday distribution, but it <em>feels</em> more accurate since the probabilities are based on real-life frequencies.</p>
<hr class="dinkus">
<p>But most importantly, we didn’t have to do any math to get the right answer. Brute force simulation techniques got us there.</p>


<!-- -->

</section></section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{heiss2024,
  author = {Heiss, Andrew},
  title = {Calculating Birthday Probabilities with {R} Instead of Math},
  date = {2024-05-03},
  url = {https://www.andrewheiss.com/blog/2024/05/03/birthday-spans-simulation-sans-math/},
  doi = {10.59350/r419r-zqj73},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-heiss2024" class="csl-entry quarto-appendix-citeas" role="listitem">
Heiss, Andrew. 2024. <span>“Calculating Birthday Probabilities with R
Instead of Math.”</span> May 3, 2024. <a href="https://doi.org/10.59350/r419r-zqj73">https://doi.org/10.59350/r419r-zqj73</a>.
</div></div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.andrewheiss\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><script src="https://giscus.app/client.js" data-repo="andrewheiss/ath-quarto" data-repo-id="R_kgDOIg6EJQ" data-category="Blog comments" data-category-id="DIC_kwDOIg6EJc4CSz92" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><input type="hidden" id="giscus-base-theme" value="light"><input type="hidden" id="giscus-alt-theme" value="dark"><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb38" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Calculating birthday probabilities with R instead of math"</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2024-05-03</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Probability math is hard. Use brute force simulation to find the probability that a household has a cluster of birthdays."</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> "index_files/figure-html/plot-heiss-birthday-cycle-1.png"</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="an">twitter-card:</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co">  image: "index_files/figure-html/plot-heiss-birthday-cycle-1.png"</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="an">open-graph:</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co">  image: "index_files/figure-html/plot-heiss-birthday-cycle-1.png"</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="co">  - r</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="co">  - tidyverse</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co">  - simulations</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="co">  - probability</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="co">  html: </span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="co">    shift-heading-level-by: 1</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="co">    include-in-header:</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="co">      - text: |</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="co">          &lt;style type="text/css"&gt;</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="co">          hr.dinkus {</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="co">              width: 50px;</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="co">              margin: 2em auto 2em;</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="co">              border-top: 5px dotted #454545;</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a><span class="co">          }</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a><span class="co">          </span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a><span class="co">          div.column-margin+hr.dinkus {</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a><span class="co">              margin: 1em auto 2em;</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a><span class="co">          }</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a><span class="co">          &lt;/style&gt;</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a><span class="an">doi:</span><span class="co"> 10.59350/r419r-zqj73</span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a><span class="an">citation:</span><span class="co"> true</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig.width =</span> <span class="dv">6</span>,</span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig.height =</span> <span class="dv">6</span> <span class="sc">*</span> <span class="fl">0.618</span>,</span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig.retina =</span> <span class="dv">3</span>,</span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">dev =</span> <span class="st">"ragg_png"</span>,</span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig.align =</span> <span class="st">"center"</span>,</span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">out.width =</span> <span class="st">"90%"</span>,</span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">collapse =</span> <span class="cn">TRUE</span>,</span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">cache.extra =</span> <span class="dv">1234</span>  <span class="co"># Change number to invalidate cache</span></span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(</span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">digits =</span> <span class="dv">4</span>,</span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">300</span></span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: libraries-n-things</span></span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb38-63"><a href="#cb38-63" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb38-64"><a href="#cb38-64" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb38-65"><a href="#cb38-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-66"><a href="#cb38-66" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb38-67"><a href="#cb38-67" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggtext)</span>
<span id="cb38-68"><a href="#cb38-68" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb38-69"><a href="#cb38-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-70"><a href="#cb38-70" aria-hidden="true" tabindex="-1"></a>clrs <span class="ot">&lt;-</span> MetBrewer<span class="sc">::</span><span class="fu">met.brewer</span>(<span class="st">"Demuth"</span>)</span>
<span id="cb38-71"><a href="#cb38-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-72"><a href="#cb38-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom ggplot theme to make pretty plots</span></span>
<span id="cb38-73"><a href="#cb38-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the font at https://fonts.google.com/specimen/Montserrat</span></span>
<span id="cb38-74"><a href="#cb38-74" aria-hidden="true" tabindex="-1"></a>theme_calendar <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb38-75"><a href="#cb38-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_family =</span> <span class="st">"Montserrat"</span>) <span class="sc">+</span></span>
<span id="cb38-76"><a href="#cb38-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb38-77"><a href="#cb38-77" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb38-78"><a href="#cb38-78" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb38-79"><a href="#cb38-79" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb38-80"><a href="#cb38-80" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb38-81"><a href="#cb38-81" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb38-82"><a href="#cb38-82" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-83"><a href="#cb38-83" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-84"><a href="#cb38-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-85"><a href="#cb38-85" aria-hidden="true" tabindex="-1"></a><span class="fu">update_geom_defaults</span>(<span class="st">"text"</span>, <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"Montserrat"</span>))</span>
<span id="cb38-86"><a href="#cb38-86" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-87"><a href="#cb38-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-90"><a href="#cb38-90" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-91"><a href="#cb38-91" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fun-calc-date-arc</span></span>
<span id="cb38-92"><a href="#cb38-92" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb38-93"><a href="#cb38-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-94"><a href="#cb38-94" aria-hidden="true" tabindex="-1"></a>calc_date_arc <span class="ot">&lt;-</span> <span class="cf">function</span>(start_date) {</span>
<span id="cb38-95"><a href="#cb38-95" aria-hidden="true" tabindex="-1"></a>  days_till_end <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="st">"2024-12-31"</span>) <span class="sc">-</span> start_date</span>
<span id="cb38-96"><a href="#cb38-96" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-97"><a href="#cb38-97" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (days_till_end <span class="sc">&gt;=</span> <span class="fu">months</span>(<span class="dv">6</span>)) {</span>
<span id="cb38-98"><a href="#cb38-98" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> start_date</span>
<span id="cb38-99"><a href="#cb38-99" aria-hidden="true" tabindex="-1"></a>    xend <span class="ot">&lt;-</span> start_date <span class="sc">+</span> <span class="fu">months</span>(<span class="dv">6</span>)</span>
<span id="cb38-100"><a href="#cb38-100" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb38-101"><a href="#cb38-101" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">c</span>(start_date, <span class="fu">ymd</span>(<span class="st">"2024-01-01"</span>))</span>
<span id="cb38-102"><a href="#cb38-102" aria-hidden="true" tabindex="-1"></a>    xend <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb38-103"><a href="#cb38-103" aria-hidden="true" tabindex="-1"></a>      start_date <span class="sc">+</span> days_till_end, </span>
<span id="cb38-104"><a href="#cb38-104" aria-hidden="true" tabindex="-1"></a>      (<span class="fu">ymd</span>(<span class="st">"2024-01-01"</span>) <span class="sc">+</span> <span class="fu">months</span>(<span class="dv">6</span>)) <span class="sc">-</span> days_till_end</span>
<span id="cb38-105"><a href="#cb38-105" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-106"><a href="#cb38-106" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-107"><a href="#cb38-107" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-108"><a href="#cb38-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend))</span>
<span id="cb38-109"><a href="#cb38-109" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-110"><a href="#cb38-110" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-111"><a href="#cb38-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-112"><a href="#cb38-112" aria-hidden="true" tabindex="-1"></a>Even though I've been teaching R and statistical programming since 2017, and despite the fact that I do all sorts of heavily quantitative research, *I'm really really bad at probability math*.</span>
<span id="cb38-113"><a href="#cb38-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-114"><a href="#cb38-114" aria-hidden="true" tabindex="-1"></a>Like super bad.</span>
<span id="cb38-115"><a href="#cb38-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-116"><a href="#cb38-116" aria-hidden="true" tabindex="-1"></a>The last time I truly had to do set theory and probability math was in my first PhD-level stats class in 2012. The professor cancelled classes after the first month and gave us all of October to re-teach ourselves calculus and probability theory (thank you <span class="co">[</span><span class="ot">Sal Khan</span><span class="co">](https://www.khanacademy.org/)</span>), and then the rest of the class was pretty much all about pure set theory stuff. It was… not fun.</span>
<span id="cb38-117"><a href="#cb38-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-118"><a href="#cb38-118" aria-hidden="true" tabindex="-1"></a>But I learned a valuable secret power from the class. During the final couple weeks of the course, the professor mentioned in passing that it's possible to skip most of this probability math and instead use simulations to get the same answers. That one throwaway comment changed my whole approach to doing anything based on probabilities.</span>
<span id="cb38-119"><a href="#cb38-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-120"><a href="#cb38-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-121"><a href="#cb38-121" aria-hidden="true" tabindex="-1"></a><span class="fu"># Why simulate?</span></span>
<span id="cb38-122"><a href="#cb38-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-123"><a href="#cb38-123" aria-hidden="true" tabindex="-1"></a>In one problem set from November 2012^<span class="co">[</span><span class="ot">I wrote this in a `.Rnw` file! R Markdown wasn't even a thing yet!</span><span class="co">]</span>, we had to answer this question using both actual probability math and R simulation:</span>
<span id="cb38-124"><a href="#cb38-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-125"><a href="#cb38-125" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; An urn contains 10 red balls, 10 blue balls, and 20 green balls. If 5 balls are selected at random without replacement, what is the probability that at least 1 ball of each color will be selected?</span></span>
<span id="cb38-126"><a href="#cb38-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-127"><a href="#cb38-127" aria-hidden="true" tabindex="-1"></a><span class="fu">## ew probability math</span></span>
<span id="cb38-128"><a href="#cb38-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-129"><a href="#cb38-129" aria-hidden="true" tabindex="-1"></a>We can find this probability by finding the probability of *not* selecting one or more of the colors in the draw and subtracting it from 1. We need to find the probability of selecting no red balls, no blue balls, and no green balls, and then subtract the probability of the overlapping situations (i.e. no red or blue balls, no red or green balls, and no blue or green balls).</span>
<span id="cb38-130"><a href="#cb38-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-131"><a href="#cb38-131" aria-hidden="true" tabindex="-1"></a>To do this, we can use *n*-choose-*k* notation from combinatorics to represent the number of choices from a pool of possible combinations. This notation looks like this:</span>
<span id="cb38-132"><a href="#cb38-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-133"><a href="#cb38-133" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-134"><a href="#cb38-134" aria-hidden="true" tabindex="-1"></a>\dbinom{n}{k} = \frac{n!}{k! (n-k)!}</span>
<span id="cb38-135"><a href="#cb38-135" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-136"><a href="#cb38-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-137"><a href="#cb38-137" aria-hidden="true" tabindex="-1"></a>If we're selecting 5 balls from a pool of 40, we can say "40 choose 5", or $\binom{40}{5}$. To calculate that, we get this gross mess:</span>
<span id="cb38-138"><a href="#cb38-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-139"><a href="#cb38-139" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-140"><a href="#cb38-140" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb38-141"><a href="#cb38-141" aria-hidden="true" tabindex="-1"></a>\dbinom{40}{5} &amp;= \frac{40!}{5! (40-5)!} <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb38-142"><a href="#cb38-142" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{40!}{5!\ 35!} <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb38-143"><a href="#cb38-143" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{40 \times 39 \times 38 \times 37 \times 36}{5!} \qquad \text{(cancel out the 35!)} <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb38-144"><a href="#cb38-144" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{78,960,960}{120} <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb38-145"><a href="#cb38-145" aria-hidden="true" tabindex="-1"></a>&amp;= 658,008</span>
<span id="cb38-146"><a href="#cb38-146" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb38-147"><a href="#cb38-147" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-148"><a href="#cb38-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-149"><a href="#cb38-149" aria-hidden="true" tabindex="-1"></a>Or we can do it with R:</span>
<span id="cb38-150"><a href="#cb38-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-153"><a href="#cb38-153" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-154"><a href="#cb38-154" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: example-choose</span></span>
<span id="cb38-155"><a href="#cb38-155" aria-hidden="true" tabindex="-1"></a><span class="fu">choose</span>(<span class="dv">40</span>, <span class="dv">5</span>)</span>
<span id="cb38-156"><a href="#cb38-156" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-157"><a href="#cb38-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-158"><a href="#cb38-158" aria-hidden="true" tabindex="-1"></a>So with this binomial choose notation, we can calculate the official formal probability of drawing at least one red, blue, and green ball from this urn:</span>
<span id="cb38-159"><a href="#cb38-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-160"><a href="#cb38-160" aria-hidden="true" tabindex="-1"></a>::: {.column-screen-inset}</span>
<span id="cb38-161"><a href="#cb38-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-162"><a href="#cb38-162" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-163"><a href="#cb38-163" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb38-164"><a href="#cb38-164" aria-hidden="true" tabindex="-1"></a>\text{Pr}(\text{at least one red, blue, and green}) &amp;= 1 - \frac{\text{Ways to get no red or no blue or no green}}{\text{Ways to get 5 balls from 40}} <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb38-165"><a href="#cb38-165" aria-hidden="true" tabindex="-1"></a>&amp;= 1 - \dfrac{</span>
<span id="cb38-166"><a href="#cb38-166" aria-hidden="true" tabindex="-1"></a>    \begin{array}{@{}c@{}}</span>
<span id="cb38-167"><a href="#cb38-167" aria-hidden="true" tabindex="-1"></a>        (\text{Ways to get no red}) + (\text{Ways to get no blue}) + (\text{Ways to get no green}) - <span class="sc">\\</span></span>
<span id="cb38-168"><a href="#cb38-168" aria-hidden="true" tabindex="-1"></a>        (\text{Ways to get no red or blue}) - (\text{Ways to get no red or green}) - (\text{Ways to get no blue or green})</span>
<span id="cb38-169"><a href="#cb38-169" aria-hidden="true" tabindex="-1"></a>    \end{array}</span>
<span id="cb38-170"><a href="#cb38-170" aria-hidden="true" tabindex="-1"></a>  }{\text{Ways to get 5 balls from 40}} <span class="sc">\\</span><span class="co">[</span><span class="ot">10pt</span><span class="co">]</span></span>
<span id="cb38-171"><a href="#cb38-171" aria-hidden="true" tabindex="-1"></a>&amp;= 1 - \dfrac{</span>
<span id="cb38-172"><a href="#cb38-172" aria-hidden="true" tabindex="-1"></a>    \dbinom{30}{5} + \dbinom{30}{5} + \dbinom{20}{5} - \dbinom{20}{5} - \dbinom{10}{5} - \dbinom{10}{5}</span>
<span id="cb38-173"><a href="#cb38-173" aria-hidden="true" tabindex="-1"></a>  }{</span>
<span id="cb38-174"><a href="#cb38-174" aria-hidden="true" tabindex="-1"></a>    \dbinom{40}{5}</span>
<span id="cb38-175"><a href="#cb38-175" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-176"><a href="#cb38-176" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb38-177"><a href="#cb38-177" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-178"><a href="#cb38-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-179"><a href="#cb38-179" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb38-180"><a href="#cb38-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-181"><a href="#cb38-181" aria-hidden="true" tabindex="-1"></a>If we *really* really wanted, we could then calculate all of that by hand, but ew.</span>
<span id="cb38-182"><a href="#cb38-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-183"><a href="#cb38-183" aria-hidden="true" tabindex="-1"></a>We can just use R instead:</span>
<span id="cb38-184"><a href="#cb38-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-187"><a href="#cb38-187" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-188"><a href="#cb38-188" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: full-probability-math-r</span></span>
<span id="cb38-189"><a href="#cb38-189" aria-hidden="true" tabindex="-1"></a><span class="co"># Ways to draw 5 balls without getting a specific color</span></span>
<span id="cb38-190"><a href="#cb38-190" aria-hidden="true" tabindex="-1"></a>no_red <span class="ot">&lt;-</span> <span class="fu">choose</span>(<span class="dv">30</span>, <span class="dv">5</span>)</span>
<span id="cb38-191"><a href="#cb38-191" aria-hidden="true" tabindex="-1"></a>no_blue <span class="ot">&lt;-</span> <span class="fu">choose</span>(<span class="dv">30</span>, <span class="dv">5</span>)</span>
<span id="cb38-192"><a href="#cb38-192" aria-hidden="true" tabindex="-1"></a>no_green <span class="ot">&lt;-</span> <span class="fu">choose</span>(<span class="dv">20</span>, <span class="dv">5</span>)</span>
<span id="cb38-193"><a href="#cb38-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-194"><a href="#cb38-194" aria-hidden="true" tabindex="-1"></a><span class="co"># Ways to draw 5 balls without getting two specific colors</span></span>
<span id="cb38-195"><a href="#cb38-195" aria-hidden="true" tabindex="-1"></a>no_red_blue <span class="ot">&lt;-</span> <span class="fu">choose</span>(<span class="dv">20</span>, <span class="dv">5</span>)</span>
<span id="cb38-196"><a href="#cb38-196" aria-hidden="true" tabindex="-1"></a>no_red_green <span class="ot">&lt;-</span> <span class="fu">choose</span>(<span class="dv">10</span>, <span class="dv">5</span>)</span>
<span id="cb38-197"><a href="#cb38-197" aria-hidden="true" tabindex="-1"></a>no_blue_green <span class="ot">&lt;-</span> <span class="fu">choose</span>(<span class="dv">10</span>, <span class="dv">5</span>)</span>
<span id="cb38-198"><a href="#cb38-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-199"><a href="#cb38-199" aria-hidden="true" tabindex="-1"></a><span class="co"># Ways to draw 5 balls in general</span></span>
<span id="cb38-200"><a href="#cb38-200" aria-hidden="true" tabindex="-1"></a>total_ways <span class="ot">&lt;-</span> <span class="fu">choose</span>(<span class="dv">40</span>, <span class="dv">5</span>)</span>
<span id="cb38-201"><a href="#cb38-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-202"><a href="#cb38-202" aria-hidden="true" tabindex="-1"></a><span class="co"># Probability of drawing at least 1 of each color</span></span>
<span id="cb38-203"><a href="#cb38-203" aria-hidden="true" tabindex="-1"></a>prob_real <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (no_red <span class="sc">+</span> no_blue <span class="sc">+</span> no_green <span class="sc">-</span> no_red_blue <span class="sc">-</span> no_red_green <span class="sc">-</span> no_blue_green) <span class="sc">/</span> total_ways</span>
<span id="cb38-204"><a href="#cb38-204" aria-hidden="true" tabindex="-1"></a>prob_real</span>
<span id="cb38-205"><a href="#cb38-205" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-206"><a href="#cb38-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-207"><a href="#cb38-207" aria-hidden="true" tabindex="-1"></a>Great. There's a <span class="in">`r scales::label_percent(accuracy = 0.01)(prob_real)`</span> chance of drawing at least one of each color. We have an answer, but this was really hard, and I could only do it because I dug up my old problem sets from 2012.</span>
<span id="cb38-208"><a href="#cb38-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-209"><a href="#cb38-209" aria-hidden="true" tabindex="-1"></a><span class="fu">## yay brute force simulation</span></span>
<span id="cb38-210"><a href="#cb38-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-211"><a href="#cb38-211" aria-hidden="true" tabindex="-1"></a>I really don't like formal probability math. Fortunately there's a way I find a heck of a lot easier to use. Brute force simulation. </span>
<span id="cb38-212"><a href="#cb38-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-213"><a href="#cb38-213" aria-hidden="true" tabindex="-1"></a>Instead of figuring out all these weird *n*-choose-*k* probabilities, we'll use the power of computers to literally draw from a hypothetical urn over and over and over again until we come to the right answer.</span>
<span id="cb38-214"><a href="#cb38-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-215"><a href="#cb38-215" aria-hidden="true" tabindex="-1"></a>Here's one way to do it:^<span class="co">[</span><span class="ot">Again, this is 2012-era R code; nowadays I'd forgo the loop and use something like `purrr::map()` or `sapply()`.</span><span class="co">]</span></span>
<span id="cb38-216"><a href="#cb38-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-219"><a href="#cb38-219" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-220"><a href="#cb38-220" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: simulated-urn</span></span>
<span id="cb38-221"><a href="#cb38-221" aria-hidden="true" tabindex="-1"></a><span class="co"># Make this randomness consistent</span></span>
<span id="cb38-222"><a href="#cb38-222" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb38-223"><a href="#cb38-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-224"><a href="#cb38-224" aria-hidden="true" tabindex="-1"></a><span class="co"># Make an urn with balls in it</span></span>
<span id="cb38-225"><a href="#cb38-225" aria-hidden="true" tabindex="-1"></a>urn <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">'red'</span>, <span class="dv">10</span>), <span class="fu">rep</span>(<span class="st">'blue'</span>, <span class="dv">10</span>), <span class="fu">rep</span>(<span class="st">'green'</span>, <span class="dv">20</span>))</span>
<span id="cb38-226"><a href="#cb38-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-227"><a href="#cb38-227" aria-hidden="true" tabindex="-1"></a><span class="co"># How many times we'll draw from the urn</span></span>
<span id="cb38-228"><a href="#cb38-228" aria-hidden="true" tabindex="-1"></a>simulations <span class="ot">&lt;-</span> <span class="dv">100000</span></span>
<span id="cb38-229"><a href="#cb38-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-230"><a href="#cb38-230" aria-hidden="true" tabindex="-1"></a>count <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb38-231"><a href="#cb38-231" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>simulations) {</span>
<span id="cb38-232"><a href="#cb38-232" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pick 5 balls from the urn</span></span>
<span id="cb38-233"><a href="#cb38-233" aria-hidden="true" tabindex="-1"></a>  draw <span class="ot">&lt;-</span> <span class="fu">sample</span>(urn, <span class="dv">5</span>)</span>
<span id="cb38-234"><a href="#cb38-234" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-235"><a href="#cb38-235" aria-hidden="true" tabindex="-1"></a>  <span class="co"># See if there's a red, blue, and green; if so, record it</span></span>
<span id="cb38-236"><a href="#cb38-236" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">'red'</span> <span class="sc">%in%</span> draw <span class="sc">&amp;&amp;</span> <span class="st">'blue'</span> <span class="sc">%in%</span> draw <span class="sc">&amp;&amp;</span> <span class="st">'green'</span> <span class="sc">%in%</span> draw) {</span>
<span id="cb38-237"><a href="#cb38-237" aria-hidden="true" tabindex="-1"></a>    count <span class="ot">&lt;-</span> count <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb38-238"><a href="#cb38-238" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-239"><a href="#cb38-239" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-240"><a href="#cb38-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-241"><a href="#cb38-241" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the simulated probability</span></span>
<span id="cb38-242"><a href="#cb38-242" aria-hidden="true" tabindex="-1"></a>prob_simulated <span class="ot">&lt;-</span> count <span class="sc">/</span> simulations</span>
<span id="cb38-243"><a href="#cb38-243" aria-hidden="true" tabindex="-1"></a>prob_simulated</span>
<span id="cb38-244"><a href="#cb38-244" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-245"><a href="#cb38-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-246"><a href="#cb38-246" aria-hidden="true" tabindex="-1"></a>Sweet. The simulation spat out <span class="in">`r prob_simulated`</span>, which is shockingly close to <span class="in">`r prob_real`</span>. If we boosted the number of simulations from 100,000 to something even higher,^<span class="co">[</span><span class="ot">Going up to 2,000,000 got me to 0.5676.</span><span class="co">]</span> we'd eventually converge on the true answer.</span>
<span id="cb38-247"><a href="#cb38-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-248"><a href="#cb38-248" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb38-249"><a href="#cb38-249" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;hr class="dinkus"&gt;</span></span>
<span id="cb38-250"><a href="#cb38-250" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-251"><a href="#cb38-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-252"><a href="#cb38-252" aria-hidden="true" tabindex="-1"></a>I use this simulation-based approach to anything mathy as much as I can. Personally, I find it far more intuitive to re-create the data generating process rather than think in set theory and combinatorics. In my program evaluation class, we do an <span class="co">[</span><span class="ot">in-class activity with the dice game Zilch</span><span class="co">](https://evalsp24.classes.andrewheiss.com/resource/zilch.html)</span> where we figure out the probability of scoring something in a given dice roll. Instead of finding real probabilities, we just simulate thousands of dice rolls and mark if something was rolled. We essentially recreate the exact data generating process.</span>
<span id="cb38-253"><a href="#cb38-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-254"><a href="#cb38-254" aria-hidden="true" tabindex="-1"></a>This approach is also the core of modern Bayesian statistics. Calculating complex integrals to find posterior distributions is too hard, so we can use Markov Chain Monte Carlo (MCMC) processes bounce around the plausible space for a posterior distribution until they settle on a stable value.</span>
<span id="cb38-255"><a href="#cb38-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-256"><a href="#cb38-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-257"><a href="#cb38-257" aria-hidden="true" tabindex="-1"></a><span class="fu"># Birthday probabilities</span></span>
<span id="cb38-258"><a href="#cb38-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-259"><a href="#cb38-259" aria-hidden="true" tabindex="-1"></a>A couple days ago, I came across <span class="co">[</span><span class="ot">this post on Bluesky</span><span class="co">](https://bsky.app/profile/karlrohe.bsky.social/post/3krgobe22kt2k)</span>:</span>
<span id="cb38-260"><a href="#cb38-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-261"><a href="#cb38-261" aria-hidden="true" tabindex="-1"></a><span class="al">![Post by Karl Rohe (\@karlrohe.bsky.social)](karl-rohe-skeet.png)</span>{width=80%}</span>
<span id="cb38-262"><a href="#cb38-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-263"><a href="#cb38-263" aria-hidden="true" tabindex="-1"></a>This is neat because it's also the case in my household. We have "birthday season" from May to November, and have a dearth of birthdays from November to May. They're all clustered in half the year. I'd never thought about how unlikely that was.</span>
<span id="cb38-264"><a href="#cb38-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-267"><a href="#cb38-267" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-268"><a href="#cb38-268" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-heiss-birthday-cycle</span></span>
<span id="cb38-269"><a href="#cb38-269" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb38-270"><a href="#cb38-270" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 5</span></span>
<span id="cb38-271"><a href="#cb38-271" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb38-272"><a href="#cb38-272" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: "90%"</span></span>
<span id="cb38-273"><a href="#cb38-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-274"><a href="#cb38-274" aria-hidden="true" tabindex="-1"></a>birthdays_heisses <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb38-275"><a href="#cb38-275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-09-19"</span>),</span>
<span id="cb38-276"><a href="#cb38-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-06-22"</span>),</span>
<span id="cb38-277"><a href="#cb38-277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-07-20"</span>),</span>
<span id="cb38-278"><a href="#cb38-278" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-10-25"</span>),</span>
<span id="cb38-279"><a href="#cb38-279" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-06-03"</span>),</span>
<span id="cb38-280"><a href="#cb38-280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-05-23"</span>),</span>
<span id="cb38-281"><a href="#cb38-281" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-10-14"</span>),</span>
<span id="cb38-282"><a href="#cb38-282" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-11-13"</span>)</span>
<span id="cb38-283"><a href="#cb38-283" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-284"><a href="#cb38-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-285"><a href="#cb38-285" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x =</span> birthdays_heisses) <span class="sc">|&gt;</span> </span>
<span id="cb38-286"><a href="#cb38-286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb38-287"><a href="#cb38-287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb38-288"><a href="#cb38-288" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">calc_date_arc</span>(<span class="fu">min</span>(birthdays_heisses)), <span class="fu">aes</span>(<span class="at">xend =</span> xend),</span>
<span id="cb38-289"><a href="#cb38-289" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">3</span>, <span class="at">color =</span> clrs[<span class="dv">4</span>]</span>
<span id="cb38-290"><a href="#cb38-290" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-291"><a href="#cb38-291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">fill =</span> clrs[<span class="dv">10</span>], <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">pch =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb38-292"><a href="#cb38-292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb38-293"><a href="#cb38-293" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>, </span>
<span id="cb38-294"><a href="#cb38-294" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"All 8 Heiss birthdays</span><span class="sc">\n</span><span class="st">within 6 months!"</span>,</span>
<span id="cb38-295"><a href="#cb38-295" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"Montserrat"</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb38-296"><a href="#cb38-296" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.5</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="dv">0</span>),</span>
<span id="cb38-297"><a href="#cb38-297" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">14</span>, <span class="at">size.unit =</span> <span class="st">"pt"</span></span>
<span id="cb38-298"><a href="#cb38-298" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-299"><a href="#cb38-299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb38-300"><a href="#cb38-300" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">"1 month"</span>, <span class="at">date_labels =</span> <span class="st">"%B"</span>,</span>
<span id="cb38-301"><a href="#cb38-301" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="fu">ymd</span>(<span class="st">"2024-01-01"</span>), <span class="fu">ymd</span>(<span class="st">"2024-12-31"</span>)),</span>
<span id="cb38-302"><a href="#cb38-302" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb38-303"><a href="#cb38-303" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-304"><a href="#cb38-304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))) <span class="sc">+</span></span>
<span id="cb38-305"><a href="#cb38-305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_radial</span>(<span class="at">inner.radius =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb38-306"><a href="#cb38-306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_calendar</span>()</span>
<span id="cb38-307"><a href="#cb38-307" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-308"><a href="#cb38-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-309"><a href="#cb38-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-310"><a href="#cb38-310" aria-hidden="true" tabindex="-1"></a>There's probably some formal probability math that can answer Karl's question precisely, but that's hard. So instead, I decided to figure this out with my old friend—brute force simulation.</span>
<span id="cb38-311"><a href="#cb38-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-312"><a href="#cb38-312" aria-hidden="true" tabindex="-1"></a>The data generating process is a little more complicated than just drawing balls from urns, and the cyclical nature of calendars adds an extra wrinkle to simulating everything, but it's doable (and fun!), so I figured I'd share the details of the simulation process here. And with the recent release of <span class="co">[</span><span class="ot">{ggplot2} 3.5</span><span class="co">](https://www.tidyverse.org/blog/2024/02/ggplot2-3-5-0/)</span> and its <span class="co">[</span><span class="ot">new `coord_radial()`</span><span class="co">](https://www.tidyverse.org/blog/2024/03/ggplot2-3-5-0-coord-radial/)</span> and <span class="co">[</span><span class="ot">legend placement settings</span><span class="co">](https://www.tidyverse.org/blog/2024/02/ggplot2-3-5-0-legends/#placement)</span> and <span class="co">[</span><span class="ot">point-based text sizing</span><span class="co">](https://www.tidyverse.org/blog/2024/02/ggplot2-3-5-0-legends/#placement)</span> and <span class="co">[</span><span class="ot">absolute plot-based positioning</span><span class="co">](https://www.tidyverse.org/blog/2024/02/ggplot2-3-5-0/#ignoring-scales)</span>, I figured I'd make some pretty plots along the way.</span>
<span id="cb38-313"><a href="#cb38-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-314"><a href="#cb38-314" aria-hidden="true" tabindex="-1"></a>Let's load some libraries, make a custom theme, and get started!</span>
<span id="cb38-315"><a href="#cb38-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-316"><a href="#cb38-316" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ref.label="libraries-n-things"}</span></span>
<span id="cb38-317"><a href="#cb38-317" aria-hidden="true" tabindex="-1"></a><span class="in">#| eval: false</span></span>
<span id="cb38-318"><a href="#cb38-318" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-319"><a href="#cb38-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-320"><a href="#cb38-320" aria-hidden="true" tabindex="-1"></a><span class="fu"># Visualizing birthday distributions and spans</span></span>
<span id="cb38-321"><a href="#cb38-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-322"><a href="#cb38-322" aria-hidden="true" tabindex="-1"></a><span class="fu">## All birthdays within 6-month span</span></span>
<span id="cb38-323"><a href="#cb38-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-324"><a href="#cb38-324" aria-hidden="true" tabindex="-1"></a>First, let's work with a hypothetical household with four people in it with birthdays on January 4, March 10, April 28, and May 21. We'll plot these on a radial plot and add a 6-month span starting at the first birthday:</span>
<span id="cb38-325"><a href="#cb38-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-328"><a href="#cb38-328" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-329"><a href="#cb38-329" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-yes-easy</span></span>
<span id="cb38-330"><a href="#cb38-330" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 5</span></span>
<span id="cb38-331"><a href="#cb38-331" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb38-332"><a href="#cb38-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-333"><a href="#cb38-333" aria-hidden="true" tabindex="-1"></a><span class="co"># All these happen within a 6-month span</span></span>
<span id="cb38-334"><a href="#cb38-334" aria-hidden="true" tabindex="-1"></a>birthdays_yes <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb38-335"><a href="#cb38-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-01-04"</span>),</span>
<span id="cb38-336"><a href="#cb38-336" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-03-10"</span>),</span>
<span id="cb38-337"><a href="#cb38-337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-04-28"</span>),</span>
<span id="cb38-338"><a href="#cb38-338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-05-21"</span>)</span>
<span id="cb38-339"><a href="#cb38-339" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-340"><a href="#cb38-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-341"><a href="#cb38-341" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x =</span> birthdays_yes) <span class="sc">|&gt;</span> </span>
<span id="cb38-342"><a href="#cb38-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb38-343"><a href="#cb38-343" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb38-344"><a href="#cb38-344" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">"segment"</span>, </span>
<span id="cb38-345"><a href="#cb38-345" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> birthdays_yes[<span class="dv">1</span>], <span class="at">xend =</span> birthdays_yes[<span class="dv">1</span>] <span class="sc">+</span> <span class="fu">months</span>(<span class="dv">6</span>), <span class="at">y =</span> <span class="st">""</span>,</span>
<span id="cb38-346"><a href="#cb38-346" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">3</span>, <span class="at">color =</span> clrs[<span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb38-347"><a href="#cb38-347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">fill =</span> clrs[<span class="dv">10</span>], <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">pch =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb38-348"><a href="#cb38-348" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb38-349"><a href="#cb38-349" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>, </span>
<span id="cb38-350"><a href="#cb38-350" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Yep"</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb38-351"><a href="#cb38-351" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.5</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="dv">0</span>),</span>
<span id="cb38-352"><a href="#cb38-352" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">14</span>, <span class="at">size.unit =</span> <span class="st">"pt"</span></span>
<span id="cb38-353"><a href="#cb38-353" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-354"><a href="#cb38-354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb38-355"><a href="#cb38-355" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">"1 month"</span>, <span class="at">date_labels =</span> <span class="st">"%B"</span>,</span>
<span id="cb38-356"><a href="#cb38-356" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="fu">ymd</span>(<span class="st">"2024-01-01"</span>), <span class="fu">ymd</span>(<span class="st">"2024-12-31"</span>)),</span>
<span id="cb38-357"><a href="#cb38-357" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb38-358"><a href="#cb38-358" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-359"><a href="#cb38-359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))) <span class="sc">+</span></span>
<span id="cb38-360"><a href="#cb38-360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_radial</span>(<span class="at">inner.radius =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb38-361"><a href="#cb38-361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_calendar</span>()</span>
<span id="cb38-362"><a href="#cb38-362" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-363"><a href="#cb38-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-364"><a href="#cb38-364" aria-hidden="true" tabindex="-1"></a>The four birthdays all fit comfortably within the 6-month span. Neat.</span>
<span id="cb38-365"><a href="#cb38-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-366"><a href="#cb38-366" aria-hidden="true" tabindex="-1"></a><span class="fu">## All birthdays within 6-month span, but tricky</span></span>
<span id="cb38-367"><a href="#cb38-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-368"><a href="#cb38-368" aria-hidden="true" tabindex="-1"></a>Next, let's change the May birthday to December 1. These four birthdays still all fit within a 6-month span, but it's trickier to see because the calendar year resets in the middle. Earlier, we plotted the yellow span with <span class="in">`annotate()`</span>, but if we do that now, it breaks and we get a warning. We can't draw a line segment from December 1 to six months later:</span>
<span id="cb38-369"><a href="#cb38-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-372"><a href="#cb38-372" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-373"><a href="#cb38-373" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-yes-tricky-annotate-no</span></span>
<span id="cb38-374"><a href="#cb38-374" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: true</span></span>
<span id="cb38-375"><a href="#cb38-375" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 5</span></span>
<span id="cb38-376"><a href="#cb38-376" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb38-377"><a href="#cb38-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-378"><a href="#cb38-378" aria-hidden="true" tabindex="-1"></a>birthdays_yes_but_tricky <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb38-379"><a href="#cb38-379" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-01-04"</span>),</span>
<span id="cb38-380"><a href="#cb38-380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-03-10"</span>),</span>
<span id="cb38-381"><a href="#cb38-381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-04-28"</span>),</span>
<span id="cb38-382"><a href="#cb38-382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-12-01"</span>)</span>
<span id="cb38-383"><a href="#cb38-383" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-384"><a href="#cb38-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-385"><a href="#cb38-385" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x =</span> birthdays_yes_but_tricky) <span class="sc">|&gt;</span> </span>
<span id="cb38-386"><a href="#cb38-386" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb38-387"><a href="#cb38-387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb38-388"><a href="#cb38-388" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">"segment"</span>,</span>
<span id="cb38-389"><a href="#cb38-389" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> birthdays_yes_but_tricky[<span class="dv">4</span>],</span>
<span id="cb38-390"><a href="#cb38-390" aria-hidden="true" tabindex="-1"></a>    <span class="at">xend =</span> birthdays_yes_but_tricky[<span class="dv">4</span>] <span class="sc">+</span> <span class="fu">months</span>(<span class="dv">6</span>),</span>
<span id="cb38-391"><a href="#cb38-391" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">""</span>,</span>
<span id="cb38-392"><a href="#cb38-392" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">3</span>, <span class="at">color =</span> clrs[<span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb38-393"><a href="#cb38-393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">fill =</span> clrs[<span class="dv">10</span>], <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">pch =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb38-394"><a href="#cb38-394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb38-395"><a href="#cb38-395" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>, </span>
<span id="cb38-396"><a href="#cb38-396" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Yep</span><span class="sc">\n</span><span class="st">(but broken)"</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb38-397"><a href="#cb38-397" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.5</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="dv">0</span>),</span>
<span id="cb38-398"><a href="#cb38-398" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">14</span>, <span class="at">size.unit =</span> <span class="st">"pt"</span></span>
<span id="cb38-399"><a href="#cb38-399" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-400"><a href="#cb38-400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb38-401"><a href="#cb38-401" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">"1 month"</span>, <span class="at">date_labels =</span> <span class="st">"%B"</span>,</span>
<span id="cb38-402"><a href="#cb38-402" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="fu">ymd</span>(<span class="st">"2024-01-01"</span>), <span class="fu">ymd</span>(<span class="st">"2024-12-31"</span>)),</span>
<span id="cb38-403"><a href="#cb38-403" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb38-404"><a href="#cb38-404" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-405"><a href="#cb38-405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))) <span class="sc">+</span></span>
<span id="cb38-406"><a href="#cb38-406" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_radial</span>(<span class="at">inner.radius =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb38-407"><a href="#cb38-407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_calendar</span>()</span>
<span id="cb38-408"><a href="#cb38-408" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-409"><a href="#cb38-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-410"><a href="#cb38-410" aria-hidden="true" tabindex="-1"></a>Instead, we can draw two line segments—one from December 1 to December 31, and one from January 1 to whatever six months from December 1 is. Since this plot represents all of 2024, we'll force the continued time after January 1 to also be in 2024 (even though it's technically 2025). Here I colored the segments a little differently to highlight the fact that they're two separate lines:</span>
<span id="cb38-411"><a href="#cb38-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-414"><a href="#cb38-414" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-415"><a href="#cb38-415" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-yes-tricky-annotate</span></span>
<span id="cb38-416"><a href="#cb38-416" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 5</span></span>
<span id="cb38-417"><a href="#cb38-417" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb38-418"><a href="#cb38-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-419"><a href="#cb38-419" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x =</span> birthdays_yes_but_tricky) <span class="sc">|&gt;</span> </span>
<span id="cb38-420"><a href="#cb38-420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb38-421"><a href="#cb38-421" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb38-422"><a href="#cb38-422" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">"segment"</span>,</span>
<span id="cb38-423"><a href="#cb38-423" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> birthdays_yes_but_tricky[<span class="dv">4</span>], </span>
<span id="cb38-424"><a href="#cb38-424" aria-hidden="true" tabindex="-1"></a>    <span class="at">xend =</span> <span class="fu">ymd</span>(<span class="st">"2024-12-31"</span>), </span>
<span id="cb38-425"><a href="#cb38-425" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">""</span>,</span>
<span id="cb38-426"><a href="#cb38-426" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">3</span>, <span class="at">color =</span> clrs[<span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb38-427"><a href="#cb38-427" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb38-428"><a href="#cb38-428" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">"segment"</span>,</span>
<span id="cb38-429"><a href="#cb38-429" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">ymd</span>(<span class="st">"2024-01-01"</span>), </span>
<span id="cb38-430"><a href="#cb38-430" aria-hidden="true" tabindex="-1"></a>    <span class="at">xend =</span> (<span class="fu">ymd</span>(<span class="st">"2024-01-01"</span>) <span class="sc">+</span> <span class="fu">months</span>(<span class="dv">6</span>)) <span class="sc">-</span> </span>
<span id="cb38-431"><a href="#cb38-431" aria-hidden="true" tabindex="-1"></a>      (<span class="fu">ymd</span>(<span class="st">"2024-12-31"</span>) <span class="sc">-</span> birthdays_yes_but_tricky[<span class="dv">4</span>]), </span>
<span id="cb38-432"><a href="#cb38-432" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">""</span>,</span>
<span id="cb38-433"><a href="#cb38-433" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">3</span>, <span class="at">color =</span> clrs[<span class="dv">4</span>]) <span class="sc">+</span></span>
<span id="cb38-434"><a href="#cb38-434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">fill =</span> clrs[<span class="dv">10</span>], <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">pch =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb38-435"><a href="#cb38-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb38-436"><a href="#cb38-436" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>, </span>
<span id="cb38-437"><a href="#cb38-437" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Yep</span><span class="sc">\n</span><span class="st">(but tricky)"</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb38-438"><a href="#cb38-438" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.5</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="dv">0</span>),</span>
<span id="cb38-439"><a href="#cb38-439" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">14</span>, <span class="at">size.unit =</span> <span class="st">"pt"</span></span>
<span id="cb38-440"><a href="#cb38-440" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-441"><a href="#cb38-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb38-442"><a href="#cb38-442" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">"1 month"</span>, <span class="at">date_labels =</span> <span class="st">"%B"</span>,</span>
<span id="cb38-443"><a href="#cb38-443" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="fu">ymd</span>(<span class="st">"2024-01-01"</span>), <span class="fu">ymd</span>(<span class="st">"2024-12-31"</span>)),</span>
<span id="cb38-444"><a href="#cb38-444" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb38-445"><a href="#cb38-445" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-446"><a href="#cb38-446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))) <span class="sc">+</span></span>
<span id="cb38-447"><a href="#cb38-447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_radial</span>(<span class="at">inner.radius =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb38-448"><a href="#cb38-448" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_calendar</span>()</span>
<span id="cb38-449"><a href="#cb38-449" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-450"><a href="#cb38-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-451"><a href="#cb38-451" aria-hidden="true" tabindex="-1"></a>Writing two separate <span class="in">`annotate()`</span> layers feels repetitive, though, and it's easy to make mistakes. So instead, we can make a little helper function that will create a data frame with the start and end date of a six-month span. If the span crosses December 31, it returns two spans; if not, it returns one span:</span>
<span id="cb38-452"><a href="#cb38-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-453"><a href="#cb38-453" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ref.label="fun-calc-date-arc"}</span></span>
<span id="cb38-454"><a href="#cb38-454" aria-hidden="true" tabindex="-1"></a><span class="in">#| eval: false</span></span>
<span id="cb38-455"><a href="#cb38-455" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-456"><a href="#cb38-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-457"><a href="#cb38-457" aria-hidden="true" tabindex="-1"></a>Let's make sure it works. Six months from March 15 is September 15, which doesn't cross into a new year, so we get just one start and end date:</span>
<span id="cb38-458"><a href="#cb38-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-461"><a href="#cb38-461" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-462"><a href="#cb38-462" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: test-date-arc1</span></span>
<span id="cb38-463"><a href="#cb38-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-464"><a href="#cb38-464" aria-hidden="true" tabindex="-1"></a><span class="fu">calc_date_arc</span>(<span class="fu">ymd</span>(<span class="st">"2024-03-15"</span>))</span>
<span id="cb38-465"><a href="#cb38-465" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-466"><a href="#cb38-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-467"><a href="#cb38-467" aria-hidden="true" tabindex="-1"></a>Six months from November 15 is sometime in May, which means we *do* cross into a new year. We thus get two spans: (1) a segment from November to the end of December, and (2) a segment from January to May:</span>
<span id="cb38-468"><a href="#cb38-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-471"><a href="#cb38-471" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-472"><a href="#cb38-472" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: test-date-arc2</span></span>
<span id="cb38-473"><a href="#cb38-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-474"><a href="#cb38-474" aria-hidden="true" tabindex="-1"></a><span class="fu">calc_date_arc</span>(<span class="fu">ymd</span>(<span class="st">"2024-11-15"</span>))</span>
<span id="cb38-475"><a href="#cb38-475" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-476"><a href="#cb38-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-477"><a href="#cb38-477" aria-hidden="true" tabindex="-1"></a>Plotting with this function is a lot easier, since it returns a data frame. We don't need to worry about using <span class="in">`annotate()`</span> anymore and can instead map the <span class="in">`x`</span> and <span class="in">`xend`</span> aesthetics from the data to the plot:</span>
<span id="cb38-478"><a href="#cb38-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-481"><a href="#cb38-481" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-482"><a href="#cb38-482" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-yes-tricky-good</span></span>
<span id="cb38-483"><a href="#cb38-483" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 5</span></span>
<span id="cb38-484"><a href="#cb38-484" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb38-485"><a href="#cb38-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-486"><a href="#cb38-486" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x =</span> birthdays_yes_but_tricky) <span class="sc">|&gt;</span> </span>
<span id="cb38-487"><a href="#cb38-487" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb38-488"><a href="#cb38-488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb38-489"><a href="#cb38-489" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">calc_date_arc</span>(birthdays_yes_but_tricky[<span class="dv">4</span>]), <span class="fu">aes</span>(<span class="at">xend =</span> xend),</span>
<span id="cb38-490"><a href="#cb38-490" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">3</span>, <span class="at">color =</span> clrs[<span class="dv">5</span>]</span>
<span id="cb38-491"><a href="#cb38-491" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-492"><a href="#cb38-492" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">fill =</span> clrs[<span class="dv">10</span>], <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">pch =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb38-493"><a href="#cb38-493" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb38-494"><a href="#cb38-494" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>, </span>
<span id="cb38-495"><a href="#cb38-495" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Yep</span><span class="sc">\n</span><span class="st">(but tricky)"</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb38-496"><a href="#cb38-496" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.5</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="dv">0</span>),</span>
<span id="cb38-497"><a href="#cb38-497" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">14</span>, <span class="at">size.unit =</span> <span class="st">"pt"</span></span>
<span id="cb38-498"><a href="#cb38-498" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-499"><a href="#cb38-499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb38-500"><a href="#cb38-500" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">"1 month"</span>, <span class="at">date_labels =</span> <span class="st">"%B"</span>,</span>
<span id="cb38-501"><a href="#cb38-501" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="fu">ymd</span>(<span class="st">"2024-01-01"</span>), <span class="fu">ymd</span>(<span class="st">"2024-12-31"</span>)),</span>
<span id="cb38-502"><a href="#cb38-502" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb38-503"><a href="#cb38-503" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-504"><a href="#cb38-504" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))) <span class="sc">+</span></span>
<span id="cb38-505"><a href="#cb38-505" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_radial</span>(<span class="at">inner.radius =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb38-506"><a href="#cb38-506" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_calendar</span>()</span>
<span id="cb38-507"><a href="#cb38-507" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-508"><a href="#cb38-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-509"><a href="#cb38-509" aria-hidden="true" tabindex="-1"></a><span class="fu">## Some birthdays outside a 6-month span</span></span>
<span id="cb38-510"><a href="#cb38-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-511"><a href="#cb38-511" aria-hidden="true" tabindex="-1"></a>Let's change the set of birthdays again so that one of them falls outside the six-month window. Regardless of where we start the span, we can't collect all the points within a continuous six-month period:</span>
<span id="cb38-512"><a href="#cb38-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-515"><a href="#cb38-515" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-516"><a href="#cb38-516" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-no</span></span>
<span id="cb38-517"><a href="#cb38-517" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 10</span></span>
<span id="cb38-518"><a href="#cb38-518" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb38-519"><a href="#cb38-519" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: "center"</span></span>
<span id="cb38-520"><a href="#cb38-520" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: screen-inset</span></span>
<span id="cb38-521"><a href="#cb38-521" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: "100%"</span></span>
<span id="cb38-522"><a href="#cb38-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-523"><a href="#cb38-523" aria-hidden="true" tabindex="-1"></a>birthdays_no <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb38-524"><a href="#cb38-524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-01-04"</span>),</span>
<span id="cb38-525"><a href="#cb38-525" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-03-10"</span>),</span>
<span id="cb38-526"><a href="#cb38-526" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-04-28"</span>),</span>
<span id="cb38-527"><a href="#cb38-527" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-09-21"</span>)</span>
<span id="cb38-528"><a href="#cb38-528" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-529"><a href="#cb38-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-530"><a href="#cb38-530" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> birthdays_no) <span class="sc">|&gt;</span> </span>
<span id="cb38-531"><a href="#cb38-531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb38-532"><a href="#cb38-532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb38-533"><a href="#cb38-533" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">calc_date_arc</span>(birthdays_no[<span class="dv">1</span>]), <span class="fu">aes</span>(<span class="at">xend =</span> xend),</span>
<span id="cb38-534"><a href="#cb38-534" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">3</span>, <span class="at">color =</span> clrs[<span class="dv">3</span>]</span>
<span id="cb38-535"><a href="#cb38-535" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-536"><a href="#cb38-536" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">fill =</span> clrs[<span class="dv">10</span>], <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">pch =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb38-537"><a href="#cb38-537" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb38-538"><a href="#cb38-538" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>, </span>
<span id="cb38-539"><a href="#cb38-539" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Nope"</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb38-540"><a href="#cb38-540" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.5</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="dv">0</span>),</span>
<span id="cb38-541"><a href="#cb38-541" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">14</span>, <span class="at">size.unit =</span> <span class="st">"pt"</span></span>
<span id="cb38-542"><a href="#cb38-542" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-543"><a href="#cb38-543" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb38-544"><a href="#cb38-544" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">"1 month"</span>, <span class="at">date_labels =</span> <span class="st">"%B"</span>,</span>
<span id="cb38-545"><a href="#cb38-545" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="fu">ymd</span>(<span class="st">"2024-01-01"</span>), <span class="fu">ymd</span>(<span class="st">"2024-12-31"</span>)),</span>
<span id="cb38-546"><a href="#cb38-546" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb38-547"><a href="#cb38-547" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-548"><a href="#cb38-548" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))) <span class="sc">+</span></span>
<span id="cb38-549"><a href="#cb38-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_radial</span>(<span class="at">inner.radius =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb38-550"><a href="#cb38-550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_calendar</span>()</span>
<span id="cb38-551"><a href="#cb38-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-552"><a href="#cb38-552" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> birthdays_no) <span class="sc">|&gt;</span> </span>
<span id="cb38-553"><a href="#cb38-553" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb38-554"><a href="#cb38-554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb38-555"><a href="#cb38-555" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">calc_date_arc</span>(birthdays_no[<span class="dv">4</span>]), <span class="fu">aes</span>(<span class="at">xend =</span> xend),</span>
<span id="cb38-556"><a href="#cb38-556" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">3</span>, <span class="at">color =</span> clrs[<span class="dv">3</span>]</span>
<span id="cb38-557"><a href="#cb38-557" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-558"><a href="#cb38-558" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">fill =</span> clrs[<span class="dv">10</span>], <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">pch =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb38-559"><a href="#cb38-559" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb38-560"><a href="#cb38-560" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>, </span>
<span id="cb38-561"><a href="#cb38-561" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Still nope"</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb38-562"><a href="#cb38-562" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.5</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="dv">0</span>),</span>
<span id="cb38-563"><a href="#cb38-563" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">14</span>, <span class="at">size.unit =</span> <span class="st">"pt"</span></span>
<span id="cb38-564"><a href="#cb38-564" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-565"><a href="#cb38-565" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb38-566"><a href="#cb38-566" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">"1 month"</span>, <span class="at">date_labels =</span> <span class="st">"%B"</span>,</span>
<span id="cb38-567"><a href="#cb38-567" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="fu">ymd</span>(<span class="st">"2024-01-01"</span>), <span class="fu">ymd</span>(<span class="st">"2024-12-31"</span>)),</span>
<span id="cb38-568"><a href="#cb38-568" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb38-569"><a href="#cb38-569" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-570"><a href="#cb38-570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))) <span class="sc">+</span></span>
<span id="cb38-571"><a href="#cb38-571" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_radial</span>(<span class="at">inner.radius =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb38-572"><a href="#cb38-572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_calendar</span>()</span>
<span id="cb38-573"><a href="#cb38-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-574"><a href="#cb38-574" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">|</span> <span class="fu">plot_spacer</span>() <span class="sc">|</span> p2) <span class="sc">+</span> </span>
<span id="cb38-575"><a href="#cb38-575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">widths =</span> <span class="fu">c</span>(<span class="fl">0.45</span>, <span class="fl">0.1</span>, <span class="fl">0.45</span>))</span>
<span id="cb38-576"><a href="#cb38-576" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-577"><a href="#cb38-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-578"><a href="#cb38-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-579"><a href="#cb38-579" aria-hidden="true" tabindex="-1"></a><span class="fu"># Simulation time!</span></span>
<span id="cb38-580"><a href="#cb38-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-581"><a href="#cb38-581" aria-hidden="true" tabindex="-1"></a>So far, we've been working with a hypothetical household of 4, with arbitrarily chosen birthdays. For the simulation, we'll need to work with randomly selected birthdays for households of varying sizes.</span>
<span id="cb38-582"><a href="#cb38-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-583"><a href="#cb38-583" aria-hidden="true" tabindex="-1"></a><span class="fu">## Counting simulated birthdays and measuring spans</span></span>
<span id="cb38-584"><a href="#cb38-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-585"><a href="#cb38-585" aria-hidden="true" tabindex="-1"></a>But before we build the full simulation, we need to build a way to programmatically detect if a set of dates fit within a six-month span, which—as we saw with the plotting—is surprisingly tricky because of the possible change in year.</span>
<span id="cb38-586"><a href="#cb38-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-587"><a href="#cb38-587" aria-hidden="true" tabindex="-1"></a>If we didn't need to contend with a change in year, we could convert all the birthdays to their corresponding day of the year, sort them, find the difference between the first and the last, and see if it's less than 183 days (366/2; we're working with a leap year). This would work great:</span>
<span id="cb38-588"><a href="#cb38-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-591"><a href="#cb38-591" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-592"><a href="#cb38-592" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-diff-yes</span></span>
<span id="cb38-593"><a href="#cb38-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-594"><a href="#cb38-594" aria-hidden="true" tabindex="-1"></a>birthdays_yes <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb38-595"><a href="#cb38-595" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-01-04"</span>),</span>
<span id="cb38-596"><a href="#cb38-596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-03-10"</span>),</span>
<span id="cb38-597"><a href="#cb38-597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-04-28"</span>),</span>
<span id="cb38-598"><a href="#cb38-598" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-05-21"</span>)</span>
<span id="cb38-599"><a href="#cb38-599" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-600"><a href="#cb38-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-601"><a href="#cb38-601" aria-hidden="true" tabindex="-1"></a>birthdays_sorted <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">yday</span>(birthdays_yes))</span>
<span id="cb38-602"><a href="#cb38-602" aria-hidden="true" tabindex="-1"></a>birthdays_sorted</span>
<span id="cb38-603"><a href="#cb38-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-604"><a href="#cb38-604" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(birthdays_sorted) <span class="sc">-</span> <span class="fu">min</span>(birthdays_sorted)</span>
<span id="cb38-605"><a href="#cb38-605" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-606"><a href="#cb38-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-607"><a href="#cb38-607" aria-hidden="true" tabindex="-1"></a>But time is a circle. If we look at a set of birthdays that crosses a new year, we can't just look at <span class="in">`max - min`</span>. Also, there's no guarantee that the six-month span will go from the first to the last; it could go from the last to the first.</span>
<span id="cb38-608"><a href="#cb38-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-611"><a href="#cb38-611" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-612"><a href="#cb38-612" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-diff-yes-tricky-wrong</span></span>
<span id="cb38-613"><a href="#cb38-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-614"><a href="#cb38-614" aria-hidden="true" tabindex="-1"></a>birthdays_yes_but_tricky <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb38-615"><a href="#cb38-615" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-01-04"</span>),</span>
<span id="cb38-616"><a href="#cb38-616" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-03-10"</span>),</span>
<span id="cb38-617"><a href="#cb38-617" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-04-28"</span>),</span>
<span id="cb38-618"><a href="#cb38-618" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-12-01"</span>)</span>
<span id="cb38-619"><a href="#cb38-619" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-620"><a href="#cb38-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-621"><a href="#cb38-621" aria-hidden="true" tabindex="-1"></a>birthdays_sorted <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">yday</span>(birthdays_yes_but_tricky))</span>
<span id="cb38-622"><a href="#cb38-622" aria-hidden="true" tabindex="-1"></a>birthdays_sorted</span>
<span id="cb38-623"><a href="#cb38-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-624"><a href="#cb38-624" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(birthdays_sorted) <span class="sc">-</span> <span class="fu">min</span>(birthdays_sorted)</span>
<span id="cb38-625"><a href="#cb38-625" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-626"><a href="#cb38-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-627"><a href="#cb38-627" aria-hidden="true" tabindex="-1"></a>So we need to do something a little trickier to account for the year looping over. There are several potential ways to do this, and there's no one right way. Here's the approach I settled on.</span>
<span id="cb38-628"><a href="#cb38-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-629"><a href="#cb38-629" aria-hidden="true" tabindex="-1"></a>We need to check the span between each possible window of dates. In a household of 4, this means finding the distance between the 4th (or last) date and the 1st date, which we did with <span class="in">`max - min`</span>. But we also need to check on the distance between the 1st date in the next cycle (i.e. 2025) and the 2nd date (in 2024), and so on, or this:</span>
<span id="cb38-630"><a href="#cb38-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-631"><a href="#cb38-631" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Distance between 4th and 1st: </span>
<span id="cb38-632"><a href="#cb38-632" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="in">`ymd("2024-12-01") - ymd("2024-01-04")`</span> or <span class="in">`r ymd("2024-12-01") - ymd("2024-01-04")`</span> days</span>
<span id="cb38-633"><a href="#cb38-633" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Distance between (1st + 1 year) and 2nd: </span>
<span id="cb38-634"><a href="#cb38-634" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="in">`ymd("2025-01-04") - ymd("2024-03-10")`</span> or <span class="in">`r ymd("2025-01-04") - ymd("2024-03-10")`</span> days</span>
<span id="cb38-635"><a href="#cb38-635" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Distance between (2nd + 1 year) and 3rd: </span>
<span id="cb38-636"><a href="#cb38-636" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="in">`ymd("2025-03-10") - ymd("2024-04-28")`</span> or <span class="in">`r ymd("2025-03-10") - ymd("2024-04-28")`</span> days</span>
<span id="cb38-637"><a href="#cb38-637" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Distance between (3rd + 1 year) and 4th: </span>
<span id="cb38-638"><a href="#cb38-638" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span><span class="in">`ymd("2025-04-28") - ymd("2024-12-01")`</span> or <span class="in">`r ymd("2025-04-28") - ymd("2024-12-01")`</span> days</span>
<span id="cb38-639"><a href="#cb38-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-640"><a href="#cb38-640" aria-hidden="true" tabindex="-1"></a>That last one, from December 1 to April 28, is less than 180 days, which means that the dates fit within a six-month span. We saw this in the plot earlier too—if we start the span in December, it more than covers the remaining birthdays.</span>
<span id="cb38-641"><a href="#cb38-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-642"><a href="#cb38-642" aria-hidden="true" tabindex="-1"></a>One easy way to look at dates in the next year is to double up the vector of birthday days-of-the-year, adding 366 to the first set, like this:</span>
<span id="cb38-643"><a href="#cb38-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-646"><a href="#cb38-646" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-647"><a href="#cb38-647" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: show-doubled</span></span>
<span id="cb38-648"><a href="#cb38-648" aria-hidden="true" tabindex="-1"></a>birthdays_doubled <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb38-649"><a href="#cb38-649" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="fu">yday</span>(birthdays_yes_but_tricky)), </span>
<span id="cb38-650"><a href="#cb38-650" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="fu">yday</span>(birthdays_yes_but_tricky)) <span class="sc">+</span> <span class="dv">366</span></span>
<span id="cb38-651"><a href="#cb38-651" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-652"><a href="#cb38-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-653"><a href="#cb38-653" aria-hidden="true" tabindex="-1"></a>birthdays_doubled</span>
<span id="cb38-654"><a href="#cb38-654" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-655"><a href="#cb38-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-656"><a href="#cb38-656" aria-hidden="true" tabindex="-1"></a>The first four represent the regular real birthdays; the next four are the same values, just shifted up a year (so 4 and 370 are both January 1, etc.)</span>
<span id="cb38-657"><a href="#cb38-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-658"><a href="#cb38-658" aria-hidden="true" tabindex="-1"></a>With this vector, we can now find differences between dates that cross years more easily:^<span class="co">[</span><span class="ot">Some of these differences aren't the same as before (317 instead of 361; 149 instead of 148). This is because 2024 is a leap year and 2025 is not, and {lubridate} accounts for that. By adding 366, we're pretending 2025 is also a leap year. But that's okay, because we want to pretend that February 29 happens each year.</span><span class="co">]</span></span>
<span id="cb38-659"><a href="#cb38-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-662"><a href="#cb38-662" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-663"><a href="#cb38-663" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: doubled-diffs-manual</span></span>
<span id="cb38-664"><a href="#cb38-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-665"><a href="#cb38-665" aria-hidden="true" tabindex="-1"></a>birthdays_doubled[<span class="dv">4</span>] <span class="sc">-</span> birthdays_doubled[<span class="dv">1</span>]</span>
<span id="cb38-666"><a href="#cb38-666" aria-hidden="true" tabindex="-1"></a>birthdays_doubled[<span class="dv">5</span>] <span class="sc">-</span> birthdays_doubled[<span class="dv">2</span>]</span>
<span id="cb38-667"><a href="#cb38-667" aria-hidden="true" tabindex="-1"></a>birthdays_doubled[<span class="dv">6</span>] <span class="sc">-</span> birthdays_doubled[<span class="dv">3</span>]</span>
<span id="cb38-668"><a href="#cb38-668" aria-hidden="true" tabindex="-1"></a>birthdays_doubled[<span class="dv">7</span>] <span class="sc">-</span> birthdays_doubled[<span class="dv">4</span>]</span>
<span id="cb38-669"><a href="#cb38-669" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-670"><a href="#cb38-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-671"><a href="#cb38-671" aria-hidden="true" tabindex="-1"></a>Or instead of repeating lots of lines like that, we can auto-increment the different indices:</span>
<span id="cb38-672"><a href="#cb38-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-675"><a href="#cb38-675" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-676"><a href="#cb38-676" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: doubled-diffs-automatic</span></span>
<span id="cb38-677"><a href="#cb38-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-678"><a href="#cb38-678" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(birthdays_yes_but_tricky)</span>
<span id="cb38-679"><a href="#cb38-679" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="sc">~</span> birthdays_doubled[.x <span class="sc">+</span> n <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">-</span> birthdays_doubled[.x])</span>
<span id="cb38-680"><a href="#cb38-680" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-681"><a href="#cb38-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-682"><a href="#cb38-682" aria-hidden="true" tabindex="-1"></a>If any of those values are less than 183, the birthdays fit in a six-month span:</span>
<span id="cb38-683"><a href="#cb38-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-686"><a href="#cb38-686" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-687"><a href="#cb38-687" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: double-diffs-automatic-any</span></span>
<span id="cb38-688"><a href="#cb38-688" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">map_lgl</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="sc">~</span> birthdays_doubled[.x <span class="sc">+</span> n <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">-</span> birthdays_doubled[.x] <span class="sc">&lt;=</span> <span class="dv">183</span>))</span>
<span id="cb38-689"><a href="#cb38-689" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-690"><a href="#cb38-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-691"><a href="#cb38-691" aria-hidden="true" tabindex="-1"></a>Let's check it with the other two test sets of birthdays. Here's the easy set of birthdays without any cross-year loops:</span>
<span id="cb38-692"><a href="#cb38-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-695"><a href="#cb38-695" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-696"><a href="#cb38-696" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-diffs-yes-real</span></span>
<span id="cb38-697"><a href="#cb38-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-698"><a href="#cb38-698" aria-hidden="true" tabindex="-1"></a>birthdays_yes <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb38-699"><a href="#cb38-699" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-01-04"</span>),</span>
<span id="cb38-700"><a href="#cb38-700" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-03-10"</span>),</span>
<span id="cb38-701"><a href="#cb38-701" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-04-28"</span>),</span>
<span id="cb38-702"><a href="#cb38-702" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-05-21"</span>)</span>
<span id="cb38-703"><a href="#cb38-703" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-704"><a href="#cb38-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-705"><a href="#cb38-705" aria-hidden="true" tabindex="-1"></a>birthdays_doubled <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb38-706"><a href="#cb38-706" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="fu">yday</span>(birthdays_yes)), </span>
<span id="cb38-707"><a href="#cb38-707" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="fu">yday</span>(birthdays_yes)) <span class="sc">+</span> <span class="dv">366</span></span>
<span id="cb38-708"><a href="#cb38-708" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-709"><a href="#cb38-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-710"><a href="#cb38-710" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="sc">~</span> birthdays_doubled[.x <span class="sc">+</span> n <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">-</span> birthdays_doubled[.x])</span>
<span id="cb38-711"><a href="#cb38-711" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">map_lgl</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="sc">~</span> birthdays_doubled[.x <span class="sc">+</span> n <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">-</span> birthdays_doubled[.x] <span class="sc">&lt;=</span> <span class="dv">183</span>))</span>
<span id="cb38-712"><a href="#cb38-712" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-713"><a href="#cb38-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-714"><a href="#cb38-714" aria-hidden="true" tabindex="-1"></a>And here's the set we know doesn't fit:</span>
<span id="cb38-715"><a href="#cb38-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-718"><a href="#cb38-718" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-719"><a href="#cb38-719" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-diffs-no-real</span></span>
<span id="cb38-720"><a href="#cb38-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-721"><a href="#cb38-721" aria-hidden="true" tabindex="-1"></a>birthdays_no <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb38-722"><a href="#cb38-722" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-01-04"</span>),</span>
<span id="cb38-723"><a href="#cb38-723" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-03-10"</span>),</span>
<span id="cb38-724"><a href="#cb38-724" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-04-28"</span>),</span>
<span id="cb38-725"><a href="#cb38-725" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ymd</span>(<span class="st">"2024-09-21"</span>)</span>
<span id="cb38-726"><a href="#cb38-726" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-727"><a href="#cb38-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-728"><a href="#cb38-728" aria-hidden="true" tabindex="-1"></a>birthdays_doubled <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb38-729"><a href="#cb38-729" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="fu">yday</span>(birthdays_no)), </span>
<span id="cb38-730"><a href="#cb38-730" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="fu">yday</span>(birthdays_no)) <span class="sc">+</span> <span class="dv">366</span></span>
<span id="cb38-731"><a href="#cb38-731" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-732"><a href="#cb38-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-733"><a href="#cb38-733" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="sc">~</span> birthdays_doubled[.x <span class="sc">+</span> n <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">-</span> birthdays_doubled[.x])</span>
<span id="cb38-734"><a href="#cb38-734" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">map_lgl</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="sc">~</span> birthdays_doubled[.x <span class="sc">+</span> n <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">-</span> birthdays_doubled[.x] <span class="sc">&lt;=</span> <span class="dv">183</span>))</span>
<span id="cb38-735"><a href="#cb38-735" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-736"><a href="#cb38-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-737"><a href="#cb38-737" aria-hidden="true" tabindex="-1"></a>It works!</span>
<span id="cb38-738"><a href="#cb38-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-739"><a href="#cb38-739" aria-hidden="true" tabindex="-1"></a><span class="fu">## Actual simulation</span></span>
<span id="cb38-740"><a href="#cb38-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-741"><a href="#cb38-741" aria-hidden="true" tabindex="-1"></a>Now that we have the ability to check if any set of dates fits within six months, we can generalize this to any household size. To make life a little easier, we'll stop working with days of the year for. Leap years are tricky, and the results changed a little bit above if we added 366 or 365 to the repeated years. So instead, we'll think about 360° in a circle—circles don't suddenly have 361° every four years or anything weird like that.</span>
<span id="cb38-742"><a href="#cb38-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-743"><a href="#cb38-743" aria-hidden="true" tabindex="-1"></a>In this simulation, we'll generate <span class="in">`n`</span> random numbers between 0 and 360 (where <span class="in">`n`</span> is the household size we're interested in). We'll then do the doubling and sorting thing and check to see if the distance between any of the 4-number spans is less than 180.</span>
<span id="cb38-744"><a href="#cb38-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-747"><a href="#cb38-747" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-748"><a href="#cb38-748" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fun-simulate-prob</span></span>
<span id="cb38-749"><a href="#cb38-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-750"><a href="#cb38-750" aria-hidden="true" tabindex="-1"></a>simulate_prob <span class="ot">&lt;-</span> <span class="cf">function</span>(n, <span class="at">num_simulations =</span> <span class="dv">1000</span>) {</span>
<span id="cb38-751"><a href="#cb38-751" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">map_lgl</span>(<span class="dv">1</span><span class="sc">:</span>num_simulations, <span class="sc">~</span>{</span>
<span id="cb38-752"><a href="#cb38-752" aria-hidden="true" tabindex="-1"></a>    birthdays <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">0</span>, <span class="dv">360</span>)</span>
<span id="cb38-753"><a href="#cb38-753" aria-hidden="true" tabindex="-1"></a>    birthdays_doubled <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">c</span>(birthdays, birthdays <span class="sc">+</span> <span class="dv">360</span>))</span>
<span id="cb38-754"><a href="#cb38-754" aria-hidden="true" tabindex="-1"></a>    <span class="fu">any</span>(<span class="fu">map_lgl</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="sc">~</span> birthdays_doubled[.x <span class="sc">+</span> n <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">-</span> birthdays_doubled[.x] <span class="sc">&lt;=</span> <span class="dv">180</span>))</span>
<span id="cb38-755"><a href="#cb38-755" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb38-756"><a href="#cb38-756" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(results)</span>
<span id="cb38-757"><a href="#cb38-757" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-758"><a href="#cb38-758" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-759"><a href="#cb38-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-760"><a href="#cb38-760" aria-hidden="true" tabindex="-1"></a>Here's the probability of seeing all the birthdays in a six-month span in a household of 4:</span>
<span id="cb38-761"><a href="#cb38-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-764"><a href="#cb38-764" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-765"><a href="#cb38-765" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: simulate-4</span></span>
<span id="cb38-766"><a href="#cb38-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-767"><a href="#cb38-767" aria-hidden="true" tabindex="-1"></a>withr<span class="sc">::</span><span class="fu">with_seed</span>(<span class="dv">1234</span>, {</span>
<span id="cb38-768"><a href="#cb38-768" aria-hidden="true" tabindex="-1"></a>  <span class="fu">simulate_prob</span>(<span class="dv">4</span>)</span>
<span id="cb38-769"><a href="#cb38-769" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb38-770"><a href="#cb38-770" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-771"><a href="#cb38-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-772"><a href="#cb38-772" aria-hidden="true" tabindex="-1"></a>About 50%!</span>
<span id="cb38-773"><a href="#cb38-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-774"><a href="#cb38-774" aria-hidden="true" tabindex="-1"></a>What about a household of 6, like in Karl's original post?</span>
<span id="cb38-775"><a href="#cb38-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-778"><a href="#cb38-778" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-779"><a href="#cb38-779" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: simulate-6</span></span>
<span id="cb38-780"><a href="#cb38-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-781"><a href="#cb38-781" aria-hidden="true" tabindex="-1"></a>withr<span class="sc">::</span><span class="fu">with_seed</span>(<span class="dv">1234</span>, {</span>
<span id="cb38-782"><a href="#cb38-782" aria-hidden="true" tabindex="-1"></a>  <span class="fu">simulate_prob</span>(<span class="dv">6</span>)</span>
<span id="cb38-783"><a href="#cb38-783" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb38-784"><a href="#cb38-784" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-785"><a href="#cb38-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-786"><a href="#cb38-786" aria-hidden="true" tabindex="-1"></a>About 18%!</span>
<span id="cb38-787"><a href="#cb38-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-788"><a href="#cb38-788" aria-hidden="true" tabindex="-1"></a>We can get this more precise and consistent by boosting the number of simulations:</span>
<span id="cb38-789"><a href="#cb38-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-792"><a href="#cb38-792" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-793"><a href="#cb38-793" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: simulate-6-lots</span></span>
<span id="cb38-794"><a href="#cb38-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-795"><a href="#cb38-795" aria-hidden="true" tabindex="-1"></a>withr<span class="sc">::</span><span class="fu">with_seed</span>(<span class="dv">1234</span>, {</span>
<span id="cb38-796"><a href="#cb38-796" aria-hidden="true" tabindex="-1"></a>  <span class="fu">simulate_prob</span>(<span class="dv">6</span>, <span class="dv">50000</span>)</span>
<span id="cb38-797"><a href="#cb38-797" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb38-798"><a href="#cb38-798" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-799"><a href="#cb38-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-800"><a href="#cb38-800" aria-hidden="true" tabindex="-1"></a>Now that this function is working, we can use it to simulate a bunch of possible household sizes, like from 2 to 10:</span>
<span id="cb38-801"><a href="#cb38-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-804"><a href="#cb38-804" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-805"><a href="#cb38-805" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-household-probability</span></span>
<span id="cb38-806"><a href="#cb38-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-807"><a href="#cb38-807" aria-hidden="true" tabindex="-1"></a>simulated_households <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">household_size =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-808"><a href="#cb38-808" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob_in_arc =</span> <span class="fu">map_dbl</span>(household_size, <span class="sc">~</span><span class="fu">simulate_prob</span>(.x, <span class="dv">10000</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb38-809"><a href="#cb38-809" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nice_prob =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>)(prob_in_arc))</span>
<span id="cb38-810"><a href="#cb38-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-811"><a href="#cb38-811" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(simulated_households, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(household_size), <span class="at">y =</span> prob_in_arc)) <span class="sc">+</span></span>
<span id="cb38-812"><a href="#cb38-812" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> prob_in_arc), <span class="at">color =</span> clrs[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb38-813"><a href="#cb38-813" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> nice_prob), <span class="at">nudge_y =</span> <span class="fl">0.07</span>, <span class="at">size =</span> <span class="dv">8</span>, <span class="at">size.unit =</span> <span class="st">"pt"</span>) <span class="sc">+</span></span>
<span id="cb38-814"><a href="#cb38-814" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb38-815"><a href="#cb38-815" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb38-816"><a href="#cb38-816" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Household size"</span>,</span>
<span id="cb38-817"><a href="#cb38-817" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Probability"</span>,</span>
<span id="cb38-818"><a href="#cb38-818" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Probability that all birthdays occur within </span><span class="sc">\n</span><span class="st">a single six-month span across household size"</span>,</span>
<span id="cb38-819"><a href="#cb38-819" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"10,000 simulations"</span></span>
<span id="cb38-820"><a href="#cb38-820" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-821"><a href="#cb38-821" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_family =</span> <span class="st">"Montserrat"</span>) <span class="sc">+</span></span>
<span id="cb38-822"><a href="#cb38-822" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb38-823"><a href="#cb38-823" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb38-824"><a href="#cb38-824" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb38-825"><a href="#cb38-825" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"grey50"</span>),</span>
<span id="cb38-826"><a href="#cb38-826" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb38-827"><a href="#cb38-827" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb38-828"><a href="#cb38-828" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-829"><a href="#cb38-829" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-830"><a href="#cb38-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-831"><a href="#cb38-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-832"><a href="#cb38-832" aria-hidden="true" tabindex="-1"></a><span class="fu"># But birthdays aren't uniformly distributed!</span></span>
<span id="cb38-833"><a href="#cb38-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-834"><a href="#cb38-834" aria-hidden="true" tabindex="-1"></a>We just answered Karl's original question: "Suppose n points are uniformly distributed on a circle. What is the probability that they belong to a connected half circle". There's probably some official mathy combinatorial way to build a real formula to describe this pattern, but that's too hard. Simulation gets us there.</span>
<span id="cb38-835"><a href="#cb38-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-836"><a href="#cb38-836" aria-hidden="true" tabindex="-1"></a><span class="fu">## Uneven birthday disributions</span></span>
<span id="cb38-837"><a href="#cb38-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-838"><a href="#cb38-838" aria-hidden="true" tabindex="-1"></a>But in real life, birthdays aren't actually normally distributed. There are some *fascinating* patterns in days of birth. Instead of drawing birthdays from a uniform distribution where every day is equally likely, let's draw from the actual distribution. There's no official probability-math way to do this—the only way to do this kind of calculation is with simulation.</span>
<span id="cb38-839"><a href="#cb38-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-840"><a href="#cb38-840" aria-hidden="true" tabindex="-1"></a>The CDC and the Social Security Administration track the counts of daily births in the Unitd States. In 2016, <span class="co">[</span><span class="ot">FiveThirtyEight reported a story</span><span class="co">](https://fivethirtyeight.com/features/some-people-are-too-superstitious-to-have-a-baby-on-friday-the-13th/)</span> about patterns in daily birthrate frequencies and they <span class="co">[</span><span class="ot">posted their CSV files on GitHub</span><span class="co">](https://github.com/fivethirtyeight/data/tree/master/births)</span>, so we'll load their data and figure out daily probabilities of birthdays.</span>
<span id="cb38-841"><a href="#cb38-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-844"><a href="#cb38-844" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-845"><a href="#cb38-845" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-birth-data-fake</span></span>
<span id="cb38-846"><a href="#cb38-846" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb38-847"><a href="#cb38-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-848"><a href="#cb38-848" aria-hidden="true" tabindex="-1"></a>births_1994_1999 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb38-849"><a href="#cb38-849" aria-hidden="true" tabindex="-1"></a>  <span class="st">"https://raw.githubusercontent.com/fivethirtyeight/data/master/births/US_births_1994-2003_CDC_NCHS.csv"</span></span>
<span id="cb38-850"><a href="#cb38-850" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb38-851"><a href="#cb38-851" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ignore anything after 2000</span></span>
<span id="cb38-852"><a href="#cb38-852" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;</span> <span class="dv">2000</span>)</span>
<span id="cb38-853"><a href="#cb38-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-854"><a href="#cb38-854" aria-hidden="true" tabindex="-1"></a>births_2000_2014 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb38-855"><a href="#cb38-855" aria-hidden="true" tabindex="-1"></a>  <span class="st">"https://raw.githubusercontent.com/fivethirtyeight/data/master/births/US_births_2000-2014_SSA.csv"</span></span>
<span id="cb38-856"><a href="#cb38-856" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-857"><a href="#cb38-857" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-858"><a href="#cb38-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-861"><a href="#cb38-861" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-862"><a href="#cb38-862" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-birth-data-real</span></span>
<span id="cb38-863"><a href="#cb38-863" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb38-864"><a href="#cb38-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-865"><a href="#cb38-865" aria-hidden="true" tabindex="-1"></a>births_1994_1999 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data//US_births_1994-2003_CDC_NCHS.csv"</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-866"><a href="#cb38-866" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;</span> <span class="dv">2000</span>)</span>
<span id="cb38-867"><a href="#cb38-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-868"><a href="#cb38-868" aria-hidden="true" tabindex="-1"></a>births_2000_2014 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/US_births_2000-2014_SSA.csv"</span>)</span>
<span id="cb38-869"><a href="#cb38-869" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-870"><a href="#cb38-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-873"><a href="#cb38-873" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-874"><a href="#cb38-874" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: combine-clean-birth-data</span></span>
<span id="cb38-875"><a href="#cb38-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-876"><a href="#cb38-876" aria-hidden="true" tabindex="-1"></a>births_combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(births_1994_1999, births_2000_2014) <span class="sc">|&gt;</span> </span>
<span id="cb38-877"><a href="#cb38-877" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb38-878"><a href="#cb38-878" aria-hidden="true" tabindex="-1"></a>    <span class="at">full_date =</span> <span class="fu">make_date</span>(<span class="at">year =</span> <span class="dv">2024</span>, <span class="at">month =</span> month, <span class="at">day =</span> date_of_month),</span>
<span id="cb38-879"><a href="#cb38-879" aria-hidden="true" tabindex="-1"></a>    <span class="at">day_of_year =</span> <span class="fu">yday</span>(full_date)</span>
<span id="cb38-880"><a href="#cb38-880" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb38-881"><a href="#cb38-881" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb38-882"><a href="#cb38-882" aria-hidden="true" tabindex="-1"></a>    <span class="at">month_cateogrical =</span> <span class="fu">month</span>(full_date, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">abbr =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-883"><a href="#cb38-883" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-884"><a href="#cb38-884" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(births_combined)</span>
<span id="cb38-885"><a href="#cb38-885" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-886"><a href="#cb38-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-887"><a href="#cb38-887" aria-hidden="true" tabindex="-1"></a>But first, just because this is one of my favorite graphs ever, let's visualize the data! Here's a heatmap showing the daily average births for 366 days:</span>
<span id="cb38-888"><a href="#cb38-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-891"><a href="#cb38-891" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-892"><a href="#cb38-892" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-births-heatmap</span></span>
<span id="cb38-893"><a href="#cb38-893" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb38-894"><a href="#cb38-894" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4.75</span></span>
<span id="cb38-895"><a href="#cb38-895" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb38-896"><a href="#cb38-896" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: "100%"</span></span>
<span id="cb38-897"><a href="#cb38-897" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: body-outset</span></span>
<span id="cb38-898"><a href="#cb38-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-899"><a href="#cb38-899" aria-hidden="true" tabindex="-1"></a>avg_births_month_day <span class="ot">&lt;-</span> births_combined <span class="sc">|&gt;</span> </span>
<span id="cb38-900"><a href="#cb38-900" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month_cateogrical, date_of_month) <span class="sc">%&gt;%</span> </span>
<span id="cb38-901"><a href="#cb38-901" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_births =</span> <span class="fu">mean</span>(births))</span>
<span id="cb38-902"><a href="#cb38-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-903"><a href="#cb38-903" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb38-904"><a href="#cb38-904" aria-hidden="true" tabindex="-1"></a>  avg_births_month_day, </span>
<span id="cb38-905"><a href="#cb38-905" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(date_of_month), <span class="at">y =</span> <span class="fu">fct_rev</span>(month_cateogrical), <span class="at">fill =</span> avg_births)</span>
<span id="cb38-906"><a href="#cb38-906" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb38-907"><a href="#cb38-907" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb38-908"><a href="#cb38-908" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(</span>
<span id="cb38-909"><a href="#cb38-909" aria-hidden="true" tabindex="-1"></a>    <span class="at">option =</span> <span class="st">"rocket"</span>, <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_comma</span>(),</span>
<span id="cb38-910"><a href="#cb38-910" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="fu">guide_colorbar</span>(<span class="at">barwidth =</span> <span class="dv">20</span>, <span class="at">barheight =</span> <span class="fl">0.5</span>, <span class="at">position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb38-911"><a href="#cb38-911" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-912"><a href="#cb38-912" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb38-913"><a href="#cb38-913" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb38-914"><a href="#cb38-914" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Average births per day"</span>,</span>
<span id="cb38-915"><a href="#cb38-915" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"1994–2014"</span>,</span>
<span id="cb38-916"><a href="#cb38-916" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Average births"</span></span>
<span id="cb38-917"><a href="#cb38-917" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-918"><a href="#cb38-918" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb38-919"><a href="#cb38-919" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_family =</span> <span class="st">"Montserrat"</span>) <span class="sc">+</span></span>
<span id="cb38-920"><a href="#cb38-920" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb38-921"><a href="#cb38-921" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.justification.bottom =</span> <span class="st">"left"</span>,</span>
<span id="cb38-922"><a href="#cb38-922" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title.position =</span> <span class="st">"top"</span>,</span>
<span id="cb38-923"><a href="#cb38-923" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb38-924"><a href="#cb38-924" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb38-925"><a href="#cb38-925" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-926"><a href="#cb38-926" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-927"><a href="#cb38-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-928"><a href="#cb38-928" aria-hidden="true" tabindex="-1"></a>There are some really fascinating stories here!</span>
<span id="cb38-929"><a href="#cb38-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-930"><a href="#cb38-930" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Nobody wants to have babies during Christmas or New Year's. Christmas Day, Christmas Eve, and New Year's Day seem to have the lowest average births.</span>
<span id="cb38-931"><a href="#cb38-931" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>New Year's Eve, Halloween, July 4, April 1,^<span class="co">[</span><span class="ot">No one wants joke babies?</span><span class="co">]</span> and the whole week of Thanksgiving^<span class="co">[</span><span class="ot">American Thanksgiving is the fourth Thursday of November, so the exact day of the month moves around each year</span><span class="co">]</span> also have really low averages.</span>
<span id="cb38-932"><a href="#cb38-932" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The 13th of every month has slightly fewer births than average—the column at the 13th is really obvious here.</span>
<span id="cb38-933"><a href="#cb38-933" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The days with the highest average counts are in mid-September, from the 9th to the 20th—except for September 11.</span>
<span id="cb38-934"><a href="#cb38-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-935"><a href="#cb38-935" aria-hidden="true" tabindex="-1"></a>With this data, we can calculate the daily probability of having a birthday:</span>
<span id="cb38-936"><a href="#cb38-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-939"><a href="#cb38-939" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-940"><a href="#cb38-940" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-prob-per-day</span></span>
<span id="cb38-941"><a href="#cb38-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-942"><a href="#cb38-942" aria-hidden="true" tabindex="-1"></a>prob_per_day <span class="ot">&lt;-</span> births_combined <span class="sc">|&gt;</span> </span>
<span id="cb38-943"><a href="#cb38-943" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(day_of_year) <span class="sc">|&gt;</span> </span>
<span id="cb38-944"><a href="#cb38-944" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total =</span> <span class="fu">sum</span>(births)) <span class="sc">|&gt;</span> </span>
<span id="cb38-945"><a href="#cb38-945" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> total <span class="sc">/</span> <span class="fu">sum</span>(total)) <span class="sc">|&gt;</span> </span>
<span id="cb38-946"><a href="#cb38-946" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">full_date =</span> <span class="fu">ymd</span>(<span class="st">"2024-01-01"</span>) <span class="sc">+</span> <span class="fu">days</span>(day_of_year <span class="sc">-</span> <span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb38-947"><a href="#cb38-947" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">yearless_date =</span> <span class="fu">format</span>(full_date, <span class="st">"%B %d"</span>))</span>
<span id="cb38-948"><a href="#cb38-948" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(prob_per_day)</span>
<span id="cb38-949"><a href="#cb38-949" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-950"><a href="#cb38-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-951"><a href="#cb38-951" aria-hidden="true" tabindex="-1"></a>Here are the 5 most common days:^<span class="co">[</span><span class="ot">There's me on September 19.</span><span class="co">]</span></span>
<span id="cb38-952"><a href="#cb38-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-955"><a href="#cb38-955" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-956"><a href="#cb38-956" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: top-birthdays</span></span>
<span id="cb38-957"><a href="#cb38-957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-958"><a href="#cb38-958" aria-hidden="true" tabindex="-1"></a>prob_per_day <span class="sc">|&gt;</span> </span>
<span id="cb38-959"><a href="#cb38-959" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(yearless_date, prob) <span class="sc">|&gt;</span> </span>
<span id="cb38-960"><a href="#cb38-960" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> prob, <span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb38-961"><a href="#cb38-961" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-962"><a href="#cb38-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-963"><a href="#cb38-963" aria-hidden="true" tabindex="-1"></a>And the 5 least probable days—Leap Day, Christmas Day, New Year's Day, Christmas Eve, and July 4th:</span>
<span id="cb38-964"><a href="#cb38-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-967"><a href="#cb38-967" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-968"><a href="#cb38-968" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: bottom-birthdays</span></span>
<span id="cb38-969"><a href="#cb38-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-970"><a href="#cb38-970" aria-hidden="true" tabindex="-1"></a>prob_per_day <span class="sc">|&gt;</span> </span>
<span id="cb38-971"><a href="#cb38-971" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(yearless_date, prob) <span class="sc">|&gt;</span> </span>
<span id="cb38-972"><a href="#cb38-972" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(<span class="at">order_by =</span> prob, <span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb38-973"><a href="#cb38-973" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-974"><a href="#cb38-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-975"><a href="#cb38-975" aria-hidden="true" tabindex="-1"></a><span class="fu">## Using actual birthday probabilities</span></span>
<span id="cb38-976"><a href="#cb38-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-977"><a href="#cb38-977" aria-hidden="true" tabindex="-1"></a>Instead of drawing random numbers between 0 and 360 from a uniform distribution, we can draw day-of-the-year numbers. This is easy with <span class="in">`sample()`</span>. Here's a random 4-person household:</span>
<span id="cb38-978"><a href="#cb38-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-981"><a href="#cb38-981" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-982"><a href="#cb38-982" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: sample-example</span></span>
<span id="cb38-983"><a href="#cb38-983" aria-hidden="true" tabindex="-1"></a>withr<span class="sc">::</span><span class="fu">with_seed</span>(<span class="dv">1234</span>, {</span>
<span id="cb38-984"><a href="#cb38-984" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">366</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb38-985"><a href="#cb38-985" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb38-986"><a href="#cb38-986" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-987"><a href="#cb38-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-988"><a href="#cb38-988" aria-hidden="true" tabindex="-1"></a>That gives us a uniform probability distribution—all the numbers between 1 and 366 are equally likely. <span class="in">`sample()`</span> has a <span class="in">`prob`</span> argument that we can use to feed a vector of probabilities:</span>
<span id="cb38-989"><a href="#cb38-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-992"><a href="#cb38-992" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-993"><a href="#cb38-993" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: sample-with-real-probs</span></span>
<span id="cb38-994"><a href="#cb38-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-995"><a href="#cb38-995" aria-hidden="true" tabindex="-1"></a>withr<span class="sc">::</span><span class="fu">with_seed</span>(<span class="dv">1234</span>, {</span>
<span id="cb38-996"><a href="#cb38-996" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample</span>(</span>
<span id="cb38-997"><a href="#cb38-997" aria-hidden="true" tabindex="-1"></a>    prob_per_day<span class="sc">$</span>day_of_year, </span>
<span id="cb38-998"><a href="#cb38-998" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">4</span>, </span>
<span id="cb38-999"><a href="#cb38-999" aria-hidden="true" tabindex="-1"></a>    <span class="at">replace =</span> <span class="cn">TRUE</span>,</span>
<span id="cb38-1000"><a href="#cb38-1000" aria-hidden="true" tabindex="-1"></a>    <span class="at">prob =</span> prob_per_day<span class="sc">$</span>prob)</span>
<span id="cb38-1001"><a href="#cb38-1001" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb38-1002"><a href="#cb38-1002" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-1003"><a href="#cb38-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1004"><a href="#cb38-1004" aria-hidden="true" tabindex="-1"></a>These days of the year now match the actual distribution of birthdays in the United States. If we simulated thousands of birthdays, we'd get more in September, fewer on the 13th of each month, and far fewer around Thanksgiving and Christmas.</span>
<span id="cb38-1005"><a href="#cb38-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1006"><a href="#cb38-1006" aria-hidden="true" tabindex="-1"></a>We can now update our simulation to use this more realistic distribution of birthdays:</span>
<span id="cb38-1007"><a href="#cb38-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1010"><a href="#cb38-1010" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-1011"><a href="#cb38-1011" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fun-simulate-prob-real</span></span>
<span id="cb38-1012"><a href="#cb38-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1013"><a href="#cb38-1013" aria-hidden="true" tabindex="-1"></a>simulate_prob_real <span class="ot">&lt;-</span> <span class="cf">function</span>(n, <span class="at">num_simulations =</span> <span class="dv">1000</span>) {</span>
<span id="cb38-1014"><a href="#cb38-1014" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">map_lgl</span>(<span class="dv">1</span><span class="sc">:</span>num_simulations, <span class="sc">~</span>{</span>
<span id="cb38-1015"><a href="#cb38-1015" aria-hidden="true" tabindex="-1"></a>    birthdays <span class="ot">&lt;-</span> <span class="fu">sample</span>(</span>
<span id="cb38-1016"><a href="#cb38-1016" aria-hidden="true" tabindex="-1"></a>      prob_per_day<span class="sc">$</span>day_of_year, </span>
<span id="cb38-1017"><a href="#cb38-1017" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> n, </span>
<span id="cb38-1018"><a href="#cb38-1018" aria-hidden="true" tabindex="-1"></a>      <span class="at">replace =</span> <span class="cn">TRUE</span>, </span>
<span id="cb38-1019"><a href="#cb38-1019" aria-hidden="true" tabindex="-1"></a>      <span class="at">prob =</span> prob_per_day<span class="sc">$</span>prob</span>
<span id="cb38-1020"><a href="#cb38-1020" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-1021"><a href="#cb38-1021" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-1022"><a href="#cb38-1022" aria-hidden="true" tabindex="-1"></a>    birthdays_doubled <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">c</span>(birthdays, birthdays <span class="sc">+</span> <span class="dv">366</span>))</span>
<span id="cb38-1023"><a href="#cb38-1023" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-1024"><a href="#cb38-1024" aria-hidden="true" tabindex="-1"></a>    <span class="fu">any</span>(<span class="fu">map_lgl</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="sc">~</span> birthdays_doubled[.x <span class="sc">+</span> n <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">-</span> birthdays_doubled[.x] <span class="sc">&lt;=</span> (<span class="dv">366</span> <span class="sc">/</span> <span class="dv">2</span>)))</span>
<span id="cb38-1025"><a href="#cb38-1025" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb38-1026"><a href="#cb38-1026" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(results)</span>
<span id="cb38-1027"><a href="#cb38-1027" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-1028"><a href="#cb38-1028" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-1029"><a href="#cb38-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1030"><a href="#cb38-1030" aria-hidden="true" tabindex="-1"></a>Here's the probability of having all the birthdays within the same six months for a household of 4:</span>
<span id="cb38-1031"><a href="#cb38-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1034"><a href="#cb38-1034" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-1035"><a href="#cb38-1035" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: simulate-4-real</span></span>
<span id="cb38-1036"><a href="#cb38-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1037"><a href="#cb38-1037" aria-hidden="true" tabindex="-1"></a>withr<span class="sc">::</span><span class="fu">with_seed</span>(<span class="dv">1234</span>, {</span>
<span id="cb38-1038"><a href="#cb38-1038" aria-hidden="true" tabindex="-1"></a>  <span class="fu">simulate_prob_real</span>(<span class="dv">4</span>)</span>
<span id="cb38-1039"><a href="#cb38-1039" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb38-1040"><a href="#cb38-1040" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-1041"><a href="#cb38-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1042"><a href="#cb38-1042" aria-hidden="true" tabindex="-1"></a>And 6:</span>
<span id="cb38-1043"><a href="#cb38-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1046"><a href="#cb38-1046" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-1047"><a href="#cb38-1047" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: simulate-6-real</span></span>
<span id="cb38-1048"><a href="#cb38-1048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1049"><a href="#cb38-1049" aria-hidden="true" tabindex="-1"></a>withr<span class="sc">::</span><span class="fu">with_seed</span>(<span class="dv">1234</span>, {</span>
<span id="cb38-1050"><a href="#cb38-1050" aria-hidden="true" tabindex="-1"></a>  <span class="fu">simulate_prob_real</span>(<span class="dv">6</span>)</span>
<span id="cb38-1051"><a href="#cb38-1051" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb38-1052"><a href="#cb38-1052" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-1053"><a href="#cb38-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1054"><a href="#cb38-1054" aria-hidden="true" tabindex="-1"></a>And here's the probability across different household sizes:</span>
<span id="cb38-1055"><a href="#cb38-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1058"><a href="#cb38-1058" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-1059"><a href="#cb38-1059" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-household-probability-real</span></span>
<span id="cb38-1060"><a href="#cb38-1060" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb38-1061"><a href="#cb38-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1062"><a href="#cb38-1062" aria-hidden="true" tabindex="-1"></a>sims_real <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">household_size =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-1063"><a href="#cb38-1063" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob_in_arc =</span> <span class="fu">map_dbl</span>(household_size, <span class="sc">~</span><span class="fu">simulate_prob_real</span>(.x, <span class="dv">10000</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb38-1064"><a href="#cb38-1064" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nice_prob =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>)(prob_in_arc))</span>
<span id="cb38-1065"><a href="#cb38-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1066"><a href="#cb38-1066" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sims_real, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(household_size), <span class="at">y =</span> prob_in_arc)) <span class="sc">+</span></span>
<span id="cb38-1067"><a href="#cb38-1067" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> prob_in_arc), <span class="at">color =</span> clrs[<span class="dv">9</span>]) <span class="sc">+</span></span>
<span id="cb38-1068"><a href="#cb38-1068" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> nice_prob), <span class="at">nudge_y =</span> <span class="fl">0.07</span>, <span class="at">size =</span> <span class="dv">8</span>, <span class="at">size.unit =</span> <span class="st">"pt"</span>) <span class="sc">+</span></span>
<span id="cb38-1069"><a href="#cb38-1069" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb38-1070"><a href="#cb38-1070" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb38-1071"><a href="#cb38-1071" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Household size"</span>,</span>
<span id="cb38-1072"><a href="#cb38-1072" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Probability"</span>,</span>
<span id="cb38-1073"><a href="#cb38-1073" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Probability that all birthdays occur within a</span><span class="sc">\n</span><span class="st">single 6-month span across household size"</span>,</span>
<span id="cb38-1074"><a href="#cb38-1074" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Based on average daily birth probabilities from 1994–2014"</span>,</span>
<span id="cb38-1075"><a href="#cb38-1075" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"10,000 simulations; daily probabilities from the CDC and SSA"</span></span>
<span id="cb38-1076"><a href="#cb38-1076" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-1077"><a href="#cb38-1077" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_family =</span> <span class="st">"Montserrat"</span>) <span class="sc">+</span></span>
<span id="cb38-1078"><a href="#cb38-1078" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb38-1079"><a href="#cb38-1079" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb38-1080"><a href="#cb38-1080" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb38-1081"><a href="#cb38-1081" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"grey50"</span>),</span>
<span id="cb38-1082"><a href="#cb38-1082" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"grey50"</span>),</span>
<span id="cb38-1083"><a href="#cb38-1083" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb38-1084"><a href="#cb38-1084" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb38-1085"><a href="#cb38-1085" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-1086"><a href="#cb38-1086" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-1087"><a href="#cb38-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1088"><a href="#cb38-1088" aria-hidden="true" tabindex="-1"></a>In the end, these are all roughly the same as the uniform birthday distribution, but it *feels* more accurate since the probabilities are based on real-life frequencies. </span>
<span id="cb38-1089"><a href="#cb38-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1090"><a href="#cb38-1090" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb38-1091"><a href="#cb38-1091" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;hr class="dinkus"&gt;</span></span>
<span id="cb38-1092"><a href="#cb38-1092" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-1093"><a href="#cb38-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1094"><a href="#cb38-1094" aria-hidden="true" tabindex="-1"></a>But most importantly, we didn't have to do any math to get the right answer. Brute force simulation techniques got us there.</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p><span class="faux-block">Forked from <a href="https://www.andrewheiss.com/">Andrew Heiss</a></span> # <span class="faux-block"><a href="https://github.com/andrewheiss/ath-quarto">View the source at <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></span></p>
</div>
  </div>
</footer>


</body></html>