<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Andrew Heiss">
<meta name="description" content="Measuring coastlines is hard and causes fractal paradoxes, but we can use R and {sf} to try!">
<title>Calculating the proportion of US state borders that are coastlines | Andrew Heiss – Andrew Heiss</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../../">
<link href="../../../../..//files/favicon-512.png" rel="icon" type="image/png">
<script src="../../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting-17c909d5fd25ae21b861c0c7a49b2096.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../site_libs/bootstrap/bootstrap-5cd0811f461c8271ae6bab49df9501be.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script src="../../../../../site_libs/quarto-contrib/iconify-2.0.0/iconify-icon.min.js"></script><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-527449-5', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script><style>

      .quarto-title-block .quarto-title-banner {
        background: #170C3A;
      }
</style>
<script src="../../../../../site_libs/core-js-2.5.3/shim.min.js"></script><script src="../../../../../site_libs/react-18.2.0/react.min.js"></script><script src="../../../../../site_libs/react-18.2.0/react-dom.min.js"></script><script src="../../../../../site_libs/reactwidget-1.0.0/react-tools.js"></script><script src="../../../../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="../../../../../site_libs/reactable-0.4.4/reactable.css" rel="stylesheet">
<script src="../../../../../site_libs/reactable-binding-0.4.4/reactable.js"></script><style type="text/css">
hr.dinkus {
    width: 50px;
    margin: 2em auto 2em;
    border-top: 5px dotted #454545;
}

div.column-margin+hr.dinkus {
    margin: 1em auto 2em;
}
</style>
<meta property="og:title" content="Calculating the proportion of US state borders that are coastlines | Andrew Heiss">
<meta property="og:description" content="Measuring coastlines is hard and causes fractal paradoxes, but we can use R and {sf} to try!">
<meta property="og:image" content="https://www.andrewheiss.com/blog/2024/05/08/coastline-to-border-proportions/index_files/figure-html/plot-nc-census-coastal-borders-1.png">
<meta property="og:site_name" content="Andrew Heiss">
<meta property="og:locale" content="en_US">
<meta property="og:image:height" content="1067">
<meta property="og:image:width" content="1728">
<meta name="twitter:title" content="Calculating the proportion of US state borders that are coastlines | Andrew Heiss">
<meta name="twitter:description" content="Measuring coastlines is hard and causes fractal paradoxes, but we can use R and {sf} to try!">
<meta name="twitter:image" content="https://www.andrewheiss.com/blog/2024/05/08/coastline-to-border-proportions/index_files/figure-html/plot-nc-census-coastal-borders-1.png">
<meta name="twitter:creator" content="@andrewheiss">
<meta name="twitter:site" content="@andrewheiss">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image-height" content="1067">
<meta name="twitter:image-width" content="1728">
</head>
<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../../index.html">
    <span class="navbar-title">Andrew Heiss</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../../../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../cv/index.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../research/index.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../teaching/index.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../talks/index.html"> 
<span class="menu-text">Talks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../now/index.html"> 
<span class="menu-text">Now</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../uses/index.html"> 
<span class="menu-text">Uses</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../../../../../atom.xml"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:rss" style="font-size: 1.1em;" aria-label="Icon rss from bi Iconify.design set." title="RSS"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="mailto:aheiss@gsu.edu"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:envelope" style="font-size: 1.1em;" aria-label="Icon envelope from bi Iconify.design set." title="E-mail"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://bsky.app/profile/andrew.heiss.phd" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="fa6-brands:bluesky" style="font-size: 1.1em;" aria-label="Icon bluesky from fa6-brands Iconify.design set." title="Bluesky"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://fediscience.org/users/andrew/" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:mastodon" style="font-size: 1.1em;" aria-label="Icon mastodon from bi Iconify.design set." title="Mastodon"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/andrewheiss" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:github" style="font-size: 1.1em;" aria-label="Icon github from bi Iconify.design set." title="GitHub"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.youtube.com/andrewheiss" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:youtube" style="font-size: 1.1em;" aria-label="Icon youtube from bi Iconify.design set." title="YouTube"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.heissatopia.com/"> 
<span class="menu-text"><iconify-icon inline="" icon="fa6-brands:blogger" style="font-size: 1.15em;" aria-label="Icon blogger from fa6-brands Iconify.design set." title="Blogger"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/andrewheiss" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:linkedin" style="font-size: 1.1em;" aria-label="Icon linkedin from bi Iconify.design set." title="LinkedIn"></iconify-icon></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default blog-post page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Calculating the proportion of US state borders that are coastlines</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                  <div>
        <div class="description">
          Measuring coastlines is hard and causes fractal paradoxes, but we can use R and {sf} to try!
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">r</div>
                <div class="quarto-category">tidyverse</div>
                <div class="quarto-category">ggplot</div>
                <div class="quarto-category">gis</div>
                <div class="quarto-category">maps</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://www.andrewheiss.com/">Andrew Heiss</a> <a href="https://orcid.org/0000-0002-3948-3914" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">Wednesday, May 8, 2024</p>
      </div>
    </div>
    
      
      <div>
      <div class="quarto-title-meta-heading">Doi</div>
      <div class="quarto-title-meta-contents">
        <p class="doi">
          <a href="https://doi.org/10.59350/wzn5q-wxk02">10.59350/wzn5q-wxk02</a>
        </p>
      </div>
    </div>
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Contents</h2>
   
  <ul>
<li><a href="#use-us-census-data-on-states-and-coastlines" id="toc-use-us-census-data-on-states-and-coastlines" class="nav-link active" data-scroll-target="#use-us-census-data-on-states-and-coastlines">Use US Census data on states and coastlines</a></li>
  <li><a href="#use-the-lack-of-land-as-the-coastline" id="toc-use-the-lack-of-land-as-the-coastline" class="nav-link" data-scroll-target="#use-the-lack-of-land-as-the-coastline">Use the lack of land as the coastline</a></li>
  <li>
<a href="#use-data-from-natural-earth" id="toc-use-data-from-natural-earth" class="nav-link" data-scroll-target="#use-data-from-natural-earth">Use data from Natural Earth</a>
  <ul class="collapse">
<li><a href="#hawai%CA%BBi" id="toc-hawaiʻi" class="nav-link" data-scroll-target="#hawai%CA%BBi">Hawaiʻi</a></li>
  <li><a href="#north-carolina" id="toc-north-carolina" class="nav-link" data-scroll-target="#north-carolina">North Carolina</a></li>
  <li><a href="#washington" id="toc-washington" class="nav-link" data-scroll-target="#washington">Washington</a></li>
  <li><a href="#all-states" id="toc-all-states" class="nav-link" data-scroll-target="#all-states">All states</a></li>
  <li><a href="#highlighting-coastal-states" id="toc-highlighting-coastal-states" class="nav-link" data-scroll-target="#highlighting-coastal-states">Highlighting coastal states</a></li>
  </ul>
</li>
  <li>
<a href="#the-coastline-paradox-and-map-resolutions" id="toc-the-coastline-paradox-and-map-resolutions" class="nav-link" data-scroll-target="#the-coastline-paradox-and-map-resolutions">The Coastline Paradox and map resolutions</a>
  <ul class="collapse">
<li><a href="#hypothetical-coastline-at-different-resolutions" id="toc-hypothetical-coastline-at-different-resolutions" class="nav-link" data-scroll-target="#hypothetical-coastline-at-different-resolutions">Hypothetical coastline at different resolutions</a></li>
  <li><a href="#dubai-and-artificial-coastlines" id="toc-dubai-and-artificial-coastlines" class="nav-link" data-scroll-target="#dubai-and-artificial-coastlines">Dubai and artificial coastlines</a></li>
  </ul>
</li>
  <li><a href="#use-lower-resolution-natural-earth-coastlines" id="toc-use-lower-resolution-natural-earth-coastlines" class="nav-link" data-scroll-target="#use-lower-resolution-natural-earth-coastlines">Use lower resolution Natural Earth coastlines</a></li>
  </ul></nav>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content"><p>A few days ago, my wife, a bunch of my kids, and I were huddled around a big wall map of the United States, joking about the relative unimportance of <a href="https://en.wikipedia.org/wiki/Rhode_Island">Rhode Island</a>, the smallest state in the US. It’s <a href="https://twitter.com/andrewheiss/status/1258088903543853059">one of the states I never ever think about</a>:</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="img/ignored-states-tweet.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="margin-caption">Tweet by me from <a href="https://twitter.com/andrewheiss/status/1258088903543853059">May 6, 2020</a></figcaption></figure>
</div>
<p>…and it’s just so <em>small</em>.</p>
<p>Amid the joking, my wife came to Rhode Island’s defense by declaring that even though it’s so small, it has one of the highest proportions of coastline to land borders. We all gave it a metaphorical gold star for being so maritime-y and moved on with our days.</p>
<p>But as I thought about it later, I got curious about how much of Rhode Island’s border really is coastline and how that proportion compares to other states. New England in general has lots of inlets and islands; North Carolina has the complex <a href="https://en.wikipedia.org/wiki/Outer_Banks">Outer Banks</a>; Louisiana has the Mississippi Delta; Michigan is split into two parts and surrounded by the Great Lakes; Florida is Florida. Lots of other states have lots of coastline.</p>
<p>Using R, the <a href="https://r-spatial.github.io/sf/">extremely powerful {sf} package</a> for working with geospatial data, and some high quality public domain geographic data, we can find the actual answers about coastline proportions. Spoilers: Rhode Island does really well, as expected.</p>
<p>But doing this is a lot more complicated than you might think, both for technical reasons and for philosophical reasons.</p>
<p>Let’s explore this data and make some pretty maps!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/walkerke/tigris">tigris</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rnaturalearth/">rnaturalearth</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://gt.rstudio.com">gt</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">clrs</span> <span class="op">&lt;-</span> <span class="fu">rcartocolor</span><span class="fu">::</span><span class="fu">carto_pal</span><span class="op">(</span><span class="fl">12</span>, <span class="st">"Prism"</span><span class="op">)</span></span>
<span><span class="va">clr_ocean</span> <span class="op">&lt;-</span> <span class="fu">colorspace</span><span class="fu">::</span><span class="fu">lighten</span><span class="op">(</span><span class="st">"#88CCEE"</span>, <span class="fl">0.7</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Custom ggplot theme to make pretty plots</span></span>
<span><span class="co"># Get the font at https://fonts.google.com/specimen/Overpass</span></span>
<span><span class="va">theme_map</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span>base_family <span class="op">=</span> <span class="st">"Overpass Light"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span></span>
<span>      plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Overpass"</span>, face <span class="op">=</span> <span class="st">"bold"</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>      plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Overpass"</span>, face <span class="op">=</span> <span class="st">"plain"</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">update_geom_defaults</span><span class="op">(</span><span class="st">"text"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Overpass"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="use-us-census-data-on-states-and-coastlines" class="level2"><h2 class="anchored" data-anchor-id="use-us-census-data-on-states-and-coastlines">Use US Census data on states and coastlines</h2>
<p>At first glance, calculating the proportion of coastline borders in states feels fairly straightforward. We take state boundaries, find where they intersect with coastline boundaries, extract those overlapping sections, and voilá—we’re done.</p>
<p>The US Census Bureau even has shapefiles ready to use, like <a href="https://www.census.gov/geographies/mapping-files/time-series/geo/cartographic-boundary.html">US state borders</a> and <a href="https://catalog.data.gov/dataset/tiger-line-shapefile-2023-nation-u-s-coastline">the national coastline</a> for 2023, and <a href="https://walker-data.com/census-r/census-geographic-data-and-applications-in-r.html">the {tigris} package</a> makes it really easy to load that data directly into R.</p>
<p>First, let’s grab US state data at medium resolution (1:5 million) and calculate the length of each state’s border. To make calculations easier, we’ll change the projection to <a href="https://en.wikipedia.org/wiki/Albers_projection">Albers</a>, which measures distances in meters instead of the default <a href="https://en.wikipedia.org/wiki/North_American_Datum">NAD 83 decimal degree system</a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">census_states</span> <span class="op">&lt;-</span> <span class="fu">states</span><span class="op">(</span></span>
<span>  cb <span class="op">=</span> <span class="cn">TRUE</span>, resolution <span class="op">=</span> <span class="st">"5m"</span>, year <span class="op">=</span> <span class="fl">2023</span>,</span>
<span>  progress_bar <span class="op">=</span> <span class="cn">FALSE</span>, keep_zipped_shapefile <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">st_transform</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"ESRI:102003"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># Albers</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    border_length <span class="op">=</span> <span class="fu">st_perimeter</span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span>,</span>
<span>    border_length_miles <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu">set_units</span><span class="op">(</span><span class="va">border_length</span>, <span class="st">"miles"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">census_states</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">NAME</span>, <span class="va">border_length</span>, <span class="va">border_length_miles</span><span class="op">)</span></span>
<span><span class="co">## Simple feature collection with 56 features and 3 fields</span></span>
<span><span class="co">## Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: -10430000 ymin: -1685000 xmax: 3408000 ymax: 5141000</span></span>
<span><span class="co">## Projected CRS: USA_Contiguous_Albers_Equal_Area_Conic</span></span>
<span><span class="co">## First 10 features:</span></span>
<span><span class="co">##            NAME border_length border_length_miles                       geometry</span></span>
<span><span class="co">## 1    New Mexico   2389194 [m]      1484.6 [miles] MULTIPOLYGON (((-1231344 -5...</span></span>
<span><span class="co">## 2   Puerto Rico    683648 [m]       424.8 [miles] MULTIPOLYGON (((3306526 -15...</span></span>
<span><span class="co">## 3         Texas   6218137 [m]      3863.8 [miles] MULTIPOLYGON (((-1e+06 -570...</span></span>
<span><span class="co">## 4      Kentucky   2097216 [m]      1303.1 [miles] MULTIPOLYGON (((584560 -886...</span></span>
<span><span class="co">## 5          Ohio   1614692 [m]      1003.3 [miles] MULTIPOLYGON (((1094061 536...</span></span>
<span><span class="co">## 6       Georgia   1950980 [m]      1212.3 [miles] MULTIPOLYGON (((939223 -230...</span></span>
<span><span class="co">## 7      Arkansas   2117255 [m]      1315.6 [miles] MULTIPOLYGON (((122656 -111...</span></span>
<span><span class="co">## 8        Oregon   2301152 [m]      1429.9 [miles] MULTIPOLYGON (((-2285910 94...</span></span>
<span><span class="co">## 9  Pennsylvania   1579842 [m]       981.7 [miles] MULTIPOLYGON (((1287712 486...</span></span>
<span><span class="co">## 10     Missouri   2357068 [m]      1464.6 [miles] MULTIPOLYGON (((19009 34499...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we’ll grab coastline data and also convert it to the meter-based Albers projection:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">census_coastline</span> <span class="op">&lt;-</span> <span class="fu">coastline</span><span class="op">(</span></span>
<span>  year <span class="op">=</span> <span class="fl">2023</span>, progress_bar <span class="op">=</span> <span class="cn">FALSE</span>, keep_zipped_shapefile <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">st_transform</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"ESRI:102003"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">census_coastline</span></span>
<span><span class="co">## Simple feature collection with 4236 features and 2 fields</span></span>
<span><span class="co">## Geometry type: LINESTRING</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: -10430000 ymin: -1685000 xmax: 3408000 ymax: 5140000</span></span>
<span><span class="co">## Projected CRS: USA_Contiguous_Albers_Equal_Area_Conic</span></span>
<span><span class="co">## First 10 features:</span></span>
<span><span class="co">##         NAME MTFCC                       geometry</span></span>
<span><span class="co">## 1  Atlántico L4150 LINESTRING (3232962 -158263...</span></span>
<span><span class="co">## 2  Atlántico L4150 LINESTRING (3282570 -157424...</span></span>
<span><span class="co">## 3  Atlántico L4150 LINESTRING (3278311 -157345...</span></span>
<span><span class="co">## 4  Atlántico L4150 LINESTRING (3283967 -157426...</span></span>
<span><span class="co">## 5  Atlántico L4150 LINESTRING (3282914 -157442...</span></span>
<span><span class="co">## 6  Atlántico L4150 LINESTRING (3282240 -157431...</span></span>
<span><span class="co">## 7  Atlántico L4150 LINESTRING (3280919 -157406...</span></span>
<span><span class="co">## 8  Atlántico L4150 LINESTRING (3276748 -157350...</span></span>
<span><span class="co">## 9  Atlántico L4150 LINESTRING (3276791 -157363...</span></span>
<span><span class="co">## 10 Atlántico L4150 LINESTRING (3286366 -157464...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This coastline data isn’t state-based—instead, each row represents a segment of the US coastline. Here’s what it looks like when plotted:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">census_coastline</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"US Census coastline data"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"ESRI:102003"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-census-coastline-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>To find where the two maps intersect, we can use <code>st_intersection()</code>, and then we can calculate the length of each combined segment with <code>st_length()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">census_combined</span> <span class="op">&lt;-</span> <span class="va">census_states</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_intersection</span><span class="op">(</span><span class="va">census_coastline</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>coastline_length <span class="op">=</span> <span class="fu">st_length</span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">census_combined</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">NAME</span>, <span class="va">border_length</span>, <span class="va">coastline_length</span>, <span class="va">geometry</span><span class="op">)</span></span>
<span><span class="co">## Simple feature collection with 1276 features and 3 fields</span></span>
<span><span class="co">## Geometry type: GEOMETRY</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: -10430000 ymin: -1685000 xmax: 3408000 ymax: 5140000</span></span>
<span><span class="co">## Projected CRS: USA_Contiguous_Albers_Equal_Area_Conic</span></span>
<span><span class="co">## First 10 features:</span></span>
<span><span class="co">##            NAME border_length coastline_length                       geometry</span></span>
<span><span class="co">## 2   Puerto Rico    683648 [m]      119.450 [m] LINESTRING (3282570 -157424...</span></span>
<span><span class="co">## 2.1 Puerto Rico    683648 [m]       12.122 [m] LINESTRING (3282914 -157442...</span></span>
<span><span class="co">## 2.2 Puerto Rico    683648 [m]      722.088 [m] LINESTRING (3282240 -157431...</span></span>
<span><span class="co">## 2.3 Puerto Rico    683648 [m]        5.332 [m] LINESTRING (3280919 -157406...</span></span>
<span><span class="co">## 2.4 Puerto Rico    683648 [m]     2014.901 [m] LINESTRING (3279028 -157391...</span></span>
<span><span class="co">## 2.5 Puerto Rico    683648 [m]     2446.737 [m] LINESTRING (3081263 -163791...</span></span>
<span><span class="co">## 2.6 Puerto Rico    683648 [m]    12209.219 [m] MULTILINESTRING ((3306976 -...</span></span>
<span><span class="co">## 2.7 Puerto Rico    683648 [m]     2804.085 [m] MULTILINESTRING ((3178034 -...</span></span>
<span><span class="co">## 2.8 Puerto Rico    683648 [m]     7978.399 [m] MULTILINESTRING ((3230856 -...</span></span>
<span><span class="co">## 2.9 Puerto Rico    683648 [m]     6004.139 [m] MULTILINESTRING ((3172336 -...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Some of these segments are thousands of miles; some are only a few miles. We can do some grouping and summarizing to collapse these into single values for each state. <code>border_length</code> is a state-level variable, not a border-segment-level variable, so it’s repeated in each of the rows of the combined dataset, so we only need to keep one of the values—here I keep the max, but min would work (since they’re the same).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">coastline_length_by_state</span> <span class="op">&lt;-</span> <span class="va">census_combined</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_drop_geometry</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># Stop worrying about geographic stuff</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">NAME</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarize</span><span class="op">(</span></span>
<span>    total_coastline_length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">coastline_length</span><span class="op">)</span>,</span>
<span>    total_perimeter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">border_length</span><span class="op">)</span>,</span>
<span>    prop_coastline <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">total_coastline_length</span> <span class="op">/</span> <span class="va">total_perimeter</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">coastline_length_by_state</span></span>
<span><span class="co">## # A tibble: 35 × 4</span></span>
<span><span class="co">##    NAME                                         total_coastline_length total_perimeter prop_coastline</span></span>
<span><span class="co">##    &lt;chr&gt;                                                           [m]             [m]          &lt;dbl&gt;</span></span>
<span><span class="co">##  1 Alabama                                                     192355.        1907670.         0.101 </span></span>
<span><span class="co">##  2 Alaska                                                    19223761.       29671399.         0.648 </span></span>
<span><span class="co">##  3 American Samoa                                              175827.         172059.         1.02  </span></span>
<span><span class="co">##  4 California                                                 1129738.        4191420.         0.270 </span></span>
<span><span class="co">##  5 Commonwealth of the Northern Mariana Islands                261865.         327378.         0.800 </span></span>
<span><span class="co">##  6 Connecticut                                                  77127.         574613.         0.134 </span></span>
<span><span class="co">##  7 Delaware                                                    110370.         433573.         0.255 </span></span>
<span><span class="co">##  8 Florida                                                    1842297.        3795469.         0.485 </span></span>
<span><span class="co">##  9 Georgia                                                     114280.        1950980.         0.0586</span></span>
<span><span class="co">## 10 Guam                                                        120734.         133668.         0.903 </span></span>
<span><span class="co">## # ℹ 25 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>At first glance, this looks fine. We have each state’s total border length, coastline length, and a proportion. Neat.</p>
<p>But some of these proportions look wrong, like Hawaiʻi:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">coastline_length_by_state</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Hawaii"</span>, <span class="st">"North Carolina"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 2 × 4</span></span>
<span><span class="co">##   NAME           total_coastline_length total_perimeter prop_coastline</span></span>
<span><span class="co">##   &lt;chr&gt;                             [m]             [m]          &lt;dbl&gt;</span></span>
<span><span class="co">## 1 Hawaii                        712716.        1413312.         0.504 </span></span>
<span><span class="co">## 2 North Carolina                248590.        3498277.         0.0711</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>According to this, only 50% of Hawaiʻi’s borders are on the coast. That’s obviously wrong—that state shares no borders with other states and it’s in the middle of the Pacific Ocean.</p>
<p>If we plot the two datasets, we can see what’s going on. First, the resolutions of the state data and coastline data don’t quite match. Check out Oʻahu here—the purple coastline crosses some bays and misses some of the landmass:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extract the state boundaries</span></span>
<span><span class="va">census_hi</span> <span class="op">&lt;-</span> <span class="va">census_states</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op">==</span> <span class="st">"Hawaii"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the bounding box around the state so we can zoom in on the coastline map</span></span>
<span><span class="va">bbox_hi</span> <span class="op">&lt;-</span> <span class="va">census_hi</span> <span class="op">|&gt;</span> <span class="fu">st_transform</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4269"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">st_bbox</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">census_hi</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">census_coastline</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"US Census coastline data"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.425</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.89</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"Oʻahu"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"rect"</span>, </span>
<span>    xmin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.35</span><span class="op">)</span>, xmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, ymin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.63</span><span class="op">)</span>, ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.85</span><span class="op">)</span>, </span>
<span>    color <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">12</span><span class="op">]</span>, fill <span class="op">=</span> <span class="cn">NA</span>, linetype <span class="op">=</span> <span class="st">"21"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">clrs</span><span class="op">[</span><span class="fl">11</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Hawaiʻi"</span>, color <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span></span>
<span>    xlim <span class="op">=</span> <span class="va">bbox_hi</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    ylim <span class="op">=</span> <span class="va">bbox_hi</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4269"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-hi-mismatch-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>This mismatch between datasets is even more obvious if we look at a state like North Carolina. The actual landmass in the Outer Banks along the east coast is complex, with all sorts of inlets and a big long barrier island, but the Census simplifies it down substantially (with good reason(!) <a href="#the-coastline-paradox-and-map-resolutions">as we’ll see later</a>):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">census_nc</span> <span class="op">&lt;-</span> <span class="va">census_states</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op">==</span> <span class="st">"North Carolina"</span><span class="op">)</span></span>
<span><span class="va">bbox_nc</span> <span class="op">&lt;-</span> <span class="va">census_nc</span> <span class="op">|&gt;</span> <span class="fu">st_transform</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4269"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">st_bbox</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">census_nc</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">census_coastline</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"US Census coastline data"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"rect"</span>, </span>
<span>    xmin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.57</span><span class="op">)</span>, xmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.97</span><span class="op">)</span>, ymin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.005</span><span class="op">)</span>, ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.995</span><span class="op">)</span>, </span>
<span>    color <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">12</span><span class="op">]</span>, fill <span class="op">=</span> <span class="cn">NA</span>, linetype <span class="op">=</span> <span class="st">"21"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">clrs</span><span class="op">[</span><span class="fl">11</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"North Carolina"</span>, color <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span></span>
<span>    xlim <span class="op">=</span> <span class="va">bbox_nc</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    ylim <span class="op">=</span> <span class="va">bbox_nc</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4269"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-nc-mismatch-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>This mismatch in borders and coastlines matter a lot for calculations. We’re using <code>st_intersection()</code> to find where the two maps overlap. If the two maps are misaligned, we can’t identify the correct overlaps, which means we can’t identify the full coastal border. Remember how we calculated that only 50% of Hawaiʻi’s borders are coastlines? If we plot the coastal borders of Hawaiʻi, we can see why:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">census_combined</span>, linewidth <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Incomplete coastline overlaps in Hawaiʻi"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span></span>
<span>    xlim <span class="op">=</span> <span class="va">bbox_hi</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    ylim <span class="op">=</span> <span class="va">bbox_hi</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4269"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-hi-mismatch-borders-only-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>There are a couple issues here. The dots scattered along the borders are a sign that there’s some misalignment between the two maps. The borders for the states sometimes cross the coastline borders in a single point instead of following the coast exactly. But the even bigger issue is that these coastlines look sketched out—there are so many major gaps that roughly 50% of the borders are missing. That’s again because of misalignment with the two maps. The borders don’t overlap exactly, so <code>st_intersection()</code> can’t pick them up.</p>
<hr class="dinkus">
<p>So what do we do? We could try finding different coastline data that matches the same resolution as the Census data. The <a href="https://www.ngdc.noaa.gov/mgg/shorelines/">National Oceanic and Atmospheric Administration (NOAA)</a> and the <a href="https://www.sciencebase.gov/catalog/item/581d051de4b08da350d523be">US Geological Survey (USGS)</a> each have their own shoreline datasets, and we could download those and load them into R and hope that they align with one of the Census’s state maps. But they don’t.</p>
<p>So we give up.</p>
</section><section id="use-the-lack-of-land-as-the-coastline" class="level2"><h2 class="anchored" data-anchor-id="use-the-lack-of-land-as-the-coastline">Use the lack of land as the coastline</h2>
<p>Just kidding. There’s a better solution.</p>
<p>We already kind of have coastline data embedded in the state map data. For states that border an ocean or lake, anywhere the blue of the water touches the land is technically a coastline. Take Hawaiʻi, for instance, where the whole state border is the coastline:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">census_hi</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"The islands of Hawaiʻi"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4269"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># NAD83</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_ocean</span><span class="op">)</span>, </span>
<span>    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span><span class="fl">6.5</span>, <span class="fl">0</span>, <span class="fl">6.5</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-hi-census-ocean-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>When looking at states with interior borders (like the other 49 states), though, the state map data has no way to distinguish which of those borders touch the ocean or touch other states. The east coast of North Carolina touches the ocean, but the northern, southern, and western borders do not. We need to somehow figure out which borders don’t touch other states.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">census_nc</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.6</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.89</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"↑ Virginia ↑"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.58</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.3</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"↓ South Carolina ↓"</span>, angle <span class="op">=</span> <span class="fl">313</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.14</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"↓ Georgia"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.27</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.64</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"← Tennessee"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"The “island” of North Carolina"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4269"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># NAD83</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_ocean</span><span class="op">)</span>, </span>
<span>    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span><span class="fl">6.5</span>, <span class="fl">0</span>, <span class="fl">6.5</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-nc-census-ocean-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>We <em>do</em> have data about Virginia, South Carolina, Tennessee, and Georgia, though, so there is a way to know that those borders aren’t ocean borders.</p>
<p>One way to determine which borders are interior and which ones are coastal is to create a big unified shape of the United States and then use the shape of North Carolina as a kind of cookie cutter. We can assume that any exposed edges are coasts.</p>
<p>First, we’ll make our big unified country shape:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">census_us_giant</span> <span class="op">&lt;-</span> <span class="va">census_states</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_union</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_transform</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"ESRI:102003"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">census_us_giant</span>, linewidth <span class="op">=</span> <span class="fl">0</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"One big US-shaped shape"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_ocean</span><span class="op">)</span>, </span>
<span>    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span><span class="fl">6.5</span>, <span class="fl">0</span>, <span class="fl">6.5</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-us-census-giant-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>Before trying this with North Carolina, we’ll test the cookie cutter selection with Hawaiʻi, since we know that 100% of its borders are coastlines. If we use the Hawaiʻi shape to take a chunk out of the overall US shape, we get…</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">hi_ocean_border_census</span> <span class="op">&lt;-</span> <span class="va">census_hi</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_difference</span><span class="op">(</span><span class="va">census_us_giant</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">hi_ocean_border_census</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"lol nothing"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    panel.border <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="va">clr_ocean</span><span class="op">)</span>,</span>
<span>    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span><span class="fl">6.5</span>, <span class="fl">0</span>, <span class="fl">6.5</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-hi-empty-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>…nothing.</p>
<p>The state cookie cutter was too perfect and selected right up to the edge of the overall country, leaving nothing.</p>
<p>To fix this, we can expand the state shape just a <em>tiiiiiiny</em> bit. We can use <code>st_buffer()</code> to add a tiny amount of distance all around the shape—since we’re using the Albers projection, we’re working in meters, so let’s add just 1 millimeter around the border before finding the difference:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">hi_ocean_border_census</span> <span class="op">&lt;-</span> <span class="va">census_hi</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_buffer</span><span class="op">(</span>dist <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_difference</span><span class="op">(</span><span class="va">census_us_giant</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">hi_ocean_border_census</span>, linewidth <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Hawaiʻi’s coastal borders extracted from US shape"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span></span>
<span>    xlim <span class="op">=</span> <span class="va">bbox_hi</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    ylim <span class="op">=</span> <span class="va">bbox_hi</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4269"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-hi-census-borders-extracted-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>Perfect.</p>
<p>Well, almost perfect. We’ve identified the coastal borders, but adding the buffer actually distorts things when we calculate the length of the border.</p>
<p>Let’s find the coast-to-border proportion for Hawaiʻi, which should be 100%. First we’ll find the perimeter of the state:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">hi_border_perimeter</span> <span class="op">&lt;-</span> <span class="va">census_hi</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_perimeter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">hi_border_perimeter</span></span>
<span><span class="co">## 1413312 [m]</span></span>
<span><span class="fu">units</span><span class="fu">::</span><span class="fu">set_units</span><span class="op">(</span><span class="va">hi_border_perimeter</span>, <span class="st">"miles"</span><span class="op">)</span></span>
<span><span class="co">## 878.2 [miles]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Hawaiʻi’s border is 1,413,312 meters, or 878 miles. Sounds reasonable.</p>
<p>Next we’ll find the perimeter of the coastline:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">hi_ocean_border_perimeter</span> <span class="op">&lt;-</span> <span class="va">hi_ocean_border_census</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_perimeter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">hi_ocean_border_perimeter</span></span>
<span><span class="co">## 2826623 [m]</span></span>
<span><span class="fu">units</span><span class="fu">::</span><span class="fu">set_units</span><span class="op">(</span><span class="va">hi_ocean_border_perimeter</span>, <span class="st">"miles"</span><span class="op">)</span></span>
<span><span class="co">## 1756 [miles]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Hrm. Hawaiʻi’s coastline is 2,826,623 meters, or 1,756 miles. That’s actually exactly twice the correct border length:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">hi_ocean_border_perimeter</span> <span class="op">/</span> <span class="va">hi_border_perimeter</span><span class="op">)</span></span>
<span><span class="co">## [1] 2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This happened because of the 1 mm buffer that we added around the state shape. Adding the buffer transformed the line into a polygon—a super tiny 1 mm-narrow polygon, but a polygon nonetheless. That means the border technically has a top and sides and a bottom. When calculating the length or perimeter of the border, we’re double counting because we’re getting both the top and the bottom of the hyper-thin polygon.</p>
<p>To better illustrate what’s going on, let’s add a three kilometer buffer around the borders.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">hi_ocean_border_census_huge_buffer</span> <span class="op">&lt;-</span> <span class="va">census_hi</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_buffer</span><span class="op">(</span>dist <span class="op">=</span> <span class="fl">3000</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_difference</span><span class="op">(</span><span class="va">census_us_giant</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">hi_ocean_border_census_huge_buffer</span>, </span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.2</span>, fill <span class="op">=</span> <span class="fu">colorspace</span><span class="fu">::</span><span class="fu">lighten</span><span class="op">(</span><span class="va">clrs</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Hawaiʻi’s borders with a 3 km buffer"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span></span>
<span>    xlim <span class="op">=</span> <span class="va">bbox_hi</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    ylim <span class="op">=</span> <span class="va">bbox_hi</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4269"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-hi-census-thick-buffer-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>Calculating the perimeter of these borders will add the inside ring and the outside ring, effectively doubling the distance.</p>
<p>It’s less obvious that this doubling is happening when we add just 1 mm, but it is, and it’s leading to incorrect calculations. Fortunately it’s easy to adjust—we can halve the ocean border distance. Coastal borders comprise 100% of Hawaiʻi’s state borders, as expected:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">(</span><span class="va">hi_ocean_border_perimeter</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="va">hi_border_perimeter</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">scales</span><span class="fu">::</span><span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## [1] "100%"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr class="dinkus">
<p>Let’s do the same thing with North Carolina:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nc_ocean_border_census</span> <span class="op">&lt;-</span> <span class="va">census_nc</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_buffer</span><span class="op">(</span>dist <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_difference</span><span class="op">(</span><span class="va">census_us_giant</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">nc_ocean_border_census</span>, linewidth <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"North Carolina’s coastal borders extracted from US shape"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4269"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-nc-census-borders-extracted-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>Perfect! Those are all the state borders that don’t touch other states. <em>That’s</em> the coastline.</p>
<p>We can visualize this better by plotting the larger country shape, the North Carolina shape, and the coastal border:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">census_us_giant</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">census_nc</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">nc_ocean_border_census</span>, linewidth <span class="op">=</span> <span class="fl">0.4</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Coastal border extracted from US shape"</span><span class="op">)</span>,</span>
<span>    key_glyph <span class="op">=</span> <span class="va">draw_key_path</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.6</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.89</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"↑ Virginia ↑"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.58</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.3</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"↓ South Carolina ↓"</span>, angle <span class="op">=</span> <span class="fl">313</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.14</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"↓ Georgia"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.27</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.64</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"← Tennessee"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">clrs</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"North Carolina and its coastal border"</span>, color <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span></span>
<span>    xlim <span class="op">=</span> <span class="va">bbox_nc</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    ylim <span class="op">=</span> <span class="va">bbox_nc</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4269"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_ocean</span><span class="op">)</span>,</span>
<span>    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span><span class="fl">6.5</span>, <span class="fl">0</span>, <span class="fl">6.5</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    legend.key.height <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.5</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>    legend.key <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-nc-census-coastal-borders-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>And we can find the proportion of the state’s borders that are coastline:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nc_border_perimeter</span> <span class="op">&lt;-</span> <span class="va">census_nc</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_perimeter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">nc_border_perimeter</span></span>
<span><span class="co">## 3498277 [m]</span></span>
<span><span class="fu">units</span><span class="fu">::</span><span class="fu">set_units</span><span class="op">(</span><span class="va">nc_border_perimeter</span>, <span class="st">"miles"</span><span class="op">)</span></span>
<span><span class="co">## 2174 [miles]</span></span>
<span></span>
<span><span class="va">nc_ocean_border_perimeter</span> <span class="op">&lt;-</span> <span class="va">nc_ocean_border_census</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_perimeter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">nc_ocean_border_perimeter</span> <span class="op">/</span> <span class="fl">2</span></span>
<span><span class="co">## 1930852 [m]</span></span>
<span><span class="fu">units</span><span class="fu">::</span><span class="fu">set_units</span><span class="op">(</span><span class="va">nc_ocean_border_perimeter</span> <span class="op">/</span> <span class="fl">2</span>, <span class="st">"miles"</span><span class="op">)</span></span>
<span><span class="co">## 1200 [miles]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">(</span><span class="va">nc_ocean_border_perimeter</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="va">nc_border_perimeter</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">scales</span><span class="fu">::</span><span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## [1] "55%"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This approach is great. We don’t need to worry about making sure the coastline map matches the resolution of the state map, since we’re using just one map. Everything aligns perfectly automatically.</p>
<hr class="dinkus">
<p>BUT there’s one more wrinkle to worry about. This approach gets trickier with states that touch other countries, like Washington, where the western border touches the ocean, the northern border touches Canada, and the eastern and southern borders touch other states. The state data knows about Idaho and Oregon, but it doesn’t know that Canada is there. Washington looks like it has an exterior, ocean-facing western border—Canada is replaced with an ocean.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">census_wa</span> <span class="op">&lt;-</span> <span class="va">census_states</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op">==</span> <span class="st">"Washington"</span><span class="op">)</span></span>
<span><span class="va">bbox_wa</span> <span class="op">&lt;-</span> <span class="va">census_wa</span> <span class="op">|&gt;</span> <span class="fu">st_transform</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4269"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">st_bbox</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wa_ocean_border_census</span> <span class="op">&lt;-</span> <span class="va">census_wa</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_buffer</span><span class="op">(</span>dist <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_difference</span><span class="op">(</span><span class="va">census_us_giant</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">census_us_giant</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">census_wa</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">wa_ocean_border_census</span>, linewidth <span class="op">=</span> <span class="fl">0.4</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Coastal border extracted from US shape"</span><span class="op">)</span>,</span>
<span>    key_glyph <span class="op">=</span> <span class="va">draw_key_path</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.64</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.91</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"↑ Canada (British Columbia) ↑"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.54</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.18</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"↓ Oregon ↓"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.87</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"Idaho →"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">clrs</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Washington and the fake Canadian ocean"</span>, color <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span></span>
<span>    xlim <span class="op">=</span> <span class="va">bbox_wa</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    ylim <span class="op">=</span> <span class="va">bbox_wa</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4269"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_ocean</span><span class="op">)</span>,</span>
<span>    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span><span class="fl">6.5</span>, <span class="fl">0</span>, <span class="fl">6.5</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    legend.key.height <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.5</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>    legend.key <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-wa-census-borders-extracted-wrong-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>The big US-shaped polygon isn’t big enough for identifying land borders in other countries. In order to identify <em>all</em> the ocean-facing state borders, we need data about Canada and Mexico, and the US Census doesn’t provide that.</p>
<p>So we give up.</p>
</section><section id="use-data-from-natural-earth" class="level2"><h2 class="anchored" data-anchor-id="use-data-from-natural-earth">Use data from Natural Earth</h2>
<p>Just kidding. There’s a better solution.</p>
<p>The Census doesn’t have data on other countries, but other data sources do! The <a href="https://www.naturalearthdata.com/">incredible Natural Earth project</a> has a ton of shapefiles for the entire world, both <a href="https://www.naturalearthdata.com/downloads/10m-physical-vectors/">physical</a> (i.e.&nbsp;rivers, coastlines, etc.) and <a href="https://www.naturalearthdata.com/downloads/10m-cultural-vectors/">cultural</a>, like borders for countries (what it calls <code>Admin-0</code>) and states/provinces (what it calls <code>Admin-1</code>). It offers three levels of resolution: 1:10 million (high resolution), 1:50 million (medium resolution), and 1:110 million (low resolution).</p>
<p>Plus, like {tigris}, <a href="https://ropensci.github.io/rnaturalearth/">the {rnaturalearth} package</a> makes it really easy to load that data directly into R.</p>
<p>Let’s follow the same process for Hawaiʻi, North Carolina, and Washington using Natural Earth data instead of Census data.</p>
<p>First, we’ll grab high resolution (1:10 million) maps from the <code>Admin-1</code> (states and provinces) data:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="st">"ne_data/ne_10m_admin_1_states_provinces_lakes.shp"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">ne_download</span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="st">"admin_1_states_provinces_lakes"</span>, </span>
<span>    scale <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    destdir <span class="op">=</span> <span class="st">"ne_data"</span>,</span>
<span>    load <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span> </span>
<span></span>
<span><span class="va">states_provinces</span> <span class="op">&lt;-</span> <span class="fu">ne_load</span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"admin_1_states_provinces_lakes"</span>, </span>
<span>  scale <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  destdir <span class="op">=</span> <span class="st">"ne_data"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We only need to work with three countries, not the entire world, so we’ll filter it down to just North America before joining everything into a single shape with <code>st_union()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">na_giant</span> <span class="op">&lt;-</span> <span class="va">states_provinces</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">admin</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"United States of America"</span>, <span class="st">"Canada"</span>, <span class="st">"Mexico"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_union</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_transform</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"ESRI:102003"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Convert to Albers for meters</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">na_giant</span>, linewidth <span class="op">=</span> <span class="fl">0</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"One big North America-shaped shape"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"ESRI:102003"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_ocean</span><span class="op">)</span>, </span>
<span>    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span><span class="fl">6.5</span>, <span class="fl">0</span>, <span class="fl">6.5</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-ne10-giant-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>(That’s so pretty.)</p>
<p>Next, we’ll extract all the US states from the Natural Earth data, since we want this big North American shape to match the states exactly:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ne_states</span> <span class="op">&lt;-</span> <span class="va">states_provinces</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">admin</span> <span class="op">==</span> <span class="st">"United States of America"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_transform</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"ESRI:102003"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">na_giant</span>, linewidth <span class="op">=</span> <span class="fl">0</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">ne_states</span>, linewidth <span class="op">=</span> <span class="fl">0.05</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"The United States overlaid on North America"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"ESRI:102003"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_ocean</span><span class="op">)</span>, </span>
<span>    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span><span class="fl">6.5</span>, <span class="fl">0</span>, <span class="fl">6.5</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-ne10-giant-with-states-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>Now we’ll go through the same process as before, using state shapes as cookie cutters from the larger North American shape and extracting non-interior borders.</p>
<section id="hawaiʻi" class="level3"><h3 class="anchored" data-anchor-id="hawaiʻi">Hawaiʻi</h3>
<p>Here are Hawaiʻi’s extracted borders—because we’re working with high resolution data, we get a lot more detail, including all the <a href="https://en.wikipedia.org/wiki/Northwestern_Hawaiian_Islands">Northwestern Hawaiian Islands</a>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ne_hi</span> <span class="op">&lt;-</span> <span class="va">ne_states</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Hawaii"</span><span class="op">)</span></span>
<span><span class="va">bbox_ne_hi</span> <span class="op">&lt;-</span> <span class="va">ne_hi</span> <span class="op">|&gt;</span> <span class="fu">st_transform</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4269"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">st_bbox</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hi_ocean_border_ne</span> <span class="op">&lt;-</span> <span class="va">ne_hi</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_buffer</span><span class="op">(</span>dist <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_difference</span><span class="op">(</span><span class="va">na_giant</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">hi_ocean_border_ne</span>, linewidth <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Hawaiʻi’s coastal borders extracted from North America shape"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span></span>
<span>    xlim <span class="op">=</span> <span class="va">bbox_ne_hi</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    ylim <span class="op">=</span> <span class="va">bbox_ne_hi</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4269"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-hi-ne-borders-extracted-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>As before, we can calculate the perimeter of the state, the perimeter of the coastline, and find the proportion. It’s 100%, as expected:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># State border</span></span>
<span><span class="va">hi_border_perimeter_ne</span> <span class="op">&lt;-</span> <span class="va">ne_hi</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_perimeter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">hi_border_perimeter_ne</span></span>
<span><span class="co">## 1458906 [m]</span></span>
<span><span class="fu">units</span><span class="fu">::</span><span class="fu">set_units</span><span class="op">(</span><span class="va">hi_border_perimeter_ne</span>, <span class="st">"miles"</span><span class="op">)</span></span>
<span><span class="co">## 906.5 [miles]</span></span>
<span></span>
<span><span class="co"># Coastal border</span></span>
<span><span class="va">hi_ocean_border_perimeter_ne</span> <span class="op">&lt;-</span> <span class="va">hi_ocean_border_ne</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_perimeter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">hi_ocean_border_perimeter_ne</span> <span class="op">/</span> <span class="fl">2</span></span>
<span><span class="co">## 1458906 [m]</span></span>
<span><span class="fu">units</span><span class="fu">::</span><span class="fu">set_units</span><span class="op">(</span><span class="va">hi_ocean_border_perimeter_ne</span> <span class="op">/</span> <span class="fl">2</span>, <span class="st">"miles"</span><span class="op">)</span></span>
<span><span class="co">## 906.5 [miles]</span></span>
<span></span>
<span><span class="co"># Proportion</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">(</span><span class="va">hi_ocean_border_perimeter_ne</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="va">hi_border_perimeter_ne</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">scales</span><span class="fu">::</span><span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## [1] "100%"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="north-carolina" class="level3"><h3 class="anchored" data-anchor-id="north-carolina">North Carolina</h3>
<p>The same process works for North Carolina</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ne_nc</span> <span class="op">&lt;-</span> <span class="va">ne_states</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"North Carolina"</span><span class="op">)</span></span>
<span><span class="va">bbox_ne_nc</span> <span class="op">&lt;-</span> <span class="va">ne_nc</span> <span class="op">|&gt;</span> <span class="fu">st_transform</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4269"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">st_bbox</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nc_ocean_border_ne</span> <span class="op">&lt;-</span> <span class="va">ne_nc</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_buffer</span><span class="op">(</span>dist <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_difference</span><span class="op">(</span><span class="va">na_giant</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">nc_ocean_border_ne</span>, linewidth <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"North Carolina’s coastal borders\nextracted from North America shape"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4269"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-nc-ne-borders-extracted-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>Here’s that extracted coastline with the rest of the state:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">na_giant</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">ne_nc</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">nc_ocean_border_ne</span>, linewidth <span class="op">=</span> <span class="fl">0.4</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Coastal border extracted from North America shape"</span><span class="op">)</span>,</span>
<span>    key_glyph <span class="op">=</span> <span class="va">draw_key_path</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.6</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.89</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"↑ Virginia ↑"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.58</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.3</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"↓ South Carolina ↓"</span>, angle <span class="op">=</span> <span class="fl">313</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.14</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"↓ Georgia"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.27</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.64</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"← Tennessee"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">clrs</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"The actual North Carolina coastline"</span>, color <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span></span>
<span>    xlim <span class="op">=</span> <span class="va">bbox_ne_nc</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    ylim <span class="op">=</span> <span class="va">bbox_ne_nc</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4269"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_ocean</span><span class="op">)</span>,</span>
<span>    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span><span class="fl">6.5</span>, <span class="fl">0</span>, <span class="fl">6.5</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    legend.key.height <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.5</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>    legend.key <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-nc-ne-coastal-borders-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>Now we can calculate proportion of coastline:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># State border</span></span>
<span><span class="va">nc_border_perimeter_ne</span> <span class="op">&lt;-</span> <span class="va">ne_nc</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_perimeter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">nc_border_perimeter_ne</span></span>
<span><span class="co">## 4095093 [m]</span></span>
<span><span class="fu">units</span><span class="fu">::</span><span class="fu">set_units</span><span class="op">(</span><span class="va">nc_border_perimeter_ne</span>, <span class="st">"miles"</span><span class="op">)</span></span>
<span><span class="co">## 2545 [miles]</span></span>
<span></span>
<span><span class="co"># Coastal border</span></span>
<span><span class="va">nc_ocean_border_perimeter_ne</span> <span class="op">&lt;-</span> <span class="va">nc_ocean_border_ne</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_perimeter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">nc_ocean_border_perimeter_ne</span> <span class="op">/</span> <span class="fl">2</span></span>
<span><span class="co">## 2596482 [m]</span></span>
<span><span class="fu">units</span><span class="fu">::</span><span class="fu">set_units</span><span class="op">(</span><span class="va">nc_ocean_border_perimeter_ne</span> <span class="op">/</span> <span class="fl">2</span>, <span class="st">"miles"</span><span class="op">)</span></span>
<span><span class="co">## 1613 [miles]</span></span>
<span></span>
<span><span class="co"># Proportion</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">(</span><span class="va">nc_ocean_border_perimeter_ne</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="va">nc_border_perimeter_ne</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">scales</span><span class="fu">::</span><span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## [1] "63%"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Sharp-eyed readers will notice something odd, though! Using Census maps at 1:5 million resolution, we found that 55% of North Carolina’s borders were coastline. Using Natural Earth maps at 1:10 million resolution, it becomes 63%. I’ll talk more about that discrepancy <a href="#the-coastline-paradox-and-map-resolutions">later in this post</a> (spoiler: it’s because of the new-to-me <a href="https://en.wikipedia.org/wiki/Coastline_paradox">Coastline Paradox</a>). The detail in the two maps is different, so the amount of landmass visible along the coastline is different, yielding different perimeters and distances.</p>
</section><section id="washington" class="level3"><h3 class="anchored" data-anchor-id="washington">Washington</h3>
<p>When we were using Census data, we couldn’t use this process with Washington because Canada was invisible and was being treated as an ocean. Now that we have data from Natural Earth, Canada can be accounted for and we’ll get the correct ocean-facing border.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ne_wa</span> <span class="op">&lt;-</span> <span class="va">ne_states</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Washington"</span><span class="op">)</span></span>
<span><span class="va">bbox_ne_wa</span> <span class="op">&lt;-</span> <span class="va">ne_wa</span> <span class="op">|&gt;</span> <span class="fu">st_transform</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4269"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">st_bbox</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wa_ocean_border_ne</span> <span class="op">&lt;-</span> <span class="va">ne_wa</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_buffer</span><span class="op">(</span>dist <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_difference</span><span class="op">(</span><span class="va">na_giant</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">wa_ocean_border_ne</span>, linewidth <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Washington’s coastal borders\nextracted from North America shape"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4269"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-wa-ne-borders-extracted-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>Here’s that coastline in context:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">na_giant</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">ne_wa</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">wa_ocean_border_ne</span>, linewidth <span class="op">=</span> <span class="fl">0.4</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Coastal border extracted from North America shape"</span><span class="op">)</span>,</span>
<span>    key_glyph <span class="op">=</span> <span class="va">draw_key_path</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.64</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.91</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"↑ Canada (British Columbia) ↑"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.54</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.18</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"↓ Oregon ↓"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.87</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"Idaho →"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">clrs</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"The actual Washington coastline"</span>, color <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span></span>
<span>    xlim <span class="op">=</span> <span class="va">bbox_ne_wa</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    ylim <span class="op">=</span> <span class="va">bbox_ne_wa</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4269"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_ocean</span><span class="op">)</span>,</span>
<span>    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span><span class="fl">6.5</span>, <span class="fl">0</span>, <span class="fl">6.5</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    legend.key.height <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.5</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>    legend.key <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-wa-ne-coastal-borders-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>Since the northern state border is no longer seen as a coastal border, can calculate the correct proportion of coastline:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># State border</span></span>
<span><span class="va">wa_border_perimeter_ne</span> <span class="op">&lt;-</span> <span class="va">ne_wa</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_perimeter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">wa_border_perimeter_ne</span></span>
<span><span class="co">## 3913863 [m]</span></span>
<span><span class="fu">units</span><span class="fu">::</span><span class="fu">set_units</span><span class="op">(</span><span class="va">wa_border_perimeter_ne</span>, <span class="st">"miles"</span><span class="op">)</span></span>
<span><span class="co">## 2432 [miles]</span></span>
<span></span>
<span><span class="co"># Coastal border</span></span>
<span><span class="va">wa_ocean_border_perimeter_ne</span> <span class="op">&lt;-</span> <span class="va">wa_ocean_border_ne</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_perimeter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">wa_ocean_border_perimeter_ne</span> <span class="op">/</span> <span class="fl">2</span></span>
<span><span class="co">## 2591575 [m]</span></span>
<span><span class="fu">units</span><span class="fu">::</span><span class="fu">set_units</span><span class="op">(</span><span class="va">wa_ocean_border_perimeter_ne</span> <span class="op">/</span> <span class="fl">2</span>, <span class="st">"miles"</span><span class="op">)</span></span>
<span><span class="co">## 1610 [miles]</span></span>
<span></span>
<span><span class="co"># Proportion</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">(</span><span class="va">wa_ocean_border_perimeter_ne</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="va">wa_border_perimeter_ne</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">scales</span><span class="fu">::</span><span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## [1] "66%"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="all-states" class="level3"><h3 class="anchored" data-anchor-id="all-states">All states</h3>
<p>Now that we know that the Natural Earth approach works, let’s apply it to all the states. We’ll nest the geographic data into a list column with a cell for each state, then extract the borders for each state</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ne_coastline</span> <span class="op">&lt;-</span> <span class="va">ne_states</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">nest</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>ocean_only <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">data</span>, <span class="op">~</span> <span class="op">{</span></span>
<span>    <span class="va">.x</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu">st_buffer</span><span class="op">(</span>dist <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu">st_difference</span><span class="op">(</span><span class="va">na_giant</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">unnest</span><span class="op">(</span><span class="va">ocean_only</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># This special column somehow lost its specialness</span></span>
<span>  <span class="fu">st_set_geometry</span><span class="op">(</span><span class="st">"geometry"</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">na_giant</span>, linewidth <span class="op">=</span> <span class="fl">0</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">ne_coastline</span>, linewidth <span class="op">=</span> <span class="fl">0.2</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Coastal border extracted from North America shape"</span><span class="op">)</span>,</span>
<span>    key_glyph <span class="op">=</span> <span class="va">draw_key_path</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">clrs</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"All US coastal borders"</span>, color <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"ESRI:102003"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_ocean</span><span class="op">)</span>,</span>
<span>    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span><span class="fl">6.5</span>, <span class="fl">0</span>, <span class="fl">6.5</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    legend.key.height <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.5</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>    legend.key <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-all-coastline-ne-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>That looks great!</p>
<p>Finally, let’s put this in a table. We’ll calculate the perimeter of all the states, then join that data to the coastal data, and then calculate the proportion of coastline.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ne_state_border_lengths</span> <span class="op">&lt;-</span> <span class="va">ne_states</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>border_length <span class="op">=</span> <span class="fu">st_perimeter</span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_drop_geometry</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">name</span>, <span class="va">border_length</span><span class="op">)</span></span>
<span></span>
<span><span class="va">coastline_length_by_state_ne</span> <span class="op">&lt;-</span> <span class="va">ne_coastline</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>coastline_length <span class="op">=</span> <span class="fu">st_perimeter</span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_drop_geometry</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">ne_state_border_lengths</span>, by <span class="op">=</span> <span class="fu">join_by</span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>prop_coastline <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">coastline_length</span> <span class="op">/</span> <span class="va">border_length</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>rank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rank.html">rank</a></span><span class="op">(</span><span class="op">-</span><span class="va">prop_coastline</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    <span class="fu">across</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">border_length</span>, <span class="va">coastline_length</span><span class="op">)</span>, </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>miles <span class="op">=</span> <span class="op">~</span><span class="fu">units</span><span class="fu">::</span><span class="fu">set_units</span><span class="op">(</span><span class="va">.</span>, <span class="st">"miles"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span></span>
<span>    <span class="va">name</span>, <span class="va">rank</span>, <span class="va">prop_coastline</span>, </span>
<span>    <span class="fu">starts_with</span><span class="op">(</span><span class="st">"border_length"</span><span class="op">)</span>, <span class="fu">starts_with</span><span class="op">(</span><span class="st">"coastline_length"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is fantastic! Hawaiʻi has the highest proportion of coastline, for obvious reasons, and an astounding 95% of Alaska’s borders touch the ocean, even though a huge chunk of the state shares a land border with Canada—there are just so many islands and inlets.</p>
<p>In the contiguous United States, island-y states like Florida, Michigan, and Louisiana have the highest proportion of coastline. Despite their small size, the coastal New England states like New Jersey, Massachusetts, and Rhode Island have a lot of coastline relative to the rest of their borders. Check out Rhode Island at #10—my wife’s offhand observation was pretty accurate! (These columns are sortable.)</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">coastline_length_by_state_ne</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">border_length</span>, <span class="op">-</span><span class="va">coastline_length</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">border_length_miles</span>, <span class="va">coastline_length_miles</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">prop_coastline</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">gt</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">cols_label</span><span class="op">(</span></span>
<span>    <span class="va">name</span> <span class="op">~</span> <span class="st">"State"</span>, </span>
<span>    <span class="va">rank</span> <span class="op">~</span> <span class="st">"Rank"</span>,</span>
<span>    <span class="va">prop_coastline</span> <span class="op">~</span> <span class="st">"% coastline"</span>,</span>
<span>    <span class="va">border_length_miles</span> <span class="op">~</span> <span class="st">"Border length (miles)"</span>,</span>
<span>    <span class="va">coastline_length_miles</span> <span class="op">~</span> <span class="st">"Coastline length (miles)"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">fmt_percent</span><span class="op">(</span></span>
<span>    columns <span class="op">=</span> <span class="va">prop_coastline</span>,</span>
<span>    decimals <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">fmt_number</span><span class="op">(</span></span>
<span>    columns <span class="op">=</span> <span class="fu">ends_with</span><span class="op">(</span><span class="st">"miles"</span><span class="op">)</span>,</span>
<span>    decimals <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">opt_interactive</span><span class="op">(</span>page_size_default <span class="op">=</span> <span class="fl">16</span>, use_compact_mode <span class="op">=</span> <span class="cn">TRUE</span>, use_highlight <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">opt_table_font</span><span class="op">(</span><span class="st">"Libre Franklin"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="dhhsbqvqxn" class=".gt_table" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#dhhsbqvqxn table {
  font-family: 'Libre Franklin', system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#dhhsbqvqxn thead, #dhhsbqvqxn tbody, #dhhsbqvqxn tfoot, #dhhsbqvqxn tr, #dhhsbqvqxn td, #dhhsbqvqxn th {
  border-style: none;
}

#dhhsbqvqxn p {
  margin: 0;
  padding: 0;
}

#dhhsbqvqxn .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#dhhsbqvqxn .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#dhhsbqvqxn .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#dhhsbqvqxn .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#dhhsbqvqxn .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dhhsbqvqxn .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dhhsbqvqxn .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dhhsbqvqxn .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#dhhsbqvqxn .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#dhhsbqvqxn .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#dhhsbqvqxn .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#dhhsbqvqxn .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#dhhsbqvqxn .gt_spanner_row {
  border-bottom-style: hidden;
}

#dhhsbqvqxn .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#dhhsbqvqxn .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#dhhsbqvqxn .gt_from_md > :first-child {
  margin-top: 0;
}

#dhhsbqvqxn .gt_from_md > :last-child {
  margin-bottom: 0;
}

#dhhsbqvqxn .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#dhhsbqvqxn .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#dhhsbqvqxn .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#dhhsbqvqxn .gt_row_group_first td {
  border-top-width: 2px;
}

#dhhsbqvqxn .gt_row_group_first th {
  border-top-width: 2px;
}

#dhhsbqvqxn .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dhhsbqvqxn .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#dhhsbqvqxn .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#dhhsbqvqxn .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dhhsbqvqxn .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dhhsbqvqxn .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#dhhsbqvqxn .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#dhhsbqvqxn .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#dhhsbqvqxn .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dhhsbqvqxn .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dhhsbqvqxn .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dhhsbqvqxn .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dhhsbqvqxn .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dhhsbqvqxn .gt_left {
  text-align: left;
}

#dhhsbqvqxn .gt_center {
  text-align: center;
}

#dhhsbqvqxn .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#dhhsbqvqxn .gt_font_normal {
  font-weight: normal;
}

#dhhsbqvqxn .gt_font_bold {
  font-weight: bold;
}

#dhhsbqvqxn .gt_font_italic {
  font-style: italic;
}

#dhhsbqvqxn .gt_super {
  font-size: 65%;
}

#dhhsbqvqxn .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#dhhsbqvqxn .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#dhhsbqvqxn .gt_indent_1 {
  text-indent: 5px;
}

#dhhsbqvqxn .gt_indent_2 {
  text-indent: 10px;
}

#dhhsbqvqxn .gt_indent_3 {
  text-indent: 15px;
}

#dhhsbqvqxn .gt_indent_4 {
  text-indent: 20px;
}

#dhhsbqvqxn .gt_indent_5 {
  text-indent: 25px;
}

#dhhsbqvqxn .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#dhhsbqvqxn div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<div id="dhhsbqvqxn" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="dhhsbqvqxn">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"name":["Hawaii","Alaska","Florida","Michigan","New Jersey","Washington","Louisiana","Massachusetts","Maryland","Rhode Island","North Carolina","Maine","New York","California","Delaware","Virginia","Wisconsin","South Carolina","Connecticut","Texas","Oregon","Georgia","Ohio","District of Columbia","Alabama","Mississippi","Minnesota","Pennsylvania","Illinois","Indiana","New Hampshire"],"rank":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],"prop_coastline":[1.00000002305719,0.950356743835664,0.866168192243435,0.830979983940767,0.728816503449743,0.662152795310262,0.654314581445184,0.654108863415661,0.651446703084627,0.637147952416471,0.634047014369978,0.62340643184199,0.593173451960401,0.590058431541649,0.511361993061225,0.505330354491681,0.451669337880791,0.447885940985075,0.378139483577159,0.372858710272812,0.32946858227647,0.234051531206005,0.230535075884157,0.222097678934753,0.182423646280105,0.145388849315363,0.0940002244112465,0.086326481085529,0.0478578044572803,0.0416353715802241,0.0376899575172537],"border_length_miles":[906.521886547635,24866.234473789,3458.36073177283,2752.32413875135,665.766399521454,2431.96179010171,2237.82207853154,954.049030861188,1733.0905012548,302.971423449822,2544.57301885066,1677.04565289963,1998.40034151875,2886.95130942461,296.33200227838,2062.13873186231,1370.80550447945,1091.85454262226,356.162508399253,4068.22109594084,1537.6350636342,1302.59642649316,999.983576641033,36.7733271116633,1180.66135054376,1184.30972223058,1604.67088013519,957.47472629315,1200.85938547766,987.018260921426,491.715226799401],"coastline_length_miles":[906.521907449481,23631.7936259643,2995.52206316535,2287.12626861938,485.221539413551,1610.3302974036,1464.23961666316,624.051927219425,1129.01609318972,193.037622091758,1613.37892544867,1045.48104651028,1185.39802897752,1703.4699615762,151.532923292896,1042.061296383,619.150814571575,489.026299241198,134.679106995639,1516.87167093715,506.602444474149,304.874688164196,230.531289723851,8.16727059820884,215.380548588185,172.185427748101,150.8394228389,82.6554238492177,57.4704936508795,41.0948720499302,18.5327260086562]},"columns":[{"id":"name","name":"State","type":"character","minWidth":125,"style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","cell":["Hawaii","Alaska","Florida","Michigan","New Jersey","Washington","Louisiana","Massachusetts","Maryland","Rhode Island","North Carolina","Maine","New York","California","Delaware","Virginia","Wisconsin","South Carolina","Connecticut","Texas","Oregon","Georgia","Ohio","District of Columbia","Alabama","Mississippi","Minnesota","Pennsylvania","Illinois","Indiana","New Hampshire"],"html":true,"align":"left","headerStyle":{"font-weight":"normal"}},{"id":"rank","name":"Rank","type":"numeric","minWidth":125,"style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","cell":["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31"],"html":true,"align":"right","headerStyle":{"font-weight":"normal"}},{"id":"prop_coastline","name":"% coastline","type":"numeric","minWidth":125,"style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","cell":["100.0%","95.0%","86.6%","83.1%","72.9%","66.2%","65.4%","65.4%","65.1%","63.7%","63.4%","62.3%","59.3%","59.0%","51.1%","50.5%","45.2%","44.8%","37.8%","37.3%","32.9%","23.4%","23.1%","22.2%","18.2%","14.5%","9.4%","8.6%","4.8%","4.2%","3.8%"],"html":true,"align":"right","headerStyle":{"font-weight":"normal"}},{"id":"border_length_miles","name":"Border length (miles)","type":"numeric","minWidth":125,"style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","cell":["907","24,866","3,458","2,752","666","2,432","2,238","954","1,733","303","2,545","1,677","1,998","2,887","296","2,062","1,371","1,092","356","4,068","1,538","1,303","1,000","37","1,181","1,184","1,605","957","1,201","987","492"],"html":true,"align":"right","headerStyle":{"font-weight":"normal"}},{"id":"coastline_length_miles","name":"Coastline length (miles)","type":"numeric","minWidth":125,"style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","cell":["907","23,632","2,996","2,287","485","1,610","1,464","624","1,129","193","1,613","1,045","1,185","1,703","152","1,042","619","489","135","1,517","507","305","231","8","215","172","151","83","57","41","19"],"html":true,"align":"right","headerStyle":{"font-weight":"normal"}}],"defaultPageSize":16,"showPageSizeOptions":false,"pageSizeOptions":[10,25,50,100],"paginationType":"numbers","showPagination":true,"showPageInfo":true,"minRows":1,"highlight":true,"compact":true,"height":"auto","theme":{"color":"#333333","backgroundColor":"#FFFFFF","stripedColor":"rgba(128,128,128,0.05)","style":{"fontFamily":"'Libre Franklin', system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif"},"tableStyle":{"borderTopStyle":"solid","borderTopWidth":"2px","borderTopColor":"#D3D3D3"},"headerStyle":{"borderBottomStyle":"solid","borderBottomWidth":"2px","borderBottomColor":"#D3D3D3"}},"elementId":"dhhsbqvqxn","dataKey":"d0c5fa42bb98519f25d2a8275e41e22c"},"children":[]},"class":"reactR_markup"},"evals":["tag.attribs.columns.0.style","tag.attribs.columns.1.style","tag.attribs.columns.2.style","tag.attribs.columns.3.style","tag.attribs.columns.4.style"],"jsHooks":[]}</script>
</div>
</div>
</div>
</section><section id="highlighting-coastal-states" class="level3"><h3 class="anchored" data-anchor-id="highlighting-coastal-states">Highlighting coastal states</h3>
<p>There are 31 states (technically 30 + Washington, D.C.) that touch the ocean or one of the Great Lakes somewhere. For bonus fun, we can highlight them on a map to show what we’re working with. For the sake of plotting, and to show off one really neat feature in {tigris}, we’ll shift Alaska and Hawaiʻi around so that they’re where Mexico would be.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ne_states_to_plot</span> <span class="op">&lt;-</span> <span class="va">ne_states</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>is_coastal <span class="op">=</span> <span class="va">name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">ne_coastline</span><span class="op">$</span><span class="va">name</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tigris</span><span class="fu">::</span><span class="fu">shift_geometry</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">ne_states_to_plot</span>, <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">is_coastal</span><span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.05</span>, color <span class="op">=</span> <span class="st">"grey70"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="va">clrs</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span><span class="op">)</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"US states with a coastline"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-coastal-states-binary-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>That’s cool, but we can make it fancier. Right now we’ve filled all the coastal states with red, but it would be neat to fill them with different colors. We <em>could</em> use <code>aes(fill = name)</code>, but that would give us 31 different indistinguishable colors.</p>
<p>Another approach would be to choose a smaller number of colors (like 5) and assign them across the coastal states. But how we allocate these colors is a little tricky. If we assign them randomly, or based on alphabetical order, or some other system, we’ll get bordering states that share the same color, which looks bad aesthetically (and reduces the map’s readability and usability). For example, here we assign the colors 1–5 to the coastal states alphabetically, and we end up with blobs like Wisconsin + Michigan + Indiana, Pennsylvania + New Jersey + Delaware, Virginia + Maryland, and North + South Carolina. That’s not great.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ne_states_to_plot_colors_alphabetic</span> <span class="op">&lt;-</span> <span class="va">ne_states</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>is_coastal <span class="op">=</span> <span class="va">name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">ne_coastline</span><span class="op">$</span><span class="va">name</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">name</span>, <span class="va">is_coastal</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">is_coastal</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>coastal_colors <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>    <span class="va">is_coastal</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, length.out <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     .default <span class="op">=</span> <span class="cn">NA</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tigris</span><span class="fu">::</span><span class="fu">shift_geometry</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">ne_states_to_plot_colors_alphabetic</span>, <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">coastal_colors</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.05</span>, color <span class="op">=</span> <span class="st">"grey70"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">2</span>, <span class="fl">7</span>, <span class="fl">8</span><span class="op">)</span><span class="op">]</span>, na.value <span class="op">=</span> <span class="st">"grey95"</span>, guide <span class="op">=</span> <span class="st">"none"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"US states with a coastline"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-coastal-states-5-but-bad-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>There are ways to color <em>all</em> US states with <a href="https://en.wikipedia.org/wiki/Four_color_theorem">four</a> or <a href="https://en.wikipedia.org/wiki/Five_color_theorem">five</a> unique colors, but we don’t really want to do that here because we’re ignoring all the non-coastal states and want a balanced set of colors.</p>
<p>So we can use a neat approach where we pretend this map is a circle. We’ll start with some state and assign it color 1. We’ll then move along the exterior of the circle clockwise and assign the next state to color 2, then the next state color 3, and so on until we loop all the way around the circle back to the first state. That <em>should</em> give us noncontiguous colors around the whole border.</p>
<p>We’ll omit Alaska and Hawaiʻi for this part, since we can assign them any arbitrary colors later. We’ll first find the center of each state, then find the northernmost state as the starting point, and then calculate the angle of every other state in relation to the starting state. We can then sort the data by the angle and assign the colors 1–5 in order.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calculate the center of each coastal state in the lower 48</span></span>
<span><span class="va">coastal_states_centers</span> <span class="op">&lt;-</span> <span class="va">ne_states</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">ne_coastline</span><span class="op">$</span><span class="va">name</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Alaska"</span>, <span class="st">"Hawaii"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>centroid <span class="op">=</span> <span class="fu">st_centroid</span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>centroid_coords <span class="op">=</span> <span class="fu">st_coordinates</span><span class="op">(</span><span class="va">centroid</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    longitude <span class="op">=</span> <span class="va">centroid_coords</span><span class="op">[</span>, <span class="st">"X"</span><span class="op">]</span>,</span>
<span>    latitude <span class="op">=</span> <span class="va">centroid_coords</span><span class="op">[</span>, <span class="st">"Y"</span><span class="op">]</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">centroid_coords</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Find the northernmost state (Washington) to use as a reference point</span></span>
<span><span class="va">northest_state</span> <span class="op">&lt;-</span> <span class="va">coastal_states_centers</span> <span class="op">|&gt;</span> <span class="fu">slice_max</span><span class="op">(</span>order_by <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the angle from the northernmost state to the center of all other</span></span>
<span><span class="co"># states, then arrange by angle so that the states are all sorted clockwise</span></span>
<span><span class="va">coastal_states_angles</span> <span class="op">&lt;-</span> <span class="va">coastal_states_centers</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    angle_rad <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">atan2</a></span><span class="op">(</span></span>
<span>      <span class="va">longitude</span> <span class="op">-</span> <span class="va">northest_state</span><span class="op">$</span><span class="va">longitude</span>, </span>
<span>      <span class="va">latitude</span> <span class="op">-</span> <span class="va">northest_state</span><span class="op">$</span><span class="va">latitude</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="co"># Not really necessary, but I can't think in radians</span></span>
<span>    angle_deg <span class="op">=</span> <span class="va">angle_rad</span> <span class="op">*</span> <span class="op">(</span><span class="fl">180</span> <span class="op">/</span> <span class="va">pi</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">angle_rad</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>color_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, length.out <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is really cool. California and Oregon are both directly south of Washington, so they are at a nearly −180° (or −1π rad) angle from that state. The circle then jumps over to New England (since Maine is at a 90° or π/2 rad angle from Washington) before coming back to the Midwest, then looping down along the east and south coasts, ending with Texas.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">coastal_states_angles</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_drop_geometry</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">name</span>, <span class="va">angle_rad</span>, <span class="va">angle_deg</span>, <span class="va">color_group</span><span class="op">)</span></span>
<span><span class="co">##                    name angle_rad angle_deg color_group</span></span>
<span><span class="co">## 1            California    -2.960   -169.57           1</span></span>
<span><span class="co">## 2                Oregon    -2.861   -163.93           2</span></span>
<span><span class="co">## 3            Washington     0.000      0.00           3</span></span>
<span><span class="co">## 4                 Maine     1.613     92.44           4</span></span>
<span><span class="co">## 5         New Hampshire     1.676     96.01           5</span></span>
<span><span class="co">## 6         Massachusetts     1.716     98.33           1</span></span>
<span><span class="co">## 7              New York     1.728     98.99           2</span></span>
<span><span class="co">## 8          Rhode Island     1.730     99.10           3</span></span>
<span><span class="co">## 9           Connecticut     1.741     99.76           4</span></span>
<span><span class="co">## 10            Minnesota     1.751    100.35           5</span></span>
<span><span class="co">## 11             Michigan     1.766    101.19           1</span></span>
<span><span class="co">## 12            Wisconsin     1.795    102.86           2</span></span>
<span><span class="co">## 13           New Jersey     1.798    103.02           3</span></span>
<span><span class="co">## 14         Pennsylvania     1.810    103.70           4</span></span>
<span><span class="co">## 15             Delaware     1.839    105.36           5</span></span>
<span><span class="co">## 16             Maryland     1.851    106.07           1</span></span>
<span><span class="co">## 17 District of Columbia     1.858    106.44           2</span></span>
<span><span class="co">## 18                 Ohio     1.883    107.88           3</span></span>
<span><span class="co">## 19             Virginia     1.917    109.86           4</span></span>
<span><span class="co">## 20              Indiana     1.940    111.18           5</span></span>
<span><span class="co">## 21             Illinois     1.976    113.22           1</span></span>
<span><span class="co">## 22       North Carolina     1.977    113.26           2</span></span>
<span><span class="co">## 23       South Carolina     2.040    116.89           3</span></span>
<span><span class="co">## 24              Georgia     2.112    121.01           4</span></span>
<span><span class="co">## 25              Alabama     2.168    124.20           5</span></span>
<span><span class="co">## 26              Florida     2.186    125.25           1</span></span>
<span><span class="co">## 27          Mississippi     2.223    127.37           2</span></span>
<span><span class="co">## 28            Louisiana     2.317    132.77           3</span></span>
<span><span class="co">## 29                Texas     2.493    142.82           4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we have better color assignments, we can make a nicer map with unique colors for each state:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">coastal_state_colors</span> <span class="op">&lt;-</span> <span class="va">coastal_states_angles</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_drop_geometry</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># No need for geography stuff </span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">name</span>, <span class="va">color_group</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Add Alaska and Hawaii back; the last color assigned was 4, so continue with 5</span></span>
<span>  <span class="fu">add_row</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Alaska"</span>, color_group <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">add_row</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Hawaii"</span>, color_group <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ne_states_to_plot_colors</span> <span class="op">&lt;-</span> <span class="va">ne_states</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">coastal_state_colors</span>, by <span class="op">=</span> <span class="fu">join_by</span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tigris</span><span class="fu">::</span><span class="fu">shift_geometry</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">ne_states_to_plot_colors</span>, <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">color_group</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.05</span>, color <span class="op">=</span> <span class="st">"grey70"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">2</span>, <span class="fl">7</span>, <span class="fl">8</span><span class="op">)</span><span class="op">]</span>, na.value <span class="op">=</span> <span class="st">"grey95"</span>, guide <span class="op">=</span> <span class="st">"none"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"US states with a coastline"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-coastal-states-5-but-good-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="the-coastline-paradox-and-map-resolutions" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="the-coastline-paradox-and-map-resolutions">The Coastline Paradox and map resolutions</h2>
<p>Calculating these coastline lengths has been a tricky (but fun!) journey so far, involving all sorts of GIS shenanigans to extract borders from overlapping shapefiles. So far we’ve really only dealt with technical challenges, like finding the right kinds of shapefiles.</p>
<p>But in the course of writing this post and figuring all of this out, I stumbled on a deeper, more philosophical challenge: <a href="https://en.wikipedia.org/wiki/Coastline_paradox">the Coastline Paradox</a>. Weirdly, <strong>coastlines don’t have well-defined lengths</strong>. The measured length of a coastline depends on how detailed the map is, and <strong>more detail isn’t actually better</strong>.</p>
<section id="hypothetical-coastline-at-different-resolutions" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="hypothetical-coastline-at-different-resolutions">Hypothetical coastline at different resolutions</h3>
<p>To illustrate this, let’s invent a fake coastline with lots of jagged edges. If we take a boat a few miles offshore and sail from one end to the other in a straight line, it’s 500 miles long. If we walk from one end to the other and walk as close as possible to the water, however, it’s 14,000 miles long. That’s a huge discrepancy.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html">with_seed</a></span><span class="op">(</span><span class="fl">12345</span>, <span class="op">{</span></span>
<span>  <span class="va">example_coastline</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, length.out <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>, </span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">500</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">st_linestring</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">total_distance</span> <span class="op">&lt;-</span> <span class="va">example_coastline</span> <span class="op">|&gt;</span> <span class="fu">st_length</span><span class="op">(</span><span class="op">)</span> <span class="op">*</span> <span class="fl">50</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">example_coastline</span>, linewidth <span class="op">=</span> <span class="fl">0.35</span>, color <span class="op">=</span> <span class="st">"grey60"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"errorbar"</span>, xmin <span class="op">=</span> <span class="fl">0</span>, xmax <span class="op">=</span> <span class="fl">10</span>, y <span class="op">=</span> <span class="fl">2.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">5</span>, y <span class="op">=</span> <span class="fl">2.6</span>, </span>
<span>    label <span class="op">=</span> <span class="st">"500 miles"</span>, </span>
<span>    family <span class="op">=</span> <span class="st">"Overpass ExtraBold"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">5</span>, y <span class="op">=</span> <span class="fl">2</span>, </span>
<span>    label <span class="op">=</span> <span class="st">"Straight distance"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"errorbar"</span>, xmin <span class="op">=</span> <span class="fl">0</span>, xmax <span class="op">=</span> <span class="fl">10</span>, y <span class="op">=</span> <span class="op">-</span><span class="fl">2.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">5</span>, y <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, </span>
<span>    label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu">scales</span><span class="fu">::</span><span class="fu">label_comma</span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="va">total_distance</span><span class="op">)</span>, <span class="st">" miles"</span><span class="op">)</span>, </span>
<span>    family <span class="op">=</span> <span class="st">"Overpass ExtraBold"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">5</span>, y <span class="op">=</span> <span class="op">-</span><span class="fl">2.6</span>, </span>
<span>    label <span class="op">=</span> <span class="st">"Total distance following complete path"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-fake-coastline-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>14,000 miles feels excessive, and no map includes that much detail. Maps have different resolutions that define how much detail is included, scaling 10 kilomters in real life to 1 centimeter in the map, or 500 km to 1 cm, or 110 km to 1 cm, and so on. We need to adjust the resolution of our fictional coastline and simplify and smooth out the line.</p>
<p>However, the border length changes dramatically the more we simplify:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://strimas.com/smoothr/">smoothr</a></span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'smoothr'</span></span>
<span><span class="co">## The following object is masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     smooth</span></span>
<span></span>
<span><span class="va">example_coastlines</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>  tolerance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">1.3</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>full_coast <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">example_coastline</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>simplified_coast <span class="op">=</span> <span class="fu">map2</span><span class="op">(</span></span>
<span>    <span class="va">full_coast</span>, <span class="va">tolerance</span>, <span class="op">~</span><span class="fu">st_simplify</span><span class="op">(</span><span class="va">.x</span>, dTolerance <span class="op">=</span> <span class="va">.y</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>simplified_coast <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">simplified_coast</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/smooth.html">smooth</a></span><span class="op">(</span><span class="va">.x</span>, method <span class="op">=</span> <span class="st">"ksmooth"</span>, smoothness <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>simplified_coast <span class="op">=</span> <span class="fu">st_sfc</span><span class="op">(</span><span class="va">simplified_coast</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>distance <span class="op">=</span> <span class="fu">st_length</span><span class="op">(</span><span class="va">simplified_coast</span><span class="op">)</span> <span class="op">*</span> <span class="fl">50</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>plot <span class="op">=</span> <span class="fu">pmap</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">distance</span>, <span class="va">full_coast</span>, <span class="va">simplified_coast</span><span class="op">)</span>, <span class="op">~</span><span class="op">{</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">..2</span>, linewidth <span class="op">=</span> <span class="fl">0.15</span>, color <span class="op">=</span> <span class="st">"grey70"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">..3</span>, linewidth <span class="op">=</span> <span class="fl">0.6</span>, color <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu">scales</span><span class="fu">::</span><span class="fu">label_comma</span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="va">..1</span><span class="op">)</span>, <span class="st">" miles"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">wrap_plots</span><span class="op">(</span><span class="va">example_coastlines</span><span class="op">$</span><span class="va">plot</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-fake-coastline-different-resolution-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>So which one of those is right? How long is the actual coastline? Is it 14,000 miles? 5,000 miles? 2,500 miles? 1,000 miles? 500 miles? There’s no right answer.</p>
<p>The length shrinks as we decrease the resolution, and the length grows as we increase the resolution. Coastlines behave almost like <a href="https://en.wikipedia.org/wiki/Fractal">fractals</a>—as you zoom in more and more and more, the length can increase almost infinitely.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Imagine that we want to be hyper precise when measuring the coastline and we include any boulders or trees or driftwood poking into the water from the shore. Then imagine that we include all the little bumps and imperfections in the boulders and all the edges of the shattered wood in the broken logs. The coastline will become <em>enormously</em> long.</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;Not <em>actually</em> infinitely, since there is a finite amount of land, but still.</p></div></div></section><section id="dubai-and-artificial-coastlines" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="dubai-and-artificial-coastlines">Dubai and artificial coastlines</h3>
<p>This isn’t just hypothetical. In the early 2000s, in an effort to increase the coastline available for construction, Dubai started building a <a href="https://en.wikipedia.org/wiki/Palm_Islands">series of artificial islands in the shape of palm trees</a>, and <a href="https://en.wikipedia.org/wiki/The_World_(archipelago)">one in the shape of the world</a>.</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="img/Dubai_new_developments.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption class="margin-caption">Island developments in Dubai in 2010, <a href="https://commons.wikimedia.org/w/index.php?curid=38517839">by Wikipedia user Lencer</a></figcaption></figure>
</div>
<p>How do we count how much coastline Dubai added with these islands? Do we only count the outer circles of Palm Jumeirah, Palm Deira, and Palm Jebel Ali? The island designers cut canals through those outer circles for boat access—do we count the border for each of those segments? If so, it more than doubles the coastline. Do we count the palm fronds within each of the circles? We probably should! That then adds another huge chunk of coastline. What if the island designers added hundreds of little bays into each of the fronds, creating the illusion of separate leaves? That would exponentially increase the coastline length. Each of those tiny islands in The World archipelago should probably get added to the coastline too.</p>
<p>At the extreme, Dubai could build a single actual fractal-shaped island and become a mathematical island—there would be so much coastline that the proportion of coastline to land borders would basically be 100%.</p>
</section></section><section id="use-lower-resolution-natural-earth-coastlines" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="use-lower-resolution-natural-earth-coastlines">Use lower resolution Natural Earth coastlines</h2>
<p>Earlier, we used high resolution (1:10 million) data from Natural Earth to calculate the proportion of coastline for each state. But this might have been too ambitious. We found that 95% of Alaska’s borders touch the ocean, despite its huge land border with Canada. Because the map data had such high resolution, we picked up lots of details in each of the <a href="https://en.wikipedia.org/wiki/Aleutian_Islands">Aleutian Islands</a>, as well as every little inlet and bay on the mainland.</p>
<p>What happens if we use low resolution data instead, like Natural Earth’s 1:110 million maps? How much does that influence the rankings of the proportion of coastline?</p>
<p>Let’s grab the 1:110 million data from Natural Earth and try it out.</p>
<p><strong>But first, a warning.</strong> We won’t be able to get exact answers with this data. The key to extracting coastlines from states earlier was to use data for all of North America. Natural Earth provided state/province-level data for the United States, Mexico, and Canada, and we merged all those administrative units into one big giant landmass, which guaranteed that the individual Natural Earth state shapes matched the overall landmass perfectly. This won’t work with other Natural Earth resolutions. At 1:50 million, Natural Earth does not include Mexican states; at 1:110 million, Natural Earth <em>only</em> includes the United States. We can’t make a consistent unified North American landmass at these resolutions. We can get close—we can get country-level data at 1:110 million and create a merged North American shape, but it won’t match the state borders exactly.</p>
<p>Nevertheless, we’ll try.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Country-level data</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="st">"ne_data/ne_110m_admin_0_countries_lakes.shp"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">ne_download</span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="st">"admin_0_countries_lakes"</span>, </span>
<span>    scale <span class="op">=</span> <span class="fl">110</span>,</span>
<span>    destdir <span class="op">=</span> <span class="st">"ne_data"</span>,</span>
<span>    load <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">world_110</span> <span class="op">&lt;-</span> <span class="fu">ne_load</span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"admin_0_countries_lakes"</span>, </span>
<span>  scale <span class="op">=</span> <span class="fl">110</span>,</span>
<span>  destdir <span class="op">=</span> <span class="st">"ne_data"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make a unified North America shape</span></span>
<span><span class="va">na_giant_110</span> <span class="op">&lt;-</span> <span class="va">world_110</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">NAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"United States of America"</span>, <span class="st">"Canada"</span>, <span class="st">"Mexico"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_transform</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"ESRI:102003"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_union</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># State-level data</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="st">"ne_data/ne_110m_admin_1_states_provinces_lakes.shp"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">ne_download</span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="st">"admin_1_states_provinces_lakes"</span>, </span>
<span>    scale <span class="op">=</span> <span class="fl">110</span>,</span>
<span>    destdir <span class="op">=</span> <span class="st">"ne_data"</span>,</span>
<span>    load <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">states_110</span> <span class="op">&lt;-</span> <span class="fu">ne_load</span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"admin_1_states_provinces_lakes"</span>, </span>
<span>  scale <span class="op">=</span> <span class="fl">110</span>,</span>
<span>  destdir <span class="op">=</span> <span class="st">"ne_data"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">admin</span> <span class="op">==</span> <span class="st">"United States of America"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_transform</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"ESRI:102003"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Rename these for consistency with the 110 versions</span></span>
<span><span class="va">states_10</span> <span class="op">&lt;-</span> <span class="va">ne_states</span></span>
<span><span class="va">na_giant_10</span> <span class="op">&lt;-</span> <span class="va">na_giant</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">na_giant_10</span>, linewidth <span class="op">=</span> <span class="fl">0</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">states_10</span>, linewidth <span class="op">=</span> <span class="fl">0.05</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"High resolution"</span>, subtitle <span class="op">=</span> <span class="st">"1:10 million"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_ocean</span><span class="op">)</span>, </span>
<span>    plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span><span class="fl">6.5</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">6.5</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">na_giant_110</span>, linewidth <span class="op">=</span> <span class="fl">0</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">states_110</span>, linewidth <span class="op">=</span> <span class="fl">0.05</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Low resolution"</span>, subtitle <span class="op">=</span> <span class="st">"1:110 million"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_ocean</span><span class="op">)</span>, </span>
<span>    plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span><span class="fl">6.5</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">6.5</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">|</span> <span class="va">p2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p class="page-columns page-full"><img src="index_files/figure-html/plot-na-ne-different-resolutions-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-page" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>We can already see some sizable differences in the detail in the border. The low resolution version drops most of the Aleutian Islands, removes North Carolina’s Outer Banks, and greatly simplifies Washington’s Puget Sound.</p>
<p>Let’s zoom in on Hawaiʻi for fun. The high resolution version looks great; the low resolution one looks like it was drawn in Minecraft.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">hi_110</span> <span class="op">&lt;-</span> <span class="va">states_110</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Hawaii"</span><span class="op">)</span></span>
<span><span class="va">hi_10</span> <span class="op">&lt;-</span> <span class="va">states_10</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Hawaii"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bbox_hi_110</span> <span class="op">&lt;-</span> <span class="va">hi_110</span> <span class="op">|&gt;</span> <span class="fu">st_transform</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4269"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">st_bbox</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">hi_10</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"High resolution"</span>, subtitle <span class="op">=</span> <span class="st">"1:10 million"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span></span>
<span>    xlim <span class="op">=</span> <span class="va">bbox_hi_110</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    ylim <span class="op">=</span> <span class="va">bbox_hi_110</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4269"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_ocean</span><span class="op">)</span>, </span>
<span>    plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span><span class="fl">6.5</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">6.5</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">hi_110</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Low resolution"</span>, subtitle <span class="op">=</span> <span class="st">"1:110 million"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span></span>
<span>    xlim <span class="op">=</span> <span class="va">bbox_hi_110</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    ylim <span class="op">=</span> <span class="va">bbox_hi_110</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4269"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_ocean</span><span class="op">)</span>, </span>
<span>    plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span><span class="fl">6.5</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">6.5</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">|</span> <span class="va">p2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-hi-ne-different-resolutions-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>We can go through the same process as before, extracting the coastal borders from the larger North American shape, then finding the coast-to-border proportion:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extract the Hawaiian borders from the low resolution North America shape</span></span>
<span><span class="va">hi_ocean_border_110</span> <span class="op">&lt;-</span> <span class="va">hi_110</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_buffer</span><span class="op">(</span>dist <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_difference</span><span class="op">(</span><span class="va">na_giant_110</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># State border</span></span>
<span><span class="va">hi_border_perimeter_110</span> <span class="op">&lt;-</span> <span class="va">hi_110</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_perimeter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">hi_border_perimeter_110</span></span>
<span><span class="co">## 1078669 [m]</span></span>
<span><span class="fu">units</span><span class="fu">::</span><span class="fu">set_units</span><span class="op">(</span><span class="va">hi_border_perimeter_110</span>, <span class="st">"miles"</span><span class="op">)</span></span>
<span><span class="co">## 670.3 [miles]</span></span>
<span></span>
<span><span class="co"># Coastal border</span></span>
<span><span class="va">hi_ocean_border_perimeter_110</span> <span class="op">&lt;-</span> <span class="va">hi_ocean_border_110</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_perimeter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">hi_ocean_border_perimeter_110</span> <span class="op">/</span> <span class="fl">2</span></span>
<span><span class="co">## 1078669 [m]</span></span>
<span><span class="fu">units</span><span class="fu">::</span><span class="fu">set_units</span><span class="op">(</span><span class="va">hi_ocean_border_perimeter_110</span> <span class="op">/</span> <span class="fl">2</span>, <span class="st">"miles"</span><span class="op">)</span></span>
<span><span class="co">## 670.3 [miles]</span></span>
<span></span>
<span><span class="co"># Proportion</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">(</span><span class="va">hi_ocean_border_perimeter_110</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="va">hi_border_perimeter_110</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">scales</span><span class="fu">::</span><span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## [1] "100%"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The simplified borders reduced the coastline by 200+ miles, but we still have the correct proportion.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">units</span><span class="fu">::</span><span class="fu">set_units</span><span class="op">(</span><span class="va">hi_border_perimeter</span> <span class="op">-</span> <span class="va">hi_border_perimeter_110</span>, <span class="st">"miles"</span><span class="op">)</span></span>
<span><span class="co">## 207.9 [miles]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can do the same thing to all the states. But we actually run into serious issues here. The shapefile for the state borders doesn’t precisely match the shapefile for the country borders, so the states don’t perfectly overlap with the large North American shape. There are small (and some large) gaps in the coastal borders. To try to account for this, we’ll add a 100 meter buffer around all the individual state borders (instead of 1 mm like before), but even then, there are some gaps.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ne_states_ocean_borders_110</span> <span class="op">&lt;-</span> <span class="va">states_110</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">nest</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>ocean_only <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">data</span>, <span class="op">~</span> <span class="op">{</span></span>
<span>    <span class="va">.x</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu">st_buffer</span><span class="op">(</span>dist <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">st_difference</span><span class="op">(</span><span class="va">na_giant_110</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ne_coastline_110</span> <span class="op">&lt;-</span> <span class="va">ne_states_ocean_borders_110</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">unnest</span><span class="op">(</span><span class="va">ocean_only</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_set_geometry</span><span class="op">(</span><span class="st">"geometry"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For instance, here’s Washington, which has a big gap in the southwest border:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">wa_110</span> <span class="op">&lt;-</span> <span class="va">states_110</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Washington"</span><span class="op">)</span></span>
<span><span class="va">wa_10</span> <span class="op">&lt;-</span> <span class="va">states_10</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Washington"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bbox_wa_110</span> <span class="op">&lt;-</span> <span class="va">wa_110</span> <span class="op">|&gt;</span> <span class="fu">st_transform</span><span class="op">(</span><span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4269"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">st_bbox</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">na_giant_110</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">states_110</span>, <span class="va">name</span> <span class="op">==</span> <span class="st">"Washington"</span><span class="op">)</span>, </span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.1</span>, fill <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">ne_coastline_110</span>, <span class="va">name</span> <span class="op">==</span> <span class="st">"Washington"</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">0.8</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Coastal border extracted from low resolution North America shape"</span><span class="op">)</span>,</span>
<span>    key_glyph <span class="op">=</span> <span class="va">draw_key_path</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.64</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.91</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"↑ Canada (British Columbia) ↑"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.54</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.18</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"↓ Oregon ↓"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.87</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"Idaho →"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">clrs</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Low resolution Washington coastline"</span>, color <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span></span>
<span>    xlim <span class="op">=</span> <span class="va">bbox_wa_110</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    ylim <span class="op">=</span> <span class="va">bbox_wa_110</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    crs <span class="op">=</span> <span class="fu">st_crs</span><span class="op">(</span><span class="st">"EPSG:4269"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_map</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">clr_ocean</span><span class="op">)</span>,</span>
<span>    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span><span class="fl">6.5</span>, <span class="fl">0</span>, <span class="fl">6.5</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    legend.key.height <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.5</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>    legend.key <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-wa-coastline-110-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>If Natural Earth had 1:110 million-resolution data for US states, Mexican states, and Canadian provinces, all would be well. Alas.</p>
<p>So with the caveat that there are sizable gaps in the coastal borders, let’s look at the proportions:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Find all low-resolution state perimeters</span></span>
<span><span class="va">ne_state_border_lengths_110</span> <span class="op">&lt;-</span> <span class="va">states_110</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>border_length <span class="op">=</span> <span class="fu">st_perimeter</span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_drop_geometry</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">name</span>, <span class="va">border_length</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate coastline perimeters and ratio of coast to border</span></span>
<span><span class="va">coastline_length_by_state_ne_110</span> <span class="op">&lt;-</span> <span class="va">ne_coastline_110</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>coastline_length <span class="op">=</span> <span class="fu">st_perimeter</span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">st_drop_geometry</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">ne_state_border_lengths_110</span>, by <span class="op">=</span> <span class="fu">join_by</span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Cheat a little because, with the 100 meter buffer, Hawaii's coastline is</span></span>
<span>  <span class="co"># slightly larger than its border</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>border_length <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>    <span class="va">name</span> <span class="op">==</span> <span class="st">"Hawaii"</span> <span class="op">~</span> <span class="va">coastline_length</span>,</span>
<span>    .default <span class="op">=</span> <span class="va">border_length</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>prop_coastline <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">coastline_length</span> <span class="op">/</span> <span class="va">border_length</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>rank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rank.html">rank</a></span><span class="op">(</span><span class="op">-</span><span class="va">prop_coastline</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    <span class="fu">across</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">border_length</span>, <span class="va">coastline_length</span><span class="op">)</span>, </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>miles <span class="op">=</span> <span class="op">~</span><span class="fu">units</span><span class="fu">::</span><span class="fu">set_units</span><span class="op">(</span><span class="va">.</span>, <span class="st">"miles"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span></span>
<span>    <span class="va">name</span>, <span class="va">rank</span>, <span class="va">prop_coastline</span>, </span>
<span>    <span class="fu">starts_with</span><span class="op">(</span><span class="st">"border_length"</span><span class="op">)</span>, <span class="fu">starts_with</span><span class="op">(</span><span class="st">"coastline_length"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The proportions and rankings changed a bit here. Alaska is now only 83% coastline instead of 95%. Michigan and Florida are still the top coastal states from the contiguous United States, but the New England states dropped substantially. Since the complex inlets and islands in New England were smoothed over, California rose from #14 to #6. (These columns are sortable.)</p>
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">coastline_length_by_state_ne_110</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">border_length</span>, <span class="op">-</span><span class="va">coastline_length</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">border_length_miles</span>, <span class="va">coastline_length_miles</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">prop_coastline</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">gt</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">cols_label</span><span class="op">(</span></span>
<span>    <span class="va">name</span> <span class="op">~</span> <span class="st">"State"</span>, </span>
<span>    <span class="va">rank</span> <span class="op">~</span> <span class="st">"Rank"</span>,</span>
<span>    <span class="va">prop_coastline</span> <span class="op">~</span> <span class="st">"% coastline"</span>,</span>
<span>    <span class="va">border_length_miles</span> <span class="op">~</span> <span class="st">"Border length (miles)"</span>,</span>
<span>    <span class="va">coastline_length_miles</span> <span class="op">~</span> <span class="st">"Coastline length (miles)"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">fmt_percent</span><span class="op">(</span></span>
<span>    columns <span class="op">=</span> <span class="va">prop_coastline</span>,</span>
<span>    decimals <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">fmt_number</span><span class="op">(</span></span>
<span>    columns <span class="op">=</span> <span class="fu">ends_with</span><span class="op">(</span><span class="st">"miles"</span><span class="op">)</span>,</span>
<span>    decimals <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">opt_interactive</span><span class="op">(</span>page_size_default <span class="op">=</span> <span class="fl">16</span>, use_compact_mode <span class="op">=</span> <span class="cn">TRUE</span>, use_highlight <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">opt_table_font</span><span class="op">(</span><span class="st">"Libre Franklin"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="ckvcroqdal" class=".gt_table" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ckvcroqdal table {
  font-family: 'Libre Franklin', system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ckvcroqdal thead, #ckvcroqdal tbody, #ckvcroqdal tfoot, #ckvcroqdal tr, #ckvcroqdal td, #ckvcroqdal th {
  border-style: none;
}

#ckvcroqdal p {
  margin: 0;
  padding: 0;
}

#ckvcroqdal .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ckvcroqdal .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ckvcroqdal .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ckvcroqdal .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ckvcroqdal .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ckvcroqdal .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ckvcroqdal .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ckvcroqdal .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ckvcroqdal .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ckvcroqdal .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ckvcroqdal .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ckvcroqdal .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ckvcroqdal .gt_spanner_row {
  border-bottom-style: hidden;
}

#ckvcroqdal .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ckvcroqdal .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ckvcroqdal .gt_from_md > :first-child {
  margin-top: 0;
}

#ckvcroqdal .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ckvcroqdal .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ckvcroqdal .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ckvcroqdal .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ckvcroqdal .gt_row_group_first td {
  border-top-width: 2px;
}

#ckvcroqdal .gt_row_group_first th {
  border-top-width: 2px;
}

#ckvcroqdal .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ckvcroqdal .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ckvcroqdal .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ckvcroqdal .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ckvcroqdal .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ckvcroqdal .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ckvcroqdal .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ckvcroqdal .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ckvcroqdal .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ckvcroqdal .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ckvcroqdal .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ckvcroqdal .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ckvcroqdal .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ckvcroqdal .gt_left {
  text-align: left;
}

#ckvcroqdal .gt_center {
  text-align: center;
}

#ckvcroqdal .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ckvcroqdal .gt_font_normal {
  font-weight: normal;
}

#ckvcroqdal .gt_font_bold {
  font-weight: bold;
}

#ckvcroqdal .gt_font_italic {
  font-style: italic;
}

#ckvcroqdal .gt_super {
  font-size: 65%;
}

#ckvcroqdal .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ckvcroqdal .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ckvcroqdal .gt_indent_1 {
  text-indent: 5px;
}

#ckvcroqdal .gt_indent_2 {
  text-indent: 10px;
}

#ckvcroqdal .gt_indent_3 {
  text-indent: 15px;
}

#ckvcroqdal .gt_indent_4 {
  text-indent: 20px;
}

#ckvcroqdal .gt_indent_5 {
  text-indent: 25px;
}

#ckvcroqdal .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#ckvcroqdal div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<div id="ckvcroqdal" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="ckvcroqdal">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"name":["Hawaii","Alaska","Michigan","Florida","New Jersey","California","Massachusetts","Wisconsin","New York","Louisiana","Washington","Delaware","Connecticut","Maine","Maryland","Rhode Island","South Carolina","North Carolina","Oregon","Virginia","Ohio","Texas","Minnesota","Georgia","Mississippi","Alabama","Illinois","Pennsylvania","Indiana","New Hampshire"],"rank":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],"prop_coastline":[1,0.826578721839132,0.741230447949974,0.70154802868831,0.47529559334139,0.422559323559038,0.410708306434224,0.355180351974834,0.354279041306692,0.333777372096147,0.3256024347498,0.318664195896749,0.307550772932554,0.302629334295,0.282171574916153,0.264742634974663,0.2442815493506,0.226048378695959,0.213948321352267,0.204011190556984,0.185691532669522,0.149331287408419,0.098464687558646,0.0937730536615907,0.0726300736282431,0.053049660810459,0.0512965303125375,0.0471220896703173,0.0453829546186212,0.0372701159213773],"border_length_miles":[671.224472430645,7064.61261206206,1849.39945636081,1551.13037089299,448.648412783552,2010.55600171779,555.355988652821,1122.82629692482,1332.53491833872,1116.88549171443,1279.1308138037,253.70004201216,317.318368579482,820.759060979213,874.6238483293,150.636228561968,768.685653920999,1234.43700410869,1349.35360041347,1326.68665688154,878.659060461396,2728.3798092644,1520.30264933558,1061.42620470295,1001.67418972791,1011.52143734185,1120.21615370549,928.16767640141,882.92776157891,480.967167884413],"coastline_length_miles":[671.224472430645,5839.45846316687,1370.83118747676,1088.19245393855,213.240613555631,849.579184063431,228.089317567704,398.805839348358,472.089193376734,372.791104356756,416.488107337978,80.8451198867764,97.5915095223168,248.385768240728,246.793988742305,39.8798320721412,187.775722503401,279.042483381066,288.6919377191,270.658924366469,163.159547631039,407.43246945659,149.69612536141,99.5331764514286,72.7516701514489,53.6608691534929,57.4632018851479,43.7372004764773,40.0698705352565,17.9257021014286]},"columns":[{"id":"name","name":"State","type":"character","minWidth":125,"style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","cell":["Hawaii","Alaska","Michigan","Florida","New Jersey","California","Massachusetts","Wisconsin","New York","Louisiana","Washington","Delaware","Connecticut","Maine","Maryland","Rhode Island","South Carolina","North Carolina","Oregon","Virginia","Ohio","Texas","Minnesota","Georgia","Mississippi","Alabama","Illinois","Pennsylvania","Indiana","New Hampshire"],"html":true,"align":"left","headerStyle":{"font-weight":"normal"}},{"id":"rank","name":"Rank","type":"numeric","minWidth":125,"style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","cell":["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30"],"html":true,"align":"right","headerStyle":{"font-weight":"normal"}},{"id":"prop_coastline","name":"% coastline","type":"numeric","minWidth":125,"style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","cell":["100.0%","82.7%","74.1%","70.2%","47.5%","42.3%","41.1%","35.5%","35.4%","33.4%","32.6%","31.9%","30.8%","30.3%","28.2%","26.5%","24.4%","22.6%","21.4%","20.4%","18.6%","14.9%","9.8%","9.4%","7.3%","5.3%","5.1%","4.7%","4.5%","3.7%"],"html":true,"align":"right","headerStyle":{"font-weight":"normal"}},{"id":"border_length_miles","name":"Border length (miles)","type":"numeric","minWidth":125,"style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","cell":["671","7,065","1,849","1,551","449","2,011","555","1,123","1,333","1,117","1,279","254","317","821","875","151","769","1,234","1,349","1,327","879","2,728","1,520","1,061","1,002","1,012","1,120","928","883","481"],"html":true,"align":"right","headerStyle":{"font-weight":"normal"}},{"id":"coastline_length_miles","name":"Coastline length (miles)","type":"numeric","minWidth":125,"style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","cell":["671","5,839","1,371","1,088","213","850","228","399","472","373","416","81","98","248","247","40","188","279","289","271","163","407","150","100","73","54","57","44","40","18"],"html":true,"align":"right","headerStyle":{"font-weight":"normal"}}],"defaultPageSize":16,"showPageSizeOptions":false,"pageSizeOptions":[10,25,50,100],"paginationType":"numbers","showPagination":true,"showPageInfo":true,"minRows":1,"highlight":true,"compact":true,"height":"auto","theme":{"color":"#333333","backgroundColor":"#FFFFFF","stripedColor":"rgba(128,128,128,0.05)","style":{"fontFamily":"'Libre Franklin', system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif"},"tableStyle":{"borderTopStyle":"solid","borderTopWidth":"2px","borderTopColor":"#D3D3D3"},"headerStyle":{"borderBottomStyle":"solid","borderBottomWidth":"2px","borderBottomColor":"#D3D3D3"}},"elementId":"ckvcroqdal","dataKey":"e6237b8a1f0f0b084170827cc65b6325"},"children":[]},"class":"reactR_markup"},"evals":["tag.attribs.columns.0.style","tag.attribs.columns.1.style","tag.attribs.columns.2.style","tag.attribs.columns.3.style","tag.attribs.columns.4.style"],"jsHooks":[]}</script>
</div>
</div>
</div>
<hr class="dinkus">
<p>We’ll make one more table to make it easier to compare the rankings and proportions for the different resolutions.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> (These columns are sortable, by the way.)</p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;<a href="https://en.wikipedia.org/wiki/List_of_U.S._states_and_territories_by_coastline">Wikipedia has a similar table</a> with different rankings based on different maps and projections and resolutions, though they don’t rank the coast-to-border proportion like we’ve been doing.</p></div></div><div class="cell page-columns page-full" data-layout-align="center">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tbl_10</span> <span class="op">&lt;-</span> <span class="va">coastline_length_by_state_ne</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span></span>
<span>    <span class="va">name</span>, rank_10 <span class="op">=</span> <span class="va">rank</span>, prop_coastline_10 <span class="op">=</span> <span class="va">prop_coastline</span>,</span>
<span>    border_length_10 <span class="op">=</span> <span class="va">border_length_miles</span>, coastline_length_10 <span class="op">=</span> <span class="va">coastline_length_miles</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">tbl_110</span> <span class="op">&lt;-</span> <span class="va">coastline_length_by_state_ne_110</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span></span>
<span>    <span class="va">name</span>, rank_110 <span class="op">=</span> <span class="va">rank</span>, prop_coastline_110 <span class="op">=</span> <span class="va">prop_coastline</span>,</span>
<span>    border_length_110 <span class="op">=</span> <span class="va">border_length_miles</span>, coastline_length_110 <span class="op">=</span> <span class="va">coastline_length_miles</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">tbl_10</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">tbl_110</span>, by <span class="op">=</span> <span class="fu">join_by</span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">contains</span><span class="op">(</span><span class="st">"length"</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">rank_10</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">gt</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">cols_label</span><span class="op">(</span></span>
<span>    <span class="va">name</span> <span class="op">~</span> <span class="st">"State"</span>, </span>
<span>    <span class="va">rank_10</span> <span class="op">~</span> <span class="st">"Rank"</span>,</span>
<span>    <span class="va">rank_110</span> <span class="op">~</span> <span class="st">"Rank"</span>,</span>
<span>    <span class="va">prop_coastline_10</span> <span class="op">~</span> <span class="st">"% coastline"</span>,</span>
<span>    <span class="va">prop_coastline_110</span> <span class="op">~</span> <span class="st">"% coastline"</span>,</span>
<span>    <span class="va">border_length_10</span> <span class="op">~</span> <span class="st">"Border length (miles)"</span>,</span>
<span>    <span class="va">border_length_110</span> <span class="op">~</span> <span class="st">"Border length (miles)"</span>,</span>
<span>    <span class="va">coastline_length_10</span> <span class="op">~</span> <span class="st">"Coastline length (miles)"</span>,</span>
<span>    <span class="va">coastline_length_110</span> <span class="op">~</span> <span class="st">"Coastline length (miles)"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sub_missing</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tab_spanner</span><span class="op">(</span></span>
<span>    label <span class="op">=</span> <span class="st">"High resolution (1:10 million)"</span>,</span>
<span>    columns <span class="op">=</span> <span class="fu">ends_with</span><span class="op">(</span><span class="st">"_10"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tab_spanner</span><span class="op">(</span></span>
<span>    label <span class="op">=</span> <span class="st">"Low resolution (1:110 million)"</span>,</span>
<span>    columns <span class="op">=</span> <span class="fu">ends_with</span><span class="op">(</span><span class="st">"_110"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">fmt_percent</span><span class="op">(</span></span>
<span>    columns <span class="op">=</span> <span class="fu">starts_with</span><span class="op">(</span><span class="st">"prop_"</span><span class="op">)</span>,</span>
<span>    decimals <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">fmt_number</span><span class="op">(</span></span>
<span>    columns <span class="op">=</span> <span class="fu">contains</span><span class="op">(</span><span class="st">"length"</span><span class="op">)</span>,</span>
<span>    decimals <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">opt_interactive</span><span class="op">(</span>use_pagination <span class="op">=</span> <span class="cn">FALSE</span>, use_compact_mode <span class="op">=</span> <span class="cn">TRUE</span>, use_highlight <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">opt_table_font</span><span class="op">(</span><span class="st">"Libre Franklin"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display column-page">
<div id="kxevslqsij" class=".gt_table" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#kxevslqsij table {
  font-family: 'Libre Franklin', system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#kxevslqsij thead, #kxevslqsij tbody, #kxevslqsij tfoot, #kxevslqsij tr, #kxevslqsij td, #kxevslqsij th {
  border-style: none;
}

#kxevslqsij p {
  margin: 0;
  padding: 0;
}

#kxevslqsij .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#kxevslqsij .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#kxevslqsij .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#kxevslqsij .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#kxevslqsij .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kxevslqsij .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kxevslqsij .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kxevslqsij .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#kxevslqsij .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#kxevslqsij .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#kxevslqsij .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#kxevslqsij .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#kxevslqsij .gt_spanner_row {
  border-bottom-style: hidden;
}

#kxevslqsij .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#kxevslqsij .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#kxevslqsij .gt_from_md > :first-child {
  margin-top: 0;
}

#kxevslqsij .gt_from_md > :last-child {
  margin-bottom: 0;
}

#kxevslqsij .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#kxevslqsij .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#kxevslqsij .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#kxevslqsij .gt_row_group_first td {
  border-top-width: 2px;
}

#kxevslqsij .gt_row_group_first th {
  border-top-width: 2px;
}

#kxevslqsij .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kxevslqsij .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#kxevslqsij .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#kxevslqsij .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kxevslqsij .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kxevslqsij .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#kxevslqsij .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#kxevslqsij .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#kxevslqsij .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kxevslqsij .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kxevslqsij .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kxevslqsij .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kxevslqsij .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kxevslqsij .gt_left {
  text-align: left;
}

#kxevslqsij .gt_center {
  text-align: center;
}

#kxevslqsij .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#kxevslqsij .gt_font_normal {
  font-weight: normal;
}

#kxevslqsij .gt_font_bold {
  font-weight: bold;
}

#kxevslqsij .gt_font_italic {
  font-style: italic;
}

#kxevslqsij .gt_super {
  font-size: 65%;
}

#kxevslqsij .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#kxevslqsij .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#kxevslqsij .gt_indent_1 {
  text-indent: 5px;
}

#kxevslqsij .gt_indent_2 {
  text-indent: 10px;
}

#kxevslqsij .gt_indent_3 {
  text-indent: 15px;
}

#kxevslqsij .gt_indent_4 {
  text-indent: 20px;
}

#kxevslqsij .gt_indent_5 {
  text-indent: 25px;
}

#kxevslqsij .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#kxevslqsij div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<div id="kxevslqsij" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="kxevslqsij">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"name":["Hawaii","Alaska","Florida","Michigan","New Jersey","Washington","Louisiana","Massachusetts","Maryland","Rhode Island","North Carolina","Maine","New York","California","Delaware","Virginia","Wisconsin","South Carolina","Connecticut","Texas","Oregon","Georgia","Ohio","District of Columbia","Alabama","Mississippi","Minnesota","Pennsylvania","Illinois","Indiana","New Hampshire"],"rank_10":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],"prop_coastline_10":[1.00000002305719,0.950356743835664,0.866168192243435,0.830979983940767,0.728816503449743,0.662152795310262,0.654314581445184,0.654108863415661,0.651446703084627,0.637147952416471,0.634047014369978,0.62340643184199,0.593173451960401,0.590058431541649,0.511361993061225,0.505330354491681,0.451669337880791,0.447885940985075,0.378139483577159,0.372858710272812,0.32946858227647,0.234051531206005,0.230535075884157,0.222097678934753,0.182423646280105,0.145388849315363,0.0940002244112465,0.086326481085529,0.0478578044572803,0.0416353715802241,0.0376899575172537],"border_length_10":[906.521886547635,24866.234473789,3458.36073177283,2752.32413875135,665.766399521454,2431.96179010171,2237.82207853154,954.049030861188,1733.0905012548,302.971423449822,2544.57301885066,1677.04565289963,1998.40034151875,2886.95130942461,296.33200227838,2062.13873186231,1370.80550447945,1091.85454262226,356.162508399253,4068.22109594084,1537.6350636342,1302.59642649316,999.983576641033,36.7733271116633,1180.66135054376,1184.30972223058,1604.67088013519,957.47472629315,1200.85938547766,987.018260921426,491.715226799401],"coastline_length_10":[906.521907449481,23631.7936259643,2995.52206316535,2287.12626861938,485.221539413551,1610.3302974036,1464.23961666316,624.051927219425,1129.01609318972,193.037622091758,1613.37892544867,1045.48104651028,1185.39802897752,1703.4699615762,151.532923292896,1042.061296383,619.150814571575,489.026299241198,134.679106995639,1516.87167093715,506.602444474149,304.874688164196,230.531289723851,8.16727059820884,215.380548588185,172.185427748101,150.8394228389,82.6554238492177,57.4704936508795,41.0948720499302,18.5327260086562],"rank_110":[1,2,4,3,5,11,10,7,15,16,18,14,9,6,12,20,8,17,13,22,19,24,21,"NA",26,25,23,28,27,29,30],"prop_coastline_110":[1,0.826578721839132,0.70154802868831,0.741230447949974,0.47529559334139,0.3256024347498,0.333777372096147,0.410708306434224,0.282171574916153,0.264742634974663,0.226048378695959,0.302629334295,0.354279041306692,0.422559323559038,0.318664195896749,0.204011190556984,0.355180351974834,0.2442815493506,0.307550772932554,0.149331287408419,0.213948321352267,0.0937730536615907,0.185691532669522,"NA",0.053049660810459,0.0726300736282431,0.098464687558646,0.0471220896703173,0.0512965303125375,0.0453829546186212,0.0372701159213773],"border_length_110":[671.224472430645,7064.61261206206,1551.13037089299,1849.39945636081,448.648412783552,1279.1308138037,1116.88549171443,555.355988652821,874.6238483293,150.636228561968,1234.43700410869,820.759060979213,1332.53491833872,2010.55600171779,253.70004201216,1326.68665688154,1122.82629692482,768.685653920999,317.318368579482,2728.3798092644,1349.35360041347,1061.42620470295,878.659060461396,"NA",1011.52143734185,1001.67418972791,1520.30264933558,928.16767640141,1120.21615370549,882.92776157891,480.967167884413],"coastline_length_110":[671.224472430645,5839.45846316687,1088.19245393855,1370.83118747676,213.240613555631,416.488107337978,372.791104356756,228.089317567704,246.793988742305,39.8798320721412,279.042483381066,248.385768240728,472.089193376734,849.579184063431,80.8451198867764,270.658924366469,398.805839348358,187.775722503401,97.5915095223168,407.43246945659,288.6919377191,99.5331764514286,163.159547631039,"NA",53.6608691534929,72.7516701514489,149.69612536141,43.7372004764773,57.4632018851479,40.0698705352565,17.9257021014286]},"columns":[{"id":"name","name":"State","type":"character","minWidth":125,"style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","cell":["Hawaii","Alaska","Florida","Michigan","New Jersey","Washington","Louisiana","Massachusetts","Maryland","Rhode Island","North Carolina","Maine","New York","California","Delaware","Virginia","Wisconsin","South Carolina","Connecticut","Texas","Oregon","Georgia","Ohio","District of Columbia","Alabama","Mississippi","Minnesota","Pennsylvania","Illinois","Indiana","New Hampshire"],"html":true,"align":"left","headerStyle":{"font-weight":"normal"}},{"id":"rank_10","name":"Rank","type":"numeric","minWidth":125,"style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","cell":["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31"],"html":true,"align":"right","headerStyle":{"font-weight":"normal"}},{"id":"prop_coastline_10","name":"% coastline","type":"numeric","minWidth":125,"style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","cell":["100.0%","95.0%","86.6%","83.1%","72.9%","66.2%","65.4%","65.4%","65.1%","63.7%","63.4%","62.3%","59.3%","59.0%","51.1%","50.5%","45.2%","44.8%","37.8%","37.3%","32.9%","23.4%","23.1%","22.2%","18.2%","14.5%","9.4%","8.6%","4.8%","4.2%","3.8%"],"html":true,"align":"right","headerStyle":{"font-weight":"normal"}},{"id":"border_length_10","name":"Border length (miles)","type":"numeric","minWidth":125,"style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","cell":["907","24,866","3,458","2,752","666","2,432","2,238","954","1,733","303","2,545","1,677","1,998","2,887","296","2,062","1,371","1,092","356","4,068","1,538","1,303","1,000","37","1,181","1,184","1,605","957","1,201","987","492"],"html":true,"align":"right","headerStyle":{"font-weight":"normal"}},{"id":"coastline_length_10","name":"Coastline length (miles)","type":"numeric","minWidth":125,"style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","cell":["907","23,632","2,996","2,287","485","1,610","1,464","624","1,129","193","1,613","1,045","1,185","1,703","152","1,042","619","489","135","1,517","507","305","231","8","215","172","151","83","57","41","19"],"html":true,"align":"right","headerStyle":{"font-weight":"normal"}},{"id":"rank_110","name":"Rank","type":"numeric","minWidth":125,"style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","cell":["1","2","4","3","5","11","10","7","15","16","18","14","9","6","12","20","8","17","13","22","19","24","21","—","26","25","23","28","27","29","30"],"html":true,"align":"right","headerStyle":{"font-weight":"normal"}},{"id":"prop_coastline_110","name":"% coastline","type":"numeric","minWidth":125,"style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","cell":["100.0%","82.7%","70.2%","74.1%","47.5%","32.6%","33.4%","41.1%","28.2%","26.5%","22.6%","30.3%","35.4%","42.3%","31.9%","20.4%","35.5%","24.4%","30.8%","14.9%","21.4%","9.4%","18.6%","—","5.3%","7.3%","9.8%","4.7%","5.1%","4.5%","3.7%"],"html":true,"align":"right","headerStyle":{"font-weight":"normal"}},{"id":"border_length_110","name":"Border length (miles)","type":"numeric","minWidth":125,"style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","cell":["671","7,065","1,551","1,849","449","1,279","1,117","555","875","151","1,234","821","1,333","2,011","254","1,327","1,123","769","317","2,728","1,349","1,061","879","—","1,012","1,002","1,520","928","1,120","883","481"],"html":true,"align":"right","headerStyle":{"font-weight":"normal"}},{"id":"coastline_length_110","name":"Coastline length (miles)","type":"numeric","minWidth":125,"style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","cell":["671","5,839","1,088","1,371","213","416","373","228","247","40","279","248","472","850","81","271","399","188","98","407","289","100","163","—","54","73","150","44","57","40","18"],"html":true,"align":"right","headerStyle":{"font-weight":"normal"}}],"columnGroups":[{"name":"High resolution (1:10 million)","header":"High resolution (1:10 million)","html":true,"headerStyle":{"fontWeight":"normal","borderBottomStyle":"solid","borderBottomWidth":"2px","borderBottomColor":"#D3D3D3","borderLeftStyle":"solid","borderLeftWidth":"4px","borderLeftColor":"transparent","borderRightStyle":"solid","borderRightWidth":"4px","borderRightColor":"transparent"},"columns":["rank_10","prop_coastline_10","border_length_10","coastline_length_10"]},{"name":"Low resolution (1:110 million)","header":"Low resolution (1:110 million)","html":true,"headerStyle":{"fontWeight":"normal","borderBottomStyle":"solid","borderBottomWidth":"2px","borderBottomColor":"#D3D3D3","borderLeftStyle":"solid","borderLeftWidth":"4px","borderLeftColor":"transparent","borderRightStyle":"solid","borderRightWidth":"4px","borderRightColor":"transparent"},"columns":["rank_110","prop_coastline_110","border_length_110","coastline_length_110"]}],"pagination":false,"defaultPageSize":10,"showPageSizeOptions":false,"pageSizeOptions":[10,25,50,100],"paginationType":"numbers","showPagination":false,"showPageInfo":true,"minRows":1,"highlight":true,"compact":true,"height":"auto","theme":{"color":"#333333","backgroundColor":"#FFFFFF","stripedColor":"rgba(128,128,128,0.05)","style":{"fontFamily":"'Libre Franklin', system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif"},"tableStyle":{"borderTopStyle":"solid","borderTopWidth":"2px","borderTopColor":"#D3D3D3"},"headerStyle":{"borderBottomStyle":"solid","borderBottomWidth":"2px","borderBottomColor":"#D3D3D3"}},"elementId":"kxevslqsij","dataKey":"3ad99a13b22293a043d71e78100781fb"},"children":[]},"class":"reactR_markup"},"evals":["tag.attribs.columns.0.style","tag.attribs.columns.1.style","tag.attribs.columns.2.style","tag.attribs.columns.3.style","tag.attribs.columns.4.style","tag.attribs.columns.5.style","tag.attribs.columns.6.style","tag.attribs.columns.7.style","tag.attribs.columns.8.style"],"jsHooks":[]}</script>
</div>
</div>
</div>


<!-- -->

</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{heiss2024,
  author = {Heiss, Andrew},
  title = {Calculating the Proportion of {US} State Borders That Are
    Coastlines},
  date = {2024-05-08},
  url = {https://www.andrewheiss.com/blog/2024/05/08/coastline-to-border-proportions/},
  doi = {10.59350/wzn5q-wxk02},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-heiss2024" class="csl-entry quarto-appendix-citeas" role="listitem">
Heiss, Andrew. 2024. <span>“Calculating the Proportion of US State
Borders That Are Coastlines.”</span> May 8, 2024. <a href="https://doi.org/10.59350/wzn5q-wxk02">https://doi.org/10.59350/wzn5q-wxk02</a>.
</div></div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.andrewheiss\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><script src="https://giscus.app/client.js" data-repo="andrewheiss/ath-quarto" data-repo-id="R_kgDOIg6EJQ" data-category="Blog comments" data-category-id="DIC_kwDOIg6EJc4CSz92" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><input type="hidden" id="giscus-base-theme" value="light"><input type="hidden" id="giscus-alt-theme" value="dark"><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb57" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Calculating the proportion of US state borders that are coastlines"</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2024-05-08</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Measuring coastlines is hard and causes fractal paradoxes, but we can use R and {sf} to try!"</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> "index_files/figure-html/plot-nc-census-coastal-borders-1.png"</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="an">twitter-card:</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co">  image: "index_files/figure-html/plot-nc-census-coastal-borders-1.png"</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="an">open-graph:</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="co">  image: "index_files/figure-html/plot-nc-census-coastal-borders-1.png"</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="co">  - r</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="co">  - tidyverse</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a><span class="co">  - ggplot</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="co">  - gis</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="co">  - maps</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a><span class="co">  html: </span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a><span class="co">    shift-heading-level-by: 1</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a><span class="co">    include-in-header:</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a><span class="co">      - text: |</span></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a><span class="co">          &lt;style type="text/css"&gt;</span></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a><span class="co">          hr.dinkus {</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a><span class="co">              width: 50px;</span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a><span class="co">              margin: 2em auto 2em;</span></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a><span class="co">              border-top: 5px dotted #454545;</span></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a><span class="co">          }</span></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a><span class="co">          </span></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a><span class="co">          div.column-margin+hr.dinkus {</span></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a><span class="co">              margin: 1em auto 2em;</span></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a><span class="co">          }</span></span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a><span class="co">          &lt;/style&gt;</span></span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a><span class="an">doi:</span><span class="co"> 10.59350/wzn5q-wxk02</span></span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a><span class="an">citation:</span><span class="co"> true</span></span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig.width =</span> <span class="dv">6</span>,</span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig.height =</span> <span class="dv">6</span> <span class="sc">*</span> <span class="fl">0.618</span>,</span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig.retina =</span> <span class="dv">3</span>,</span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">dev =</span> <span class="st">"ragg_png"</span>,</span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig.align =</span> <span class="st">"center"</span>,</span>
<span id="cb57-48"><a href="#cb57-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">out.width =</span> <span class="st">"95%"</span>,</span>
<span id="cb57-49"><a href="#cb57-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">collapse =</span> <span class="cn">TRUE</span>,</span>
<span id="cb57-50"><a href="#cb57-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">warning =</span> <span class="cn">FALSE</span>,</span>
<span id="cb57-51"><a href="#cb57-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">cache.extra =</span> <span class="dv">1234</span>  <span class="co"># Change number to invalidate cache</span></span>
<span id="cb57-52"><a href="#cb57-52" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-53"><a href="#cb57-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-54"><a href="#cb57-54" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(</span>
<span id="cb57-55"><a href="#cb57-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">digits =</span> <span class="dv">4</span>,</span>
<span id="cb57-56"><a href="#cb57-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">300</span></span>
<span id="cb57-57"><a href="#cb57-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-58"><a href="#cb57-58" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-59"><a href="#cb57-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-60"><a href="#cb57-60" aria-hidden="true" tabindex="-1"></a>A few days ago, my wife, a bunch of my kids, and I were huddled around a big wall map of the United States, joking about the relative unimportance of <span class="co">[</span><span class="ot">Rhode Island</span><span class="co">](https://en.wikipedia.org/wiki/Rhode_Island)</span>, the smallest state in the US. It's <span class="co">[</span><span class="ot">one of the states I never ever think about</span><span class="co">](https://twitter.com/andrewheiss/status/1258088903543853059)</span>:</span>
<span id="cb57-61"><a href="#cb57-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-62"><a href="#cb57-62" aria-hidden="true" tabindex="-1"></a>!<span class="co">[</span><span class="ot">Tweet by me from [May 6, 2020](https://twitter.com/andrewheiss/status/1258088903543853059)</span><span class="co">](img/ignored-states-tweet.png)</span>{width=70%}</span>
<span id="cb57-63"><a href="#cb57-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-64"><a href="#cb57-64" aria-hidden="true" tabindex="-1"></a>…and it's just so *small*.</span>
<span id="cb57-65"><a href="#cb57-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-66"><a href="#cb57-66" aria-hidden="true" tabindex="-1"></a>Amid the joking, my wife came to Rhode Island's defense by declaring that even though it's so small, it has one of the highest proportions of coastline to land borders. We all gave it a metaphorical gold star for being so maritime-y and moved on with our days.</span>
<span id="cb57-67"><a href="#cb57-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-68"><a href="#cb57-68" aria-hidden="true" tabindex="-1"></a>But as I thought about it later, I got curious about how much of Rhode Island's border really is coastline and how that proportion compares to other states. New England in general has lots of inlets and islands; North Carolina has the complex <span class="co">[</span><span class="ot">Outer Banks</span><span class="co">](https://en.wikipedia.org/wiki/Outer_Banks)</span>; Louisiana has the Mississippi Delta; Michigan is split into two parts and surrounded by the Great Lakes; Florida is Florida. Lots of other states have lots of coastline.</span>
<span id="cb57-69"><a href="#cb57-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-70"><a href="#cb57-70" aria-hidden="true" tabindex="-1"></a>Using R, the <span class="co">[</span><span class="ot">extremely powerful {sf} package</span><span class="co">](https://r-spatial.github.io/sf/)</span> for working with geospatial data, and some high quality public domain geographic data, we can find the actual answers about coastline proportions. Spoilers: Rhode Island does really well, as expected.</span>
<span id="cb57-71"><a href="#cb57-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-72"><a href="#cb57-72" aria-hidden="true" tabindex="-1"></a>But doing this is a lot more complicated than you might think, both for technical reasons and for philosophical reasons.</span>
<span id="cb57-73"><a href="#cb57-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-74"><a href="#cb57-74" aria-hidden="true" tabindex="-1"></a>Let's explore this data and make some pretty maps!</span>
<span id="cb57-75"><a href="#cb57-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-78"><a href="#cb57-78" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-79"><a href="#cb57-79" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: libraries-n-things</span></span>
<span id="cb57-80"><a href="#cb57-80" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb57-81"><a href="#cb57-81" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb57-82"><a href="#cb57-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-83"><a href="#cb57-83" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb57-84"><a href="#cb57-84" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span>
<span id="cb57-85"><a href="#cb57-85" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb57-86"><a href="#cb57-86" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb57-87"><a href="#cb57-87" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb57-88"><a href="#cb57-88" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb57-89"><a href="#cb57-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-90"><a href="#cb57-90" aria-hidden="true" tabindex="-1"></a>clrs <span class="ot">&lt;-</span> rcartocolor<span class="sc">::</span><span class="fu">carto_pal</span>(<span class="dv">12</span>, <span class="st">"Prism"</span>)</span>
<span id="cb57-91"><a href="#cb57-91" aria-hidden="true" tabindex="-1"></a>clr_ocean <span class="ot">&lt;-</span> colorspace<span class="sc">::</span><span class="fu">lighten</span>(<span class="st">"#88CCEE"</span>, <span class="fl">0.7</span>)</span>
<span id="cb57-92"><a href="#cb57-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-93"><a href="#cb57-93" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom ggplot theme to make pretty plots</span></span>
<span id="cb57-94"><a href="#cb57-94" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the font at https://fonts.google.com/specimen/Overpass</span></span>
<span id="cb57-95"><a href="#cb57-95" aria-hidden="true" tabindex="-1"></a>theme_map <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb57-96"><a href="#cb57-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>(<span class="at">base_family =</span> <span class="st">"Overpass Light"</span>) <span class="sc">+</span></span>
<span id="cb57-97"><a href="#cb57-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb57-98"><a href="#cb57-98" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Overpass"</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb57-99"><a href="#cb57-99" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Overpass"</span>, <span class="at">face =</span> <span class="st">"plain"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb57-100"><a href="#cb57-100" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb57-101"><a href="#cb57-101" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-102"><a href="#cb57-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-103"><a href="#cb57-103" aria-hidden="true" tabindex="-1"></a><span class="fu">update_geom_defaults</span>(<span class="st">"text"</span>, <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"Overpass"</span>))</span>
<span id="cb57-104"><a href="#cb57-104" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-105"><a href="#cb57-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-106"><a href="#cb57-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-107"><a href="#cb57-107" aria-hidden="true" tabindex="-1"></a><span class="fu"># Use US Census data on states and coastlines</span></span>
<span id="cb57-108"><a href="#cb57-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-109"><a href="#cb57-109" aria-hidden="true" tabindex="-1"></a>At first glance, calculating the proportion of coastline borders in states feels fairly straightforward. We take state boundaries, find where they intersect with coastline boundaries, extract those overlapping sections, and voilá—we're done.</span>
<span id="cb57-110"><a href="#cb57-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-111"><a href="#cb57-111" aria-hidden="true" tabindex="-1"></a>The US Census Bureau even has shapefiles ready to use, like <span class="co">[</span><span class="ot">US state borders</span><span class="co">](https://www.census.gov/geographies/mapping-files/time-series/geo/cartographic-boundary.html)</span> and <span class="co">[</span><span class="ot">the national coastline</span><span class="co">](https://catalog.data.gov/dataset/tiger-line-shapefile-2023-nation-u-s-coastline)</span> for 2023, and <span class="co">[</span><span class="ot">the {tigris} package</span><span class="co">](https://walker-data.com/census-r/census-geographic-data-and-applications-in-r.html)</span> makes it really easy to load that data directly into R.</span>
<span id="cb57-112"><a href="#cb57-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-113"><a href="#cb57-113" aria-hidden="true" tabindex="-1"></a>First, let's grab US state data at medium resolution (1:5 million) and calculate the length of each state's border. To make calculations easier, we'll change the projection to <span class="co">[</span><span class="ot">Albers</span><span class="co">](https://en.wikipedia.org/wiki/Albers_projection)</span>, which measures distances in meters instead of the default <span class="co">[</span><span class="ot">NAD 83 decimal degree system</span><span class="co">](https://en.wikipedia.org/wiki/North_American_Datum)</span>.</span>
<span id="cb57-114"><a href="#cb57-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-117"><a href="#cb57-117" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-118"><a href="#cb57-118" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: get-census-states</span></span>
<span id="cb57-119"><a href="#cb57-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-120"><a href="#cb57-120" aria-hidden="true" tabindex="-1"></a>census_states <span class="ot">&lt;-</span> <span class="fu">states</span>(</span>
<span id="cb57-121"><a href="#cb57-121" aria-hidden="true" tabindex="-1"></a>  <span class="at">cb =</span> <span class="cn">TRUE</span>, <span class="at">resolution =</span> <span class="st">"5m"</span>, <span class="at">year =</span> <span class="dv">2023</span>,</span>
<span id="cb57-122"><a href="#cb57-122" aria-hidden="true" tabindex="-1"></a>  <span class="at">progress_bar =</span> <span class="cn">FALSE</span>, <span class="at">keep_zipped_shapefile =</span> <span class="cn">TRUE</span></span>
<span id="cb57-123"><a href="#cb57-123" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb57-124"><a href="#cb57-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"ESRI:102003"</span>)) <span class="sc">|&gt;</span>  <span class="co"># Albers</span></span>
<span id="cb57-125"><a href="#cb57-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-126"><a href="#cb57-126" aria-hidden="true" tabindex="-1"></a>    <span class="at">border_length =</span> <span class="fu">st_perimeter</span>(geometry),</span>
<span id="cb57-127"><a href="#cb57-127" aria-hidden="true" tabindex="-1"></a>    <span class="at">border_length_miles =</span> units<span class="sc">::</span><span class="fu">set_units</span>(border_length, <span class="st">"miles"</span>)</span>
<span id="cb57-128"><a href="#cb57-128" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-129"><a href="#cb57-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-130"><a href="#cb57-130" aria-hidden="true" tabindex="-1"></a>census_states <span class="sc">|&gt;</span> </span>
<span id="cb57-131"><a href="#cb57-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NAME, border_length, border_length_miles)</span>
<span id="cb57-132"><a href="#cb57-132" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-133"><a href="#cb57-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-134"><a href="#cb57-134" aria-hidden="true" tabindex="-1"></a>Next we'll grab coastline data and also convert it to the meter-based Albers projection:</span>
<span id="cb57-135"><a href="#cb57-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-138"><a href="#cb57-138" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-139"><a href="#cb57-139" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: get-census-coastline</span></span>
<span id="cb57-140"><a href="#cb57-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-141"><a href="#cb57-141" aria-hidden="true" tabindex="-1"></a>census_coastline <span class="ot">&lt;-</span> <span class="fu">coastline</span>(</span>
<span id="cb57-142"><a href="#cb57-142" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2023</span>, <span class="at">progress_bar =</span> <span class="cn">FALSE</span>, <span class="at">keep_zipped_shapefile =</span> <span class="cn">TRUE</span></span>
<span id="cb57-143"><a href="#cb57-143" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb57-144"><a href="#cb57-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"ESRI:102003"</span>))</span>
<span id="cb57-145"><a href="#cb57-145" aria-hidden="true" tabindex="-1"></a>census_coastline</span>
<span id="cb57-146"><a href="#cb57-146" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-147"><a href="#cb57-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-148"><a href="#cb57-148" aria-hidden="true" tabindex="-1"></a>This coastline data isn't state-based—instead, each row represents a segment of the US coastline. Here's what it looks like when plotted:</span>
<span id="cb57-149"><a href="#cb57-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-152"><a href="#cb57-152" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-153"><a href="#cb57-153" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-census-coastline</span></span>
<span id="cb57-154"><a href="#cb57-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-155"><a href="#cb57-155" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb57-156"><a href="#cb57-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> census_coastline, <span class="at">linewidth =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb57-157"><a href="#cb57-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"US Census coastline data"</span>) <span class="sc">+</span></span>
<span id="cb57-158"><a href="#cb57-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"ESRI:102003"</span>)) <span class="sc">+</span></span>
<span id="cb57-159"><a href="#cb57-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>()</span>
<span id="cb57-160"><a href="#cb57-160" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-161"><a href="#cb57-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-162"><a href="#cb57-162" aria-hidden="true" tabindex="-1"></a>To find where the two maps intersect, we can use <span class="in">`st_intersection()`</span>, and then we can calculate the length of each combined segment with <span class="in">`st_length()`</span>:</span>
<span id="cb57-163"><a href="#cb57-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-166"><a href="#cb57-166" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-167"><a href="#cb57-167" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: combine-census-states-coastline</span></span>
<span id="cb57-168"><a href="#cb57-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-169"><a href="#cb57-169" aria-hidden="true" tabindex="-1"></a>census_combined <span class="ot">&lt;-</span> census_states <span class="sc">|&gt;</span> </span>
<span id="cb57-170"><a href="#cb57-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersection</span>(census_coastline) <span class="sc">|&gt;</span> </span>
<span id="cb57-171"><a href="#cb57-171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">coastline_length =</span> <span class="fu">st_length</span>(geometry))</span>
<span id="cb57-172"><a href="#cb57-172" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-173"><a href="#cb57-173" aria-hidden="true" tabindex="-1"></a>census_combined <span class="sc">|&gt;</span> </span>
<span id="cb57-174"><a href="#cb57-174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NAME, border_length, coastline_length, geometry)</span>
<span id="cb57-175"><a href="#cb57-175" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-176"><a href="#cb57-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-177"><a href="#cb57-177" aria-hidden="true" tabindex="-1"></a>Some of these segments are thousands of miles; some are only a few miles. We can do some grouping and summarizing to collapse these into single values for each state. <span class="in">`border_length`</span> is a state-level variable, not a border-segment-level variable, so it's repeated in each of the rows of the combined dataset, so we only need to keep one of the values---here I keep the max, but min would work (since they're the same).</span>
<span id="cb57-178"><a href="#cb57-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-181"><a href="#cb57-181" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-182"><a href="#cb57-182" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-prop-coastline-census</span></span>
<span id="cb57-183"><a href="#cb57-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-184"><a href="#cb57-184" aria-hidden="true" tabindex="-1"></a>coastline_length_by_state <span class="ot">&lt;-</span> census_combined <span class="sc">|&gt;</span> </span>
<span id="cb57-185"><a href="#cb57-185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span>  <span class="co"># Stop worrying about geographic stuff</span></span>
<span id="cb57-186"><a href="#cb57-186" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(NAME) <span class="sc">|&gt;</span> </span>
<span id="cb57-187"><a href="#cb57-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb57-188"><a href="#cb57-188" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_coastline_length =</span> <span class="fu">sum</span>(coastline_length),</span>
<span id="cb57-189"><a href="#cb57-189" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_perimeter =</span> <span class="fu">max</span>(border_length),</span>
<span id="cb57-190"><a href="#cb57-190" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_coastline =</span> <span class="fu">as.numeric</span>(total_coastline_length <span class="sc">/</span> total_perimeter)</span>
<span id="cb57-191"><a href="#cb57-191" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-192"><a href="#cb57-192" aria-hidden="true" tabindex="-1"></a>coastline_length_by_state</span>
<span id="cb57-193"><a href="#cb57-193" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-194"><a href="#cb57-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-195"><a href="#cb57-195" aria-hidden="true" tabindex="-1"></a>At first glance, this looks fine. We have each state's total border length, coastline length, and a proportion. Neat.</span>
<span id="cb57-196"><a href="#cb57-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-197"><a href="#cb57-197" aria-hidden="true" tabindex="-1"></a>But some of these proportions look wrong, like Hawaiʻi:</span>
<span id="cb57-198"><a href="#cb57-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-201"><a href="#cb57-201" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-202"><a href="#cb57-202" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: show-prop-coastline-hi-nc</span></span>
<span id="cb57-203"><a href="#cb57-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-204"><a href="#cb57-204" aria-hidden="true" tabindex="-1"></a>coastline_length_by_state <span class="sc">|&gt;</span> </span>
<span id="cb57-205"><a href="#cb57-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Hawaii"</span>, <span class="st">"North Carolina"</span>))</span>
<span id="cb57-206"><a href="#cb57-206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-207"><a href="#cb57-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-208"><a href="#cb57-208" aria-hidden="true" tabindex="-1"></a>According to this, only 50% of Hawaiʻi's borders are on the coast. That's obviously wrong—that state shares no borders with other states and it's in the middle of the Pacific Ocean.</span>
<span id="cb57-209"><a href="#cb57-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-210"><a href="#cb57-210" aria-hidden="true" tabindex="-1"></a>If we plot the two datasets, we can see what's going on. First, the resolutions of the state data and coastline data don't quite match. Check out Oʻahu here—the purple coastline crosses some bays and misses some of the landmass:</span>
<span id="cb57-211"><a href="#cb57-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-214"><a href="#cb57-214" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-215"><a href="#cb57-215" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-hi-mismatch</span></span>
<span id="cb57-216"><a href="#cb57-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-217"><a href="#cb57-217" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the state boundaries</span></span>
<span id="cb57-218"><a href="#cb57-218" aria-hidden="true" tabindex="-1"></a>census_hi <span class="ot">&lt;-</span> census_states <span class="sc">|&gt;</span> <span class="fu">filter</span>(NAME <span class="sc">==</span> <span class="st">"Hawaii"</span>)</span>
<span id="cb57-219"><a href="#cb57-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-220"><a href="#cb57-220" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the bounding box around the state so we can zoom in on the coastline map</span></span>
<span id="cb57-221"><a href="#cb57-221" aria-hidden="true" tabindex="-1"></a>bbox_hi <span class="ot">&lt;-</span> census_hi <span class="sc">|&gt;</span> <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)) <span class="sc">|&gt;</span> <span class="fu">st_bbox</span>()</span>
<span id="cb57-222"><a href="#cb57-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-223"><a href="#cb57-223" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb57-224"><a href="#cb57-224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> census_hi, <span class="at">linewidth =</span> <span class="fl">0.1</span>, <span class="at">fill =</span> clrs[<span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb57-225"><a href="#cb57-225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> census_coastline, <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"US Census coastline data"</span>)) <span class="sc">+</span></span>
<span id="cb57-226"><a href="#cb57-226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.425</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="fl">0.89</span>), <span class="at">label =</span> <span class="st">"Oʻahu"</span>) <span class="sc">+</span></span>
<span id="cb57-227"><a href="#cb57-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb57-228"><a href="#cb57-228" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">"rect"</span>, </span>
<span id="cb57-229"><a href="#cb57-229" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmin =</span> <span class="fu">I</span>(<span class="fl">0.35</span>), <span class="at">xmax =</span> <span class="fu">I</span>(<span class="fl">0.5</span>), <span class="at">ymin =</span> <span class="fu">I</span>(<span class="fl">0.63</span>), <span class="at">ymax =</span> <span class="fu">I</span>(<span class="fl">0.85</span>), </span>
<span id="cb57-230"><a href="#cb57-230" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> clrs[<span class="dv">12</span>], <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linetype =</span> <span class="st">"21"</span></span>
<span id="cb57-231"><a href="#cb57-231" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-232"><a href="#cb57-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clrs[<span class="dv">11</span>])) <span class="sc">+</span></span>
<span id="cb57-233"><a href="#cb57-233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Hawaiʻi"</span>, <span class="at">color =</span> <span class="cn">NULL</span>)  <span class="sc">+</span></span>
<span id="cb57-234"><a href="#cb57-234" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb57-235"><a href="#cb57-235" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> bbox_hi[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)],</span>
<span id="cb57-236"><a href="#cb57-236" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> bbox_hi[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)],</span>
<span id="cb57-237"><a href="#cb57-237" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)</span>
<span id="cb57-238"><a href="#cb57-238" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-239"><a href="#cb57-239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>() <span class="sc">+</span></span>
<span id="cb57-240"><a href="#cb57-240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb57-241"><a href="#cb57-241" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-242"><a href="#cb57-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-243"><a href="#cb57-243" aria-hidden="true" tabindex="-1"></a>This mismatch between datasets is even more obvious if we look at a state like North Carolina. The actual landmass in the Outer Banks along the east coast is complex, with all sorts of inlets and a big long barrier island, but the Census simplifies it down substantially (with good reason(!) <span class="co">[</span><span class="ot">as we'll see later</span><span class="co">](#the-coastline-paradox-and-map-resolutions)</span>):</span>
<span id="cb57-244"><a href="#cb57-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-247"><a href="#cb57-247" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-248"><a href="#cb57-248" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-nc-mismatch</span></span>
<span id="cb57-249"><a href="#cb57-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-250"><a href="#cb57-250" aria-hidden="true" tabindex="-1"></a>census_nc <span class="ot">&lt;-</span> census_states <span class="sc">|&gt;</span> <span class="fu">filter</span>(NAME <span class="sc">==</span> <span class="st">"North Carolina"</span>)</span>
<span id="cb57-251"><a href="#cb57-251" aria-hidden="true" tabindex="-1"></a>bbox_nc <span class="ot">&lt;-</span> census_nc <span class="sc">|&gt;</span> <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)) <span class="sc">|&gt;</span> <span class="fu">st_bbox</span>()</span>
<span id="cb57-252"><a href="#cb57-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-253"><a href="#cb57-253" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb57-254"><a href="#cb57-254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> census_nc, <span class="at">linewidth =</span> <span class="fl">0.1</span>, <span class="at">fill =</span> clrs[<span class="dv">6</span>]) <span class="sc">+</span></span>
<span id="cb57-255"><a href="#cb57-255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> census_coastline, <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"US Census coastline data"</span>)) <span class="sc">+</span></span>
<span id="cb57-256"><a href="#cb57-256" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb57-257"><a href="#cb57-257" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">"rect"</span>, </span>
<span id="cb57-258"><a href="#cb57-258" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmin =</span> <span class="fu">I</span>(<span class="fl">0.57</span>), <span class="at">xmax =</span> <span class="fu">I</span>(<span class="fl">0.97</span>), <span class="at">ymin =</span> <span class="fu">I</span>(<span class="fl">0.005</span>), <span class="at">ymax =</span> <span class="fu">I</span>(<span class="fl">0.995</span>), </span>
<span id="cb57-259"><a href="#cb57-259" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> clrs[<span class="dv">12</span>], <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linetype =</span> <span class="st">"21"</span></span>
<span id="cb57-260"><a href="#cb57-260" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-261"><a href="#cb57-261" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clrs[<span class="dv">11</span>])) <span class="sc">+</span></span>
<span id="cb57-262"><a href="#cb57-262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"North Carolina"</span>, <span class="at">color =</span> <span class="cn">NULL</span>)  <span class="sc">+</span></span>
<span id="cb57-263"><a href="#cb57-263" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb57-264"><a href="#cb57-264" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> bbox_nc[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)],</span>
<span id="cb57-265"><a href="#cb57-265" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> bbox_nc[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)],</span>
<span id="cb57-266"><a href="#cb57-266" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)</span>
<span id="cb57-267"><a href="#cb57-267" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-268"><a href="#cb57-268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>() <span class="sc">+</span></span>
<span id="cb57-269"><a href="#cb57-269" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb57-270"><a href="#cb57-270" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-271"><a href="#cb57-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-272"><a href="#cb57-272" aria-hidden="true" tabindex="-1"></a>This mismatch in borders and coastlines matter a lot for calculations. We're using <span class="in">`st_intersection()`</span> to find where the two maps overlap. If the two maps are misaligned, we can't identify the correct overlaps, which means we can't identify the full coastal border. Remember how we calculated that only 50% of Hawaiʻi's borders are coastlines? If we plot the coastal borders of Hawaiʻi, we can see why:</span>
<span id="cb57-273"><a href="#cb57-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-276"><a href="#cb57-276" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-277"><a href="#cb57-277" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-hi-mismatch-borders-only</span></span>
<span id="cb57-278"><a href="#cb57-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-279"><a href="#cb57-279" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb57-280"><a href="#cb57-280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> census_combined, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb57-281"><a href="#cb57-281" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Incomplete coastline overlaps in Hawaiʻi"</span>) <span class="sc">+</span></span>
<span id="cb57-282"><a href="#cb57-282" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb57-283"><a href="#cb57-283" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> bbox_hi[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)],</span>
<span id="cb57-284"><a href="#cb57-284" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> bbox_hi[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)],</span>
<span id="cb57-285"><a href="#cb57-285" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)</span>
<span id="cb57-286"><a href="#cb57-286" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-287"><a href="#cb57-287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>()</span>
<span id="cb57-288"><a href="#cb57-288" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-289"><a href="#cb57-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-290"><a href="#cb57-290" aria-hidden="true" tabindex="-1"></a>There are a couple issues here. The dots scattered along the borders are a sign that there's some misalignment between the two maps. The borders for the states sometimes cross the coastline borders in a single point instead of following the coast exactly. But the even bigger issue is that these coastlines look sketched out—there are so many major gaps that roughly 50% of the borders are missing. That's again because of misalignment with the two maps. The borders don't overlap exactly, so <span class="in">`st_intersection()`</span> can't pick them up.</span>
<span id="cb57-291"><a href="#cb57-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-292"><a href="#cb57-292" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb57-293"><a href="#cb57-293" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;hr class="dinkus"&gt;</span></span>
<span id="cb57-294"><a href="#cb57-294" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-295"><a href="#cb57-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-296"><a href="#cb57-296" aria-hidden="true" tabindex="-1"></a>So what do we do? We could try finding different coastline data that matches the same resolution as the Census data. The <span class="co">[</span><span class="ot">National Oceanic and Atmospheric Administration (NOAA)</span><span class="co">](https://www.ngdc.noaa.gov/mgg/shorelines/)</span> and the <span class="co">[</span><span class="ot">US Geological Survey (USGS)</span><span class="co">](https://www.sciencebase.gov/catalog/item/581d051de4b08da350d523be)</span> each have their own shoreline datasets, and we could download those and load them into R and hope that they align with one of the Census's state maps. But they don't.</span>
<span id="cb57-297"><a href="#cb57-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-298"><a href="#cb57-298" aria-hidden="true" tabindex="-1"></a>So we give up.</span>
<span id="cb57-299"><a href="#cb57-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-300"><a href="#cb57-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-301"><a href="#cb57-301" aria-hidden="true" tabindex="-1"></a><span class="fu"># Use the lack of land as the coastline</span></span>
<span id="cb57-302"><a href="#cb57-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-303"><a href="#cb57-303" aria-hidden="true" tabindex="-1"></a>Just kidding. There's a better solution.</span>
<span id="cb57-304"><a href="#cb57-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-305"><a href="#cb57-305" aria-hidden="true" tabindex="-1"></a>We already kind of have coastline data embedded in the state map data. For states that border an ocean or lake, anywhere the blue of the water touches the land is technically a coastline. Take Hawaiʻi, for instance, where the whole state border is the coastline:</span>
<span id="cb57-306"><a href="#cb57-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-309"><a href="#cb57-309" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-310"><a href="#cb57-310" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-hi-census-ocean</span></span>
<span id="cb57-311"><a href="#cb57-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-312"><a href="#cb57-312" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb57-313"><a href="#cb57-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> census_hi, <span class="at">linewidth =</span> <span class="fl">0.1</span>, <span class="at">fill =</span> clrs[<span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb57-314"><a href="#cb57-314" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"The islands of Hawaiʻi"</span>) <span class="sc">+</span></span>
<span id="cb57-315"><a href="#cb57-315" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)) <span class="sc">+</span>  <span class="co"># NAD83</span></span>
<span id="cb57-316"><a href="#cb57-316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>() <span class="sc">+</span></span>
<span id="cb57-317"><a href="#cb57-317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb57-318"><a href="#cb57-318" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> clr_ocean), </span>
<span id="cb57-319"><a href="#cb57-319" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="fl">6.5</span>, <span class="dv">0</span>, <span class="fl">6.5</span>, <span class="dv">0</span>))</span>
<span id="cb57-320"><a href="#cb57-320" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-321"><a href="#cb57-321" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-322"><a href="#cb57-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-323"><a href="#cb57-323" aria-hidden="true" tabindex="-1"></a>When looking at states with interior borders (like the other 49 states), though, the state map data has no way to distinguish which of those borders touch the ocean or touch other states. The east coast of North Carolina touches the ocean, but the northern, southern, and western borders do not. We need to somehow figure out which borders don't touch other states.</span>
<span id="cb57-324"><a href="#cb57-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-327"><a href="#cb57-327" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-328"><a href="#cb57-328" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-nc-census-ocean</span></span>
<span id="cb57-329"><a href="#cb57-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-330"><a href="#cb57-330" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb57-331"><a href="#cb57-331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> census_nc, <span class="at">linewidth =</span> <span class="fl">0.1</span>, <span class="at">fill =</span> clrs[<span class="dv">6</span>]) <span class="sc">+</span></span>
<span id="cb57-332"><a href="#cb57-332" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.6</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="fl">0.89</span>), <span class="at">label =</span> <span class="st">"↑ Virginia ↑"</span>) <span class="sc">+</span></span>
<span id="cb57-333"><a href="#cb57-333" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.58</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="fl">0.3</span>), <span class="at">label =</span> <span class="st">"↓ South Carolina ↓"</span>, <span class="at">angle =</span> <span class="dv">313</span>) <span class="sc">+</span></span>
<span id="cb57-334"><a href="#cb57-334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.14</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="fl">0.5</span>), <span class="at">label =</span> <span class="st">"↓ Georgia"</span>) <span class="sc">+</span></span>
<span id="cb57-335"><a href="#cb57-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.27</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="fl">0.64</span>), <span class="at">label =</span> <span class="st">"← Tennessee"</span>) <span class="sc">+</span></span>
<span id="cb57-336"><a href="#cb57-336" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"The “island” of North Carolina"</span>) <span class="sc">+</span></span>
<span id="cb57-337"><a href="#cb57-337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)) <span class="sc">+</span>  <span class="co"># NAD83</span></span>
<span id="cb57-338"><a href="#cb57-338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>() <span class="sc">+</span></span>
<span id="cb57-339"><a href="#cb57-339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb57-340"><a href="#cb57-340" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> clr_ocean), </span>
<span id="cb57-341"><a href="#cb57-341" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="fl">6.5</span>, <span class="dv">0</span>, <span class="fl">6.5</span>, <span class="dv">0</span>))</span>
<span id="cb57-342"><a href="#cb57-342" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-343"><a href="#cb57-343" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-344"><a href="#cb57-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-345"><a href="#cb57-345" aria-hidden="true" tabindex="-1"></a>We *do* have data about Virginia, South Carolina, Tennessee, and Georgia, though, so there is a way to know that those borders aren't ocean borders.</span>
<span id="cb57-346"><a href="#cb57-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-347"><a href="#cb57-347" aria-hidden="true" tabindex="-1"></a>One way to determine which borders are interior and which ones are coastal is to create a big unified shape of the United States and then use the shape of North Carolina as a kind of cookie cutter. We can assume that any exposed edges are coasts.</span>
<span id="cb57-348"><a href="#cb57-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-349"><a href="#cb57-349" aria-hidden="true" tabindex="-1"></a>First, we'll make our big unified country shape:</span>
<span id="cb57-350"><a href="#cb57-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-353"><a href="#cb57-353" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-354"><a href="#cb57-354" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-us-census-giant</span></span>
<span id="cb57-355"><a href="#cb57-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-356"><a href="#cb57-356" aria-hidden="true" tabindex="-1"></a>census_us_giant <span class="ot">&lt;-</span> census_states <span class="sc">|&gt;</span> </span>
<span id="cb57-357"><a href="#cb57-357" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_union</span>() <span class="sc">|&gt;</span> </span>
<span id="cb57-358"><a href="#cb57-358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"ESRI:102003"</span>))</span>
<span id="cb57-359"><a href="#cb57-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-360"><a href="#cb57-360" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb57-361"><a href="#cb57-361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> census_us_giant, <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">fill =</span> clrs[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb57-362"><a href="#cb57-362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"One big US-shaped shape"</span>) <span class="sc">+</span></span>
<span id="cb57-363"><a href="#cb57-363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>() <span class="sc">+</span></span>
<span id="cb57-364"><a href="#cb57-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb57-365"><a href="#cb57-365" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> clr_ocean), </span>
<span id="cb57-366"><a href="#cb57-366" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="fl">6.5</span>, <span class="dv">0</span>, <span class="fl">6.5</span>, <span class="dv">0</span>))</span>
<span id="cb57-367"><a href="#cb57-367" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-368"><a href="#cb57-368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-369"><a href="#cb57-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-370"><a href="#cb57-370" aria-hidden="true" tabindex="-1"></a>Before trying this with North Carolina, we'll test the cookie cutter selection with Hawaiʻi, since we know that 100% of its borders are coastlines. If we use the Hawaiʻi shape to take a chunk out of the overall US shape, we get…</span>
<span id="cb57-371"><a href="#cb57-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-374"><a href="#cb57-374" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-375"><a href="#cb57-375" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-hi-empty</span></span>
<span id="cb57-376"><a href="#cb57-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-377"><a href="#cb57-377" aria-hidden="true" tabindex="-1"></a>hi_ocean_border_census <span class="ot">&lt;-</span> census_hi <span class="sc">|&gt;</span> </span>
<span id="cb57-378"><a href="#cb57-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_difference</span>(census_us_giant)</span>
<span id="cb57-379"><a href="#cb57-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-380"><a href="#cb57-380" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb57-381"><a href="#cb57-381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> hi_ocean_border_census) <span class="sc">+</span></span>
<span id="cb57-382"><a href="#cb57-382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"lol nothing"</span>) <span class="sc">+</span></span>
<span id="cb57-383"><a href="#cb57-383" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>() <span class="sc">+</span></span>
<span id="cb57-384"><a href="#cb57-384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb57-385"><a href="#cb57-385" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> clr_ocean),</span>
<span id="cb57-386"><a href="#cb57-386" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="fl">6.5</span>, <span class="dv">0</span>, <span class="fl">6.5</span>, <span class="dv">0</span>))</span>
<span id="cb57-387"><a href="#cb57-387" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-388"><a href="#cb57-388" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-389"><a href="#cb57-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-390"><a href="#cb57-390" aria-hidden="true" tabindex="-1"></a>…nothing.</span>
<span id="cb57-391"><a href="#cb57-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-392"><a href="#cb57-392" aria-hidden="true" tabindex="-1"></a>The state cookie cutter was too perfect and selected right up to the edge of the overall country, leaving nothing.</span>
<span id="cb57-393"><a href="#cb57-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-394"><a href="#cb57-394" aria-hidden="true" tabindex="-1"></a>To fix this, we can expand the state shape just a *tiiiiiiny* bit. We can use <span class="in">`st_buffer()`</span> to add a tiny amount of distance all around the shape—since we're using the Albers projection, we're working in meters, so let's add just 1 millimeter around the border before finding the difference:</span>
<span id="cb57-395"><a href="#cb57-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-398"><a href="#cb57-398" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-399"><a href="#cb57-399" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-hi-census-borders-extracted</span></span>
<span id="cb57-400"><a href="#cb57-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-401"><a href="#cb57-401" aria-hidden="true" tabindex="-1"></a>hi_ocean_border_census <span class="ot">&lt;-</span> census_hi <span class="sc">|&gt;</span> </span>
<span id="cb57-402"><a href="#cb57-402" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="at">dist =</span> <span class="fl">0.001</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-403"><a href="#cb57-403" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_difference</span>(census_us_giant)</span>
<span id="cb57-404"><a href="#cb57-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-405"><a href="#cb57-405" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb57-406"><a href="#cb57-406" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> hi_ocean_border_census, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb57-407"><a href="#cb57-407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Hawaiʻi’s coastal borders extracted from US shape"</span>) <span class="sc">+</span></span>
<span id="cb57-408"><a href="#cb57-408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb57-409"><a href="#cb57-409" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> bbox_hi[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)],</span>
<span id="cb57-410"><a href="#cb57-410" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> bbox_hi[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)],</span>
<span id="cb57-411"><a href="#cb57-411" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)</span>
<span id="cb57-412"><a href="#cb57-412" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-413"><a href="#cb57-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>()</span>
<span id="cb57-414"><a href="#cb57-414" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-415"><a href="#cb57-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-416"><a href="#cb57-416" aria-hidden="true" tabindex="-1"></a>Perfect.</span>
<span id="cb57-417"><a href="#cb57-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-418"><a href="#cb57-418" aria-hidden="true" tabindex="-1"></a>Well, almost perfect. We've identified the coastal borders, but adding the buffer actually distorts things when we calculate the length of the border.</span>
<span id="cb57-419"><a href="#cb57-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-420"><a href="#cb57-420" aria-hidden="true" tabindex="-1"></a>Let's find the coast-to-border proportion for Hawaiʻi, which should be 100%. First we'll find the perimeter of the state:</span>
<span id="cb57-421"><a href="#cb57-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-424"><a href="#cb57-424" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-425"><a href="#cb57-425" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-hi-border-perimeter-census</span></span>
<span id="cb57-426"><a href="#cb57-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-427"><a href="#cb57-427" aria-hidden="true" tabindex="-1"></a>hi_border_perimeter <span class="ot">&lt;-</span> census_hi <span class="sc">|&gt;</span> </span>
<span id="cb57-428"><a href="#cb57-428" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_perimeter</span>()</span>
<span id="cb57-429"><a href="#cb57-429" aria-hidden="true" tabindex="-1"></a>hi_border_perimeter</span>
<span id="cb57-430"><a href="#cb57-430" aria-hidden="true" tabindex="-1"></a>units<span class="sc">::</span><span class="fu">set_units</span>(hi_border_perimeter, <span class="st">"miles"</span>)</span>
<span id="cb57-431"><a href="#cb57-431" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-432"><a href="#cb57-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-433"><a href="#cb57-433" aria-hidden="true" tabindex="-1"></a>Hawaiʻi's border is <span class="in">`r scales::label_comma()(as.numeric(hi_border_perimeter))`</span> meters, or <span class="in">`r scales::label_comma()(as.numeric(units::set_units(hi_border_perimeter, "miles")))`</span> miles. Sounds reasonable.</span>
<span id="cb57-434"><a href="#cb57-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-435"><a href="#cb57-435" aria-hidden="true" tabindex="-1"></a>Next we'll find the perimeter of the coastline:</span>
<span id="cb57-436"><a href="#cb57-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-439"><a href="#cb57-439" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-440"><a href="#cb57-440" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-hi-ocean-perimeter-census</span></span>
<span id="cb57-441"><a href="#cb57-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-442"><a href="#cb57-442" aria-hidden="true" tabindex="-1"></a>hi_ocean_border_perimeter <span class="ot">&lt;-</span> hi_ocean_border_census <span class="sc">|&gt;</span> </span>
<span id="cb57-443"><a href="#cb57-443" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_perimeter</span>()</span>
<span id="cb57-444"><a href="#cb57-444" aria-hidden="true" tabindex="-1"></a>hi_ocean_border_perimeter</span>
<span id="cb57-445"><a href="#cb57-445" aria-hidden="true" tabindex="-1"></a>units<span class="sc">::</span><span class="fu">set_units</span>(hi_ocean_border_perimeter, <span class="st">"miles"</span>)</span>
<span id="cb57-446"><a href="#cb57-446" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-447"><a href="#cb57-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-448"><a href="#cb57-448" aria-hidden="true" tabindex="-1"></a>Hrm. Hawaiʻi's coastline is <span class="in">`r scales::label_comma()(as.numeric(hi_ocean_border_perimeter))`</span> meters, or <span class="in">`r scales::label_comma()(as.numeric(units::set_units(hi_ocean_border_perimeter, "miles")))`</span> miles. That's actually exactly twice the correct border length:</span>
<span id="cb57-449"><a href="#cb57-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-452"><a href="#cb57-452" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-453"><a href="#cb57-453" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-hi-prop-ocean-wrong</span></span>
<span id="cb57-454"><a href="#cb57-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-455"><a href="#cb57-455" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(hi_ocean_border_perimeter <span class="sc">/</span> hi_border_perimeter)</span>
<span id="cb57-456"><a href="#cb57-456" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-457"><a href="#cb57-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-458"><a href="#cb57-458" aria-hidden="true" tabindex="-1"></a>This happened because of the 1 mm buffer that we added around the state shape. Adding the buffer transformed the line into a polygon—a super tiny 1 mm-narrow polygon, but a polygon nonetheless. That means the border technically has a top and sides and a bottom. When calculating the length or perimeter of the border, we're double counting because we're getting both the top and the bottom of the hyper-thin polygon.</span>
<span id="cb57-459"><a href="#cb57-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-460"><a href="#cb57-460" aria-hidden="true" tabindex="-1"></a>To better illustrate what's going on, let's add a three kilometer buffer around the borders.</span>
<span id="cb57-461"><a href="#cb57-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-464"><a href="#cb57-464" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-465"><a href="#cb57-465" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-hi-census-thick-buffer</span></span>
<span id="cb57-466"><a href="#cb57-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-467"><a href="#cb57-467" aria-hidden="true" tabindex="-1"></a>hi_ocean_border_census_huge_buffer <span class="ot">&lt;-</span> census_hi <span class="sc">|&gt;</span> </span>
<span id="cb57-468"><a href="#cb57-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="at">dist =</span> <span class="dv">3000</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-469"><a href="#cb57-469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_difference</span>(census_us_giant)</span>
<span id="cb57-470"><a href="#cb57-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-471"><a href="#cb57-471" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb57-472"><a href="#cb57-472" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb57-473"><a href="#cb57-473" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> hi_ocean_border_census_huge_buffer, </span>
<span id="cb57-474"><a href="#cb57-474" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> colorspace<span class="sc">::</span><span class="fu">lighten</span>(clrs[<span class="dv">5</span>], <span class="fl">0.5</span>)</span>
<span id="cb57-475"><a href="#cb57-475" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-476"><a href="#cb57-476" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Hawaiʻi’s borders with a 3 km buffer"</span>) <span class="sc">+</span></span>
<span id="cb57-477"><a href="#cb57-477" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb57-478"><a href="#cb57-478" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> bbox_hi[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)],</span>
<span id="cb57-479"><a href="#cb57-479" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> bbox_hi[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)],</span>
<span id="cb57-480"><a href="#cb57-480" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)</span>
<span id="cb57-481"><a href="#cb57-481" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-482"><a href="#cb57-482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>()</span>
<span id="cb57-483"><a href="#cb57-483" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-484"><a href="#cb57-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-485"><a href="#cb57-485" aria-hidden="true" tabindex="-1"></a>Calculating the perimeter of these borders will add the inside ring and the outside ring, effectively doubling the distance.</span>
<span id="cb57-486"><a href="#cb57-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-487"><a href="#cb57-487" aria-hidden="true" tabindex="-1"></a>It's less obvious that this doubling is happening when we add just 1 mm, but it is, and it's leading to incorrect calculations. Fortunately it's easy to adjust—we can halve the ocean border distance. Coastal borders comprise 100% of Hawaiʻi's state borders, as expected:</span>
<span id="cb57-488"><a href="#cb57-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-491"><a href="#cb57-491" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-492"><a href="#cb57-492" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-hi-prop-ocean-correct</span></span>
<span id="cb57-493"><a href="#cb57-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-494"><a href="#cb57-494" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>((hi_ocean_border_perimeter <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">/</span> hi_border_perimeter) <span class="sc">|&gt;</span> </span>
<span id="cb57-495"><a href="#cb57-495" aria-hidden="true" tabindex="-1"></a>  scales<span class="sc">::</span><span class="fu">label_percent</span>()()</span>
<span id="cb57-496"><a href="#cb57-496" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-497"><a href="#cb57-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-498"><a href="#cb57-498" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb57-499"><a href="#cb57-499" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;hr class="dinkus"&gt;</span></span>
<span id="cb57-500"><a href="#cb57-500" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-501"><a href="#cb57-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-502"><a href="#cb57-502" aria-hidden="true" tabindex="-1"></a>Let's do the same thing with North Carolina:</span>
<span id="cb57-503"><a href="#cb57-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-506"><a href="#cb57-506" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-507"><a href="#cb57-507" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-nc-census-borders-extracted</span></span>
<span id="cb57-508"><a href="#cb57-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-509"><a href="#cb57-509" aria-hidden="true" tabindex="-1"></a>nc_ocean_border_census <span class="ot">&lt;-</span> census_nc <span class="sc">|&gt;</span> </span>
<span id="cb57-510"><a href="#cb57-510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="at">dist =</span> <span class="fl">0.001</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-511"><a href="#cb57-511" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_difference</span>(census_us_giant)</span>
<span id="cb57-512"><a href="#cb57-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-513"><a href="#cb57-513" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb57-514"><a href="#cb57-514" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> nc_ocean_border_census, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb57-515"><a href="#cb57-515" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"North Carolina’s coastal borders extracted from US shape"</span>) <span class="sc">+</span></span>
<span id="cb57-516"><a href="#cb57-516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)) <span class="sc">+</span></span>
<span id="cb57-517"><a href="#cb57-517" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>()</span>
<span id="cb57-518"><a href="#cb57-518" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-519"><a href="#cb57-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-520"><a href="#cb57-520" aria-hidden="true" tabindex="-1"></a>Perfect! Those are all the state borders that don't touch other states. *That's* the coastline.</span>
<span id="cb57-521"><a href="#cb57-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-522"><a href="#cb57-522" aria-hidden="true" tabindex="-1"></a>We can visualize this better by plotting the larger country shape, the North Carolina shape, and the coastal border:</span>
<span id="cb57-523"><a href="#cb57-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-526"><a href="#cb57-526" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-527"><a href="#cb57-527" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-nc-census-coastal-borders</span></span>
<span id="cb57-528"><a href="#cb57-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-529"><a href="#cb57-529" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb57-530"><a href="#cb57-530" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> census_us_giant, <span class="at">fill =</span> clrs[<span class="dv">1</span>], <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb57-531"><a href="#cb57-531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> census_nc, <span class="at">linewidth =</span> <span class="fl">0.1</span>, <span class="at">fill =</span> clrs[<span class="dv">6</span>]) <span class="sc">+</span></span>
<span id="cb57-532"><a href="#cb57-532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb57-533"><a href="#cb57-533" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> nc_ocean_border_census, <span class="at">linewidth =</span> <span class="fl">0.4</span>, </span>
<span id="cb57-534"><a href="#cb57-534" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"Coastal border extracted from US shape"</span>),</span>
<span id="cb57-535"><a href="#cb57-535" aria-hidden="true" tabindex="-1"></a>    <span class="at">key_glyph =</span> draw_key_path</span>
<span id="cb57-536"><a href="#cb57-536" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-537"><a href="#cb57-537" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.6</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="fl">0.89</span>), <span class="at">label =</span> <span class="st">"↑ Virginia ↑"</span>) <span class="sc">+</span></span>
<span id="cb57-538"><a href="#cb57-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.58</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="fl">0.3</span>), <span class="at">label =</span> <span class="st">"↓ South Carolina ↓"</span>, <span class="at">angle =</span> <span class="dv">313</span>) <span class="sc">+</span></span>
<span id="cb57-539"><a href="#cb57-539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.14</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="fl">0.5</span>), <span class="at">label =</span> <span class="st">"↓ Georgia"</span>) <span class="sc">+</span></span>
<span id="cb57-540"><a href="#cb57-540" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.27</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="fl">0.64</span>), <span class="at">label =</span> <span class="st">"← Tennessee"</span>) <span class="sc">+</span></span>
<span id="cb57-541"><a href="#cb57-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clrs[<span class="dv">8</span>])) <span class="sc">+</span></span>
<span id="cb57-542"><a href="#cb57-542" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"North Carolina and its coastal border"</span>, <span class="at">color =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb57-543"><a href="#cb57-543" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb57-544"><a href="#cb57-544" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> bbox_nc[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)],</span>
<span id="cb57-545"><a href="#cb57-545" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> bbox_nc[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)],</span>
<span id="cb57-546"><a href="#cb57-546" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)</span>
<span id="cb57-547"><a href="#cb57-547" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-548"><a href="#cb57-548" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>() <span class="sc">+</span></span>
<span id="cb57-549"><a href="#cb57-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb57-550"><a href="#cb57-550" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> clr_ocean),</span>
<span id="cb57-551"><a href="#cb57-551" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="fl">6.5</span>, <span class="dv">0</span>, <span class="fl">6.5</span>, <span class="dv">0</span>)),</span>
<span id="cb57-552"><a href="#cb57-552" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">"lines"</span>),</span>
<span id="cb57-553"><a href="#cb57-553" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb57-554"><a href="#cb57-554" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span></span>
<span id="cb57-555"><a href="#cb57-555" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-556"><a href="#cb57-556" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-557"><a href="#cb57-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-558"><a href="#cb57-558" aria-hidden="true" tabindex="-1"></a>And we can find the proportion of the state's borders that are coastline:</span>
<span id="cb57-559"><a href="#cb57-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-562"><a href="#cb57-562" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-563"><a href="#cb57-563" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-nc-prop-ocean</span></span>
<span id="cb57-564"><a href="#cb57-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-565"><a href="#cb57-565" aria-hidden="true" tabindex="-1"></a>nc_border_perimeter <span class="ot">&lt;-</span> census_nc <span class="sc">|&gt;</span> </span>
<span id="cb57-566"><a href="#cb57-566" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_perimeter</span>()</span>
<span id="cb57-567"><a href="#cb57-567" aria-hidden="true" tabindex="-1"></a>nc_border_perimeter</span>
<span id="cb57-568"><a href="#cb57-568" aria-hidden="true" tabindex="-1"></a>units<span class="sc">::</span><span class="fu">set_units</span>(nc_border_perimeter, <span class="st">"miles"</span>)</span>
<span id="cb57-569"><a href="#cb57-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-570"><a href="#cb57-570" aria-hidden="true" tabindex="-1"></a>nc_ocean_border_perimeter <span class="ot">&lt;-</span> nc_ocean_border_census <span class="sc">|&gt;</span> </span>
<span id="cb57-571"><a href="#cb57-571" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_perimeter</span>()</span>
<span id="cb57-572"><a href="#cb57-572" aria-hidden="true" tabindex="-1"></a>nc_ocean_border_perimeter <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb57-573"><a href="#cb57-573" aria-hidden="true" tabindex="-1"></a>units<span class="sc">::</span><span class="fu">set_units</span>(nc_ocean_border_perimeter <span class="sc">/</span> <span class="dv">2</span>, <span class="st">"miles"</span>)</span>
<span id="cb57-574"><a href="#cb57-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-575"><a href="#cb57-575" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>((nc_ocean_border_perimeter <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">/</span> nc_border_perimeter) <span class="sc">|&gt;</span> </span>
<span id="cb57-576"><a href="#cb57-576" aria-hidden="true" tabindex="-1"></a>  scales<span class="sc">::</span><span class="fu">label_percent</span>()()</span>
<span id="cb57-577"><a href="#cb57-577" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-578"><a href="#cb57-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-579"><a href="#cb57-579" aria-hidden="true" tabindex="-1"></a>This approach is great. We don't need to worry about making sure the coastline map matches the resolution of the state map, since we're using just one map. Everything aligns perfectly automatically.</span>
<span id="cb57-580"><a href="#cb57-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-581"><a href="#cb57-581" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb57-582"><a href="#cb57-582" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;hr class="dinkus"&gt;</span></span>
<span id="cb57-583"><a href="#cb57-583" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-584"><a href="#cb57-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-585"><a href="#cb57-585" aria-hidden="true" tabindex="-1"></a>BUT there's one more wrinkle to worry about. This approach gets trickier with states that touch other countries, like Washington, where the western border touches the ocean, the northern border touches Canada, and the eastern and southern borders touch other states. The state data knows about Idaho and Oregon, but it doesn't know that Canada is there. Washington looks like it has an exterior, ocean-facing western border—Canada is replaced with an ocean.</span>
<span id="cb57-586"><a href="#cb57-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-589"><a href="#cb57-589" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-590"><a href="#cb57-590" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-wa-census-borders-extracted-wrong</span></span>
<span id="cb57-591"><a href="#cb57-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-592"><a href="#cb57-592" aria-hidden="true" tabindex="-1"></a>census_wa <span class="ot">&lt;-</span> census_states <span class="sc">|&gt;</span> <span class="fu">filter</span>(NAME <span class="sc">==</span> <span class="st">"Washington"</span>)</span>
<span id="cb57-593"><a href="#cb57-593" aria-hidden="true" tabindex="-1"></a>bbox_wa <span class="ot">&lt;-</span> census_wa <span class="sc">|&gt;</span> <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)) <span class="sc">|&gt;</span> <span class="fu">st_bbox</span>()</span>
<span id="cb57-594"><a href="#cb57-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-595"><a href="#cb57-595" aria-hidden="true" tabindex="-1"></a>wa_ocean_border_census <span class="ot">&lt;-</span> census_wa <span class="sc">|&gt;</span> </span>
<span id="cb57-596"><a href="#cb57-596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="at">dist =</span> <span class="fl">0.001</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-597"><a href="#cb57-597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_difference</span>(census_us_giant)</span>
<span id="cb57-598"><a href="#cb57-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-599"><a href="#cb57-599" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb57-600"><a href="#cb57-600" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> census_us_giant, <span class="at">fill =</span> clrs[<span class="dv">1</span>], <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb57-601"><a href="#cb57-601" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> census_wa, <span class="at">linewidth =</span> <span class="fl">0.1</span>, <span class="at">fill =</span> clrs[<span class="dv">3</span>]) <span class="sc">+</span></span>
<span id="cb57-602"><a href="#cb57-602" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb57-603"><a href="#cb57-603" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> wa_ocean_border_census, <span class="at">linewidth =</span> <span class="fl">0.4</span>, </span>
<span id="cb57-604"><a href="#cb57-604" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"Coastal border extracted from US shape"</span>),</span>
<span id="cb57-605"><a href="#cb57-605" aria-hidden="true" tabindex="-1"></a>    <span class="at">key_glyph =</span> draw_key_path</span>
<span id="cb57-606"><a href="#cb57-606" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-607"><a href="#cb57-607" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.64</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="fl">0.91</span>), <span class="at">label =</span> <span class="st">"↑ Canada (British Columbia) ↑"</span>) <span class="sc">+</span></span>
<span id="cb57-608"><a href="#cb57-608" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.54</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="fl">0.18</span>), <span class="at">label =</span> <span class="st">"↓ Oregon ↓"</span>) <span class="sc">+</span></span>
<span id="cb57-609"><a href="#cb57-609" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.87</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="fl">0.5</span>), <span class="at">label =</span> <span class="st">"Idaho →"</span>) <span class="sc">+</span></span>
<span id="cb57-610"><a href="#cb57-610" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clrs[<span class="dv">8</span>])) <span class="sc">+</span></span>
<span id="cb57-611"><a href="#cb57-611" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Washington and the fake Canadian ocean"</span>, <span class="at">color =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb57-612"><a href="#cb57-612" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb57-613"><a href="#cb57-613" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> bbox_wa[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)],</span>
<span id="cb57-614"><a href="#cb57-614" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> bbox_wa[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)],</span>
<span id="cb57-615"><a href="#cb57-615" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)</span>
<span id="cb57-616"><a href="#cb57-616" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-617"><a href="#cb57-617" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>() <span class="sc">+</span></span>
<span id="cb57-618"><a href="#cb57-618" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb57-619"><a href="#cb57-619" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> clr_ocean),</span>
<span id="cb57-620"><a href="#cb57-620" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="fl">6.5</span>, <span class="dv">0</span>, <span class="fl">6.5</span>, <span class="dv">0</span>)),</span>
<span id="cb57-621"><a href="#cb57-621" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">"lines"</span>),</span>
<span id="cb57-622"><a href="#cb57-622" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb57-623"><a href="#cb57-623" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span></span>
<span id="cb57-624"><a href="#cb57-624" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-625"><a href="#cb57-625" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-626"><a href="#cb57-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-627"><a href="#cb57-627" aria-hidden="true" tabindex="-1"></a>The big US-shaped polygon isn't big enough for identifying land borders in other countries. In order to identify *all* the ocean-facing state borders, we need data about Canada and Mexico, and the US Census doesn't provide that.</span>
<span id="cb57-628"><a href="#cb57-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-629"><a href="#cb57-629" aria-hidden="true" tabindex="-1"></a>So we give up.</span>
<span id="cb57-630"><a href="#cb57-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-631"><a href="#cb57-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-632"><a href="#cb57-632" aria-hidden="true" tabindex="-1"></a><span class="fu"># Use data from Natural Earth</span></span>
<span id="cb57-633"><a href="#cb57-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-634"><a href="#cb57-634" aria-hidden="true" tabindex="-1"></a>Just kidding. There's a better solution.</span>
<span id="cb57-635"><a href="#cb57-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-636"><a href="#cb57-636" aria-hidden="true" tabindex="-1"></a>The Census doesn't have data on other countries, but other data sources do! The <span class="co">[</span><span class="ot">incredible Natural Earth project</span><span class="co">](https://www.naturalearthdata.com/)</span> has a ton of shapefiles for the entire world, both <span class="co">[</span><span class="ot">physical</span><span class="co">](https://www.naturalearthdata.com/downloads/10m-physical-vectors/)</span> (i.e. rivers, coastlines, etc.) and <span class="co">[</span><span class="ot">cultural</span><span class="co">](https://www.naturalearthdata.com/downloads/10m-cultural-vectors/)</span>, like borders for countries (what it calls <span class="in">`Admin-0`</span>) and states/provinces (what it calls <span class="in">`Admin-1`</span>). It offers three levels of resolution: 1:10 million (high resolution), 1:50 million (medium resolution), and 1:110 million (low resolution).</span>
<span id="cb57-637"><a href="#cb57-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-638"><a href="#cb57-638" aria-hidden="true" tabindex="-1"></a>Plus, like {tigris}, <span class="co">[</span><span class="ot">the {rnaturalearth} package</span><span class="co">](https://ropensci.github.io/rnaturalearth/)</span> makes it really easy to load that data directly into R.</span>
<span id="cb57-639"><a href="#cb57-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-640"><a href="#cb57-640" aria-hidden="true" tabindex="-1"></a>Let's follow the same process for Hawaiʻi, North Carolina, and Washington using Natural Earth data instead of Census data.</span>
<span id="cb57-641"><a href="#cb57-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-642"><a href="#cb57-642" aria-hidden="true" tabindex="-1"></a>First, we'll grab high resolution (1:10 million) maps from the <span class="in">`Admin-1`</span> (states and provinces) data:</span>
<span id="cb57-643"><a href="#cb57-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-646"><a href="#cb57-646" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-647"><a href="#cb57-647" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: get-ne10-admin1</span></span>
<span id="cb57-648"><a href="#cb57-648" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hide</span></span>
<span id="cb57-649"><a href="#cb57-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-650"><a href="#cb57-650" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">"ne_data/ne_10m_admin_1_states_provinces_lakes.shp"</span>)) {</span>
<span id="cb57-651"><a href="#cb57-651" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ne_download</span>(</span>
<span id="cb57-652"><a href="#cb57-652" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"admin_1_states_provinces_lakes"</span>, </span>
<span id="cb57-653"><a href="#cb57-653" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale =</span> <span class="dv">10</span>,</span>
<span id="cb57-654"><a href="#cb57-654" aria-hidden="true" tabindex="-1"></a>    <span class="at">destdir =</span> <span class="st">"ne_data"</span>,</span>
<span id="cb57-655"><a href="#cb57-655" aria-hidden="true" tabindex="-1"></a>    <span class="at">load =</span> <span class="cn">FALSE</span></span>
<span id="cb57-656"><a href="#cb57-656" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-657"><a href="#cb57-657" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb57-658"><a href="#cb57-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-659"><a href="#cb57-659" aria-hidden="true" tabindex="-1"></a>states_provinces <span class="ot">&lt;-</span> <span class="fu">ne_load</span>(</span>
<span id="cb57-660"><a href="#cb57-660" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"admin_1_states_provinces_lakes"</span>, </span>
<span id="cb57-661"><a href="#cb57-661" aria-hidden="true" tabindex="-1"></a>  <span class="at">scale =</span> <span class="dv">10</span>,</span>
<span id="cb57-662"><a href="#cb57-662" aria-hidden="true" tabindex="-1"></a>  <span class="at">destdir =</span> <span class="st">"ne_data"</span></span>
<span id="cb57-663"><a href="#cb57-663" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-664"><a href="#cb57-664" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-665"><a href="#cb57-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-666"><a href="#cb57-666" aria-hidden="true" tabindex="-1"></a>We only need to work with three countries, not the entire world, so we'll filter it down to just North America before joining everything into a single shape with <span class="in">`st_union()`</span>:</span>
<span id="cb57-667"><a href="#cb57-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-670"><a href="#cb57-670" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-671"><a href="#cb57-671" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-ne10-giant</span></span>
<span id="cb57-672"><a href="#cb57-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-673"><a href="#cb57-673" aria-hidden="true" tabindex="-1"></a>na_giant <span class="ot">&lt;-</span> states_provinces <span class="sc">|&gt;</span> </span>
<span id="cb57-674"><a href="#cb57-674" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(admin <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"United States of America"</span>, <span class="st">"Canada"</span>, <span class="st">"Mexico"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb57-675"><a href="#cb57-675" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_union</span>() <span class="sc">|&gt;</span> </span>
<span id="cb57-676"><a href="#cb57-676" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"ESRI:102003"</span>))  <span class="co"># Convert to Albers for meters</span></span>
<span id="cb57-677"><a href="#cb57-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-678"><a href="#cb57-678" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb57-679"><a href="#cb57-679" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> na_giant, <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">fill =</span> clrs[<span class="dv">10</span>]) <span class="sc">+</span></span>
<span id="cb57-680"><a href="#cb57-680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"One big North America-shaped shape"</span>) <span class="sc">+</span></span>
<span id="cb57-681"><a href="#cb57-681" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"ESRI:102003"</span>)) <span class="sc">+</span></span>
<span id="cb57-682"><a href="#cb57-682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>() <span class="sc">+</span></span>
<span id="cb57-683"><a href="#cb57-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb57-684"><a href="#cb57-684" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> clr_ocean), </span>
<span id="cb57-685"><a href="#cb57-685" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="fl">6.5</span>, <span class="dv">0</span>, <span class="fl">6.5</span>, <span class="dv">0</span>))</span>
<span id="cb57-686"><a href="#cb57-686" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-687"><a href="#cb57-687" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-688"><a href="#cb57-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-689"><a href="#cb57-689" aria-hidden="true" tabindex="-1"></a>(That's so pretty.)</span>
<span id="cb57-690"><a href="#cb57-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-691"><a href="#cb57-691" aria-hidden="true" tabindex="-1"></a>Next, we'll extract all the US states from the Natural Earth data, since we want this big North American shape to match the states exactly:</span>
<span id="cb57-692"><a href="#cb57-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-695"><a href="#cb57-695" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-696"><a href="#cb57-696" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-ne10-giant-with-states</span></span>
<span id="cb57-697"><a href="#cb57-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-698"><a href="#cb57-698" aria-hidden="true" tabindex="-1"></a>ne_states <span class="ot">&lt;-</span> states_provinces <span class="sc">|&gt;</span> </span>
<span id="cb57-699"><a href="#cb57-699" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(admin <span class="sc">==</span> <span class="st">"United States of America"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-700"><a href="#cb57-700" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"ESRI:102003"</span>))</span>
<span id="cb57-701"><a href="#cb57-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-702"><a href="#cb57-702" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb57-703"><a href="#cb57-703" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> na_giant, <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">fill =</span> clrs[<span class="dv">10</span>]) <span class="sc">+</span></span>
<span id="cb57-704"><a href="#cb57-704" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ne_states, <span class="at">linewidth =</span> <span class="fl">0.05</span>, <span class="at">fill =</span> clrs[<span class="dv">8</span>], <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb57-705"><a href="#cb57-705" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"The United States overlaid on North America"</span>) <span class="sc">+</span></span>
<span id="cb57-706"><a href="#cb57-706" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"ESRI:102003"</span>)) <span class="sc">+</span></span>
<span id="cb57-707"><a href="#cb57-707" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>() <span class="sc">+</span></span>
<span id="cb57-708"><a href="#cb57-708" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb57-709"><a href="#cb57-709" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> clr_ocean), </span>
<span id="cb57-710"><a href="#cb57-710" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="fl">6.5</span>, <span class="dv">0</span>, <span class="fl">6.5</span>, <span class="dv">0</span>))</span>
<span id="cb57-711"><a href="#cb57-711" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-712"><a href="#cb57-712" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-713"><a href="#cb57-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-714"><a href="#cb57-714" aria-hidden="true" tabindex="-1"></a>Now we'll go through the same process as before, using state shapes as cookie cutters from the larger North American shape and extracting non-interior borders. </span>
<span id="cb57-715"><a href="#cb57-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-716"><a href="#cb57-716" aria-hidden="true" tabindex="-1"></a><span class="fu">## Hawaiʻi</span></span>
<span id="cb57-717"><a href="#cb57-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-718"><a href="#cb57-718" aria-hidden="true" tabindex="-1"></a>Here are Hawaiʻi's extracted borders—because we're working with high resolution data, we get a lot more detail, including all the <span class="co">[</span><span class="ot">Northwestern Hawaiian Islands</span><span class="co">](https://en.wikipedia.org/wiki/Northwestern_Hawaiian_Islands)</span>:</span>
<span id="cb57-719"><a href="#cb57-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-722"><a href="#cb57-722" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-723"><a href="#cb57-723" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-hi-ne-borders-extracted</span></span>
<span id="cb57-724"><a href="#cb57-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-725"><a href="#cb57-725" aria-hidden="true" tabindex="-1"></a>ne_hi <span class="ot">&lt;-</span> ne_states <span class="sc">|&gt;</span> <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">"Hawaii"</span>)</span>
<span id="cb57-726"><a href="#cb57-726" aria-hidden="true" tabindex="-1"></a>bbox_ne_hi <span class="ot">&lt;-</span> ne_hi <span class="sc">|&gt;</span> <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)) <span class="sc">|&gt;</span> <span class="fu">st_bbox</span>()</span>
<span id="cb57-727"><a href="#cb57-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-728"><a href="#cb57-728" aria-hidden="true" tabindex="-1"></a>hi_ocean_border_ne <span class="ot">&lt;-</span> ne_hi <span class="sc">|&gt;</span> </span>
<span id="cb57-729"><a href="#cb57-729" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="at">dist =</span> <span class="fl">0.001</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-730"><a href="#cb57-730" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_difference</span>(na_giant)</span>
<span id="cb57-731"><a href="#cb57-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-732"><a href="#cb57-732" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb57-733"><a href="#cb57-733" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> hi_ocean_border_ne, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb57-734"><a href="#cb57-734" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Hawaiʻi’s coastal borders extracted from North America shape"</span>) <span class="sc">+</span></span>
<span id="cb57-735"><a href="#cb57-735" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb57-736"><a href="#cb57-736" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> bbox_ne_hi[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)],</span>
<span id="cb57-737"><a href="#cb57-737" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> bbox_ne_hi[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)],</span>
<span id="cb57-738"><a href="#cb57-738" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)</span>
<span id="cb57-739"><a href="#cb57-739" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-740"><a href="#cb57-740" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>()</span>
<span id="cb57-741"><a href="#cb57-741" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-742"><a href="#cb57-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-743"><a href="#cb57-743" aria-hidden="true" tabindex="-1"></a>As before, we can calculate the perimeter of the state, the perimeter of the coastline, and find the proportion. It's 100%, as expected:</span>
<span id="cb57-744"><a href="#cb57-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-747"><a href="#cb57-747" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-748"><a href="#cb57-748" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-hi-prop-ocean-ne</span></span>
<span id="cb57-749"><a href="#cb57-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-750"><a href="#cb57-750" aria-hidden="true" tabindex="-1"></a><span class="co"># State border</span></span>
<span id="cb57-751"><a href="#cb57-751" aria-hidden="true" tabindex="-1"></a>hi_border_perimeter_ne <span class="ot">&lt;-</span> ne_hi <span class="sc">|&gt;</span> </span>
<span id="cb57-752"><a href="#cb57-752" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_perimeter</span>()</span>
<span id="cb57-753"><a href="#cb57-753" aria-hidden="true" tabindex="-1"></a>hi_border_perimeter_ne</span>
<span id="cb57-754"><a href="#cb57-754" aria-hidden="true" tabindex="-1"></a>units<span class="sc">::</span><span class="fu">set_units</span>(hi_border_perimeter_ne, <span class="st">"miles"</span>)</span>
<span id="cb57-755"><a href="#cb57-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-756"><a href="#cb57-756" aria-hidden="true" tabindex="-1"></a><span class="co"># Coastal border</span></span>
<span id="cb57-757"><a href="#cb57-757" aria-hidden="true" tabindex="-1"></a>hi_ocean_border_perimeter_ne <span class="ot">&lt;-</span> hi_ocean_border_ne <span class="sc">|&gt;</span> </span>
<span id="cb57-758"><a href="#cb57-758" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_perimeter</span>()</span>
<span id="cb57-759"><a href="#cb57-759" aria-hidden="true" tabindex="-1"></a>hi_ocean_border_perimeter_ne <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb57-760"><a href="#cb57-760" aria-hidden="true" tabindex="-1"></a>units<span class="sc">::</span><span class="fu">set_units</span>(hi_ocean_border_perimeter_ne <span class="sc">/</span> <span class="dv">2</span>, <span class="st">"miles"</span>)</span>
<span id="cb57-761"><a href="#cb57-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-762"><a href="#cb57-762" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion</span></span>
<span id="cb57-763"><a href="#cb57-763" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>((hi_ocean_border_perimeter_ne <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">/</span> hi_border_perimeter_ne) <span class="sc">|&gt;</span> </span>
<span id="cb57-764"><a href="#cb57-764" aria-hidden="true" tabindex="-1"></a>  scales<span class="sc">::</span><span class="fu">label_percent</span>()()</span>
<span id="cb57-765"><a href="#cb57-765" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-766"><a href="#cb57-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-767"><a href="#cb57-767" aria-hidden="true" tabindex="-1"></a><span class="fu">## North Carolina</span></span>
<span id="cb57-768"><a href="#cb57-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-769"><a href="#cb57-769" aria-hidden="true" tabindex="-1"></a>The same process works for North Carolina</span>
<span id="cb57-770"><a href="#cb57-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-773"><a href="#cb57-773" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-774"><a href="#cb57-774" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-nc-ne-borders-extracted</span></span>
<span id="cb57-775"><a href="#cb57-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-776"><a href="#cb57-776" aria-hidden="true" tabindex="-1"></a>ne_nc <span class="ot">&lt;-</span> ne_states <span class="sc">|&gt;</span> <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">"North Carolina"</span>)</span>
<span id="cb57-777"><a href="#cb57-777" aria-hidden="true" tabindex="-1"></a>bbox_ne_nc <span class="ot">&lt;-</span> ne_nc <span class="sc">|&gt;</span> <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)) <span class="sc">|&gt;</span> <span class="fu">st_bbox</span>()</span>
<span id="cb57-778"><a href="#cb57-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-779"><a href="#cb57-779" aria-hidden="true" tabindex="-1"></a>nc_ocean_border_ne <span class="ot">&lt;-</span> ne_nc <span class="sc">|&gt;</span> </span>
<span id="cb57-780"><a href="#cb57-780" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="at">dist =</span> <span class="fl">0.001</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-781"><a href="#cb57-781" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_difference</span>(na_giant)</span>
<span id="cb57-782"><a href="#cb57-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-783"><a href="#cb57-783" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb57-784"><a href="#cb57-784" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> nc_ocean_border_ne, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb57-785"><a href="#cb57-785" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"North Carolina’s coastal borders</span><span class="sc">\n</span><span class="st">extracted from North America shape"</span>) <span class="sc">+</span></span>
<span id="cb57-786"><a href="#cb57-786" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)) <span class="sc">+</span></span>
<span id="cb57-787"><a href="#cb57-787" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>()</span>
<span id="cb57-788"><a href="#cb57-788" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-789"><a href="#cb57-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-790"><a href="#cb57-790" aria-hidden="true" tabindex="-1"></a>Here's that extracted coastline with the rest of the state:</span>
<span id="cb57-791"><a href="#cb57-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-794"><a href="#cb57-794" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-795"><a href="#cb57-795" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-nc-ne-coastal-borders</span></span>
<span id="cb57-796"><a href="#cb57-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-797"><a href="#cb57-797" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb57-798"><a href="#cb57-798" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> na_giant, <span class="at">fill =</span> clrs[<span class="dv">10</span>], <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb57-799"><a href="#cb57-799" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ne_nc, <span class="at">linewidth =</span> <span class="fl">0.1</span>, <span class="at">fill =</span> clrs[<span class="dv">6</span>]) <span class="sc">+</span></span>
<span id="cb57-800"><a href="#cb57-800" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb57-801"><a href="#cb57-801" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> nc_ocean_border_ne, <span class="at">linewidth =</span> <span class="fl">0.4</span>, </span>
<span id="cb57-802"><a href="#cb57-802" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"Coastal border extracted from North America shape"</span>),</span>
<span id="cb57-803"><a href="#cb57-803" aria-hidden="true" tabindex="-1"></a>    <span class="at">key_glyph =</span> draw_key_path</span>
<span id="cb57-804"><a href="#cb57-804" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-805"><a href="#cb57-805" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.6</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="fl">0.89</span>), <span class="at">label =</span> <span class="st">"↑ Virginia ↑"</span>) <span class="sc">+</span></span>
<span id="cb57-806"><a href="#cb57-806" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.58</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="fl">0.3</span>), <span class="at">label =</span> <span class="st">"↓ South Carolina ↓"</span>, <span class="at">angle =</span> <span class="dv">313</span>) <span class="sc">+</span></span>
<span id="cb57-807"><a href="#cb57-807" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.14</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="fl">0.5</span>), <span class="at">label =</span> <span class="st">"↓ Georgia"</span>) <span class="sc">+</span></span>
<span id="cb57-808"><a href="#cb57-808" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.27</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="fl">0.64</span>), <span class="at">label =</span> <span class="st">"← Tennessee"</span>) <span class="sc">+</span></span>
<span id="cb57-809"><a href="#cb57-809" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clrs[<span class="dv">8</span>])) <span class="sc">+</span></span>
<span id="cb57-810"><a href="#cb57-810" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"The actual North Carolina coastline"</span>, <span class="at">color =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb57-811"><a href="#cb57-811" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb57-812"><a href="#cb57-812" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> bbox_ne_nc[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)],</span>
<span id="cb57-813"><a href="#cb57-813" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> bbox_ne_nc[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)],</span>
<span id="cb57-814"><a href="#cb57-814" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)</span>
<span id="cb57-815"><a href="#cb57-815" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-816"><a href="#cb57-816" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>() <span class="sc">+</span></span>
<span id="cb57-817"><a href="#cb57-817" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb57-818"><a href="#cb57-818" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> clr_ocean),</span>
<span id="cb57-819"><a href="#cb57-819" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="fl">6.5</span>, <span class="dv">0</span>, <span class="fl">6.5</span>, <span class="dv">0</span>)),</span>
<span id="cb57-820"><a href="#cb57-820" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">"lines"</span>),</span>
<span id="cb57-821"><a href="#cb57-821" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb57-822"><a href="#cb57-822" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span></span>
<span id="cb57-823"><a href="#cb57-823" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-824"><a href="#cb57-824" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-825"><a href="#cb57-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-826"><a href="#cb57-826" aria-hidden="true" tabindex="-1"></a>Now we can calculate proportion of coastline:</span>
<span id="cb57-827"><a href="#cb57-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-830"><a href="#cb57-830" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-831"><a href="#cb57-831" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-nc-prop-ocean-ne</span></span>
<span id="cb57-832"><a href="#cb57-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-833"><a href="#cb57-833" aria-hidden="true" tabindex="-1"></a><span class="co"># State border</span></span>
<span id="cb57-834"><a href="#cb57-834" aria-hidden="true" tabindex="-1"></a>nc_border_perimeter_ne <span class="ot">&lt;-</span> ne_nc <span class="sc">|&gt;</span> </span>
<span id="cb57-835"><a href="#cb57-835" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_perimeter</span>()</span>
<span id="cb57-836"><a href="#cb57-836" aria-hidden="true" tabindex="-1"></a>nc_border_perimeter_ne</span>
<span id="cb57-837"><a href="#cb57-837" aria-hidden="true" tabindex="-1"></a>units<span class="sc">::</span><span class="fu">set_units</span>(nc_border_perimeter_ne, <span class="st">"miles"</span>)</span>
<span id="cb57-838"><a href="#cb57-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-839"><a href="#cb57-839" aria-hidden="true" tabindex="-1"></a><span class="co"># Coastal border</span></span>
<span id="cb57-840"><a href="#cb57-840" aria-hidden="true" tabindex="-1"></a>nc_ocean_border_perimeter_ne <span class="ot">&lt;-</span> nc_ocean_border_ne <span class="sc">|&gt;</span> </span>
<span id="cb57-841"><a href="#cb57-841" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_perimeter</span>()</span>
<span id="cb57-842"><a href="#cb57-842" aria-hidden="true" tabindex="-1"></a>nc_ocean_border_perimeter_ne <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb57-843"><a href="#cb57-843" aria-hidden="true" tabindex="-1"></a>units<span class="sc">::</span><span class="fu">set_units</span>(nc_ocean_border_perimeter_ne <span class="sc">/</span> <span class="dv">2</span>, <span class="st">"miles"</span>)</span>
<span id="cb57-844"><a href="#cb57-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-845"><a href="#cb57-845" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion</span></span>
<span id="cb57-846"><a href="#cb57-846" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>((nc_ocean_border_perimeter_ne <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">/</span> nc_border_perimeter_ne) <span class="sc">|&gt;</span> </span>
<span id="cb57-847"><a href="#cb57-847" aria-hidden="true" tabindex="-1"></a>  scales<span class="sc">::</span><span class="fu">label_percent</span>()()</span>
<span id="cb57-848"><a href="#cb57-848" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-849"><a href="#cb57-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-850"><a href="#cb57-850" aria-hidden="true" tabindex="-1"></a>Sharp-eyed readers will notice something odd, though! Using Census maps at 1:5 million resolution, we found that <span class="in">`r scales::label_percent()(as.numeric((nc_ocean_border_perimeter / 2) / nc_border_perimeter))`</span> of North Carolina's borders were coastline. Using Natural Earth maps at 1:10 million resolution, it becomes <span class="in">`r scales::label_percent()(as.numeric((nc_ocean_border_perimeter_ne / 2) / nc_border_perimeter_ne))`</span>. I'll talk more about that discrepancy <span class="co">[</span><span class="ot">later in this post</span><span class="co">](#the-coastline-paradox-and-map-resolutions)</span> (spoiler: it's because of the new-to-me <span class="co">[</span><span class="ot">Coastline Paradox</span><span class="co">](https://en.wikipedia.org/wiki/Coastline_paradox)</span>). The detail in the two maps is different, so the amount of landmass visible along the coastline is different, yielding different perimeters and distances.</span>
<span id="cb57-851"><a href="#cb57-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-852"><a href="#cb57-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-853"><a href="#cb57-853" aria-hidden="true" tabindex="-1"></a><span class="fu">## Washington</span></span>
<span id="cb57-854"><a href="#cb57-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-855"><a href="#cb57-855" aria-hidden="true" tabindex="-1"></a>When we were using Census data, we couldn't use this process with Washington because Canada was invisible and was being treated as an ocean. Now that we have data from Natural Earth, Canada can be accounted for and we'll get the correct ocean-facing border.</span>
<span id="cb57-856"><a href="#cb57-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-859"><a href="#cb57-859" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-860"><a href="#cb57-860" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-wa-ne-borders-extracted</span></span>
<span id="cb57-861"><a href="#cb57-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-862"><a href="#cb57-862" aria-hidden="true" tabindex="-1"></a>ne_wa <span class="ot">&lt;-</span> ne_states <span class="sc">|&gt;</span> <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">"Washington"</span>)</span>
<span id="cb57-863"><a href="#cb57-863" aria-hidden="true" tabindex="-1"></a>bbox_ne_wa <span class="ot">&lt;-</span> ne_wa <span class="sc">|&gt;</span> <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)) <span class="sc">|&gt;</span> <span class="fu">st_bbox</span>()</span>
<span id="cb57-864"><a href="#cb57-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-865"><a href="#cb57-865" aria-hidden="true" tabindex="-1"></a>wa_ocean_border_ne <span class="ot">&lt;-</span> ne_wa <span class="sc">|&gt;</span> </span>
<span id="cb57-866"><a href="#cb57-866" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="at">dist =</span> <span class="fl">0.001</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-867"><a href="#cb57-867" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_difference</span>(na_giant)</span>
<span id="cb57-868"><a href="#cb57-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-869"><a href="#cb57-869" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb57-870"><a href="#cb57-870" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> wa_ocean_border_ne, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb57-871"><a href="#cb57-871" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Washington’s coastal borders</span><span class="sc">\n</span><span class="st">extracted from North America shape"</span>) <span class="sc">+</span></span>
<span id="cb57-872"><a href="#cb57-872" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)) <span class="sc">+</span></span>
<span id="cb57-873"><a href="#cb57-873" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>()</span>
<span id="cb57-874"><a href="#cb57-874" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-875"><a href="#cb57-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-876"><a href="#cb57-876" aria-hidden="true" tabindex="-1"></a>Here's that coastline in context:</span>
<span id="cb57-877"><a href="#cb57-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-880"><a href="#cb57-880" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-881"><a href="#cb57-881" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-wa-ne-coastal-borders</span></span>
<span id="cb57-882"><a href="#cb57-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-883"><a href="#cb57-883" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb57-884"><a href="#cb57-884" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> na_giant, <span class="at">fill =</span> clrs[<span class="dv">10</span>], <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb57-885"><a href="#cb57-885" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ne_wa, <span class="at">linewidth =</span> <span class="fl">0.1</span>, <span class="at">fill =</span> clrs[<span class="dv">3</span>]) <span class="sc">+</span></span>
<span id="cb57-886"><a href="#cb57-886" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb57-887"><a href="#cb57-887" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> wa_ocean_border_ne, <span class="at">linewidth =</span> <span class="fl">0.4</span>, </span>
<span id="cb57-888"><a href="#cb57-888" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"Coastal border extracted from North America shape"</span>),</span>
<span id="cb57-889"><a href="#cb57-889" aria-hidden="true" tabindex="-1"></a>    <span class="at">key_glyph =</span> draw_key_path</span>
<span id="cb57-890"><a href="#cb57-890" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-891"><a href="#cb57-891" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.64</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="fl">0.91</span>), <span class="at">label =</span> <span class="st">"↑ Canada (British Columbia) ↑"</span>) <span class="sc">+</span></span>
<span id="cb57-892"><a href="#cb57-892" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.54</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="fl">0.18</span>), <span class="at">label =</span> <span class="st">"↓ Oregon ↓"</span>) <span class="sc">+</span></span>
<span id="cb57-893"><a href="#cb57-893" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.87</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="fl">0.5</span>), <span class="at">label =</span> <span class="st">"Idaho →"</span>) <span class="sc">+</span></span>
<span id="cb57-894"><a href="#cb57-894" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clrs[<span class="dv">8</span>])) <span class="sc">+</span></span>
<span id="cb57-895"><a href="#cb57-895" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"The actual Washington coastline"</span>, <span class="at">color =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb57-896"><a href="#cb57-896" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb57-897"><a href="#cb57-897" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> bbox_ne_wa[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)],</span>
<span id="cb57-898"><a href="#cb57-898" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> bbox_ne_wa[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)],</span>
<span id="cb57-899"><a href="#cb57-899" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)</span>
<span id="cb57-900"><a href="#cb57-900" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-901"><a href="#cb57-901" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>() <span class="sc">+</span></span>
<span id="cb57-902"><a href="#cb57-902" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb57-903"><a href="#cb57-903" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> clr_ocean),</span>
<span id="cb57-904"><a href="#cb57-904" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="fl">6.5</span>, <span class="dv">0</span>, <span class="fl">6.5</span>, <span class="dv">0</span>)),</span>
<span id="cb57-905"><a href="#cb57-905" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">"lines"</span>),</span>
<span id="cb57-906"><a href="#cb57-906" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb57-907"><a href="#cb57-907" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span></span>
<span id="cb57-908"><a href="#cb57-908" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-909"><a href="#cb57-909" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-910"><a href="#cb57-910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-911"><a href="#cb57-911" aria-hidden="true" tabindex="-1"></a>Since the northern state border is no longer seen as a coastal border, can calculate the correct proportion of coastline:</span>
<span id="cb57-912"><a href="#cb57-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-915"><a href="#cb57-915" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-916"><a href="#cb57-916" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-wa-prop-ocean-ne</span></span>
<span id="cb57-917"><a href="#cb57-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-918"><a href="#cb57-918" aria-hidden="true" tabindex="-1"></a><span class="co"># State border</span></span>
<span id="cb57-919"><a href="#cb57-919" aria-hidden="true" tabindex="-1"></a>wa_border_perimeter_ne <span class="ot">&lt;-</span> ne_wa <span class="sc">|&gt;</span> </span>
<span id="cb57-920"><a href="#cb57-920" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_perimeter</span>()</span>
<span id="cb57-921"><a href="#cb57-921" aria-hidden="true" tabindex="-1"></a>wa_border_perimeter_ne</span>
<span id="cb57-922"><a href="#cb57-922" aria-hidden="true" tabindex="-1"></a>units<span class="sc">::</span><span class="fu">set_units</span>(wa_border_perimeter_ne, <span class="st">"miles"</span>)</span>
<span id="cb57-923"><a href="#cb57-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-924"><a href="#cb57-924" aria-hidden="true" tabindex="-1"></a><span class="co"># Coastal border</span></span>
<span id="cb57-925"><a href="#cb57-925" aria-hidden="true" tabindex="-1"></a>wa_ocean_border_perimeter_ne <span class="ot">&lt;-</span> wa_ocean_border_ne <span class="sc">|&gt;</span> </span>
<span id="cb57-926"><a href="#cb57-926" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_perimeter</span>()</span>
<span id="cb57-927"><a href="#cb57-927" aria-hidden="true" tabindex="-1"></a>wa_ocean_border_perimeter_ne <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb57-928"><a href="#cb57-928" aria-hidden="true" tabindex="-1"></a>units<span class="sc">::</span><span class="fu">set_units</span>(wa_ocean_border_perimeter_ne <span class="sc">/</span> <span class="dv">2</span>, <span class="st">"miles"</span>)</span>
<span id="cb57-929"><a href="#cb57-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-930"><a href="#cb57-930" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion</span></span>
<span id="cb57-931"><a href="#cb57-931" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>((wa_ocean_border_perimeter_ne <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">/</span> wa_border_perimeter_ne) <span class="sc">|&gt;</span> </span>
<span id="cb57-932"><a href="#cb57-932" aria-hidden="true" tabindex="-1"></a>  scales<span class="sc">::</span><span class="fu">label_percent</span>()()</span>
<span id="cb57-933"><a href="#cb57-933" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-934"><a href="#cb57-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-935"><a href="#cb57-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-936"><a href="#cb57-936" aria-hidden="true" tabindex="-1"></a><span class="fu">## All states</span></span>
<span id="cb57-937"><a href="#cb57-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-938"><a href="#cb57-938" aria-hidden="true" tabindex="-1"></a>Now that we know that the Natural Earth approach works, let's apply it to all the states. We'll nest the geographic data into a list column with a cell for each state, then extract the borders for each state</span>
<span id="cb57-939"><a href="#cb57-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-942"><a href="#cb57-942" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-943"><a href="#cb57-943" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-all-coastline-ne</span></span>
<span id="cb57-944"><a href="#cb57-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-945"><a href="#cb57-945" aria-hidden="true" tabindex="-1"></a>ne_coastline <span class="ot">&lt;-</span> ne_states <span class="sc">|&gt;</span></span>
<span id="cb57-946"><a href="#cb57-946" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">|&gt;</span> </span>
<span id="cb57-947"><a href="#cb57-947" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">|&gt;</span> </span>
<span id="cb57-948"><a href="#cb57-948" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ocean_only =</span> <span class="fu">map</span>(data, <span class="sc">~</span> {</span>
<span id="cb57-949"><a href="#cb57-949" aria-hidden="true" tabindex="-1"></a>    .x <span class="sc">|&gt;</span> </span>
<span id="cb57-950"><a href="#cb57-950" aria-hidden="true" tabindex="-1"></a>      <span class="fu">st_buffer</span>(<span class="at">dist =</span> <span class="fl">0.001</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-951"><a href="#cb57-951" aria-hidden="true" tabindex="-1"></a>      <span class="fu">st_difference</span>(na_giant)</span>
<span id="cb57-952"><a href="#cb57-952" aria-hidden="true" tabindex="-1"></a>  })) <span class="sc">|&gt;</span> </span>
<span id="cb57-953"><a href="#cb57-953" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(ocean_only) <span class="sc">|&gt;</span> </span>
<span id="cb57-954"><a href="#cb57-954" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb57-955"><a href="#cb57-955" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This special column somehow lost its specialness</span></span>
<span id="cb57-956"><a href="#cb57-956" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_geometry</span>(<span class="st">"geometry"</span>) </span>
<span id="cb57-957"><a href="#cb57-957" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-958"><a href="#cb57-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-961"><a href="#cb57-961" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-962"><a href="#cb57-962" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-all-coastline-ne</span></span>
<span id="cb57-963"><a href="#cb57-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-964"><a href="#cb57-964" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb57-965"><a href="#cb57-965" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> na_giant, <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">fill =</span> clrs[<span class="dv">10</span>], <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb57-966"><a href="#cb57-966" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb57-967"><a href="#cb57-967" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ne_coastline, <span class="at">linewidth =</span> <span class="fl">0.2</span>, </span>
<span id="cb57-968"><a href="#cb57-968" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"Coastal border extracted from North America shape"</span>),</span>
<span id="cb57-969"><a href="#cb57-969" aria-hidden="true" tabindex="-1"></a>    <span class="at">key_glyph =</span> draw_key_path</span>
<span id="cb57-970"><a href="#cb57-970" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-971"><a href="#cb57-971" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clrs[<span class="dv">8</span>])) <span class="sc">+</span></span>
<span id="cb57-972"><a href="#cb57-972" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"All US coastal borders"</span>, <span class="at">color =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb57-973"><a href="#cb57-973" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"ESRI:102003"</span>)) <span class="sc">+</span></span>
<span id="cb57-974"><a href="#cb57-974" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>() <span class="sc">+</span></span>
<span id="cb57-975"><a href="#cb57-975" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb57-976"><a href="#cb57-976" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> clr_ocean),</span>
<span id="cb57-977"><a href="#cb57-977" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="fl">6.5</span>, <span class="dv">0</span>, <span class="fl">6.5</span>, <span class="dv">0</span>)),</span>
<span id="cb57-978"><a href="#cb57-978" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">"lines"</span>),</span>
<span id="cb57-979"><a href="#cb57-979" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb57-980"><a href="#cb57-980" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span></span>
<span id="cb57-981"><a href="#cb57-981" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-982"><a href="#cb57-982" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-983"><a href="#cb57-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-984"><a href="#cb57-984" aria-hidden="true" tabindex="-1"></a>That looks great!</span>
<span id="cb57-985"><a href="#cb57-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-986"><a href="#cb57-986" aria-hidden="true" tabindex="-1"></a>Finally, let's put this in a table. We'll calculate the perimeter of all the states, then join that data to the coastal data, and then calculate the proportion of coastline.</span>
<span id="cb57-987"><a href="#cb57-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-990"><a href="#cb57-990" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-991"><a href="#cb57-991" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-all-prop-ocean-ne</span></span>
<span id="cb57-992"><a href="#cb57-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-993"><a href="#cb57-993" aria-hidden="true" tabindex="-1"></a>ne_state_border_lengths <span class="ot">&lt;-</span> ne_states <span class="sc">|&gt;</span> </span>
<span id="cb57-994"><a href="#cb57-994" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">border_length =</span> <span class="fu">st_perimeter</span>(geometry)) <span class="sc">|&gt;</span> </span>
<span id="cb57-995"><a href="#cb57-995" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb57-996"><a href="#cb57-996" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, border_length)</span>
<span id="cb57-997"><a href="#cb57-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-998"><a href="#cb57-998" aria-hidden="true" tabindex="-1"></a>coastline_length_by_state_ne <span class="ot">&lt;-</span> ne_coastline <span class="sc">|&gt;</span> </span>
<span id="cb57-999"><a href="#cb57-999" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">coastline_length =</span> <span class="fu">st_perimeter</span>(geometry) <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-1000"><a href="#cb57-1000" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb57-1001"><a href="#cb57-1001" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ne_state_border_lengths, <span class="at">by =</span> <span class="fu">join_by</span>(name)) <span class="sc">|&gt;</span> </span>
<span id="cb57-1002"><a href="#cb57-1002" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop_coastline =</span> <span class="fu">as.numeric</span>(coastline_length <span class="sc">/</span> border_length)) <span class="sc">|&gt;</span> </span>
<span id="cb57-1003"><a href="#cb57-1003" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">rank</span>(<span class="sc">-</span>prop_coastline)) <span class="sc">|&gt;</span> </span>
<span id="cb57-1004"><a href="#cb57-1004" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-1005"><a href="#cb57-1005" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">c</span>(border_length, coastline_length), </span>
<span id="cb57-1006"><a href="#cb57-1006" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="at">miles =</span> <span class="sc">~</span>units<span class="sc">::</span><span class="fu">set_units</span>(., <span class="st">"miles"</span>)))</span>
<span id="cb57-1007"><a href="#cb57-1007" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb57-1008"><a href="#cb57-1008" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb57-1009"><a href="#cb57-1009" aria-hidden="true" tabindex="-1"></a>    name, rank, prop_coastline, </span>
<span id="cb57-1010"><a href="#cb57-1010" aria-hidden="true" tabindex="-1"></a>    <span class="fu">starts_with</span>(<span class="st">"border_length"</span>), <span class="fu">starts_with</span>(<span class="st">"coastline_length"</span>)</span>
<span id="cb57-1011"><a href="#cb57-1011" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-1012"><a href="#cb57-1012" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-1013"><a href="#cb57-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1014"><a href="#cb57-1014" aria-hidden="true" tabindex="-1"></a>This is fantastic! Hawaiʻi has the highest proportion of coastline, for obvious reasons, and an astounding 95% of Alaska's borders touch the ocean, even though a huge chunk of the state shares a land border with Canada—there are just so many islands and inlets.</span>
<span id="cb57-1015"><a href="#cb57-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1016"><a href="#cb57-1016" aria-hidden="true" tabindex="-1"></a>In the contiguous United States, island-y states like Florida, Michigan, and Louisiana have the highest proportion of coastline. Despite their small size, the coastal New England states like New Jersey, Massachusetts, and Rhode Island have a lot of coastline relative to the rest of their borders. Check out Rhode Island at #10—my wife's offhand observation was pretty accurate! (These columns are sortable.)</span>
<span id="cb57-1017"><a href="#cb57-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1020"><a href="#cb57-1020" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-1021"><a href="#cb57-1021" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: show-tbl-all-prop-ocean-ne</span></span>
<span id="cb57-1022"><a href="#cb57-1022" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb57-1023"><a href="#cb57-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1024"><a href="#cb57-1024" aria-hidden="true" tabindex="-1"></a>coastline_length_by_state_ne <span class="sc">|&gt;</span> </span>
<span id="cb57-1025"><a href="#cb57-1025" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>border_length, <span class="sc">-</span>coastline_length) <span class="sc">|&gt;</span> </span>
<span id="cb57-1026"><a href="#cb57-1026" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(border_length_miles, coastline_length_miles), <span class="sc">~</span><span class="fu">as.numeric</span>(.))) <span class="sc">|&gt;</span> </span>
<span id="cb57-1027"><a href="#cb57-1027" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(prop_coastline)) <span class="sc">|&gt;</span> </span>
<span id="cb57-1028"><a href="#cb57-1028" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb57-1029"><a href="#cb57-1029" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb57-1030"><a href="#cb57-1030" aria-hidden="true" tabindex="-1"></a>    name <span class="sc">~</span> <span class="st">"State"</span>, </span>
<span id="cb57-1031"><a href="#cb57-1031" aria-hidden="true" tabindex="-1"></a>    rank <span class="sc">~</span> <span class="st">"Rank"</span>,</span>
<span id="cb57-1032"><a href="#cb57-1032" aria-hidden="true" tabindex="-1"></a>    prop_coastline <span class="sc">~</span> <span class="st">"% coastline"</span>,</span>
<span id="cb57-1033"><a href="#cb57-1033" aria-hidden="true" tabindex="-1"></a>    border_length_miles <span class="sc">~</span> <span class="st">"Border length (miles)"</span>,</span>
<span id="cb57-1034"><a href="#cb57-1034" aria-hidden="true" tabindex="-1"></a>    coastline_length_miles <span class="sc">~</span> <span class="st">"Coastline length (miles)"</span></span>
<span id="cb57-1035"><a href="#cb57-1035" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb57-1036"><a href="#cb57-1036" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_percent</span>(</span>
<span id="cb57-1037"><a href="#cb57-1037" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> prop_coastline,</span>
<span id="cb57-1038"><a href="#cb57-1038" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimals =</span> <span class="dv">1</span></span>
<span id="cb57-1039"><a href="#cb57-1039" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb57-1040"><a href="#cb57-1040" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(</span>
<span id="cb57-1041"><a href="#cb57-1041" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">ends_with</span>(<span class="st">"miles"</span>),</span>
<span id="cb57-1042"><a href="#cb57-1042" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimals =</span> <span class="dv">0</span></span>
<span id="cb57-1043"><a href="#cb57-1043" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb57-1044"><a href="#cb57-1044" aria-hidden="true" tabindex="-1"></a>  <span class="fu">opt_interactive</span>(<span class="at">page_size_default =</span> <span class="dv">16</span>, <span class="at">use_compact_mode =</span> <span class="cn">TRUE</span>, <span class="at">use_highlight =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-1045"><a href="#cb57-1045" aria-hidden="true" tabindex="-1"></a>  <span class="fu">opt_table_font</span>(<span class="st">"Libre Franklin"</span>)</span>
<span id="cb57-1046"><a href="#cb57-1046" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-1047"><a href="#cb57-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1048"><a href="#cb57-1048" aria-hidden="true" tabindex="-1"></a><span class="fu">## Highlighting coastal states</span></span>
<span id="cb57-1049"><a href="#cb57-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1050"><a href="#cb57-1050" aria-hidden="true" tabindex="-1"></a>There are 31 states (technically 30 + Washington, D.C.) that touch the ocean or one of the Great Lakes somewhere. For bonus fun, we can highlight them on a map to show what we're working with. For the sake of plotting, and to show off one really neat feature in {tigris}, we'll shift Alaska and Hawaiʻi around so that they're where Mexico would be.</span>
<span id="cb57-1051"><a href="#cb57-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1054"><a href="#cb57-1054" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-1055"><a href="#cb57-1055" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-coastal-states-binary</span></span>
<span id="cb57-1056"><a href="#cb57-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1057"><a href="#cb57-1057" aria-hidden="true" tabindex="-1"></a>ne_states_to_plot <span class="ot">&lt;-</span> ne_states <span class="sc">|&gt;</span> </span>
<span id="cb57-1058"><a href="#cb57-1058" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">is_coastal =</span> name <span class="sc">%in%</span> ne_coastline<span class="sc">$</span>name) <span class="sc">|&gt;</span> </span>
<span id="cb57-1059"><a href="#cb57-1059" aria-hidden="true" tabindex="-1"></a>  tigris<span class="sc">::</span><span class="fu">shift_geometry</span>()</span>
<span id="cb57-1060"><a href="#cb57-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1061"><a href="#cb57-1061" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb57-1062"><a href="#cb57-1062" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb57-1063"><a href="#cb57-1063" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ne_states_to_plot, <span class="fu">aes</span>(<span class="at">fill =</span> is_coastal),</span>
<span id="cb57-1064"><a href="#cb57-1064" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="fl">0.05</span>, <span class="at">color =</span> <span class="st">"grey70"</span></span>
<span id="cb57-1065"><a href="#cb57-1065" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-1066"><a href="#cb57-1066" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"white"</span>, clrs[<span class="dv">8</span>]), <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb57-1067"><a href="#cb57-1067" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"US states with a coastline"</span>) <span class="sc">+</span></span>
<span id="cb57-1068"><a href="#cb57-1068" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>()</span>
<span id="cb57-1069"><a href="#cb57-1069" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-1070"><a href="#cb57-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1071"><a href="#cb57-1071" aria-hidden="true" tabindex="-1"></a>That's cool, but we can make it fancier. Right now we've filled all the coastal states with red, but it would be neat to fill them with different colors. We *could* use <span class="in">`aes(fill = name)`</span>, but that would give us 31 different indistinguishable colors. </span>
<span id="cb57-1072"><a href="#cb57-1072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1073"><a href="#cb57-1073" aria-hidden="true" tabindex="-1"></a>Another approach would be to choose a smaller number of colors (like 5) and assign them across the coastal states. But how we allocate these colors is a little tricky. If we assign them randomly, or based on alphabetical order, or some other system, we'll get bordering states that share the same color, which looks bad aesthetically (and reduces the map's readability and usability). For example, here we assign the colors 1–5 to the coastal states alphabetically, and we end up with blobs like Wisconsin + Michigan + Indiana, Pennsylvania + New Jersey + Delaware, Virginia + Maryland, and North + South Carolina. That's not great.</span>
<span id="cb57-1074"><a href="#cb57-1074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1077"><a href="#cb57-1077" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-1078"><a href="#cb57-1078" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-coastal-states-5-but-bad</span></span>
<span id="cb57-1079"><a href="#cb57-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1080"><a href="#cb57-1080" aria-hidden="true" tabindex="-1"></a>ne_states_to_plot_colors_alphabetic <span class="ot">&lt;-</span> ne_states <span class="sc">|&gt;</span> </span>
<span id="cb57-1081"><a href="#cb57-1081" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">is_coastal =</span> name <span class="sc">%in%</span> ne_coastline<span class="sc">$</span>name) <span class="sc">|&gt;</span> </span>
<span id="cb57-1082"><a href="#cb57-1082" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(name, is_coastal) <span class="sc">|&gt;</span> </span>
<span id="cb57-1083"><a href="#cb57-1083" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(is_coastal) <span class="sc">|&gt;</span> </span>
<span id="cb57-1084"><a href="#cb57-1084" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">coastal_colors =</span> <span class="fu">case_when</span>(</span>
<span id="cb57-1085"><a href="#cb57-1085" aria-hidden="true" tabindex="-1"></a>    is_coastal <span class="sc">~</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">length.out =</span> <span class="fu">n</span>()),</span>
<span id="cb57-1086"><a href="#cb57-1086" aria-hidden="true" tabindex="-1"></a>     <span class="at">.default =</span> <span class="cn">NA</span></span>
<span id="cb57-1087"><a href="#cb57-1087" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb57-1088"><a href="#cb57-1088" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb57-1089"><a href="#cb57-1089" aria-hidden="true" tabindex="-1"></a>  tigris<span class="sc">::</span><span class="fu">shift_geometry</span>()</span>
<span id="cb57-1090"><a href="#cb57-1090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1091"><a href="#cb57-1091" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb57-1092"><a href="#cb57-1092" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb57-1093"><a href="#cb57-1093" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ne_states_to_plot_colors_alphabetic, <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">factor</span>(coastal_colors)),</span>
<span id="cb57-1094"><a href="#cb57-1094" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="fl">0.05</span>, <span class="at">color =</span> <span class="st">"grey70"</span></span>
<span id="cb57-1095"><a href="#cb57-1095" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-1096"><a href="#cb57-1096" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb57-1097"><a href="#cb57-1097" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> clrs[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">7</span>, <span class="dv">8</span>)], <span class="at">na.value =</span> <span class="st">"grey95"</span>, <span class="at">guide =</span> <span class="st">"none"</span></span>
<span id="cb57-1098"><a href="#cb57-1098" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-1099"><a href="#cb57-1099" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"US states with a coastline"</span>) <span class="sc">+</span></span>
<span id="cb57-1100"><a href="#cb57-1100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>()</span>
<span id="cb57-1101"><a href="#cb57-1101" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-1102"><a href="#cb57-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1103"><a href="#cb57-1103" aria-hidden="true" tabindex="-1"></a>There are ways to color *all* US states with <span class="co">[</span><span class="ot">four</span><span class="co">](https://en.wikipedia.org/wiki/Four_color_theorem)</span> or <span class="co">[</span><span class="ot">five</span><span class="co">](https://en.wikipedia.org/wiki/Five_color_theorem)</span> unique colors, but we don't really want to do that here because we're ignoring all the non-coastal states and want a balanced set of colors.</span>
<span id="cb57-1104"><a href="#cb57-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1105"><a href="#cb57-1105" aria-hidden="true" tabindex="-1"></a>So we can use a neat approach where we pretend this map is a circle. We'll start with some state and assign it color 1. We'll then move along the exterior of the circle clockwise and assign the next state to color 2, then the next state color 3, and so on until we loop all the way around the circle back to the first state. That *should* give us noncontiguous colors around the whole border. </span>
<span id="cb57-1106"><a href="#cb57-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1107"><a href="#cb57-1107" aria-hidden="true" tabindex="-1"></a>We'll omit Alaska and Hawaiʻi for this part, since we can assign them any arbitrary colors later. We'll first find the center of each state, then find the northernmost state as the starting point, and then calculate the angle of every other state in relation to the starting state. We can then sort the data by the angle and assign the colors 1–5 in order.</span>
<span id="cb57-1108"><a href="#cb57-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1111"><a href="#cb57-1111" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-1112"><a href="#cb57-1112" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-coastal-state-angles</span></span>
<span id="cb57-1113"><a href="#cb57-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1114"><a href="#cb57-1114" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the center of each coastal state in the lower 48</span></span>
<span id="cb57-1115"><a href="#cb57-1115" aria-hidden="true" tabindex="-1"></a>coastal_states_centers <span class="ot">&lt;-</span> ne_states <span class="sc">|&gt;</span> </span>
<span id="cb57-1116"><a href="#cb57-1116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">%in%</span> ne_coastline<span class="sc">$</span>name) <span class="sc">|&gt;</span> </span>
<span id="cb57-1117"><a href="#cb57-1117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Alaska"</span>, <span class="st">"Hawaii"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb57-1118"><a href="#cb57-1118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">centroid =</span> <span class="fu">st_centroid</span>(geometry)) <span class="sc">|&gt;</span> </span>
<span id="cb57-1119"><a href="#cb57-1119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">centroid_coords =</span> <span class="fu">st_coordinates</span>(centroid)) <span class="sc">|&gt;</span></span>
<span id="cb57-1120"><a href="#cb57-1120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-1121"><a href="#cb57-1121" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> centroid_coords[, <span class="st">"X"</span>],</span>
<span id="cb57-1122"><a href="#cb57-1122" aria-hidden="true" tabindex="-1"></a>    <span class="at">latitude =</span> centroid_coords[, <span class="st">"Y"</span>]</span>
<span id="cb57-1123"><a href="#cb57-1123" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb57-1124"><a href="#cb57-1124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>centroid_coords)</span>
<span id="cb57-1125"><a href="#cb57-1125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1126"><a href="#cb57-1126" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the northernmost state (Washington) to use as a reference point</span></span>
<span id="cb57-1127"><a href="#cb57-1127" aria-hidden="true" tabindex="-1"></a>northest_state <span class="ot">&lt;-</span> coastal_states_centers <span class="sc">|&gt;</span> <span class="fu">slice_max</span>(<span class="at">order_by =</span> latitude)</span>
<span id="cb57-1128"><a href="#cb57-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1129"><a href="#cb57-1129" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the angle from the northernmost state to the center of all other</span></span>
<span id="cb57-1130"><a href="#cb57-1130" aria-hidden="true" tabindex="-1"></a><span class="co"># states, then arrange by angle so that the states are all sorted clockwise</span></span>
<span id="cb57-1131"><a href="#cb57-1131" aria-hidden="true" tabindex="-1"></a>coastal_states_angles <span class="ot">&lt;-</span> coastal_states_centers <span class="sc">|&gt;</span> </span>
<span id="cb57-1132"><a href="#cb57-1132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-1133"><a href="#cb57-1133" aria-hidden="true" tabindex="-1"></a>    <span class="at">angle_rad =</span> <span class="fu">atan2</span>(</span>
<span id="cb57-1134"><a href="#cb57-1134" aria-hidden="true" tabindex="-1"></a>      longitude <span class="sc">-</span> northest_state<span class="sc">$</span>longitude, </span>
<span id="cb57-1135"><a href="#cb57-1135" aria-hidden="true" tabindex="-1"></a>      latitude <span class="sc">-</span> northest_state<span class="sc">$</span>latitude</span>
<span id="cb57-1136"><a href="#cb57-1136" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb57-1137"><a href="#cb57-1137" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Not really necessary, but I can't think in radians</span></span>
<span id="cb57-1138"><a href="#cb57-1138" aria-hidden="true" tabindex="-1"></a>    <span class="at">angle_deg =</span> angle_rad <span class="sc">*</span> (<span class="dv">180</span> <span class="sc">/</span> pi)</span>
<span id="cb57-1139"><a href="#cb57-1139" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb57-1140"><a href="#cb57-1140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(angle_rad) <span class="sc">|&gt;</span> </span>
<span id="cb57-1141"><a href="#cb57-1141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color_group =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">length.out =</span> <span class="fu">n</span>()))</span>
<span id="cb57-1142"><a href="#cb57-1142" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-1143"><a href="#cb57-1143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1144"><a href="#cb57-1144" aria-hidden="true" tabindex="-1"></a>This is really cool. California and Oregon are both directly south of Washington, so they are at a nearly −180° (or −1π rad) angle from that state. The circle then jumps over to New England (since Maine is at a 90° or π/2 rad angle from Washington) before coming back to the Midwest, then looping down along the east and south coasts, ending with Texas.</span>
<span id="cb57-1145"><a href="#cb57-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1148"><a href="#cb57-1148" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-1149"><a href="#cb57-1149" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: show-coastal-state-angles</span></span>
<span id="cb57-1150"><a href="#cb57-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1151"><a href="#cb57-1151" aria-hidden="true" tabindex="-1"></a>coastal_states_angles <span class="sc">|&gt;</span> </span>
<span id="cb57-1152"><a href="#cb57-1152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb57-1153"><a href="#cb57-1153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, angle_rad, angle_deg, color_group)</span>
<span id="cb57-1154"><a href="#cb57-1154" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-1155"><a href="#cb57-1155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1156"><a href="#cb57-1156" aria-hidden="true" tabindex="-1"></a>Now that we have better color assignments, we can make a nicer map with unique colors for each state:</span>
<span id="cb57-1157"><a href="#cb57-1157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1160"><a href="#cb57-1160" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-1161"><a href="#cb57-1161" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-coastal-states-5-but-good</span></span>
<span id="cb57-1162"><a href="#cb57-1162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1163"><a href="#cb57-1163" aria-hidden="true" tabindex="-1"></a>coastal_state_colors <span class="ot">&lt;-</span> coastal_states_angles <span class="sc">|&gt;</span> </span>
<span id="cb57-1164"><a href="#cb57-1164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span>  <span class="co"># No need for geography stuff </span></span>
<span id="cb57-1165"><a href="#cb57-1165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, color_group) <span class="sc">|&gt;</span> </span>
<span id="cb57-1166"><a href="#cb57-1166" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add Alaska and Hawaii back; the last color assigned was 4, so continue with 5</span></span>
<span id="cb57-1167"><a href="#cb57-1167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">name =</span> <span class="st">"Alaska"</span>, <span class="at">color_group =</span> <span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-1168"><a href="#cb57-1168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">name =</span> <span class="st">"Hawaii"</span>, <span class="at">color_group =</span> <span class="dv">1</span>)</span>
<span id="cb57-1169"><a href="#cb57-1169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1170"><a href="#cb57-1170" aria-hidden="true" tabindex="-1"></a>ne_states_to_plot_colors <span class="ot">&lt;-</span> ne_states <span class="sc">|&gt;</span> </span>
<span id="cb57-1171"><a href="#cb57-1171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(coastal_state_colors, <span class="at">by =</span> <span class="fu">join_by</span>(name)) <span class="sc">|&gt;</span> </span>
<span id="cb57-1172"><a href="#cb57-1172" aria-hidden="true" tabindex="-1"></a>  tigris<span class="sc">::</span><span class="fu">shift_geometry</span>()</span>
<span id="cb57-1173"><a href="#cb57-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1174"><a href="#cb57-1174" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb57-1175"><a href="#cb57-1175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb57-1176"><a href="#cb57-1176" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ne_states_to_plot_colors, <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">factor</span>(color_group)),</span>
<span id="cb57-1177"><a href="#cb57-1177" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="fl">0.05</span>, <span class="at">color =</span> <span class="st">"grey70"</span></span>
<span id="cb57-1178"><a href="#cb57-1178" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-1179"><a href="#cb57-1179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb57-1180"><a href="#cb57-1180" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> clrs[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">7</span>, <span class="dv">8</span>)], <span class="at">na.value =</span> <span class="st">"grey95"</span>, <span class="at">guide =</span> <span class="st">"none"</span></span>
<span id="cb57-1181"><a href="#cb57-1181" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-1182"><a href="#cb57-1182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"US states with a coastline"</span>) <span class="sc">+</span></span>
<span id="cb57-1183"><a href="#cb57-1183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>()</span>
<span id="cb57-1184"><a href="#cb57-1184" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-1185"><a href="#cb57-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1186"><a href="#cb57-1186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1187"><a href="#cb57-1187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1188"><a href="#cb57-1188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1189"><a href="#cb57-1189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1190"><a href="#cb57-1190" aria-hidden="true" tabindex="-1"></a><span class="fu"># The Coastline Paradox and map resolutions</span></span>
<span id="cb57-1191"><a href="#cb57-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1192"><a href="#cb57-1192" aria-hidden="true" tabindex="-1"></a>Calculating these coastline lengths has been a tricky (but fun!) journey so far, involving all sorts of GIS shenanigans to extract borders from overlapping shapefiles. So far we've really only dealt with technical challenges, like finding the right kinds of shapefiles.</span>
<span id="cb57-1193"><a href="#cb57-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1194"><a href="#cb57-1194" aria-hidden="true" tabindex="-1"></a>But in the course of writing this post and figuring all of this out, I stumbled on a deeper, more philosophical challenge: <span class="co">[</span><span class="ot">the Coastline Paradox</span><span class="co">](https://en.wikipedia.org/wiki/Coastline_paradox)</span>. Weirdly, **coastlines don't have well-defined lengths**. The measured length of a coastline depends on how detailed the map is, and **more detail isn't actually better**.</span>
<span id="cb57-1195"><a href="#cb57-1195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1196"><a href="#cb57-1196" aria-hidden="true" tabindex="-1"></a><span class="fu">## Hypothetical coastline at different resolutions</span></span>
<span id="cb57-1197"><a href="#cb57-1197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1198"><a href="#cb57-1198" aria-hidden="true" tabindex="-1"></a>To illustrate this, let's invent a fake coastline with lots of jagged edges. If we take a boat a few miles offshore and sail from one end to the other in a straight line, it's 500 miles long. If we walk from one end to the other and walk as close as possible to the water, however, it's 14,000 miles long. That's a huge discrepancy.</span>
<span id="cb57-1199"><a href="#cb57-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1202"><a href="#cb57-1202" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-1203"><a href="#cb57-1203" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-fake-coastline</span></span>
<span id="cb57-1204"><a href="#cb57-1204" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb57-1205"><a href="#cb57-1205" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4.25</span></span>
<span id="cb57-1206"><a href="#cb57-1206" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb57-1207"><a href="#cb57-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1208"><a href="#cb57-1208" aria-hidden="true" tabindex="-1"></a>withr<span class="sc">::</span><span class="fu">with_seed</span>(<span class="dv">12345</span>, {</span>
<span id="cb57-1209"><a href="#cb57-1209" aria-hidden="true" tabindex="-1"></a>  example_coastline <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb57-1210"><a href="#cb57-1210" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="at">length.out =</span> <span class="dv">500</span>), </span>
<span id="cb57-1211"><a href="#cb57-1211" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">500</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.5</span>)</span>
<span id="cb57-1212"><a href="#cb57-1212" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb57-1213"><a href="#cb57-1213" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.matrix</span>() <span class="sc">|&gt;</span> </span>
<span id="cb57-1214"><a href="#cb57-1214" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_linestring</span>()</span>
<span id="cb57-1215"><a href="#cb57-1215" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb57-1216"><a href="#cb57-1216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1217"><a href="#cb57-1217" aria-hidden="true" tabindex="-1"></a>total_distance <span class="ot">&lt;-</span> example_coastline <span class="sc">|&gt;</span> <span class="fu">st_length</span>() <span class="sc">*</span> <span class="dv">50</span></span>
<span id="cb57-1218"><a href="#cb57-1218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1219"><a href="#cb57-1219" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb57-1220"><a href="#cb57-1220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> example_coastline, <span class="at">linewidth =</span> <span class="fl">0.35</span>, <span class="at">color =</span> <span class="st">"grey60"</span>) <span class="sc">+</span></span>
<span id="cb57-1221"><a href="#cb57-1221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"errorbar"</span>, <span class="at">xmin =</span> <span class="dv">0</span>, <span class="at">xmax =</span> <span class="dv">10</span>, <span class="at">y =</span> <span class="fl">2.3</span>) <span class="sc">+</span></span>
<span id="cb57-1222"><a href="#cb57-1222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb57-1223"><a href="#cb57-1223" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">5</span>, <span class="at">y =</span> <span class="fl">2.6</span>, </span>
<span id="cb57-1224"><a href="#cb57-1224" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"500 miles"</span>, </span>
<span id="cb57-1225"><a href="#cb57-1225" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"Overpass ExtraBold"</span></span>
<span id="cb57-1226"><a href="#cb57-1226" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-1227"><a href="#cb57-1227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb57-1228"><a href="#cb57-1228" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">5</span>, <span class="at">y =</span> <span class="dv">2</span>, </span>
<span id="cb57-1229"><a href="#cb57-1229" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Straight distance"</span></span>
<span id="cb57-1230"><a href="#cb57-1230" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-1231"><a href="#cb57-1231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"errorbar"</span>, <span class="at">xmin =</span> <span class="dv">0</span>, <span class="at">xmax =</span> <span class="dv">10</span>, <span class="at">y =</span> <span class="sc">-</span><span class="fl">2.3</span>) <span class="sc">+</span></span>
<span id="cb57-1232"><a href="#cb57-1232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb57-1233"><a href="#cb57-1233" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">5</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">2</span>, </span>
<span id="cb57-1234"><a href="#cb57-1234" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">paste0</span>(scales<span class="sc">::</span><span class="fu">label_comma</span>()(total_distance), <span class="st">" miles"</span>), </span>
<span id="cb57-1235"><a href="#cb57-1235" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"Overpass ExtraBold"</span></span>
<span id="cb57-1236"><a href="#cb57-1236" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-1237"><a href="#cb57-1237" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb57-1238"><a href="#cb57-1238" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">5</span>, <span class="at">y =</span> <span class="sc">-</span><span class="fl">2.6</span>, </span>
<span id="cb57-1239"><a href="#cb57-1239" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Total distance following complete path"</span></span>
<span id="cb57-1240"><a href="#cb57-1240" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-1241"><a href="#cb57-1241" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>()</span>
<span id="cb57-1242"><a href="#cb57-1242" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-1243"><a href="#cb57-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1244"><a href="#cb57-1244" aria-hidden="true" tabindex="-1"></a>14,000 miles feels excessive, and no map includes that much detail. Maps have different resolutions that define how much detail is included, scaling 10 kilomters in real life to 1 centimeter in the map, or 500 km to 1 cm, or 110 km to 1 cm, and so on. We need to adjust the resolution of our fictional coastline and simplify and smooth out the line. </span>
<span id="cb57-1245"><a href="#cb57-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1246"><a href="#cb57-1246" aria-hidden="true" tabindex="-1"></a>However, the border length changes dramatically the more we simplify:</span>
<span id="cb57-1247"><a href="#cb57-1247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1250"><a href="#cb57-1250" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-1251"><a href="#cb57-1251" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-fake-coastline-different-resolution</span></span>
<span id="cb57-1252"><a href="#cb57-1252" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 9</span></span>
<span id="cb57-1253"><a href="#cb57-1253" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 3</span></span>
<span id="cb57-1254"><a href="#cb57-1254" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb57-1255"><a href="#cb57-1255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1256"><a href="#cb57-1256" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(smoothr)</span>
<span id="cb57-1257"><a href="#cb57-1257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1258"><a href="#cb57-1258" aria-hidden="true" tabindex="-1"></a>example_coastlines <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb57-1259"><a href="#cb57-1259" aria-hidden="true" tabindex="-1"></a>  <span class="at">tolerance =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">1.3</span>, <span class="dv">5</span>)</span>
<span id="cb57-1260"><a href="#cb57-1260" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb57-1261"><a href="#cb57-1261" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">full_coast =</span> <span class="fu">list</span>(example_coastline)) <span class="sc">|&gt;</span> </span>
<span id="cb57-1262"><a href="#cb57-1262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">simplified_coast =</span> <span class="fu">map2</span>(</span>
<span id="cb57-1263"><a href="#cb57-1263" aria-hidden="true" tabindex="-1"></a>    full_coast, tolerance, <span class="sc">~</span><span class="fu">st_simplify</span>(.x, <span class="at">dTolerance =</span> .y)</span>
<span id="cb57-1264"><a href="#cb57-1264" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb57-1265"><a href="#cb57-1265" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">simplified_coast =</span> <span class="fu">map</span>(simplified_coast, <span class="sc">~</span><span class="fu">smooth</span>(.x, <span class="at">method =</span> <span class="st">"ksmooth"</span>, <span class="at">smoothness =</span> <span class="fl">0.6</span>))) <span class="sc">|&gt;</span></span>
<span id="cb57-1266"><a href="#cb57-1266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">simplified_coast =</span> <span class="fu">st_sfc</span>(simplified_coast)) <span class="sc">|&gt;</span> </span>
<span id="cb57-1267"><a href="#cb57-1267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">distance =</span> <span class="fu">st_length</span>(simplified_coast) <span class="sc">*</span> <span class="dv">50</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-1268"><a href="#cb57-1268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">plot =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(distance, full_coast, simplified_coast), <span class="sc">~</span>{</span>
<span id="cb57-1269"><a href="#cb57-1269" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb57-1270"><a href="#cb57-1270" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> ..<span class="dv">2</span>, <span class="at">linewidth =</span> <span class="fl">0.15</span>, <span class="at">color =</span> <span class="st">"grey70"</span>) <span class="sc">+</span></span>
<span id="cb57-1271"><a href="#cb57-1271" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> ..<span class="dv">3</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>, <span class="at">color =</span> clrs[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb57-1272"><a href="#cb57-1272" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste0</span>(scales<span class="sc">::</span><span class="fu">label_comma</span>()(..<span class="dv">1</span>), <span class="st">" miles"</span>)) <span class="sc">+</span></span>
<span id="cb57-1273"><a href="#cb57-1273" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_map</span>()</span>
<span id="cb57-1274"><a href="#cb57-1274" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb57-1275"><a href="#cb57-1275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1276"><a href="#cb57-1276" aria-hidden="true" tabindex="-1"></a><span class="fu">wrap_plots</span>(example_coastlines<span class="sc">$</span>plot, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb57-1277"><a href="#cb57-1277" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-1278"><a href="#cb57-1278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1279"><a href="#cb57-1279" aria-hidden="true" tabindex="-1"></a>So which one of those is right? How long is the actual coastline? Is it 14,000 miles? 5,000 miles? 2,500 miles? 1,000 miles? 500 miles? There's no right answer.</span>
<span id="cb57-1280"><a href="#cb57-1280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1281"><a href="#cb57-1281" aria-hidden="true" tabindex="-1"></a>The length shrinks as we decrease the resolution, and the length grows as we increase the resolution. Coastlines behave almost like <span class="co">[</span><span class="ot">fractals</span><span class="co">](https://en.wikipedia.org/wiki/Fractal)</span>—as you zoom in more and more and more, the length can increase almost infinitely.^<span class="co">[</span><span class="ot">Not *actually* infinitely, since there is a finite amount of land, but still.</span><span class="co">]</span> Imagine that we want to be hyper precise when measuring the coastline and we include any boulders or trees or driftwood poking into the water from the shore. Then imagine that we include all the little bumps and imperfections in the boulders and all the edges of the shattered wood in the broken logs. The coastline will become *enormously* long.</span>
<span id="cb57-1282"><a href="#cb57-1282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1283"><a href="#cb57-1283" aria-hidden="true" tabindex="-1"></a><span class="fu">## Dubai and artificial coastlines</span></span>
<span id="cb57-1284"><a href="#cb57-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1285"><a href="#cb57-1285" aria-hidden="true" tabindex="-1"></a>This isn't just hypothetical. In the early 2000s, in an effort to increase the coastline available for construction, Dubai started building a <span class="co">[</span><span class="ot">series of artificial islands in the shape of palm trees</span><span class="co">](https://en.wikipedia.org/wiki/Palm_Islands)</span>, and <span class="co">[</span><span class="ot">one in the shape of the world</span><span class="co">]</span>(https://en.wikipedia.org/wiki/The_World_(archipelago)).</span>
<span id="cb57-1286"><a href="#cb57-1286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1287"><a href="#cb57-1287" aria-hidden="true" tabindex="-1"></a>!<span class="co">[</span><span class="ot">Island developments in Dubai in 2010, [by Wikipedia user Lencer](https://commons.wikimedia.org/w/index.php?curid=38517839)</span><span class="co">](img/Dubai_new_developments.png)</span>{width=90%}</span>
<span id="cb57-1288"><a href="#cb57-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1289"><a href="#cb57-1289" aria-hidden="true" tabindex="-1"></a>How do we count how much coastline Dubai added with these islands? Do we only count the outer circles of Palm Jumeirah, Palm Deira, and Palm Jebel Ali? The island designers cut canals through those outer circles for boat access—do we count the border for each of those segments? If so, it more than doubles the coastline. Do we count the palm fronds within each of the circles? We probably should! That then adds another huge chunk of coastline. What if the island designers added hundreds of little bays into each of the fronds, creating the illusion of separate leaves? That would exponentially increase the coastline length. Each of those tiny islands in The World archipelago should probably get added to the coastline too.</span>
<span id="cb57-1290"><a href="#cb57-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1291"><a href="#cb57-1291" aria-hidden="true" tabindex="-1"></a>At the extreme, Dubai could build a single actual fractal-shaped island and become a mathematical island—there would be so much coastline that the proportion of coastline to land borders would basically be 100%.</span>
<span id="cb57-1292"><a href="#cb57-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1293"><a href="#cb57-1293" aria-hidden="true" tabindex="-1"></a><span class="fu"># Use lower resolution Natural Earth coastlines</span></span>
<span id="cb57-1294"><a href="#cb57-1294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1295"><a href="#cb57-1295" aria-hidden="true" tabindex="-1"></a>Earlier, we used high resolution (1:10 million) data from Natural Earth to calculate the proportion of coastline for each state. But this might have been too ambitious. We found that 95% of Alaska's borders touch the ocean, despite its huge land border with Canada. Because the map data had such high resolution, we picked up lots of details in each of the <span class="co">[</span><span class="ot">Aleutian Islands</span><span class="co">](https://en.wikipedia.org/wiki/Aleutian_Islands)</span>, as well as every little inlet and bay on the mainland.</span>
<span id="cb57-1296"><a href="#cb57-1296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1297"><a href="#cb57-1297" aria-hidden="true" tabindex="-1"></a>What happens if we use low resolution data instead, like Natural Earth's 1:110 million maps? How much does that influence the rankings of the proportion of coastline?</span>
<span id="cb57-1298"><a href="#cb57-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1299"><a href="#cb57-1299" aria-hidden="true" tabindex="-1"></a>Let's grab the 1:110 million data from Natural Earth and try it out. </span>
<span id="cb57-1300"><a href="#cb57-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1301"><a href="#cb57-1301" aria-hidden="true" tabindex="-1"></a>**But first, a warning.** We won't be able to get exact answers with this data. The key to extracting coastlines from states earlier was to use data for all of North America. Natural Earth provided state/province-level data for the United States, Mexico, and Canada, and we merged all those administrative units into one big giant landmass, which guaranteed that the individual Natural Earth state shapes matched the overall landmass perfectly. This won't work with other Natural Earth resolutions. At 1:50 million, Natural Earth does not include Mexican states; at 1:110 million, Natural Earth *only* includes the United States. We can't make a consistent unified North American landmass at these resolutions. We can get close—we can get country-level data at 1:110 million and create a merged North American shape, but it won't match the state borders exactly. </span>
<span id="cb57-1302"><a href="#cb57-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1303"><a href="#cb57-1303" aria-hidden="true" tabindex="-1"></a>Nevertheless, we'll try.</span>
<span id="cb57-1304"><a href="#cb57-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1307"><a href="#cb57-1307" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-1308"><a href="#cb57-1308" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: get-ne-110</span></span>
<span id="cb57-1309"><a href="#cb57-1309" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hide</span></span>
<span id="cb57-1310"><a href="#cb57-1310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1311"><a href="#cb57-1311" aria-hidden="true" tabindex="-1"></a><span class="co"># Country-level data</span></span>
<span id="cb57-1312"><a href="#cb57-1312" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">"ne_data/ne_110m_admin_0_countries_lakes.shp"</span>)) {</span>
<span id="cb57-1313"><a href="#cb57-1313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ne_download</span>(</span>
<span id="cb57-1314"><a href="#cb57-1314" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"admin_0_countries_lakes"</span>, </span>
<span id="cb57-1315"><a href="#cb57-1315" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale =</span> <span class="dv">110</span>,</span>
<span id="cb57-1316"><a href="#cb57-1316" aria-hidden="true" tabindex="-1"></a>    <span class="at">destdir =</span> <span class="st">"ne_data"</span>,</span>
<span id="cb57-1317"><a href="#cb57-1317" aria-hidden="true" tabindex="-1"></a>    <span class="at">load =</span> <span class="cn">FALSE</span></span>
<span id="cb57-1318"><a href="#cb57-1318" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-1319"><a href="#cb57-1319" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-1320"><a href="#cb57-1320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1321"><a href="#cb57-1321" aria-hidden="true" tabindex="-1"></a>world_110 <span class="ot">&lt;-</span> <span class="fu">ne_load</span>(</span>
<span id="cb57-1322"><a href="#cb57-1322" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"admin_0_countries_lakes"</span>, </span>
<span id="cb57-1323"><a href="#cb57-1323" aria-hidden="true" tabindex="-1"></a>  <span class="at">scale =</span> <span class="dv">110</span>,</span>
<span id="cb57-1324"><a href="#cb57-1324" aria-hidden="true" tabindex="-1"></a>  <span class="at">destdir =</span> <span class="st">"ne_data"</span></span>
<span id="cb57-1325"><a href="#cb57-1325" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-1326"><a href="#cb57-1326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1327"><a href="#cb57-1327" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a unified North America shape</span></span>
<span id="cb57-1328"><a href="#cb57-1328" aria-hidden="true" tabindex="-1"></a>na_giant_110 <span class="ot">&lt;-</span> world_110 <span class="sc">|&gt;</span> </span>
<span id="cb57-1329"><a href="#cb57-1329" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"United States of America"</span>, <span class="st">"Canada"</span>, <span class="st">"Mexico"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb57-1330"><a href="#cb57-1330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"ESRI:102003"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb57-1331"><a href="#cb57-1331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_union</span>()</span>
<span id="cb57-1332"><a href="#cb57-1332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1333"><a href="#cb57-1333" aria-hidden="true" tabindex="-1"></a><span class="co"># State-level data</span></span>
<span id="cb57-1334"><a href="#cb57-1334" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">"ne_data/ne_110m_admin_1_states_provinces_lakes.shp"</span>)) {</span>
<span id="cb57-1335"><a href="#cb57-1335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ne_download</span>(</span>
<span id="cb57-1336"><a href="#cb57-1336" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"admin_1_states_provinces_lakes"</span>, </span>
<span id="cb57-1337"><a href="#cb57-1337" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale =</span> <span class="dv">110</span>,</span>
<span id="cb57-1338"><a href="#cb57-1338" aria-hidden="true" tabindex="-1"></a>    <span class="at">destdir =</span> <span class="st">"ne_data"</span>,</span>
<span id="cb57-1339"><a href="#cb57-1339" aria-hidden="true" tabindex="-1"></a>    <span class="at">load =</span> <span class="cn">FALSE</span></span>
<span id="cb57-1340"><a href="#cb57-1340" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-1341"><a href="#cb57-1341" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-1342"><a href="#cb57-1342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1343"><a href="#cb57-1343" aria-hidden="true" tabindex="-1"></a>states_110 <span class="ot">&lt;-</span> <span class="fu">ne_load</span>(</span>
<span id="cb57-1344"><a href="#cb57-1344" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"admin_1_states_provinces_lakes"</span>, </span>
<span id="cb57-1345"><a href="#cb57-1345" aria-hidden="true" tabindex="-1"></a>  <span class="at">scale =</span> <span class="dv">110</span>,</span>
<span id="cb57-1346"><a href="#cb57-1346" aria-hidden="true" tabindex="-1"></a>  <span class="at">destdir =</span> <span class="st">"ne_data"</span></span>
<span id="cb57-1347"><a href="#cb57-1347" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb57-1348"><a href="#cb57-1348" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(admin <span class="sc">==</span> <span class="st">"United States of America"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-1349"><a href="#cb57-1349" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"ESRI:102003"</span>))</span>
<span id="cb57-1350"><a href="#cb57-1350" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-1351"><a href="#cb57-1351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1354"><a href="#cb57-1354" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-1355"><a href="#cb57-1355" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-na-ne-different-resolutions</span></span>
<span id="cb57-1356"><a href="#cb57-1356" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb57-1357"><a href="#cb57-1357" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 3.5</span></span>
<span id="cb57-1358"><a href="#cb57-1358" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: page</span></span>
<span id="cb57-1359"><a href="#cb57-1359" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: "100%"</span></span>
<span id="cb57-1360"><a href="#cb57-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1361"><a href="#cb57-1361" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename these for consistency with the 110 versions</span></span>
<span id="cb57-1362"><a href="#cb57-1362" aria-hidden="true" tabindex="-1"></a>states_10 <span class="ot">&lt;-</span> ne_states</span>
<span id="cb57-1363"><a href="#cb57-1363" aria-hidden="true" tabindex="-1"></a>na_giant_10 <span class="ot">&lt;-</span> na_giant</span>
<span id="cb57-1364"><a href="#cb57-1364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1365"><a href="#cb57-1365" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb57-1366"><a href="#cb57-1366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> na_giant_10, <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">fill =</span> clrs[<span class="dv">10</span>]) <span class="sc">+</span></span>
<span id="cb57-1367"><a href="#cb57-1367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> states_10, <span class="at">linewidth =</span> <span class="fl">0.05</span>, <span class="at">fill =</span> clrs[<span class="dv">8</span>], <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb57-1368"><a href="#cb57-1368" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"High resolution"</span>, <span class="at">subtitle =</span> <span class="st">"1:10 million"</span>) <span class="sc">+</span></span>
<span id="cb57-1369"><a href="#cb57-1369" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>() <span class="sc">+</span></span>
<span id="cb57-1370"><a href="#cb57-1370" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb57-1371"><a href="#cb57-1371" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> clr_ocean), </span>
<span id="cb57-1372"><a href="#cb57-1372" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="fl">6.5</span><span class="sc">/</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="fl">6.5</span>, <span class="dv">0</span>))</span>
<span id="cb57-1373"><a href="#cb57-1373" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-1374"><a href="#cb57-1374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1375"><a href="#cb57-1375" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb57-1376"><a href="#cb57-1376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> na_giant_110, <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">fill =</span> clrs[<span class="dv">10</span>]) <span class="sc">+</span></span>
<span id="cb57-1377"><a href="#cb57-1377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> states_110, <span class="at">linewidth =</span> <span class="fl">0.05</span>, <span class="at">fill =</span> clrs[<span class="dv">8</span>], <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb57-1378"><a href="#cb57-1378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Low resolution"</span>, <span class="at">subtitle =</span> <span class="st">"1:110 million"</span>) <span class="sc">+</span></span>
<span id="cb57-1379"><a href="#cb57-1379" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>() <span class="sc">+</span></span>
<span id="cb57-1380"><a href="#cb57-1380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb57-1381"><a href="#cb57-1381" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> clr_ocean), </span>
<span id="cb57-1382"><a href="#cb57-1382" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="fl">6.5</span><span class="sc">/</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="fl">6.5</span>, <span class="dv">0</span>))</span>
<span id="cb57-1383"><a href="#cb57-1383" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-1384"><a href="#cb57-1384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1385"><a href="#cb57-1385" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">|</span> p2</span>
<span id="cb57-1386"><a href="#cb57-1386" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-1387"><a href="#cb57-1387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1388"><a href="#cb57-1388" aria-hidden="true" tabindex="-1"></a>We can already see some sizable differences in the detail in the border. The low resolution version drops most of the Aleutian Islands, removes North Carolina's Outer Banks, and greatly simplifies Washington's Puget Sound.</span>
<span id="cb57-1389"><a href="#cb57-1389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1390"><a href="#cb57-1390" aria-hidden="true" tabindex="-1"></a>Let's zoom in on Hawaiʻi for fun. The high resolution version looks great; the low resolution one looks like it was drawn in Minecraft.</span>
<span id="cb57-1391"><a href="#cb57-1391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1394"><a href="#cb57-1394" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-1395"><a href="#cb57-1395" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-hi-ne-different-resolutions</span></span>
<span id="cb57-1396"><a href="#cb57-1396" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb57-1397"><a href="#cb57-1397" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 3.5</span></span>
<span id="cb57-1398"><a href="#cb57-1398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1399"><a href="#cb57-1399" aria-hidden="true" tabindex="-1"></a>hi_110 <span class="ot">&lt;-</span> states_110 <span class="sc">|&gt;</span> <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">"Hawaii"</span>)</span>
<span id="cb57-1400"><a href="#cb57-1400" aria-hidden="true" tabindex="-1"></a>hi_10 <span class="ot">&lt;-</span> states_10 <span class="sc">|&gt;</span> <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">"Hawaii"</span>)</span>
<span id="cb57-1401"><a href="#cb57-1401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1402"><a href="#cb57-1402" aria-hidden="true" tabindex="-1"></a>bbox_hi_110 <span class="ot">&lt;-</span> hi_110 <span class="sc">|&gt;</span> <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)) <span class="sc">|&gt;</span> <span class="fu">st_bbox</span>()</span>
<span id="cb57-1403"><a href="#cb57-1403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1404"><a href="#cb57-1404" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb57-1405"><a href="#cb57-1405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> hi_10, <span class="at">linewidth =</span> <span class="fl">0.1</span>, <span class="at">fill =</span> clrs[<span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb57-1406"><a href="#cb57-1406" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"High resolution"</span>, <span class="at">subtitle =</span> <span class="st">"1:10 million"</span>) <span class="sc">+</span></span>
<span id="cb57-1407"><a href="#cb57-1407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb57-1408"><a href="#cb57-1408" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> bbox_hi_110[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)],</span>
<span id="cb57-1409"><a href="#cb57-1409" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> bbox_hi_110[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)],</span>
<span id="cb57-1410"><a href="#cb57-1410" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)</span>
<span id="cb57-1411"><a href="#cb57-1411" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-1412"><a href="#cb57-1412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>() <span class="sc">+</span></span>
<span id="cb57-1413"><a href="#cb57-1413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb57-1414"><a href="#cb57-1414" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> clr_ocean), </span>
<span id="cb57-1415"><a href="#cb57-1415" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="fl">6.5</span><span class="sc">/</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="fl">6.5</span>, <span class="dv">0</span>))</span>
<span id="cb57-1416"><a href="#cb57-1416" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-1417"><a href="#cb57-1417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1418"><a href="#cb57-1418" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb57-1419"><a href="#cb57-1419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> hi_110, <span class="at">linewidth =</span> <span class="fl">0.1</span>, <span class="at">fill =</span> clrs[<span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb57-1420"><a href="#cb57-1420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Low resolution"</span>, <span class="at">subtitle =</span> <span class="st">"1:110 million"</span>) <span class="sc">+</span></span>
<span id="cb57-1421"><a href="#cb57-1421" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb57-1422"><a href="#cb57-1422" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> bbox_hi_110[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)],</span>
<span id="cb57-1423"><a href="#cb57-1423" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> bbox_hi_110[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)],</span>
<span id="cb57-1424"><a href="#cb57-1424" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)</span>
<span id="cb57-1425"><a href="#cb57-1425" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb57-1426"><a href="#cb57-1426" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>() <span class="sc">+</span></span>
<span id="cb57-1427"><a href="#cb57-1427" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb57-1428"><a href="#cb57-1428" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> clr_ocean), </span>
<span id="cb57-1429"><a href="#cb57-1429" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="fl">6.5</span><span class="sc">/</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="fl">6.5</span>, <span class="dv">0</span>))</span>
<span id="cb57-1430"><a href="#cb57-1430" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-1431"><a href="#cb57-1431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1432"><a href="#cb57-1432" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">|</span> p2</span>
<span id="cb57-1433"><a href="#cb57-1433" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-1434"><a href="#cb57-1434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1435"><a href="#cb57-1435" aria-hidden="true" tabindex="-1"></a>We can go through the same process as before, extracting the coastal borders from the larger North American shape, then finding the coast-to-border proportion:</span>
<span id="cb57-1436"><a href="#cb57-1436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1439"><a href="#cb57-1439" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-1440"><a href="#cb57-1440" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-hi-prop-ocean-110</span></span>
<span id="cb57-1441"><a href="#cb57-1441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1442"><a href="#cb57-1442" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the Hawaiian borders from the low resolution North America shape</span></span>
<span id="cb57-1443"><a href="#cb57-1443" aria-hidden="true" tabindex="-1"></a>hi_ocean_border_110 <span class="ot">&lt;-</span> hi_110 <span class="sc">|&gt;</span> </span>
<span id="cb57-1444"><a href="#cb57-1444" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="at">dist =</span> <span class="fl">0.001</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-1445"><a href="#cb57-1445" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_difference</span>(na_giant_110)</span>
<span id="cb57-1446"><a href="#cb57-1446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1447"><a href="#cb57-1447" aria-hidden="true" tabindex="-1"></a><span class="co"># State border</span></span>
<span id="cb57-1448"><a href="#cb57-1448" aria-hidden="true" tabindex="-1"></a>hi_border_perimeter_110 <span class="ot">&lt;-</span> hi_110 <span class="sc">|&gt;</span> </span>
<span id="cb57-1449"><a href="#cb57-1449" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_perimeter</span>()</span>
<span id="cb57-1450"><a href="#cb57-1450" aria-hidden="true" tabindex="-1"></a>hi_border_perimeter_110</span>
<span id="cb57-1451"><a href="#cb57-1451" aria-hidden="true" tabindex="-1"></a>units<span class="sc">::</span><span class="fu">set_units</span>(hi_border_perimeter_110, <span class="st">"miles"</span>)</span>
<span id="cb57-1452"><a href="#cb57-1452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1453"><a href="#cb57-1453" aria-hidden="true" tabindex="-1"></a><span class="co"># Coastal border</span></span>
<span id="cb57-1454"><a href="#cb57-1454" aria-hidden="true" tabindex="-1"></a>hi_ocean_border_perimeter_110 <span class="ot">&lt;-</span> hi_ocean_border_110 <span class="sc">|&gt;</span> </span>
<span id="cb57-1455"><a href="#cb57-1455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_perimeter</span>()</span>
<span id="cb57-1456"><a href="#cb57-1456" aria-hidden="true" tabindex="-1"></a>hi_ocean_border_perimeter_110 <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb57-1457"><a href="#cb57-1457" aria-hidden="true" tabindex="-1"></a>units<span class="sc">::</span><span class="fu">set_units</span>(hi_ocean_border_perimeter_110 <span class="sc">/</span> <span class="dv">2</span>, <span class="st">"miles"</span>)</span>
<span id="cb57-1458"><a href="#cb57-1458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1459"><a href="#cb57-1459" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion</span></span>
<span id="cb57-1460"><a href="#cb57-1460" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>((hi_ocean_border_perimeter_110 <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">/</span> hi_border_perimeter_110) <span class="sc">|&gt;</span> </span>
<span id="cb57-1461"><a href="#cb57-1461" aria-hidden="true" tabindex="-1"></a>  scales<span class="sc">::</span><span class="fu">label_percent</span>()()</span>
<span id="cb57-1462"><a href="#cb57-1462" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-1463"><a href="#cb57-1463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1464"><a href="#cb57-1464" aria-hidden="true" tabindex="-1"></a>The simplified borders reduced the coastline by 200+ miles, but we still have the correct proportion.</span>
<span id="cb57-1465"><a href="#cb57-1465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1468"><a href="#cb57-1468" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-1469"><a href="#cb57-1469" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-difference-hi-resolution</span></span>
<span id="cb57-1470"><a href="#cb57-1470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1471"><a href="#cb57-1471" aria-hidden="true" tabindex="-1"></a>units<span class="sc">::</span><span class="fu">set_units</span>(hi_border_perimeter <span class="sc">-</span> hi_border_perimeter_110, <span class="st">"miles"</span>)</span>
<span id="cb57-1472"><a href="#cb57-1472" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-1473"><a href="#cb57-1473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1474"><a href="#cb57-1474" aria-hidden="true" tabindex="-1"></a>We can do the same thing to all the states. But we actually run into serious issues here. The shapefile for the state borders doesn't precisely match the shapefile for the country borders, so the states don't perfectly overlap with the large North American shape. There are small (and some large) gaps in the coastal borders. To try to account for this, we'll add a 100 meter buffer around all the individual state borders (instead of 1 mm like before), but even then, there are some gaps.</span>
<span id="cb57-1475"><a href="#cb57-1475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1478"><a href="#cb57-1478" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-1479"><a href="#cb57-1479" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-all-coastline-110</span></span>
<span id="cb57-1480"><a href="#cb57-1480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1481"><a href="#cb57-1481" aria-hidden="true" tabindex="-1"></a>ne_states_ocean_borders_110 <span class="ot">&lt;-</span> states_110 <span class="sc">|&gt;</span></span>
<span id="cb57-1482"><a href="#cb57-1482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">|&gt;</span> </span>
<span id="cb57-1483"><a href="#cb57-1483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">|&gt;</span> </span>
<span id="cb57-1484"><a href="#cb57-1484" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ocean_only =</span> <span class="fu">map</span>(data, <span class="sc">~</span> {</span>
<span id="cb57-1485"><a href="#cb57-1485" aria-hidden="true" tabindex="-1"></a>    .x <span class="sc">|&gt;</span> </span>
<span id="cb57-1486"><a href="#cb57-1486" aria-hidden="true" tabindex="-1"></a>      <span class="fu">st_buffer</span>(<span class="at">dist =</span> <span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb57-1487"><a href="#cb57-1487" aria-hidden="true" tabindex="-1"></a>      <span class="fu">st_difference</span>(na_giant_110)</span>
<span id="cb57-1488"><a href="#cb57-1488" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb57-1489"><a href="#cb57-1489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1490"><a href="#cb57-1490" aria-hidden="true" tabindex="-1"></a>ne_coastline_110 <span class="ot">&lt;-</span> ne_states_ocean_borders_110 <span class="sc">|&gt;</span> </span>
<span id="cb57-1491"><a href="#cb57-1491" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(ocean_only) <span class="sc">|&gt;</span> </span>
<span id="cb57-1492"><a href="#cb57-1492" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb57-1493"><a href="#cb57-1493" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_geometry</span>(<span class="st">"geometry"</span>)</span>
<span id="cb57-1494"><a href="#cb57-1494" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-1495"><a href="#cb57-1495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1496"><a href="#cb57-1496" aria-hidden="true" tabindex="-1"></a>For instance, here's Washington, which has a big gap in the southwest border:</span>
<span id="cb57-1497"><a href="#cb57-1497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1500"><a href="#cb57-1500" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-1501"><a href="#cb57-1501" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-wa-coastline-110</span></span>
<span id="cb57-1502"><a href="#cb57-1502" aria-hidden="true" tabindex="-1"></a>wa_110 <span class="ot">&lt;-</span> states_110 <span class="sc">|&gt;</span> <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">"Washington"</span>)</span>
<span id="cb57-1503"><a href="#cb57-1503" aria-hidden="true" tabindex="-1"></a>wa_10 <span class="ot">&lt;-</span> states_10 <span class="sc">|&gt;</span> <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">"Washington"</span>)</span>
<span id="cb57-1504"><a href="#cb57-1504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1505"><a href="#cb57-1505" aria-hidden="true" tabindex="-1"></a>bbox_wa_110 <span class="ot">&lt;-</span> wa_110 <span class="sc">|&gt;</span> <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)) <span class="sc">|&gt;</span> <span class="fu">st_bbox</span>()</span>
<span id="cb57-1506"><a href="#cb57-1506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1507"><a href="#cb57-1507" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb57-1508"><a href="#cb57-1508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> na_giant_110, <span class="at">fill =</span> clrs[<span class="dv">10</span>], <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb57-1509"><a href="#cb57-1509" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb57-1510"><a href="#cb57-1510" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(states_110, name <span class="sc">==</span> <span class="st">"Washington"</span>), </span>
<span id="cb57-1511"><a href="#cb57-1511" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="fl">0.1</span>, <span class="at">fill =</span> clrs[<span class="dv">3</span>]</span>
<span id="cb57-1512"><a href="#cb57-1512" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-1513"><a href="#cb57-1513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb57-1514"><a href="#cb57-1514" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(ne_coastline_110, name <span class="sc">==</span> <span class="st">"Washington"</span>), <span class="at">linewidth =</span> <span class="fl">0.8</span>, </span>
<span id="cb57-1515"><a href="#cb57-1515" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"Coastal border extracted from low resolution North America shape"</span>),</span>
<span id="cb57-1516"><a href="#cb57-1516" aria-hidden="true" tabindex="-1"></a>    <span class="at">key_glyph =</span> draw_key_path</span>
<span id="cb57-1517"><a href="#cb57-1517" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-1518"><a href="#cb57-1518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.64</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="fl">0.91</span>), <span class="at">label =</span> <span class="st">"↑ Canada (British Columbia) ↑"</span>) <span class="sc">+</span></span>
<span id="cb57-1519"><a href="#cb57-1519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.54</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="fl">0.18</span>), <span class="at">label =</span> <span class="st">"↓ Oregon ↓"</span>) <span class="sc">+</span></span>
<span id="cb57-1520"><a href="#cb57-1520" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">I</span>(<span class="fl">0.87</span>), <span class="at">y =</span> <span class="fu">I</span>(<span class="fl">0.5</span>), <span class="at">label =</span> <span class="st">"Idaho →"</span>) <span class="sc">+</span></span>
<span id="cb57-1521"><a href="#cb57-1521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clrs[<span class="dv">8</span>])) <span class="sc">+</span></span>
<span id="cb57-1522"><a href="#cb57-1522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Low resolution Washington coastline"</span>, <span class="at">color =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb57-1523"><a href="#cb57-1523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb57-1524"><a href="#cb57-1524" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> bbox_wa_110[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)],</span>
<span id="cb57-1525"><a href="#cb57-1525" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> bbox_wa_110[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)],</span>
<span id="cb57-1526"><a href="#cb57-1526" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)</span>
<span id="cb57-1527"><a href="#cb57-1527" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb57-1528"><a href="#cb57-1528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_map</span>() <span class="sc">+</span></span>
<span id="cb57-1529"><a href="#cb57-1529" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb57-1530"><a href="#cb57-1530" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> clr_ocean),</span>
<span id="cb57-1531"><a href="#cb57-1531" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="fl">6.5</span>, <span class="dv">0</span>, <span class="fl">6.5</span>, <span class="dv">0</span>)),</span>
<span id="cb57-1532"><a href="#cb57-1532" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">"lines"</span>),</span>
<span id="cb57-1533"><a href="#cb57-1533" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb57-1534"><a href="#cb57-1534" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span></span>
<span id="cb57-1535"><a href="#cb57-1535" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-1536"><a href="#cb57-1536" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-1537"><a href="#cb57-1537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1538"><a href="#cb57-1538" aria-hidden="true" tabindex="-1"></a>If Natural Earth had 1:110 million-resolution data for US states, Mexican states, and Canadian provinces, all would be well. Alas.</span>
<span id="cb57-1539"><a href="#cb57-1539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1540"><a href="#cb57-1540" aria-hidden="true" tabindex="-1"></a>So with the caveat that there are sizable gaps in the coastal borders, let's look at the proportions: </span>
<span id="cb57-1541"><a href="#cb57-1541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1544"><a href="#cb57-1544" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-1545"><a href="#cb57-1545" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calc-all-prop-ocean-110</span></span>
<span id="cb57-1546"><a href="#cb57-1546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1547"><a href="#cb57-1547" aria-hidden="true" tabindex="-1"></a><span class="co"># Find all low-resolution state perimeters</span></span>
<span id="cb57-1548"><a href="#cb57-1548" aria-hidden="true" tabindex="-1"></a>ne_state_border_lengths_110 <span class="ot">&lt;-</span> states_110 <span class="sc">|&gt;</span> </span>
<span id="cb57-1549"><a href="#cb57-1549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">border_length =</span> <span class="fu">st_perimeter</span>(geometry)) <span class="sc">|&gt;</span> </span>
<span id="cb57-1550"><a href="#cb57-1550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb57-1551"><a href="#cb57-1551" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, border_length)</span>
<span id="cb57-1552"><a href="#cb57-1552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1553"><a href="#cb57-1553" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate coastline perimeters and ratio of coast to border</span></span>
<span id="cb57-1554"><a href="#cb57-1554" aria-hidden="true" tabindex="-1"></a>coastline_length_by_state_ne_110 <span class="ot">&lt;-</span> ne_coastline_110 <span class="sc">|&gt;</span> </span>
<span id="cb57-1555"><a href="#cb57-1555" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">coastline_length =</span> <span class="fu">st_perimeter</span>(geometry) <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-1556"><a href="#cb57-1556" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb57-1557"><a href="#cb57-1557" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ne_state_border_lengths_110, <span class="at">by =</span> <span class="fu">join_by</span>(name)) <span class="sc">|&gt;</span> </span>
<span id="cb57-1558"><a href="#cb57-1558" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cheat a little because, with the 100 meter buffer, Hawaii's coastline is</span></span>
<span id="cb57-1559"><a href="#cb57-1559" aria-hidden="true" tabindex="-1"></a>  <span class="co"># slightly larger than its border</span></span>
<span id="cb57-1560"><a href="#cb57-1560" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">border_length =</span> <span class="fu">case_when</span>(</span>
<span id="cb57-1561"><a href="#cb57-1561" aria-hidden="true" tabindex="-1"></a>    name <span class="sc">==</span> <span class="st">"Hawaii"</span> <span class="sc">~</span> coastline_length,</span>
<span id="cb57-1562"><a href="#cb57-1562" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> border_length</span>
<span id="cb57-1563"><a href="#cb57-1563" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb57-1564"><a href="#cb57-1564" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop_coastline =</span> <span class="fu">as.numeric</span>(coastline_length <span class="sc">/</span> border_length)) <span class="sc">|&gt;</span> </span>
<span id="cb57-1565"><a href="#cb57-1565" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">rank</span>(<span class="sc">-</span>prop_coastline)) <span class="sc">|&gt;</span> </span>
<span id="cb57-1566"><a href="#cb57-1566" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-1567"><a href="#cb57-1567" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">c</span>(border_length, coastline_length), </span>
<span id="cb57-1568"><a href="#cb57-1568" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="at">miles =</span> <span class="sc">~</span>units<span class="sc">::</span><span class="fu">set_units</span>(., <span class="st">"miles"</span>)))</span>
<span id="cb57-1569"><a href="#cb57-1569" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb57-1570"><a href="#cb57-1570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb57-1571"><a href="#cb57-1571" aria-hidden="true" tabindex="-1"></a>    name, rank, prop_coastline, </span>
<span id="cb57-1572"><a href="#cb57-1572" aria-hidden="true" tabindex="-1"></a>    <span class="fu">starts_with</span>(<span class="st">"border_length"</span>), <span class="fu">starts_with</span>(<span class="st">"coastline_length"</span>)</span>
<span id="cb57-1573"><a href="#cb57-1573" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-1574"><a href="#cb57-1574" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-1575"><a href="#cb57-1575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1576"><a href="#cb57-1576" aria-hidden="true" tabindex="-1"></a>The proportions and rankings changed a bit here. Alaska is now only 83% coastline instead of 95%. Michigan and Florida are still the top coastal states from the contiguous United States, but the New England states dropped substantially. Since the complex inlets and islands in New England were smoothed over, California rose from #14 to #6. (These columns are sortable.)</span>
<span id="cb57-1577"><a href="#cb57-1577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1580"><a href="#cb57-1580" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-1581"><a href="#cb57-1581" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: show-tbl-all-prop-ocean-110</span></span>
<span id="cb57-1582"><a href="#cb57-1582" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb57-1583"><a href="#cb57-1583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1584"><a href="#cb57-1584" aria-hidden="true" tabindex="-1"></a>coastline_length_by_state_ne_110 <span class="sc">|&gt;</span> </span>
<span id="cb57-1585"><a href="#cb57-1585" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>border_length, <span class="sc">-</span>coastline_length) <span class="sc">|&gt;</span> </span>
<span id="cb57-1586"><a href="#cb57-1586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(border_length_miles, coastline_length_miles), <span class="sc">~</span><span class="fu">as.numeric</span>(.))) <span class="sc">|&gt;</span> </span>
<span id="cb57-1587"><a href="#cb57-1587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(prop_coastline)) <span class="sc">|&gt;</span> </span>
<span id="cb57-1588"><a href="#cb57-1588" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb57-1589"><a href="#cb57-1589" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb57-1590"><a href="#cb57-1590" aria-hidden="true" tabindex="-1"></a>    name <span class="sc">~</span> <span class="st">"State"</span>, </span>
<span id="cb57-1591"><a href="#cb57-1591" aria-hidden="true" tabindex="-1"></a>    rank <span class="sc">~</span> <span class="st">"Rank"</span>,</span>
<span id="cb57-1592"><a href="#cb57-1592" aria-hidden="true" tabindex="-1"></a>    prop_coastline <span class="sc">~</span> <span class="st">"% coastline"</span>,</span>
<span id="cb57-1593"><a href="#cb57-1593" aria-hidden="true" tabindex="-1"></a>    border_length_miles <span class="sc">~</span> <span class="st">"Border length (miles)"</span>,</span>
<span id="cb57-1594"><a href="#cb57-1594" aria-hidden="true" tabindex="-1"></a>    coastline_length_miles <span class="sc">~</span> <span class="st">"Coastline length (miles)"</span></span>
<span id="cb57-1595"><a href="#cb57-1595" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb57-1596"><a href="#cb57-1596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_percent</span>(</span>
<span id="cb57-1597"><a href="#cb57-1597" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> prop_coastline,</span>
<span id="cb57-1598"><a href="#cb57-1598" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimals =</span> <span class="dv">1</span></span>
<span id="cb57-1599"><a href="#cb57-1599" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb57-1600"><a href="#cb57-1600" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(</span>
<span id="cb57-1601"><a href="#cb57-1601" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">ends_with</span>(<span class="st">"miles"</span>),</span>
<span id="cb57-1602"><a href="#cb57-1602" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimals =</span> <span class="dv">0</span></span>
<span id="cb57-1603"><a href="#cb57-1603" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb57-1604"><a href="#cb57-1604" aria-hidden="true" tabindex="-1"></a>  <span class="fu">opt_interactive</span>(<span class="at">page_size_default =</span> <span class="dv">16</span>, <span class="at">use_compact_mode =</span> <span class="cn">TRUE</span>, <span class="at">use_highlight =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-1605"><a href="#cb57-1605" aria-hidden="true" tabindex="-1"></a>  <span class="fu">opt_table_font</span>(<span class="st">"Libre Franklin"</span>)</span>
<span id="cb57-1606"><a href="#cb57-1606" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-1607"><a href="#cb57-1607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1608"><a href="#cb57-1608" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb57-1609"><a href="#cb57-1609" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;hr class="dinkus"&gt;</span></span>
<span id="cb57-1610"><a href="#cb57-1610" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-1611"><a href="#cb57-1611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1612"><a href="#cb57-1612" aria-hidden="true" tabindex="-1"></a>We'll make one more table to make it easier to compare the rankings and proportions for the different resolutions.^[<span class="co">[</span><span class="ot">Wikipedia has a similar table</span><span class="co">](https://en.wikipedia.org/wiki/List_of_U.S._states_and_territories_by_coastline)</span> with different rankings based on different maps and projections and resolutions, though they don't rank the coast-to-border proportion like we've been doing.] (These columns are sortable, by the way.)</span>
<span id="cb57-1613"><a href="#cb57-1613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1616"><a href="#cb57-1616" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-1617"><a href="#cb57-1617" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: show-tbl-combined</span></span>
<span id="cb57-1618"><a href="#cb57-1618" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb57-1619"><a href="#cb57-1619" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: page</span></span>
<span id="cb57-1620"><a href="#cb57-1620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1621"><a href="#cb57-1621" aria-hidden="true" tabindex="-1"></a>tbl_10 <span class="ot">&lt;-</span> coastline_length_by_state_ne <span class="sc">|&gt;</span> </span>
<span id="cb57-1622"><a href="#cb57-1622" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb57-1623"><a href="#cb57-1623" aria-hidden="true" tabindex="-1"></a>    name, <span class="at">rank_10 =</span> rank, <span class="at">prop_coastline_10 =</span> prop_coastline,</span>
<span id="cb57-1624"><a href="#cb57-1624" aria-hidden="true" tabindex="-1"></a>    <span class="at">border_length_10 =</span> border_length_miles, <span class="at">coastline_length_10 =</span> coastline_length_miles</span>
<span id="cb57-1625"><a href="#cb57-1625" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-1626"><a href="#cb57-1626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1627"><a href="#cb57-1627" aria-hidden="true" tabindex="-1"></a>tbl_110 <span class="ot">&lt;-</span> coastline_length_by_state_ne_110 <span class="sc">|&gt;</span> </span>
<span id="cb57-1628"><a href="#cb57-1628" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb57-1629"><a href="#cb57-1629" aria-hidden="true" tabindex="-1"></a>    name, <span class="at">rank_110 =</span> rank, <span class="at">prop_coastline_110 =</span> prop_coastline,</span>
<span id="cb57-1630"><a href="#cb57-1630" aria-hidden="true" tabindex="-1"></a>    <span class="at">border_length_110 =</span> border_length_miles, <span class="at">coastline_length_110 =</span> coastline_length_miles</span>
<span id="cb57-1631"><a href="#cb57-1631" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-1632"><a href="#cb57-1632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-1633"><a href="#cb57-1633" aria-hidden="true" tabindex="-1"></a>tbl_10 <span class="sc">|&gt;</span> </span>
<span id="cb57-1634"><a href="#cb57-1634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tbl_110, <span class="at">by =</span> <span class="fu">join_by</span>(name)) <span class="sc">|&gt;</span> </span>
<span id="cb57-1635"><a href="#cb57-1635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"length"</span>), <span class="sc">~</span><span class="fu">as.numeric</span>(.))) <span class="sc">|&gt;</span> </span>
<span id="cb57-1636"><a href="#cb57-1636" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(rank_10) <span class="sc">|&gt;</span> </span>
<span id="cb57-1637"><a href="#cb57-1637" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb57-1638"><a href="#cb57-1638" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb57-1639"><a href="#cb57-1639" aria-hidden="true" tabindex="-1"></a>    name <span class="sc">~</span> <span class="st">"State"</span>, </span>
<span id="cb57-1640"><a href="#cb57-1640" aria-hidden="true" tabindex="-1"></a>    rank_10 <span class="sc">~</span> <span class="st">"Rank"</span>,</span>
<span id="cb57-1641"><a href="#cb57-1641" aria-hidden="true" tabindex="-1"></a>    rank_110 <span class="sc">~</span> <span class="st">"Rank"</span>,</span>
<span id="cb57-1642"><a href="#cb57-1642" aria-hidden="true" tabindex="-1"></a>    prop_coastline_10 <span class="sc">~</span> <span class="st">"% coastline"</span>,</span>
<span id="cb57-1643"><a href="#cb57-1643" aria-hidden="true" tabindex="-1"></a>    prop_coastline_110 <span class="sc">~</span> <span class="st">"% coastline"</span>,</span>
<span id="cb57-1644"><a href="#cb57-1644" aria-hidden="true" tabindex="-1"></a>    border_length_10 <span class="sc">~</span> <span class="st">"Border length (miles)"</span>,</span>
<span id="cb57-1645"><a href="#cb57-1645" aria-hidden="true" tabindex="-1"></a>    border_length_110 <span class="sc">~</span> <span class="st">"Border length (miles)"</span>,</span>
<span id="cb57-1646"><a href="#cb57-1646" aria-hidden="true" tabindex="-1"></a>    coastline_length_10 <span class="sc">~</span> <span class="st">"Coastline length (miles)"</span>,</span>
<span id="cb57-1647"><a href="#cb57-1647" aria-hidden="true" tabindex="-1"></a>    coastline_length_110 <span class="sc">~</span> <span class="st">"Coastline length (miles)"</span></span>
<span id="cb57-1648"><a href="#cb57-1648" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb57-1649"><a href="#cb57-1649" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sub_missing</span>() <span class="sc">|&gt;</span> </span>
<span id="cb57-1650"><a href="#cb57-1650" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_spanner</span>(</span>
<span id="cb57-1651"><a href="#cb57-1651" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"High resolution (1:10 million)"</span>,</span>
<span id="cb57-1652"><a href="#cb57-1652" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">ends_with</span>(<span class="st">"_10"</span>)</span>
<span id="cb57-1653"><a href="#cb57-1653" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb57-1654"><a href="#cb57-1654" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_spanner</span>(</span>
<span id="cb57-1655"><a href="#cb57-1655" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Low resolution (1:110 million)"</span>,</span>
<span id="cb57-1656"><a href="#cb57-1656" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">ends_with</span>(<span class="st">"_110"</span>)</span>
<span id="cb57-1657"><a href="#cb57-1657" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb57-1658"><a href="#cb57-1658" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_percent</span>(</span>
<span id="cb57-1659"><a href="#cb57-1659" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="st">"prop_"</span>),</span>
<span id="cb57-1660"><a href="#cb57-1660" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimals =</span> <span class="dv">1</span></span>
<span id="cb57-1661"><a href="#cb57-1661" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb57-1662"><a href="#cb57-1662" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(</span>
<span id="cb57-1663"><a href="#cb57-1663" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">contains</span>(<span class="st">"length"</span>),</span>
<span id="cb57-1664"><a href="#cb57-1664" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimals =</span> <span class="dv">0</span></span>
<span id="cb57-1665"><a href="#cb57-1665" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb57-1666"><a href="#cb57-1666" aria-hidden="true" tabindex="-1"></a>  <span class="fu">opt_interactive</span>(<span class="at">use_pagination =</span> <span class="cn">FALSE</span>, <span class="at">use_compact_mode =</span> <span class="cn">TRUE</span>, <span class="at">use_highlight =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-1667"><a href="#cb57-1667" aria-hidden="true" tabindex="-1"></a>  <span class="fu">opt_table_font</span>(<span class="st">"Libre Franklin"</span>)</span>
<span id="cb57-1668"><a href="#cb57-1668" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p><span class="faux-block"><i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> 2007–2024 Andrew Heiss</span> <span class="faux-block">All content licensed under<br><a href="https://creativecommons.org/licenses/by/4.0/"><i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> <i class="fa-brands fa-creative-commons-by" aria-label="creative-commons-by"></i> Creative Commons CC BY 4.0</a></span></p>
</div>   
    <div class="nav-footer-center">
<p><span class="faux-block"><i class="fa-brands fa-orcid" aria-label="orcid"></i> <strong>ORCID</strong> <a href="https://orcid.org/0000-0002-3948-3914">0000-0002-3948-3914</a></span> <span class="faux-block"><i class="fa-solid fa-key" aria-label="key"></i> <a href="../../../../../pgp_ath.asc.txt">PGP public key</a>   <i class="fa-solid fa-fingerprint" aria-label="fingerprint"></i> Fingerprint:<br><span class="fingerprint">4AA2 FA83 A8B2 05A4 E30F<br> 610D 1382 6216 9178 36AB</span></span></p>
</div>
    <div class="nav-footer-right">
<p><span class="faux-block">Made with <i class="fa-brands fa-r-project" aria-label="r-project"></i> and <a href="https://quarto.org/">Quarto</a></span> <span class="faux-block"><a href="https://github.com/andrewheiss/ath-quarto">View the source at <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></span></p>
</div>
  </div>
</footer>


</body></html>