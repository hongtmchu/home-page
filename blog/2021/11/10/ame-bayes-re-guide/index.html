<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Hong T.M. Chu">
<meta name="description" content="How to calculate grand means, conditional group means, and hypothetical group means of posterior predictions from multilevel brms models.">
<title>A guide to correctly calculating posterior predictions and average marginal effects with multilievel Bayesian models | Hong T.M. Chu – Hong T.M. Chu</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../../">
<link href="../../../../..//files/favicon-512.png" rel="icon" type="image/png">
<script src="../../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting-17c909d5fd25ae21b861c0c7a49b2096.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../site_libs/bootstrap/bootstrap-5cd0811f461c8271ae6bab49df9501be.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script src="../../../../../site_libs/quarto-contrib/iconify-2.0.0/iconify-icon.min.js"></script><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-527449-5', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script><style>

      .quarto-title-block .quarto-title-banner {
        background: #170C3A;
      }
</style>
<script src="../../../../../site_libs/kePrint-0.0.1/kePrint.js"></script><link href="../../../../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
<meta property="og:title" content="A guide to correctly calculating posterior predictions and average marginal effects with multilievel Bayesian models | Hong T.M. Chu">
<meta property="og:description" content="How to calculate grand means, conditional group means, and hypothetical group means of posterior predictions from multilevel brms models.">
<meta property="og:image" content="https://www.andrewheiss.com/blog/2021/11/10/ame-bayes-re-guide/index_files/figure-html/all-effects-combined-1.png">
<meta property="og:site_name" content="Hong T.M. Chu">
<meta property="og:locale" content="en_US">
<meta property="og:image:height" content="2304">
<meta property="og:image:width" content="2880">
<meta name="twitter:title" content="A guide to correctly calculating posterior predictions and average marginal effects with multilievel Bayesian models | Hong T.M. Chu">
<meta name="twitter:description" content="How to calculate grand means, conditional group means, and hypothetical group means of posterior predictions from multilevel brms models.">
<meta name="twitter:image" content="https://www.andrewheiss.com/blog/2021/11/10/ame-bayes-re-guide/index_files/figure-html/all-effects-combined-1.png">
<meta name="twitter:creator" content="@andrewheiss">
<meta name="twitter:site" content="@andrewheiss">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image-height" content="2304">
<meta name="twitter:image-width" content="2880">
</head>
<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../../index.html">
    <span class="navbar-title">Hong T.M. Chu</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../../../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../cv/index.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../research/index.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../teaching/index.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="mailto:hong.ctm@vinuni.edu.vn"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:envelope" style="font-size: 1.1em;" aria-label="Icon envelope from bi Iconify.design set." title="E-mail"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/andrewheiss" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:github" style="font-size: 1.1em;" aria-label="Icon github from bi Iconify.design set." title="GitHub"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/hongtmchu" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:linkedin" style="font-size: 1.1em;" aria-label="Icon linkedin from bi Iconify.design set." title="LinkedIn"></iconify-icon></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default blog-post page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">A guide to correctly calculating posterior predictions and average marginal effects with multilievel Bayesian models</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
                  <div>
        <div class="description">
          How to calculate grand means, conditional group means, and hypothetical group means of posterior predictions from multilevel brms models.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">r</div>
                <div class="quarto-category">tidyverse</div>
                <div class="quarto-category">regression</div>
                <div class="quarto-category">statistics</div>
                <div class="quarto-category">data visualization</div>
                <div class="quarto-category">bayes</div>
                <div class="quarto-category">brms</div>
                <div class="quarto-category">stan</div>
                <div class="quarto-category">beta</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://www.andrewheiss.com/">Andrew Heiss</a> <a href="https://orcid.org/0000-0002-3948-3914" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">Wednesday, November 10, 2021</p>
      </div>
    </div>
    
      
      <div>
      <div class="quarto-title-meta-heading">Doi</div>
      <div class="quarto-title-meta-contents">
        <p class="doi">
          <a href="https://doi.org/10.59350/wbn93-edb02">10.59350/wbn93-edb02</a>
        </p>
      </div>
    </div>
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Contents</h2>
   
  <ul>
<li><a href="#who-this-guide-is-for" id="toc-who-this-guide-is-for" class="nav-link active" data-scroll-target="#who-this-guide-is-for">Who this guide is for</a></li>
  <li><a href="#example-data" id="toc-example-data" class="nav-link" data-scroll-target="#example-data">Example data</a></li>
  <li><a href="#explore-the-data" id="toc-explore-the-data" class="nav-link" data-scroll-target="#explore-the-data">Explore the data</a></li>
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model">Model</a></li>
  <li>
<a href="#posterior-predictions" id="toc-posterior-predictions" class="nav-link" data-scroll-target="#posterior-predictions">Posterior predictions</a>
  <ul>
<li><a href="#draws-from-the-posterior-predictive-distribution" id="toc-draws-from-the-posterior-predictive-distribution" class="nav-link" data-scroll-target="#draws-from-the-posterior-predictive-distribution">Draws from the posterior predictive distribution</a></li>
  <li><a href="#expected-values-of-the-posterior-predictive-distribution" id="toc-expected-values-of-the-posterior-predictive-distribution" class="nav-link" data-scroll-target="#expected-values-of-the-posterior-predictive-distribution">Expected values of the posterior predictive distribution</a></li>
  </ul>
</li>
  <li><a href="#average-marginal-effects" id="toc-average-marginal-effects" class="nav-link" data-scroll-target="#average-marginal-effects">Average marginal effects</a></li>
  <li>
<a href="#different-kinds-of-average-predictions-with-multilevel-models" id="toc-different-kinds-of-average-predictions-with-multilevel-models" class="nav-link" data-scroll-target="#different-kinds-of-average-predictions-with-multilevel-models">Different kinds of average predictions with multilevel models</a>
  <ul>
<li>
<a href="#global-grand-mean" id="toc-global-grand-mean" class="nav-link" data-scroll-target="#global-grand-mean">Global grand mean</a>
  <ul class="collapse">
<li><a href="#binary-effect" id="toc-binary-effect" class="nav-link" data-scroll-target="#binary-effect">Binary effect</a></li>
  <li><a href="#continuous-effect" id="toc-continuous-effect" class="nav-link" data-scroll-target="#continuous-effect">Continuous effect</a></li>
  </ul>
</li>
  <li>
<a href="#conditional-effects-for-existing-groups" id="toc-conditional-effects-for-existing-groups" class="nav-link" data-scroll-target="#conditional-effects-for-existing-groups">Conditional effects for existing groups</a>
  <ul class="collapse">
<li><a href="#binary-effect-1" id="toc-binary-effect-1" class="nav-link" data-scroll-target="#binary-effect-1">Binary effect</a></li>
  <li><a href="#continuous-effect-1" id="toc-continuous-effect-1" class="nav-link" data-scroll-target="#continuous-effect-1">Continuous effect</a></li>
  </ul>
</li>
  <li>
<a href="#conditional-effects-for-a-single-new-hypothetical-group-either-typical-or-brand-new" id="toc-conditional-effects-for-a-single-new-hypothetical-group-either-typical-or-brand-new" class="nav-link" data-scroll-target="#conditional-effects-for-a-single-new-hypothetical-group-either-typical-or-brand-new">Conditional effects for a single new hypothetical group, either typical or brand new</a>
  <ul class="collapse">
<li><a href="#binary-effect-for-amalgamated-hypothetical-region" id="toc-binary-effect-for-amalgamated-hypothetical-region" class="nav-link" data-scroll-target="#binary-effect-for-amalgamated-hypothetical-region">Binary effect for amalgamated hypothetical region</a></li>
  <li><a href="#binary-effect-for-completely-new-hypothetical-region" id="toc-binary-effect-for-completely-new-hypothetical-region" class="nav-link" data-scroll-target="#binary-effect-for-completely-new-hypothetical-region">Binary effect for completely new hypothetical region</a></li>
  </ul>
</li>
  </ul>
</li>
  <li><a href="#which-average-is-best" id="toc-which-average-is-best" class="nav-link" data-scroll-target="#which-average-is-best">Which average is best?</a></li>
  <li><a href="#overall-summary-of-different-approaches" id="toc-overall-summary-of-different-approaches" class="nav-link" data-scroll-target="#overall-summary-of-different-approaches">Overall summary of different approaches</a></li>
  </ul></nav>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content"><p><a href="https://www.andrewheiss.com/blog/2021/11/08/beta-regression-guide/#super-fancy-detailed-model-with-lots-of-moving-parts-just-for-fun">At the end</a> of my <a href="https://www.andrewheiss.com/blog/2021/11/08/beta-regression-guide/">previous post on beta and zero-inflated-beta regression</a>, I included an example of a multilevel model that predicted the proportion of women members of parliament based on whether a country implements gender-based quotas for their legislatures, along with a few different control variables. I also included random effects for year and region in order to capture time- and geography-specific trends. When interpreting the results, I naively said that calculating posterior predictions from the model (i.e.&nbsp;plugging arbitrary values into the model and finding the predicted value of the outcome) magically and automatically includes information about year and region (or the random effects included in the model). But I was wrong-ish! Incorporating information about the random effects of a multilevel model is actually a lot more involved and detailed than I thought, and the nuances are really important and make a big difference!</p>
<p>As <a href="https://twitter.com/tjmahr/status/1450486103497187328?s=21">TJ Mahr recently tweeted</a>, this is hard stuff!</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="tj-tweet.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>Fortunately, over the past couple days I’ve been part of several really long Twitter threads (with people who know waaaay more about this than me!) about different ways of incorporating group-level effects into posterior predictions. HUGE THANKS to <a href="https://twitter.com/IsabellaGhement">Isabella Ghement</a>, <a href="https://twitter.com/bmwiernik">Brenton Wiernik</a>, <a href="https://twitter.com/tjmahr">TJ Mahr</a>, <a href="https://twitter.com/wdonald_1985">Donald Williams</a>, <a href="https://twitter.com/SolomonKurz">Solomon Kurz</a>, and <a href="https://twitter.com/mattansb">Mattan Ben-Shachar</a> for all their help and tweeting! (<a href="https://twitter.com/bmwiernik/status/1458043604128215040">This set of tweets by Brenton</a> was pivotal!)</p>
<section id="who-this-guide-is-for" class="level2"><h2 class="anchored" data-anchor-id="who-this-guide-is-for">Who this guide is for</h2>
<p>To borrow from <a href="https://solomonkurz.netlify.app/post/2021-09-22-sexy-up-your-logistic-regression-model-with-logit-dotplots/">Solomon Kurz</a>, here’s what this guide assumes you know:</p>
<ul>
<li><p>You’re familiar with <a href="https://www.r-project.org/">R</a> and the <a href="https://www.tidyverse.org/">tidyverse</a> (particularly <a href="https://dplyr.tidyverse.org/">dplyr</a> and <a href="https://ggplot2.tidyverse.org/">ggplot2</a>).</p></li>
<li><p>You’re familiar with <a href="https://paul-buerkner.github.io/brms/">brms</a> for running Bayesian regression models. See <a href="https://paul-buerkner.github.io/brms/articles/index.html">the vignettes here</a>, examples like <a href="https://www.rensvandeschoot.com/tutorials/brms-started/">this</a>, or <a href="https://evalf21.classes.andrewheiss.com/resource/bayes/#resources">resources like these</a> for an introduction.</p></li>
<li>
<p>You’re somewhat familiar with multilevel models. <a href="https://twitter.com/chelseaparlett/status/1458461737431146500">Confusingly</a>, these are also called mixed effect models, random effect models, and hierarchical models, among others! They’re all the same thing! (<small>image below by <a href="https://twitter.com/chelseaparlett/status/1458461737431146500">Chelsea Parlett-Pelleriti</a></small>)</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="chelsea-meme.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%"></p>
</figure>
</div>
</div>
</div>
<p>See examples like <a href="https://www.tjmahr.com/plotting-partial-pooling-in-mixed-effects-models/">this</a> or <a href="https://www.tjmahr.com/another-mixed-effects-model-visualization/">this</a> or <a href="https://www.rensvandeschoot.com/tutorials/lme4/">this</a> or <a href="https://rstudio-pubs-static.s3.amazonaws.com/63556_e35cc7e2dfb54a5bb551f3fa4b3ec4ae.html">this</a>. Basically Google “lme4 example” (lme4 is what you use for frequentist, non-Bayesian multilevel models with R) or “brms multilevel example” and you’ll find a bunch. For a more formal treatment, see chapter 12 in <a href="https://xcelab.net/rm/statistical-rethinking/">Richard McElreath’s <em>Statistcal Rethinking</em></a> book (or <a href="https://bookdown.org/content/3890/multilevel-models.html">this R translation of it</a> by Solomon Kurz).</p>
</li>
</ul></section><section id="example-data" class="level2"><h2 class="anchored" data-anchor-id="example-data">Example data</h2>
<p>Put simply, multilevel models let you account for nested structures in data:</p>
<ul>
<li>Students inside schools inside school districts inside states</li>
<li>Study participants inside cities inside states across months</li>
<li>Countries within regions and across years</li>
</ul>
<p>Since most of my own work deals with international politics, we’ll use an example with countries and years. We’ll use data from the <a href="https://www.v-dem.net/en/">Varieties of Democracy project (V-Dem)</a> to explore the relationship between press freedom and the degree to which political opposition is allowed. Is there more press freedom in countries that allow opposition parties?</p>
<p>There’s <a href="https://github.com/vdeminstitute/vdemdata">a great R package for accessing V-Dem data</a> without needing to download it manually from their website, so we’ll use that to make a smaller dataset of countries for just 2015. Let’s load all the libraries we need, clean up the data, and get started!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>    <span class="co"># ggplot, dplyr, %&gt;%, and friends</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms">brms</a></span><span class="op">)</span>         <span class="co"># Bayesian modeling through Stan</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/tidybayes/">tidybayes</a></span><span class="op">)</span>    <span class="co"># Manipulate Stan objects in a tidy way</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span>        <span class="co"># Convert model objects to data frames</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bbolker/broom.mixed">broom.mixed</a></span><span class="op">)</span>  <span class="co"># Convert brms model objects to data frames</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rvlenth.github.io/emmeans/">emmeans</a></span><span class="op">)</span>      <span class="co"># Calculate marginal effects in even fancier ways</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">vdemdata</span><span class="op">)</span>     <span class="co"># Use data from the Varieties of Democracy (V-Dem) project</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span>    <span class="co"># Combine ggplot objects</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/malcolmbarrett/ggokabeito">ggokabeito</a></span><span class="op">)</span>   <span class="co"># Neat accessible color palette</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/erocoar/gghalves">gghalves</a></span><span class="op">)</span>     <span class="co"># Special half geoms</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/eclarke/ggbeeswarm">ggbeeswarm</a></span><span class="op">)</span>   <span class="co"># Special distribution-shaped point jittering</span></span>
<span></span>
<span><span class="co"># Custom ggplot theme to make pretty plots</span></span>
<span><span class="co"># Get the News Cycle font at https://fonts.google.com/specimen/News+Cycle</span></span>
<span><span class="va">theme_clean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span>base_family <span class="op">=</span> <span class="st">"News Cycle"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>          plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>          axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>          strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fu">rel</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>          strip.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey80"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>          legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>V-Dem includes hundreds of different variables, but we only need a few, and we’ll make a few adjustments to the ones we do need. Here’s what we’ll do:</p>
<ul>
<li>
<p><strong>Main outcome</strong>: Alternative sources of information index (<code>v2xme_altinf</code> in V-Dem). This is a 0–1 scale that measures…</p>
<blockquote class="blockquote">
<p>To what extent the [is] media (a) un-biased in their coverage or lack of coverage of the opposition, (b) allowed to be critical of the regime, and (c) representative of a wide array of political perspectives</p>
</blockquote>
<p>Higher values represent more media freedom.</p>
</li>
<li>
<p><strong>Main binary explanatory variable</strong>: Opposition parties autonomy (<code>v2psoppaut</code> in V-Dem). This is an ordinal variable with these possible values:</p>
<blockquote class="blockquote">
<ul>
<li>0: Opposition parties are not allowed.</li>
<li>1: There are no autonomous, independent opposition parties. Opposition parties are either selected or co-opted by the ruling regime.</li>
<li>2: At least some opposition parties are autonomous and independent of the ruling regime.</li>
<li>3: Most significant opposition parties are autonomous and independent of the ruling regime.</li>
<li>4: All opposition parties are autonomous and independent of the ruling regime.</li>
</ul>
</blockquote>
<p>For the sake of simplicity, we’ll collapse this into a binary variable. Parties are autonomous if they score a 3 or a 4; they’re not autonomous if they score a 0, 1, or 2. Also, there are a handful of countries (Saudi Arabia, Qatar, etc.) with missing data for this column, since they don’t have <em>any</em> opposition parties. We’ll treat them as not-autonomous here.</p>
</li>
<li><p><strong>Main continuous explanatory variable</strong>: Civil liberties index (<code>v2x_civlib</code>). This is a continuous variable measured from 0–1 with higher values representing better respect for human rights and civil liberties.</p></li>
<li>
<p><strong>Grouping</strong>: Finally, we’ll use region as groups in these models (i.e.&nbsp;countries nested in regions). V-Dem provides multiple regional variables with varying specificity (19 different regions, 10 different regions, and 6 different regions). We’ll use the 6-region version (<code>e_regionpol_6C</code>) for simplicity here:</p>
<blockquote class="blockquote">
<ul>
<li>1: Eastern Europe and Central Asia (including Mongolia)</li>
<li>2: Latin America and the Caribbean</li>
<li>3: The Middle East and North Africa (including Israel and Turkey, excluding Cyprus)</li>
<li>4: Sub-Saharan Africa</li>
<li>5: Western Europe and North America (including Cyprus, Australia and New Zealand)</li>
<li>6: Asia and Pacific (excluding Australia and New Zealand)</li>
</ul>
</blockquote>
</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Make a subset of the full V-Dem data</span></span>
<span><span class="va">vdem_2015</span> <span class="op">&lt;-</span> <span class="va">vdem</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">country_name</span>, <span class="va">country_text_id</span>, <span class="va">year</span>, region <span class="op">=</span> <span class="va">e_regionpol_6C</span>,</span>
<span>         media_index <span class="op">=</span> <span class="va">v2xme_altinf</span>, party_autonomy_ord <span class="op">=</span> <span class="va">v2psoppaut_ord</span>,</span>
<span>         polyarchy <span class="op">=</span> <span class="va">v2x_polyarchy</span>, civil_liberties <span class="op">=</span> <span class="va">v2x_civlib</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2015</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>party_autonomy <span class="op">=</span> <span class="va">party_autonomy_ord</span> <span class="op">&gt;=</span> <span class="fl">3</span>,</span>
<span>         party_autonomy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">party_autonomy</span><span class="op">)</span>, <span class="cn">FALSE</span>, <span class="va">party_autonomy</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">region</span>, </span>
<span>                         labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Eastern Europe and Central Asia"</span>,</span>
<span>                                    <span class="st">"Latin America and the Caribbean"</span>,</span>
<span>                                    <span class="st">"Middle East and North Africa"</span>,</span>
<span>                                    <span class="st">"Sub-Saharan Africa"</span>,</span>
<span>                                    <span class="st">"Western Europe and North America"</span>,</span>
<span>                                    <span class="st">"Asia and Pacific"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="explore-the-data" class="level2"><h2 class="anchored" data-anchor-id="explore-the-data">Explore the data</h2>
<p>We’re interested in a couple relationships here. First, we want to know if there is more press freedom in countries that allow opposition parties in elections. Let’s look at the data really quick:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">autonomy_halves</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">vdem_2015</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">party_autonomy</span>, y <span class="op">=</span> <span class="va">media_index</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_half_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">party_autonomy</span><span class="op">)</span>, </span>
<span>                  transformation <span class="op">=</span> <span class="fu">position_quasirandom</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                  side <span class="op">=</span> <span class="st">"l"</span>, size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_half_boxplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">party_autonomy</span><span class="op">)</span>, side <span class="op">=</span> <span class="st">"r"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_fill_okabe_ito</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_okabe_ito</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"none"</span>, fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Opposition party autonomy"</span>, y <span class="op">=</span> <span class="st">"Media freedom index"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">autonomy_densities</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">vdem_2015</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">media_index</span>, fill <span class="op">=</span> <span class="va">party_autonomy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_density</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_okabe_ito</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Media freedom index"</span>, y <span class="op">=</span> <span class="st">"Density"</span>, fill <span class="op">=</span> <span class="st">"Opposition party autonomy"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">autonomy_halves</span> <span class="op">|</span> <span class="va">autonomy_densities</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-explore-autonomy-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>That confirms our initial suspicions: countries that do not allow opposition parties to participate in elections tend to have substantially lower media freedom index scores than countries that have opposition parties.</p>
<p>Let’s see how respect for civil liberties is related to media freedom:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">vdem_2015</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">civil_liberties</span>, y <span class="op">=</span> <span class="va">media_index</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">region</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_smooth</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Civil liberties index"</span>, y <span class="op">=</span> <span class="st">"Media freedom index"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Region"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_okabe_ito</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## `geom_smooth()` using formula = 'y ~ x'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Countries with greater respect for civil liberties and human rights tend to have higher values of media freedom. There are perhaps some regional trends here too—most of the countries in Western Europe and North America are clustered in the top right corner of the plot, but all other regions are spread throughout.</p>
</section><section id="model" class="level2"><h2 class="anchored" data-anchor-id="model">Model</h2>
<p>Let’s make a model! We’ll look just at 2015 data to estimate the effect of party autonomy (a binary variable) and civil liberties (a continuous variable) on a country’s media freedom index. We’ll include random effects for region, assuming that there are regional differences in this relationship (i.e.&nbsp;the relationship between party autonomy and media freedom looks different in Asia from Western Europe).</p>
<p>Because <code>media_index</code> ranges from 0 to 1 but does not include 0 or 1, we’ll use a beta distribution. It’s <a href="https://www.andrewheiss.com/blog/2021/11/08/beta-regression-guide/">a really neat and fun distribution to work with</a>, and it has extra moving parts we can play with—we can model the <span class="math inline">\(\phi\)</span> parameter (or the precision/variance of the distribution) with random effects too.</p>
<p>Formally, we can define the full model like this:</p>
<p><span class="math display">\[
\begin{aligned}
&amp;\text{[likelihood]} \\
\text{Media freedom index}_i &amp;\sim \operatorname{Beta}(\mu_i, \phi_i) \\
\ \\
&amp;\text{[} \mu \text{ part of beta distribution]} \\
\operatorname{logit}(\mu_i) &amp;= \alpha_{j[i]} + \beta_1 \text{Party autonomy}_i + \beta_2 \text{Civil liberties}_i\\
\ \\
&amp;\text{[} \phi \text{ part of beta distribution]} \\
\log(\phi_i) &amp;= \alpha_{j[i]}\\
\ \\
&amp; \text{[region-specific intercepts]} \\
\alpha_{j} &amp;\sim \mathcal{N}(\mu_{\alpha_j}, \sigma^2_{\alpha_j}), \text{ for region } j \text{ in } 1 .. J
\end{aligned}
\]</span></p>
<p>We’ll model the <span class="math inline">\(\mu\)</span> (or mean) parameter of the beta distribution with <code>party_autonomy</code>, <code>civil_liberties</code>, and random intercepts for region, and we’ll model the <span class="math inline">\(\phi\)</span> part (or precision) with just random intercepts for region (though we could use whatever, too—<a href="https://www.andrewheiss.com/blog/2021/11/08/beta-regression-guide/#working-with-the-precision-parameter">see this for an explanation of what this parameter does</a>).</p>
<p>The syntax for defining random effects can get complex, depending on if the effects are nested or crossed, and if slopes get involved. <a href="https://bbolker.github.io/mixedmodels-misc/glmmFAQ.html#model-specification">This table by Ben Bolker</a> is <em>indispensable</em> for remembering how to define which kinds of effects. Here we’re just adding a random intercept for region, so we’ll use a <code>(1 | region)</code> term in the model code.</p>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/run-model-2015_7b8addb40e98384e4582460db18880d5">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_basic</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span></span>
<span>  <span class="fu">bf</span><span class="op">(</span><span class="va">media_index</span> <span class="op">~</span> <span class="va">party_autonomy</span> <span class="op">+</span> <span class="va">civil_liberties</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">region</span><span class="op">)</span>,</span>
<span>     <span class="va">phi</span> <span class="op">~</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">region</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">vdem_2015</span>,</span>
<span>  family <span class="op">=</span> <span class="fu">Beta</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>adapt_delta <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">4</span>, iter <span class="op">=</span> <span class="fl">2000</span>, warmup <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">12345</span>,</span>
<span>  <span class="co"># Use the cmdstanr backend for Stan because it's faster and more modern than</span></span>
<span>  <span class="co"># the default rstan. You need to install the cmdstanr package first</span></span>
<span>  <span class="co"># (https://mc-stan.org/cmdstanr/) and then run cmdstanr::install_cmdstan() to</span></span>
<span>  <span class="co"># install cmdstan on your computer.</span></span>
<span>  backend <span class="op">=</span> <span class="st">"cmdstanr"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## Start sampling</span></span>
<span><span class="co">## Warning: 1 of 4000 (0.0%) transitions ended with a divergence.</span></span>
<span><span class="co">## See https://mc-stan.org/misc/warnings for details.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="posterior-predictions" class="level2"><h2 class="anchored" data-anchor-id="posterior-predictions">Posterior predictions</h2>
<p>Because this model uses beta regression, the coefficients for the <span class="math inline">\(\mu\)</span> part are on the logit (log odds) scale, while the coefficients for the <span class="math inline">\(\phi\)</span> part are on the log scale. This makes them really hard to interpret when just looking at a table of coefficient estimates, like this one here:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tidy</span><span class="op">(</span><span class="va">model_basic</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 6 × 8</span></span>
<span><span class="co">##   effect   component group  term                estimate std.error conf.low conf.high</span></span>
<span><span class="co">##   &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">## 1 fixed    cond      &lt;NA&gt;   (Intercept)           -2.46      0.302   -3.04      -1.87</span></span>
<span><span class="co">## 2 fixed    cond      &lt;NA&gt;   phi_(Intercept)        2.35      0.474    1.35       3.22</span></span>
<span><span class="co">## 3 fixed    cond      &lt;NA&gt;   party_autonomyTRUE     1.03      0.172    0.698      1.38</span></span>
<span><span class="co">## 4 fixed    cond      &lt;NA&gt;   civil_liberties        3.51      0.316    2.90       4.12</span></span>
<span><span class="co">## 5 ran_pars cond      region sd__(Intercept)        0.499     0.256    0.211      1.19</span></span>
<span><span class="co">## 6 ran_pars cond      region sd__phi_(Intercept)    0.925     0.451    0.365      2.06</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Even if we back-transform the estimates to the response scale (with <code><a href="https://rdrr.io/r/stats/Logistic.html">plogis()</a></code> for the logits and <code><a href="https://rdrr.io/r/base/Log.html">exp()</a></code> for the logs), <strong>we still cannot interpret the coefficients directly</strong>. Unlike regular OLS-like regression models, we can’t say things like “a one-unit increase in <code>party_autonomy</code> is associated with a <code>plogis(2.27)</code> unit increase in <code>media_freedom</code>”—we have to incorporate the intercept and all the other model parameters in order to make marginal interpretations like that.</p>
<p>In this case, we <em>are</em> interested in these marginal effects, though. What is the effect of flipping <code>party_autonomy</code> from <code>FALSE</code> to <code>TRUE</code>? What is the effect of a one-unit increase in the respect for human rights and civil liberties measured by <code>civil_liberties</code>? You can’t easily figure it out with the raw results of the model because there are so many moving parts: the different pieces (intercept, other coefficients) for the <span class="math inline">\(\mu\)</span> part need to be combined, the precision parameter <span class="math inline">\(\phi\)</span> needs to be incorporated somehow, and random regional effects for both the <span class="math inline">\(\mu\)</span> <em>and</em> the <span class="math inline">\(\phi\)</span> parts need to be accounted for. That’s a mess.</p>
<p>Instead of trying to algebraically piece all this together, we can plug hypothetical data into the model’s posterior distribution and generate posterior predictions of our media freedom outcome.</p>
<section id="draws-from-the-posterior-predictive-distribution" class="level3"><h3 class="anchored" data-anchor-id="draws-from-the-posterior-predictive-distribution">Draws from the posterior predictive distribution</h3>
<p>There are a few general approaches to generating posterior predictions with <strong>brms</strong>. First, we can use <code>posterior_predict()</code> to plug a new dataset into the model. As an example, we’ll create a little dataset where <code>party_autonomy</code> is both <code>TRUE</code> and <code>FALSE</code>, and we’ll arbitrarily set <code>civil_liberties</code> to 0.5 (right in the middle of its range) and <code>region</code> to the Middle East and North Africa. We’ll then plug that in to the model and generate predictions</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">newdata</span> <span class="op">&lt;-</span> <span class="fu">expand_grid</span><span class="op">(</span>party_autonomy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>                       civil_liberties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                       region <span class="op">=</span> <span class="st">"Middle East and North Africa"</span><span class="op">)</span></span>
<span><span class="va">newdata</span></span>
<span><span class="co">## # A tibble: 2 × 3</span></span>
<span><span class="co">##   party_autonomy civil_liberties region                      </span></span>
<span><span class="co">##   &lt;lgl&gt;                    &lt;dbl&gt; &lt;chr&gt;                       </span></span>
<span><span class="co">## 1 TRUE                       0.5 Middle East and North Africa</span></span>
<span><span class="co">## 2 FALSE                      0.5 Middle East and North Africa</span></span>
<span></span>
<span><span class="fu">posterior_predict</span><span class="op">(</span><span class="va">model_basic</span>, <span class="va">newdata</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">##       [,1]  [,2]</span></span>
<span><span class="co">## [1,] 0.894 0.401</span></span>
<span><span class="co">## [2,] 0.400 0.751</span></span>
<span><span class="co">## [3,] 0.864 0.476</span></span>
<span><span class="co">## [4,] 0.374 0.332</span></span>
<span><span class="co">## [5,] 0.544 0.495</span></span>
<span><span class="co">## [6,] 0.564 0.596</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This returns a matrix with 4,000 rows and 2 columns—a column for when <code>party_autonomy</code> is <code>TRUE</code> and one for when it is <code>FALSE</code>. This format isn’t in the nicest shape for plotting and doing tidy type of stuff with, so we can alternatively use <code>predicted_draws()</code> from the <strong>tidybayes</strong> package. This is really just a fancy wrapper around <code>brms::posterior_predict()</code> that returns a much nicer tidier data frame:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tidy_pred</span> <span class="op">&lt;-</span> <span class="va">model_basic</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">predicted_draws</span><span class="op">(</span>newdata <span class="op">=</span> <span class="va">newdata</span><span class="op">)</span></span>
<span><span class="va">tidy_pred</span></span>
<span><span class="co">## # A tibble: 8,000 × 8</span></span>
<span><span class="co">## # Groups:   party_autonomy, civil_liberties, region, .row [2]</span></span>
<span><span class="co">##    party_autonomy civil_liberties region          .row .chain .iteration .draw .prediction</span></span>
<span><span class="co">##    &lt;lgl&gt;                    &lt;dbl&gt; &lt;chr&gt;          &lt;int&gt;  &lt;int&gt;      &lt;int&gt; &lt;int&gt;       &lt;dbl&gt;</span></span>
<span><span class="co">##  1 TRUE                       0.5 Middle East a…     1     NA         NA     1       0.669</span></span>
<span><span class="co">##  2 TRUE                       0.5 Middle East a…     1     NA         NA     2       0.811</span></span>
<span><span class="co">##  3 TRUE                       0.5 Middle East a…     1     NA         NA     3       0.378</span></span>
<span><span class="co">##  4 TRUE                       0.5 Middle East a…     1     NA         NA     4       0.329</span></span>
<span><span class="co">##  5 TRUE                       0.5 Middle East a…     1     NA         NA     5       0.559</span></span>
<span><span class="co">##  6 TRUE                       0.5 Middle East a…     1     NA         NA     6       0.518</span></span>
<span><span class="co">##  7 TRUE                       0.5 Middle East a…     1     NA         NA     7       0.927</span></span>
<span><span class="co">##  8 TRUE                       0.5 Middle East a…     1     NA         NA     8       0.823</span></span>
<span><span class="co">##  9 TRUE                       0.5 Middle East a…     1     NA         NA     9       0.475</span></span>
<span><span class="co">## 10 TRUE                       0.5 Middle East a…     1     NA         NA    10       0.802</span></span>
<span><span class="co">## # ℹ 7,990 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>That’s</em> much nicer to work with!</p>
</section><section id="expected-values-of-the-posterior-predictive-distribution" class="level3"><h3 class="anchored" data-anchor-id="expected-values-of-the-posterior-predictive-distribution">Expected values of the posterior predictive distribution</h3>
<p>We don’t necessarily want to use these predicted draws when thinking about marginal effects of coefficients, though. When we use <code>posterior_predict()</code>/<code>predicted_draws()</code> here, <strong>brms</strong> accounts for the uncertainty of all these things:</p>
<ul>
<li>The uncertainty of the fixed coefficients (e.g., <code>party_autonomy</code> and <code>civil_liberties</code>)</li>
<li>The uncertainty of the variance parameters of the groups (e.g., <code>sd__phi_(Intercept)</code> for each region)</li>
<li>The uncertainty for each individual observation (e.g., observational-level residual variance)</li>
</ul>
<p>When thinking about marginal effects, though, we’re more interested in the <em>expected value</em> of the outcome, which means we’re more focused on the uncertainty in the model parameters and not necessarily the individual-level residuals (<a href="https://discourse.mc-stan.org/t/difference-between-method-fitted-vs-predict-in-marginal-effects-function/6901/3">See this post</a> or <a href="https://github.com/paul-buerkner/brms/issues/82#issuecomment-231440994">this discussion</a> for an explanation of the difference between the two types of predictions). To get these expected values, we can use <code>brms::posterior_epred()</code> (or the nicer <code>tidybayes::epred_draws()</code>), which accounts for the uncertainty of just these two things:</p>
<ul>
<li>The uncertainty of the fixed coefficients (e.g., <code>party_autonomy</code> and <code>civil_liberties</code>)</li>
<li>The uncertainty of the variance parameters of the groups (e.g., <code>sd__phi_(Intercept)</code> for each region)</li>
</ul>
<p>The averages of these draws that are generated by regular <code>posterior_predict()</code> and <code>posterior_epred()</code> should be generally the same, but the variance for <em>expected</em> values will be smaller (since we’re not dealing with individual observation-level variance).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Expected values with brms</span></span>
<span><span class="fu">posterior_epred</span><span class="op">(</span><span class="va">model_basic</span>, <span class="va">newdata</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">##       [,1]  [,2]</span></span>
<span><span class="co">## [1,] 0.677 0.413</span></span>
<span><span class="co">## [2,] 0.605 0.387</span></span>
<span><span class="co">## [3,] 0.619 0.395</span></span>
<span><span class="co">## [4,] 0.593 0.304</span></span>
<span><span class="co">## [5,] 0.697 0.389</span></span>
<span><span class="co">## [6,] 0.527 0.353</span></span>
<span></span>
<span><span class="co"># Expected values with tidybayes</span></span>
<span><span class="va">tidy_epred</span> <span class="op">&lt;-</span> <span class="va">model_basic</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">epred_draws</span><span class="op">(</span>newdata <span class="op">=</span> <span class="va">newdata</span><span class="op">)</span></span>
<span><span class="va">tidy_epred</span></span>
<span><span class="co">## # A tibble: 8,000 × 8</span></span>
<span><span class="co">## # Groups:   party_autonomy, civil_liberties, region, .row [2]</span></span>
<span><span class="co">##    party_autonomy civil_liberties region               .row .chain .iteration .draw .epred</span></span>
<span><span class="co">##    &lt;lgl&gt;                    &lt;dbl&gt; &lt;chr&gt;               &lt;int&gt;  &lt;int&gt;      &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">##  1 TRUE                       0.5 Middle East and No…     1     NA         NA     1  0.677</span></span>
<span><span class="co">##  2 TRUE                       0.5 Middle East and No…     1     NA         NA     2  0.605</span></span>
<span><span class="co">##  3 TRUE                       0.5 Middle East and No…     1     NA         NA     3  0.619</span></span>
<span><span class="co">##  4 TRUE                       0.5 Middle East and No…     1     NA         NA     4  0.593</span></span>
<span><span class="co">##  5 TRUE                       0.5 Middle East and No…     1     NA         NA     5  0.697</span></span>
<span><span class="co">##  6 TRUE                       0.5 Middle East and No…     1     NA         NA     6  0.527</span></span>
<span><span class="co">##  7 TRUE                       0.5 Middle East and No…     1     NA         NA     7  0.756</span></span>
<span><span class="co">##  8 TRUE                       0.5 Middle East and No…     1     NA         NA     8  0.659</span></span>
<span><span class="co">##  9 TRUE                       0.5 Middle East and No…     1     NA         NA     9  0.524</span></span>
<span><span class="co">## 10 TRUE                       0.5 Middle East and No…     1     NA         NA    10  0.701</span></span>
<span><span class="co">## # ℹ 7,990 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here’s what the difference in variance actually looks like:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plot_preds</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span></span>
<span>  <span class="st">"Predicted draws"</span> <span class="op">=</span> <span class="va">tidy_pred</span>,</span>
<span>  <span class="st">"Expectation of predicted draws"</span> <span class="op">=</span> <span class="fu">rename</span><span class="op">(</span><span class="va">tidy_epred</span>, .prediction <span class="op">=</span> <span class="va">.epred</span><span class="op">)</span>,</span>
<span>  .id <span class="op">=</span> <span class="st">"draw_type"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>draw_type <span class="op">=</span> <span class="fu">fct_inorder</span><span class="op">(</span><span class="va">draw_type</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_preds</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">draw_type</span>, <span class="va">party_autonomy</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">median_hdi</span><span class="op">(</span><span class="va">.prediction</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 4 × 8</span></span>
<span><span class="co">##   draw_type               party_autonomy .prediction .lower .upper .width .point .interval</span></span>
<span><span class="co">##   &lt;fct&gt;                   &lt;lgl&gt;                &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    </span></span>
<span><span class="co">## 1 Predicted draws         FALSE                0.355 0.0183  0.725   0.95 median hdi      </span></span>
<span><span class="co">## 2 Predicted draws         TRUE                 0.638 0.242   0.976   0.95 median hdi      </span></span>
<span><span class="co">## 3 Expectation of predict… FALSE                0.369 0.287   0.461   0.95 median hdi      </span></span>
<span><span class="co">## 4 Expectation of predict… TRUE                 0.622 0.532   0.707   0.95 median hdi</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">plot_preds</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.prediction</span>, fill <span class="op">=</span> <span class="va">party_autonomy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Predicted media index"</span>, y <span class="op">=</span> <span class="st">"Density"</span>, fill <span class="op">=</span> <span class="st">"Party autonomy"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">draw_type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_okabe_ito</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-pred-vs-epred-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>The median values from both types of draws are the same. When there’s no party autonomy, the median predicted media index is around 0.11; when there is party autonomy, the median predicted media index is around 0.6. But the variance is wildly different and is much narrower when looking at the expectation of predicted draws.</p>
<p>For all our marginal effects calculations here, we’re going to use <strong>expected values</strong>, or <code>epred_draws()</code>.</p>
</section></section><section id="average-marginal-effects" class="level2"><h2 class="anchored" data-anchor-id="average-marginal-effects">Average marginal effects</h2>
<p>In the plot above, we got predicted values of our outcome across different levels of party autonomy when holding civil liberties and region constant, and that’s neat, but what we’re really interested in is the <em>difference</em> between those two distributions, or the marginal effect of flipping party autonomy from false to true. How much of an increase in the predicted media index when there is party autonomy?</p>
<p>We already have all the information we need to calculate this with our <code>tidy_epred</code>. If we rearrange the dataset so that it’s wide, with a column for party autonomy being true and a column for when it’s false, we can subtract the two columns and get the difference:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tidy_epred</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">.row</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="st">"party_autonomy"</span>, values_from <span class="op">=</span> <span class="st">".epred"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>autonomy_effect <span class="op">=</span> <span class="va">`TRUE`</span> <span class="op">-</span> <span class="va">`FALSE`</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 4,000 × 8</span></span>
<span><span class="co">##    civil_liberties region           .chain .iteration .draw `TRUE` `FALSE` autonomy_effect</span></span>
<span><span class="co">##              &lt;dbl&gt; &lt;chr&gt;             &lt;int&gt;      &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;   &lt;dbl&gt;           &lt;dbl&gt;</span></span>
<span><span class="co">##  1             0.5 Middle East and…     NA         NA     1  0.677   0.413           0.265</span></span>
<span><span class="co">##  2             0.5 Middle East and…     NA         NA     2  0.605   0.387           0.218</span></span>
<span><span class="co">##  3             0.5 Middle East and…     NA         NA     3  0.619   0.395           0.224</span></span>
<span><span class="co">##  4             0.5 Middle East and…     NA         NA     4  0.593   0.304           0.290</span></span>
<span><span class="co">##  5             0.5 Middle East and…     NA         NA     5  0.697   0.389           0.308</span></span>
<span><span class="co">##  6             0.5 Middle East and…     NA         NA     6  0.527   0.353           0.174</span></span>
<span><span class="co">##  7             0.5 Middle East and…     NA         NA     7  0.756   0.500           0.256</span></span>
<span><span class="co">##  8             0.5 Middle East and…     NA         NA     8  0.659   0.454           0.205</span></span>
<span><span class="co">##  9             0.5 Middle East and…     NA         NA     9  0.524   0.294           0.230</span></span>
<span><span class="co">## 10             0.5 Middle East and…     NA         NA    10  0.701   0.424           0.276</span></span>
<span><span class="co">## # ℹ 3,990 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We could then plot that <code>autonomy_effect</code> column and see the average marginal effect of party autonomy. But that’s a lot of data wrangling and pivoting! There’s an easier way! Instead of manually working with the posterior predictions like this, we can use the <strong>emmeans</strong> package, which was designed specifically for this kind of work.</p>
<p>With <code>emmeans()</code>, we don’t have to create our own hypothetical <code>newdata</code> data frame—the function does that for us. We need to specify <code>epred = TRUE</code> to get the expectation of predicted draws, since it’ll give us predicted draws by default.</p>
<p>If we run <code>emmeans()</code> by itself, it’ll print a summary table of the predicted values:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_basic</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">emmeans</span><span class="op">(</span><span class="op">~</span> <span class="va">party_autonomy</span>,</span>
<span>          at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>civil_liberties <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                    region <span class="op">=</span> <span class="st">"Middle East and North Africa"</span><span class="op">)</span>,</span>
<span>          epred <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">##  party_autonomy emmean lower.HPD upper.HPD</span></span>
<span><span class="co">##  FALSE           0.329     0.223     0.445</span></span>
<span><span class="co">##   TRUE           0.578     0.461     0.691</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Point estimate displayed: median </span></span>
<span><span class="co">## HPD interval probability: 0.95</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also don’t need to calculate the autonomy effect by hand—the <code>constrast()</code> function will do that for us too (the <code>revpairwise</code> option here makes it so it’ll calculate <code>TRUE - FALSE</code> instead of <code>FALSE - TRUE</code>):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_basic</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">emmeans</span><span class="op">(</span><span class="op">~</span> <span class="va">party_autonomy</span>,</span>
<span>          at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>civil_liberties <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                    region <span class="op">=</span> <span class="st">"Middle East and North Africa"</span><span class="op">)</span>,</span>
<span>          epred <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">contrast</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"revpairwise"</span><span class="op">)</span></span>
<span><span class="co">##  contrast     estimate lower.HPD upper.HPD</span></span>
<span><span class="co">##  TRUE - FALSE    0.246     0.171     0.327</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Point estimate displayed: median </span></span>
<span><span class="co">## HPD interval probability: 0.95</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we store the results of <code>emmeans()</code> as an object, we actually get access to all the posterior draws that it created for the predictions, which we can then extract and rearrange with <strong>tidybayes</strong>’s <code>gather_emmeans_draws()</code>. (Without the <code>contrast()</code> step, we’d get predicted values for both levels of <code>party_autonomy</code>.)</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">autonomy_effect_draws</span> <span class="op">&lt;-</span> <span class="va">model_basic</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">emmeans</span><span class="op">(</span><span class="op">~</span> <span class="va">party_autonomy</span>,</span>
<span>          at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>civil_liberties <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                    region <span class="op">=</span> <span class="st">"Middle East and North Africa"</span><span class="op">)</span>,</span>
<span>          epred <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">contrast</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"revpairwise"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">gather_emmeans_draws</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">autonomy_effect_draws</span></span>
<span><span class="co">## # A tibble: 4,000 × 5</span></span>
<span><span class="co">## # Groups:   contrast [1]</span></span>
<span><span class="co">##    contrast     .chain .iteration .draw .value</span></span>
<span><span class="co">##    &lt;chr&gt;         &lt;int&gt;      &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">##  1 TRUE - FALSE     NA         NA     1  0.254</span></span>
<span><span class="co">##  2 TRUE - FALSE     NA         NA     2  0.217</span></span>
<span><span class="co">##  3 TRUE - FALSE     NA         NA     3  0.223</span></span>
<span><span class="co">##  4 TRUE - FALSE     NA         NA     4  0.292</span></span>
<span><span class="co">##  5 TRUE - FALSE     NA         NA     5  0.311</span></span>
<span><span class="co">##  6 TRUE - FALSE     NA         NA     6  0.169</span></span>
<span><span class="co">##  7 TRUE - FALSE     NA         NA     7  0.275</span></span>
<span><span class="co">##  8 TRUE - FALSE     NA         NA     8  0.205</span></span>
<span><span class="co">##  9 TRUE - FALSE     NA         NA     9  0.237</span></span>
<span><span class="co">## 10 TRUE - FALSE     NA         NA    10  0.270</span></span>
<span><span class="co">## # ℹ 3,990 more rows</span></span>
<span></span>
<span><span class="va">autonomy_effect_draws</span> <span class="op">%&gt;%</span> <span class="fu">median_hdi</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 7</span></span>
<span><span class="co">##   contrast     .value .lower .upper .width .point .interval</span></span>
<span><span class="co">##   &lt;chr&gt;         &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    </span></span>
<span><span class="co">## 1 TRUE - FALSE  0.246  0.171  0.327   0.95 median hdi</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">autonomy_effect_draws</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">palette_okabe_ito</span><span class="op">(</span>order <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Average marginal effect of party autonomy"</span>, y <span class="op">=</span> <span class="st">"Density"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/autonomy-effect-emmeans-contrast-draws-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>That’s so cool! There’s our marginal effect. On average, having party autonomy is associated with a 0.247 point higher media freedom index score. Since it’s measured on a 0–1 scale, that’s a pretty sizable effect!</p>
<p>Where <strong>emmeans</strong> really shines is figuring out the average marginal effect for continuous predictors. Working with party autonomy was easy enough: get the predicted value when it’s false, get the predicted value when it’s true, and find the difference. Getting a continuous effect, though, is a lot trickier since it involves slopes and first derivatives and calculus. Plus we’re working with a nonlinear model, so the slope is different across the whole range of predictions.</p>
<p>For instance, here’s the predicted media freedom index across a range of respect for civil liberties. It’s curvy! The slope is really flat down at low levels of civil liberties, and it’s steep up at high levels</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pred_civlib</span> <span class="op">&lt;-</span> <span class="va">model_basic</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">epred_draws</span><span class="op">(</span>newdata <span class="op">=</span> <span class="fu">expand_grid</span><span class="op">(</span>party_autonomy <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                    region <span class="op">=</span> <span class="st">"Middle East and North Africa"</span>,</span>
<span>                                    civil_liberties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">pred_civlib</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">civil_liberties</span>, y <span class="op">=</span> <span class="va">.epred</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_lineribbon</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_fill_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Reds"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Civil liberties index"</span>, y <span class="op">=</span> <span class="st">"Predicted media freedom index"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Credible interval"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/civlib-effect-plot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>The <code>emtrends()</code> function from <strong>emmeans</strong> lets us find the slope at different hypothetical values. (Technically behind the scenes, if we tell it to show us the slope when <code>civil_liberties</code> is 0.5, it’ll calculate the predicted value at 0.5 and the predicted value at 0.50001, and then average those predictions, rather than try to figure out the true calculus-based derivative).</p>
<p>If we don’t specify possible values of <code>civil_liberties</code>, it will give us the slope at the average value of <code>civil_liberties</code> (0.698):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_basic</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">emtrends</span><span class="op">(</span><span class="op">~</span> <span class="va">civil_liberties</span>,</span>
<span>           var <span class="op">=</span> <span class="st">"civil_liberties"</span>,</span>
<span>           at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>party_autonomy <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                     region <span class="op">=</span> <span class="st">"Middle East and North Africa"</span><span class="op">)</span>,</span>
<span>           epred <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">##  civil_liberties civil_liberties.trend lower.HPD upper.HPD</span></span>
<span><span class="co">##            0.696                 0.865     0.702      1.03</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Point estimate displayed: median </span></span>
<span><span class="co">## HPD interval probability: 0.95</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we use <code>~ 1</code> in the formula instead of <code>~ civil_liberties</code>, it will give us the average overall slope:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_basic</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">emtrends</span><span class="op">(</span><span class="op">~</span> <span class="fl">1</span>,</span>
<span>           var <span class="op">=</span> <span class="st">"civil_liberties"</span>,</span>
<span>           at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>party_autonomy <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                     region <span class="op">=</span> <span class="st">"Middle East and North Africa"</span><span class="op">)</span>,</span>
<span>           epred <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">##  1       civil_liberties.trend lower.HPD upper.HPD</span></span>
<span><span class="co">##  overall                 0.865     0.702      1.03</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Point estimate displayed: median </span></span>
<span><span class="co">## HPD interval probability: 0.95</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Or we can specify specific values of <code>civil_liberties</code> to get the slope at those points:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_basic</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">emtrends</span><span class="op">(</span><span class="op">~</span> <span class="va">civil_liberties</span>,</span>
<span>           var <span class="op">=</span> <span class="st">"civil_liberties"</span>,</span>
<span>           at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>party_autonomy <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                     region <span class="op">=</span> <span class="st">"Middle East and North Africa"</span>,</span>
<span>                     civil_liberties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           epred <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">##  civil_liberties civil_liberties.trend lower.HPD upper.HPD</span></span>
<span><span class="co">##              0.2                 0.436     0.295     0.607</span></span>
<span><span class="co">##              0.5                 0.767     0.577     0.951</span></span>
<span><span class="co">##              0.8                 0.838     0.695     0.982</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Point estimate displayed: median </span></span>
<span><span class="co">## HPD interval probability: 0.95</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The civil liberties effect varies a lot depending on existing levels of civil liberties! Let’s visualize these three effects. We’ll scale the effect down, though, since civil liberties is on a 0–1 scale and a 1-unit change means going from 0 to 1, which is huge. We’ll think about this as a 0.1-point increase in the civil liberties scale.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ame_civlib</span> <span class="op">&lt;-</span> <span class="va">model_basic</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">emtrends</span><span class="op">(</span><span class="op">~</span> <span class="va">civil_liberties</span>,</span>
<span>           var <span class="op">=</span> <span class="st">"civil_liberties"</span>,</span>
<span>           at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>party_autonomy <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                     region <span class="op">=</span> <span class="st">"Middle East and North Africa"</span>,</span>
<span>                     civil_liberties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           epred <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">gather_emmeans_draws</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># Scale this down</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>.value <span class="op">=</span> <span class="va">.value</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">ame_civlib</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.value</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">civil_liberties</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span>slab_alpha <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_okabe_ito</span><span class="op">(</span>order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Average marginal effect of a\n0.1-point increase in the civil liberties index"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Density"</span>, fill <span class="op">=</span> <span class="st">"Civil liberties index"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"80% and 95% credible intervals shown in black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-civlib-effect-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>For countries with low levels of civil liberties, a 0.1-point increase in respect for civil liberties (e.g., moving from 0.2 to 0.3) is associated with a 0.0436-point increase in the media freedom index. For a middle ground country, though, moving from 0.5 to 0.6 in civil liberties is associated with a 0.0763-point increase in the media freedom index, while countries with strong civil liberties see a strong increase in the media freedom index (0.0833 points). Cool cool cool.</p>
</section><section id="different-kinds-of-average-predictions-with-multilevel-models" class="level2"><h2 class="anchored" data-anchor-id="different-kinds-of-average-predictions-with-multilevel-models">Different kinds of average predictions with multilevel models</h2>
<p><strong>BUT THERE’S A HUGE CAVEAT HERE!</strong></p>
<p>Guess what?! All these predicted average effects aren’t quite what we think they are. (That’s what TJ was referring to in the tweet at the beginning of this post!)</p>
<p>Because we’re working with multilevel models, we actually have other moving parts to think about: the regional effects. When we talk about average marginal effects with multilevel models, we have to be explicit about what kinds of averages we’re working with. There are a few different kinds of averages we can calculate:</p>
<ul>
<li>Global grand mean</li>
<li>Conditional effects for existing groups</li>
<li>Conditional effects for a single hypothetical group, either typical or brand new</li>
</ul>
<p>We can specify all these different kinds of calculations with certain combinations of a few arguments to <code>posterior_epred()</code> / <code>epred_draws()</code> / <code>emmeans()</code> / <code>emmtrends()</code>:</p>
<ul>
<li>
<code>newdata</code>: Specify which regions to include in the predictions</li>
<li>
<code>re_formula</code>: Specify how (and whether) to handle the model’s random effects in the predictions</li>
<li>
<code>sample_new_levels</code>: Specify how to handle the uncertainty in new random effects in the predictions</li>
</ul>
<p>(These are all documented in the help pages for <code>?brms::prepare_predictions()</code>)</p>
<section id="global-grand-mean" class="level3"><h3 class="anchored" data-anchor-id="global-grand-mean">Global grand mean</h3>
<p>With a global grand mean, we calculate the expected value of the media freedom index <strong>while ignoring any region-specific deviations of the intercept or slope.</strong> We do not incorporate any of the region-specific information from the model into the predictions. This provides us with a global grand mean—an average that transcends regional differences.</p>
<p>To calculate this, we need to feed <strong>brms</strong> a new dataset that doesn’t include any region, and we need to tell it to not use any random effects by including <code>re_formula = NA</code>.</p>
<section id="binary-effect" class="level4"><h4 class="anchored" data-anchor-id="binary-effect">Binary effect</h4>
<p>Let’s look at the global average marginal effect for party autonomy, which is binary:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Posterior predictions across autonomy</span></span>
<span><span class="va">grand_mean_autonomy_dist</span> <span class="op">&lt;-</span> <span class="va">model_basic</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">epred_draws</span><span class="op">(</span>newdata <span class="op">=</span> <span class="fu">expand_grid</span><span class="op">(</span>party_autonomy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>                                    civil_liberties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>, </span>
<span>              re_formula <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_grand_mean_autonomy</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">grand_mean_autonomy_dist</span>, </span>
<span>                                   <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.epred</span>, y <span class="op">=</span> <span class="st">"Grand mean"</span>, </span>
<span>                                       fill <span class="op">=</span> <span class="va">party_autonomy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_okabe_ito</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Predicted media index"</span>, y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Opposition parties allowed"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Posterior predictions"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># emmeans()-based difference across autonomy</span></span>
<span><span class="va">grand_mean_autonomy_ame</span> <span class="op">&lt;-</span> <span class="va">model_basic</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">emmeans</span><span class="op">(</span><span class="op">~</span> <span class="va">party_autonomy</span>,</span>
<span>          at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>civil_liberties <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>          epred <span class="op">=</span> <span class="cn">TRUE</span>, re_formula <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">contrast</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"revpairwise"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">gather_emmeans_draws</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_grand_mean_autonomy_ame</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">grand_mean_autonomy_ame</span>, </span>
<span>                                   <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.value</span>, y <span class="op">=</span> <span class="st">"Grand AME"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">palette_okabe_ito</span><span class="op">(</span>order <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Average marginal effect of party autonomy"</span>, y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Marginal effect (TRUE − FALSE)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combined plot</span></span>
<span><span class="op">(</span><span class="va">plot_grand_mean_autonomy</span> <span class="op">|</span> <span class="va">plot_grand_mean_autonomy_ame</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">plot_annotation</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Global grand mean"</span>,</span>
<span>                  subtitle <span class="op">=</span> <span class="st">"re_formula = NA; no region in newdata"</span>,</span>
<span>                  theme <span class="op">=</span> <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-grand-mean-binary-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>And here are the actual medians and credible intervals:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">grand_mean_autonomy_ame</span> <span class="op">%&gt;%</span> <span class="fu">median_hdi</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 7</span></span>
<span><span class="co">##   contrast     .value .lower .upper .width .point .interval</span></span>
<span><span class="co">##   &lt;chr&gt;         &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    </span></span>
<span><span class="co">## 1 TRUE - FALSE  0.246  0.171  0.327   0.95 median hdi</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The region-free grand average marginal effect for party autonomy is thus 0.247.</p>
</section><section id="continuous-effect" class="level4"><h4 class="anchored" data-anchor-id="continuous-effect">Continuous effect</h4>
<p>Next we can look at the average marginal effect for civil liberties, which is continuous:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Posterior predictions across civil_liberties</span></span>
<span><span class="va">grand_mean_civlib_dist</span> <span class="op">&lt;-</span> <span class="va">model_basic</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">epred_draws</span><span class="op">(</span>newdata <span class="op">=</span> <span class="fu">expand_grid</span><span class="op">(</span>party_autonomy <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                    civil_liberties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span>, </span>
<span>              re_formula <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_grand_mean_civlib</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">grand_mean_civlib_dist</span>, </span>
<span>                                 <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">civil_liberties</span>, y <span class="op">=</span> <span class="va">.epred</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_lineribbon</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Reds"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Civil liberties index"</span>, y <span class="op">=</span> <span class="st">"Predicted media freedom index"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Credible interval"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># emtrends()-based AMEs</span></span>
<span><span class="va">grand_mean_civlib_ame</span> <span class="op">&lt;-</span> <span class="va">model_basic</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">emtrends</span><span class="op">(</span><span class="op">~</span> <span class="va">civil_liberties</span>,</span>
<span>           var <span class="op">=</span> <span class="st">"civil_liberties"</span>,</span>
<span>           at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>party_autonomy <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                     civil_liberties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           epred <span class="op">=</span> <span class="cn">TRUE</span>, re_formula <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">gather_emmeans_draws</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_grand_mean_civlib_ame</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">grand_mean_civlib_ame</span>,</span>
<span>                                     <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.value</span> <span class="op">/</span> <span class="fl">10</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">civil_liberties</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span>slab_alpha <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_okabe_ito</span><span class="op">(</span>order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Average marginal effect of a\n0.1-point increase in the civil liberties index"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Density"</span>, fill <span class="op">=</span> <span class="st">"Civil liberties index"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combined plot</span></span>
<span><span class="op">(</span><span class="va">plot_grand_mean_civlib</span> <span class="op">|</span> <span class="va">plot_grand_mean_civlib_ame</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">plot_annotation</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Grand mean"</span>,</span>
<span>                  subtitle <span class="op">=</span> <span class="st">"re_formula = NA; no region in newdata"</span>,</span>
<span>                  theme <span class="op">=</span> <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-grand-mean-continuous-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>And here are the actual medians for these effects:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">grand_mean_civlib_ame</span> <span class="op">%&gt;%</span> <span class="fu">median_hdi</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 2 × 7</span></span>
<span><span class="co">##   civil_liberties .value .lower .upper .width .point .interval</span></span>
<span><span class="co">##             &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    </span></span>
<span><span class="co">## 1             0.2  0.436  0.295  0.607   0.95 median hdi      </span></span>
<span><span class="co">## 2             0.8  0.838  0.695  0.982   0.95 median hdi</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The region-free grand average marginal effect for civil liberties is 0.436 for low values of civil liberties (0.2), and 0.833 for high values (0.8).</p>
</section></section><section id="conditional-effects-for-existing-groups" class="level3"><h3 class="anchored" data-anchor-id="conditional-effects-for-existing-groups">Conditional effects for existing groups</h3>
<p>Instead of calculating a grand mean without any group information, we can incorporate regional effects into our predictions. We can create <strong>conditional effects for specific regions that already exist in the data, incorporating their region-specific deviations in slope and intercept.</strong></p>
<p>To calculate this, we need to feed <strong>brms</strong> a new dataset that <em>does</em> include one or more regions that are already in the data, and we need to tell it to incorporate the random effects into its predictions by including <code>re_formula = NULL</code>. That feels weird, since <code>re_formula = NA</code> made it so there were no group effects, but that’s the syntax.</p>
<p>We can also be more explicit about which group effects to include. When using <code>re_formula = NULL</code>, <em>all</em> group effects are included. If we made a model with both region and year effects, for instance, and only wanted to predict using the region effects, we could use <code>re_formula = ~ (1 | region)</code>. Or if we don’t want to remember that <code>NULL</code> means “everything”, we could also just use <code>re_formula = ~ (1 | region)</code> on our basic model with just regional effects. It’s all the same.</p>
<section id="binary-effect-1" class="level4"><h4 class="anchored" data-anchor-id="binary-effect-1">Binary effect</h4>
<p>Let’s look at the binary region-specific average marginal effect for party autonomy across all six regions:</p>
<div class="cell" data-layout-align="center" data-fig.asp="0.7">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Posterior predictions across autonomy and region</span></span>
<span><span class="va">all_regions_autonomy_dist</span> <span class="op">&lt;-</span> <span class="va">model_basic</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">epred_draws</span><span class="op">(</span>newdata <span class="op">=</span> <span class="fu">expand_grid</span><span class="op">(</span>party_autonomy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>                                    region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">vdem_2015</span><span class="op">$</span><span class="va">region</span><span class="op">)</span>,</span>
<span>                                    civil_liberties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>, </span>
<span>              re_formula <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>  <span class="co"># or re_formula = ~ (1 | region)</span></span>
<span></span>
<span><span class="va">plot_all_regions_autonomy</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">all_regions_autonomy_dist</span>, </span>
<span>                                    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.epred</span>, y <span class="op">=</span> <span class="va">region</span>, </span>
<span>                                        fill <span class="op">=</span> <span class="va">party_autonomy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_okabe_ito</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Predicted media index"</span>, y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Opposition parties allowed"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Posterior predictions"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># emmeans()-based difference across autonomy, by region</span></span>
<span><span class="va">all_regions_autonomy_ame</span> <span class="op">&lt;-</span> <span class="va">model_basic</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">emmeans</span><span class="op">(</span><span class="op">~</span> <span class="va">party_autonomy</span> <span class="op">+</span> <span class="va">region</span>,</span>
<span>          at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>civil_liberties <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                    region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">vdem_2015</span><span class="op">$</span><span class="va">region</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          epred <span class="op">=</span> <span class="cn">TRUE</span>, re_formula <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">contrast</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"revpairwise"</span>, by <span class="op">=</span> <span class="st">"region"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">gather_emmeans_draws</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_all_regions_autonomy_ame</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">all_regions_autonomy_ame</span>, </span>
<span>                                        <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.value</span>, y <span class="op">=</span> <span class="va">region</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">palette_okabe_ito</span><span class="op">(</span>order <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Average marginal effect of party autonomy"</span>, y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Marginal effect (TRUE − FALSE)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combined plot</span></span>
<span><span class="op">(</span><span class="va">plot_all_regions_autonomy</span> <span class="op">|</span> <span class="va">plot_all_regions_autonomy_ame</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">plot_annotation</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Region-specific means"</span>,</span>
<span>                  subtitle <span class="op">=</span> <span class="st">"re_formula = NULL; existing region(s) included in newdata"</span>,</span>
<span>                  theme <span class="op">=</span> <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-all-regions-binary-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>And here are the actual medians and credible intervals:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">all_regions_autonomy_ame</span> <span class="op">%&gt;%</span> <span class="fu">median_hdi</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 6 × 8</span></span>
<span><span class="co">##   contrast     region                         .value .lower .upper .width .point .interval</span></span>
<span><span class="co">##   &lt;fct&gt;        &lt;fct&gt;                           &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    </span></span>
<span><span class="co">## 1 TRUE - FALSE Eastern Europe and Central As…  0.231  0.155  0.303   0.95 median hdi      </span></span>
<span><span class="co">## 2 TRUE - FALSE Latin America and the Caribbe…  0.241  0.161  0.314   0.95 median hdi      </span></span>
<span><span class="co">## 3 TRUE - FALSE Middle East and North Africa    0.250  0.172  0.330   0.95 median hdi      </span></span>
<span><span class="co">## 4 TRUE - FALSE Sub-Saharan Africa              0.250  0.173  0.330   0.95 median hdi      </span></span>
<span><span class="co">## 5 TRUE - FALSE Western Europe and North Amer…  0.243  0.162  0.320   0.95 median hdi      </span></span>
<span><span class="co">## 6 TRUE - FALSE Asia and Pacific                0.239  0.166  0.314   0.95 median hdi</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The average marginal effect changes depending on region, but not by much. Across all regions, having party autonomy is associated with a 0.24 to 0.25-point increase in the media freedom index, on average. Importantly, these average effects incorporate the uncertainty that comes from the regional multilevel structure that we built in the model.</p>
</section><section id="continuous-effect-1" class="level4"><h4 class="anchored" data-anchor-id="continuous-effect-1">Continuous effect</h4>
<p>Next we’ll look at the continuous region-specific average marginal effect for civil liberties across all six regions:</p>
<div class="cell" data-layout-align="center" data-fig.asp="1.3">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Posterior predictions across civil_liberties and regions</span></span>
<span><span class="va">all_regions_civlib_dist</span> <span class="op">&lt;-</span> <span class="va">model_basic</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">epred_draws</span><span class="op">(</span>newdata <span class="op">=</span> <span class="fu">expand_grid</span><span class="op">(</span>party_autonomy <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                    civil_liberties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>                                    region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">vdem_2015</span><span class="op">$</span><span class="va">region</span><span class="op">)</span><span class="op">)</span>, </span>
<span>              re_formula <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_all_regions_civlib</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">all_regions_civlib_dist</span>, </span>
<span>                                  <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">civil_liberties</span>, y <span class="op">=</span> <span class="va">.epred</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_lineribbon</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Reds"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Civil liberties index"</span>, y <span class="op">=</span> <span class="st">"Predicted media freedom index"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Credible interval"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">region</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># emtrends()-based AMEs across region</span></span>
<span><span class="va">all_regions_civlib_ame</span> <span class="op">&lt;-</span> <span class="va">model_basic</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">emtrends</span><span class="op">(</span><span class="op">~</span> <span class="va">civil_liberties</span> <span class="op">+</span> <span class="va">region</span>,</span>
<span>           var <span class="op">=</span> <span class="st">"civil_liberties"</span>,</span>
<span>           at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>party_autonomy <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                     civil_liberties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.8</span><span class="op">)</span>,</span>
<span>                     region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">vdem_2015</span><span class="op">$</span><span class="va">region</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           epred <span class="op">=</span> <span class="cn">TRUE</span>, re_formula <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">gather_emmeans_draws</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_all_regions_civlib_ame</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">all_regions_civlib_ame</span>,</span>
<span>                                     <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.value</span> <span class="op">/</span> <span class="fl">10</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">civil_liberties</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span>slab_alpha <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_okabe_ito</span><span class="op">(</span>order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Average marginal effect of a\n0.1-point increase in the civil liberties index"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Density"</span>, fill <span class="op">=</span> <span class="st">"Civil liberties index"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">region</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">plot_all_regions_civlib</span> <span class="op">/</span> <span class="va">plot_all_regions_civlib_ame</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">plot_annotation</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Region-specific means"</span>,</span>
<span>                  subtitle <span class="op">=</span> <span class="st">"re_formula = NULL; existing region(s) included in newdata"</span>,</span>
<span>                  theme <span class="op">=</span> <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-all-regions-continuous-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>And here are the actual medians for these effects:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">all_regions_civlib_ame</span> <span class="op">%&gt;%</span> <span class="fu">median_hdi</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 12 × 8</span></span>
<span><span class="co">##    civil_liberties region                     .value .lower .upper .width .point .interval</span></span>
<span><span class="co">##              &lt;dbl&gt; &lt;fct&gt;                       &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    </span></span>
<span><span class="co">##  1             0.2 Eastern Europe and Centra…  0.327  0.246  0.418   0.95 median hdi      </span></span>
<span><span class="co">##  2             0.2 Latin America and the Car…  0.380  0.290  0.475   0.95 median hdi      </span></span>
<span><span class="co">##  3             0.2 Middle East and North Afr…  0.492  0.377  0.638   0.95 median hdi      </span></span>
<span><span class="co">##  4             0.2 Sub-Saharan Africa          0.479  0.373  0.590   0.95 median hdi      </span></span>
<span><span class="co">##  5             0.2 Western Europe and North …  0.609  0.469  0.729   0.95 median hdi      </span></span>
<span><span class="co">##  6             0.2 Asia and Pacific            0.366  0.267  0.479   0.95 median hdi      </span></span>
<span><span class="co">##  7             0.8 Eastern Europe and Centra…  0.871  0.709  1.02    0.95 median hdi      </span></span>
<span><span class="co">##  8             0.8 Latin America and the Car…  0.865  0.725  1.01    0.95 median hdi      </span></span>
<span><span class="co">##  9             0.8 Middle East and North Afr…  0.808  0.687  0.924   0.95 median hdi      </span></span>
<span><span class="co">## 10             0.8 Sub-Saharan Africa          0.819  0.708  0.926   0.95 median hdi      </span></span>
<span><span class="co">## 11             0.8 Western Europe and North …  0.724  0.585  0.885   0.95 median hdi      </span></span>
<span><span class="co">## 12             0.8 Asia and Pacific            0.865  0.712  1.00    0.95 median hdi</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As expected, the average marginal effect for civil liberties varies across regions. For the Middle East and North Africa, for instance, it is 0.49 for low values of civil liberties (0.2), and 0.8 for high values (0.8), while in Eastern Europe and Central Asia, it is 0.328 for low values and 0.865 for high values.</p>
<p>Neat!</p>
</section></section><section id="conditional-effects-for-a-single-new-hypothetical-group-either-typical-or-brand-new" class="level3"><h3 class="anchored" data-anchor-id="conditional-effects-for-a-single-new-hypothetical-group-either-typical-or-brand-new">Conditional effects for a single new hypothetical group, either typical or brand new</h3>
<p>So far we’ve calculated a grand mean with no regional effects and a bunch of conditional means for specific regions. But what if we want a single mean that also includes regional effects?</p>
<p>We have a few really nuanced options for doing this. In general, we’ll create a brand new hypothetical region and make predictions based on it. Where the nuance comes into play is how we construct this region and think about its variation. We can build its variance based on an average of the existing regions’ variances, or we can simulate a brand new kind of variance all together.</p>
<p>To do this, we need to include region in the new data we feed <strong>brms</strong>, but we need to include a name of a region that doesn’t exist (or alternatively, you can feed it <code>region = NA</code>). It will yell at you initially because that group doesn’t exist, but you can allow it to make these extrapolated predictions by including <code>allow_new_levels = TRUE</code>. We can include the random effects for region by setting <code>re_formula = NULL</code> (or <code>re_formula = ~ (1 | region)</code> if we want to be super explicit).</p>
<p>Finally, we have to specify how to handle the regional variation for this imaginary new group. We can either draw from the variation in all the other groups by setting <code>sample_new_levels = "uncertainty"</code> (this is the default), or we can randomly simulate a whole new kind of regional uncertainty based on the model’s existing parameters using <code>sample_new_levels = "gaussian"</code>. The documentation for all this is included in <code>?brms::prepare_predictions</code>.</p>
<p>In summary, we have these two general approaches:</p>
<ol type="1">
<li>Create a hypothetical region that is based on the observed variation in the existing regions with <code>region = "Something new"</code> in the new data and <code>re_formula = NULL, allow_new_levels = TRUE, sample_new_levels = "uncertainty"</code> in the prediction function</li>
<li>Create a hypothetical region that is completely brand new with <code>region = "Something new"</code> in the new data and <code>re_formula = NULL, allow_new_levels = TRUE, sample_new_levels = "gaussian"</code> in the prediction function</li>
</ol>
<p>For the sake of space I’ll only show marginal effects for the binary <code>party_autonomy</code> variable here. Follow the same process as all the examples above, but set <code>re_formula = NULL</code>, <code>allow_new_levels = TRUE</code>, and either <code>sample_new_levels = "uncertainty"</code> or <code>sample_new_levels = "gaussian"</code> when making the predictions.</p>
<p>Technically there are other ways to create simulated groups or regions, like <code>sample_new_levels = "old_levels"</code>. Isabella Ghement has a <a href="https://twitter.com/isabellaghement/status/1458539033131302913">great comprehensive table summarizing them all here</a>. But we’re not going to worry about that here.</p>
<section id="binary-effect-for-amalgamated-hypothetical-region" class="level4"><h4 class="anchored" data-anchor-id="binary-effect-for-amalgamated-hypothetical-region">Binary effect for amalgamated hypothetical region</h4>
<p>First we’ll create predictions for a hypothetical region that draws its group characteristics and variance from all the other regions in the data. To do this, we include <code>region = "Something new"</code> in the new data and <code>re_formula = NULL, allow_new_levels = TRUE, sample_new_levels = "uncertainty"</code> in the prediction function.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ame_hypothetical_amalgamated</span> <span class="op">&lt;-</span> <span class="va">model_basic</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">emmeans</span><span class="op">(</span><span class="op">~</span> <span class="va">party_autonomy</span> <span class="op">+</span> <span class="va">region</span>,</span>
<span>          at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>civil_liberties <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>                    region <span class="op">=</span> <span class="st">"Generic world region"</span><span class="op">)</span>,</span>
<span>          epred <span class="op">=</span> <span class="cn">TRUE</span>, re_formula <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>          allow_new_levels <span class="op">=</span> <span class="cn">TRUE</span>, sample_new_levels <span class="op">=</span> <span class="st">"uncertainty"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">contrast</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"revpairwise"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">gather_emmeans_draws</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ame_hypothetical_amalgamated</span> <span class="op">%&gt;%</span> <span class="fu">median_hdi</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 7</span></span>
<span><span class="co">##   contrast                                    .value .lower .upper .width .point .interval</span></span>
<span><span class="co">##   &lt;chr&gt;                                        &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    </span></span>
<span><span class="co">## 1 TRUE Generic world region - FALSE Generic …  0.243  0.164  0.320   0.95 median hdi</span></span>
<span></span>
<span><span class="va">plot_ame_hypothetical_amalgamated</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">ame_hypothetical_amalgamated</span>, </span>
<span>                                            <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.value</span>, y <span class="op">=</span> <span class="st">"Generic world region"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">palette_okabe_ito</span><span class="op">(</span>order <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Average marginal effect of party autonomy"</span>, y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Marginal effect in a generic world region"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span><span class="va">plot_ame_hypothetical_amalgamated</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-ame-generic-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>In this case, the distribution is pretty smooth and normal looking, but if there’s a lot of variation in regional distributions, that variation will transfer to these predictions too.</p>
<p>For instance, in an earlier working version of this post, I had region-specific average predictions that varied substantially across regions. The resulting new hypothetical region reflected those different components—because the new generic world region is an amalgamation of uncertainty of all the existing regions, it includes both high values and low values (<a href="https://twitter.com/tjmahr/status/1458443667748818955">thanks to TJ Mahr for this insight!</a>):</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="tj-annotation.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section><section id="binary-effect-for-completely-new-hypothetical-region" class="level4"><h4 class="anchored" data-anchor-id="binary-effect-for-completely-new-hypothetical-region">Binary effect for completely new hypothetical region</h4>
<p>Alternatively, we can make it so that the new fake region uses a multivariate normal distribution implied by the model’s group-level standard deviations and correlations. This creates a brand new region that would be plausible in the universe, but that is not sampled directly from the existing regions. As a result, there’s no possibility of a weird bimodal blip—the overall shape of the distribution will be much smoother and consistent.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ame_hypothetical_new</span> <span class="op">&lt;-</span> <span class="va">model_basic</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">emmeans</span><span class="op">(</span><span class="op">~</span> <span class="va">party_autonomy</span> <span class="op">+</span> <span class="va">region</span>,</span>
<span>          at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>civil_liberties <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>                    region <span class="op">=</span> <span class="st">"Atlantis"</span><span class="op">)</span>,</span>
<span>          epred <span class="op">=</span> <span class="cn">TRUE</span>, re_formula <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>          allow_new_levels <span class="op">=</span> <span class="cn">TRUE</span>, sample_new_levels <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">contrast</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"revpairwise"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">gather_emmeans_draws</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ame_hypothetical_new</span> <span class="op">%&gt;%</span> <span class="fu">median_hdi</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 7</span></span>
<span><span class="co">##   contrast                       .value .lower .upper .width .point .interval</span></span>
<span><span class="co">##   &lt;chr&gt;                           &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    </span></span>
<span><span class="co">## 1 TRUE Atlantis - FALSE Atlantis  0.235  0.141  0.325   0.95 median hdi</span></span>
<span></span>
<span><span class="va">plot_ame_hypothetical_new</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">ame_hypothetical_new</span>, </span>
<span>                                            <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.value</span>, y <span class="op">=</span> <span class="st">"Atlantis"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">palette_okabe_ito</span><span class="op">(</span>order <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Average marginal effect of party autonomy"</span>, y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Marginal effect in the Atlantis region"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span><span class="va">plot_ame_hypothetical_new</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-ame-atlantis-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
</section></section></section><section id="which-average-is-best" class="level2"><h2 class="anchored" data-anchor-id="which-average-is-best">Which average is best?</h2>
<p>You’ve run a great multilevel model and want to report the average marginal effects for your coefficients of interest. Which average do you report? The global grand mean? Means conditional on existing groups? The mean of a new typical-ish looking region? The mean of a completely brand new region?</p>
<p>Who knows!</p>
<p>It all depends on the story you’re trying to tell about your data, theory, and results.</p>
</section><section id="overall-summary-of-different-approaches" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="overall-summary-of-different-approaches">Overall summary of different approaches</h2>
<p>Phew. We did a lot here with a ton of really neat moving parts. Here’s a summary of all the different average effects you can calculate with multilevel models and how to do them:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="cell-output-display column-page-inset-right">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Type of average</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Description</th>
<th style="text-align: left;" data-quarto-table-cell-role="th"><code>newdata</code></th>
<th style="text-align: left;" data-quarto-table-cell-role="th"><code>re_formula</code></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Other options</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Global grand mean</td>
<td style="text-align: left;">Average predicted outcome ignoring group-specific deviations in intercept or slope</td>
<td style="text-align: left;">Omit group from <code>newdata</code>
</td>
<td style="text-align: left;"><code>re_formula = NA</code></td>
<td style="text-align: left;">—</td>
</tr>
<tr class="even">
<td style="text-align: left;">Conditional effects for existing groups</td>
<td style="text-align: left;">Average predicted outcomes for existing groups, incorporating group-specific deviations in intercept or slope</td>
<td style="text-align: left;">Include existing group(s) in <code>newdata</code>
</td>
<td style="text-align: left;">
<code>re_formula = NULL</code> or actual group term, like <code>re_formula = ~ (1 | group)</code>
</td>
<td style="text-align: left;">—</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Conditional effects for a single typical hypothetical group</td>
<td style="text-align: left;">Average predicted outcome for a new group that is based on variation of existing groups</td>
<td style="text-align: left;">Include new group in <code>newdata</code>
</td>
<td style="text-align: left;">
<code>re_formula = NULL</code> or actual group term, like <code>re_formula = ~ (1 | group)</code>
</td>
<td style="text-align: left;">
<code>allow_new_levels = TRUE,</code><br><code>sample_new_levels = "uncertainty"</code>
</td>
</tr>
<tr class="even">
<td style="text-align: left;">Conditional effects for a single brand new hypothetical group</td>
<td style="text-align: left;">Average predicted outcome for a new group that is based on random draws from model</td>
<td style="text-align: left;">Include new group in <code>newdata</code>
</td>
<td style="text-align: left;">
<code>re_formula = NULL</code> or actual group term, like <code>re_formula = ~ (1 | group)</code>
</td>
<td style="text-align: left;">
<code>allow_new_levels = TRUE,</code><br><code>sample_new_levels = "gaussian"</code>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>&nbsp;</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="cell-output-display column-page-inset-right">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Type of average</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Generic code</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Global grand mean</td>
<td style="text-align: left;"><pre><code>posterior_epred(model,
                newdata = __OMIT GROUP__,
                re_formula = NA)</code></pre></td>
</tr>
<tr class="even">
<td style="text-align: left;">Conditional effects for existing groups</td>
<td style="text-align: left;"><pre><code>posterior_epred(model,
                newdata = __INCLUDE EXISTING GROUP(S)__,
                re_formula = NULL)</code></pre></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Conditional effects for a single typical hypothetical group</td>
<td style="text-align: left;"><pre><code>posterior_epred(model,
                newdata = __INCLUDE NEW GROUP__,
                re_formula = NULL, allow_new_levels = TRUE,
                sample_new_levels = "uncertainty")</code></pre></td>
</tr>
<tr class="even">
<td style="text-align: left;">Conditional effects for a single brand new hypothetical group</td>
<td style="text-align: left;"><pre><code>posterior_epred(model,
                newdata = __INCLUDE NEW GROUP__,
                re_formula = NULL, allow_new_levels = TRUE,
                sample_new_levels = "gaussian")</code></pre></td>
</tr>
</tbody>
</table>
</div>
</div>
<p>And here’s what they all look like!</p>
<div class="cell page-columns page-full" data-layout-align="center" data-fig.asp="{}">
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p class="page-columns page-full"><img src="index_files/figure-html/all-effects-combined-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-page-inset-right" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>


<!-- -->

</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{heiss2021,
  author = {Heiss, Andrew},
  title = {A Guide to Correctly Calculating Posterior Predictions and
    Average Marginal Effects with Multilievel {Bayesian} Models},
  date = {2021-11-10},
  url = {https://www.andrewheiss.com/blog/2021/11/10/ame-bayes-re-guide/},
  doi = {10.59350/wbn93-edb02},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-heiss2021" class="csl-entry quarto-appendix-citeas" role="listitem">
Heiss, Andrew. 2021. <span>“A Guide to Correctly Calculating Posterior
Predictions and Average Marginal Effects with Multilievel Bayesian
Models.”</span> November 10, 2021. <a href="https://doi.org/10.59350/wbn93-edb02">https://doi.org/10.59350/wbn93-edb02</a>.
</div></div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.andrewheiss\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><script src="https://giscus.app/client.js" data-repo="andrewheiss/ath-quarto" data-repo-id="R_kgDOIg6EJQ" data-category="Blog comments" data-category-id="DIC_kwDOIg6EJc4CSz92" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><input type="hidden" id="giscus-base-theme" value="light"><input type="hidden" id="giscus-alt-theme" value="dark"><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb34" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "A guide to correctly calculating posterior predictions and average marginal effects with multilievel Bayesian models"</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2021-11-10</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "How to calculate grand means, conditional group means, and hypothetical group means of posterior predictions from multilevel brms models."</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> index_files/figure-html/all-effects-combined-1.png</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co">  - r</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - tidyverse</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co">  - regression</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - statistics</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="co">  - data visualization</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="co">  - bayes</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co">  - brms</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="co">  - stan</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="co">  - beta</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 4</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="an">doi:</span><span class="co"> 10.59350/wbn93-edb02</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="an">citation:</span><span class="co"> true</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(fig.align = "center", fig.retina = 3,</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a><span class="in">                      fig.width = 6, fig.height = (6 * 0.618),</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a><span class="in">                      out.width = "90%", collapse = TRUE)</span></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a><span class="in">options(digits = 3, width = 90)</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">At the end</span><span class="co">](https://www.andrewheiss.com/blog/2021/11/08/beta-regression-guide/#super-fancy-detailed-model-with-lots-of-moving-parts-just-for-fun)</span> of my <span class="co">[</span><span class="ot">previous post on beta and zero-inflated-beta regression</span><span class="co">](https://www.andrewheiss.com/blog/2021/11/08/beta-regression-guide/)</span>, I included an example of a multilevel model that predicted the proportion of women members of parliament based on whether a country implements gender-based quotas for their legislatures, along with a few different control variables. I also included random effects for year and region in order to capture time- and geography-specific trends. When interpreting the results, I naively said that calculating posterior predictions from the model (i.e. plugging arbitrary values into the model and finding the predicted value of the outcome) magically and automatically includes information about year and region (or the random effects included in the model). But I was wrong-ish! Incorporating information about the random effects of a multilevel model is actually a lot more involved and detailed than I thought, and the nuances are really important and make a big difference!</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>As <span class="co">[</span><span class="ot">TJ Mahr recently tweeted</span><span class="co">](https://twitter.com/tjmahr/status/1450486103497187328?s=21)</span>, this is hard stuff!</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tj-tweet, echo=FALSE, out.width="90%"}</span></span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("tj-tweet.png")</span></span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>Fortunately, over the past couple days I've been part of several really long Twitter threads (with people who know waaaay more about this than me!) about different ways of incorporating group-level effects into posterior predictions. HUGE THANKS to <span class="co">[</span><span class="ot">Isabella Ghement</span><span class="co">](https://twitter.com/IsabellaGhement)</span>, <span class="co">[</span><span class="ot">Brenton Wiernik</span><span class="co">](https://twitter.com/bmwiernik)</span>, <span class="co">[</span><span class="ot">TJ Mahr</span><span class="co">](https://twitter.com/tjmahr)</span>, <span class="co">[</span><span class="ot">Donald Williams</span><span class="co">](https://twitter.com/wdonald_1985)</span>, <span class="co">[</span><span class="ot">Solomon Kurz</span><span class="co">](https://twitter.com/SolomonKurz)</span>, and <span class="co">[</span><span class="ot">Mattan Ben-Shachar</span><span class="co">](https://twitter.com/mattansb)</span> for all their help and tweeting! (<span class="co">[</span><span class="ot">This set of tweets by Brenton</span><span class="co">](https://twitter.com/bmwiernik/status/1458043604128215040)</span> was pivotal!)</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a><span class="fu">## Who this guide is for</span></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>To borrow from <span class="co">[</span><span class="ot">Solomon Kurz</span><span class="co">](https://solomonkurz.netlify.app/post/2021-09-22-sexy-up-your-logistic-regression-model-with-logit-dotplots/)</span>, here's what this guide assumes you know:</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You're familiar with <span class="co">[</span><span class="ot">R</span><span class="co">](https://www.r-project.org/)</span> and the <span class="co">[</span><span class="ot">tidyverse</span><span class="co">](https://www.tidyverse.org/)</span> (particularly <span class="co">[</span><span class="ot">dplyr</span><span class="co">](https://dplyr.tidyverse.org/)</span> and <span class="co">[</span><span class="ot">ggplot2</span><span class="co">](https://ggplot2.tidyverse.org/)</span>).</span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You're familiar with <span class="co">[</span><span class="ot">brms</span><span class="co">](https://paul-buerkner.github.io/brms/)</span> for running Bayesian regression models. See <span class="co">[</span><span class="ot">the vignettes here</span><span class="co">](https://paul-buerkner.github.io/brms/articles/index.html)</span>, examples like <span class="co">[</span><span class="ot">this</span><span class="co">](https://www.rensvandeschoot.com/tutorials/brms-started/)</span>, or <span class="co">[</span><span class="ot">resources like these</span><span class="co">](https://evalf21.classes.andrewheiss.com/resource/bayes/#resources)</span> for an introduction.</span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You're somewhat familiar with multilevel models. <span class="co">[</span><span class="ot">Confusingly</span><span class="co">](https://twitter.com/chelseaparlett/status/1458461737431146500)</span>, these are also called mixed effect models, random effect models, and hierarchical models, among others! They're all the same thing! (&lt;small&gt;image below by <span class="co">[</span><span class="ot">Chelsea Parlett-Pelleriti</span><span class="co">](https://twitter.com/chelseaparlett/status/1458461737431146500)</span>&lt;/small&gt;)</span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a><span class="in">```{r chelsea-meme, echo=FALSE, out.width="60%", indent="  "}</span></span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("chelsea-meme.jpg")</span></span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a><span class="in">    See examples like [this](https://www.tjmahr.com/plotting-partial-pooling-in-mixed-effects-models/) or [this](https://www.tjmahr.com/another-mixed-effects-model-visualization/) or [this](https://www.rensvandeschoot.com/tutorials/lme4/) or [this](https://rstudio-pubs-static.s3.amazonaws.com/63556_e35cc7e2dfb54a5bb551f3fa4b3ec4ae.html). Basically Google "lme4 example" (lme4 is what you use for frequentist, non-Bayesian multilevel models with R) or "brms multilevel example" and you'll find a bunch. For a more formal treatment, see chapter 12 in [Richard McElreath's *Statistcal Rethinking*](https://xcelab.net/rm/statistical-rethinking/) book (or [this R translation of it](https://bookdown.org/content/3890/multilevel-models.html) by Solomon Kurz).</span></span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a><span class="fu">## Example data</span></span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a>Put simply, multilevel models let you account for nested structures in data: </span>
<span id="cb34-59"><a href="#cb34-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-60"><a href="#cb34-60" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Students inside schools inside school districts inside states</span>
<span id="cb34-61"><a href="#cb34-61" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Study participants inside cities inside states across months</span>
<span id="cb34-62"><a href="#cb34-62" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Countries within regions and across years</span>
<span id="cb34-63"><a href="#cb34-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-64"><a href="#cb34-64" aria-hidden="true" tabindex="-1"></a>Since most of my own work deals with international politics, we'll use an example with countries and years. We'll use data from the <span class="co">[</span><span class="ot">Varieties of Democracy project (V-Dem)</span><span class="co">](https://www.v-dem.net/en/)</span> to explore the relationship between press freedom and the degree to which political opposition is allowed. Is there more press freedom in countries that allow opposition parties?</span>
<span id="cb34-65"><a href="#cb34-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-66"><a href="#cb34-66" aria-hidden="true" tabindex="-1"></a>There's <span class="co">[</span><span class="ot">a great R package for accessing V-Dem data</span><span class="co">](https://github.com/vdeminstitute/vdemdata)</span> without needing to download it manually from their website, so we'll use that to make a smaller dataset of countries for just 2015. Let's load all the libraries we need, clean up the data, and get started!</span>
<span id="cb34-67"><a href="#cb34-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-68"><a href="#cb34-68" aria-hidden="true" tabindex="-1"></a><span class="in">```{r libraries-functions, warning=FALSE, message=FALSE}</span></span>
<span id="cb34-69"><a href="#cb34-69" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)    # ggplot, dplyr, %&gt;%, and friends</span></span>
<span id="cb34-70"><a href="#cb34-70" aria-hidden="true" tabindex="-1"></a><span class="in">library(brms)         # Bayesian modeling through Stan</span></span>
<span id="cb34-71"><a href="#cb34-71" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidybayes)    # Manipulate Stan objects in a tidy way</span></span>
<span id="cb34-72"><a href="#cb34-72" aria-hidden="true" tabindex="-1"></a><span class="in">library(broom)        # Convert model objects to data frames</span></span>
<span id="cb34-73"><a href="#cb34-73" aria-hidden="true" tabindex="-1"></a><span class="in">library(broom.mixed)  # Convert brms model objects to data frames</span></span>
<span id="cb34-74"><a href="#cb34-74" aria-hidden="true" tabindex="-1"></a><span class="in">library(emmeans)      # Calculate marginal effects in even fancier ways</span></span>
<span id="cb34-75"><a href="#cb34-75" aria-hidden="true" tabindex="-1"></a><span class="in">library(vdemdata)     # Use data from the Varieties of Democracy (V-Dem) project</span></span>
<span id="cb34-76"><a href="#cb34-76" aria-hidden="true" tabindex="-1"></a><span class="in">library(patchwork)    # Combine ggplot objects</span></span>
<span id="cb34-77"><a href="#cb34-77" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggokabeito)   # Neat accessible color palette</span></span>
<span id="cb34-78"><a href="#cb34-78" aria-hidden="true" tabindex="-1"></a><span class="in">library(gghalves)     # Special half geoms</span></span>
<span id="cb34-79"><a href="#cb34-79" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggbeeswarm)   # Special distribution-shaped point jittering</span></span>
<span id="cb34-80"><a href="#cb34-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-81"><a href="#cb34-81" aria-hidden="true" tabindex="-1"></a><span class="in"># Custom ggplot theme to make pretty plots</span></span>
<span id="cb34-82"><a href="#cb34-82" aria-hidden="true" tabindex="-1"></a><span class="in"># Get the News Cycle font at https://fonts.google.com/specimen/News+Cycle</span></span>
<span id="cb34-83"><a href="#cb34-83" aria-hidden="true" tabindex="-1"></a><span class="in">theme_clean &lt;- function() {</span></span>
<span id="cb34-84"><a href="#cb34-84" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal(base_family = "News Cycle") +</span></span>
<span id="cb34-85"><a href="#cb34-85" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(panel.grid.minor = element_blank(),</span></span>
<span id="cb34-86"><a href="#cb34-86" aria-hidden="true" tabindex="-1"></a><span class="in">          plot.title = element_text(face = "bold"),</span></span>
<span id="cb34-87"><a href="#cb34-87" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.title = element_text(face = "bold"),</span></span>
<span id="cb34-88"><a href="#cb34-88" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.text = element_text(face = "bold", size = rel(1), hjust = 0),</span></span>
<span id="cb34-89"><a href="#cb34-89" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.background = element_rect(fill = "grey80", color = NA),</span></span>
<span id="cb34-90"><a href="#cb34-90" aria-hidden="true" tabindex="-1"></a><span class="in">          legend.title = element_text(face = "bold"))</span></span>
<span id="cb34-91"><a href="#cb34-91" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb34-92"><a href="#cb34-92" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-93"><a href="#cb34-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-94"><a href="#cb34-94" aria-hidden="true" tabindex="-1"></a>V-Dem includes hundreds of different variables, but we only need a few, and we'll make a few adjustments to the ones we do need. Here's what we'll do:</span>
<span id="cb34-95"><a href="#cb34-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-96"><a href="#cb34-96" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Main outcome**: Alternative sources of information index (<span class="in">`v2xme_altinf`</span> in V-Dem). This is a 0–1 scale that measures…</span>
<span id="cb34-97"><a href="#cb34-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-98"><a href="#cb34-98" aria-hidden="true" tabindex="-1"></a><span class="at">  &gt; To what extent the </span><span class="co">[</span><span class="ot">is</span><span class="co">]</span><span class="at"> media (a) un-biased in their coverage or lack of coverage of the opposition, (b) allowed to be critical of the regime, and (c) representative of a wide array of political perspectives</span></span>
<span id="cb34-99"><a href="#cb34-99" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-100"><a href="#cb34-100" aria-hidden="true" tabindex="-1"></a>  Higher values represent more media freedom.</span>
<span id="cb34-101"><a href="#cb34-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-102"><a href="#cb34-102" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Main binary explanatory variable**: Opposition parties autonomy (<span class="in">`v2psoppaut`</span> in V-Dem). This is an ordinal variable with these possible values:</span>
<span id="cb34-103"><a href="#cb34-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-104"><a href="#cb34-104" aria-hidden="true" tabindex="-1"></a><span class="at">  &gt; - 0: Opposition parties are not allowed.</span></span>
<span id="cb34-105"><a href="#cb34-105" aria-hidden="true" tabindex="-1"></a><span class="at">  &gt; - 1: There are no autonomous, independent opposition parties. Opposition parties are either selected or co-opted by the ruling regime.</span></span>
<span id="cb34-106"><a href="#cb34-106" aria-hidden="true" tabindex="-1"></a><span class="at">  &gt; - 2: At least some opposition parties are autonomous and independent of the ruling regime.</span></span>
<span id="cb34-107"><a href="#cb34-107" aria-hidden="true" tabindex="-1"></a><span class="at">  &gt; - 3: Most significant opposition parties are autonomous and independent of the ruling regime.</span></span>
<span id="cb34-108"><a href="#cb34-108" aria-hidden="true" tabindex="-1"></a><span class="at">  &gt; - 4: All opposition parties are autonomous and independent of the ruling regime.</span></span>
<span id="cb34-109"><a href="#cb34-109" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-110"><a href="#cb34-110" aria-hidden="true" tabindex="-1"></a>  For the sake of simplicity, we'll collapse this into a binary variable. Parties are autonomous if they score a 3 or a 4; they're not autonomous if they score a 0, 1, or 2. Also, there are a handful of countries (Saudi Arabia, Qatar, etc.) with missing data for this column, since they don't have *any* opposition parties. We'll treat them as not-autonomous here.</span>
<span id="cb34-111"><a href="#cb34-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-112"><a href="#cb34-112" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Main continuous explanatory variable**: Civil liberties index (<span class="in">`v2x_civlib`</span>). This is a continuous variable measured from 0–1 with higher values representing better respect for human rights and civil liberties.</span>
<span id="cb34-113"><a href="#cb34-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-114"><a href="#cb34-114" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Grouping**: Finally, we'll use region as groups in these models (i.e. countries nested in regions). V-Dem provides multiple regional variables with varying specificity (19 different regions, 10 different regions, and 6 different regions). We'll use the 6-region version (<span class="in">`e_regionpol_6C`</span>) for simplicity here:</span>
<span id="cb34-115"><a href="#cb34-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-116"><a href="#cb34-116" aria-hidden="true" tabindex="-1"></a><span class="at">  &gt; - 1: Eastern Europe and Central Asia (including Mongolia)</span></span>
<span id="cb34-117"><a href="#cb34-117" aria-hidden="true" tabindex="-1"></a><span class="at">  &gt; - 2: Latin America and the Caribbean</span></span>
<span id="cb34-118"><a href="#cb34-118" aria-hidden="true" tabindex="-1"></a><span class="at">  &gt; - 3: The Middle East and North Africa (including Israel and Turkey, excluding Cyprus)</span></span>
<span id="cb34-119"><a href="#cb34-119" aria-hidden="true" tabindex="-1"></a><span class="at">  &gt; - 4: Sub-Saharan Africa</span></span>
<span id="cb34-120"><a href="#cb34-120" aria-hidden="true" tabindex="-1"></a><span class="at">  &gt; - 5: Western Europe and North America (including Cyprus, Australia and New Zealand)</span></span>
<span id="cb34-121"><a href="#cb34-121" aria-hidden="true" tabindex="-1"></a><span class="at">  &gt; - 6: Asia and Pacific (excluding Australia and New Zealand)</span></span>
<span id="cb34-122"><a href="#cb34-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-123"><a href="#cb34-123" aria-hidden="true" tabindex="-1"></a><span class="in">```{r clean-data}</span></span>
<span id="cb34-124"><a href="#cb34-124" aria-hidden="true" tabindex="-1"></a><span class="in"># Make a subset of the full V-Dem data</span></span>
<span id="cb34-125"><a href="#cb34-125" aria-hidden="true" tabindex="-1"></a><span class="in">vdem_2015 &lt;- vdem %&gt;% </span></span>
<span id="cb34-126"><a href="#cb34-126" aria-hidden="true" tabindex="-1"></a><span class="in">  select(country_name, country_text_id, year, region = e_regionpol_6C,</span></span>
<span id="cb34-127"><a href="#cb34-127" aria-hidden="true" tabindex="-1"></a><span class="in">         media_index = v2xme_altinf, party_autonomy_ord = v2psoppaut_ord,</span></span>
<span id="cb34-128"><a href="#cb34-128" aria-hidden="true" tabindex="-1"></a><span class="in">         polyarchy = v2x_polyarchy, civil_liberties = v2x_civlib) %&gt;% </span></span>
<span id="cb34-129"><a href="#cb34-129" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(year == 2015) %&gt;% </span></span>
<span id="cb34-130"><a href="#cb34-130" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(party_autonomy = party_autonomy_ord &gt;= 3,</span></span>
<span id="cb34-131"><a href="#cb34-131" aria-hidden="true" tabindex="-1"></a><span class="in">         party_autonomy = ifelse(is.na(party_autonomy), FALSE, party_autonomy)) %&gt;% </span></span>
<span id="cb34-132"><a href="#cb34-132" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(region = factor(region, </span></span>
<span id="cb34-133"><a href="#cb34-133" aria-hidden="true" tabindex="-1"></a><span class="in">                         labels = c("Eastern Europe and Central Asia",</span></span>
<span id="cb34-134"><a href="#cb34-134" aria-hidden="true" tabindex="-1"></a><span class="in">                                    "Latin America and the Caribbean",</span></span>
<span id="cb34-135"><a href="#cb34-135" aria-hidden="true" tabindex="-1"></a><span class="in">                                    "Middle East and North Africa",</span></span>
<span id="cb34-136"><a href="#cb34-136" aria-hidden="true" tabindex="-1"></a><span class="in">                                    "Sub-Saharan Africa",</span></span>
<span id="cb34-137"><a href="#cb34-137" aria-hidden="true" tabindex="-1"></a><span class="in">                                    "Western Europe and North America",</span></span>
<span id="cb34-138"><a href="#cb34-138" aria-hidden="true" tabindex="-1"></a><span class="in">                                    "Asia and Pacific")))</span></span>
<span id="cb34-139"><a href="#cb34-139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-140"><a href="#cb34-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-141"><a href="#cb34-141" aria-hidden="true" tabindex="-1"></a><span class="fu">## Explore the data</span></span>
<span id="cb34-142"><a href="#cb34-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-143"><a href="#cb34-143" aria-hidden="true" tabindex="-1"></a>We're interested in a couple relationships here. First, we want to know if there is more press freedom in countries that allow opposition parties in elections. Let's look at the data really quick:</span>
<span id="cb34-144"><a href="#cb34-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-145"><a href="#cb34-145" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-explore-autonomy, fig.width=7, out.width="100%"}</span></span>
<span id="cb34-146"><a href="#cb34-146" aria-hidden="true" tabindex="-1"></a><span class="in">autonomy_halves &lt;- ggplot(vdem_2015, aes(x = party_autonomy, y = media_index)) +</span></span>
<span id="cb34-147"><a href="#cb34-147" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_half_point(aes(color = party_autonomy), </span></span>
<span id="cb34-148"><a href="#cb34-148" aria-hidden="true" tabindex="-1"></a><span class="in">                  transformation = position_quasirandom(width = 0.1),</span></span>
<span id="cb34-149"><a href="#cb34-149" aria-hidden="true" tabindex="-1"></a><span class="in">                  side = "l", size = 0.5, alpha = 0.5) +</span></span>
<span id="cb34-150"><a href="#cb34-150" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_half_boxplot(aes(fill = party_autonomy), side = "r") + </span></span>
<span id="cb34-151"><a href="#cb34-151" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_okabe_ito() +</span></span>
<span id="cb34-152"><a href="#cb34-152" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_okabe_ito() +</span></span>
<span id="cb34-153"><a href="#cb34-153" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(color = "none", fill = "none") +</span></span>
<span id="cb34-154"><a href="#cb34-154" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Opposition party autonomy", y = "Media freedom index") +</span></span>
<span id="cb34-155"><a href="#cb34-155" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean()</span></span>
<span id="cb34-156"><a href="#cb34-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-157"><a href="#cb34-157" aria-hidden="true" tabindex="-1"></a><span class="in">autonomy_densities &lt;- ggplot(vdem_2015, aes(x = media_index, fill = party_autonomy)) +</span></span>
<span id="cb34-158"><a href="#cb34-158" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_density(alpha = 0.6) +</span></span>
<span id="cb34-159"><a href="#cb34-159" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_okabe_ito() +</span></span>
<span id="cb34-160"><a href="#cb34-160" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Media freedom index", y = "Density", fill = "Opposition party autonomy") +</span></span>
<span id="cb34-161"><a href="#cb34-161" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() +</span></span>
<span id="cb34-162"><a href="#cb34-162" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb34-163"><a href="#cb34-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-164"><a href="#cb34-164" aria-hidden="true" tabindex="-1"></a><span class="in">autonomy_halves | autonomy_densities</span></span>
<span id="cb34-165"><a href="#cb34-165" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-166"><a href="#cb34-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-167"><a href="#cb34-167" aria-hidden="true" tabindex="-1"></a>That confirms our initial suspicions: countries that do not allow opposition parties to participate in elections tend to have substantially lower media freedom index scores than countries that have opposition parties.</span>
<span id="cb34-168"><a href="#cb34-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-169"><a href="#cb34-169" aria-hidden="true" tabindex="-1"></a>Let's see how respect for civil liberties is related to media freedom:</span>
<span id="cb34-170"><a href="#cb34-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-171"><a href="#cb34-171" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=7, out.width="100%"}</span></span>
<span id="cb34-172"><a href="#cb34-172" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(vdem_2015, aes(x = civil_liberties, y = media_index)) +</span></span>
<span id="cb34-173"><a href="#cb34-173" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(aes(color = region)) +</span></span>
<span id="cb34-174"><a href="#cb34-174" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm") +</span></span>
<span id="cb34-175"><a href="#cb34-175" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Civil liberties index", y = "Media freedom index",</span></span>
<span id="cb34-176"><a href="#cb34-176" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "Region") +</span></span>
<span id="cb34-177"><a href="#cb34-177" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_okabe_ito() +</span></span>
<span id="cb34-178"><a href="#cb34-178" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean()</span></span>
<span id="cb34-179"><a href="#cb34-179" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-180"><a href="#cb34-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-181"><a href="#cb34-181" aria-hidden="true" tabindex="-1"></a>Countries with greater respect for civil liberties and human rights tend to have higher values of media freedom. There are perhaps some regional trends here too—most of the countries in Western Europe and North America are clustered in the top right corner of the plot, but all other regions are spread throughout.</span>
<span id="cb34-182"><a href="#cb34-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-183"><a href="#cb34-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-184"><a href="#cb34-184" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model</span></span>
<span id="cb34-185"><a href="#cb34-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-186"><a href="#cb34-186" aria-hidden="true" tabindex="-1"></a>Let's make a model! We'll look just at 2015 data to estimate the effect of party autonomy (a binary variable) and civil liberties (a continuous variable) on a country's media freedom index. We'll include random effects for region, assuming that there are regional differences in this relationship (i.e. the relationship between party autonomy and media freedom looks different in Asia from Western Europe).</span>
<span id="cb34-187"><a href="#cb34-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-188"><a href="#cb34-188" aria-hidden="true" tabindex="-1"></a>Because <span class="in">`media_index`</span> ranges from 0 to 1 but does not include 0 or 1, we'll use a beta distribution. It's <span class="co">[</span><span class="ot">a really neat and fun distribution to work with</span><span class="co">](https://www.andrewheiss.com/blog/2021/11/08/beta-regression-guide/)</span>, and it has extra moving parts we can play with—we can model the $\phi$ parameter (or the precision/variance of the distribution) with random effects too.</span>
<span id="cb34-189"><a href="#cb34-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-190"><a href="#cb34-190" aria-hidden="true" tabindex="-1"></a>Formally, we can define the full model like this:</span>
<span id="cb34-191"><a href="#cb34-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-192"><a href="#cb34-192" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb34-193"><a href="#cb34-193" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb34-194"><a href="#cb34-194" aria-hidden="true" tabindex="-1"></a>&amp;\text{<span class="co">[</span><span class="ot">likelihood</span><span class="co">]</span>} <span class="sc">\\</span></span>
<span id="cb34-195"><a href="#cb34-195" aria-hidden="true" tabindex="-1"></a>\text{Media freedom index}_i &amp;\sim \operatorname{Beta}(\mu_i, \phi_i) <span class="sc">\\</span></span>
<span id="cb34-196"><a href="#cb34-196" aria-hidden="true" tabindex="-1"></a>\ <span class="sc">\\</span></span>
<span id="cb34-197"><a href="#cb34-197" aria-hidden="true" tabindex="-1"></a>&amp;\text{<span class="co">[</span><span class="ot">} \mu \text{ part of beta distribution</span><span class="co">]</span>} <span class="sc">\\</span></span>
<span id="cb34-198"><a href="#cb34-198" aria-hidden="true" tabindex="-1"></a>\operatorname{logit}(\mu_i) &amp;= \alpha_{j<span class="co">[</span><span class="ot">i</span><span class="co">]</span>} + \beta_1 \text{Party autonomy}_i + \beta_2 \text{Civil liberties}_i<span class="sc">\\</span></span>
<span id="cb34-199"><a href="#cb34-199" aria-hidden="true" tabindex="-1"></a>\ <span class="sc">\\</span></span>
<span id="cb34-200"><a href="#cb34-200" aria-hidden="true" tabindex="-1"></a>&amp;\text{<span class="co">[</span><span class="ot">} \phi \text{ part of beta distribution</span><span class="co">]</span>} <span class="sc">\\</span></span>
<span id="cb34-201"><a href="#cb34-201" aria-hidden="true" tabindex="-1"></a>\log(\phi_i) &amp;= \alpha_{j<span class="co">[</span><span class="ot">i</span><span class="co">]</span>}<span class="sc">\\</span></span>
<span id="cb34-202"><a href="#cb34-202" aria-hidden="true" tabindex="-1"></a>\ <span class="sc">\\</span></span>
<span id="cb34-203"><a href="#cb34-203" aria-hidden="true" tabindex="-1"></a>&amp; \text{<span class="co">[</span><span class="ot">region-specific intercepts</span><span class="co">]</span>} <span class="sc">\\</span></span>
<span id="cb34-204"><a href="#cb34-204" aria-hidden="true" tabindex="-1"></a>\alpha_{j} &amp;\sim \mathcal{N}(\mu_{\alpha_j}, \sigma^2_{\alpha_j}), \text{ for region } j \text{ in } 1 .. J</span>
<span id="cb34-205"><a href="#cb34-205" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb34-206"><a href="#cb34-206" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb34-207"><a href="#cb34-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-208"><a href="#cb34-208" aria-hidden="true" tabindex="-1"></a>We'll model the $\mu$ (or mean) parameter of the beta distribution with <span class="in">`party_autonomy`</span>, <span class="in">`civil_liberties`</span>, and random intercepts for region, and we'll model the $\phi$ part (or precision) with just random intercepts for region (though we could use whatever, too—<span class="co">[</span><span class="ot">see this for an explanation of what this parameter does</span><span class="co">](https://www.andrewheiss.com/blog/2021/11/08/beta-regression-guide/#working-with-the-precision-parameter)</span>).</span>
<span id="cb34-209"><a href="#cb34-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-210"><a href="#cb34-210" aria-hidden="true" tabindex="-1"></a>The syntax for defining random effects can get complex, depending on if the effects are nested or crossed, and if slopes get involved. <span class="co">[</span><span class="ot">This table by Ben Bolker</span><span class="co">](https://bbolker.github.io/mixedmodels-misc/glmmFAQ.html#model-specification)</span> is *indispensable* for remembering how to define which kinds of effects. Here we're just adding a random intercept for region, so we'll use a <span class="in">`(1 | region)`</span> term in the model code.</span>
<span id="cb34-211"><a href="#cb34-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-212"><a href="#cb34-212" aria-hidden="true" tabindex="-1"></a><span class="in">```{r run-model-2015, cache=TRUE, warning=FALSE, results="hide"}</span></span>
<span id="cb34-213"><a href="#cb34-213" aria-hidden="true" tabindex="-1"></a><span class="in">model_basic &lt;- brm(</span></span>
<span id="cb34-214"><a href="#cb34-214" aria-hidden="true" tabindex="-1"></a><span class="in">  bf(media_index ~ party_autonomy + civil_liberties + (1 | region),</span></span>
<span id="cb34-215"><a href="#cb34-215" aria-hidden="true" tabindex="-1"></a><span class="in">     phi ~ (1 | region)),</span></span>
<span id="cb34-216"><a href="#cb34-216" aria-hidden="true" tabindex="-1"></a><span class="in">  data = vdem_2015,</span></span>
<span id="cb34-217"><a href="#cb34-217" aria-hidden="true" tabindex="-1"></a><span class="in">  family = Beta(),</span></span>
<span id="cb34-218"><a href="#cb34-218" aria-hidden="true" tabindex="-1"></a><span class="in">  control = list(adapt_delta = 0.9),</span></span>
<span id="cb34-219"><a href="#cb34-219" aria-hidden="true" tabindex="-1"></a><span class="in">  chains = 4, iter = 2000, warmup = 1000,</span></span>
<span id="cb34-220"><a href="#cb34-220" aria-hidden="true" tabindex="-1"></a><span class="in">  cores = 4, seed = 12345,</span></span>
<span id="cb34-221"><a href="#cb34-221" aria-hidden="true" tabindex="-1"></a><span class="in">  # Use the cmdstanr backend for Stan because it's faster and more modern than</span></span>
<span id="cb34-222"><a href="#cb34-222" aria-hidden="true" tabindex="-1"></a><span class="in">  # the default rstan. You need to install the cmdstanr package first</span></span>
<span id="cb34-223"><a href="#cb34-223" aria-hidden="true" tabindex="-1"></a><span class="in">  # (https://mc-stan.org/cmdstanr/) and then run cmdstanr::install_cmdstan() to</span></span>
<span id="cb34-224"><a href="#cb34-224" aria-hidden="true" tabindex="-1"></a><span class="in">  # install cmdstan on your computer.</span></span>
<span id="cb34-225"><a href="#cb34-225" aria-hidden="true" tabindex="-1"></a><span class="in">  backend = "cmdstanr"</span></span>
<span id="cb34-226"><a href="#cb34-226" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb34-227"><a href="#cb34-227" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-228"><a href="#cb34-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-229"><a href="#cb34-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-230"><a href="#cb34-230" aria-hidden="true" tabindex="-1"></a><span class="fu">## Posterior predictions</span></span>
<span id="cb34-231"><a href="#cb34-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-232"><a href="#cb34-232" aria-hidden="true" tabindex="-1"></a>Because this model uses beta regression, the coefficients for the $\mu$ part are on the logit (log odds) scale, while the coefficients for the $\phi$ part are on the log scale. This makes them really hard to interpret when just looking at a table of coefficient estimates, like this one here:</span>
<span id="cb34-233"><a href="#cb34-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-234"><a href="#cb34-234" aria-hidden="true" tabindex="-1"></a><span class="in">```{r show-basic-results, warning=FALSE}</span></span>
<span id="cb34-235"><a href="#cb34-235" aria-hidden="true" tabindex="-1"></a><span class="in">tidy(model_basic)</span></span>
<span id="cb34-236"><a href="#cb34-236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-237"><a href="#cb34-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-238"><a href="#cb34-238" aria-hidden="true" tabindex="-1"></a>Even if we back-transform the estimates to the response scale (with <span class="in">`plogis()`</span> for the logits and <span class="in">`exp()`</span> for the logs), **we still cannot interpret the coefficients directly**. Unlike regular OLS-like regression models, we can't say things like "a one-unit increase in <span class="in">`party_autonomy`</span> is associated with a <span class="in">`plogis(2.27)`</span> unit increase in <span class="in">`media_freedom`</span>"—we have to incorporate the intercept and all the other model parameters in order to make marginal interpretations like that.</span>
<span id="cb34-239"><a href="#cb34-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-240"><a href="#cb34-240" aria-hidden="true" tabindex="-1"></a>In this case, we *are* interested in these marginal effects, though. What is the effect of flipping `party_autonomy` from `FALSE` to `TRUE`? What is the effect of a one-unit increase in the respect for human rights and civil liberties measured by `civil_liberties`? You can't easily figure it out with the raw results of the model because there are so many moving parts: the different pieces (intercept, other coefficients) for the $\mu$ part need to be combined, the precision parameter $\phi$ needs to be incorporated somehow, and random regional effects for both the $\mu$ *and* the $\phi$ parts need to be accounted for. That's a mess.</span>
<span id="cb34-241"><a href="#cb34-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-242"><a href="#cb34-242" aria-hidden="true" tabindex="-1"></a>Instead of trying to algebraically piece all this together, we can plug hypothetical data into the model's posterior distribution and generate posterior predictions of our media freedom outcome. </span>
<span id="cb34-243"><a href="#cb34-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-244"><a href="#cb34-244" aria-hidden="true" tabindex="-1"></a><span class="fu">### Draws from the posterior predictive distribution</span></span>
<span id="cb34-245"><a href="#cb34-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-246"><a href="#cb34-246" aria-hidden="true" tabindex="-1"></a>There are a few general approaches to generating posterior predictions with **brms**. First, we can use <span class="in">`posterior_predict()`</span> to plug a new dataset into the model. As an example, we'll create a little dataset where <span class="in">`party_autonomy`</span> is both <span class="in">`TRUE`</span> and <span class="in">`FALSE`</span>, and we'll arbitrarily set <span class="in">`civil_liberties`</span> to 0.5 (right in the middle of its range) and <span class="in">`region`</span> to the Middle East and North Africa. We'll then plug that in to the model and generate predictions</span>
<span id="cb34-247"><a href="#cb34-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-248"><a href="#cb34-248" aria-hidden="true" tabindex="-1"></a><span class="in">```{r brms-posterior-predict}</span></span>
<span id="cb34-249"><a href="#cb34-249" aria-hidden="true" tabindex="-1"></a><span class="in">newdata &lt;- expand_grid(party_autonomy = c(TRUE, FALSE),</span></span>
<span id="cb34-250"><a href="#cb34-250" aria-hidden="true" tabindex="-1"></a><span class="in">                       civil_liberties = c(0.5),</span></span>
<span id="cb34-251"><a href="#cb34-251" aria-hidden="true" tabindex="-1"></a><span class="in">                       region = "Middle East and North Africa")</span></span>
<span id="cb34-252"><a href="#cb34-252" aria-hidden="true" tabindex="-1"></a><span class="in">newdata</span></span>
<span id="cb34-253"><a href="#cb34-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-254"><a href="#cb34-254" aria-hidden="true" tabindex="-1"></a><span class="in">posterior_predict(model_basic, newdata) %&gt;% head()</span></span>
<span id="cb34-255"><a href="#cb34-255" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-256"><a href="#cb34-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-257"><a href="#cb34-257" aria-hidden="true" tabindex="-1"></a>This returns a matrix with 4,000 rows and 2 columns—a column for when <span class="in">`party_autonomy`</span> is <span class="in">`TRUE`</span> and one for when it is <span class="in">`FALSE`</span>. This format isn't in the nicest shape for plotting and doing tidy type of stuff with, so we can alternatively use <span class="in">`predicted_draws()`</span> from the **tidybayes** package. This is really just a fancy wrapper around <span class="in">`brms::posterior_predict()`</span> that returns a much nicer tidier data frame:</span>
<span id="cb34-258"><a href="#cb34-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-259"><a href="#cb34-259" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tidybayes-posterior-predict}</span></span>
<span id="cb34-260"><a href="#cb34-260" aria-hidden="true" tabindex="-1"></a><span class="in">tidy_pred &lt;- model_basic %&gt;% </span></span>
<span id="cb34-261"><a href="#cb34-261" aria-hidden="true" tabindex="-1"></a><span class="in">  predicted_draws(newdata = newdata)</span></span>
<span id="cb34-262"><a href="#cb34-262" aria-hidden="true" tabindex="-1"></a><span class="in">tidy_pred</span></span>
<span id="cb34-263"><a href="#cb34-263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-264"><a href="#cb34-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-265"><a href="#cb34-265" aria-hidden="true" tabindex="-1"></a>*That's* much nicer to work with!</span>
<span id="cb34-266"><a href="#cb34-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-267"><a href="#cb34-267" aria-hidden="true" tabindex="-1"></a><span class="fu">### Expected values of the posterior predictive distribution</span></span>
<span id="cb34-268"><a href="#cb34-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-269"><a href="#cb34-269" aria-hidden="true" tabindex="-1"></a>We don't necessarily want to use these predicted draws when thinking about marginal effects of coefficients, though. When we use <span class="in">`posterior_predict()`</span>/<span class="in">`predicted_draws()`</span> here, **brms** accounts for the uncertainty of all these things:</span>
<span id="cb34-270"><a href="#cb34-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-271"><a href="#cb34-271" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The uncertainty of the fixed coefficients (e.g., <span class="in">`party_autonomy`</span> and <span class="in">`civil_liberties`</span>)</span>
<span id="cb34-272"><a href="#cb34-272" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The uncertainty of the variance parameters of the groups (e.g., <span class="in">`sd__phi_(Intercept)`</span> for each region)</span>
<span id="cb34-273"><a href="#cb34-273" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The uncertainty for each individual observation (e.g., observational-level residual variance)</span>
<span id="cb34-274"><a href="#cb34-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-275"><a href="#cb34-275" aria-hidden="true" tabindex="-1"></a>When thinking about marginal effects, though, we're more interested in the *expected value* of the outcome, which means we're more focused on the uncertainty in the model parameters and not necessarily the individual-level residuals (<span class="co">[</span><span class="ot">See this post</span><span class="co">](https://discourse.mc-stan.org/t/difference-between-method-fitted-vs-predict-in-marginal-effects-function/6901/3)</span> or <span class="co">[</span><span class="ot">this discussion</span><span class="co">](https://github.com/paul-buerkner/brms/issues/82#issuecomment-231440994)</span> for an explanation of the difference between the two types of predictions). To get these expected values, we can use <span class="in">`brms::posterior_epred()`</span> (or the nicer <span class="in">`tidybayes::epred_draws()`</span>), which accounts for the uncertainty of just these two things:</span>
<span id="cb34-276"><a href="#cb34-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-277"><a href="#cb34-277" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The uncertainty of the fixed coefficients (e.g., <span class="in">`party_autonomy`</span> and <span class="in">`civil_liberties`</span>)</span>
<span id="cb34-278"><a href="#cb34-278" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The uncertainty of the variance parameters of the groups (e.g., <span class="in">`sd__phi_(Intercept)`</span> for each region)</span>
<span id="cb34-279"><a href="#cb34-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-280"><a href="#cb34-280" aria-hidden="true" tabindex="-1"></a>The averages of these draws that are generated by regular <span class="in">`posterior_predict()`</span> and <span class="in">`posterior_epred()`</span> should be generally the same, but the variance for *expected* values will be smaller (since we're not dealing with individual observation-level variance).</span>
<span id="cb34-281"><a href="#cb34-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-282"><a href="#cb34-282" aria-hidden="true" tabindex="-1"></a><span class="in">```{r epred-example}</span></span>
<span id="cb34-283"><a href="#cb34-283" aria-hidden="true" tabindex="-1"></a><span class="in"># Expected values with brms</span></span>
<span id="cb34-284"><a href="#cb34-284" aria-hidden="true" tabindex="-1"></a><span class="in">posterior_epred(model_basic, newdata) %&gt;% head()</span></span>
<span id="cb34-285"><a href="#cb34-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-286"><a href="#cb34-286" aria-hidden="true" tabindex="-1"></a><span class="in"># Expected values with tidybayes</span></span>
<span id="cb34-287"><a href="#cb34-287" aria-hidden="true" tabindex="-1"></a><span class="in">tidy_epred &lt;- model_basic %&gt;% </span></span>
<span id="cb34-288"><a href="#cb34-288" aria-hidden="true" tabindex="-1"></a><span class="in">  epred_draws(newdata = newdata)</span></span>
<span id="cb34-289"><a href="#cb34-289" aria-hidden="true" tabindex="-1"></a><span class="in">tidy_epred</span></span>
<span id="cb34-290"><a href="#cb34-290" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-291"><a href="#cb34-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-292"><a href="#cb34-292" aria-hidden="true" tabindex="-1"></a>Here's what the difference in variance actually looks like:</span>
<span id="cb34-293"><a href="#cb34-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-294"><a href="#cb34-294" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-pred-vs-epred, fig.width=7, out.width="100%", warning=FALSE}</span></span>
<span id="cb34-295"><a href="#cb34-295" aria-hidden="true" tabindex="-1"></a><span class="in">plot_preds &lt;- bind_rows(</span></span>
<span id="cb34-296"><a href="#cb34-296" aria-hidden="true" tabindex="-1"></a><span class="in">  "Predicted draws" = tidy_pred,</span></span>
<span id="cb34-297"><a href="#cb34-297" aria-hidden="true" tabindex="-1"></a><span class="in">  "Expectation of predicted draws" = rename(tidy_epred, .prediction = .epred),</span></span>
<span id="cb34-298"><a href="#cb34-298" aria-hidden="true" tabindex="-1"></a><span class="in">  .id = "draw_type") %&gt;% </span></span>
<span id="cb34-299"><a href="#cb34-299" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(draw_type = fct_inorder(draw_type))</span></span>
<span id="cb34-300"><a href="#cb34-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-301"><a href="#cb34-301" aria-hidden="true" tabindex="-1"></a><span class="in">plot_preds %&gt;% </span></span>
<span id="cb34-302"><a href="#cb34-302" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(draw_type, party_autonomy) %&gt;% </span></span>
<span id="cb34-303"><a href="#cb34-303" aria-hidden="true" tabindex="-1"></a><span class="in">  median_hdi(.prediction)</span></span>
<span id="cb34-304"><a href="#cb34-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-305"><a href="#cb34-305" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(plot_preds, aes(x = .prediction, fill = party_autonomy)) +</span></span>
<span id="cb34-306"><a href="#cb34-306" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye() +</span></span>
<span id="cb34-307"><a href="#cb34-307" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Predicted media index", y = "Density", fill = "Party autonomy") +</span></span>
<span id="cb34-308"><a href="#cb34-308" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(draw_type)) +</span></span>
<span id="cb34-309"><a href="#cb34-309" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_okabe_ito() +</span></span>
<span id="cb34-310"><a href="#cb34-310" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() +</span></span>
<span id="cb34-311"><a href="#cb34-311" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb34-312"><a href="#cb34-312" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-313"><a href="#cb34-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-314"><a href="#cb34-314" aria-hidden="true" tabindex="-1"></a>The median values from both types of draws are the same. When there's no party autonomy, the median predicted media index is around 0.11; when there is party autonomy, the median predicted media index is around 0.6. But the variance is wildly different and is much narrower when looking at the expectation of predicted draws.</span>
<span id="cb34-315"><a href="#cb34-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-316"><a href="#cb34-316" aria-hidden="true" tabindex="-1"></a>For all our marginal effects calculations here, we're going to use **expected values**, or <span class="in">`epred_draws()`</span>.</span>
<span id="cb34-317"><a href="#cb34-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-318"><a href="#cb34-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-319"><a href="#cb34-319" aria-hidden="true" tabindex="-1"></a><span class="fu">## Average marginal effects</span></span>
<span id="cb34-320"><a href="#cb34-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-321"><a href="#cb34-321" aria-hidden="true" tabindex="-1"></a>In the plot above, we got predicted values of our outcome across different levels of party autonomy when holding civil liberties and region constant, and that's neat, but what we're really interested in is the *difference* between those two distributions, or the marginal effect of flipping party autonomy from false to true. How much of an increase in the predicted media index when there is party autonomy?</span>
<span id="cb34-322"><a href="#cb34-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-323"><a href="#cb34-323" aria-hidden="true" tabindex="-1"></a>We already have all the information we need to calculate this with our <span class="in">`tidy_epred`</span>. If we rearrange the dataset so that it's wide, with a column for party autonomy being true and a column for when it's false, we can subtract the two columns and get the difference:</span>
<span id="cb34-324"><a href="#cb34-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-325"><a href="#cb34-325" aria-hidden="true" tabindex="-1"></a><span class="in">```{r autonomy-effect-manual}</span></span>
<span id="cb34-326"><a href="#cb34-326" aria-hidden="true" tabindex="-1"></a><span class="in">tidy_epred %&gt;% </span></span>
<span id="cb34-327"><a href="#cb34-327" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb34-328"><a href="#cb34-328" aria-hidden="true" tabindex="-1"></a><span class="in">  select(-.row) %&gt;% </span></span>
<span id="cb34-329"><a href="#cb34-329" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_wider(names_from = "party_autonomy", values_from = ".epred") %&gt;% </span></span>
<span id="cb34-330"><a href="#cb34-330" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(autonomy_effect = `TRUE` - `FALSE`)</span></span>
<span id="cb34-331"><a href="#cb34-331" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-332"><a href="#cb34-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-333"><a href="#cb34-333" aria-hidden="true" tabindex="-1"></a>We could then plot that <span class="in">`autonomy_effect`</span> column and see the average marginal effect of party autonomy. But that's a lot of data wrangling and pivoting! There's an easier way! Instead of manually working with the posterior predictions like this, we can use the **emmeans** package, which was designed specifically for this kind of work.</span>
<span id="cb34-334"><a href="#cb34-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-335"><a href="#cb34-335" aria-hidden="true" tabindex="-1"></a>With <span class="in">`emmeans()`</span>, we don't have to create our own hypothetical <span class="in">`newdata`</span> data frame—the function does that for us. We need to specify <span class="in">`epred = TRUE`</span> to get the expectation of predicted draws, since it'll give us predicted draws by default.</span>
<span id="cb34-336"><a href="#cb34-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-337"><a href="#cb34-337" aria-hidden="true" tabindex="-1"></a>If we run <span class="in">`emmeans()`</span> by itself, it'll print a summary table of the predicted values:</span>
<span id="cb34-338"><a href="#cb34-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-339"><a href="#cb34-339" aria-hidden="true" tabindex="-1"></a><span class="in">```{r autonomy-effect-emmeans}</span></span>
<span id="cb34-340"><a href="#cb34-340" aria-hidden="true" tabindex="-1"></a><span class="in">model_basic %&gt;% </span></span>
<span id="cb34-341"><a href="#cb34-341" aria-hidden="true" tabindex="-1"></a><span class="in">  emmeans(~ party_autonomy,</span></span>
<span id="cb34-342"><a href="#cb34-342" aria-hidden="true" tabindex="-1"></a><span class="in">          at = list(civil_liberties = 0.5,</span></span>
<span id="cb34-343"><a href="#cb34-343" aria-hidden="true" tabindex="-1"></a><span class="in">                    region = "Middle East and North Africa"),</span></span>
<span id="cb34-344"><a href="#cb34-344" aria-hidden="true" tabindex="-1"></a><span class="in">          epred = TRUE)</span></span>
<span id="cb34-345"><a href="#cb34-345" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-346"><a href="#cb34-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-347"><a href="#cb34-347" aria-hidden="true" tabindex="-1"></a>We also don't need to calculate the autonomy effect by hand—the <span class="in">`constrast()`</span> function will do that for us too (the <span class="in">`revpairwise`</span> option here makes it so it'll calculate <span class="in">`TRUE - FALSE`</span> instead of <span class="in">`FALSE - TRUE`</span>):</span>
<span id="cb34-348"><a href="#cb34-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-349"><a href="#cb34-349" aria-hidden="true" tabindex="-1"></a><span class="in">```{r autonomy-effect-emmeans-contrast}</span></span>
<span id="cb34-350"><a href="#cb34-350" aria-hidden="true" tabindex="-1"></a><span class="in">model_basic %&gt;% </span></span>
<span id="cb34-351"><a href="#cb34-351" aria-hidden="true" tabindex="-1"></a><span class="in">  emmeans(~ party_autonomy,</span></span>
<span id="cb34-352"><a href="#cb34-352" aria-hidden="true" tabindex="-1"></a><span class="in">          at = list(civil_liberties = 0.5,</span></span>
<span id="cb34-353"><a href="#cb34-353" aria-hidden="true" tabindex="-1"></a><span class="in">                    region = "Middle East and North Africa"),</span></span>
<span id="cb34-354"><a href="#cb34-354" aria-hidden="true" tabindex="-1"></a><span class="in">          epred = TRUE) %&gt;% </span></span>
<span id="cb34-355"><a href="#cb34-355" aria-hidden="true" tabindex="-1"></a><span class="in">  contrast(method = "revpairwise")</span></span>
<span id="cb34-356"><a href="#cb34-356" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-357"><a href="#cb34-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-358"><a href="#cb34-358" aria-hidden="true" tabindex="-1"></a>If we store the results of <span class="in">`emmeans()`</span> as an object, we actually get access to all the posterior draws that it created for the predictions, which we can then extract and rearrange with **tidybayes**'s <span class="in">`gather_emmeans_draws()`</span>. (Without the <span class="in">`contrast()`</span> step, we'd get predicted values for both levels of <span class="in">`party_autonomy`</span>.)</span>
<span id="cb34-359"><a href="#cb34-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-360"><a href="#cb34-360" aria-hidden="true" tabindex="-1"></a><span class="in">```{r autonomy-effect-emmeans-contrast-draws}</span></span>
<span id="cb34-361"><a href="#cb34-361" aria-hidden="true" tabindex="-1"></a><span class="in">autonomy_effect_draws &lt;- model_basic %&gt;% </span></span>
<span id="cb34-362"><a href="#cb34-362" aria-hidden="true" tabindex="-1"></a><span class="in">  emmeans(~ party_autonomy,</span></span>
<span id="cb34-363"><a href="#cb34-363" aria-hidden="true" tabindex="-1"></a><span class="in">          at = list(civil_liberties = 0.5,</span></span>
<span id="cb34-364"><a href="#cb34-364" aria-hidden="true" tabindex="-1"></a><span class="in">                    region = "Middle East and North Africa"),</span></span>
<span id="cb34-365"><a href="#cb34-365" aria-hidden="true" tabindex="-1"></a><span class="in">          epred = TRUE) %&gt;% </span></span>
<span id="cb34-366"><a href="#cb34-366" aria-hidden="true" tabindex="-1"></a><span class="in">  contrast(method = "revpairwise") %&gt;% </span></span>
<span id="cb34-367"><a href="#cb34-367" aria-hidden="true" tabindex="-1"></a><span class="in">  gather_emmeans_draws()</span></span>
<span id="cb34-368"><a href="#cb34-368" aria-hidden="true" tabindex="-1"></a><span class="in">autonomy_effect_draws</span></span>
<span id="cb34-369"><a href="#cb34-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-370"><a href="#cb34-370" aria-hidden="true" tabindex="-1"></a><span class="in">autonomy_effect_draws %&gt;% median_hdi()</span></span>
<span id="cb34-371"><a href="#cb34-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-372"><a href="#cb34-372" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(autonomy_effect_draws, aes(x = .value)) +</span></span>
<span id="cb34-373"><a href="#cb34-373" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye(fill = palette_okabe_ito(order = 5)) +</span></span>
<span id="cb34-374"><a href="#cb34-374" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Average marginal effect of party autonomy", y = "Density") +</span></span>
<span id="cb34-375"><a href="#cb34-375" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() +</span></span>
<span id="cb34-376"><a href="#cb34-376" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb34-377"><a href="#cb34-377" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-378"><a href="#cb34-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-379"><a href="#cb34-379" aria-hidden="true" tabindex="-1"></a>That's so cool! There's our marginal effect. On average, having party autonomy is associated with a 0.247 point higher media freedom index score. Since it's measured on a 0–1 scale, that's a pretty sizable effect!</span>
<span id="cb34-380"><a href="#cb34-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-381"><a href="#cb34-381" aria-hidden="true" tabindex="-1"></a>Where **emmeans** really shines is figuring out the average marginal effect for continuous predictors. Working with party autonomy was easy enough: get the predicted value when it's false, get the predicted value when it's true, and find the difference. Getting a continuous effect, though, is a lot trickier since it involves slopes and first derivatives and calculus. Plus we're working with a nonlinear model, so the slope is different across the whole range of predictions.</span>
<span id="cb34-382"><a href="#cb34-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-383"><a href="#cb34-383" aria-hidden="true" tabindex="-1"></a>For instance, here's the predicted media freedom index across a range of respect for civil liberties. It's curvy! The slope is really flat down at low levels of civil liberties, and it's steep up at high levels</span>
<span id="cb34-384"><a href="#cb34-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-385"><a href="#cb34-385" aria-hidden="true" tabindex="-1"></a><span class="in">```{r civlib-effect-plot, warning=FALSE}</span></span>
<span id="cb34-386"><a href="#cb34-386" aria-hidden="true" tabindex="-1"></a><span class="in">pred_civlib &lt;- model_basic %&gt;% </span></span>
<span id="cb34-387"><a href="#cb34-387" aria-hidden="true" tabindex="-1"></a><span class="in">  epred_draws(newdata = expand_grid(party_autonomy = FALSE,</span></span>
<span id="cb34-388"><a href="#cb34-388" aria-hidden="true" tabindex="-1"></a><span class="in">                                    region = "Middle East and North Africa",</span></span>
<span id="cb34-389"><a href="#cb34-389" aria-hidden="true" tabindex="-1"></a><span class="in">                                    civil_liberties = seq(0, 1, by = 0.05)))</span></span>
<span id="cb34-390"><a href="#cb34-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-391"><a href="#cb34-391" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(pred_civlib, aes(x = civil_liberties, y = .epred)) +</span></span>
<span id="cb34-392"><a href="#cb34-392" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_lineribbon() + </span></span>
<span id="cb34-393"><a href="#cb34-393" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_brewer(palette = "Reds") +</span></span>
<span id="cb34-394"><a href="#cb34-394" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Civil liberties index", y = "Predicted media freedom index",</span></span>
<span id="cb34-395"><a href="#cb34-395" aria-hidden="true" tabindex="-1"></a><span class="in">       fill = "Credible interval") +</span></span>
<span id="cb34-396"><a href="#cb34-396" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() +</span></span>
<span id="cb34-397"><a href="#cb34-397" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb34-398"><a href="#cb34-398" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-399"><a href="#cb34-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-400"><a href="#cb34-400" aria-hidden="true" tabindex="-1"></a>The <span class="in">`emtrends()`</span> function from **emmeans** lets us find the slope at different hypothetical values. (Technically behind the scenes, if we tell it to show us the slope when <span class="in">`civil_liberties`</span> is 0.5, it'll calculate the predicted value at 0.5 and the predicted value at 0.50001, and then average those predictions, rather than try to figure out the true calculus-based derivative).</span>
<span id="cb34-401"><a href="#cb34-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-402"><a href="#cb34-402" aria-hidden="true" tabindex="-1"></a>If we don't specify possible values of <span class="in">`civil_liberties`</span>, it will give us the slope at the average value of <span class="in">`civil_liberties`</span> (0.698):</span>
<span id="cb34-403"><a href="#cb34-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-404"><a href="#cb34-404" aria-hidden="true" tabindex="-1"></a><span class="in">```{r civlib-effect-mean}</span></span>
<span id="cb34-405"><a href="#cb34-405" aria-hidden="true" tabindex="-1"></a><span class="in">model_basic %&gt;% </span></span>
<span id="cb34-406"><a href="#cb34-406" aria-hidden="true" tabindex="-1"></a><span class="in">  emtrends(~ civil_liberties,</span></span>
<span id="cb34-407"><a href="#cb34-407" aria-hidden="true" tabindex="-1"></a><span class="in">           var = "civil_liberties",</span></span>
<span id="cb34-408"><a href="#cb34-408" aria-hidden="true" tabindex="-1"></a><span class="in">           at = list(party_autonomy = FALSE,</span></span>
<span id="cb34-409"><a href="#cb34-409" aria-hidden="true" tabindex="-1"></a><span class="in">                     region = "Middle East and North Africa"),</span></span>
<span id="cb34-410"><a href="#cb34-410" aria-hidden="true" tabindex="-1"></a><span class="in">           epred = TRUE)</span></span>
<span id="cb34-411"><a href="#cb34-411" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-412"><a href="#cb34-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-413"><a href="#cb34-413" aria-hidden="true" tabindex="-1"></a>If we use <span class="in">`~ 1`</span> in the formula instead of <span class="in">`~ civil_liberties`</span>, it will give us the average overall slope:</span>
<span id="cb34-414"><a href="#cb34-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-415"><a href="#cb34-415" aria-hidden="true" tabindex="-1"></a><span class="in">```{r civlib-effect-overall}</span></span>
<span id="cb34-416"><a href="#cb34-416" aria-hidden="true" tabindex="-1"></a><span class="in">model_basic %&gt;% </span></span>
<span id="cb34-417"><a href="#cb34-417" aria-hidden="true" tabindex="-1"></a><span class="in">  emtrends(~ 1,</span></span>
<span id="cb34-418"><a href="#cb34-418" aria-hidden="true" tabindex="-1"></a><span class="in">           var = "civil_liberties",</span></span>
<span id="cb34-419"><a href="#cb34-419" aria-hidden="true" tabindex="-1"></a><span class="in">           at = list(party_autonomy = FALSE,</span></span>
<span id="cb34-420"><a href="#cb34-420" aria-hidden="true" tabindex="-1"></a><span class="in">                     region = "Middle East and North Africa"),</span></span>
<span id="cb34-421"><a href="#cb34-421" aria-hidden="true" tabindex="-1"></a><span class="in">           epred = TRUE)</span></span>
<span id="cb34-422"><a href="#cb34-422" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-423"><a href="#cb34-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-424"><a href="#cb34-424" aria-hidden="true" tabindex="-1"></a>Or we can specify specific values of <span class="in">`civil_liberties`</span> to get the slope at those points:</span>
<span id="cb34-425"><a href="#cb34-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-426"><a href="#cb34-426" aria-hidden="true" tabindex="-1"></a><span class="in">```{r civlib-effect-arbitrary}</span></span>
<span id="cb34-427"><a href="#cb34-427" aria-hidden="true" tabindex="-1"></a><span class="in">model_basic %&gt;% </span></span>
<span id="cb34-428"><a href="#cb34-428" aria-hidden="true" tabindex="-1"></a><span class="in">  emtrends(~ civil_liberties,</span></span>
<span id="cb34-429"><a href="#cb34-429" aria-hidden="true" tabindex="-1"></a><span class="in">           var = "civil_liberties",</span></span>
<span id="cb34-430"><a href="#cb34-430" aria-hidden="true" tabindex="-1"></a><span class="in">           at = list(party_autonomy = FALSE,</span></span>
<span id="cb34-431"><a href="#cb34-431" aria-hidden="true" tabindex="-1"></a><span class="in">                     region = "Middle East and North Africa",</span></span>
<span id="cb34-432"><a href="#cb34-432" aria-hidden="true" tabindex="-1"></a><span class="in">                     civil_liberties = c(0.2, 0.5, 0.8)),</span></span>
<span id="cb34-433"><a href="#cb34-433" aria-hidden="true" tabindex="-1"></a><span class="in">           epred = TRUE)</span></span>
<span id="cb34-434"><a href="#cb34-434" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-435"><a href="#cb34-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-436"><a href="#cb34-436" aria-hidden="true" tabindex="-1"></a>The civil liberties effect varies a lot depending on existing levels of civil liberties! Let's visualize these three effects. We'll scale the effect down, though, since civil liberties is on a 0–1 scale and a 1-unit change means going from 0 to 1, which is huge. We'll think about this as a 0.1-point increase in the civil liberties scale.</span>
<span id="cb34-437"><a href="#cb34-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-438"><a href="#cb34-438" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-civlib-effect}</span></span>
<span id="cb34-439"><a href="#cb34-439" aria-hidden="true" tabindex="-1"></a><span class="in">ame_civlib &lt;- model_basic %&gt;% </span></span>
<span id="cb34-440"><a href="#cb34-440" aria-hidden="true" tabindex="-1"></a><span class="in">  emtrends(~ civil_liberties,</span></span>
<span id="cb34-441"><a href="#cb34-441" aria-hidden="true" tabindex="-1"></a><span class="in">           var = "civil_liberties",</span></span>
<span id="cb34-442"><a href="#cb34-442" aria-hidden="true" tabindex="-1"></a><span class="in">           at = list(party_autonomy = FALSE,</span></span>
<span id="cb34-443"><a href="#cb34-443" aria-hidden="true" tabindex="-1"></a><span class="in">                     region = "Middle East and North Africa",</span></span>
<span id="cb34-444"><a href="#cb34-444" aria-hidden="true" tabindex="-1"></a><span class="in">                     civil_liberties = c(0.2, 0.5, 0.8)),</span></span>
<span id="cb34-445"><a href="#cb34-445" aria-hidden="true" tabindex="-1"></a><span class="in">           epred = TRUE) %&gt;% </span></span>
<span id="cb34-446"><a href="#cb34-446" aria-hidden="true" tabindex="-1"></a><span class="in">  gather_emmeans_draws() %&gt;% </span></span>
<span id="cb34-447"><a href="#cb34-447" aria-hidden="true" tabindex="-1"></a><span class="in">  # Scale this down</span></span>
<span id="cb34-448"><a href="#cb34-448" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(.value = .value / 10)</span></span>
<span id="cb34-449"><a href="#cb34-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-450"><a href="#cb34-450" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(ame_civlib, aes(x = .value, fill = factor(civil_liberties))) +</span></span>
<span id="cb34-451"><a href="#cb34-451" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye(slab_alpha = 0.75) +</span></span>
<span id="cb34-452"><a href="#cb34-452" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_okabe_ito(order = c(3, 4, 6)) +</span></span>
<span id="cb34-453"><a href="#cb34-453" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Average marginal effect of a\n0.1-point increase in the civil liberties index",</span></span>
<span id="cb34-454"><a href="#cb34-454" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Density", fill = "Civil liberties index",</span></span>
<span id="cb34-455"><a href="#cb34-455" aria-hidden="true" tabindex="-1"></a><span class="in">       caption = "80% and 95% credible intervals shown in black") +</span></span>
<span id="cb34-456"><a href="#cb34-456" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() + </span></span>
<span id="cb34-457"><a href="#cb34-457" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb34-458"><a href="#cb34-458" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-459"><a href="#cb34-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-460"><a href="#cb34-460" aria-hidden="true" tabindex="-1"></a>For countries with low levels of civil liberties, a 0.1-point increase in respect for civil liberties (e.g., moving from 0.2 to 0.3) is associated with a 0.0436-point increase in the media freedom index. For a middle ground country, though, moving from 0.5 to 0.6 in civil liberties is associated with a 0.0763-point increase in the media freedom index, while countries with strong civil liberties see a strong increase in the media freedom index (0.0833 points). Cool cool cool.</span>
<span id="cb34-461"><a href="#cb34-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-462"><a href="#cb34-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-463"><a href="#cb34-463" aria-hidden="true" tabindex="-1"></a><span class="fu">## Different kinds of average predictions with multilevel models</span></span>
<span id="cb34-464"><a href="#cb34-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-465"><a href="#cb34-465" aria-hidden="true" tabindex="-1"></a>**BUT THERE'S A HUGE CAVEAT HERE!** </span>
<span id="cb34-466"><a href="#cb34-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-467"><a href="#cb34-467" aria-hidden="true" tabindex="-1"></a>Guess what?! All these predicted average effects aren't quite what we think they are. (That's what TJ was referring to in the tweet at the beginning of this post!) </span>
<span id="cb34-468"><a href="#cb34-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-469"><a href="#cb34-469" aria-hidden="true" tabindex="-1"></a>Because we're working with multilevel models, we actually have other moving parts to think about: the regional effects. When we talk about average marginal effects with multilevel models, we have to be explicit about what kinds of averages we're working with. There are a few different kinds of averages we can calculate:</span>
<span id="cb34-470"><a href="#cb34-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-471"><a href="#cb34-471" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Global grand mean</span>
<span id="cb34-472"><a href="#cb34-472" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Conditional effects for existing groups</span>
<span id="cb34-473"><a href="#cb34-473" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Conditional effects for a single hypothetical group, either typical or brand new</span>
<span id="cb34-474"><a href="#cb34-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-475"><a href="#cb34-475" aria-hidden="true" tabindex="-1"></a>We can specify all these different kinds of calculations with certain combinations of a few arguments to <span class="in">`posterior_epred()`</span> / <span class="in">`epred_draws()`</span> / <span class="in">`emmeans()`</span> / <span class="in">`emmtrends()`</span>:</span>
<span id="cb34-476"><a href="#cb34-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-477"><a href="#cb34-477" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`newdata`</span>: Specify which regions to include in the predictions</span>
<span id="cb34-478"><a href="#cb34-478" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`re_formula`</span>: Specify how (and whether) to handle the model's random effects in the predictions</span>
<span id="cb34-479"><a href="#cb34-479" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`sample_new_levels`</span>: Specify how to handle the uncertainty in new random effects in the predictions</span>
<span id="cb34-480"><a href="#cb34-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-481"><a href="#cb34-481" aria-hidden="true" tabindex="-1"></a>(These are all documented in the help pages for <span class="in">`?brms::prepare_predictions()`</span>)</span>
<span id="cb34-482"><a href="#cb34-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-483"><a href="#cb34-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-484"><a href="#cb34-484" aria-hidden="true" tabindex="-1"></a><span class="fu">### Global grand mean</span></span>
<span id="cb34-485"><a href="#cb34-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-486"><a href="#cb34-486" aria-hidden="true" tabindex="-1"></a>With a global grand mean, we calculate the expected value of the media freedom index **while ignoring any region-specific deviations of the intercept or slope.** We do not incorporate any of the region-specific information from the model into the predictions. This provides us with a global grand mean—an average that transcends regional differences.</span>
<span id="cb34-487"><a href="#cb34-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-488"><a href="#cb34-488" aria-hidden="true" tabindex="-1"></a>To calculate this, we need to feed **brms** a new dataset that doesn't include any region, and we need to tell it to not use any random effects by including <span class="in">`re_formula = NA`</span>. </span>
<span id="cb34-489"><a href="#cb34-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-490"><a href="#cb34-490" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Binary effect</span></span>
<span id="cb34-491"><a href="#cb34-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-492"><a href="#cb34-492" aria-hidden="true" tabindex="-1"></a>Let's look at the global average marginal effect for party autonomy, which is binary:</span>
<span id="cb34-493"><a href="#cb34-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-494"><a href="#cb34-494" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-grand-mean-binary, fig.width=7, out.width="100%", warning=FALSE}</span></span>
<span id="cb34-495"><a href="#cb34-495" aria-hidden="true" tabindex="-1"></a><span class="in"># Posterior predictions across autonomy</span></span>
<span id="cb34-496"><a href="#cb34-496" aria-hidden="true" tabindex="-1"></a><span class="in">grand_mean_autonomy_dist &lt;- model_basic %&gt;% </span></span>
<span id="cb34-497"><a href="#cb34-497" aria-hidden="true" tabindex="-1"></a><span class="in">  epred_draws(newdata = expand_grid(party_autonomy = c(TRUE, FALSE),</span></span>
<span id="cb34-498"><a href="#cb34-498" aria-hidden="true" tabindex="-1"></a><span class="in">                                    civil_liberties = c(0.5)), </span></span>
<span id="cb34-499"><a href="#cb34-499" aria-hidden="true" tabindex="-1"></a><span class="in">              re_formula = NA)</span></span>
<span id="cb34-500"><a href="#cb34-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-501"><a href="#cb34-501" aria-hidden="true" tabindex="-1"></a><span class="in">plot_grand_mean_autonomy &lt;- ggplot(grand_mean_autonomy_dist, </span></span>
<span id="cb34-502"><a href="#cb34-502" aria-hidden="true" tabindex="-1"></a><span class="in">                                   aes(x = .epred, y = "Grand mean", </span></span>
<span id="cb34-503"><a href="#cb34-503" aria-hidden="true" tabindex="-1"></a><span class="in">                                       fill = party_autonomy)) +</span></span>
<span id="cb34-504"><a href="#cb34-504" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye() +</span></span>
<span id="cb34-505"><a href="#cb34-505" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_okabe_ito() +</span></span>
<span id="cb34-506"><a href="#cb34-506" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Predicted media index", y = NULL,</span></span>
<span id="cb34-507"><a href="#cb34-507" aria-hidden="true" tabindex="-1"></a><span class="in">       fill = "Opposition parties allowed",</span></span>
<span id="cb34-508"><a href="#cb34-508" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = "Posterior predictions") +</span></span>
<span id="cb34-509"><a href="#cb34-509" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() +</span></span>
<span id="cb34-510"><a href="#cb34-510" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb34-511"><a href="#cb34-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-512"><a href="#cb34-512" aria-hidden="true" tabindex="-1"></a><span class="in"># emmeans()-based difference across autonomy</span></span>
<span id="cb34-513"><a href="#cb34-513" aria-hidden="true" tabindex="-1"></a><span class="in">grand_mean_autonomy_ame &lt;- model_basic %&gt;% </span></span>
<span id="cb34-514"><a href="#cb34-514" aria-hidden="true" tabindex="-1"></a><span class="in">  emmeans(~ party_autonomy,</span></span>
<span id="cb34-515"><a href="#cb34-515" aria-hidden="true" tabindex="-1"></a><span class="in">          at = list(civil_liberties = 0.5),</span></span>
<span id="cb34-516"><a href="#cb34-516" aria-hidden="true" tabindex="-1"></a><span class="in">          epred = TRUE, re_formula = NA) %&gt;% </span></span>
<span id="cb34-517"><a href="#cb34-517" aria-hidden="true" tabindex="-1"></a><span class="in">  contrast(method = "revpairwise") %&gt;% </span></span>
<span id="cb34-518"><a href="#cb34-518" aria-hidden="true" tabindex="-1"></a><span class="in">  gather_emmeans_draws()</span></span>
<span id="cb34-519"><a href="#cb34-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-520"><a href="#cb34-520" aria-hidden="true" tabindex="-1"></a><span class="in">plot_grand_mean_autonomy_ame &lt;- ggplot(grand_mean_autonomy_ame, </span></span>
<span id="cb34-521"><a href="#cb34-521" aria-hidden="true" tabindex="-1"></a><span class="in">                                   aes(x = .value, y = "Grand AME")) +</span></span>
<span id="cb34-522"><a href="#cb34-522" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye(fill = palette_okabe_ito(order = 7)) +</span></span>
<span id="cb34-523"><a href="#cb34-523" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Average marginal effect of party autonomy", y = NULL,</span></span>
<span id="cb34-524"><a href="#cb34-524" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = "Marginal effect (TRUE − FALSE)") +</span></span>
<span id="cb34-525"><a href="#cb34-525" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() +</span></span>
<span id="cb34-526"><a href="#cb34-526" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb34-527"><a href="#cb34-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-528"><a href="#cb34-528" aria-hidden="true" tabindex="-1"></a><span class="in"># Combined plot</span></span>
<span id="cb34-529"><a href="#cb34-529" aria-hidden="true" tabindex="-1"></a><span class="in">(plot_grand_mean_autonomy | plot_grand_mean_autonomy_ame) +</span></span>
<span id="cb34-530"><a href="#cb34-530" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_annotation(title = "Global grand mean",</span></span>
<span id="cb34-531"><a href="#cb34-531" aria-hidden="true" tabindex="-1"></a><span class="in">                  subtitle = "re_formula = NA; no region in newdata",</span></span>
<span id="cb34-532"><a href="#cb34-532" aria-hidden="true" tabindex="-1"></a><span class="in">                  theme = theme_clean())</span></span>
<span id="cb34-533"><a href="#cb34-533" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-534"><a href="#cb34-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-535"><a href="#cb34-535" aria-hidden="true" tabindex="-1"></a>And here are the actual medians and credible intervals:</span>
<span id="cb34-536"><a href="#cb34-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-537"><a href="#cb34-537" aria-hidden="true" tabindex="-1"></a><span class="in">```{r grand-mean-autonomy-median}</span></span>
<span id="cb34-538"><a href="#cb34-538" aria-hidden="true" tabindex="-1"></a><span class="in">grand_mean_autonomy_ame %&gt;% median_hdi()</span></span>
<span id="cb34-539"><a href="#cb34-539" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-540"><a href="#cb34-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-541"><a href="#cb34-541" aria-hidden="true" tabindex="-1"></a>The region-free grand average marginal effect for party autonomy is thus 0.247.</span>
<span id="cb34-542"><a href="#cb34-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-543"><a href="#cb34-543" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Continuous effect</span></span>
<span id="cb34-544"><a href="#cb34-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-545"><a href="#cb34-545" aria-hidden="true" tabindex="-1"></a>Next we can look at the average marginal effect for civil liberties, which is continuous:</span>
<span id="cb34-546"><a href="#cb34-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-547"><a href="#cb34-547" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-grand-mean-continuous, fig.width=7, out.width="100%", warning=FALSE}</span></span>
<span id="cb34-548"><a href="#cb34-548" aria-hidden="true" tabindex="-1"></a><span class="in"># Posterior predictions across civil_liberties</span></span>
<span id="cb34-549"><a href="#cb34-549" aria-hidden="true" tabindex="-1"></a><span class="in">grand_mean_civlib_dist &lt;- model_basic %&gt;% </span></span>
<span id="cb34-550"><a href="#cb34-550" aria-hidden="true" tabindex="-1"></a><span class="in">  epred_draws(newdata = expand_grid(party_autonomy = FALSE,</span></span>
<span id="cb34-551"><a href="#cb34-551" aria-hidden="true" tabindex="-1"></a><span class="in">                                    civil_liberties = seq(0, 1, by = 0.05)), </span></span>
<span id="cb34-552"><a href="#cb34-552" aria-hidden="true" tabindex="-1"></a><span class="in">              re_formula = NA)</span></span>
<span id="cb34-553"><a href="#cb34-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-554"><a href="#cb34-554" aria-hidden="true" tabindex="-1"></a><span class="in">plot_grand_mean_civlib &lt;- ggplot(grand_mean_civlib_dist, </span></span>
<span id="cb34-555"><a href="#cb34-555" aria-hidden="true" tabindex="-1"></a><span class="in">                                 aes(x = civil_liberties, y = .epred)) +</span></span>
<span id="cb34-556"><a href="#cb34-556" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_lineribbon() +</span></span>
<span id="cb34-557"><a href="#cb34-557" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_brewer(palette = "Reds") +</span></span>
<span id="cb34-558"><a href="#cb34-558" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Civil liberties index", y = "Predicted media freedom index",</span></span>
<span id="cb34-559"><a href="#cb34-559" aria-hidden="true" tabindex="-1"></a><span class="in">       fill = "Credible interval") +</span></span>
<span id="cb34-560"><a href="#cb34-560" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() +</span></span>
<span id="cb34-561"><a href="#cb34-561" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb34-562"><a href="#cb34-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-563"><a href="#cb34-563" aria-hidden="true" tabindex="-1"></a><span class="in"># emtrends()-based AMEs</span></span>
<span id="cb34-564"><a href="#cb34-564" aria-hidden="true" tabindex="-1"></a><span class="in">grand_mean_civlib_ame &lt;- model_basic %&gt;% </span></span>
<span id="cb34-565"><a href="#cb34-565" aria-hidden="true" tabindex="-1"></a><span class="in">  emtrends(~ civil_liberties,</span></span>
<span id="cb34-566"><a href="#cb34-566" aria-hidden="true" tabindex="-1"></a><span class="in">           var = "civil_liberties",</span></span>
<span id="cb34-567"><a href="#cb34-567" aria-hidden="true" tabindex="-1"></a><span class="in">           at = list(party_autonomy = FALSE,</span></span>
<span id="cb34-568"><a href="#cb34-568" aria-hidden="true" tabindex="-1"></a><span class="in">                     civil_liberties = c(0.2, 0.8)),</span></span>
<span id="cb34-569"><a href="#cb34-569" aria-hidden="true" tabindex="-1"></a><span class="in">           epred = TRUE, re_formula = NA) %&gt;% </span></span>
<span id="cb34-570"><a href="#cb34-570" aria-hidden="true" tabindex="-1"></a><span class="in">  gather_emmeans_draws()</span></span>
<span id="cb34-571"><a href="#cb34-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-572"><a href="#cb34-572" aria-hidden="true" tabindex="-1"></a><span class="in">plot_grand_mean_civlib_ame &lt;- ggplot(grand_mean_civlib_ame,</span></span>
<span id="cb34-573"><a href="#cb34-573" aria-hidden="true" tabindex="-1"></a><span class="in">                                     aes(x = .value / 10, fill = factor(civil_liberties))) +</span></span>
<span id="cb34-574"><a href="#cb34-574" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye(slab_alpha = 0.75) +</span></span>
<span id="cb34-575"><a href="#cb34-575" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_okabe_ito(order = c(3, 4)) +</span></span>
<span id="cb34-576"><a href="#cb34-576" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Average marginal effect of a\n0.1-point increase in the civil liberties index",</span></span>
<span id="cb34-577"><a href="#cb34-577" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Density", fill = "Civil liberties index") +</span></span>
<span id="cb34-578"><a href="#cb34-578" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() + </span></span>
<span id="cb34-579"><a href="#cb34-579" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb34-580"><a href="#cb34-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-581"><a href="#cb34-581" aria-hidden="true" tabindex="-1"></a><span class="in"># Combined plot</span></span>
<span id="cb34-582"><a href="#cb34-582" aria-hidden="true" tabindex="-1"></a><span class="in">(plot_grand_mean_civlib | plot_grand_mean_civlib_ame) +</span></span>
<span id="cb34-583"><a href="#cb34-583" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_annotation(title = "Grand mean",</span></span>
<span id="cb34-584"><a href="#cb34-584" aria-hidden="true" tabindex="-1"></a><span class="in">                  subtitle = "re_formula = NA; no region in newdata",</span></span>
<span id="cb34-585"><a href="#cb34-585" aria-hidden="true" tabindex="-1"></a><span class="in">                  theme = theme_clean())</span></span>
<span id="cb34-586"><a href="#cb34-586" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-587"><a href="#cb34-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-588"><a href="#cb34-588" aria-hidden="true" tabindex="-1"></a>And here are the actual medians for these effects:</span>
<span id="cb34-589"><a href="#cb34-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-590"><a href="#cb34-590" aria-hidden="true" tabindex="-1"></a><span class="in">```{r grand-mean-civlib-median}</span></span>
<span id="cb34-591"><a href="#cb34-591" aria-hidden="true" tabindex="-1"></a><span class="in">grand_mean_civlib_ame %&gt;% median_hdi()</span></span>
<span id="cb34-592"><a href="#cb34-592" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-593"><a href="#cb34-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-594"><a href="#cb34-594" aria-hidden="true" tabindex="-1"></a>The region-free grand average marginal effect for civil liberties is 0.436 for low values of civil liberties (0.2), and 0.833 for high values (0.8).</span>
<span id="cb34-595"><a href="#cb34-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-596"><a href="#cb34-596" aria-hidden="true" tabindex="-1"></a><span class="fu">### Conditional effects for existing groups</span></span>
<span id="cb34-597"><a href="#cb34-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-598"><a href="#cb34-598" aria-hidden="true" tabindex="-1"></a>Instead of calculating a grand mean without any group information, we can incorporate regional effects into our predictions. We can create **conditional effects for specific regions that already exist in the data, incorporating their region-specific deviations in slope and intercept.**</span>
<span id="cb34-599"><a href="#cb34-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-600"><a href="#cb34-600" aria-hidden="true" tabindex="-1"></a>To calculate this, we need to feed **brms** a new dataset that *does* include one or more regions that are already in the data, and we need to tell it to incorporate the random effects into its predictions by including <span class="in">`re_formula = NULL`</span>. That feels weird, since <span class="in">`re_formula = NA`</span> made it so there were no group effects, but that's the syntax. </span>
<span id="cb34-601"><a href="#cb34-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-602"><a href="#cb34-602" aria-hidden="true" tabindex="-1"></a>We can also be more explicit about which group effects to include. When using <span class="in">`re_formula = NULL`</span>, *all* group effects are included. If we made a model with both region and year effects, for instance, and only wanted to predict using the region effects, we could use <span class="in">`re_formula = ~ (1 | region)`</span>. Or if we don't want to remember that <span class="in">`NULL`</span> means "everything", we could also just use <span class="in">`re_formula = ~ (1 | region)`</span> on our basic model with just regional effects. It's all the same.</span>
<span id="cb34-603"><a href="#cb34-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-604"><a href="#cb34-604" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Binary effect</span></span>
<span id="cb34-605"><a href="#cb34-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-606"><a href="#cb34-606" aria-hidden="true" tabindex="-1"></a>Let's look at the binary region-specific average marginal effect for party autonomy across all six regions:</span>
<span id="cb34-607"><a href="#cb34-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-608"><a href="#cb34-608" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-all-regions-binary, fig.width=7, out.width="100%", fig.asp=0.7}</span></span>
<span id="cb34-609"><a href="#cb34-609" aria-hidden="true" tabindex="-1"></a><span class="in"># Posterior predictions across autonomy and region</span></span>
<span id="cb34-610"><a href="#cb34-610" aria-hidden="true" tabindex="-1"></a><span class="in">all_regions_autonomy_dist &lt;- model_basic %&gt;% </span></span>
<span id="cb34-611"><a href="#cb34-611" aria-hidden="true" tabindex="-1"></a><span class="in">  epred_draws(newdata = expand_grid(party_autonomy = c(TRUE, FALSE),</span></span>
<span id="cb34-612"><a href="#cb34-612" aria-hidden="true" tabindex="-1"></a><span class="in">                                    region = levels(vdem_2015$region),</span></span>
<span id="cb34-613"><a href="#cb34-613" aria-hidden="true" tabindex="-1"></a><span class="in">                                    civil_liberties = c(0.5)), </span></span>
<span id="cb34-614"><a href="#cb34-614" aria-hidden="true" tabindex="-1"></a><span class="in">              re_formula = NULL)  # or re_formula = ~ (1 | region)</span></span>
<span id="cb34-615"><a href="#cb34-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-616"><a href="#cb34-616" aria-hidden="true" tabindex="-1"></a><span class="in">plot_all_regions_autonomy &lt;- ggplot(all_regions_autonomy_dist, </span></span>
<span id="cb34-617"><a href="#cb34-617" aria-hidden="true" tabindex="-1"></a><span class="in">                                    aes(x = .epred, y = region, </span></span>
<span id="cb34-618"><a href="#cb34-618" aria-hidden="true" tabindex="-1"></a><span class="in">                                        fill = party_autonomy)) +</span></span>
<span id="cb34-619"><a href="#cb34-619" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye() +</span></span>
<span id="cb34-620"><a href="#cb34-620" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_okabe_ito() +</span></span>
<span id="cb34-621"><a href="#cb34-621" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Predicted media index", y = NULL,</span></span>
<span id="cb34-622"><a href="#cb34-622" aria-hidden="true" tabindex="-1"></a><span class="in">       fill = "Opposition parties allowed",</span></span>
<span id="cb34-623"><a href="#cb34-623" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = "Posterior predictions") +</span></span>
<span id="cb34-624"><a href="#cb34-624" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() +</span></span>
<span id="cb34-625"><a href="#cb34-625" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb34-626"><a href="#cb34-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-627"><a href="#cb34-627" aria-hidden="true" tabindex="-1"></a><span class="in"># emmeans()-based difference across autonomy, by region</span></span>
<span id="cb34-628"><a href="#cb34-628" aria-hidden="true" tabindex="-1"></a><span class="in">all_regions_autonomy_ame &lt;- model_basic %&gt;% </span></span>
<span id="cb34-629"><a href="#cb34-629" aria-hidden="true" tabindex="-1"></a><span class="in">  emmeans(~ party_autonomy + region,</span></span>
<span id="cb34-630"><a href="#cb34-630" aria-hidden="true" tabindex="-1"></a><span class="in">          at = list(civil_liberties = 0.5,</span></span>
<span id="cb34-631"><a href="#cb34-631" aria-hidden="true" tabindex="-1"></a><span class="in">                    region = levels(vdem_2015$region)),</span></span>
<span id="cb34-632"><a href="#cb34-632" aria-hidden="true" tabindex="-1"></a><span class="in">          epred = TRUE, re_formula = NULL) %&gt;% </span></span>
<span id="cb34-633"><a href="#cb34-633" aria-hidden="true" tabindex="-1"></a><span class="in">  contrast(method = "revpairwise", by = "region") %&gt;% </span></span>
<span id="cb34-634"><a href="#cb34-634" aria-hidden="true" tabindex="-1"></a><span class="in">  gather_emmeans_draws()</span></span>
<span id="cb34-635"><a href="#cb34-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-636"><a href="#cb34-636" aria-hidden="true" tabindex="-1"></a><span class="in">plot_all_regions_autonomy_ame &lt;- ggplot(all_regions_autonomy_ame, </span></span>
<span id="cb34-637"><a href="#cb34-637" aria-hidden="true" tabindex="-1"></a><span class="in">                                        aes(x = .value, y = region)) +</span></span>
<span id="cb34-638"><a href="#cb34-638" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye(fill = palette_okabe_ito(order = 7)) +</span></span>
<span id="cb34-639"><a href="#cb34-639" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Average marginal effect of party autonomy", y = NULL,</span></span>
<span id="cb34-640"><a href="#cb34-640" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = "Marginal effect (TRUE − FALSE)") +</span></span>
<span id="cb34-641"><a href="#cb34-641" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() +</span></span>
<span id="cb34-642"><a href="#cb34-642" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb34-643"><a href="#cb34-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-644"><a href="#cb34-644" aria-hidden="true" tabindex="-1"></a><span class="in"># Combined plot</span></span>
<span id="cb34-645"><a href="#cb34-645" aria-hidden="true" tabindex="-1"></a><span class="in">(plot_all_regions_autonomy | plot_all_regions_autonomy_ame + theme(axis.text.y = element_blank())) +</span></span>
<span id="cb34-646"><a href="#cb34-646" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_annotation(title = "Region-specific means",</span></span>
<span id="cb34-647"><a href="#cb34-647" aria-hidden="true" tabindex="-1"></a><span class="in">                  subtitle = "re_formula = NULL; existing region(s) included in newdata",</span></span>
<span id="cb34-648"><a href="#cb34-648" aria-hidden="true" tabindex="-1"></a><span class="in">                  theme = theme_clean())</span></span>
<span id="cb34-649"><a href="#cb34-649" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-650"><a href="#cb34-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-651"><a href="#cb34-651" aria-hidden="true" tabindex="-1"></a>And here are the actual medians and credible intervals:</span>
<span id="cb34-652"><a href="#cb34-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-653"><a href="#cb34-653" aria-hidden="true" tabindex="-1"></a><span class="in">```{r all-regions-autonomy-median}</span></span>
<span id="cb34-654"><a href="#cb34-654" aria-hidden="true" tabindex="-1"></a><span class="in">all_regions_autonomy_ame %&gt;% median_hdi()</span></span>
<span id="cb34-655"><a href="#cb34-655" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-656"><a href="#cb34-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-657"><a href="#cb34-657" aria-hidden="true" tabindex="-1"></a>The average marginal effect changes depending on region, but not by much. Across all regions, having party autonomy is associated with a 0.24 to 0.25-point increase in the media freedom index, on average. Importantly, these average effects incorporate the uncertainty that comes from the regional multilevel structure that we built in the model.</span>
<span id="cb34-658"><a href="#cb34-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-659"><a href="#cb34-659" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Continuous effect</span></span>
<span id="cb34-660"><a href="#cb34-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-661"><a href="#cb34-661" aria-hidden="true" tabindex="-1"></a>Next we'll look at the continuous region-specific average marginal effect for civil liberties across all six regions:</span>
<span id="cb34-662"><a href="#cb34-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-663"><a href="#cb34-663" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-all-regions-continuous, fig.width=8, fig.asp=1.3, out.width="100%", warning=FALSE}</span></span>
<span id="cb34-664"><a href="#cb34-664" aria-hidden="true" tabindex="-1"></a><span class="in"># Posterior predictions across civil_liberties and regions</span></span>
<span id="cb34-665"><a href="#cb34-665" aria-hidden="true" tabindex="-1"></a><span class="in">all_regions_civlib_dist &lt;- model_basic %&gt;% </span></span>
<span id="cb34-666"><a href="#cb34-666" aria-hidden="true" tabindex="-1"></a><span class="in">  epred_draws(newdata = expand_grid(party_autonomy = FALSE,</span></span>
<span id="cb34-667"><a href="#cb34-667" aria-hidden="true" tabindex="-1"></a><span class="in">                                    civil_liberties = seq(0, 1, by = 0.05),</span></span>
<span id="cb34-668"><a href="#cb34-668" aria-hidden="true" tabindex="-1"></a><span class="in">                                    region = levels(vdem_2015$region)), </span></span>
<span id="cb34-669"><a href="#cb34-669" aria-hidden="true" tabindex="-1"></a><span class="in">              re_formula = NULL)</span></span>
<span id="cb34-670"><a href="#cb34-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-671"><a href="#cb34-671" aria-hidden="true" tabindex="-1"></a><span class="in">plot_all_regions_civlib &lt;- ggplot(all_regions_civlib_dist, </span></span>
<span id="cb34-672"><a href="#cb34-672" aria-hidden="true" tabindex="-1"></a><span class="in">                                  aes(x = civil_liberties, y = .epred)) +</span></span>
<span id="cb34-673"><a href="#cb34-673" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_lineribbon() +</span></span>
<span id="cb34-674"><a href="#cb34-674" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_brewer(palette = "Reds") +</span></span>
<span id="cb34-675"><a href="#cb34-675" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Civil liberties index", y = "Predicted media freedom index",</span></span>
<span id="cb34-676"><a href="#cb34-676" aria-hidden="true" tabindex="-1"></a><span class="in">       fill = "Credible interval") +</span></span>
<span id="cb34-677"><a href="#cb34-677" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(region)) +</span></span>
<span id="cb34-678"><a href="#cb34-678" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() +</span></span>
<span id="cb34-679"><a href="#cb34-679" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb34-680"><a href="#cb34-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-681"><a href="#cb34-681" aria-hidden="true" tabindex="-1"></a><span class="in"># emtrends()-based AMEs across region</span></span>
<span id="cb34-682"><a href="#cb34-682" aria-hidden="true" tabindex="-1"></a><span class="in">all_regions_civlib_ame &lt;- model_basic %&gt;% </span></span>
<span id="cb34-683"><a href="#cb34-683" aria-hidden="true" tabindex="-1"></a><span class="in">  emtrends(~ civil_liberties + region,</span></span>
<span id="cb34-684"><a href="#cb34-684" aria-hidden="true" tabindex="-1"></a><span class="in">           var = "civil_liberties",</span></span>
<span id="cb34-685"><a href="#cb34-685" aria-hidden="true" tabindex="-1"></a><span class="in">           at = list(party_autonomy = FALSE,</span></span>
<span id="cb34-686"><a href="#cb34-686" aria-hidden="true" tabindex="-1"></a><span class="in">                     civil_liberties = c(0.2, 0.8),</span></span>
<span id="cb34-687"><a href="#cb34-687" aria-hidden="true" tabindex="-1"></a><span class="in">                     region = levels(vdem_2015$region)),</span></span>
<span id="cb34-688"><a href="#cb34-688" aria-hidden="true" tabindex="-1"></a><span class="in">           epred = TRUE, re_formula = NULL) %&gt;% </span></span>
<span id="cb34-689"><a href="#cb34-689" aria-hidden="true" tabindex="-1"></a><span class="in">  gather_emmeans_draws()</span></span>
<span id="cb34-690"><a href="#cb34-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-691"><a href="#cb34-691" aria-hidden="true" tabindex="-1"></a><span class="in">plot_all_regions_civlib_ame &lt;- ggplot(all_regions_civlib_ame,</span></span>
<span id="cb34-692"><a href="#cb34-692" aria-hidden="true" tabindex="-1"></a><span class="in">                                     aes(x = .value / 10, fill = factor(civil_liberties))) +</span></span>
<span id="cb34-693"><a href="#cb34-693" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye(slab_alpha = 0.75) +</span></span>
<span id="cb34-694"><a href="#cb34-694" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_okabe_ito(order = c(3, 4)) +</span></span>
<span id="cb34-695"><a href="#cb34-695" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Average marginal effect of a\n0.1-point increase in the civil liberties index",</span></span>
<span id="cb34-696"><a href="#cb34-696" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Density", fill = "Civil liberties index") +</span></span>
<span id="cb34-697"><a href="#cb34-697" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(region)) +</span></span>
<span id="cb34-698"><a href="#cb34-698" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() + </span></span>
<span id="cb34-699"><a href="#cb34-699" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb34-700"><a href="#cb34-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-701"><a href="#cb34-701" aria-hidden="true" tabindex="-1"></a><span class="in">(plot_all_regions_civlib / plot_all_regions_civlib_ame) +</span></span>
<span id="cb34-702"><a href="#cb34-702" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_annotation(title = "Region-specific means",</span></span>
<span id="cb34-703"><a href="#cb34-703" aria-hidden="true" tabindex="-1"></a><span class="in">                  subtitle = "re_formula = NULL; existing region(s) included in newdata",</span></span>
<span id="cb34-704"><a href="#cb34-704" aria-hidden="true" tabindex="-1"></a><span class="in">                  theme = theme_clean())</span></span>
<span id="cb34-705"><a href="#cb34-705" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-706"><a href="#cb34-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-707"><a href="#cb34-707" aria-hidden="true" tabindex="-1"></a>And here are the actual medians for these effects:</span>
<span id="cb34-708"><a href="#cb34-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-709"><a href="#cb34-709" aria-hidden="true" tabindex="-1"></a><span class="in">```{r all-regions-civlib-median}</span></span>
<span id="cb34-710"><a href="#cb34-710" aria-hidden="true" tabindex="-1"></a><span class="in">all_regions_civlib_ame %&gt;% median_hdi()</span></span>
<span id="cb34-711"><a href="#cb34-711" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-712"><a href="#cb34-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-713"><a href="#cb34-713" aria-hidden="true" tabindex="-1"></a>As expected, the average marginal effect for civil liberties varies across regions. For the Middle East and North Africa, for instance, it is 0.49 for low values of civil liberties (0.2), and 0.8 for high values (0.8), while in Eastern Europe and Central Asia, it is 0.328 for low values and 0.865 for high values.</span>
<span id="cb34-714"><a href="#cb34-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-715"><a href="#cb34-715" aria-hidden="true" tabindex="-1"></a>Neat!</span>
<span id="cb34-716"><a href="#cb34-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-717"><a href="#cb34-717" aria-hidden="true" tabindex="-1"></a><span class="fu">### Conditional effects for a single new hypothetical group, either typical or brand new</span></span>
<span id="cb34-718"><a href="#cb34-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-719"><a href="#cb34-719" aria-hidden="true" tabindex="-1"></a>So far we've calculated a grand mean with no regional effects and a bunch of conditional means for specific regions. But what if we want a single mean that also includes regional effects?</span>
<span id="cb34-720"><a href="#cb34-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-721"><a href="#cb34-721" aria-hidden="true" tabindex="-1"></a>We have a few really nuanced options for doing this. In general, we'll create a brand new hypothetical region and make predictions based on it. Where the nuance comes into play is how we construct this region and think about its variation. We can build its variance based on an average of the existing regions' variances, or we can simulate a brand new kind of variance all together.</span>
<span id="cb34-722"><a href="#cb34-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-723"><a href="#cb34-723" aria-hidden="true" tabindex="-1"></a>To do this, we need to include region in the new data we feed **brms**, but we need to include a name of a region that doesn't exist (or alternatively, you can feed it <span class="in">`region = NA`</span>). It will yell at you initially because that group doesn't exist, but you can allow it to make these extrapolated predictions by including <span class="in">`allow_new_levels = TRUE`</span>. We can include the random effects for region by setting <span class="in">`re_formula = NULL`</span> (or <span class="in">`re_formula = ~ (1 | region)`</span> if we want to be super explicit).</span>
<span id="cb34-724"><a href="#cb34-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-725"><a href="#cb34-725" aria-hidden="true" tabindex="-1"></a>Finally, we have to specify how to handle the regional variation for this imaginary new group. We can either draw from the variation in all the other groups by setting <span class="in">`sample_new_levels = "uncertainty"`</span> (this is the default), or we can randomly simulate a whole new kind of regional uncertainty based on the model's existing parameters using <span class="in">`sample_new_levels = "gaussian"`</span>. The documentation for all this is included in <span class="in">`?brms::prepare_predictions`</span>.</span>
<span id="cb34-726"><a href="#cb34-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-727"><a href="#cb34-727" aria-hidden="true" tabindex="-1"></a>In summary, we have these two general approaches:</span>
<span id="cb34-728"><a href="#cb34-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-729"><a href="#cb34-729" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Create a hypothetical region that is based on the observed variation in the existing regions with <span class="in">`region = "Something new"`</span> in the new data and <span class="in">`re_formula = NULL, allow_new_levels = TRUE, sample_new_levels = "uncertainty"`</span> in the prediction function</span>
<span id="cb34-730"><a href="#cb34-730" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Create a hypothetical region that is completely brand new with <span class="in">`region = "Something new"`</span> in the new data and <span class="in">`re_formula = NULL, allow_new_levels = TRUE, sample_new_levels = "gaussian"`</span> in the prediction function</span>
<span id="cb34-731"><a href="#cb34-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-732"><a href="#cb34-732" aria-hidden="true" tabindex="-1"></a>For the sake of space I'll only show marginal effects for the binary <span class="in">`party_autonomy`</span> variable here. Follow the same process as all the examples above, but set <span class="in">`re_formula = NULL`</span>, <span class="in">`allow_new_levels = TRUE`</span>, and either <span class="in">`sample_new_levels = "uncertainty"`</span> or <span class="in">`sample_new_levels = "gaussian"`</span> when making the predictions.</span>
<span id="cb34-733"><a href="#cb34-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-734"><a href="#cb34-734" aria-hidden="true" tabindex="-1"></a>Technically there are other ways to create simulated groups or regions, like <span class="in">`sample_new_levels = "old_levels"`</span>. Isabella Ghement has a <span class="co">[</span><span class="ot">great comprehensive table summarizing them all here</span><span class="co">](https://twitter.com/isabellaghement/status/1458539033131302913)</span>. But we're not going to worry about that here.</span>
<span id="cb34-735"><a href="#cb34-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-736"><a href="#cb34-736" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Binary effect for amalgamated hypothetical region</span></span>
<span id="cb34-737"><a href="#cb34-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-738"><a href="#cb34-738" aria-hidden="true" tabindex="-1"></a>First we'll create predictions for a hypothetical region that draws its group characteristics and variance from all the other regions in the data. To do this, we include <span class="in">`region = "Something new"`</span> in the new data and <span class="in">`re_formula = NULL, allow_new_levels = TRUE, sample_new_levels = "uncertainty"`</span> in the prediction function.</span>
<span id="cb34-739"><a href="#cb34-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-740"><a href="#cb34-740" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-ame-generic}</span></span>
<span id="cb34-741"><a href="#cb34-741" aria-hidden="true" tabindex="-1"></a><span class="in">ame_hypothetical_amalgamated &lt;- model_basic %&gt;% </span></span>
<span id="cb34-742"><a href="#cb34-742" aria-hidden="true" tabindex="-1"></a><span class="in">  emmeans(~ party_autonomy + region,</span></span>
<span id="cb34-743"><a href="#cb34-743" aria-hidden="true" tabindex="-1"></a><span class="in">          at = list(civil_liberties = 0.5, </span></span>
<span id="cb34-744"><a href="#cb34-744" aria-hidden="true" tabindex="-1"></a><span class="in">                    region = "Generic world region"),</span></span>
<span id="cb34-745"><a href="#cb34-745" aria-hidden="true" tabindex="-1"></a><span class="in">          epred = TRUE, re_formula = NULL, </span></span>
<span id="cb34-746"><a href="#cb34-746" aria-hidden="true" tabindex="-1"></a><span class="in">          allow_new_levels = TRUE, sample_new_levels = "uncertainty") %&gt;% </span></span>
<span id="cb34-747"><a href="#cb34-747" aria-hidden="true" tabindex="-1"></a><span class="in">  contrast(method = "revpairwise") %&gt;% </span></span>
<span id="cb34-748"><a href="#cb34-748" aria-hidden="true" tabindex="-1"></a><span class="in">  gather_emmeans_draws()</span></span>
<span id="cb34-749"><a href="#cb34-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-750"><a href="#cb34-750" aria-hidden="true" tabindex="-1"></a><span class="in">ame_hypothetical_amalgamated %&gt;% median_hdi()</span></span>
<span id="cb34-751"><a href="#cb34-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-752"><a href="#cb34-752" aria-hidden="true" tabindex="-1"></a><span class="in">plot_ame_hypothetical_amalgamated &lt;- ggplot(ame_hypothetical_amalgamated, </span></span>
<span id="cb34-753"><a href="#cb34-753" aria-hidden="true" tabindex="-1"></a><span class="in">                                            aes(x = .value, y = "Generic world region")) +</span></span>
<span id="cb34-754"><a href="#cb34-754" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye(fill = palette_okabe_ito(order = 7)) +</span></span>
<span id="cb34-755"><a href="#cb34-755" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Average marginal effect of party autonomy", y = NULL,</span></span>
<span id="cb34-756"><a href="#cb34-756" aria-hidden="true" tabindex="-1"></a><span class="in">       title = "Marginal effect in a generic world region") +</span></span>
<span id="cb34-757"><a href="#cb34-757" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() +</span></span>
<span id="cb34-758"><a href="#cb34-758" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb34-759"><a href="#cb34-759" aria-hidden="true" tabindex="-1"></a><span class="in">plot_ame_hypothetical_amalgamated</span></span>
<span id="cb34-760"><a href="#cb34-760" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-761"><a href="#cb34-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-762"><a href="#cb34-762" aria-hidden="true" tabindex="-1"></a>In this case, the distribution is pretty smooth and normal looking, but if there's a lot of variation in regional distributions, that variation will transfer to these predictions too.</span>
<span id="cb34-763"><a href="#cb34-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-764"><a href="#cb34-764" aria-hidden="true" tabindex="-1"></a>For instance, in an earlier working version of this post, I had region-specific average predictions that varied substantially across regions. The resulting new hypothetical region reflected those different components—because the new generic world region is an amalgamation of uncertainty of all the existing regions, it includes both high values and low values (<span class="co">[</span><span class="ot">thanks to TJ Mahr for this insight!</span><span class="co">](https://twitter.com/tjmahr/status/1458443667748818955)</span>):</span>
<span id="cb34-765"><a href="#cb34-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-766"><a href="#cb34-766" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tj-annotation, echo=FALSE, out.width="100%"}</span></span>
<span id="cb34-767"><a href="#cb34-767" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("tj-annotation.jpg")</span></span>
<span id="cb34-768"><a href="#cb34-768" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-769"><a href="#cb34-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-770"><a href="#cb34-770" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Binary effect for completely new hypothetical region</span></span>
<span id="cb34-771"><a href="#cb34-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-772"><a href="#cb34-772" aria-hidden="true" tabindex="-1"></a>Alternatively, we can make it so that the new fake region uses a multivariate normal distribution implied by the model's group-level standard deviations and correlations. This creates a brand new region that would be plausible in the universe, but that is not sampled directly from the existing regions. As a result, there's no possibility of a weird bimodal blip—the overall shape of the distribution will be much smoother and consistent.</span>
<span id="cb34-773"><a href="#cb34-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-774"><a href="#cb34-774" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-ame-atlantis}</span></span>
<span id="cb34-775"><a href="#cb34-775" aria-hidden="true" tabindex="-1"></a><span class="in">ame_hypothetical_new &lt;- model_basic %&gt;% </span></span>
<span id="cb34-776"><a href="#cb34-776" aria-hidden="true" tabindex="-1"></a><span class="in">  emmeans(~ party_autonomy + region,</span></span>
<span id="cb34-777"><a href="#cb34-777" aria-hidden="true" tabindex="-1"></a><span class="in">          at = list(civil_liberties = 0.5, </span></span>
<span id="cb34-778"><a href="#cb34-778" aria-hidden="true" tabindex="-1"></a><span class="in">                    region = "Atlantis"),</span></span>
<span id="cb34-779"><a href="#cb34-779" aria-hidden="true" tabindex="-1"></a><span class="in">          epred = TRUE, re_formula = NULL, </span></span>
<span id="cb34-780"><a href="#cb34-780" aria-hidden="true" tabindex="-1"></a><span class="in">          allow_new_levels = TRUE, sample_new_levels = "gaussian") %&gt;% </span></span>
<span id="cb34-781"><a href="#cb34-781" aria-hidden="true" tabindex="-1"></a><span class="in">  contrast(method = "revpairwise") %&gt;% </span></span>
<span id="cb34-782"><a href="#cb34-782" aria-hidden="true" tabindex="-1"></a><span class="in">  gather_emmeans_draws()</span></span>
<span id="cb34-783"><a href="#cb34-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-784"><a href="#cb34-784" aria-hidden="true" tabindex="-1"></a><span class="in">ame_hypothetical_new %&gt;% median_hdi()</span></span>
<span id="cb34-785"><a href="#cb34-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-786"><a href="#cb34-786" aria-hidden="true" tabindex="-1"></a><span class="in">plot_ame_hypothetical_new &lt;- ggplot(ame_hypothetical_new, </span></span>
<span id="cb34-787"><a href="#cb34-787" aria-hidden="true" tabindex="-1"></a><span class="in">                                            aes(x = .value, y = "Atlantis")) +</span></span>
<span id="cb34-788"><a href="#cb34-788" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye(fill = palette_okabe_ito(order = 7)) +</span></span>
<span id="cb34-789"><a href="#cb34-789" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Average marginal effect of party autonomy", y = NULL,</span></span>
<span id="cb34-790"><a href="#cb34-790" aria-hidden="true" tabindex="-1"></a><span class="in">       title = "Marginal effect in the Atlantis region") +</span></span>
<span id="cb34-791"><a href="#cb34-791" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() +</span></span>
<span id="cb34-792"><a href="#cb34-792" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb34-793"><a href="#cb34-793" aria-hidden="true" tabindex="-1"></a><span class="in">plot_ame_hypothetical_new</span></span>
<span id="cb34-794"><a href="#cb34-794" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-795"><a href="#cb34-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-796"><a href="#cb34-796" aria-hidden="true" tabindex="-1"></a><span class="fu">## Which average is best?</span></span>
<span id="cb34-797"><a href="#cb34-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-798"><a href="#cb34-798" aria-hidden="true" tabindex="-1"></a>You've run a great multilevel model and want to report the average marginal effects for your coefficients of interest. Which average do you report? The global grand mean? Means conditional on existing groups? The mean of a new typical-ish looking region? The mean of a completely brand new region?</span>
<span id="cb34-799"><a href="#cb34-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-800"><a href="#cb34-800" aria-hidden="true" tabindex="-1"></a>Who knows!</span>
<span id="cb34-801"><a href="#cb34-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-802"><a href="#cb34-802" aria-hidden="true" tabindex="-1"></a>It all depends on the story you're trying to tell about your data, theory, and results.</span>
<span id="cb34-803"><a href="#cb34-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-804"><a href="#cb34-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-805"><a href="#cb34-805" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overall summary of different approaches</span></span>
<span id="cb34-806"><a href="#cb34-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-807"><a href="#cb34-807" aria-hidden="true" tabindex="-1"></a>Phew. We did a lot here with a ton of really neat moving parts. Here's a summary of all the different average effects you can calculate with multilevel models and how to do them:</span>
<span id="cb34-808"><a href="#cb34-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-809"><a href="#cb34-809" aria-hidden="true" tabindex="-1"></a><span class="in">```{r summary-table, echo=FALSE, warning=FALSE, message=FALSE}</span></span>
<span id="cb34-810"><a href="#cb34-810" aria-hidden="true" tabindex="-1"></a><span class="in">#| column: page-inset-right</span></span>
<span id="cb34-811"><a href="#cb34-811" aria-hidden="true" tabindex="-1"></a><span class="in">library(kableExtra)</span></span>
<span id="cb34-812"><a href="#cb34-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-813"><a href="#cb34-813" aria-hidden="true" tabindex="-1"></a><span class="in">summary_table &lt;- tribble(</span></span>
<span id="cb34-814"><a href="#cb34-814" aria-hidden="true" tabindex="-1"></a><span class="in">  ~`Type of average`, ~Description, ~`&lt;code&gt;newdata&lt;/code&gt;`, ~`&lt;code&gt;re_formula&lt;/code&gt;`, ~`Other options`,</span></span>
<span id="cb34-815"><a href="#cb34-815" aria-hidden="true" tabindex="-1"></a><span class="in">  "Global grand mean", "Average predicted outcome ignoring group-specific deviations in intercept or slope", "Omit group from &lt;code&gt;newdata&lt;/code&gt;", "&lt;code&gt;re_formula = NA&lt;/code&gt;", "—",</span></span>
<span id="cb34-816"><a href="#cb34-816" aria-hidden="true" tabindex="-1"></a><span class="in">  "Conditional effects for existing groups", "Average predicted outcomes for existing groups, incorporating group-specific deviations in intercept or slope", "Include existing group(s) in &lt;code&gt;newdata&lt;/code&gt;", "&lt;code&gt;re_formula = NULL&lt;/code&gt; or actual group term, like &lt;code&gt;re_formula = ~ (1 | group)&lt;/code&gt;", "—",</span></span>
<span id="cb34-817"><a href="#cb34-817" aria-hidden="true" tabindex="-1"></a><span class="in">  "Conditional effects for a single typical hypothetical group", "Average predicted outcome for a new group that is based on variation of existing groups", "Include new group in &lt;code&gt;newdata&lt;/code&gt;", "&lt;code&gt;re_formula = NULL&lt;/code&gt; or actual group term, like &lt;code&gt;re_formula = ~ (1 | group)&lt;/code&gt;", '&lt;code&gt;allow_new_levels = TRUE,&lt;/code&gt;&lt;br&gt;&lt;code&gt;sample_new_levels = "uncertainty"&lt;/code&gt;',</span></span>
<span id="cb34-818"><a href="#cb34-818" aria-hidden="true" tabindex="-1"></a><span class="in">  "Conditional effects for a single brand new hypothetical group", "Average predicted outcome for a new group that is based on random draws from model", "Include new group in &lt;code&gt;newdata&lt;/code&gt;", "&lt;code&gt;re_formula = NULL&lt;/code&gt; or actual group term, like &lt;code&gt;re_formula = ~ (1 | group)&lt;/code&gt;", '&lt;code&gt;allow_new_levels = TRUE,&lt;/code&gt;&lt;br&gt;&lt;code&gt;sample_new_levels = "gaussian"&lt;/code&gt;'</span></span>
<span id="cb34-819"><a href="#cb34-819" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb34-820"><a href="#cb34-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-821"><a href="#cb34-821" aria-hidden="true" tabindex="-1"></a><span class="in">summary_table %&gt;% </span></span>
<span id="cb34-822"><a href="#cb34-822" aria-hidden="true" tabindex="-1"></a><span class="in">  kbl(escape = FALSE) %&gt;% </span></span>
<span id="cb34-823"><a href="#cb34-823" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling()</span></span>
<span id="cb34-824"><a href="#cb34-824" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-825"><a href="#cb34-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-826"><a href="#cb34-826" aria-hidden="true" tabindex="-1"></a>\ </span>
<span id="cb34-827"><a href="#cb34-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-828"><a href="#cb34-828" aria-hidden="true" tabindex="-1"></a><span class="in">```{r summary-table-code, echo=FALSE, warning=FALSE, message=FALSE}</span></span>
<span id="cb34-829"><a href="#cb34-829" aria-hidden="true" tabindex="-1"></a><span class="in">#| column: page-inset-right</span></span>
<span id="cb34-830"><a href="#cb34-830" aria-hidden="true" tabindex="-1"></a><span class="in">code_table &lt;- tribble(</span></span>
<span id="cb34-831"><a href="#cb34-831" aria-hidden="true" tabindex="-1"></a><span class="in">  ~`Type of average`, ~`Generic code`,</span></span>
<span id="cb34-832"><a href="#cb34-832" aria-hidden="true" tabindex="-1"></a><span class="in">  "Global grand mean", '&lt;pre&gt;&lt;code&gt;posterior_epred(model,&lt;br&gt;                newdata = __OMIT GROUP__,&lt;br&gt;                re_formula = NA)&lt;code&gt;&lt;/pre&gt;',</span></span>
<span id="cb34-833"><a href="#cb34-833" aria-hidden="true" tabindex="-1"></a><span class="in">  "Conditional effects for existing groups", '&lt;pre&gt;&lt;code&gt;posterior_epred(model,&lt;br&gt;                newdata = __INCLUDE EXISTING GROUP(S)__,&lt;br&gt;                re_formula = NULL)&lt;code&gt;&lt;/pre&gt;',</span></span>
<span id="cb34-834"><a href="#cb34-834" aria-hidden="true" tabindex="-1"></a><span class="in">  "Conditional effects for a single typical hypothetical group", '&lt;pre&gt;&lt;code&gt;posterior_epred(model,&lt;br&gt;                newdata = __INCLUDE NEW GROUP__,&lt;br&gt;                re_formula = NULL, allow_new_levels = TRUE,&lt;br&gt;                sample_new_levels = "uncertainty")&lt;code&gt;&lt;/pre&gt;',</span></span>
<span id="cb34-835"><a href="#cb34-835" aria-hidden="true" tabindex="-1"></a><span class="in">  "Conditional effects for a single brand new hypothetical group", '&lt;pre&gt;&lt;code&gt;posterior_epred(model,&lt;br&gt;                newdata = __INCLUDE NEW GROUP__,&lt;br&gt;                re_formula = NULL, allow_new_levels = TRUE,&lt;br&gt;                sample_new_levels = "gaussian")&lt;code&gt;&lt;/pre&gt;'</span></span>
<span id="cb34-836"><a href="#cb34-836" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb34-837"><a href="#cb34-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-838"><a href="#cb34-838" aria-hidden="true" tabindex="-1"></a><span class="in">code_table %&gt;% </span></span>
<span id="cb34-839"><a href="#cb34-839" aria-hidden="true" tabindex="-1"></a><span class="in">  kbl(escape = FALSE) %&gt;% </span></span>
<span id="cb34-840"><a href="#cb34-840" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling()</span></span>
<span id="cb34-841"><a href="#cb34-841" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-842"><a href="#cb34-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-843"><a href="#cb34-843" aria-hidden="true" tabindex="-1"></a>And here's what they all look like!</span>
<span id="cb34-844"><a href="#cb34-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-845"><a href="#cb34-845" aria-hidden="true" tabindex="-1"></a><span class="in">```{r all-effects-combined, echo=FALSE, fig.width=10, fig.height=8, fig.asp=NULL, out.width="100%"}</span></span>
<span id="cb34-846"><a href="#cb34-846" aria-hidden="true" tabindex="-1"></a><span class="in">#| column: page-inset-right</span></span>
<span id="cb34-847"><a href="#cb34-847" aria-hidden="true" tabindex="-1"></a><span class="in">thing1 &lt;- plot_grand_mean_autonomy_ame +</span></span>
<span id="cb34-848"><a href="#cb34-848" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Global grand mean", </span></span>
<span id="cb34-849"><a href="#cb34-849" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = "No regional effects\n(re_formula = NA)")</span></span>
<span id="cb34-850"><a href="#cb34-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-851"><a href="#cb34-851" aria-hidden="true" tabindex="-1"></a><span class="in">thing2 &lt;- plot_all_regions_autonomy_ame +</span></span>
<span id="cb34-852"><a href="#cb34-852" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Conditional effects for existing groups", </span></span>
<span id="cb34-853"><a href="#cb34-853" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = "Regional effects incorporated\n(existing region(s) included in newdata; re_formula = NULL)")</span></span>
<span id="cb34-854"><a href="#cb34-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-855"><a href="#cb34-855" aria-hidden="true" tabindex="-1"></a><span class="in">thing3 &lt;- plot_ame_hypothetical_amalgamated +</span></span>
<span id="cb34-856"><a href="#cb34-856" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "\nConditional effects for a single\ntypical hypothetical group", </span></span>
<span id="cb34-857"><a href="#cb34-857" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = 'Regional effects incorporated, sampled from existing regions\n(new region included in newdata; re_formula = NULL;\nsample_new_levels = "uncertainty")')</span></span>
<span id="cb34-858"><a href="#cb34-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-859"><a href="#cb34-859" aria-hidden="true" tabindex="-1"></a><span class="in">thing4 &lt;- plot_ame_hypothetical_new +</span></span>
<span id="cb34-860"><a href="#cb34-860" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "\nConditional effects for a single\nbrand new hypothetical group", </span></span>
<span id="cb34-861"><a href="#cb34-861" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = 'Regional effects incorporated, newly simulated characteristics\n(new region included in newdata; re_formula = NULL;\nsample_new_levels = "gaussian")')</span></span>
<span id="cb34-862"><a href="#cb34-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-863"><a href="#cb34-863" aria-hidden="true" tabindex="-1"></a><span class="in">(thing1 | thing2) / (thing3 | thing4)</span></span>
<span id="cb34-864"><a href="#cb34-864" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p><span class="faux-block">Forked from <a href="https://www.andrewheiss.com/">Andrew Heiss</a></span> # <span class="faux-block"><a href="https://github.com/andrewheiss/ath-quarto">View the source at <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></span></p>
</div>
  </div>
</footer>


</body></html>