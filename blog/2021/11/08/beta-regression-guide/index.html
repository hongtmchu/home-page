<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Hong T.M. Chu">
<meta name="description" content="Everything you ever wanted to know about beta regression! Use R and brms to correctly model proportion data, and learn all about the beta distribution along the way.">
<title>A guide to modeling proportions with Bayesian beta and zero-inflated beta regression models | Hong T.M. Chu – Hong T.M. Chu</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../../">
<link href="../../../../..//files/favicon-512.png" rel="icon" type="image/png">
<script src="../../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting-17c909d5fd25ae21b861c0c7a49b2096.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../site_libs/bootstrap/bootstrap-5cd0811f461c8271ae6bab49df9501be.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script src="../../../../../site_libs/quarto-contrib/iconify-2.0.0/iconify-icon.min.js"></script><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-527449-5', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script><style>

      .quarto-title-block .quarto-title-banner {
        background: #170C3A;
      }
</style>
<script src="../../../../../site_libs/kePrint-0.0.1/kePrint.js"></script><link href="../../../../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
<meta property="og:title" content="A guide to modeling proportions with Bayesian beta and zero-inflated beta regression models | Hong T.M. Chu">
<meta property="og:description" content="Everything you ever wanted to know about beta regression! Use R and brms to correctly model proportion data, and learn all about the beta distribution along the way.">
<meta property="og:image" content="https://www.andrewheiss.com/blog/2021/11/08/beta-regression-guide/index_files/figure-html/plot-dist-beta-shifted-1.png">
<meta property="og:site_name" content="Hong T.M. Chu">
<meta property="og:locale" content="en_US">
<meta property="og:image:height" content="1067">
<meta property="og:image:width" content="1728">
<meta name="twitter:title" content="A guide to modeling proportions with Bayesian beta and zero-inflated beta regression models | Hong T.M. Chu">
<meta name="twitter:description" content="Everything you ever wanted to know about beta regression! Use R and brms to correctly model proportion data, and learn all about the beta distribution along the way.">
<meta name="twitter:image" content="https://www.andrewheiss.com/blog/2021/11/08/beta-regression-guide/index_files/figure-html/plot-dist-beta-shifted-1.png">
<meta name="twitter:creator" content="@andrewheiss">
<meta name="twitter:site" content="@andrewheiss">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image-height" content="1067">
<meta name="twitter:image-width" content="1728">
</head>
<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../../index.html">
    <span class="navbar-title">Hong T.M. Chu</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../../../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../cv/index.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../research/index.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../teaching/index.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="mailto:hong.ctm@vinuni.edu.vn"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:envelope" style="font-size: 1.1em;" aria-label="Icon envelope from bi Iconify.design set." title="E-mail"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/andrewheiss" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:github" style="font-size: 1.1em;" aria-label="Icon github from bi Iconify.design set." title="GitHub"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/hongtmchu" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:linkedin" style="font-size: 1.1em;" aria-label="Icon linkedin from bi Iconify.design set." title="LinkedIn"></iconify-icon></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default blog-post page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">A guide to modeling proportions with Bayesian beta and zero-inflated beta regression models</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
                  <div>
        <div class="description">
          Everything you ever wanted to know about beta regression! Use R and brms to correctly model proportion data, and learn all about the beta distribution along the way.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">r</div>
                <div class="quarto-category">tidyverse</div>
                <div class="quarto-category">regression</div>
                <div class="quarto-category">statistics</div>
                <div class="quarto-category">data visualization</div>
                <div class="quarto-category">bayes</div>
                <div class="quarto-category">beta</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://www.andrewheiss.com/">Andrew Heiss</a> <a href="https://orcid.org/0000-0002-3948-3914" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">Monday, November 8, 2021</p>
      </div>
    </div>
    
      
      <div>
      <div class="quarto-title-meta-heading">Doi</div>
      <div class="quarto-title-meta-contents">
        <p class="doi">
          <a href="https://doi.org/10.59350/7p1a4-0tw75">10.59350/7p1a4-0tw75</a>
        </p>
      </div>
    </div>
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Contents</h2>
   
  <ul>
<li><a href="#explore-the-data" id="toc-explore-the-data" class="nav-link active" data-scroll-target="#explore-the-data">Explore the data</a></li>
  <li><a href="#linear-probability-models" id="toc-linear-probability-models" class="nav-link" data-scroll-target="#linear-probability-models">1: Linear probability models</a></li>
  <li><a href="#fractional-logistic-regression" id="toc-fractional-logistic-regression" class="nav-link" data-scroll-target="#fractional-logistic-regression">2: Fractional logistic regression</a></li>
  <li>
<a href="#interlude-the-beta-distribution-and-distributional-regression" id="toc-interlude-the-beta-distribution-and-distributional-regression" class="nav-link" data-scroll-target="#interlude-the-beta-distribution-and-distributional-regression">Interlude: The beta distribution and distributional regression</a>
  <ul>
<li><a href="#beta-distributions-and-shape-parameters" id="toc-beta-distributions-and-shape-parameters" class="nav-link" data-scroll-target="#beta-distributions-and-shape-parameters">Beta distributions and shape parameters</a></li>
  <li><a href="#mean-and-precision-instead-of-shapes" id="toc-mean-and-precision-instead-of-shapes" class="nav-link" data-scroll-target="#mean-and-precision-instead-of-shapes">Mean and precision instead of shapes</a></li>
  </ul>
</li>
  <li>
<a href="#a-beta-regression" id="toc-a-beta-regression" class="nav-link" data-scroll-target="#a-beta-regression">3a: Beta regression</a>
  <ul>
<li><a href="#interpreting-coefficients" id="toc-interpreting-coefficients" class="nav-link" data-scroll-target="#interpreting-coefficients">Interpreting coefficients</a></li>
  <li><a href="#working-with-the-precision-parameter" id="toc-working-with-the-precision-parameter" class="nav-link" data-scroll-target="#working-with-the-precision-parameter">Working with the precision parameter</a></li>
  <li><a href="#average-marginal-effects" id="toc-average-marginal-effects" class="nav-link" data-scroll-target="#average-marginal-effects">Average marginal effects</a></li>
  </ul>
</li>
  <li>
<a href="#b-beta-regression-bayesian-style" id="toc-b-beta-regression-bayesian-style" class="nav-link" data-scroll-target="#b-beta-regression-bayesian-style">3b: Beta regression, Bayesian style</a>
  <ul>
<li><a href="#working-with-the-posterior" id="toc-working-with-the-posterior" class="nav-link" data-scroll-target="#working-with-the-posterior">Working with the posterior</a></li>
  <li>
<a href="#posterior-average-marginal-effects" id="toc-posterior-average-marginal-effects" class="nav-link" data-scroll-target="#posterior-average-marginal-effects">Posterior average marginal effects</a>
  <ul class="collapse">
<li><a href="#binary-predictor" id="toc-binary-predictor" class="nav-link" data-scroll-target="#binary-predictor">Binary predictor</a></li>
  <li><a href="#continuous-predictor" id="toc-continuous-predictor" class="nav-link" data-scroll-target="#continuous-predictor">Continuous predictor</a></li>
  </ul>
</li>
  </ul>
</li>
  <li>
<a href="#zero-inflated-beta-regression-bayesian-style" id="toc-zero-inflated-beta-regression-bayesian-style" class="nav-link" data-scroll-target="#zero-inflated-beta-regression-bayesian-style">4: Zero-inflated beta regression, Bayesian style</a>
  <ul>
<li><a href="#a-new-parameter-for-modeling-the-zero-process" id="toc-a-new-parameter-for-modeling-the-zero-process" class="nav-link" data-scroll-target="#a-new-parameter-for-modeling-the-zero-process">A new parameter for modeling the zero process</a></li>
  <li><a href="#average-marginal-effects-incorporating-the-zero-process" id="toc-average-marginal-effects-incorporating-the-zero-process" class="nav-link" data-scroll-target="#average-marginal-effects-incorporating-the-zero-process">Average marginal effects, incorporating the zero process</a></li>
  <li><a href="#special-case-1-zero-one-inflated-beta-regression" id="toc-special-case-1-zero-one-inflated-beta-regression" class="nav-link" data-scroll-target="#special-case-1-zero-one-inflated-beta-regression">Special case #1: Zero-one-inflated beta regression</a></li>
  <li><a href="#special-case-2-one-inflated-beta-regression" id="toc-special-case-2-one-inflated-beta-regression" class="nav-link" data-scroll-target="#special-case-2-one-inflated-beta-regression">Special case #2: One-inflated beta regression</a></li>
  </ul>
</li>
  <li>
<a href="#super-fancy-detailed-model-with-lots-of-moving-parts-just-for-fun" id="toc-super-fancy-detailed-model-with-lots-of-moving-parts-just-for-fun" class="nav-link" data-scroll-target="#super-fancy-detailed-model-with-lots-of-moving-parts-just-for-fun">Super fancy detailed model with lots of moving parts, just for fun</a>
  <ul>
<li><a href="#set-better-priors" id="toc-set-better-priors" class="nav-link" data-scroll-target="#set-better-priors">Set better priors</a></li>
  <li><a href="#run-the-model" id="toc-run-the-model" class="nav-link" data-scroll-target="#run-the-model">Run the model</a></li>
  <li><a href="#analyze-and-plot-the-results" id="toc-analyze-and-plot-the-results" class="nav-link" data-scroll-target="#analyze-and-plot-the-results">Analyze and plot the results</a></li>
  </ul>
</li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></nav>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content"><p>In the data I work with, it’s really common to come across data that’s measured as proportions: the percent of women in the public sector workforce, the amount of foreign aid a country receives as a percent of its GDP, the percent of religious organizations in a state’s nonprofit sector, and so on.</p>
<p>When working with this kind of data as an outcome variable (or dependent variable) in a model, analysis gets tricky if you use standard models like OLS regression. For instance, look at this imaginary simulated dataset of the relationship between some hypothetical x and y:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/example-beyond-one-plot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>Y here is measured as a percentage and ranges between 0 and 1 (i.e.&nbsp;between the red lines), but the fitted line from a linear model creates predictions that exceed the 0–1 range (see the blue line in the top right corner). Since we’re thinking about proportions, we typically can’t exceed 0% and 100%, so it would be great if our modeling approach took those limits into account.</p>
<p>There are a bunch of different ways to model proportional data that vary substantially in complexity. In this post, I’ll explore four, but I’ll mostly focus on beta and zero-inflated beta regression:</p>
<ol type="1">
<li>Linear probability models</li>
<li>Fractional logistic regression</li>
<li>Beta regression</li>
<li>Zero-inflated beta regression</li>
</ol>
<p>Throughout this example, we’ll use data from the <a href="https://www.v-dem.net/en/">Varieties of Democracy project (V-Dem)</a> to answer a question common in comparative politics: do countries with parliamentary gender quotas (i.e.&nbsp;laws and regulations that require political parties to have a minimum proportion of women members of parliament (MPs)) have more women MPs in their respective parliaments? This question is inspired by <a href="https://doi.org/10.1177%2F0010414006297342">existing research</a> that looks at the effect of quotas on the proportion of women MPs, and a paper by <span class="citation" data-cites="TrippKang:2008">Tripp and Kang (<a href="#ref-TrippKang:2008" role="doc-biblioref">2008</a>)</span> was my first exposure to fractional logistic regression as a way to handle proportional data. The <a href="https://home.alicejkang.com/research">original data from that paper</a> is available at Alice Kang’s website, but to simplify the post here, we won’t use it—we’ll just use a subset of equivalent data from V-Dem.</p>
<p>There’s <a href="https://github.com/vdeminstitute/vdemdata">a convenient R package for accessing V-Dem data</a>, so we’ll use that to make a smaller panel of countries between 2010 and 2020. Let’s load all the libraries we need, clean up the data, and get started!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>        <span class="co"># ggplot, dplyr, %&gt;%, and friends</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms">brms</a></span><span class="op">)</span>             <span class="co"># Bayesian modeling through Stan</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/tidybayes/">tidybayes</a></span><span class="op">)</span>        <span class="co"># Manipulate Stan objects in a tidy way</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span>            <span class="co"># Convert model objects to data frames</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bbolker/broom.mixed">broom.mixed</a></span><span class="op">)</span>      <span class="co"># Convert brms model objects to data frames</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">vdemdata</span><span class="op">)</span>         <span class="co"># Use data from the Varieties of Democracy (V-Dem) project</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://topmodels.R-Forge.R-project.org/betareg/">betareg</a></span><span class="op">)</span>          <span class="co"># Run beta regression models</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/twolodzko/extraDistr">extraDistr</a></span><span class="op">)</span>       <span class="co"># Use extra distributions like dprop()</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/ggdist/">ggdist</a></span><span class="op">)</span>           <span class="co"># Special geoms for posterior distributions</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/erocoar/gghalves">gghalves</a></span><span class="op">)</span>         <span class="co"># Special half geoms</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/eclarke/ggbeeswarm">ggbeeswarm</a></span><span class="op">)</span>       <span class="co"># Special distribution-shaped point jittering</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggrepel.slowkow.com/">ggrepel</a></span><span class="op">)</span>          <span class="co"># Automatically position labels</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span>        <span class="co"># Combine ggplot objects</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org">scales</a></span><span class="op">)</span>           <span class="co"># Format numbers in nice ways</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://marginaleffects.com/">marginaleffects</a></span><span class="op">)</span>  <span class="co"># Calculate marginal effects for regression models</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://modelsummary.com">modelsummary</a></span><span class="op">)</span>     <span class="co"># Create side-by-side regression tables</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>  <span class="co"># Make everything reproducible</span></span>
<span></span>
<span><span class="co"># Define the goodness-of-fit stats to include in modelsummary()</span></span>
<span><span class="va">gof_stuff</span> <span class="op">&lt;-</span> <span class="fu">tribble</span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">raw</span>, <span class="op">~</span><span class="va">clean</span>, <span class="op">~</span><span class="va">fmt</span>,</span>
<span>  <span class="st">"nobs"</span>, <span class="st">"N"</span>, <span class="fl">0</span>,</span>
<span>  <span class="st">"r.squared"</span>, <span class="st">"R²"</span>, <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Custom ggplot theme to make pretty plots</span></span>
<span><span class="co"># Get the font at https://fonts.google.com/specimen/Barlow+Semi+Condensed</span></span>
<span><span class="va">theme_clean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span>base_family <span class="op">=</span> <span class="st">"Barlow Semi Condensed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>          plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"BarlowSemiCondensed-Bold"</span><span class="op">)</span>,</span>
<span>          axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"BarlowSemiCondensed-Medium"</span><span class="op">)</span>,</span>
<span>          strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>family <span class="op">=</span> <span class="st">"BarlowSemiCondensed-Bold"</span>,</span>
<span>                                    size <span class="op">=</span> <span class="fu">rel</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>          strip.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey80"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Make labels use Barlow by default</span></span>
<span><span class="fu">update_geom_defaults</span><span class="op">(</span><span class="st">"label_repel"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Barlow Semi Condensed"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Format things as percentage points</span></span>
<span><span class="va">label_pp</span> <span class="op">&lt;-</span> <span class="fu">label_number</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">1</span>, scale <span class="op">=</span> <span class="fl">100</span>, </span>
<span>                         suffix <span class="op">=</span> <span class="st">" pp."</span>, style_negative <span class="op">=</span> <span class="st">"minus"</span><span class="op">)</span></span>
<span><span class="va">label_pp_tiny</span> <span class="op">&lt;-</span> <span class="fu">label_number</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.01</span>, scale <span class="op">=</span> <span class="fl">100</span>, </span>
<span>                              suffix <span class="op">=</span> <span class="st">" pp."</span>, style_negative <span class="op">=</span> <span class="st">"minus"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>V-Dem covers all countries since 1789 and includes hundreds of different variables. We’ll make a subset of some of the columns here and only look at years from 2010–2020. We’ll also make a subset of <em>that</em> and have a dataset for just 2015.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Make a subset of the full V-Dem data</span></span>
<span><span class="va">vdem_clean</span> <span class="op">&lt;-</span> <span class="va">vdem</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">country_name</span>, <span class="va">country_text_id</span>, <span class="va">year</span>, region <span class="op">=</span> <span class="va">e_regionpol_6C</span>,</span>
<span>         polyarchy <span class="op">=</span> <span class="va">v2x_polyarchy</span>, corruption <span class="op">=</span> <span class="va">v2x_corr</span>, </span>
<span>         civil_liberties <span class="op">=</span> <span class="va">v2x_civlib</span>, prop_fem <span class="op">=</span> <span class="va">v2lgfemleg</span>, <span class="va">v2lgqugen</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2010</span>, <span class="va">year</span> <span class="op">&lt;</span> <span class="fl">2020</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">drop_na</span><span class="op">(</span><span class="va">v2lgqugen</span>, <span class="va">prop_fem</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>quota <span class="op">=</span> <span class="va">v2lgqugen</span> <span class="op">&gt;</span> <span class="fl">0</span>,</span>
<span>         prop_fem <span class="op">=</span> <span class="va">prop_fem</span> <span class="op">/</span> <span class="fl">100</span>,</span>
<span>         polyarchy <span class="op">=</span> <span class="va">polyarchy</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vdem_2015</span> <span class="op">&lt;-</span> <span class="va">vdem_clean</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2015</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># Sweden and Denmark are tied for the highest polyarchy score (91.5), and R's</span></span>
<span>  <span class="co"># max() doesn't deal with ties, so we cheat a little and add a tiny random</span></span>
<span>  <span class="co"># amount of noise to each polyarchy score, mark the min and max of that</span></span>
<span>  <span class="co"># perturbed score, and then remove that temporary column</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>polyarchy_noise <span class="op">=</span> <span class="va">polyarchy</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span>, <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>highlight <span class="op">=</span> <span class="va">polyarchy_noise</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">polyarchy_noise</span><span class="op">)</span> <span class="op">|</span> </span>
<span>           <span class="va">polyarchy_noise</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">polyarchy_noise</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">polyarchy_noise</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="explore-the-data" class="level2"><h2 class="anchored" data-anchor-id="explore-the-data">Explore the data</h2>
<p>Before trying to model this data, we’ll look at it really quick first. Here’s the distribution of <code>prop_fem</code> across the two different values of <code>quota</code>. In general, it seems that countries without a gender-based quota have fewer women MPs, which isn’t all that surprising, since quotas were designed to boost the number of women MPs in the first place.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">quota_halves</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">vdem_2015</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">quota</span>, y <span class="op">=</span> <span class="va">prop_fem</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_half_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">quota</span><span class="op">)</span>, </span>
<span>                  transformation <span class="op">=</span> <span class="fu">position_quasirandom</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                  side <span class="op">=</span> <span class="st">"l"</span>, size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_half_boxplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">quota</span><span class="op">)</span>, side <span class="op">=</span> <span class="st">"r"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_d</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span>, end <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_viridis_d</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span>, end <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"none"</span>, fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Quota"</span>, y <span class="op">=</span> <span class="st">"Proportion of women in parliament"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">quota_densities</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">vdem_2015</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">prop_fem</span>, fill <span class="op">=</span> <span class="va">quota</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_density</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_d</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span>, end <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Proportion of women in parliament"</span>, y <span class="op">=</span> <span class="st">"Density"</span>, fill <span class="op">=</span> <span class="st">"Quota"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">quota_halves</span> <span class="op">|</span> <span class="va">quota_densities</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/propfem-quota-halves-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>And here’s what the proportion of women MPs looks like across different levels of electoral democracy. V-Dem’s polyarchy index measures the extent of electoral democracy in different countries, incorporating measures of electoral, freedom of association, and universal suffrage, among other factors. It ranges from 0 to 1, but to make it easier to interpret in regression, we’ll multiply it by 100 so we can talk about unit changes in democracy. To help with the intuition of the index, we’ll highlight the countries with the minimum and maximum values of democracy. In general, the proportion of women MPs increases as democracy increases.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">vdem_2015</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">polyarchy</span>, y <span class="op">=</span> <span class="va">prop_fem</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">highlight</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_smooth</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_label_repel</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">vdem_2015</span>, <span class="va">highlight</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>                   <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">country_name</span><span class="op">)</span>,</span>
<span>                   seed <span class="op">=</span> <span class="fl">1234</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey30"</span>, <span class="st">"#FF4136"</span><span class="op">)</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Polyarchy (democracy)"</span>, y <span class="op">=</span> <span class="st">"Proportion of women in parliament"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/polyarchy-propfem-scatterplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
</section><section id="linear-probability-models" class="level2"><h2 class="anchored" data-anchor-id="linear-probability-models">1: Linear probability models</h2>
<p>In the world of econometrics, having the fitted regression line go outside the 0–1 range (like in the plot at the very beginning of this post) is totally fine and not a problem. Economists love to use a thing called a linear probability model (LPM) to model data like this, and for values that aren’t too extreme (<a href="https://www.alexpghayes.com/blog/consistency-and-the-linear-probability-model/">generally if the outcome ranges between 0.2 and 0.8</a>), the results from these weirdly fitting linear models are generally equivalent to fancier non-linear models. LPMs are even <a href="https://psyarxiv.com/4gmbv">arguably best for experimental data</a>. But it’s still a weird way to think about data and I don’t like them. As <a href="https://www.alexpghayes.com/blog/consistency-and-the-linear-probability-model/">Alex Hayes says</a>,</p>
<blockquote class="blockquote">
<p>[T]he thing [LPM] is generally inconsistent and aesthetically offensive, but whatever, it works on occasion.</p>
</blockquote>
<p>An LPM is really just regular old OLS applied to a binary or proportional outcome, so we’ll use trusty old <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Linear probability models</span></span>
<span><span class="va">model_ols1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prop_fem</span> <span class="op">~</span> <span class="va">quota</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">vdem_2015</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_ols2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prop_fem</span> <span class="op">~</span> <span class="va">polyarchy</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">vdem_2015</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_ols3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">prop_fem</span> <span class="op">~</span> <span class="va">quota</span> <span class="op">+</span> <span class="va">polyarchy</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">vdem_2015</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">modelsummary</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">model_ols1</span>, <span class="va">model_ols2</span>, <span class="va">model_ols3</span><span class="op">)</span>,</span>
<span>             gof_map <span class="op">=</span> <span class="va">gof_stuff</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">&nbsp;(1)</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">&nbsp;&nbsp;(2)</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">&nbsp;&nbsp;(3)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">0.195</td>
<td style="text-align: center;">0.154</td>
<td style="text-align: center;">0.132</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(0.012)</td>
<td style="text-align: center;">(0.020)</td>
<td style="text-align: center;">(0.022)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">quotaTRUE</td>
<td style="text-align: center;">0.047</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">0.049</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(0.018)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(0.018)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">polyarchy</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">0.001</td>
<td style="text-align: center;">0.001</td>
</tr>
<tr class="even">
<td style="text-align: left; box-shadow: 0px 1.5px;"></td>
<td style="text-align: center; box-shadow: 0px 1.5px;"></td>
<td style="text-align: center; box-shadow: 0px 1.5px;">(0.000)</td>
<td style="text-align: center; box-shadow: 0px 1.5px;">(0.000)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">N</td>
<td style="text-align: center;">172</td>
<td style="text-align: center;">172</td>
<td style="text-align: center;">172</td>
</tr>
<tr class="even">
<td style="text-align: left;">R²</td>
<td style="text-align: center;">0.038</td>
<td style="text-align: center;">0.060</td>
<td style="text-align: center;">0.101</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Based on this, having a quota is associated with a 4.7 percentage point increase in the proportion of women MPs on average, and the coefficient is statistically significant. If we control for polyarchy, the effect changes to 4.9 percentage points. Great.</p>
</section><section id="fractional-logistic-regression" class="level2"><h2 class="anchored" data-anchor-id="fractional-logistic-regression">2: Fractional logistic regression</h2>
<p>Logistic regression is normally used for binary outcomes, but surprisingly you can actually use it for proportional data too! This kind of model is called fractional logistic regression, and though it feels weird to use logistic regression with non-binary data, it’s legal! The Stata documentation <a href="https://www.stata.com/support/faqs/statistics/logit-transformation/">actually recommends it</a>, and there are tutorials (like <a href="https://stats.idre.ucla.edu/stata/faq/how-does-one-do-regression-when-the-dependent-variable-is-a-proportion/">this</a> and <a href="https://www3.nd.edu/~rwilliam/stats3/FractionalResponseModels.pdf">this</a>) <a href="https://doi.org/10.1177%2F1536867X0800800212">papers</a> about how to do it with Stata. <a href="https://m-clark.github.io/posts/2019-08-20-fractional-regression/">This really in-depth post by Michael Clark</a> shows several ways to run these models with R.</p>
<p>Basically use regular logistic regression with <code>glm(..., family = binomial(link = "logit"))</code> with an outcome variable that ranges from 0 to 1, and you’re done. R will give you a warning when you use <code>family = binomial()</code> with a non-binary outcome variable, but it will still work. If you want to suppress that warning, use <code>family = quasibinomial()</code> instead.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_frac_logit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">prop_fem</span> <span class="op">~</span> <span class="va">quota</span>, </span>
<span>                         data <span class="op">=</span> <span class="va">vdem_2015</span>, </span>
<span>                         family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">quasibinomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_frac_logit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">prop_fem</span> <span class="op">~</span> <span class="va">polyarchy</span>, </span>
<span>                         data <span class="op">=</span> <span class="va">vdem_2015</span>, </span>
<span>                         family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">quasibinomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_frac_logit3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">prop_fem</span> <span class="op">~</span> <span class="va">quota</span> <span class="op">+</span> <span class="va">polyarchy</span>, </span>
<span>                         data <span class="op">=</span> <span class="va">vdem_2015</span>, </span>
<span>                         family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">quasibinomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">modelsummary</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">model_frac_logit1</span>, <span class="va">model_frac_logit2</span>, <span class="va">model_frac_logit3</span><span class="op">)</span>,</span>
<span>             gof_map <span class="op">=</span> <span class="va">gof_stuff</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">&nbsp;(1)</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">&nbsp;&nbsp;(2)</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">&nbsp;&nbsp;(3)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">−1.417</td>
<td style="text-align: center;">−1.667</td>
<td style="text-align: center;">−1.814</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(0.073)</td>
<td style="text-align: center;">(0.129)</td>
<td style="text-align: center;">(0.140)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">quotaTRUE</td>
<td style="text-align: center;">0.276</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">0.293</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(0.107)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(0.106)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">polyarchy</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">0.007</td>
<td style="text-align: center;">0.007</td>
</tr>
<tr class="even">
<td style="text-align: left; box-shadow: 0px 1.5px;"></td>
<td style="text-align: center; box-shadow: 0px 1.5px;"></td>
<td style="text-align: center; box-shadow: 0px 1.5px;">(0.002)</td>
<td style="text-align: center; box-shadow: 0px 1.5px;">(0.002)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">N</td>
<td style="text-align: center;">172</td>
<td style="text-align: center;">172</td>
<td style="text-align: center;">172</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Interpreting this model is a little more involved than interpreting OLS. The coefficients in logistic regression are provided on different scale than the original data. With OLS (and the linear probability model), coefficients show the change in the probability (or proportion in this case, since we’re working with proportion data) that is associated with a one-unit change in an explanatory variable. With logistic regression, coefficients show the change in the natural logged odds of the outcome, also known as “logits.”</p>
<p>This log odds scale is weird and not very intuitive normally, so often people will convert these log odds into odds ratios by exponentiating them. I’ve done this my whole statistical-knowing-and-doing life. If a model provides a coefficient of 0.4, you can exponentiate that with <span class="math inline">\(e^{0.4}\)</span>, resulting in an odds ratio of 1.49. You’d interpret this by saying something like “a one unit change in x increases the likelihood of y by 49%.” That sounds neat and soundbite-y and you see stuff like this all the time in science reporting. But thinking about percent changes in probability is still a weird way of thinking (though admittedly less non-intuitive than thinking about logits/logged odds).</p>
<p>For instance, here the coefficient for <code>quota</code> in Model 1 is 0.276. If we exponentiate that (<span class="math inline">\(e^{0.276}\)</span>) we get 1.32. If our outcome were binary, we could say that having a quota makes it 32% more likely that the outcome would occur. But our outcome isn’t binary—it’s a proportion—so we need to think about changes in probabilities or proportions instead, and odds ratios make that really really hard.</p>
<p>Instead of odds ratios, we need to work directly with these logit-scale values. For a <em>phenomenally</em> excellent overview of binary logistic regression and how to interpret coefficients, see <a href="http://post8000.svmiller.com/lab-scripts/logistic-regression-lab.html">Steven Miller’s most excellent lab script here</a>—because of that post I’m now far less afraid of dealing with logit-scale coefficients!</p>
<p>We can invert a logit value and convert it to a probability using the <code><a href="https://rdrr.io/r/stats/Logistic.html">plogis()</a></code> function in R. We’ll illustrate this a couple different ways, starting with a super simple intercept-only model:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_frac_logit0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">prop_fem</span> <span class="op">~</span> <span class="fl">1</span>, </span>
<span>                         data <span class="op">=</span> <span class="va">vdem_2015</span>, </span>
<span>                         family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">quasibinomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">tidy</span><span class="op">(</span><span class="va">model_frac_logit0</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 5</span></span>
<span><span class="co">##   term        estimate std.error statistic  p.value</span></span>
<span><span class="co">##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">## 1 (Intercept)    -1.29    0.0540     -24.0 1.24e-56</span></span>
<span></span>
<span><span class="va">logit0_intercept</span> <span class="op">&lt;-</span> <span class="va">model_frac_logit0</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"(Intercept)"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The intercept in logits. Who even knows what this means.</span></span>
<span><span class="va">logit0_intercept</span></span>
<span><span class="co">## [1] -1.29</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The intercept of this intercept-only model is -1.295 in logit units, whatever that means. We can convert this to a probability though:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Convert logit to a probability (or proportion in this case)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">logit0_intercept</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.215</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>According to this probability/proportion, the average proportion of women MPs in the dataset is 0.215. Let’s see if that’s really the case:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">vdem_2015</span><span class="op">$</span><span class="va">prop_fem</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.215</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It’s the same! That’s so neat!</p>
<p>Inverting logit coefficients to probabilities gets a little trickier when there are multiple moving parts, though. With OLS, each coefficient shows the marginal change in the outcome for each unit change in the explanatory variable. With logistic regression, that’s not the case—we have to incorporate information from the intercept in order to get marginal effects.</p>
<p>For example, in Model 1, the log odds coefficient for <code>quota</code> is 0.276. If we invert that with <code><a href="https://rdrr.io/r/stats/Logistic.html">plogis()</a></code>, we end up with a really big number:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">logit1_intercept</span> <span class="op">&lt;-</span> <span class="va">model_frac_logit1</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"(Intercept)"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span></span>
<span></span>
<span><span class="va">logit1_quota</span> <span class="op">&lt;-</span> <span class="va">model_frac_logit1</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"quotaTRUE"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Incorrect marginal effect of quota</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">logit1_quota</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.568</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If that were true, we could say that having a quota increases the proportion of women MPs by nearly 60%! But that’s wrong. We have to incorporate information from the intercept, as well as any other coefficients in the model, like so:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">logit1_intercept</span> <span class="op">+</span> <span class="va">logit1_quota</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">logit1_intercept</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.0469</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>This</em> is the effect of having a quota on the proportion of women MPs. Having a quota increases the proportion by 4.7 percentage points, on average.</p>
<p>The math of combining these different logit coefficients and converting them to probabilities gets really tricky once there are more than one covariate, like in Model 3 here where we include both quota and polyarchy. Rather than try to figure out, we can instead calculate the marginal effects of specific variables while holding others constant. In practice this entails plugging a custom hypothetical dataset into our model and estimating the predicted values of the outcome. For instance, we can create a small dataset with just two rows: in one row, <code>quota</code> is FALSE and in the other <code>quota</code> is TRUE, while we hold <code>polyarchy</code> at its mean value. The <a href="https://vincentarelbundock.github.io/marginaleffects/"><strong>marginaleffects</strong> package</a> makes this really easy to do:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calculate the typical values for all variables in Model 3, except for quota,</span></span>
<span><span class="co"># which we'll force to be FALSE and TRUE</span></span>
<span><span class="va">data_to_predict</span> <span class="op">&lt;-</span> <span class="fu">datagrid</span><span class="op">(</span>model <span class="op">=</span> <span class="va">model_frac_logit3</span>, </span>
<span>                            quota <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data_to_predict</span></span>
<span><span class="co">##   prop_fem polyarchy quota</span></span>
<span><span class="co">## 1    0.215      53.2 FALSE</span></span>
<span><span class="co">## 2    0.215      53.2  TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we can use <code>predictions()</code> from the <strong>marginaleffects</strong> package to plug this data into Model 3 and figure out the fitted values for each of the rows:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Plug this new dataset into the model</span></span>
<span><span class="va">frac_logit_pred</span> <span class="op">&lt;-</span> <span class="fu">predictions</span><span class="op">(</span><span class="va">model_frac_logit3</span>, newdata <span class="op">=</span> <span class="va">data_to_predict</span><span class="op">)</span></span>
<span><span class="va">frac_logit_pred</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Estimate Pr(&gt;|z|) 2.5 % 97.5 % polyarchy quota</span></span>
<span><span class="co">##     0.192   &lt;0.001 0.171  0.215      53.2 FALSE</span></span>
<span><span class="co">##     0.242   &lt;0.001 0.215  0.271      53.2  TRUE</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Columns: rowid, estimate, p.value, conf.low, conf.high, prop_fem, polyarchy, quota</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>estimate</code> column here tells us the predicted or fitted value. When countries don’t have a quota, the average proportion of women MPs is 0.192; when they do have a quota, the average predicted proportion is 0.192. That’s a 4.96 percentage point difference, which is really similar to what we found from Model 1. We can plot these marginal effects too and see that this difference is statistically significant:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">frac_logit_pred</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">quota</span>, y <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_pointrange</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">conf.low</span>, ymax <span class="op">=</span> <span class="va">conf.high</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Quota"</span>, y <span class="op">=</span> <span class="st">"Predicted proportion of women in parliament"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/frac-logit-plot-predictions-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>We can also compute marginal effects for polyarchy, holding <code>quota</code> at FALSE (its most common value) and ranging <code>polyarchy</code> from 0 to 100. And we technically don’t need to make a separate data frame first—we can use <code>datagrid()</code> inside <code>predictions()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">frac_logit_pred</span> <span class="op">&lt;-</span> <span class="fu">predictions</span><span class="op">(</span><span class="va">model_frac_logit3</span>, </span>
<span>                               newdata <span class="op">=</span> <span class="fu">datagrid</span><span class="op">(</span>polyarchy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">frac_logit_pred</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">polyarchy</span>, y <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_ribbon</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">conf.low</span>, ymax <span class="op">=</span> <span class="va">conf.high</span><span class="op">)</span>, </span>
<span>              alpha <span class="op">=</span> <span class="fl">0.4</span>, fill <span class="op">=</span> <span class="st">"#480B6A"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"#480B6A"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Polyarchy (democracy)"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Predicted proportion of women in parliament"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/frac-logit-predict-polyarchy-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>The predicted proportion of women MPs increases as democracy increases, which follows from the model results. But what’s the marginal effect of a one-unit increase in polyarchy? The coefficient from Model 3 was really small (0.007 logits). We can convert this to a probability while correctly accounting for the intercept and all other coefficients with the <code>avg_slopes()</code> function:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">avg_slopes</span><span class="op">(</span><span class="va">model_frac_logit3</span>, variables <span class="op">=</span> <span class="st">"polyarchy"</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##       Term Estimate Std. Error    z Pr(&gt;|z|)   2.5 %  97.5 %</span></span>
<span><span class="co">##  polyarchy  0.00119   0.000349 3.42   &lt;0.001 0.00051 0.00188</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Columns: term, estimate, std.error, statistic, p.value, conf.low, conf.high</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The effect here is still small: a one-unit change in polyarchy (i.e.&nbsp;moving from a 56 to a 57) is associated with a 0.119 percentage point increase in the proportion of women MPs, on average. That’s not <em>huge</em>, but a one-unit change in polyarchy also isn’t huge. If a country moves 10 points from 56 to 66, for instance, there’d be a ≈10x increase in the effect (0.001 × 10, or 0.012). This is apparent in the predicted proportion when polyarchy is set to 56 and 66: 0.207 - 0.196 = 0.011</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">predictions</span><span class="op">(</span><span class="va">model_frac_logit3</span>,</span>
<span>            newdata <span class="op">=</span> <span class="fu">datagrid</span><span class="op">(</span>polyarchy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">56</span>, <span class="fl">66</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Estimate Pr(&gt;|z|) 2.5 % 97.5 % quota polyarchy</span></span>
<span><span class="co">##     0.196   &lt;0.001 0.174  0.219 FALSE        56</span></span>
<span><span class="co">##     0.207   &lt;0.001 0.184  0.232 FALSE        66</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Columns: rowid, estimate, p.value, conf.low, conf.high, prop_fem, quota, polyarchy</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, how do these fractional logistic regression coefficients compare to what we found with the linear probability model? We can look at them side-by-side:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">modelsummary</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"OLS"</span> <span class="op">=</span> <span class="va">model_ols3</span>,</span>
<span>                  <span class="st">"Fractional logit"</span> <span class="op">=</span> <span class="va">model_frac_logit3</span>,</span>
<span>                  <span class="st">"Fractional logit&lt;br&gt;(marginal effects)"</span> <span class="op">=</span> <span class="fu">marginaleffects</span><span class="op">(</span><span class="va">model_frac_logit3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             gof_map <span class="op">=</span> <span class="va">gof_stuff</span>,</span>
<span>             fmt <span class="op">=</span> <span class="fl">4</span>,</span>
<span>             escape <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">OLS</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Fractional logit</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Fractional logit<br>
(marginal effects)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">0.1316</td>
<td style="text-align: center;">−1.8136</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(0.0217)</td>
<td style="text-align: center;">(0.1396)</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">quotaTRUE</td>
<td style="text-align: center;">0.0491</td>
<td style="text-align: center;">0.2928</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(0.0176)</td>
<td style="text-align: center;">(0.1057)</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">polyarchy</td>
<td style="text-align: center;">0.0012</td>
<td style="text-align: center;">0.0071</td>
<td style="text-align: center;">0.0012</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(0.0003)</td>
<td style="text-align: center;">(0.0021)</td>
<td style="text-align: center;">(0.0003)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">quota</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">0.0496</td>
</tr>
<tr class="even">
<td style="text-align: left; box-shadow: 0px 1.5px;"></td>
<td style="text-align: center; box-shadow: 0px 1.5px;"></td>
<td style="text-align: center; box-shadow: 0px 1.5px;"></td>
<td style="text-align: center; box-shadow: 0px 1.5px;">(0.0181)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">N</td>
<td style="text-align: center;">172</td>
<td style="text-align: center;">172</td>
<td style="text-align: center;">172</td>
</tr>
<tr class="even">
<td style="text-align: left;">R²</td>
<td style="text-align: center;">0.101</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
</div>
</div>
<p>They’re basically the same! Having a quota is associated with a 4.96 percentage point increase in the proportion of women MPs, on average, in both OLS and the fractional logit model. That’s so neat!</p>
</section><section id="interlude-the-beta-distribution-and-distributional-regression" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="interlude-the-beta-distribution-and-distributional-regression">Interlude: The beta distribution and distributional regression</h2>
<p>The OLS-based linear probability model works (begrudgingly), and fractional logistic regression works (but it feels kinda weird to use logistic regression on proportions like that). The third method we’ll explore is beta regression, which is a little different from linear regression. With regular old linear regression, we’re essentially fitting a line to data. We find an intercept, we find a slope, and we draw a line. We can add some mathematical trickery to make sure the line stays within specific bounds (like using logits and logged odds), but fundamentally everything just has intercepts and slopes.</p>
<p>An alternative to this kind of mean-focused regression is to use something called <a href="https://doi.org/10.1016/j.ecosta.2021.07.006"><em>distributional regression</em></a> <span class="citation" data-cites="KneibSilbersdorffSafken:2021">(<a href="#ref-KneibSilbersdorffSafken:2021" role="doc-biblioref">Kneib, Silbersdorff, and Säfken 2021</a>)</span> to estimate not lines and averages, but the overall shapes of statistical distributions.</p>
<p>Beta regression is one type of distributional regression, but before we explore how it works, we have to briefly review how distributions work.</p>
<p>In statistics, there are all sorts of probability distributions that can represent the general shape and properties of a variable (<a href="https://evalf21.classes.andrewheiss.com/example/random-numbers/#distributions">I have a whole guide for generating data using the most common distributions here</a>). For instance, in a normal distribution, most of the values are clustered around a mean, and values are spread out based on some amount of variance, or standard deviation.</p>
<p>Here are two normal distributions defined by different means and standard deviations. One is centered at 5 with a fairly wide standard deviation of 4 (so 95% of its values range from 5 ± (4 × 1.96), or from −3ish to 13ish), while the other is centered at 10 with a narrower standard deviation of 2 (so 95% of its values range from 10 ± (2 × 1.96), or from 6 to 14):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dnorm</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">5</span>, sd <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Normal(mean = 5, sd = 4)"</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dnorm</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">10</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Normal(mean = 10, sd = 2)"</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_viridis_d</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span>, end <span class="op">=</span> <span class="fl">0.8</span>, name <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-dist-normal-example-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>Most other distributions are defined in similar ways: there’s a central tendency (often the mean), and there’s some spread or variation around that center.</p>
<section id="beta-distributions-and-shape-parameters" class="level3"><h3 class="anchored" data-anchor-id="beta-distributions-and-shape-parameters">Beta distributions and shape parameters</h3>
<p>One really common distribution that’s <em>perfect</em> for percentages and proportions is <a href="https://en.wikipedia.org/wiki/Beta_distribution">the beta distribution</a>, which is naturally limited to numbers between 0 and 1 (but importantly doesn’t include 0 or 1). The beta distribution is an extremely flexible distribution and can take all sorts of different shapes and forms (stare at <a href="https://en.wikipedia.org/wiki/File:PDF_of_the_Beta_distribution.gif">this amazing animated GIF</a> for a while to see all the different shapes!)</p>
<p>Unlike a normal distribution, where you use the mean and standard deviation as the distributional parameters, beta distributions take two non-intuitive parameters: (1) <code>shape1</code> and (2) <code>shape2</code>, often abbreviated as <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>. <a href="https://stats.stackexchange.com/a/47782/3025">This answer at Cross Validated</a> does an <em>excellent</em> job of explaining the intuition behind beta distributions and it’d be worth it to read it. Go do that—I’ll wait.</p>
<p>Basically beta distributions are good at modeling the probabilities of things, and <code>shape1</code> and <code>shape2</code> represent specific parts of a formula for probabilities and proportions.</p>
<p>Let’s say that there’s an exam with 10 points where most people score a 6/10. Another way to think about this is that an exam is a collection of correct answers and incorrect answers, and that the percent correct follows this equation:</p>
<p><span class="math display">\[
\frac{\text{Number correct}}{\text{Number correct} + \text{Number incorrect}}
\]</span></p>
<p>If you scored a 6, you could write that as:</p>
<p><span class="math display">\[
\frac{6}{6+4} = \frac{6}{10}
\]</span></p>
<p>To make this formula more general, we can use variable names: <span class="math inline">\(a\)</span> for the number correct and <span class="math inline">\(b\)</span> for the number incorrect, leaving us with this:</p>
<p><span class="math display">\[
\frac{a}{a + b}
\]</span></p>
<p>In a beta distribution, the <span class="math inline">\(a\)</span> and the <span class="math inline">\(b\)</span> in that equation correspond to the <code>shape1</code> and <code>shape2</code> parameters. If we want to look at the distribution of scores for this test where most people get 6/10, or 60%, we can use 6 and 4 as parameters. Most people score around 60%, and the distribution isn’t centered—it’s asymmetric. Neat!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dbeta</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>shape1 <span class="op">=</span> <span class="fl">6</span>, shape2 <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Beta(shape1 = 6, shape2 = 4)"</span><span class="op">)</span>,</span>
<span>                size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_viridis_d</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span>, name <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span><span class="co">## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">## ℹ Please use `linewidth` instead.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-dist-beta-6-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>The magic of—and most confusing part about—beta distributions is that you can get all sorts of curves by just changing the shape parameters. To make this easier to see, we can make a bunch of different beta distributions.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dbeta</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>shape1 <span class="op">=</span> <span class="fl">6</span>, shape2 <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Beta(shape1 = 6, shape2 = 4)"</span><span class="op">)</span>,</span>
<span>                size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dbeta</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>shape1 <span class="op">=</span> <span class="fl">60</span>, shape2 <span class="op">=</span> <span class="fl">40</span><span class="op">)</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Beta(shape1 = 60, shape2 = 40)"</span><span class="op">)</span>,</span>
<span>                size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dbeta</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>shape1 <span class="op">=</span> <span class="fl">9</span>, shape2 <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Beta(shape1 = 9, shape2 = 1)"</span><span class="op">)</span>,</span>
<span>                size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dbeta</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>shape1 <span class="op">=</span> <span class="fl">2</span>, shape2 <span class="op">=</span> <span class="fl">11</span><span class="op">)</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Beta(shape1 = 2, shape2 = 11)"</span><span class="op">)</span>,</span>
<span>                size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_viridis_d</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span>, end <span class="op">=</span> <span class="fl">0.8</span>, name <span class="op">=</span> <span class="st">""</span>,</span>
<span>                        guide <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-dist-beta-lots-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>To figure out the center of each of these distributions, think of the <span class="math inline">\(\frac{a}{a+b}\)</span> formula. For the blue distribution on the far left, for instance, it’s <span class="math inline">\(\frac{2}{2+11}\)</span> or 0.154. The orange distribution on the far right is centered at <span class="math inline">\(\frac{9}{9+1}\)</span>, or 0.9. The tall pink-ish distribution is centered at 0.6 (<span class="math inline">\(\frac{60}{60+40}\)</span>), just like the <span class="math inline">\(\frac{6}{6+4}\)</span> distribution, but it’s much narrower and less spread out. When working with these two shape parameters, you control the variance or spread of the distribution by scaling the values up or down.</p>
</section><section id="mean-and-precision-instead-of-shapes" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="mean-and-precision-instead-of-shapes">Mean and precision instead of shapes</h3>
<p>But thinking about these shapes and manually doing the <span class="math inline">\(\frac{a}{a+b}\)</span> calculation in your head is hard! It’s even harder to get a specific amount of spread. Most other distributions can be defined with a center and some amount of spread or variance, but with beta distributions you’re stuck with these weirdly interacting shape parameters.</p>
<p>Fortunately there’s <a href="https://en.wikipedia.org/wiki/Beta_distribution#Alternative_parameterizations">an alternative way</a> of parameterizing the beta distribution that uses a mean <span class="math inline">\(\mu\)</span> and precision <span class="math inline">\(\phi\)</span> (the same idea as variance) instead of these strange shapes.</p>
<p>These shapes and the <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\phi\)</span> parameters are mathematically related and interchangeable. Formally, the two shapes can be defined using <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\phi\)</span> like so:</p>
<p><span class="math display">\[
\begin{aligned}
\text{shape1 } (a) &amp;= \mu \times \phi \\
\text{shape2 } (b) &amp;= (1 - \mu) \times \phi
\end{aligned}
\]</span></p>
<p>Based on this, we can do some algebra to figure out how to write <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\phi\)</span> using <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>:</p>
<p><span class="math display">\[
\begin{equation}
\begin{aligned}[t]
&amp;\text{[get } \phi \text{ alone]} \\
\mu \times \phi &amp;= a \\
\phi &amp;= \frac{a}{\mu}
\end{aligned}
\qquad
\begin{aligned}[t]
&amp;\text{[solve for } \mu \text{]} \\
b &amp;= (1 - \mu) \times \phi \\
b &amp;= (1 - \mu) \times \frac{a}{\mu} \\
b &amp;= \frac{a}{\mu} - \frac{a \mu}{\mu} \\
b &amp;= \frac{a}{\mu} - a \\
a + b &amp;= \frac{a}{\mu} \\
\color{orange}{\mu} &amp;\color{orange}{= \frac{a}{a + b}}
\end{aligned}
\qquad
\begin{aligned}[t]
&amp;\text{[solve for } \phi \text{]} \\
a &amp;= \mu \times \phi \\
a &amp;= \left( \frac{a}{a + b} \right) \times \phi \\
a &amp;= \frac{a \phi}{a + b} \\
(a + b) a &amp;= a \phi \\
a^2 + ba &amp;= a \phi \\
\color{orange}{\phi} &amp;\color{orange}{= a + b}
\end{aligned}
\end{equation}
\]</span></p>
<p>It’s thus possible to translate between these two parameterizations:</p>
<p><span class="math display">\[
\begin{equation}
\begin{aligned}[t]
\text{Shape 1:} &amp;&amp; a &amp;= \mu \phi \\
\text{Shape 2:} &amp;&amp; b &amp;= (1 - \mu) \phi
\end{aligned}
\qquad\qquad\qquad
\begin{aligned}[t]
\text{Mean:} &amp;&amp; \mu &amp;= \frac{a}{a + b} \\
\text{Precision:} &amp;&amp; \phi &amp;= a + b
\end{aligned}
\end{equation}
\]</span></p>
<p>To help with the intuition, we can make a couple little functions to switch between them.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">shapes_to_muphi</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">shape1</span>, <span class="va">shape2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mu</span> <span class="op">&lt;-</span> <span class="va">shape1</span> <span class="op">/</span> <span class="op">(</span><span class="va">shape1</span> <span class="op">+</span> <span class="va">shape2</span><span class="op">)</span></span>
<span>  <span class="va">phi</span> <span class="op">&lt;-</span> <span class="va">shape1</span> <span class="op">+</span> <span class="va">shape2</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="va">mu</span>, phi <span class="op">=</span> <span class="va">phi</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">muphi_to_shapes</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mu</span>, <span class="va">phi</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">shape1</span> <span class="op">&lt;-</span> <span class="va">mu</span> <span class="op">*</span> <span class="va">phi</span></span>
<span>  <span class="va">shape2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">mu</span><span class="op">)</span> <span class="op">*</span> <span class="va">phi</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>shape1 <span class="op">=</span> <span class="va">shape1</span>, shape2 <span class="op">=</span> <span class="va">shape2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Remember our initial distribution where <code>shape1</code> was 6 and <code>shape2</code> was 4? Here’s are the parameters for that using <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\phi\)</span> instead:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">shapes_to_muphi</span><span class="op">(</span><span class="fl">6</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">## $mu</span></span>
<span><span class="co">## [1] 0.6</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $phi</span></span>
<span><span class="co">## [1] 10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It has a mean of 0.6 and a precision of 10. That more precise and taller distribution where <code>shape1</code> was 60 and <code>shape2</code> was 40?</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">shapes_to_muphi</span><span class="op">(</span><span class="fl">60</span>, <span class="fl">40</span><span class="op">)</span></span>
<span><span class="co">## $mu</span></span>
<span><span class="co">## [1] 0.6</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $phi</span></span>
<span><span class="co">## [1] 100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It has the same mean of 0.6, but a much higher precision (100 now instead of 10).</p>
<p>R has built-in support for the shape-based beta distribution with things like <code><a href="https://rdrr.io/r/stats/Beta.html">dbeta()</a></code>, <code><a href="https://rdrr.io/r/stats/Beta.html">rbeta()</a></code>, etc. We can work with this reparameterized <span class="math inline">\(\mu\)</span>- and <span class="math inline">\(\phi\)</span>-based beta distribution using the <code>dprop()</code> (and <code>rprop()</code>, etc.) from the <strong>extraDistr</strong> package. It takes two arguments: <code>size</code> for <span class="math inline">\(\phi\)</span> and <code>mean</code> for <span class="math inline">\(\mu\)</span>.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">beta_shapes</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dbeta</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>shape1 <span class="op">=</span> <span class="fl">6</span>, shape2 <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"dbeta(shape1 = 6, shape2 = 4)"</span><span class="op">)</span>,</span>
<span>                size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dbeta</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>shape1 <span class="op">=</span> <span class="fl">60</span>, shape2 <span class="op">=</span> <span class="fl">40</span><span class="op">)</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"dbeta(shape1 = 60, shape2 = 40)"</span><span class="op">)</span>,</span>
<span>                size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dbeta</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>shape1 <span class="op">=</span> <span class="fl">9</span>, shape2 <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"dbeta(shape1 = 9, shape2 = 1)"</span><span class="op">)</span>,</span>
<span>                size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dbeta</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>shape1 <span class="op">=</span> <span class="fl">2</span>, shape2 <span class="op">=</span> <span class="fl">11</span><span class="op">)</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"dbeta(shape1 = 2, shape2 = 11)"</span><span class="op">)</span>,</span>
<span>                size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_viridis_d</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span>, end <span class="op">=</span> <span class="fl">0.8</span>, name <span class="op">=</span> <span class="st">""</span>,</span>
<span>                        guide <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Shape-based beta distributions"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">beta_mu_phi</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dprop</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">0.6</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"dprop(mean = 0.6, size = 10)"</span><span class="op">)</span>,</span>
<span>                size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dprop</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">0.6</span>, size <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"dprop(mean = 0.6, size = 100)"</span><span class="op">)</span>,</span>
<span>                size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dprop</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">0.9</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"dprop(mean = 0.9, size = 10)"</span><span class="op">)</span>,</span>
<span>                size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dprop</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">0.154</span>, size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"dprop(mean = 0.154, size = 13)"</span><span class="op">)</span>,</span>
<span>                size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_viridis_d</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span>, end <span class="op">=</span> <span class="fl">0.8</span>, name <span class="op">=</span> <span class="st">""</span>,</span>
<span>                        guide <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mean- and precision-based beta distributions"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">beta_shapes</span> <span class="op">|</span> <span class="va">beta_mu_phi</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p class="page-columns page-full"><img src="index_files/figure-html/plot-dist-beta-lots-dprop-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-page-inset-right" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Phew. That’s a lot of background to basically say that you don’t have to think about the shape parameters for beta distributions—you can think of mean (<span class="math inline">\(\mu\)</span>) and precision (<span class="math inline">\(\phi\)</span>) instead, just like you do with a normal distribution and its mean and standard deviation.</p>
</section></section><section id="a-beta-regression" class="level2"><h2 class="anchored" data-anchor-id="a-beta-regression">3a: Beta regression</h2>
<p>So, with that quick background on how beta distributions work, we can now explore how beta regression lets us model outcomes that range between 0 and 1. Again, beta regression is a <em>distributional</em> regression, which means we’re ultimately modeling <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\phi\)</span> and not just a slope and intercept. With this regression, we’ll be able to fit separate models for both parameters and see how the overall distribution shifts based on different covariates.</p>
<p>The <a href="https://cran.r-project.org/web/packages/betareg/index.html"><strong>betareg</strong> package</a> provides the <code>betareg()</code> function for doing frequentist beta regression. For the sake of simplicity, we’ll just look at <code>prop_fem ~ quota</code> and ignore polyarchy for a bit.</p>
<p>The syntax is just like all other formula-based regression functions, but with an added bit: the first part of the equation (<code>prop_fem ~ quota</code>) models the mean, or <span class="math inline">\(\mu\)</span>, while anything that comes after a <code>|</code> in the formula will explain variation in the precision, or <span class="math inline">\(\phi\)</span>.</p>
<p>Let’s try it out!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_beta</span> <span class="op">&lt;-</span> <span class="fu">betareg</span><span class="op">(</span><span class="va">prop_fem</span> <span class="op">~</span> <span class="va">quota</span> <span class="op">|</span> <span class="va">quota</span>, </span>
<span>                      data <span class="op">=</span> <span class="va">vdem_2015</span>, </span>
<span>                      link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span></span>
<span><span class="co">## Error in betareg(prop_fem ~ quota | quota, data = vdem_2015, link = "logit"): invalid dependent variable, all observations must be in (0, 1)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Oh no! We have an error. Beta regression can <em>only</em> handle outcome values that range between 0 and 1—it <strong>cannot</strong> deal with values that are exactly 0 or exactly 1.</p>
<p>We’ll show how to deal with 0s and 1s later. For now we can do some trickery and add 0.001 to all the 0s so that they’re not actually 0. This is cheating, but it’s fine for now :)</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vdem_2015_fake0</span> <span class="op">&lt;-</span> <span class="va">vdem_2015</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>prop_fem <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">prop_fem</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fl">0.001</span>, <span class="va">prop_fem</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_beta</span> <span class="op">&lt;-</span> <span class="fu">betareg</span><span class="op">(</span><span class="va">prop_fem</span> <span class="op">~</span> <span class="va">quota</span> <span class="op">|</span> <span class="va">quota</span>, </span>
<span>                      data <span class="op">=</span> <span class="va">vdem_2015_fake0</span>, </span>
<span>                      link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span></span>
<span><span class="fu">tidy</span><span class="op">(</span><span class="va">model_beta</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 4 × 6</span></span>
<span><span class="co">##   component term        estimate std.error statistic  p.value</span></span>
<span><span class="co">##   &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">## 1 mean      (Intercept)   -1.44     0.0861    -16.7  7.80e-63</span></span>
<span><span class="co">## 2 mean      quotaTRUE      0.296    0.115       2.58 9.79e- 3</span></span>
<span><span class="co">## 3 precision (Intercept)    2.04     0.140      14.6  2.42e-48</span></span>
<span><span class="co">## 4 precision quotaTRUE      0.440    0.214       2.06 3.93e- 2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="interpreting-coefficients" class="level3"><h3 class="anchored" data-anchor-id="interpreting-coefficients">Interpreting coefficients</h3>
<p>We now have two sets of coefficients, one set for each parameter (the mean and precision). The parameters for the mean are measured on the logit scale, just like with logistic regression previously, and we can calculate the marginal effect of having a quota by using <code><a href="https://rdrr.io/r/stats/Logistic.html">plogis()</a></code> and piecing together the coefficient and the intercept:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">beta_mu_intercept</span> <span class="op">&lt;-</span> <span class="va">model_beta</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">component</span> <span class="op">==</span> <span class="st">"mean"</span>, <span class="va">term</span> <span class="op">==</span> <span class="st">"(Intercept)"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span></span>
<span></span>
<span><span class="va">beta_mu_quota</span> <span class="op">&lt;-</span> <span class="va">model_beta</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">component</span> <span class="op">==</span> <span class="st">"mean"</span>, <span class="va">term</span> <span class="op">==</span> <span class="st">"quotaTRUE"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">beta_mu_intercept</span> <span class="op">+</span> <span class="va">beta_mu_quota</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">beta_mu_intercept</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.0501</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Having a quota thus increases the average of the distribution of women MPs by 5.006 percentage points, on average. That’s the same value that we found with OLS and with fractional logistic regression!</p>
</section><section id="working-with-the-precision-parameter" class="level3"><h3 class="anchored" data-anchor-id="working-with-the-precision-parameter">Working with the precision parameter</h3>
<p>But what about those precision parameters—what can we do with those? For mathy reasons, these are not measured on a logit scale. Instead, they’re logged values. We can invert them by exponentiating them with <code><a href="https://rdrr.io/r/base/Log.html">exp()</a></code>.</p>
<p>The phi intercept represents the precision of the distribution of the proportion of women MPs in countries without a quota, while the phi coefficient for quota represents the change in that precision when <code>quota</code> is <code>TRUE</code>. That means we have all the parameters to draw two different distributions of our outcome, split by whether countries have quotas. Let’s plot these two predicted distributions on top of the true underlying data and see how well they fit:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">beta_phi_intercept</span> <span class="op">&lt;-</span> <span class="va">model_beta</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">component</span> <span class="op">==</span> <span class="st">"precision"</span>, <span class="va">term</span> <span class="op">==</span> <span class="st">"(Intercept)"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span></span>
<span></span>
<span><span class="va">beta_phi_quota</span> <span class="op">&lt;-</span> <span class="va">model_beta</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">component</span> <span class="op">==</span> <span class="st">"precision"</span>, <span class="va">term</span> <span class="op">==</span> <span class="st">"quotaTRUE"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span></span>
<span></span>
<span><span class="va">no_quota_title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"dprop(mean = plogis("</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">beta_mu_intercept</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                         <span class="st">"), size = exp("</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">beta_phi_intercept</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"))"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">quota_title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"dprop(mean = plogis("</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">beta_mu_intercept</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                      <span class="st">" + "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">beta_mu_quota</span>, <span class="fl">2</span><span class="op">)</span>, </span>
<span>                      <span class="st">"), size = exp("</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">beta_phi_intercept</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                      <span class="st">" + "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">beta_phi_quota</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"))"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_density</span><span class="op">(</span>data <span class="op">=</span> <span class="va">vdem_2015_fake0</span>, </span>
<span>               <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">prop_fem</span>, fill <span class="op">=</span> <span class="va">quota</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dprop</span>, size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">beta_phi_intercept</span><span class="op">)</span>, </span>
<span>                            mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">beta_mu_intercept</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">no_quota_title</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dprop</span>, size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">beta_phi_intercept</span> <span class="op">+</span> <span class="va">beta_phi_quota</span><span class="op">)</span>, </span>
<span>                            mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">beta_mu_intercept</span> <span class="op">+</span> <span class="va">beta_mu_quota</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">quota_title</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_d</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span>, end <span class="op">=</span> <span class="fl">0.8</span>, name <span class="op">=</span> <span class="st">"Quota"</span>,</span>
<span>                       guide <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span>, order <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_viridis_d</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span>, end <span class="op">=</span> <span class="fl">0.8</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, name <span class="op">=</span> <span class="st">""</span>,</span>
<span>                        guide <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>reverse <span class="op">=</span> <span class="cn">TRUE</span>, ncol <span class="op">=</span> <span class="fl">1</span>, order <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Proportion of women in parliament"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-dist-beta-shifted-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>Note how the whole distribution changes when there’s a quota. The mean doesn’t just shift rightward—the precision of the distribution changes too and the distribution where quota is <code>TRUE</code> has a whole new shape. The model actually captures it really well too! Look at how closely the predicted orange line aligns with the the underlying data. The blue predicted line is a little off, but that’s likely due to the 0s that we cheated with.</p>
<p>You don’t have to model the <span class="math inline">\(\phi\)</span> if you don’t want to. A model like this will work just fine too:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_beta_no_phi</span> <span class="op">&lt;-</span> <span class="fu">betareg</span><span class="op">(</span><span class="va">prop_fem</span> <span class="op">~</span> <span class="va">quota</span>, </span>
<span>                             data <span class="op">=</span> <span class="va">vdem_2015_fake0</span>, </span>
<span>                             link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span></span>
<span><span class="fu">tidy</span><span class="op">(</span><span class="va">model_beta_no_phi</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 3 × 6</span></span>
<span><span class="co">##   component term        estimate std.error statistic  p.value</span></span>
<span><span class="co">##   &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">## 1 mean      (Intercept)   -1.48     0.0785    -18.8  3.70e-79</span></span>
<span><span class="co">## 2 mean      quotaTRUE      0.370    0.111       3.33 8.76e- 4</span></span>
<span><span class="co">## 3 precision (phi)          9.12     0.962       9.48 2.62e-21</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this case, you still get a precision component, but it’s universal across all the different coefficients—it doesn’t vary across <code>quota</code> (or any other variables, had we included any others in the model). Also, for whatever mathy reasons, when you <em>don’t</em> explicitly model the precision, the resulting coefficient in the table isn’t on the log scale—it’s a regular non-logged number, so there’s no need to exponentiate. We can plot the two distributions like before. The mean part is all the same! The only difference now is that phi is constant across the two groups</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">beta_phi</span> <span class="op">&lt;-</span> <span class="va">model_beta_no_phi</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">component</span> <span class="op">==</span> <span class="st">"precision"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span></span>
<span></span>
<span><span class="va">no_quota_title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"dprop(mean = plogis("</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">beta_mu_intercept</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                         <span class="st">"), size = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">beta_phi</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">quota_title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"dprop(mean = plogis("</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">beta_mu_intercept</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                      <span class="st">" + "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">beta_mu_quota</span>, <span class="fl">2</span><span class="op">)</span>, </span>
<span>                      <span class="st">"), size = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">beta_phi</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_density</span><span class="op">(</span>data <span class="op">=</span> <span class="va">vdem_2015_fake0</span>, </span>
<span>               <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">prop_fem</span>, fill <span class="op">=</span> <span class="va">quota</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dprop</span>, size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">beta_phi</span>, </span>
<span>                            mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">beta_mu_intercept</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">no_quota_title</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dprop</span>, size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">beta_phi</span>, </span>
<span>                            mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">beta_mu_intercept</span> <span class="op">+</span> <span class="va">beta_mu_quota</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">quota_title</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_d</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span>, end <span class="op">=</span> <span class="fl">0.8</span>, name <span class="op">=</span> <span class="st">"Quota"</span>,</span>
<span>                       guide <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span>, order <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_viridis_d</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span>, end <span class="op">=</span> <span class="fl">0.8</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, name <span class="op">=</span> <span class="st">""</span>,</span>
<span>                        guide <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>reverse <span class="op">=</span> <span class="cn">TRUE</span>, ncol <span class="op">=</span> <span class="fl">1</span>, order <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Proportion of women in parliament"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-dist-beta-shifted-no-phi-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>Again, the means are the same, so the average difference between having a quota and not having a quota is the same, but because the precision is constant, the distributions don’t fit the data as well.</p>
</section><section id="average-marginal-effects" class="level3"><h3 class="anchored" data-anchor-id="average-marginal-effects">Average marginal effects</h3>
<p>Because beta regression coefficients are all in logit units (with the exception of the <span class="math inline">\(\phi\)</span> part), we can interpret their marginal effects just like we did with logistic regression. It’s tricky to piece together all the different parts and feed them through <code><a href="https://rdrr.io/r/stats/Logistic.html">plogis()</a></code>, so it’s best to calculate the slope with hypothetical data as before.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">avg_slopes</span><span class="op">(</span><span class="va">model_beta</span>,</span>
<span>           newdata <span class="op">=</span> <span class="fu">datagrid</span><span class="op">(</span>quota <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Term     Contrast Estimate Std. Error   z Pr(&gt;|z|)  2.5 % 97.5 %</span></span>
<span><span class="co">##  quota TRUE - FALSE   0.0501     0.0192 2.6  0.00926 0.0124 0.0878</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Columns: term, contrast, estimate, std.error, statistic, p.value, conf.low, conf.high</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After incorporating all the moving parts of the model, we find that having a quota is associated with an increase of 5.006 percentage points of the proportion of women MPs, on average, which is what we found earlier by piecing together the intercept and coefficient. If we had more covariates, this <code>avg_slopes()</code> approach would be necessary, since it’s tricky to incorporate all the different model pieces by hand.</p>
</section></section><section id="b-beta-regression-bayesian-style" class="level2"><h2 class="anchored" data-anchor-id="b-beta-regression-bayesian-style">3b: Beta regression, Bayesian style</h2>
<p>Uncertainty is wonderful. We’re working with distributions already with distributional regression like beta regression—it would be great if we could quantify and model our uncertainty directly and treat all the parameters as distributions.</p>
<p>Fortunately Bayesian regression lets us do just that. We can generate thousands of plausible estimates based on the combination of our prior beliefs and the likelihood of the data, and then we can explore the uncertainty and the distributions of all those estimates.</p>
<p>We’ll also get to interpret the results Bayesianly. <a href="https://evalf21.classes.andrewheiss.com/resource/bayes/#confidence-intervals-vs-credible-intervals">Goodbye confidence intervals; hello credible intervals.</a></p>
<p>The <a href="https://paul-buerkner.github.io/brms/">incredible <strong>brms</strong> package</a> has built-in support for beta regression. I won’t go into details here about how to use <strong>brms</strong>—there are all sorts of tutorials and examples online for that (<a href="https://evalf21.classes.andrewheiss.com/resource/bayes/#super-short-example">here’s a quick basic one</a>).</p>
<p>Let’s recreate the model we made with <code>betareg()</code> earlier, but now with a Bayesian flavor. The formula syntax is a little different with <strong>brms</strong>. Instead of using <code>|</code> to divide the <span class="math inline">\(\mu\)</span> part from the <span class="math inline">\(\phi\)</span> part, we specify two separate formulas: one for <code>prop_fem</code> for the <span class="math inline">\(\mu\)</span> part, and one for <code>phi</code> for the <span class="math inline">\(\phi\)</span> part. We’ll use the default priors here (but in real life, you’d want to set them to something sensible), and we’ll generate 2,000 Monte Carlo Markov Chain (MCMC) samples across 4 chains.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_beta_bayes</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span></span>
<span>  <span class="fu">bf</span><span class="op">(</span><span class="va">prop_fem</span> <span class="op">~</span> <span class="va">quota</span>,</span>
<span>     <span class="va">phi</span> <span class="op">~</span> <span class="va">quota</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">vdem_2015_fake0</span>,</span>
<span>  family <span class="op">=</span> <span class="fu">Beta</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">4</span>, iter <span class="op">=</span> <span class="fl">2000</span>, warmup <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>, </span>
<span>  <span class="co"># Use the cmdstanr backend for Stan because it's faster and more modern than</span></span>
<span>  <span class="co"># the default rstan You need to install the cmdstanr package first</span></span>
<span>  <span class="co"># (https://mc-stan.org/cmdstanr/) and then run cmdstanr::install_cmdstan() to</span></span>
<span>  <span class="co"># install cmdstan on your computer.</span></span>
<span>  backend <span class="op">=</span> <span class="st">"cmdstanr"</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"model_beta_bayes"</span>  <span class="co"># Save this so it doesn't have to always rerun</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check out the results—they’re basically the same that we found with <code>betareg()</code> in <code>model_beta</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tidy</span><span class="op">(</span><span class="va">model_beta_bayes</span>, effects <span class="op">=</span> <span class="st">"fixed"</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 4 × 7</span></span>
<span><span class="co">##   effect component term            estimate std.error conf.low conf.high</span></span>
<span><span class="co">##   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">## 1 fixed  cond      (Intercept)       -1.44     0.0864  -1.61      -1.27 </span></span>
<span><span class="co">## 2 fixed  cond      phi_(Intercept)    2.02     0.140    1.74       2.29 </span></span>
<span><span class="co">## 3 fixed  cond      quotaTRUE          0.296    0.114    0.0713     0.518</span></span>
<span><span class="co">## 4 fixed  cond      phi_quotaTRUE      0.436    0.211    0.0159     0.837</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="working-with-the-posterior" class="level3"><h3 class="anchored" data-anchor-id="working-with-the-posterior">Working with the posterior</h3>
<p>The estimates are the same, but richer—we have a complete posterior distribution for each coefficient, which we can visualize in neat ways:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">posterior_beta</span> <span class="op">&lt;-</span> <span class="va">model_beta_bayes</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">gather_draws</span><span class="op">(</span><span class="va">`b_.*`</span>, regex <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>component <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">.variable</span>, <span class="st">"phi_"</span><span class="op">)</span>, <span class="st">"Precision"</span>, <span class="st">"Mean"</span><span class="op">)</span>,</span>
<span>         intercept <span class="op">=</span> <span class="fu">str_detect</span><span class="op">(</span><span class="va">.variable</span>, <span class="st">"Intercept"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">posterior_beta</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.value</span>, y <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="va">.variable</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">component</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>slab_alpha <span class="op">=</span> <span class="va">intercept</span><span class="op">)</span>, </span>
<span>               .width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.95</span><span class="op">)</span>, point_interval <span class="op">=</span> <span class="st">"median_hdi"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_d</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"viridis"</span>, end <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_slab_alpha_discrete</span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span>, slab_alpha <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Coefficient"</span>, y <span class="op">=</span> <span class="st">"Variable"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"80% and 95% credible intervals shown in black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">component</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-coefs-bayes-basic-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>That shows the coefficients in their transformed scale (logits for the mean, logs for the precision), but we can transform them to the response scale too by feeding the <span class="math inline">\(\phi\)</span> parts to <code><a href="https://rdrr.io/r/base/Log.html">exp()</a></code> and the <span class="math inline">\(\mu\)</span> parts to <code><a href="https://rdrr.io/r/stats/Logistic.html">plogis()</a></code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_beta_bayes</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">spread_draws</span><span class="op">(</span><span class="va">`b_.*`</span>, regex <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"b_phi"</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="op">(</span><span class="op">!</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"."</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"b_phi"</span><span class="op">)</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">gather_variables</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">median_hdi</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 4 × 7</span></span>
<span><span class="co">##   .variable       .value .lower .upper .width .point .interval</span></span>
<span><span class="co">##   &lt;chr&gt;            &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    </span></span>
<span><span class="co">## 1 b_Intercept      0.192  0.167  0.219   0.95 median hdi      </span></span>
<span><span class="co">## 2 b_phi_Intercept  7.57   5.66   9.80    0.95 median hdi      </span></span>
<span><span class="co">## 3 b_phi_quotaTRUE  1.55   0.997  2.27    0.95 median hdi      </span></span>
<span><span class="co">## 4 b_quotaTRUE      0.573  0.522  0.630   0.95 median hdi</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>But beyond the intercepts here, this isn’t actually that helpful. The median back-transformed intercept for the <span class="math inline">\(\mu\)</span> part of the regression is 0.192, which means countries without a quota have an average proportion of women MPs of 19.2%. That’s all fine. The quota effect here, though, is 0.573. That does <em>not</em> mean that having a quota increases the proportion of women by 57 percentage points! In order to find the marginal effect of having a quota, we need to also incorporate the intercept. Remember when we ran <code>plogis(intercept + coefficient) - plogis(intercept)</code> earlier? We have to do that again.</p>
</section><section id="posterior-average-marginal-effects" class="level3"><h3 class="anchored" data-anchor-id="posterior-average-marginal-effects">Posterior average marginal effects</h3>
<section id="binary-predictor" class="level4"><h4 class="anchored" data-anchor-id="binary-predictor">Binary predictor</h4>
<p>Once again, the math for combining these coefficients can get hairy, especially when we’re working with more than one explanatory variable, so instead of figuring out that math, we’ll calculate the marginal effects across different values of <code>quota</code>.</p>
<p><del>The <strong>marginaleffects</strong> package doesn’t work with <strong>brms</strong> models (and <a href="https://github.com/vincentarelbundock/marginaleffects/issues/100">there are no plans to add support for it</a>), but <a href="https://cran.r-project.org/web/packages/emmeans/index.html">the powerful <strong>emmeans</strong> package</a> does, so we’ll use that. The syntax is a little different, but the documentation for <strong>emmeans</strong> is really complete and helpful. <a href="https://errickson.net/marginsnotes/">This website also has a bunch of worked out examples</a>.</del></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
2023-08-18 edit
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <strong>marginaleffects</strong> package <em>does</em> work with <strong>brms</strong> models now and I like its interface and its approach to estimating things a lot better than <strong>emmeans</strong>, so I’ve changed all the code here to use it instead. If you want to see the <strong>emmeans</strong> version of everything, <a href="https://github.com/andrewheiss/ath-quarto/blob/d8628ba05ee4e4dbec3c571e0656461e2f737594/blog/2021/11/08/beta-regression-guide/index.qmd#L834">look at this past version at GitHub</a>.</p>
<p>Also, I’m pretty loosey-goosey about the term “marginal effect” throughout this post because this was early in my journey to actually understanding what all these different estimands are. See <a href="https://www.andrewheiss.com/blog/2022/05/20/marginalia/">my “Marginalia” post</a>, published a few months after this one, for a ton more about what “marginal effects” actually mean.</p>
</div>
</div>
<p>We can calculate the pairwise marginal effects across different values of <code>quota</code>, which conveniently shows us the difference, or the marginal effect of having a quota:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_beta_bayes</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">avg_comparisons</span><span class="op">(</span>variables <span class="op">=</span> <span class="st">"quota"</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Term     Contrast Estimate  2.5 % 97.5 %</span></span>
<span><span class="co">##  quota TRUE - FALSE     0.05 0.0121 0.0875</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Columns: term, contrast, estimate, conf.low, conf.high</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This summary information is helpful—we have our difference in predicted outcomes of 0.05, which is roughly what we found in earlier models. We also have a 95% highest posterior density interval for the difference.</p>
<p>But it would be great if we could visualize these predictions! What do the posteriors for quota and non-quota countries look like, and what does the distribution of differences look like? We can work with the original model and MCMC chains to visualize this, letting <strong>brms</strong> take care of the hard work of predicting the coefficients we need and back-transforming them into probabilities.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
marginaleffects
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>marginaleffects</strong> can also handle all this with its <a href="https://marginaleffects.com/articles/comparisons.html"><code>comparisons()</code></a> and <a href="https://marginaleffects.com/articles/hypothesis.html"><code>hypotheses()</code></a> functions—<a href="https://marginaleffects.com/articles/brms.html">even with Bayesian models</a>!</p>
</div>
</div>
<p>We’ll use <code>epred_draws()</code> from <strong>tidybayes</strong> to plug in a hypothetical dataset and generate predictions, as we did with previous models. Only this time, instead of getting a single predicted value for each level of <code>quota</code>, we’ll get 4,000. The <code>epred_draws()</code> (like all <strong>tidybayes</strong> functions) returns a long tidy data frame, so it’s really easy to plot with ggplot:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Plug a dataset where quota is FALSE and TRUE into the model</span></span>
<span><span class="va">beta_bayes_pred</span> <span class="op">&lt;-</span> <span class="va">model_beta_bayes</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">epred_draws</span><span class="op">(</span>newdata <span class="op">=</span> <span class="fu">tibble</span><span class="op">(</span>quota <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">beta_bayes_pred</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.epred</span>, y <span class="op">=</span> <span class="va">quota</span>, fill <span class="op">=</span> <span class="va">quota</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span>.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.95</span><span class="op">)</span>, point_interval <span class="op">=</span> <span class="st">"median_hdi"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_d</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span>, end <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Predicted proportion of women in parliament"</span>, y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"80% and 95% credible intervals shown in black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-bayes-beta-preds-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>That’s super neat! We can easily see that countries with quotas have a higher predicted proportion of women in parliament, and we can see the uncertainty in those estimates. We can also work with these posterior predictions to calculate the difference in proportions, or the marginal effect of having a quota, which is the main thing we’re interested in.</p>
<p>We can use <code>compare_levels()</code> from <strong>tidybayes</strong> to calculate the difference between these two posteriors:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">beta_bayes_pred_diff</span> <span class="op">&lt;-</span> <span class="va">beta_bayes_pred</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">compare_levels</span><span class="op">(</span>variable <span class="op">=</span> <span class="va">.epred</span>, by <span class="op">=</span> <span class="va">quota</span><span class="op">)</span></span>
<span></span>
<span><span class="va">beta_bayes_pred_diff</span> <span class="op">%&gt;%</span> <span class="fu">median_hdi</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 7</span></span>
<span><span class="co">##   quota        .epred .lower .upper .width .point .interval</span></span>
<span><span class="co">##   &lt;chr&gt;         &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    </span></span>
<span><span class="co">## 1 TRUE - FALSE 0.0500 0.0136 0.0889   0.95 median hdi</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">beta_bayes_pred_diff</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.epred</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span>.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.95</span><span class="op">)</span>, point_interval <span class="op">=</span> <span class="st">"median_hdi"</span>,</span>
<span>               fill <span class="op">=</span> <span class="st">"#bc3032"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">label_pp</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Average marginal effect of having a gender-based\nquota on the proportion of women in parliament"</span>, </span>
<span>       y <span class="op">=</span> <span class="cn">NULL</span>, caption <span class="op">=</span> <span class="st">"80% and 95% credible intervals shown in black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-mfx-beta-bayes-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>Perfect! The median marginal effect of having a quota is 6 percentage points, but it can range from 2 to 10.</p>
</section><section id="continuous-predictor" class="level4"><h4 class="anchored" data-anchor-id="continuous-predictor">Continuous predictor</h4>
<p>The same approach works for continuous predictors too, just like with previous methods. Let’s build a model that explains both the mean and the precision with <code>quota</code> and <code>polyarchy</code>. We don’t necessarily have to model the precision with the same variables that we use for the mean—that can be a completely separate process—but we’ll do it just for fun.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># We need to specify init here because the beta precision parameter can never</span></span>
<span><span class="co"># be negative, but Stan will generate random initial values from -2 to 2, even</span></span>
<span><span class="co"># for beta's precision, which leads to rejected chains and slower performance.</span></span>
<span><span class="co"># For even fancier init handling, see Solomon Kurz's post here:</span></span>
<span><span class="co"># https://solomonkurz.netlify.app/post/2021-06-05-don-t-forget-your-inits/</span></span>
<span><span class="va">model_beta_bayes_1</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span></span>
<span>  <span class="fu">bf</span><span class="op">(</span><span class="va">prop_fem</span> <span class="op">~</span> <span class="va">quota</span> <span class="op">+</span> <span class="va">polyarchy</span>,</span>
<span>     <span class="va">phi</span> <span class="op">~</span> <span class="va">quota</span> <span class="op">+</span> <span class="va">polyarchy</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">vdem_2015_fake0</span>,</span>
<span>  family <span class="op">=</span> <span class="fu">Beta</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  init <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">4</span>, iter <span class="op">=</span> <span class="fl">2000</span>, warmup <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>, </span>
<span>  backend <span class="op">=</span> <span class="st">"cmdstanr"</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"model_beta_bayes_1"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll forgo interpreting all these different coefficients, since we’d need to piece together the different parts and back-transform them with either <code><a href="https://rdrr.io/r/stats/Logistic.html">plogis()</a></code> (for the <span class="math inline">\(\mu\)</span> parts) or <code><a href="https://rdrr.io/r/base/Log.html">exp()</a></code> (for the <span class="math inline">\(\phi\)</span> parts). Instead, we’ll skip to the marginal effect of polyarchy on the proportion of women MPs. First we can look at the posterior prediction of the outcome across the whole range of democracy scores:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use a dataset where quota is FALSE and polyarchy is a range</span></span>
<span><span class="va">beta_bayes_pred_1</span> <span class="op">&lt;-</span> <span class="va">model_beta_bayes_1</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">epred_draws</span><span class="op">(</span>newdata <span class="op">=</span> <span class="fu">expand_grid</span><span class="op">(</span>quota <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                    polyarchy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">beta_bayes_pred_1</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">polyarchy</span>, y <span class="op">=</span> <span class="va">.epred</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_lineribbon</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Purples"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Polyarchy (democracy)"</span>, y <span class="op">=</span> <span class="st">"Predicted proportion of women MPs"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Credible interval"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-preds-polyarchy-beta-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>The predicted proportion of women MPs increases as democracy increases, as we’ve seen before. Note how the slope here isn’t constant, though—the line is slightly curved. That’s because this is a nonlinear regression model, making it so the marginal effect of democracy is different depending on its level. We can see this if we look at the instantaneous slope (or first derivative) at different values of polyarchy. <strong>marginaleffects</strong> makes this really easy with the <code>aavg_slopes()</code> function. If we ask it for the slope of the line, it will provide it at the average value of polyarchy, or 53.5:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">avg_slopes</span><span class="op">(</span><span class="va">model_beta_bayes_1</span>, variables <span class="op">=</span> <span class="st">"polyarchy"</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##       Term Estimate    2.5 %  97.5 %</span></span>
<span><span class="co">##  polyarchy  0.00126 0.000502 0.00196</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Columns: term, estimate, conf.low, conf.high</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our effect is thus 0.001, or 0.126 percentage points, but only for countries in the middle range of polyarchy. The slope is shallower and steeper depending on the level of democracy. We can check the slope (or effect) at different hypothetical levels:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">slopes</span><span class="op">(</span><span class="va">model_beta_bayes_1</span>, </span>
<span>       variables <span class="op">=</span> <span class="st">"polyarchy"</span>,</span>
<span>       newdata <span class="op">=</span> <span class="fu">datagrid</span><span class="op">(</span>polyarchy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">50</span>, <span class="fl">80</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##       Term Estimate    2.5 %  97.5 % quota polyarchy</span></span>
<span><span class="co">##  polyarchy 0.000991 0.000438 0.00140 FALSE        20</span></span>
<span><span class="co">##  polyarchy 0.001153 0.000464 0.00178 FALSE        50</span></span>
<span><span class="co">##  polyarchy 0.001314 0.000489 0.00219 FALSE        80</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Columns: rowid, term, estimate, conf.low, conf.high, predicted, predicted_hi, predicted_lo, tmp_idx, prop_fem, quota, polyarchy</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Neat! For observations with low democracy scores like 20, a one-unit increase in polyarchy is associated with a 0.099 percentage point increase in the proportion of women MPs, while countries with high scores like 80 see a 0.131 percentage point increase.</p>
<p>We can visualize the distribution of these marginal effects too by using <code>slopes()</code> to calculate the instantaneous slopes across all the MCMC chains, and then using <code>posteriordraws()</code> to extract the draws as tidy, plottable data.</p>
<p>(Side note: You could technically do this without <strong>marginaleffects</strong>. The way <strong>marginaleffects</strong> calculates the instantaneous slope is by finding the predicted average for some value, finding the predicted average for that same value plus a <em>tiny</em> amount extra, subtracting the two predictions, and dividing by that tiny extra amount. If you really didn’t want to use <strong>marginaleffects</strong>, you could generate predictions for <code>polyarchy = 20</code> and <code>polyarchy = 20.001</code>, subtract them by hand, and then divide by 0.001. That’s miserable though—don’t do it. Use <strong>marginaleffects</strong> instead.)</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ame_beta_bayes_1</span> <span class="op">&lt;-</span> <span class="va">model_beta_bayes_1</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">slopes</span><span class="op">(</span>variables <span class="op">=</span> <span class="st">"polyarchy"</span>,</span>
<span>         newdata <span class="op">=</span> <span class="fu">datagrid</span><span class="op">(</span>polyarchy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">50</span>, <span class="fl">80</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">posterior_draws</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">ame_beta_bayes_1</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">draw</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">polyarchy</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span>.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.95</span><span class="op">)</span>, point_interval <span class="op">=</span> <span class="st">"median_hdi"</span>,</span>
<span>               slab_alpha <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">label_pp_tiny</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_d</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"viridis"</span>, end <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Average marginal effect of polyarchy (democracy)"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Density"</span>, fill <span class="op">=</span> <span class="st">"Polyarchy"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"80% and 95% credible intervals shown in black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-ame-beta-bayes-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>To me this is absolutely incredible! Check out how the shapes of these distributions change as polyarchy increases! That’s because we modeled both the <span class="math inline">\(\mu\)</span> and the <span class="math inline">\(\phi\)</span> parameters of the beta distribution, so we get to see changes in both the mean and precision of the outcome. Had we left the phi part alone, doing something like <code>phi ~ 1</code>, the marginal effect would look the same and would just be shifted to the right.</p>
</section></section></section><section id="zero-inflated-beta-regression-bayesian-style" class="level2"><h2 class="anchored" data-anchor-id="zero-inflated-beta-regression-bayesian-style">4: Zero-inflated beta regression, Bayesian style</h2>
<p>Beta regression is really neat and modeling different components of the beta regression is a fascinating and rich way of thinking about the outcome variable. Plus the beta distribution naturally limits the outcome to the 0–1 range, so you don’t have to shoehorn the data into an OLS-based LPM or fractional logistic model.</p>
<p>One problem with beta regression, though, is that the beta distribution does <em>not</em> include 0 and 1. As we saw earlier, if your data has has 0s or 1s, the model breaks.</p>
<section id="a-new-parameter-for-modeling-the-zero-process" class="level3"><h3 class="anchored" data-anchor-id="a-new-parameter-for-modeling-the-zero-process">A new parameter for modeling the zero process</h3>
<p>To get around this, we can use a special zero-inflated beta regression. We’ll still model the <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\phi\)</span> (or mean and precision) of the beta distribution, but we’ll also model one new special parameter <span class="math inline">\(\alpha\)</span>. With zero-inflated regression, we’re actually modelling a mixture of data-generating processes:</p>
<ol type="1">
<li>A logistic regression model that predicts if an outcome is 0 or not, defined by <span class="math inline">\(\alpha\)</span>
</li>
<li>A beta regression model that predicts if an outcome is between 0 and 1 if it’s not zero, defined by <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\phi\)</span>
</li>
</ol>
<p>Let’s see how many zeros we have in the data:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vdem_2015</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">prop_fem</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>prop <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##   prop_fem == 0   n   prop</span></span>
<span><span class="co">## 1         FALSE 169 0.9826</span></span>
<span><span class="co">## 2          TRUE   3 0.0174</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Hahahaha only 3, or 1.7% of the data. That’s barely anything. Perhaps our approach of just adding a tiny amount to those three 0 observations is fine. For the sake of illustrating this approach, though, we’ll still model the zero-creating process.</p>
<p>The only difference between regular beta regression and zero-inflated regression is that we have to specify one more parameter: <code>zi</code>. This corresponds to the <span class="math inline">\(\alpha\)</span> parameter and determines the zero/not-zero process.</p>
<p>To help with the intuition, we’ll first run a model where we don’t actually define a model for <code>zi</code>—it’ll just return the intercept for the <span class="math inline">\(\alpha\)</span> parameter.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_beta_zi_int_only</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span></span>
<span>  <span class="fu">bf</span><span class="op">(</span><span class="va">prop_fem</span> <span class="op">~</span> <span class="va">quota</span>,</span>
<span>     <span class="va">phi</span> <span class="op">~</span> <span class="va">quota</span>,</span>
<span>     <span class="va">zi</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">vdem_clean</span>,</span>
<span>  family <span class="op">=</span> <span class="fu">zero_inflated_beta</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">4</span>, iter <span class="op">=</span> <span class="fl">2000</span>, warmup <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>,</span>
<span>  backend <span class="op">=</span> <span class="st">"cmdstanr"</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"model_beta_zi_int_only"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tidy</span><span class="op">(</span><span class="va">model_beta_zi_int_only</span>, effects <span class="op">=</span> <span class="st">"fixed"</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 5 × 7</span></span>
<span><span class="co">##   effect component term            estimate std.error conf.low conf.high</span></span>
<span><span class="co">##   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">## 1 fixed  cond      (Intercept)       -1.42     0.0229   -1.47     -1.38 </span></span>
<span><span class="co">## 2 fixed  cond      phi_(Intercept)    2.37     0.0437    2.29      2.46 </span></span>
<span><span class="co">## 3 fixed  zi        (Intercept)       -4.04     0.186    -4.43     -3.70 </span></span>
<span><span class="co">## 4 fixed  cond      quotaTRUE          0.303    0.0331    0.238     0.369</span></span>
<span><span class="co">## 5 fixed  cond      phi_quotaTRUE      0.237    0.0677    0.105     0.368</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As before, the parameters for <span class="math inline">\(\mu\)</span> (<code>(Intercept)</code> and <code>quotaTRUE</code>) are on the logit scale, while the parameters for <span class="math inline">\(\phi\)</span> (<code>phi_(Intercept)</code> and <code>phi_quotaTRUE</code>) are on the log scale. The zero-inflated parameter (or <span class="math inline">\(\alpha\)</span>) here (<code>(Intercept)</code> for the <code>zi</code> component) is on the logit scale like the regular model coefficients. That means we can back-transform it with <code><a href="https://rdrr.io/r/stats/Logistic.html">plogis()</a></code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">zi_intercept</span> <span class="op">&lt;-</span> <span class="fu">tidy</span><span class="op">(</span><span class="va">model_beta_zi_int_only</span>, effects <span class="op">=</span> <span class="st">"fixed"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">component</span> <span class="op">==</span> <span class="st">"zi"</span>, <span class="va">term</span> <span class="op">==</span> <span class="st">"(Intercept)"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Logit scale intercept</span></span>
<span><span class="va">zi_intercept</span></span>
<span><span class="co">## b_zi_Intercept </span></span>
<span><span class="co">##          -4.04</span></span>
<span></span>
<span><span class="co"># Transformed to a probability/proportion</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">zi_intercept</span><span class="op">)</span></span>
<span><span class="co">## b_zi_Intercept </span></span>
<span><span class="co">##         0.0172</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After transforming the intercept to a probability/proportion, we can see that it’s 1.72%—basically the same as the proportion of zeros in the data!</p>
<p>Right now, all we’ve modeled is the overall proportion of 0s. We haven’t modeled what determines those zeros. We can see that if we plot the posterior predictions for <code>prop_fem</code> across <code>quota</code>, highlighting predicted values that are 0. In general, ≈2% of the predicted outcomes should be zero, and since we didn’t really model <code>zi</code>, the 0s should be equally spread across the different levels of <code>quota</code>. To visualize this we’ll use a histogram instead of a density plot so that we can better see the count of 0s. We’ll also cheat a little and make the 0s a negative number so that the histogram bin for the 0s appears outside of the main 0–1 range.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">beta_zi_pred_int</span> <span class="op">&lt;-</span> <span class="va">model_beta_zi_int_only</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">predicted_draws</span><span class="op">(</span>newdata <span class="op">=</span> <span class="fu">tibble</span><span class="op">(</span>quota <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>is_zero <span class="op">=</span> <span class="va">.prediction</span> <span class="op">==</span> <span class="fl">0</span>,</span>
<span>         .prediction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">is_zero</span>, <span class="va">.prediction</span> <span class="op">-</span> <span class="fl">0.01</span>, <span class="va">.prediction</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">beta_zi_pred_int</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.prediction</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">is_zero</span><span class="op">)</span>, binwidth <span class="op">=</span> <span class="fl">0.025</span>, </span>
<span>                 boundary <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_d</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span>, end <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                       guide <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>reverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Predicted proportion of women in parliament"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Count"</span>, fill <span class="op">=</span> <span class="st">"Is zero?"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">quota</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>,</span>
<span>             labeller <span class="op">=</span> <span class="fu">labeller</span><span class="op">(</span>quota <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`TRUE` <span class="op">=</span> <span class="st">"Quota"</span>, </span>
<span>                                           `FALSE` <span class="op">=</span> <span class="st">"No Quota"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-zi-hist-int-only-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>The process for deciding 0/not 0 is probably determined by different political and social factors, though. It’s likely that having a quota, for instance, should increase the probability of having at least one woman. There are probably a host of other factors—if we were doing this in real life, we could fully specify a model that explains the no women vs.&nbsp;at-least-one-woman split. For now, we’ll just use <code>quota</code>, though (in part because there are actually only 3 zeros!). This model takes a little longer to run because of all the moving parts:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_beta_zi</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span></span>
<span>  <span class="fu">bf</span><span class="op">(</span><span class="va">prop_fem</span> <span class="op">~</span> <span class="va">quota</span>,</span>
<span>     <span class="va">phi</span> <span class="op">~</span> <span class="va">quota</span>,</span>
<span>     <span class="va">zi</span> <span class="op">~</span> <span class="va">quota</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">vdem_clean</span>,</span>
<span>  family <span class="op">=</span> <span class="fu">zero_inflated_beta</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">4</span>, iter <span class="op">=</span> <span class="fl">2000</span>, warmup <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>,</span>
<span>  backend <span class="op">=</span> <span class="st">"cmdstanr"</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"model_beta_zi"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tidy</span><span class="op">(</span><span class="va">model_beta_zi</span>, effects <span class="op">=</span> <span class="st">"fixed"</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 6 × 7</span></span>
<span><span class="co">##   effect component term            estimate std.error conf.low conf.high</span></span>
<span><span class="co">##   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">## 1 fixed  cond      (Intercept)       -1.42     0.0236   -1.47     -1.38 </span></span>
<span><span class="co">## 2 fixed  cond      phi_(Intercept)    2.37     0.0433    2.29      2.45 </span></span>
<span><span class="co">## 3 fixed  zi        (Intercept)       -3.53     0.192    -3.93     -3.18 </span></span>
<span><span class="co">## 4 fixed  cond      quotaTRUE          0.304    0.0334    0.239     0.368</span></span>
<span><span class="co">## 5 fixed  cond      phi_quotaTRUE      0.236    0.0696    0.101     0.371</span></span>
<span><span class="co">## 6 fixed  zi        quotaTRUE         -5.57     2.64    -12.2      -2.21</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now have two estimates for the <code>zi</code> part: an intercept and a coefficient for quota. Since these are on the logit scale, we can combine them mathematically to figure out the marginal effect of <code>quota</code> on the probability of being 0:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">zi_intercept</span> <span class="op">&lt;-</span> <span class="fu">tidy</span><span class="op">(</span><span class="va">model_beta_zi</span>, effects <span class="op">=</span> <span class="st">"fixed"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">component</span> <span class="op">==</span> <span class="st">"zi"</span>, <span class="va">term</span> <span class="op">==</span> <span class="st">"(Intercept)"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span></span>
<span></span>
<span><span class="va">zi_quota</span> <span class="op">&lt;-</span> <span class="fu">tidy</span><span class="op">(</span><span class="va">model_beta_zi</span>, effects <span class="op">=</span> <span class="st">"fixed"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">component</span> <span class="op">==</span> <span class="st">"zi"</span>, <span class="va">term</span> <span class="op">==</span> <span class="st">"quotaTRUE"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">zi_intercept</span> <span class="op">+</span> <span class="va">zi_quota</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">zi_intercept</span><span class="op">)</span></span>
<span><span class="co">## b_zi_Intercept </span></span>
<span><span class="co">##        -0.0283</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Based on this, having a quota reduces the proportion of 0s in the data by -2.83 percentage points. Unsurprisingly, we can also see this in the posterior predictions. We can look at the predicted proportion of 0s across the two levels of <code>quota</code> to find the marginal effect of having a quota on the 0/not 0 split. To do this with <strong>tidybayes</strong>, we can use the <code>dpar</code> argument in <code>epred_draws()</code> to also calculated the predicted zero-inflation part of the model (this is omitted by default). Here’s what that looks like:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pred_beta_zi</span> <span class="op">&lt;-</span> <span class="va">model_beta_zi</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">epred_draws</span><span class="op">(</span>newdata <span class="op">=</span> <span class="fu">expand_grid</span><span class="op">(</span>quota <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              dpar <span class="op">=</span> <span class="st">"zi"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We now have columns for the overall prediction (.epred) and for the</span></span>
<span><span class="co"># zero-inflation probability (zi)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">pred_beta_zi</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 6 × 7</span></span>
<span><span class="co">## # Groups:   quota, .row [1]</span></span>
<span><span class="co">##   quota  .row .chain .iteration .draw .epred     zi</span></span>
<span><span class="co">##   &lt;lgl&gt; &lt;int&gt;  &lt;int&gt;      &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">## 1 FALSE     1     NA         NA     1  0.186 0.0358</span></span>
<span><span class="co">## 2 FALSE     1     NA         NA     2  0.188 0.0247</span></span>
<span><span class="co">## 3 FALSE     1     NA         NA     3  0.187 0.0388</span></span>
<span><span class="co">## 4 FALSE     1     NA         NA     4  0.187 0.0388</span></span>
<span><span class="co">## 5 FALSE     1     NA         NA     5  0.191 0.0274</span></span>
<span><span class="co">## 6 FALSE     1     NA         NA     6  0.186 0.0162</span></span>
<span></span>
<span><span class="co"># Look at the average zero-inflation probability across quota</span></span>
<span><span class="va">pred_beta_zi</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">quota</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">median_hdci</span><span class="op">(</span><span class="va">zi</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 2 × 7</span></span>
<span><span class="co">##   quota       zi   .lower  .upper .width .point .interval</span></span>
<span><span class="co">##   &lt;lgl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    </span></span>
<span><span class="co">## 1 FALSE 0.0286   1.91e- 2 0.0396    0.95 median hdci     </span></span>
<span><span class="co">## 2 TRUE  0.000220 3.91e-11 0.00233   0.95 median hdci</span></span>
<span></span>
<span><span class="va">pred_beta_zi</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">compare_levels</span><span class="op">(</span>variable <span class="op">=</span> <span class="va">zi</span>, by <span class="op">=</span> <span class="va">quota</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">median_hdci</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 7</span></span>
<span><span class="co">##   quota             zi  .lower  .upper .width .point .interval</span></span>
<span><span class="co">##   &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    </span></span>
<span><span class="co">## 1 TRUE - FALSE -0.0281 -0.0389 -0.0179   0.95 median hdci</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Without even plotting this, we can see a neat trend. When there’s not a quota, ≈2–3% of the the predicted values are 0; when there is a quota, almost none of the predicted values are 0. Having a quota almost completely eliminates the possibility of having no women MPs. It’s the same marginal effect that we found with <code><a href="https://rdrr.io/r/stats/Logistic.html">plogis()</a></code>—the proportion of zeros drops by -2.8 percentage points when there’s a quota.</p>
<p>We can visualize this uncertainty by plotting the posterior predictions. We could either plot two distributions (for <code>quota</code> being <code>TRUE</code> or <code>FALSE</code>), or we can calculate the difference between quota/no quota to find the average marginal effect of having a quota on the proportion of 0s in the data:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mfx_quota_zi</span> <span class="op">&lt;-</span> <span class="va">pred_beta_zi</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">compare_levels</span><span class="op">(</span>variable <span class="op">=</span> <span class="va">zi</span>, by <span class="op">=</span> <span class="va">quota</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">mfx_quota_zi</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">zi</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span>.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.95</span><span class="op">)</span>, point_interval <span class="op">=</span> <span class="st">"median_hdi"</span>,</span>
<span>               fill <span class="op">=</span> <span class="st">"#fb9e07"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">label_pp</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Average marginal effect of having a gender-based quota\non the proportion of countries with zero women in parliament"</span>, </span>
<span>       y <span class="op">=</span> <span class="cn">NULL</span>, caption <span class="op">=</span> <span class="st">"80% and 95% credible intervals shown in black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-pred-mfx-zi-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>Finally, we can see how this shows up in the overall predictions from the model. Note how there are a bunch of 0s when quota is <code>FALSE</code>, and no 0s when it is <code>TRUE</code>, as expected:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">beta_zi_pred</span> <span class="op">&lt;-</span> <span class="va">model_beta_zi</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">predicted_draws</span><span class="op">(</span>newdata <span class="op">=</span> <span class="fu">tibble</span><span class="op">(</span>quota <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>is_zero <span class="op">=</span> <span class="va">.prediction</span> <span class="op">==</span> <span class="fl">0</span>,</span>
<span>         .prediction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">is_zero</span>, <span class="va">.prediction</span> <span class="op">-</span> <span class="fl">0.01</span>, <span class="va">.prediction</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">beta_zi_pred</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.prediction</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">is_zero</span><span class="op">)</span>, binwidth <span class="op">=</span> <span class="fl">0.025</span>, </span>
<span>                 boundary <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_d</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span>, end <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                       guide <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>reverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Predicted proportion of women in parliament"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Count"</span>, fill <span class="op">=</span> <span class="st">"Is zero?"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">quota</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>,</span>
<span>             labeller <span class="op">=</span> <span class="fu">labeller</span><span class="op">(</span>quota <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`TRUE` <span class="op">=</span> <span class="st">"Quota"</span>, </span>
<span>                                           `FALSE` <span class="op">=</span> <span class="st">"No Quota"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-zi-hist-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>Again, I think it’s so cool that we can explore all this uncertainty for specific parameters of this model, like the 0/not 0 process! You can’t do this with OLS!</p>
</section><section id="average-marginal-effects-incorporating-the-zero-process" class="level3"><h3 class="anchored" data-anchor-id="average-marginal-effects-incorporating-the-zero-process">Average marginal effects, incorporating the zero process</h3>
<p>The main thing we’re interested in here, though, is the average marginal effect of having a quota on the proportion of women in parliament, not just the 0/not 0 process. Since we’ve incorporated <code>quota</code> in all the different parts of the model (the <span class="math inline">\(\mu\)</span>, the <span class="math inline">\(\phi\)</span>, and the zero-inflated <span class="math inline">\(\alpha\)</span>), we should definitely once again simulate this value using <strong>marginaleffects</strong>—trying to get all the coefficients put together manually is going to be too tricky.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ame_beta_zi</span> <span class="op">&lt;-</span> <span class="va">model_beta_zi</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">avg_comparisons</span><span class="op">(</span>variables <span class="op">=</span> <span class="st">"quota"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">posterior_draws</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ame_beta_zi</span> <span class="op">%&gt;%</span> <span class="fu">median_hdi</span><span class="op">(</span><span class="va">draw</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 6</span></span>
<span><span class="co">##     draw .lower .upper .width .point .interval</span></span>
<span><span class="co">##    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    </span></span>
<span><span class="co">## 1 0.0575 0.0466 0.0688   0.95 median hdi</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">ame_beta_zi</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">draw</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span>.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.95</span><span class="op">)</span>, point_interval <span class="op">=</span> <span class="st">"median_hdi"</span>,</span>
<span>               fill <span class="op">=</span> <span class="st">"#bc3032"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">label_pp</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Average marginal effect of having a gender-based\nquota on the proportion of women in parliament"</span>, y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"80% and 95% credible intervals shown in black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-ame-quota-zi-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>The average marginal effect of having a quota on the proportion of women MPs in an average country, therefore, is 6.65 percentage points.</p>
</section><section id="special-case-1-zero-one-inflated-beta-regression" class="level3"><h3 class="anchored" data-anchor-id="special-case-1-zero-one-inflated-beta-regression">Special case #1: Zero-one-inflated beta regression</h3>
<p>With our data here, no countries have parliaments with 100% women (cue <a href="https://bookshop.org/lists/when-there-are-nine-honoring-ruth-bader-ginsburg">that RBG “when there are nine” quote</a>). But what if you have both 0s <em>and</em> 1s in your outcome? Zero-inflated beta regression handles the zeros just fine (it’s in the name of the model!), but it can’t handle both 0s and 1s.</p>
<p>Fortunately there’s a variation for zero-one-inflated beta (ZOIB) regression. I won’t go into the details here—<a href="https://mvuorre.github.io/posts/2019-02-18-analyze-analog-scale-ratings-with-zero-one-inflated-beta-models/">Matti Vuore has a phenomenal tutorial about how to run these models</a>. In short, ZOIB regression makes you model a mixture of <em>three</em> things:</p>
<ol type="1">
<li>A logistic regression model that predicts if an outcome is either 0 or 1 or not 0 or 1, defined by <span class="math inline">\(\alpha\)</span> (or alternatively, a model that predicts if outcomes are extreme (0 or 1) or not (between 0 and 1); thanks to <a href="https://twitter.com/IsabellaGhement/status/1457789676387848205">Isabella Ghement for this way of thinking about it</a>!)</li>
<li>A logistic regression model that predicts if any of the 0 or 1 outcomes are actually 1s, defined by <span class="math inline">\(\gamma\)</span> (or alternatively, a model that predicts if the extreme values are 1)</li>
<li>A beta regression model that predicts if an outcome is between 0 and 1 if it’s not zero or not one, defined by <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\phi\)</span> (or alternatively, a model that predicts the non-extreme (0 or 1) values)</li>
</ol>
<p>When using <strong>brms</strong>, you get to model all these different parts:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">brm</span><span class="op">(</span></span>
<span>  <span class="fu">bf</span><span class="op">(</span></span>
<span>    <span class="va">outcome</span> <span class="op">~</span> <span class="va">covariates</span>,  <span class="co"># The mean of the 0-1 values, or mu</span></span>
<span>    <span class="va">phi</span> <span class="op">~</span> <span class="va">covariates</span>,  <span class="co"># The precision of the 0-1 values, or phi</span></span>
<span>    <span class="va">zoi</span> <span class="op">~</span> <span class="va">covariates</span>,  <span class="co"># The zero-or-one-inflated part, or alpha</span></span>
<span>    <span class="va">coi</span> <span class="op">~</span> <span class="va">covariates</span>  <span class="co"># The one-inflated part, conditional on the 0s, or gamma</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">whatever</span>,</span>
<span>  family <span class="op">=</span> <span class="fu">zero_one_inflated_beta</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pulling out all these different parameters, plotting their distributions, and estimating their average marginal effects looks exactly the same as what we did earlier with the zero-inflated model—all the <strong>brms</strong>, <strong>tidybayes</strong>, and <strong>marginaleffects</strong> functions we used for marginal effects and fancy plots work the same. All the coefficients are on the logit scale, except <span class="math inline">\(\phi\)</span>, which is on the log scale.</p>
</section><section id="special-case-2-one-inflated-beta-regression" class="level3"><h3 class="anchored" data-anchor-id="special-case-2-one-inflated-beta-regression">Special case #2: One-inflated beta regression</h3>
<p>What if your proportion-based outcome has a bunch of 1s and no 0s? It would be neat if there were a <code>one_inflated_beta()</code> family, but there’s not (<a href="https://github.com/paul-buerkner/brms/issues/942">also by design</a>). But never fear! There are two ways to do one-inflated regression:</p>
<ol type="1">
<li>
<p>Reverse your outcome so that it’s <code>1 - outcome</code> instead of <code>outcome</code> and then use zero-inflated regression. In the case of the proportion of women MPs, we would instead look at the proportion of not-women MPs:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">mutate</span><span class="op">(</span>prop_not_fem <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">prop_fem</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
<li><p>Use zero-one-inflated beta regression and force the conditional one parameter (<code>coi</code>, or the <span class="math inline">\(\gamma\)</span> in that model) to be one, meaning that 100% of the 0/not 0 splits would actually be 1: <code>bf(..., coi = 1)</code></p></li>
</ol>
<p>Everything else that we’ve explored in this post—posterior predictions, average marginal effects, etc.—will all work as expected.</p>
</section></section><section id="super-fancy-detailed-model-with-lots-of-moving-parts-just-for-fun" class="level2"><h2 class="anchored" data-anchor-id="super-fancy-detailed-model-with-lots-of-moving-parts-just-for-fun">Super fancy detailed model with lots of moving parts, just for fun</h2>
<p>Throughout this post, for the sake of simplicity we’ve really only used one or two covariates at a time (<code>quota</code> and/or <code>polyarchy</code>). Real world models are more complex: we can use more covariates, multilevel hierarchical structures, or weighting, for instance. This all works just fine with zero|one|zero-one-inflated beta regression thanks to the power of <strong>brms</strong>, which handles all these extra features natively.</p>
<p>Just for fun here at the end, let’s run a more fully specified model with more covariates and a multilevel structure that accounts for year and region. This will let us look at the larger V-Dem dataset from 2010–2020 instead of just 2015.</p>
<section id="set-better-priors" class="level3"><h3 class="anchored" data-anchor-id="set-better-priors">Set better priors</h3>
<p>To make sure this runs as efficiently as possible, we’ll set our own priors instead of relying on the default <strong>brms</strong> priors. This is especially important for beta models because of how parameters are used internally. Remember that most of our coefficients are on a logit scale, and those logits correspond to probabilities or proportions. While logits can theoretically range from −∞ to ∞, in practice they’re a lot more limited. For instance, we can convert some small percentages to the logit scale with <code><a href="https://rdrr.io/r/stats/Logistic.html">qlogis()</a></code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">qlogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.001</span>, <span class="fl">0.0001</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] -4.60 -6.91 -9.21</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">qlogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.99</span>, <span class="fl">0.999</span>, <span class="fl">0.9999</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] 4.60 6.91 9.21</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A 1%/99% value is 4.6 as a logit, while 0.01%/99.99% is 9. Most of the proportions we’ve seen in the models so far are much smaller than that—logits of like ≈0–2 at most. By default, <strong>brms</strong> puts a flat prior on coefficients in beta regression, so values like 10 or 15 could occur, which are excessively massive when converted to probabilities! Look at this plot to see the relationship between the logit scale and the probability scale—there are big changes in probability between −4ish and 4ish, but once you start getting into the 5s and beyond, the probability is all essentially the same.</p>
<div class="cell" data-layout-align="center" width="3">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">8</span>, <span class="fl">8</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Logit scale"</span>, y <span class="op">=</span> <span class="st">"Probability scale"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-dist-logit-prob-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>To help speed up the model (and on philosophical grounds, since we know prior information about these model coefficients), we should tell <strong>brms</strong> that the logit-scale parameters in the model aren’t ever going to get huge.</p>
<p>To do this, we first need to define the formula for our fancy complex model. I added a bunch of plausible covariates to different portions of the model, along with random effects for region. In real life this should all be driven by theory.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vdem_clean</span> <span class="op">&lt;-</span> <span class="va">vdem_clean</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># Scale polyarchy back down to 0-1 values to help Stan with modeling</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>polyarchy <span class="op">=</span> <span class="va">polyarchy</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># Make region and year factors instead of numbers</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">region</span><span class="op">)</span>,</span>
<span>         year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the model formula</span></span>
<span><span class="va">fancy_formula</span> <span class="op">&lt;-</span> <span class="fu">bf</span><span class="op">(</span></span>
<span>  <span class="co"># mu (mean) part</span></span>
<span>  <span class="va">prop_fem</span> <span class="op">~</span> <span class="va">quota</span> <span class="op">+</span> <span class="va">polyarchy</span> <span class="op">+</span> <span class="va">corruption</span> <span class="op">+</span> </span>
<span>    <span class="va">civil_liberties</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">year</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">region</span><span class="op">)</span>,</span>
<span>  <span class="co"># phi (precision) part</span></span>
<span>  <span class="va">phi</span> <span class="op">~</span> <span class="va">quota</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">year</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">region</span><span class="op">)</span>,</span>
<span>  <span class="co"># alpha (zero-inflation) part</span></span>
<span>  <span class="va">zi</span> <span class="op">~</span> <span class="va">quota</span> <span class="op">+</span> <span class="va">polyarchy</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">year</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">region</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can then feed that formula to <code>get_prior()</code> to see what the default priors are and how to change them:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">get_prior</span><span class="op">(</span></span>
<span>  <span class="va">fancy_formula</span>,</span>
<span>  data <span class="op">=</span> <span class="va">vdem_clean</span>,</span>
<span>  family <span class="op">=</span> <span class="fu">zero_inflated_beta</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">##                 prior     class            coef  group resp dpar nlpar lb ub       source</span></span>
<span><span class="co">##                (flat)         b                                                   default</span></span>
<span><span class="co">##                (flat)         b civil_liberties                              (vectorized)</span></span>
<span><span class="co">##                (flat)         b      corruption                              (vectorized)</span></span>
<span><span class="co">##                (flat)         b       polyarchy                              (vectorized)</span></span>
<span><span class="co">##                (flat)         b       quotaTRUE                              (vectorized)</span></span>
<span><span class="co">##  student_t(3, 0, 2.5) Intercept                                                   default</span></span>
<span><span class="co">##  student_t(3, 0, 2.5)        sd                                         0         default</span></span>
<span><span class="co">##  student_t(3, 0, 2.5)        sd                 region                  0    (vectorized)</span></span>
<span><span class="co">##  student_t(3, 0, 2.5)        sd       Intercept region                  0    (vectorized)</span></span>
<span><span class="co">##  student_t(3, 0, 2.5)        sd                   year                  0    (vectorized)</span></span>
<span><span class="co">##  student_t(3, 0, 2.5)        sd       Intercept   year                  0    (vectorized)</span></span>
<span><span class="co">##                (flat)         b                              phi                  default</span></span>
<span><span class="co">##                (flat)         b       quotaTRUE              phi             (vectorized)</span></span>
<span><span class="co">##  student_t(3, 0, 2.5) Intercept                              phi                  default</span></span>
<span><span class="co">##  student_t(3, 0, 2.5)        sd                              phi        0         default</span></span>
<span><span class="co">##  student_t(3, 0, 2.5)        sd                 region       phi        0    (vectorized)</span></span>
<span><span class="co">##  student_t(3, 0, 2.5)        sd       Intercept region       phi        0    (vectorized)</span></span>
<span><span class="co">##  student_t(3, 0, 2.5)        sd                   year       phi        0    (vectorized)</span></span>
<span><span class="co">##  student_t(3, 0, 2.5)        sd       Intercept   year       phi        0    (vectorized)</span></span>
<span><span class="co">##                (flat)         b                               zi                  default</span></span>
<span><span class="co">##                (flat)         b       polyarchy               zi             (vectorized)</span></span>
<span><span class="co">##                (flat)         b       quotaTRUE               zi             (vectorized)</span></span>
<span><span class="co">##        logistic(0, 1) Intercept                               zi                  default</span></span>
<span><span class="co">##  student_t(3, 0, 2.5)        sd                               zi        0         default</span></span>
<span><span class="co">##  student_t(3, 0, 2.5)        sd                 region        zi        0    (vectorized)</span></span>
<span><span class="co">##  student_t(3, 0, 2.5)        sd       Intercept region        zi        0    (vectorized)</span></span>
<span><span class="co">##  student_t(3, 0, 2.5)        sd                   year        zi        0    (vectorized)</span></span>
<span><span class="co">##  student_t(3, 0, 2.5)        sd       Intercept   year        zi        0    (vectorized)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are a <em>ton</em> of potential priors we can set here! If we really wanted, we could set the mean and standard deviation separately for each individual coefficient, but that’s probably excessive for this case.</p>
<p>You can see that everything with class <code>b</code> (for β coefficient in a regression model) has a flat prior. We need to narrow that down, perhaps with something like a normal distribution centered at 0 with a standard deviation of 1. Values here won’t get too big and will mostly be between −2 and 2:</p>
<div class="cell" data-layout-align="center" width="3">
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="fl">4</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_function</span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dnorm</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-narrow-prior-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>To set the priors, we can create a list of priors as a separate object that we can then feed to the main <code>brm()</code> function. We’ll keep the default prior for the intercepts.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">priors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">set_prior</span><span class="op">(</span><span class="st">"student_t(3, 0, 2.5)"</span>, class <span class="op">=</span> <span class="st">"Intercept"</span><span class="op">)</span>,</span>
<span>            <span class="fu">set_prior</span><span class="op">(</span><span class="st">"normal(0, 1)"</span>, class <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="run-the-model" class="level3"><h3 class="anchored" data-anchor-id="run-the-model">Run the model</h3>
<p>Let’s run the model! This will probably take a (long!) while to run. On my new 2021 MacBook Pro with a 10-core M1 Max CPU, running 4 chains with two CPU cores per chain (with <strong>cmdstanr</strong>’s <a href="https://cran.r-project.org/web/packages/brms/vignettes/brms_threading.html">support for within-chain threading</a>) takes about 6 minutes. It probably takes a <strong><em>lot</em></strong> longer on a less powerful machine. To help Stan with estimation, I also set <code>init</code> to help with some of the parameters of the beta distribution, and increased <code>adapt_delta</code> and <code>max_treedepth</code> a little. I only knew to do this because Stan complained when I used the defaults and told me to increase them :)</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fancy_model</span> <span class="op">&lt;-</span> <span class="fu">brm</span><span class="op">(</span></span>
<span>  <span class="va">fancy_formula</span>,</span>
<span>  data <span class="op">=</span> <span class="va">vdem_clean</span>,</span>
<span>  family <span class="op">=</span> <span class="fu">zero_inflated_beta</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  prior <span class="op">=</span> <span class="va">priors</span>,</span>
<span>  init <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>adapt_delta <span class="op">=</span> <span class="fl">0.97</span>,</span>
<span>                 max_treedepth <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">4</span>, iter <span class="op">=</span> <span class="fl">2000</span>, warmup <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>, </span>
<span>  threads <span class="op">=</span> <span class="fu">threading</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  backend <span class="op">=</span> <span class="st">"cmdstanr"</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"fancy_model"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are a handful of divergent chains but since this isn’t an actual model that I’d use in a publication, I’m not too worried. In real life, I’d increase the <code>adapt_delta</code> or <code>max_treedepth</code> parameters even more or do some other fine tuning, but we’ll just live with the warnings for now.</p>
</section><section id="analyze-and-plot-the-results" class="level3"><h3 class="anchored" data-anchor-id="analyze-and-plot-the-results">Analyze and plot the results</h3>
<p>We now have a fully specified multilevel model with all sorts of rich moving parts: we account for the mean and precision of the beta distribution <em>and</em> we account for the zero-inflation process, all with different covariates with region-specific offsets. Here are the full results, with medians and 95% credible intervals for all the different coefficients:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tidy</span><span class="op">(</span><span class="va">fancy_model</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 16 × 8</span></span>
<span><span class="co">##    effect   component group  term                estimate std.error  conf.low conf.high</span></span>
<span><span class="co">##    &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">##  1 fixed    cond      &lt;NA&gt;   (Intercept)         -0.654      0.239   -1.12      -0.196 </span></span>
<span><span class="co">##  2 fixed    cond      &lt;NA&gt;   phi_(Intercept)      2.83       0.274    2.26       3.34  </span></span>
<span><span class="co">##  3 fixed    zi        &lt;NA&gt;   (Intercept)         -0.888      3.56    -6.55       6.92  </span></span>
<span><span class="co">##  4 fixed    cond      &lt;NA&gt;   quotaTRUE            0.367      0.0294   0.310      0.424 </span></span>
<span><span class="co">##  5 fixed    cond      &lt;NA&gt;   polyarchy           -0.104      0.152   -0.409      0.192 </span></span>
<span><span class="co">##  6 fixed    cond      &lt;NA&gt;   corruption          -0.738      0.0721  -0.885     -0.599 </span></span>
<span><span class="co">##  7 fixed    cond      &lt;NA&gt;   civil_liberties     -0.589      0.132   -0.843     -0.328 </span></span>
<span><span class="co">##  8 fixed    cond      &lt;NA&gt;   phi_quotaTRUE       -0.0729     0.0763  -0.223      0.0770</span></span>
<span><span class="co">##  9 fixed    zi        &lt;NA&gt;   quotaTRUE           -6.81       4.60   -18.9       -2.11  </span></span>
<span><span class="co">## 10 fixed    zi        &lt;NA&gt;   polyarchy            0.00477    0.949   -1.88       1.85  </span></span>
<span><span class="co">## 11 ran_pars cond      region sd__(Intercept)      0.483      0.227    0.232      1.05  </span></span>
<span><span class="co">## 12 ran_pars cond      year   sd__(Intercept)      0.0817     0.0312   0.0382     0.153 </span></span>
<span><span class="co">## 13 ran_pars cond      region sd__phi_(Intercept)  0.610      0.288    0.293      1.36  </span></span>
<span><span class="co">## 14 ran_pars cond      year   sd__phi_(Intercept)  0.0367     0.0312   0.00121    0.117 </span></span>
<span><span class="co">## 15 ran_pars zi        region sd__(Intercept)      8.47       6.11     1.91      24.9   </span></span>
<span><span class="co">## 16 ran_pars zi        year   sd__(Intercept)      0.204      0.171    0.00770    0.653</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can’t really interpret any of these coefficients directly, since (1) they’re on different scales (the <code>phi</code> parts are all logged; all the other parts are logits), and (2) we need to combine coefficients with intercepts in order to back-transform them into percentage point values, and doing that mathematically is tricky.</p>
<p>We’ll focus on finding the marginal effect of <code>quota</code>, since that’s the main question we’ve been exploring throughout this post (and it was the subject of the original <span class="citation" data-cites="TrippKang:2008">Tripp and Kang (<a href="#ref-TrippKang:2008" role="doc-biblioref">2008</a>)</span> paper). For fun, we’ll also look at <code>polyarchy</code>, since it’s a continuous variable.</p>
<p>As before, <strong>marginaleffects</strong> makes it really easy to get posterior predictions of the difference between quota and no quota with <code>avg_comparisons()</code></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
More about these epreds and random effects
</div>
</div>
<div class="callout-body-container callout-body">
<p>A year after writing this post, I wrote a couple other guides about the <a href="https://www.andrewheiss.com/blog/2022/09/26/guide-visualizing-types-posteriors/">differences between posterior predictions, linear predictions, and epreds</a> + <a href="https://www.andrewheiss.com/blog/2022/11/29/conditional-marginal-marginaleffects/">different ways of handling random effects in predictions</a>. Check those out for more details.</p>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ame_fancy_zi_quota</span> <span class="op">&lt;-</span> <span class="va">fancy_model</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">avg_comparisons</span><span class="op">(</span>variables <span class="op">=</span> <span class="st">"quota"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">posterior_draws</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ame_fancy_zi_quota</span> <span class="op">%&gt;%</span> <span class="fu">median_hdi</span><span class="op">(</span><span class="va">draw</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 6</span></span>
<span><span class="co">##     draw .lower .upper .width .point .interval</span></span>
<span><span class="co">##    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    </span></span>
<span><span class="co">## 1 0.0653 0.0556 0.0749   0.95 median hdi</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">ame_fancy_zi_quota</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">draw</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_halfeye</span><span class="op">(</span>.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.95</span><span class="op">)</span>, point_interval <span class="op">=</span> <span class="st">"median_hdi"</span>,</span>
<span>               fill <span class="op">=</span> <span class="st">"#bc3032"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="va">label_pp</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Average marginal effect of having a gender-based\nquota on the proportion of women in parliament"</span>, y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"80% and 95% credible intervals shown in black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-ame-quota-fancy-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">r_fancy</span> <span class="op">&lt;-</span> <span class="va">ame_fancy_zi_quota</span> <span class="op">%&gt;%</span> <span class="fu">median_hdi</span><span class="op">(</span><span class="va">draw</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After accounting for democracy, corruption, respect for civil liberties, year, and region, the proportion of women MPs in countries with a parliamentary gender quota is 6.5 percentage points higher than in countries without a quota, on average, with a 95% credible interval ranging from 5.6 to 7.5 percentage points.</p>
<p>For fun, we can look at how the predicted outcome changes across both <code>polyarchy</code> and <code>quota</code> simultaneously (and for fun we’ll do it with <strong>marginaleffects</strong>, though it’s also doable with <code>tidybayes::epred_draws() %&gt;% compare_levels()</code>). Because we didn’t use any interaction terms, the slope will be the same across both levels of <code>quota</code>, but the plot still looks neat. Weirdly, due to the constellation of controls we included in the model, the predicted proportion of women MPs <em>decreases</em> with more democracy. But that’s not super important—if we were really only interested in the quota effect and we had included a sufficient set of variables to close backdoor paths, the coefficients for all other variables shouldn’t be interpreted <span class="citation" data-cites="KeeleStevensonElwert:2020">(<a href="#ref-KeeleStevensonElwert:2020" role="doc-biblioref">Keele, Stevenson, and Elwert 2020</a>)</span>. We’ll pretend that’s the case here—this code mostly just shows how you can do all sorts of neat stuff with <strong>marginaleffects</strong>.</p>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/plot-ame-quota-polyarchy-fancy_c85f3d36b0ab37f178956eb98f7db5d4">
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ame_fancy_zi_polyarchy_quota</span> <span class="op">&lt;-</span> <span class="va">fancy_model</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">predictions</span><span class="op">(</span>newdata <span class="op">=</span> <span class="fu">datagrid</span><span class="op">(</span>quota <span class="op">=</span> <span class="va">unique</span>,</span>
<span>                                 polyarchy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">posterior_draws</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># Scale polyarchy back up for plotting</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>polyarchy <span class="op">=</span> <span class="va">polyarchy</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># With tidybayes instead</span></span>
<span><span class="co"># ame_fancy_zi_polyarchy_quota &lt;- fancy_model %&gt;%</span></span>
<span><span class="co">#   epred_draws(newdata = datagrid(model = fancy_model, </span></span>
<span><span class="co">#                                  quota = unique, </span></span>
<span><span class="co">#                                  polyarchy = seq(0, 1, by = 0.1)))</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">ame_fancy_zi_polyarchy_quota</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">polyarchy</span>, y <span class="op">=</span> <span class="va">draw</span>, color <span class="op">=</span> <span class="va">quota</span>, fill <span class="op">=</span> <span class="va">quota</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_lineribbon</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill_ramp <span class="op">=</span> <span class="fu">stat</span><span class="op">(</span><span class="va">level</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">label_percent</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_d</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span>, end <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_viridis_d</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span>, end <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_ramp_discrete</span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.7</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">quota</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>,</span>
<span>             labeller <span class="op">=</span> <span class="fu">labeller</span><span class="op">(</span>quota <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`TRUE` <span class="op">=</span> <span class="st">"Quota"</span>,</span>
<span>                                           `FALSE` <span class="op">=</span> <span class="st">"No Quota"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Polyarchy (democracy)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Predicted proportion of women MPs"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Quota"</span>, color <span class="op">=</span> <span class="st">"Quota"</span>,</span>
<span>       fill_ramp <span class="op">=</span> <span class="st">"Credible interval"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_clean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-ame-quota-polyarchy-fancy-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="references" class="level2">


<!-- -->


</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-KeeleStevensonElwert:2020" class="csl-entry" role="listitem">
Keele, Luke, Randolph T. Stevenson, and Felix Elwert. 2020. <span>“The Causal Interpretation of Estimated Associations in Regression Models.”</span> <em>Political Science Research and Methods</em> 8 (1): 1–13. <a href="https://doi.org/10.1017/psrm.2019.31">https://doi.org/10.1017/psrm.2019.31</a>.
</div>
<div id="ref-KneibSilbersdorffSafken:2021" class="csl-entry" role="listitem">
Kneib, Thomas, Alexander Silbersdorff, and Benjamin Säfken. 2021. <span>“Rage Against the Mean—a Review of Distributional Regression Approaches.”</span> <em>Econometrics and Statistics</em>. <a href="https://doi.org/10.1016/j.ecosta.2021.07.006">https://doi.org/10.1016/j.ecosta.2021.07.006</a>.
</div>
<div id="ref-TrippKang:2008" class="csl-entry" role="listitem">
Tripp, Aili Mari, and Alice Kang. 2008. <span>“The Global Impact of Quotas: On the Fast Track to Increased Female Legislative Representation.”</span> <em>Comparative Political Studies</em> 41 (3): 338–61. <a href="https://doi.org/10.1177/0010414006297342">https://doi.org/10.1177/0010414006297342</a>.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{heiss2021,
  author = {Heiss, Andrew},
  title = {A Guide to Modeling Proportions with {Bayesian} Beta and
    Zero-Inflated Beta Regression Models},
  date = {2021-11-08},
  url = {https://www.andrewheiss.com/blog/2021/11/08/beta-regression-guide/},
  doi = {10.59350/7p1a4-0tw75},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-heiss2021" class="csl-entry quarto-appendix-citeas" role="listitem">
Heiss, Andrew. 2021. <span>“A Guide to Modeling Proportions with
Bayesian Beta and Zero-Inflated Beta Regression Models.”</span> November
8, 2021. <a href="https://doi.org/10.59350/7p1a4-0tw75">https://doi.org/10.59350/7p1a4-0tw75</a>.
</div></div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.andrewheiss\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><script src="https://giscus.app/client.js" data-repo="andrewheiss/ath-quarto" data-repo-id="R_kgDOIg6EJQ" data-category="Blog comments" data-category-id="DIC_kwDOIg6EJc4CSz92" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><input type="hidden" id="giscus-base-theme" value="light"><input type="hidden" id="giscus-alt-theme" value="dark"><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb72" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "A guide to modeling proportions with Bayesian beta and zero-inflated beta regression models"</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2021-11-08</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Everything you ever wanted to know about beta regression! Use R and brms to correctly model proportion data, and learn all about the beta distribution along the way."</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> index_files/figure-html/plot-dist-beta-shifted-1.png</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co">  - r</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - tidyverse</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="co">  - regression</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - statistics</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="co">  - data visualization</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="co">  - bayes</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="co">  - beta</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 4</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a><span class="an">doi:</span><span class="co"> 10.59350/7p1a4-0tw75</span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a><span class="an">citation:</span><span class="co"> true</span></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(fig.align = "center", fig.retina = 3,</span></span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a><span class="in">                      fig.width = 6, fig.height = (6 * 0.618),</span></span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a><span class="in">                      out.width = "90%", collapse = TRUE)</span></span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a><span class="in">options(digits = 3, width = 90)</span></span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a><span class="in">options(modelsummary_factory_html = "gt")</span></span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a>In the data I work with, it's really common to come across data that's measured as proportions: the percent of women in the public sector workforce, the amount of foreign aid a country receives as a percent of its GDP, the percent of religious organizations in a state's nonprofit sector, and so on. </span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true" tabindex="-1"></a>When working with this kind of data as an outcome variable (or dependent variable) in a model, analysis gets tricky if you use standard models like OLS regression. For instance, look at this imaginary simulated dataset of the relationship between some hypothetical x and y:</span>
<span id="cb72-33"><a href="#cb72-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-34"><a href="#cb72-34" aria-hidden="true" tabindex="-1"></a><span class="in">```{r example-beyond-one-plot, echo=FALSE, warning=FALSE, message=FALSE}</span></span>
<span id="cb72-35"><a href="#cb72-35" aria-hidden="true" tabindex="-1"></a><span class="in">library(magrittr)</span></span>
<span id="cb72-36"><a href="#cb72-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-37"><a href="#cb72-37" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(1234)</span></span>
<span id="cb72-38"><a href="#cb72-38" aria-hidden="true" tabindex="-1"></a><span class="in">n &lt;- 400</span></span>
<span id="cb72-39"><a href="#cb72-39" aria-hidden="true" tabindex="-1"></a><span class="in">fake_data &lt;- tibble::tibble(x = rnorm(n, mean = 0, sd = 1)) %&gt;% </span></span>
<span id="cb72-40"><a href="#cb72-40" aria-hidden="true" tabindex="-1"></a><span class="in">  # Make a logistic outcome with 0/1 results</span></span>
<span id="cb72-41"><a href="#cb72-41" aria-hidden="true" tabindex="-1"></a><span class="in">  dplyr::mutate(y = as.numeric(1 + (1.5 * x + rlogis(n)) &gt; 0)) %&gt;% </span></span>
<span id="cb72-42"><a href="#cb72-42" aria-hidden="true" tabindex="-1"></a><span class="in">  # Add noise to the 0s and 1s based on different values of x and y</span></span>
<span id="cb72-43"><a href="#cb72-43" aria-hidden="true" tabindex="-1"></a><span class="in">  dplyr::mutate(noise = abs(rnorm(n, mean = 0, sd = 0.2))) %&gt;% </span></span>
<span id="cb72-44"><a href="#cb72-44" aria-hidden="true" tabindex="-1"></a><span class="in">  dplyr::mutate(y = dplyr::case_when(</span></span>
<span id="cb72-45"><a href="#cb72-45" aria-hidden="true" tabindex="-1"></a><span class="in">    x &lt; 0 &amp; y &gt; 0.05 ~ y - noise,</span></span>
<span id="cb72-46"><a href="#cb72-46" aria-hidden="true" tabindex="-1"></a><span class="in">    x &lt; 0 &amp; y &lt; 0.05 ~ y + noise,</span></span>
<span id="cb72-47"><a href="#cb72-47" aria-hidden="true" tabindex="-1"></a><span class="in">    x &gt; 0 &amp; y &gt; 0.05 ~ y - noise,</span></span>
<span id="cb72-48"><a href="#cb72-48" aria-hidden="true" tabindex="-1"></a><span class="in">    x &gt; 0 &amp; y &lt; 0.05 ~ y + noise))</span></span>
<span id="cb72-49"><a href="#cb72-49" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb72-50"><a href="#cb72-50" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot2::ggplot(fake_data, ggplot2::aes(x = x, y = y)) +  </span></span>
<span id="cb72-51"><a href="#cb72-51" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot2::geom_point() + </span></span>
<span id="cb72-52"><a href="#cb72-52" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot2::geom_smooth(method = "lm") + </span></span>
<span id="cb72-53"><a href="#cb72-53" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot2::geom_hline(yintercept = c(0, 1), color = "red") +</span></span>
<span id="cb72-54"><a href="#cb72-54" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot2::theme_minimal(base_family = "Barlow Semi Condensed") +</span></span>
<span id="cb72-55"><a href="#cb72-55" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot2::theme(panel.grid.minor = ggplot2::element_blank(),</span></span>
<span id="cb72-56"><a href="#cb72-56" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.title = ggplot2::element_text(family = "BarlowSemiCondensed-Medium"))</span></span>
<span id="cb72-57"><a href="#cb72-57" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-58"><a href="#cb72-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-59"><a href="#cb72-59" aria-hidden="true" tabindex="-1"></a>Y here is measured as a percentage and ranges between 0 and 1 (i.e. between the red lines), but the fitted line from a linear model creates predictions that exceed the 0–1 range (see the blue line in the top right corner). Since we're thinking about proportions, we typically can't exceed 0% and 100%, so it would be great if our modeling approach took those limits into account.</span>
<span id="cb72-60"><a href="#cb72-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-61"><a href="#cb72-61" aria-hidden="true" tabindex="-1"></a>There are a bunch of different ways to model proportional data that vary substantially in complexity. In this post, I'll explore four, but I'll mostly focus on beta and zero-inflated beta regression:</span>
<span id="cb72-62"><a href="#cb72-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-63"><a href="#cb72-63" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Linear probability models</span>
<span id="cb72-64"><a href="#cb72-64" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Fractional logistic regression</span>
<span id="cb72-65"><a href="#cb72-65" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Beta regression</span>
<span id="cb72-66"><a href="#cb72-66" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Zero-inflated beta regression</span>
<span id="cb72-67"><a href="#cb72-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-68"><a href="#cb72-68" aria-hidden="true" tabindex="-1"></a>Throughout this example, we'll use data from the <span class="co">[</span><span class="ot">Varieties of Democracy project (V-Dem)</span><span class="co">](https://www.v-dem.net/en/)</span> to answer a question common in comparative politics: do countries with parliamentary gender quotas (i.e. laws and regulations that require political parties to have a minimum proportion of women members of parliament (MPs)) have more women MPs in their respective parliaments? This question is inspired by <span class="co">[</span><span class="ot">existing research</span><span class="co">](https://doi.org/10.1177%2F0010414006297342)</span> that looks at the effect of quotas on the proportion of women MPs, and a paper by @TrippKang:2008 was my first exposure to fractional logistic regression as a way to handle proportional data. The <span class="co">[</span><span class="ot">original data from that paper</span><span class="co">](https://home.alicejkang.com/research)</span> is available at Alice Kang's website, but to simplify the post here, we won't use it—we'll just use a subset of equivalent data from V-Dem.</span>
<span id="cb72-69"><a href="#cb72-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-70"><a href="#cb72-70" aria-hidden="true" tabindex="-1"></a>There's <span class="co">[</span><span class="ot">a convenient R package for accessing V-Dem data</span><span class="co">](https://github.com/vdeminstitute/vdemdata)</span>, so we'll use that to make a smaller panel of countries between 2010 and 2020. Let's load all the libraries we need, clean up the data, and get started!</span>
<span id="cb72-71"><a href="#cb72-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-72"><a href="#cb72-72" aria-hidden="true" tabindex="-1"></a><span class="in">```{r libraries-functions, warning=FALSE, message=FALSE}</span></span>
<span id="cb72-73"><a href="#cb72-73" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)        # ggplot, dplyr, %&gt;%, and friends</span></span>
<span id="cb72-74"><a href="#cb72-74" aria-hidden="true" tabindex="-1"></a><span class="in">library(brms)             # Bayesian modeling through Stan</span></span>
<span id="cb72-75"><a href="#cb72-75" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidybayes)        # Manipulate Stan objects in a tidy way</span></span>
<span id="cb72-76"><a href="#cb72-76" aria-hidden="true" tabindex="-1"></a><span class="in">library(broom)            # Convert model objects to data frames</span></span>
<span id="cb72-77"><a href="#cb72-77" aria-hidden="true" tabindex="-1"></a><span class="in">library(broom.mixed)      # Convert brms model objects to data frames</span></span>
<span id="cb72-78"><a href="#cb72-78" aria-hidden="true" tabindex="-1"></a><span class="in">library(vdemdata)         # Use data from the Varieties of Democracy (V-Dem) project</span></span>
<span id="cb72-79"><a href="#cb72-79" aria-hidden="true" tabindex="-1"></a><span class="in">library(betareg)          # Run beta regression models</span></span>
<span id="cb72-80"><a href="#cb72-80" aria-hidden="true" tabindex="-1"></a><span class="in">library(extraDistr)       # Use extra distributions like dprop()</span></span>
<span id="cb72-81"><a href="#cb72-81" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggdist)           # Special geoms for posterior distributions</span></span>
<span id="cb72-82"><a href="#cb72-82" aria-hidden="true" tabindex="-1"></a><span class="in">library(gghalves)         # Special half geoms</span></span>
<span id="cb72-83"><a href="#cb72-83" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggbeeswarm)       # Special distribution-shaped point jittering</span></span>
<span id="cb72-84"><a href="#cb72-84" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggrepel)          # Automatically position labels</span></span>
<span id="cb72-85"><a href="#cb72-85" aria-hidden="true" tabindex="-1"></a><span class="in">library(patchwork)        # Combine ggplot objects</span></span>
<span id="cb72-86"><a href="#cb72-86" aria-hidden="true" tabindex="-1"></a><span class="in">library(scales)           # Format numbers in nice ways</span></span>
<span id="cb72-87"><a href="#cb72-87" aria-hidden="true" tabindex="-1"></a><span class="in">library(marginaleffects)  # Calculate marginal effects for regression models</span></span>
<span id="cb72-88"><a href="#cb72-88" aria-hidden="true" tabindex="-1"></a><span class="in">library(modelsummary)     # Create side-by-side regression tables</span></span>
<span id="cb72-89"><a href="#cb72-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-90"><a href="#cb72-90" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(1234)  # Make everything reproducible</span></span>
<span id="cb72-91"><a href="#cb72-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-92"><a href="#cb72-92" aria-hidden="true" tabindex="-1"></a><span class="in"># Define the goodness-of-fit stats to include in modelsummary()</span></span>
<span id="cb72-93"><a href="#cb72-93" aria-hidden="true" tabindex="-1"></a><span class="in">gof_stuff &lt;- tribble(</span></span>
<span id="cb72-94"><a href="#cb72-94" aria-hidden="true" tabindex="-1"></a><span class="in">  ~raw, ~clean, ~fmt,</span></span>
<span id="cb72-95"><a href="#cb72-95" aria-hidden="true" tabindex="-1"></a><span class="in">  "nobs", "N", 0,</span></span>
<span id="cb72-96"><a href="#cb72-96" aria-hidden="true" tabindex="-1"></a><span class="in">  "r.squared", "R²", 3</span></span>
<span id="cb72-97"><a href="#cb72-97" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb72-98"><a href="#cb72-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-99"><a href="#cb72-99" aria-hidden="true" tabindex="-1"></a><span class="in"># Custom ggplot theme to make pretty plots</span></span>
<span id="cb72-100"><a href="#cb72-100" aria-hidden="true" tabindex="-1"></a><span class="in"># Get the font at https://fonts.google.com/specimen/Barlow+Semi+Condensed</span></span>
<span id="cb72-101"><a href="#cb72-101" aria-hidden="true" tabindex="-1"></a><span class="in">theme_clean &lt;- function() {</span></span>
<span id="cb72-102"><a href="#cb72-102" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal(base_family = "Barlow Semi Condensed") +</span></span>
<span id="cb72-103"><a href="#cb72-103" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(panel.grid.minor = element_blank(),</span></span>
<span id="cb72-104"><a href="#cb72-104" aria-hidden="true" tabindex="-1"></a><span class="in">          plot.title = element_text(family = "BarlowSemiCondensed-Bold"),</span></span>
<span id="cb72-105"><a href="#cb72-105" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.title = element_text(family = "BarlowSemiCondensed-Medium"),</span></span>
<span id="cb72-106"><a href="#cb72-106" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.text = element_text(family = "BarlowSemiCondensed-Bold",</span></span>
<span id="cb72-107"><a href="#cb72-107" aria-hidden="true" tabindex="-1"></a><span class="in">                                    size = rel(1), hjust = 0),</span></span>
<span id="cb72-108"><a href="#cb72-108" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.background = element_rect(fill = "grey80", color = NA))</span></span>
<span id="cb72-109"><a href="#cb72-109" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb72-110"><a href="#cb72-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-111"><a href="#cb72-111" aria-hidden="true" tabindex="-1"></a><span class="in"># Make labels use Barlow by default</span></span>
<span id="cb72-112"><a href="#cb72-112" aria-hidden="true" tabindex="-1"></a><span class="in">update_geom_defaults("label_repel", list(family = "Barlow Semi Condensed"))</span></span>
<span id="cb72-113"><a href="#cb72-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-114"><a href="#cb72-114" aria-hidden="true" tabindex="-1"></a><span class="in"># Format things as percentage points</span></span>
<span id="cb72-115"><a href="#cb72-115" aria-hidden="true" tabindex="-1"></a><span class="in">label_pp &lt;- label_number(accuracy = 1, scale = 100, </span></span>
<span id="cb72-116"><a href="#cb72-116" aria-hidden="true" tabindex="-1"></a><span class="in">                         suffix = " pp.", style_negative = "minus")</span></span>
<span id="cb72-117"><a href="#cb72-117" aria-hidden="true" tabindex="-1"></a><span class="in">label_pp_tiny &lt;- label_number(accuracy = 0.01, scale = 100, </span></span>
<span id="cb72-118"><a href="#cb72-118" aria-hidden="true" tabindex="-1"></a><span class="in">                              suffix = " pp.", style_negative = "minus")</span></span>
<span id="cb72-119"><a href="#cb72-119" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-120"><a href="#cb72-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-121"><a href="#cb72-121" aria-hidden="true" tabindex="-1"></a>V-Dem covers all countries since 1789 and includes hundreds of different variables. We'll make a subset of some of the columns here and only look at years from 2010–2020. We'll also make a subset of *that* and have a dataset for just 2015.</span>
<span id="cb72-122"><a href="#cb72-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-123"><a href="#cb72-123" aria-hidden="true" tabindex="-1"></a><span class="in">```{r clean-data}</span></span>
<span id="cb72-124"><a href="#cb72-124" aria-hidden="true" tabindex="-1"></a><span class="in"># Make a subset of the full V-Dem data</span></span>
<span id="cb72-125"><a href="#cb72-125" aria-hidden="true" tabindex="-1"></a><span class="in">vdem_clean &lt;- vdem %&gt;% </span></span>
<span id="cb72-126"><a href="#cb72-126" aria-hidden="true" tabindex="-1"></a><span class="in">  select(country_name, country_text_id, year, region = e_regionpol_6C,</span></span>
<span id="cb72-127"><a href="#cb72-127" aria-hidden="true" tabindex="-1"></a><span class="in">         polyarchy = v2x_polyarchy, corruption = v2x_corr, </span></span>
<span id="cb72-128"><a href="#cb72-128" aria-hidden="true" tabindex="-1"></a><span class="in">         civil_liberties = v2x_civlib, prop_fem = v2lgfemleg, v2lgqugen) %&gt;% </span></span>
<span id="cb72-129"><a href="#cb72-129" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(year &gt;= 2010, year &lt; 2020) %&gt;% </span></span>
<span id="cb72-130"><a href="#cb72-130" aria-hidden="true" tabindex="-1"></a><span class="in">  drop_na(v2lgqugen, prop_fem) %&gt;% </span></span>
<span id="cb72-131"><a href="#cb72-131" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(quota = v2lgqugen &gt; 0,</span></span>
<span id="cb72-132"><a href="#cb72-132" aria-hidden="true" tabindex="-1"></a><span class="in">         prop_fem = prop_fem / 100,</span></span>
<span id="cb72-133"><a href="#cb72-133" aria-hidden="true" tabindex="-1"></a><span class="in">         polyarchy = polyarchy * 100)</span></span>
<span id="cb72-134"><a href="#cb72-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-135"><a href="#cb72-135" aria-hidden="true" tabindex="-1"></a><span class="in">vdem_2015 &lt;- vdem_clean %&gt;% </span></span>
<span id="cb72-136"><a href="#cb72-136" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(year == 2015) %&gt;% </span></span>
<span id="cb72-137"><a href="#cb72-137" aria-hidden="true" tabindex="-1"></a><span class="in">  # Sweden and Denmark are tied for the highest polyarchy score (91.5), and R's</span></span>
<span id="cb72-138"><a href="#cb72-138" aria-hidden="true" tabindex="-1"></a><span class="in">  # max() doesn't deal with ties, so we cheat a little and add a tiny random</span></span>
<span id="cb72-139"><a href="#cb72-139" aria-hidden="true" tabindex="-1"></a><span class="in">  # amount of noise to each polyarchy score, mark the min and max of that</span></span>
<span id="cb72-140"><a href="#cb72-140" aria-hidden="true" tabindex="-1"></a><span class="in">  # perturbed score, and then remove that temporary column</span></span>
<span id="cb72-141"><a href="#cb72-141" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(polyarchy_noise = polyarchy + rnorm(n(), 0, sd = 0.01)) %&gt;% </span></span>
<span id="cb72-142"><a href="#cb72-142" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(highlight = polyarchy_noise == max(polyarchy_noise) | </span></span>
<span id="cb72-143"><a href="#cb72-143" aria-hidden="true" tabindex="-1"></a><span class="in">           polyarchy_noise == min(polyarchy_noise)) %&gt;% </span></span>
<span id="cb72-144"><a href="#cb72-144" aria-hidden="true" tabindex="-1"></a><span class="in">  select(-polyarchy_noise)</span></span>
<span id="cb72-145"><a href="#cb72-145" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-146"><a href="#cb72-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-147"><a href="#cb72-147" aria-hidden="true" tabindex="-1"></a><span class="fu">## Explore the data</span></span>
<span id="cb72-148"><a href="#cb72-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-149"><a href="#cb72-149" aria-hidden="true" tabindex="-1"></a>Before trying to model this data, we'll look at it really quick first. Here's the distribution of <span class="in">`prop_fem`</span> across the two different values of <span class="in">`quota`</span>. In general, it seems that countries without a gender-based quota have fewer women MPs, which isn't all that surprising, since quotas were designed to boost the number of women MPs in the first place.</span>
<span id="cb72-150"><a href="#cb72-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-151"><a href="#cb72-151" aria-hidden="true" tabindex="-1"></a><span class="in">```{r propfem-quota-halves}</span></span>
<span id="cb72-152"><a href="#cb72-152" aria-hidden="true" tabindex="-1"></a><span class="in">quota_halves &lt;- ggplot(vdem_2015, aes(x = quota, y = prop_fem)) +</span></span>
<span id="cb72-153"><a href="#cb72-153" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_half_point(aes(color = quota), </span></span>
<span id="cb72-154"><a href="#cb72-154" aria-hidden="true" tabindex="-1"></a><span class="in">                  transformation = position_quasirandom(width = 0.1),</span></span>
<span id="cb72-155"><a href="#cb72-155" aria-hidden="true" tabindex="-1"></a><span class="in">                  side = "l", size = 0.5, alpha = 0.5) +</span></span>
<span id="cb72-156"><a href="#cb72-156" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_half_boxplot(aes(fill = quota), side = "r") + </span></span>
<span id="cb72-157"><a href="#cb72-157" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(labels = label_percent()) +</span></span>
<span id="cb72-158"><a href="#cb72-158" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_viridis_d(option = "plasma", end = 0.8) +</span></span>
<span id="cb72-159"><a href="#cb72-159" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_viridis_d(option = "plasma", end = 0.8) +</span></span>
<span id="cb72-160"><a href="#cb72-160" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(color = "none", fill = "none") +</span></span>
<span id="cb72-161"><a href="#cb72-161" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Quota", y = "Proportion of women in parliament") +</span></span>
<span id="cb72-162"><a href="#cb72-162" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean()</span></span>
<span id="cb72-163"><a href="#cb72-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-164"><a href="#cb72-164" aria-hidden="true" tabindex="-1"></a><span class="in">quota_densities &lt;- ggplot(vdem_2015, aes(x = prop_fem, fill = quota)) +</span></span>
<span id="cb72-165"><a href="#cb72-165" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_density(alpha = 0.6) +</span></span>
<span id="cb72-166"><a href="#cb72-166" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_percent()) +</span></span>
<span id="cb72-167"><a href="#cb72-167" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_viridis_d(option = "plasma", end = 0.8) +</span></span>
<span id="cb72-168"><a href="#cb72-168" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Proportion of women in parliament", y = "Density", fill = "Quota") +</span></span>
<span id="cb72-169"><a href="#cb72-169" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() +</span></span>
<span id="cb72-170"><a href="#cb72-170" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb72-171"><a href="#cb72-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-172"><a href="#cb72-172" aria-hidden="true" tabindex="-1"></a><span class="in">quota_halves | quota_densities</span></span>
<span id="cb72-173"><a href="#cb72-173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-174"><a href="#cb72-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-175"><a href="#cb72-175" aria-hidden="true" tabindex="-1"></a>And here's what the proportion of women MPs looks like across different levels of electoral democracy. V-Dem's polyarchy index measures the extent of electoral democracy in different countries, incorporating measures of electoral, freedom of association, and universal suffrage, among other factors. It ranges from 0 to 1, but to make it easier to interpret in regression, we'll multiply it by 100 so we can talk about unit changes in democracy. To help with the intuition of the index, we'll highlight the countries with the minimum and maximum values of democracy. In general, the proportion of women MPs increases as democracy increases.</span>
<span id="cb72-176"><a href="#cb72-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-177"><a href="#cb72-177" aria-hidden="true" tabindex="-1"></a><span class="in">```{r polyarchy-propfem-scatterplot, message=FALSE, warning=FALSE}</span></span>
<span id="cb72-178"><a href="#cb72-178" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(vdem_2015, aes(x = polyarchy, y = prop_fem)) +</span></span>
<span id="cb72-179"><a href="#cb72-179" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(aes(color = highlight), size = 1) +</span></span>
<span id="cb72-180"><a href="#cb72-180" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm") +</span></span>
<span id="cb72-181"><a href="#cb72-181" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_label_repel(data = filter(vdem_2015, highlight == TRUE), </span></span>
<span id="cb72-182"><a href="#cb72-182" aria-hidden="true" tabindex="-1"></a><span class="in">                   aes(label = country_name),</span></span>
<span id="cb72-183"><a href="#cb72-183" aria-hidden="true" tabindex="-1"></a><span class="in">                   seed = 1234) +</span></span>
<span id="cb72-184"><a href="#cb72-184" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(labels = label_percent()) +</span></span>
<span id="cb72-185"><a href="#cb72-185" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(values = c("grey30", "#FF4136"), guide = "none") +</span></span>
<span id="cb72-186"><a href="#cb72-186" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Polyarchy (democracy)", y = "Proportion of women in parliament") +</span></span>
<span id="cb72-187"><a href="#cb72-187" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean()</span></span>
<span id="cb72-188"><a href="#cb72-188" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-189"><a href="#cb72-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-190"><a href="#cb72-190" aria-hidden="true" tabindex="-1"></a><span class="fu">## 1: Linear probability models</span></span>
<span id="cb72-191"><a href="#cb72-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-192"><a href="#cb72-192" aria-hidden="true" tabindex="-1"></a>In the world of econometrics, having the fitted regression line go outside the 0–1 range (like in the plot at the very beginning of this post) is totally fine and not a problem. Economists love to use a thing called a linear probability model (LPM) to model data like this, and for values that aren't too extreme (<span class="co">[</span><span class="ot">generally if the outcome ranges between 0.2 and 0.8</span><span class="co">](https://www.alexpghayes.com/blog/consistency-and-the-linear-probability-model/)</span>), the results from these weirdly fitting linear models are generally equivalent to fancier non-linear models. LPMs are even <span class="co">[</span><span class="ot">arguably best for experimental data</span><span class="co">](https://psyarxiv.com/4gmbv)</span>. But it's still a weird way to think about data and I don't like them. As <span class="co">[</span><span class="ot">Alex Hayes says</span><span class="co">](https://www.alexpghayes.com/blog/consistency-and-the-linear-probability-model/)</span>, </span>
<span id="cb72-193"><a href="#cb72-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-194"><a href="#cb72-194" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; </span><span class="co">[</span><span class="ot">T</span><span class="co">]</span><span class="at">he thing </span><span class="co">[</span><span class="ot">LPM</span><span class="co">]</span><span class="at"> is generally inconsistent and aesthetically offensive, but whatever, it works on occasion.</span></span>
<span id="cb72-195"><a href="#cb72-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-196"><a href="#cb72-196" aria-hidden="true" tabindex="-1"></a>An LPM is really just regular old OLS applied to a binary or proportional outcome, so we'll use trusty old <span class="in">`lm()`</span>.</span>
<span id="cb72-197"><a href="#cb72-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-198"><a href="#cb72-198" aria-hidden="true" tabindex="-1"></a><span class="in">```{r model-ols}</span></span>
<span id="cb72-199"><a href="#cb72-199" aria-hidden="true" tabindex="-1"></a><span class="in"># Linear probability models</span></span>
<span id="cb72-200"><a href="#cb72-200" aria-hidden="true" tabindex="-1"></a><span class="in">model_ols1 &lt;- lm(prop_fem ~ quota,</span></span>
<span id="cb72-201"><a href="#cb72-201" aria-hidden="true" tabindex="-1"></a><span class="in">                 data = vdem_2015)</span></span>
<span id="cb72-202"><a href="#cb72-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-203"><a href="#cb72-203" aria-hidden="true" tabindex="-1"></a><span class="in">model_ols2 &lt;- lm(prop_fem ~ polyarchy,</span></span>
<span id="cb72-204"><a href="#cb72-204" aria-hidden="true" tabindex="-1"></a><span class="in">                 data = vdem_2015)</span></span>
<span id="cb72-205"><a href="#cb72-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-206"><a href="#cb72-206" aria-hidden="true" tabindex="-1"></a><span class="in">model_ols3 &lt;- lm(prop_fem ~ quota + polyarchy,</span></span>
<span id="cb72-207"><a href="#cb72-207" aria-hidden="true" tabindex="-1"></a><span class="in">                 data = vdem_2015)</span></span>
<span id="cb72-208"><a href="#cb72-208" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-209"><a href="#cb72-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-210"><a href="#cb72-210" aria-hidden="true" tabindex="-1"></a><span class="in">```{r extract-model-ols, include=FALSE}</span></span>
<span id="cb72-211"><a href="#cb72-211" aria-hidden="true" tabindex="-1"></a><span class="in">r_model_ols &lt;- bind_rows(</span></span>
<span id="cb72-212"><a href="#cb72-212" aria-hidden="true" tabindex="-1"></a><span class="in">  model1 = tidy(model_ols1),</span></span>
<span id="cb72-213"><a href="#cb72-213" aria-hidden="true" tabindex="-1"></a><span class="in">  model3 = tidy(model_ols3),</span></span>
<span id="cb72-214"><a href="#cb72-214" aria-hidden="true" tabindex="-1"></a><span class="in">  .id = "model"</span></span>
<span id="cb72-215"><a href="#cb72-215" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;% </span></span>
<span id="cb72-216"><a href="#cb72-216" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(pp = round(estimate * 100, 1)) %&gt;% </span></span>
<span id="cb72-217"><a href="#cb72-217" aria-hidden="true" tabindex="-1"></a><span class="in">  split(~model + term)</span></span>
<span id="cb72-218"><a href="#cb72-218" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-219"><a href="#cb72-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-220"><a href="#cb72-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-221"><a href="#cb72-221" aria-hidden="true" tabindex="-1"></a><span class="in">```{r model-ols-summary}</span></span>
<span id="cb72-222"><a href="#cb72-222" aria-hidden="true" tabindex="-1"></a><span class="in">modelsummary(list(model_ols1, model_ols2, model_ols3),</span></span>
<span id="cb72-223"><a href="#cb72-223" aria-hidden="true" tabindex="-1"></a><span class="in">             gof_map = gof_stuff)</span></span>
<span id="cb72-224"><a href="#cb72-224" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-225"><a href="#cb72-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-226"><a href="#cb72-226" aria-hidden="true" tabindex="-1"></a>Based on this, having a quota is associated with a <span class="in">`r r_model_ols$model1.quotaTRUE$pp`</span> percentage point increase in the proportion of women MPs on average, and the coefficient is statistically significant. If we control for polyarchy, the effect changes to <span class="in">`r r_model_ols$model3.quotaTRUE$pp`</span> percentage points. Great.</span>
<span id="cb72-227"><a href="#cb72-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-228"><a href="#cb72-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-229"><a href="#cb72-229" aria-hidden="true" tabindex="-1"></a><span class="fu">## 2: Fractional logistic regression</span></span>
<span id="cb72-230"><a href="#cb72-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-231"><a href="#cb72-231" aria-hidden="true" tabindex="-1"></a>Logistic regression is normally used for binary outcomes, but surprisingly you can actually use it for proportional data too! This kind of model is called fractional logistic regression, and though it feels weird to use logistic regression with non-binary data, it's legal! The Stata documentation <span class="co">[</span><span class="ot">actually recommends it</span><span class="co">](https://www.stata.com/support/faqs/statistics/logit-transformation/)</span>, and there are tutorials (like <span class="co">[</span><span class="ot">this</span><span class="co">](https://stats.idre.ucla.edu/stata/faq/how-does-one-do-regression-when-the-dependent-variable-is-a-proportion/)</span> and <span class="co">[</span><span class="ot">this</span><span class="co">](https://www3.nd.edu/~rwilliam/stats3/FractionalResponseModels.pdf)</span>) <span class="co">[</span><span class="ot">papers</span><span class="co">](https://doi.org/10.1177%2F1536867X0800800212)</span> about how to do it with Stata. <span class="co">[</span><span class="ot">This really in-depth post by Michael Clark</span><span class="co">](https://m-clark.github.io/posts/2019-08-20-fractional-regression/)</span> shows several ways to run these models with R.</span>
<span id="cb72-232"><a href="#cb72-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-233"><a href="#cb72-233" aria-hidden="true" tabindex="-1"></a>Basically use regular logistic regression with <span class="in">`glm(..., family = binomial(link = "logit"))`</span> with an outcome variable that ranges from 0 to 1, and you're done. R will give you a warning when you use <span class="in">`family = binomial()`</span> with a non-binary outcome variable, but it will still work. If you want to suppress that warning, use <span class="in">`family = quasibinomial()`</span> instead.</span>
<span id="cb72-234"><a href="#cb72-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-235"><a href="#cb72-235" aria-hidden="true" tabindex="-1"></a><span class="in">```{r model-frac-logit}</span></span>
<span id="cb72-236"><a href="#cb72-236" aria-hidden="true" tabindex="-1"></a><span class="in">model_frac_logit1 &lt;- glm(prop_fem ~ quota, </span></span>
<span id="cb72-237"><a href="#cb72-237" aria-hidden="true" tabindex="-1"></a><span class="in">                         data = vdem_2015, </span></span>
<span id="cb72-238"><a href="#cb72-238" aria-hidden="true" tabindex="-1"></a><span class="in">                         family = quasibinomial())</span></span>
<span id="cb72-239"><a href="#cb72-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-240"><a href="#cb72-240" aria-hidden="true" tabindex="-1"></a><span class="in">model_frac_logit2 &lt;- glm(prop_fem ~ polyarchy, </span></span>
<span id="cb72-241"><a href="#cb72-241" aria-hidden="true" tabindex="-1"></a><span class="in">                         data = vdem_2015, </span></span>
<span id="cb72-242"><a href="#cb72-242" aria-hidden="true" tabindex="-1"></a><span class="in">                         family = quasibinomial())</span></span>
<span id="cb72-243"><a href="#cb72-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-244"><a href="#cb72-244" aria-hidden="true" tabindex="-1"></a><span class="in">model_frac_logit3 &lt;- glm(prop_fem ~ quota + polyarchy, </span></span>
<span id="cb72-245"><a href="#cb72-245" aria-hidden="true" tabindex="-1"></a><span class="in">                         data = vdem_2015, </span></span>
<span id="cb72-246"><a href="#cb72-246" aria-hidden="true" tabindex="-1"></a><span class="in">                         family = quasibinomial())</span></span>
<span id="cb72-247"><a href="#cb72-247" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-248"><a href="#cb72-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-249"><a href="#cb72-249" aria-hidden="true" tabindex="-1"></a><span class="in">```{r extract-model-frac-logit, include=FALSE}</span></span>
<span id="cb72-250"><a href="#cb72-250" aria-hidden="true" tabindex="-1"></a><span class="in">r_model_frac_logit &lt;- bind_rows(</span></span>
<span id="cb72-251"><a href="#cb72-251" aria-hidden="true" tabindex="-1"></a><span class="in">  model1 = tidy(model_frac_logit1),</span></span>
<span id="cb72-252"><a href="#cb72-252" aria-hidden="true" tabindex="-1"></a><span class="in">  model3 = tidy(model_frac_logit3),</span></span>
<span id="cb72-253"><a href="#cb72-253" aria-hidden="true" tabindex="-1"></a><span class="in">  .id = "model"</span></span>
<span id="cb72-254"><a href="#cb72-254" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;% </span></span>
<span id="cb72-255"><a href="#cb72-255" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(est_exp = exp(estimate)) %&gt;% </span></span>
<span id="cb72-256"><a href="#cb72-256" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(est_exp_pct = label_percent(accuracy = 1)(est_exp - 1)) %&gt;% </span></span>
<span id="cb72-257"><a href="#cb72-257" aria-hidden="true" tabindex="-1"></a><span class="in">  split(~model + term)</span></span>
<span id="cb72-258"><a href="#cb72-258" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-259"><a href="#cb72-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-260"><a href="#cb72-260" aria-hidden="true" tabindex="-1"></a><span class="in">```{r model-frac-logit-summary}</span></span>
<span id="cb72-261"><a href="#cb72-261" aria-hidden="true" tabindex="-1"></a><span class="in">modelsummary(list(model_frac_logit1, model_frac_logit2, model_frac_logit3),</span></span>
<span id="cb72-262"><a href="#cb72-262" aria-hidden="true" tabindex="-1"></a><span class="in">             gof_map = gof_stuff)</span></span>
<span id="cb72-263"><a href="#cb72-263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-264"><a href="#cb72-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-265"><a href="#cb72-265" aria-hidden="true" tabindex="-1"></a>Interpreting this model is a little more involved than interpreting OLS. The coefficients in logistic regression are provided on different scale than the original data. With OLS (and the linear probability model), coefficients show the change in the probability (or proportion in this case, since we're working with proportion data) that is associated with a one-unit change in an explanatory variable. With logistic regression, coefficients show the change in the natural logged odds of the outcome, also known as "logits."</span>
<span id="cb72-266"><a href="#cb72-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-267"><a href="#cb72-267" aria-hidden="true" tabindex="-1"></a>This log odds scale is weird and not very intuitive normally, so often people will convert these log odds into odds ratios by exponentiating them. I've done this my whole statistical-knowing-and-doing life. If a model provides a coefficient of 0.4, you can exponentiate that with $e^{0.4}$, resulting in an odds ratio of 1.49. You'd interpret this by saying something like "a one unit change in x increases the likelihood of y by 49%." That sounds neat and soundbite-y and you see stuff like this all the time in science reporting. But thinking about percent changes in probability is still a weird way of thinking (though admittedly less non-intuitive than thinking about logits/logged odds).</span>
<span id="cb72-268"><a href="#cb72-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-269"><a href="#cb72-269" aria-hidden="true" tabindex="-1"></a>For instance, here the coefficient for <span class="in">`quota`</span> in Model 1 is <span class="in">`r round(r_model_frac_logit$model1.quotaTRUE$estimate, 3)`</span>. If we exponentiate that ($e^{<span class="in">`r r_model_frac_logit[['model1.quotaTRUE']][['estimate']]`</span>}$) we get <span class="in">`r round(r_model_frac_logit$model1.quotaTRUE$est_exp, 2)`</span>. If our outcome were binary, we could say that having a quota makes it <span class="in">`r r_model_frac_logit$model1.quotaTRUE$est_exp_pct`</span> more likely that the outcome would occur. But our outcome isn't binary—it's a proportion—so we need to think about changes in probabilities or proportions instead, and odds ratios make that really really hard.</span>
<span id="cb72-270"><a href="#cb72-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-271"><a href="#cb72-271" aria-hidden="true" tabindex="-1"></a>Instead of odds ratios, we need to work directly with these logit-scale values. For a *phenomenally* excellent overview of binary logistic regression and how to interpret coefficients, see <span class="co">[</span><span class="ot">Steven Miller's most excellent lab script here</span><span class="co">](http://post8000.svmiller.com/lab-scripts/logistic-regression-lab.html)</span>—because of that post I'm now far less afraid of dealing with logit-scale coefficients!</span>
<span id="cb72-272"><a href="#cb72-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-273"><a href="#cb72-273" aria-hidden="true" tabindex="-1"></a>We can invert a logit value and convert it to a probability using the <span class="in">`plogis()`</span> function in R. We'll illustrate this a couple different ways, starting with a super simple intercept-only model:</span>
<span id="cb72-274"><a href="#cb72-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-275"><a href="#cb72-275" aria-hidden="true" tabindex="-1"></a><span class="in">```{r frac-logit-intercept-only}</span></span>
<span id="cb72-276"><a href="#cb72-276" aria-hidden="true" tabindex="-1"></a><span class="in">model_frac_logit0 &lt;- glm(prop_fem ~ 1, </span></span>
<span id="cb72-277"><a href="#cb72-277" aria-hidden="true" tabindex="-1"></a><span class="in">                         data = vdem_2015, </span></span>
<span id="cb72-278"><a href="#cb72-278" aria-hidden="true" tabindex="-1"></a><span class="in">                         family = quasibinomial())</span></span>
<span id="cb72-279"><a href="#cb72-279" aria-hidden="true" tabindex="-1"></a><span class="in">tidy(model_frac_logit0)</span></span>
<span id="cb72-280"><a href="#cb72-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-281"><a href="#cb72-281" aria-hidden="true" tabindex="-1"></a><span class="in">logit0_intercept &lt;- model_frac_logit0 %&gt;% </span></span>
<span id="cb72-282"><a href="#cb72-282" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy() %&gt;% </span></span>
<span id="cb72-283"><a href="#cb72-283" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(term == "(Intercept)") %&gt;% </span></span>
<span id="cb72-284"><a href="#cb72-284" aria-hidden="true" tabindex="-1"></a><span class="in">  pull(estimate)</span></span>
<span id="cb72-285"><a href="#cb72-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-286"><a href="#cb72-286" aria-hidden="true" tabindex="-1"></a><span class="in"># The intercept in logits. Who even knows what this means.</span></span>
<span id="cb72-287"><a href="#cb72-287" aria-hidden="true" tabindex="-1"></a><span class="in">logit0_intercept</span></span>
<span id="cb72-288"><a href="#cb72-288" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-289"><a href="#cb72-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-290"><a href="#cb72-290" aria-hidden="true" tabindex="-1"></a>The intercept of this intercept-only model is <span class="in">`r round(logit0_intercept, 4)`</span> in logit units, whatever that means. We can convert this to a probability though:</span>
<span id="cb72-291"><a href="#cb72-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-292"><a href="#cb72-292" aria-hidden="true" tabindex="-1"></a><span class="in">```{r int-only-to-probability}</span></span>
<span id="cb72-293"><a href="#cb72-293" aria-hidden="true" tabindex="-1"></a><span class="in"># Convert logit to a probability (or proportion in this case)</span></span>
<span id="cb72-294"><a href="#cb72-294" aria-hidden="true" tabindex="-1"></a><span class="in">plogis(logit0_intercept)</span></span>
<span id="cb72-295"><a href="#cb72-295" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-296"><a href="#cb72-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-297"><a href="#cb72-297" aria-hidden="true" tabindex="-1"></a>According to this probability/proportion, the average proportion of women MPs in the dataset is <span class="in">`r round(plogis(logit0_intercept), 3)`</span>. Let's see if that's really the case:</span>
<span id="cb72-298"><a href="#cb72-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-299"><a href="#cb72-299" aria-hidden="true" tabindex="-1"></a><span class="in">```{r avg-propfem}</span></span>
<span id="cb72-300"><a href="#cb72-300" aria-hidden="true" tabindex="-1"></a><span class="in">mean(vdem_2015$prop_fem)</span></span>
<span id="cb72-301"><a href="#cb72-301" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-302"><a href="#cb72-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-303"><a href="#cb72-303" aria-hidden="true" tabindex="-1"></a>It's the same! That's so neat!</span>
<span id="cb72-304"><a href="#cb72-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-305"><a href="#cb72-305" aria-hidden="true" tabindex="-1"></a>Inverting logit coefficients to probabilities gets a little trickier when there are multiple moving parts, though. With OLS, each coefficient shows the marginal change in the outcome for each unit change in the explanatory variable. With logistic regression, that's not the case—we have to incorporate information from the intercept in order to get marginal effects.</span>
<span id="cb72-306"><a href="#cb72-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-307"><a href="#cb72-307" aria-hidden="true" tabindex="-1"></a>For example, in Model 1, the log odds coefficient for <span class="in">`quota`</span> is <span class="in">`r r_model_frac_logit$model1.quotaTRUE$estimate`</span>. If we invert that with <span class="in">`plogis()`</span>, we end up with a really big number:</span>
<span id="cb72-308"><a href="#cb72-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-309"><a href="#cb72-309" aria-hidden="true" tabindex="-1"></a><span class="in">```{r frac-logit-quota-wrong}</span></span>
<span id="cb72-310"><a href="#cb72-310" aria-hidden="true" tabindex="-1"></a><span class="in">logit1_intercept &lt;- model_frac_logit1 %&gt;% </span></span>
<span id="cb72-311"><a href="#cb72-311" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy() %&gt;% </span></span>
<span id="cb72-312"><a href="#cb72-312" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(term == "(Intercept)") %&gt;% </span></span>
<span id="cb72-313"><a href="#cb72-313" aria-hidden="true" tabindex="-1"></a><span class="in">  pull(estimate)</span></span>
<span id="cb72-314"><a href="#cb72-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-315"><a href="#cb72-315" aria-hidden="true" tabindex="-1"></a><span class="in">logit1_quota &lt;- model_frac_logit1 %&gt;% </span></span>
<span id="cb72-316"><a href="#cb72-316" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy() %&gt;% </span></span>
<span id="cb72-317"><a href="#cb72-317" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(term == "quotaTRUE") %&gt;% </span></span>
<span id="cb72-318"><a href="#cb72-318" aria-hidden="true" tabindex="-1"></a><span class="in">  pull(estimate)</span></span>
<span id="cb72-319"><a href="#cb72-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-320"><a href="#cb72-320" aria-hidden="true" tabindex="-1"></a><span class="in"># Incorrect marginal effect of quota</span></span>
<span id="cb72-321"><a href="#cb72-321" aria-hidden="true" tabindex="-1"></a><span class="in">plogis(logit1_quota)</span></span>
<span id="cb72-322"><a href="#cb72-322" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-323"><a href="#cb72-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-324"><a href="#cb72-324" aria-hidden="true" tabindex="-1"></a>If that were true, we could say that having a quota increases the proportion of women MPs by nearly 60%! But that's wrong. We have to incorporate information from the intercept, as well as any other coefficients in the model, like so:</span>
<span id="cb72-325"><a href="#cb72-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-326"><a href="#cb72-326" aria-hidden="true" tabindex="-1"></a><span class="in">```{r frac-logit-quota-correct}</span></span>
<span id="cb72-327"><a href="#cb72-327" aria-hidden="true" tabindex="-1"></a><span class="in">plogis(logit1_intercept + logit1_quota) - plogis(logit1_intercept)</span></span>
<span id="cb72-328"><a href="#cb72-328" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-329"><a href="#cb72-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-330"><a href="#cb72-330" aria-hidden="true" tabindex="-1"></a>*This* is the effect of having a quota on the proportion of women MPs. Having a quota increases the proportion by <span class="in">`r round((plogis(logit1_intercept + logit1_quota) - plogis(logit1_intercept)) * 100, 1)`</span> percentage points, on average.</span>
<span id="cb72-331"><a href="#cb72-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-332"><a href="#cb72-332" aria-hidden="true" tabindex="-1"></a>The math of combining these different logit coefficients and converting them to probabilities gets really tricky once there are more than one covariate, like in Model 3 here where we include both quota and polyarchy. Rather than try to figure out, we can instead calculate the marginal effects of specific variables while holding others constant. In practice this entails plugging a custom hypothetical dataset into our model and estimating the predicted values of the outcome. For instance, we can create a small dataset with just two rows: in one row, <span class="in">`quota`</span> is FALSE and in the other <span class="in">`quota`</span> is TRUE, while we hold <span class="in">`polyarchy`</span> at its mean value. The <span class="co">[</span><span class="ot">**marginaleffects** package</span><span class="co">](https://vincentarelbundock.github.io/marginaleffects/)</span> makes this really easy to do:</span>
<span id="cb72-333"><a href="#cb72-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-334"><a href="#cb72-334" aria-hidden="true" tabindex="-1"></a><span class="in">```{r frac-logit-typical}</span></span>
<span id="cb72-335"><a href="#cb72-335" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate the typical values for all variables in Model 3, except for quota,</span></span>
<span id="cb72-336"><a href="#cb72-336" aria-hidden="true" tabindex="-1"></a><span class="in"># which we'll force to be FALSE and TRUE</span></span>
<span id="cb72-337"><a href="#cb72-337" aria-hidden="true" tabindex="-1"></a><span class="in">data_to_predict &lt;- datagrid(model = model_frac_logit3, </span></span>
<span id="cb72-338"><a href="#cb72-338" aria-hidden="true" tabindex="-1"></a><span class="in">                            quota = c(FALSE, TRUE))</span></span>
<span id="cb72-339"><a href="#cb72-339" aria-hidden="true" tabindex="-1"></a><span class="in">data_to_predict</span></span>
<span id="cb72-340"><a href="#cb72-340" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-341"><a href="#cb72-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-342"><a href="#cb72-342" aria-hidden="true" tabindex="-1"></a>Next we can use <span class="in">`predictions()`</span> from the **marginaleffects** package to plug this data into Model 3 and figure out the fitted values for each of the rows:</span>
<span id="cb72-343"><a href="#cb72-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-344"><a href="#cb72-344" aria-hidden="true" tabindex="-1"></a><span class="in">```{r frac-logit-predictions}</span></span>
<span id="cb72-345"><a href="#cb72-345" aria-hidden="true" tabindex="-1"></a><span class="in"># Plug this new dataset into the model</span></span>
<span id="cb72-346"><a href="#cb72-346" aria-hidden="true" tabindex="-1"></a><span class="in">frac_logit_pred &lt;- predictions(model_frac_logit3, newdata = data_to_predict)</span></span>
<span id="cb72-347"><a href="#cb72-347" aria-hidden="true" tabindex="-1"></a><span class="in">frac_logit_pred</span></span>
<span id="cb72-348"><a href="#cb72-348" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-349"><a href="#cb72-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-350"><a href="#cb72-350" aria-hidden="true" tabindex="-1"></a>The <span class="in">`estimate`</span> column here tells us the predicted or fitted value. When countries don't have a quota, the average proportion of women MPs is <span class="in">`r round(frac_logit_pred$estimate[[1]], 3)`</span>; when they do have a quota, the average predicted proportion is <span class="in">`r round(frac_logit_pred$estimate[[1]], 3)`</span>. That's a <span class="in">`r round((frac_logit_pred$estimate[[2]] - frac_logit_pred$estimate[[1]]) * 100, 2)`</span> percentage point difference, which is really similar to what we found from Model 1. We can plot these marginal effects too and see that this difference is statistically significant:</span>
<span id="cb72-351"><a href="#cb72-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-352"><a href="#cb72-352" aria-hidden="true" tabindex="-1"></a><span class="in">```{r frac-logit-plot-predictions, warning=FALSE}</span></span>
<span id="cb72-353"><a href="#cb72-353" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(frac_logit_pred, aes(x = quota, y = estimate)) +</span></span>
<span id="cb72-354"><a href="#cb72-354" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_pointrange(aes(ymin = conf.low, ymax = conf.high)) +</span></span>
<span id="cb72-355"><a href="#cb72-355" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(labels = label_percent(accuracy = 1)) +</span></span>
<span id="cb72-356"><a href="#cb72-356" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Quota", y = "Predicted proportion of women in parliament") +</span></span>
<span id="cb72-357"><a href="#cb72-357" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean()</span></span>
<span id="cb72-358"><a href="#cb72-358" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-359"><a href="#cb72-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-360"><a href="#cb72-360" aria-hidden="true" tabindex="-1"></a>We can also compute marginal effects for polyarchy, holding <span class="in">`quota`</span> at FALSE (its most common value) and ranging <span class="in">`polyarchy`</span> from 0 to 100. And we technically don't need to make a separate data frame first—we can use <span class="in">`datagrid()`</span> inside <span class="in">`predictions()`</span>:</span>
<span id="cb72-361"><a href="#cb72-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-362"><a href="#cb72-362" aria-hidden="true" tabindex="-1"></a><span class="in">```{r frac-logit-predict-polyarchy}</span></span>
<span id="cb72-363"><a href="#cb72-363" aria-hidden="true" tabindex="-1"></a><span class="in">frac_logit_pred &lt;- predictions(model_frac_logit3, </span></span>
<span id="cb72-364"><a href="#cb72-364" aria-hidden="true" tabindex="-1"></a><span class="in">                               newdata = datagrid(polyarchy = seq(0, 100, by = 1)))</span></span>
<span id="cb72-365"><a href="#cb72-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-366"><a href="#cb72-366" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(frac_logit_pred, aes(x = polyarchy, y = estimate)) + </span></span>
<span id="cb72-367"><a href="#cb72-367" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), </span></span>
<span id="cb72-368"><a href="#cb72-368" aria-hidden="true" tabindex="-1"></a><span class="in">              alpha = 0.4, fill = "#480B6A") +</span></span>
<span id="cb72-369"><a href="#cb72-369" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(linewidth = 1, color = "#480B6A") +</span></span>
<span id="cb72-370"><a href="#cb72-370" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(labels = label_percent()) +</span></span>
<span id="cb72-371"><a href="#cb72-371" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Polyarchy (democracy)", </span></span>
<span id="cb72-372"><a href="#cb72-372" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Predicted proportion of women in parliament") +</span></span>
<span id="cb72-373"><a href="#cb72-373" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean()</span></span>
<span id="cb72-374"><a href="#cb72-374" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-375"><a href="#cb72-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-376"><a href="#cb72-376" aria-hidden="true" tabindex="-1"></a>The predicted proportion of women MPs increases as democracy increases, which follows from the model results. But what's the marginal effect of a one-unit increase in polyarchy? The coefficient from Model 3 was really small (<span class="in">`r round(r_model_frac_logit$model3.polyarch$estimate, 5)`</span> logits). We can convert this to a probability while correctly accounting for the intercept and all other coefficients with the <span class="in">`avg_slopes()`</span> function:</span>
<span id="cb72-377"><a href="#cb72-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-378"><a href="#cb72-378" aria-hidden="true" tabindex="-1"></a><span class="in">```{r frac-logit-mfx-polyarchy}</span></span>
<span id="cb72-379"><a href="#cb72-379" aria-hidden="true" tabindex="-1"></a><span class="in">avg_slopes(model_frac_logit3, variables = "polyarchy")</span></span>
<span id="cb72-380"><a href="#cb72-380" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-381"><a href="#cb72-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-382"><a href="#cb72-382" aria-hidden="true" tabindex="-1"></a><span class="in">```{r extract-frac-logit-mfx, include=FALSE}</span></span>
<span id="cb72-383"><a href="#cb72-383" aria-hidden="true" tabindex="-1"></a><span class="in">r_frac_logit_mfx &lt;- predictions(model_frac_logit3,</span></span>
<span id="cb72-384"><a href="#cb72-384" aria-hidden="true" tabindex="-1"></a><span class="in">  newdata = datagrid(polyarchy = c(56, 66))) %&gt;% </span></span>
<span id="cb72-385"><a href="#cb72-385" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(polyarchy = janitor::make_clean_names(polyarchy)) %&gt;% </span></span>
<span id="cb72-386"><a href="#cb72-386" aria-hidden="true" tabindex="-1"></a><span class="in">  split(~polyarchy)</span></span>
<span id="cb72-387"><a href="#cb72-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-388"><a href="#cb72-388" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-389"><a href="#cb72-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-390"><a href="#cb72-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-391"><a href="#cb72-391" aria-hidden="true" tabindex="-1"></a>The effect here is still small: a one-unit change in polyarchy (i.e. moving from a 56 to a 57) is associated with a <span class="in">`r round(avg_slopes(model_frac_logit3, variables = "polyarchy")[["estimate"]] * 100, 3)`</span> percentage point increase in the proportion of women MPs, on average. That's not *huge*, but a one-unit change in polyarchy also isn't huge. If a country moves 10 points from 56 to 66, for instance, there'd be a ≈10x increase in the effect (<span class="in">`r round(avg_slopes(model_frac_logit3, variables = "polyarchy")[["estimate"]], 5)`</span> × 10, or <span class="in">`r round(avg_slopes(model_frac_logit3, variables = "polyarchy")[["estimate"]] * 10, 5)`</span>). This is apparent in the predicted proportion when polyarchy is set to 56 and 66: <span class="in">`r r_frac_logit_mfx$x66$estimate`</span> - <span class="in">`r r_frac_logit_mfx$x56$estimate`</span> = <span class="in">`r r_frac_logit_mfx$x66$estimate - r_frac_logit_mfx$x56$estimate`</span></span>
<span id="cb72-392"><a href="#cb72-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-393"><a href="#cb72-393" aria-hidden="true" tabindex="-1"></a><span class="in">```{r frac-logit-mfx-polyarchy-2}</span></span>
<span id="cb72-394"><a href="#cb72-394" aria-hidden="true" tabindex="-1"></a><span class="in">predictions(model_frac_logit3,</span></span>
<span id="cb72-395"><a href="#cb72-395" aria-hidden="true" tabindex="-1"></a><span class="in">            newdata = datagrid(polyarchy = c(56, 66)))</span></span>
<span id="cb72-396"><a href="#cb72-396" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-397"><a href="#cb72-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-398"><a href="#cb72-398" aria-hidden="true" tabindex="-1"></a>Finally, how do these fractional logistic regression coefficients compare to what we found with the linear probability model? We can look at them side-by-side:</span>
<span id="cb72-399"><a href="#cb72-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-400"><a href="#cb72-400" aria-hidden="true" tabindex="-1"></a><span class="in">```{r frac-logit-summary}</span></span>
<span id="cb72-401"><a href="#cb72-401" aria-hidden="true" tabindex="-1"></a><span class="in">modelsummary(list("OLS" = model_ols3,</span></span>
<span id="cb72-402"><a href="#cb72-402" aria-hidden="true" tabindex="-1"></a><span class="in">                  "Fractional logit" = model_frac_logit3,</span></span>
<span id="cb72-403"><a href="#cb72-403" aria-hidden="true" tabindex="-1"></a><span class="in">                  "Fractional logit&lt;br&gt;(marginal effects)" = marginaleffects(model_frac_logit3)),</span></span>
<span id="cb72-404"><a href="#cb72-404" aria-hidden="true" tabindex="-1"></a><span class="in">             gof_map = gof_stuff,</span></span>
<span id="cb72-405"><a href="#cb72-405" aria-hidden="true" tabindex="-1"></a><span class="in">             fmt = 4,</span></span>
<span id="cb72-406"><a href="#cb72-406" aria-hidden="true" tabindex="-1"></a><span class="in">             escape = FALSE)</span></span>
<span id="cb72-407"><a href="#cb72-407" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-408"><a href="#cb72-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-409"><a href="#cb72-409" aria-hidden="true" tabindex="-1"></a>They're basically the same! Having a quota is associated with a <span class="in">`r round(avg_slopes(model_frac_logit3, variables = "quota")$estimate * 100, 2)`</span> percentage point increase in the proportion of women MPs, on average, in both OLS and the fractional logit model. That's so neat!</span>
<span id="cb72-410"><a href="#cb72-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-411"><a href="#cb72-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-412"><a href="#cb72-412" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interlude: The beta distribution and distributional regression</span></span>
<span id="cb72-413"><a href="#cb72-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-414"><a href="#cb72-414" aria-hidden="true" tabindex="-1"></a>The OLS-based linear probability model works (begrudgingly), and fractional logistic regression works (but it feels kinda weird to use logistic regression on proportions like that). The third method we'll explore is beta regression, which is a little different from linear regression. With regular old linear regression, we're essentially fitting a line to data. We find an intercept, we find a slope, and we draw a line. We can add some mathematical trickery to make sure the line stays within specific bounds (like using logits and logged odds), but fundamentally everything just has intercepts and slopes.</span>
<span id="cb72-415"><a href="#cb72-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-416"><a href="#cb72-416" aria-hidden="true" tabindex="-1"></a>An alternative to this kind of mean-focused regression is to use something called <span class="co">[</span><span class="ot">*distributional regression*</span><span class="co">](https://doi.org/10.1016/j.ecosta.2021.07.006)</span> <span class="co">[</span><span class="ot">@KneibSilbersdorffSafken:2021</span><span class="co">]</span> to estimate not lines and averages, but the overall shapes of statistical distributions. </span>
<span id="cb72-417"><a href="#cb72-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-418"><a href="#cb72-418" aria-hidden="true" tabindex="-1"></a>Beta regression is one type of distributional regression, but before we explore how it works, we have to briefly review how distributions work.</span>
<span id="cb72-419"><a href="#cb72-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-420"><a href="#cb72-420" aria-hidden="true" tabindex="-1"></a>In statistics, there are all sorts of probability distributions that can represent the general shape and properties of a variable (<span class="co">[</span><span class="ot">I have a whole guide for generating data using the most common distributions here</span><span class="co">](https://evalf21.classes.andrewheiss.com/example/random-numbers/#distributions)</span>). For instance, in a normal distribution, most of the values are clustered around a mean, and values are spread out based on some amount of variance, or standard deviation. </span>
<span id="cb72-421"><a href="#cb72-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-422"><a href="#cb72-422" aria-hidden="true" tabindex="-1"></a>Here are two normal distributions defined by different means and standard deviations. One is centered at 5 with a fairly wide standard deviation of 4 (so 95% of its values range from 5 ± (4 × 1.96), or from −3ish to 13ish), while the other is centered at 10 with a narrower standard deviation of 2 (so 95% of its values range from 10 ± (2 × 1.96), or from 6 to 14):</span>
<span id="cb72-423"><a href="#cb72-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-424"><a href="#cb72-424" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-dist-normal-example}</span></span>
<span id="cb72-425"><a href="#cb72-425" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = tibble(x = seq(-10, 20)), aes(x = x)) +</span></span>
<span id="cb72-426"><a href="#cb72-426" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_function(fun = dnorm, args = list(mean = 5, sd = 4),</span></span>
<span id="cb72-427"><a href="#cb72-427" aria-hidden="true" tabindex="-1"></a><span class="in">                aes(color = "Normal(mean = 5, sd = 4)"), linewidth = 1) +</span></span>
<span id="cb72-428"><a href="#cb72-428" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_function(fun = dnorm, args = list(mean = 10, sd = 2),</span></span>
<span id="cb72-429"><a href="#cb72-429" aria-hidden="true" tabindex="-1"></a><span class="in">                aes(color = "Normal(mean = 10, sd = 2)"), linewidth = 1) +</span></span>
<span id="cb72-430"><a href="#cb72-430" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_viridis_d(option = "plasma", end = 0.8, name = "") +</span></span>
<span id="cb72-431"><a href="#cb72-431" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() +</span></span>
<span id="cb72-432"><a href="#cb72-432" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb72-433"><a href="#cb72-433" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-434"><a href="#cb72-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-435"><a href="#cb72-435" aria-hidden="true" tabindex="-1"></a>Most other distributions are defined in similar ways: there's a central tendency (often the mean), and there's some spread or variation around that center.</span>
<span id="cb72-436"><a href="#cb72-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-437"><a href="#cb72-437" aria-hidden="true" tabindex="-1"></a><span class="fu">### Beta distributions and shape parameters</span></span>
<span id="cb72-438"><a href="#cb72-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-439"><a href="#cb72-439" aria-hidden="true" tabindex="-1"></a>One really common distribution that's *perfect* for percentages and proportions is <span class="co">[</span><span class="ot">the beta distribution</span><span class="co">](https://en.wikipedia.org/wiki/Beta_distribution)</span>, which is naturally limited to numbers between 0 and 1 (but importantly doesn't include 0 or 1). The beta distribution is an extremely flexible distribution and can take all sorts of different shapes and forms (stare at <span class="co">[</span><span class="ot">this amazing animated GIF</span><span class="co">](https://en.wikipedia.org/wiki/File:PDF_of_the_Beta_distribution.gif)</span> for a while to see all the different shapes!)</span>
<span id="cb72-440"><a href="#cb72-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-441"><a href="#cb72-441" aria-hidden="true" tabindex="-1"></a>Unlike a normal distribution, where you use the mean and standard deviation as the distributional parameters, beta distributions take two non-intuitive parameters: (1) <span class="in">`shape1`</span> and (2) <span class="in">`shape2`</span>, often abbreviated as $a$ and $b$. <span class="co">[</span><span class="ot">This answer at Cross Validated</span><span class="co">](https://stats.stackexchange.com/a/47782/3025)</span> does an *excellent* job of explaining the intuition behind beta distributions and it'd be worth it to read it. Go do that—I'll wait.</span>
<span id="cb72-442"><a href="#cb72-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-443"><a href="#cb72-443" aria-hidden="true" tabindex="-1"></a>Basically beta distributions are good at modeling the probabilities of things, and <span class="in">`shape1`</span> and <span class="in">`shape2`</span> represent specific parts of a formula for probabilities and proportions.</span>
<span id="cb72-444"><a href="#cb72-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-445"><a href="#cb72-445" aria-hidden="true" tabindex="-1"></a>Let’s say that there’s an exam with 10 points where most people score a 6/10. Another way to think about this is that an exam is a collection of correct answers and incorrect answers, and that the percent correct follows this equation:</span>
<span id="cb72-446"><a href="#cb72-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-447"><a href="#cb72-447" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb72-448"><a href="#cb72-448" aria-hidden="true" tabindex="-1"></a>\frac{\text{Number correct}}{\text{Number correct} + \text{Number incorrect}}</span>
<span id="cb72-449"><a href="#cb72-449" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb72-450"><a href="#cb72-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-451"><a href="#cb72-451" aria-hidden="true" tabindex="-1"></a>If you scored a 6, you could write that as:</span>
<span id="cb72-452"><a href="#cb72-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-453"><a href="#cb72-453" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb72-454"><a href="#cb72-454" aria-hidden="true" tabindex="-1"></a>\frac{6}{6+4} = \frac{6}{10}</span>
<span id="cb72-455"><a href="#cb72-455" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb72-456"><a href="#cb72-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-457"><a href="#cb72-457" aria-hidden="true" tabindex="-1"></a>To make this formula more general, we can use variable names: $a$ for the number correct and $b$ for the number incorrect, leaving us with this:</span>
<span id="cb72-458"><a href="#cb72-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-459"><a href="#cb72-459" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb72-460"><a href="#cb72-460" aria-hidden="true" tabindex="-1"></a>\frac{a}{a + b}</span>
<span id="cb72-461"><a href="#cb72-461" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb72-462"><a href="#cb72-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-463"><a href="#cb72-463" aria-hidden="true" tabindex="-1"></a>In a beta distribution, the $a$ and the $b$ in that equation correspond to the <span class="in">`shape1`</span> and <span class="in">`shape2`</span> parameters. If we want to look at the distribution of scores for this test where most people get 6/10, or 60%, we can use 6 and 4 as parameters. Most people score around 60%, and the distribution isn't centered—it's asymmetric. Neat!</span>
<span id="cb72-464"><a href="#cb72-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-465"><a href="#cb72-465" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-dist-beta-6-4}</span></span>
<span id="cb72-466"><a href="#cb72-466" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb72-467"><a href="#cb72-467" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_function(fun = dbeta, args = list(shape1 = 6, shape2 = 4),</span></span>
<span id="cb72-468"><a href="#cb72-468" aria-hidden="true" tabindex="-1"></a><span class="in">                aes(color = "Beta(shape1 = 6, shape2 = 4)"),</span></span>
<span id="cb72-469"><a href="#cb72-469" aria-hidden="true" tabindex="-1"></a><span class="in">                size = 1) +</span></span>
<span id="cb72-470"><a href="#cb72-470" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_viridis_d(option = "plasma", name = "") +</span></span>
<span id="cb72-471"><a href="#cb72-471" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() +</span></span>
<span id="cb72-472"><a href="#cb72-472" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb72-473"><a href="#cb72-473" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-474"><a href="#cb72-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-475"><a href="#cb72-475" aria-hidden="true" tabindex="-1"></a>The magic of—and most confusing part about—beta distributions is that you can get all sorts of curves by just changing the shape parameters. To make this easier to see, we can make a bunch of different beta distributions.</span>
<span id="cb72-476"><a href="#cb72-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-477"><a href="#cb72-477" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-dist-beta-lots}</span></span>
<span id="cb72-478"><a href="#cb72-478" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb72-479"><a href="#cb72-479" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_function(fun = dbeta, args = list(shape1 = 6, shape2 = 4),</span></span>
<span id="cb72-480"><a href="#cb72-480" aria-hidden="true" tabindex="-1"></a><span class="in">                aes(color = "Beta(shape1 = 6, shape2 = 4)"),</span></span>
<span id="cb72-481"><a href="#cb72-481" aria-hidden="true" tabindex="-1"></a><span class="in">                size = 1) +</span></span>
<span id="cb72-482"><a href="#cb72-482" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_function(fun = dbeta, args = list(shape1 = 60, shape2 = 40),</span></span>
<span id="cb72-483"><a href="#cb72-483" aria-hidden="true" tabindex="-1"></a><span class="in">                aes(color = "Beta(shape1 = 60, shape2 = 40)"),</span></span>
<span id="cb72-484"><a href="#cb72-484" aria-hidden="true" tabindex="-1"></a><span class="in">                size = 1) +</span></span>
<span id="cb72-485"><a href="#cb72-485" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_function(fun = dbeta, args = list(shape1 = 9, shape2 = 1),</span></span>
<span id="cb72-486"><a href="#cb72-486" aria-hidden="true" tabindex="-1"></a><span class="in">                aes(color = "Beta(shape1 = 9, shape2 = 1)"),</span></span>
<span id="cb72-487"><a href="#cb72-487" aria-hidden="true" tabindex="-1"></a><span class="in">                size = 1) +</span></span>
<span id="cb72-488"><a href="#cb72-488" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_function(fun = dbeta, args = list(shape1 = 2, shape2 = 11),</span></span>
<span id="cb72-489"><a href="#cb72-489" aria-hidden="true" tabindex="-1"></a><span class="in">                aes(color = "Beta(shape1 = 2, shape2 = 11)"),</span></span>
<span id="cb72-490"><a href="#cb72-490" aria-hidden="true" tabindex="-1"></a><span class="in">                size = 1) +</span></span>
<span id="cb72-491"><a href="#cb72-491" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_viridis_d(option = "plasma", end = 0.8, name = "",</span></span>
<span id="cb72-492"><a href="#cb72-492" aria-hidden="true" tabindex="-1"></a><span class="in">                        guide = guide_legend(nrow = 2)) +</span></span>
<span id="cb72-493"><a href="#cb72-493" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() +</span></span>
<span id="cb72-494"><a href="#cb72-494" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb72-495"><a href="#cb72-495" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-496"><a href="#cb72-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-497"><a href="#cb72-497" aria-hidden="true" tabindex="-1"></a>To figure out the center of each of these distributions, think of the $\frac{a}{a+b}$ formula. For the blue distribution on the far left, for instance, it's $\frac{2}{2+11}$ or <span class="in">`r 2/(2+11)`</span>. The orange distribution on the far right is centered at $\frac{9}{9+1}$, or <span class="in">`r 9/(9+1)`</span>. The tall pink-ish distribution is centered at 0.6 ($\frac{60}{60+40}$), just like the $\frac{6}{6+4}$ distribution, but it's much narrower and less spread out. When working with these two shape parameters, you control the variance or spread of the distribution by scaling the values up or down.</span>
<span id="cb72-498"><a href="#cb72-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-499"><a href="#cb72-499" aria-hidden="true" tabindex="-1"></a><span class="fu">### Mean and precision instead of shapes</span></span>
<span id="cb72-500"><a href="#cb72-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-501"><a href="#cb72-501" aria-hidden="true" tabindex="-1"></a>But thinking about these shapes and manually doing the $\frac{a}{a+b}$ calculation in your head is hard! It's even harder to get a specific amount of spread. Most other distributions can be defined with a center and some amount of spread or variance, but with beta distributions you're stuck with these weirdly interacting shape parameters.</span>
<span id="cb72-502"><a href="#cb72-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-503"><a href="#cb72-503" aria-hidden="true" tabindex="-1"></a>Fortunately there's <span class="co">[</span><span class="ot">an alternative way</span><span class="co">](https://en.wikipedia.org/wiki/Beta_distribution#Alternative_parameterizations)</span> of parameterizing the beta distribution that uses a mean $\mu$ and precision $\phi$ (the same idea as variance) instead of these strange shapes.</span>
<span id="cb72-504"><a href="#cb72-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-505"><a href="#cb72-505" aria-hidden="true" tabindex="-1"></a>These shapes and the $\mu$ and $\phi$ parameters are mathematically related and interchangeable. Formally, the two shapes can be defined using $\mu$ and $\phi$ like so:</span>
<span id="cb72-506"><a href="#cb72-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-507"><a href="#cb72-507" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb72-508"><a href="#cb72-508" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb72-509"><a href="#cb72-509" aria-hidden="true" tabindex="-1"></a>\text{shape1 } (a) &amp;= \mu \times \phi <span class="sc">\\</span></span>
<span id="cb72-510"><a href="#cb72-510" aria-hidden="true" tabindex="-1"></a>\text{shape2 } (b) &amp;= (1 - \mu) \times \phi</span>
<span id="cb72-511"><a href="#cb72-511" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb72-512"><a href="#cb72-512" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb72-513"><a href="#cb72-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-514"><a href="#cb72-514" aria-hidden="true" tabindex="-1"></a>Based on this, we can do some algebra to figure out how to write $\mu$ and $\phi$ using $a$ and $b$:</span>
<span id="cb72-515"><a href="#cb72-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-516"><a href="#cb72-516" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb72-517"><a href="#cb72-517" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb72-518"><a href="#cb72-518" aria-hidden="true" tabindex="-1"></a>\begin{aligned}<span class="co">[</span><span class="ot">t</span><span class="co">]</span></span>
<span id="cb72-519"><a href="#cb72-519" aria-hidden="true" tabindex="-1"></a>&amp;\text{<span class="co">[</span><span class="ot">get } \phi \text{ alone</span><span class="co">]</span>} <span class="sc">\\</span></span>
<span id="cb72-520"><a href="#cb72-520" aria-hidden="true" tabindex="-1"></a>\mu \times \phi &amp;= a <span class="sc">\\</span></span>
<span id="cb72-521"><a href="#cb72-521" aria-hidden="true" tabindex="-1"></a>\phi &amp;= \frac{a}{\mu}</span>
<span id="cb72-522"><a href="#cb72-522" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb72-523"><a href="#cb72-523" aria-hidden="true" tabindex="-1"></a>\qquad</span>
<span id="cb72-524"><a href="#cb72-524" aria-hidden="true" tabindex="-1"></a>\begin{aligned}<span class="co">[</span><span class="ot">t</span><span class="co">]</span></span>
<span id="cb72-525"><a href="#cb72-525" aria-hidden="true" tabindex="-1"></a>&amp;\text{<span class="co">[</span><span class="ot">solve for } \mu \text{</span><span class="co">]</span>} <span class="sc">\\</span></span>
<span id="cb72-526"><a href="#cb72-526" aria-hidden="true" tabindex="-1"></a>b &amp;= (1 - \mu) \times \phi <span class="sc">\\</span></span>
<span id="cb72-527"><a href="#cb72-527" aria-hidden="true" tabindex="-1"></a>b &amp;= (1 - \mu) \times \frac{a}{\mu} <span class="sc">\\</span></span>
<span id="cb72-528"><a href="#cb72-528" aria-hidden="true" tabindex="-1"></a>b &amp;= \frac{a}{\mu} - \frac{a \mu}{\mu} <span class="sc">\\</span></span>
<span id="cb72-529"><a href="#cb72-529" aria-hidden="true" tabindex="-1"></a>b &amp;= \frac{a}{\mu} - a <span class="sc">\\</span></span>
<span id="cb72-530"><a href="#cb72-530" aria-hidden="true" tabindex="-1"></a>a + b &amp;= \frac{a}{\mu} <span class="sc">\\</span></span>
<span id="cb72-531"><a href="#cb72-531" aria-hidden="true" tabindex="-1"></a>\color{orange}{\mu} &amp;\color{orange}{= \frac{a}{a + b}}</span>
<span id="cb72-532"><a href="#cb72-532" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb72-533"><a href="#cb72-533" aria-hidden="true" tabindex="-1"></a>\qquad</span>
<span id="cb72-534"><a href="#cb72-534" aria-hidden="true" tabindex="-1"></a>\begin{aligned}<span class="co">[</span><span class="ot">t</span><span class="co">]</span></span>
<span id="cb72-535"><a href="#cb72-535" aria-hidden="true" tabindex="-1"></a>&amp;\text{<span class="co">[</span><span class="ot">solve for } \phi \text{</span><span class="co">]</span>} <span class="sc">\\</span></span>
<span id="cb72-536"><a href="#cb72-536" aria-hidden="true" tabindex="-1"></a>a &amp;= \mu \times \phi <span class="sc">\\</span></span>
<span id="cb72-537"><a href="#cb72-537" aria-hidden="true" tabindex="-1"></a>a &amp;= \left( \frac{a}{a + b} \right) \times \phi <span class="sc">\\</span></span>
<span id="cb72-538"><a href="#cb72-538" aria-hidden="true" tabindex="-1"></a>a &amp;= \frac{a \phi}{a + b} <span class="sc">\\</span></span>
<span id="cb72-539"><a href="#cb72-539" aria-hidden="true" tabindex="-1"></a>(a + b) a &amp;= a \phi <span class="sc">\\</span></span>
<span id="cb72-540"><a href="#cb72-540" aria-hidden="true" tabindex="-1"></a>a^2 + ba &amp;= a \phi <span class="sc">\\</span></span>
<span id="cb72-541"><a href="#cb72-541" aria-hidden="true" tabindex="-1"></a>\color{orange}{\phi} &amp;\color{orange}{= a + b}</span>
<span id="cb72-542"><a href="#cb72-542" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb72-543"><a href="#cb72-543" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb72-544"><a href="#cb72-544" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb72-545"><a href="#cb72-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-546"><a href="#cb72-546" aria-hidden="true" tabindex="-1"></a>It's thus possible to translate between these two parameterizations:</span>
<span id="cb72-547"><a href="#cb72-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-548"><a href="#cb72-548" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb72-549"><a href="#cb72-549" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb72-550"><a href="#cb72-550" aria-hidden="true" tabindex="-1"></a>\begin{aligned}<span class="co">[</span><span class="ot">t</span><span class="co">]</span></span>
<span id="cb72-551"><a href="#cb72-551" aria-hidden="true" tabindex="-1"></a>\text{Shape 1:} &amp;&amp; a &amp;= \mu \phi <span class="sc">\\</span></span>
<span id="cb72-552"><a href="#cb72-552" aria-hidden="true" tabindex="-1"></a>\text{Shape 2:} &amp;&amp; b &amp;= (1 - \mu) \phi</span>
<span id="cb72-553"><a href="#cb72-553" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb72-554"><a href="#cb72-554" aria-hidden="true" tabindex="-1"></a>\qquad\qquad\qquad</span>
<span id="cb72-555"><a href="#cb72-555" aria-hidden="true" tabindex="-1"></a>\begin{aligned}<span class="co">[</span><span class="ot">t</span><span class="co">]</span></span>
<span id="cb72-556"><a href="#cb72-556" aria-hidden="true" tabindex="-1"></a>\text{Mean:} &amp;&amp; \mu &amp;= \frac{a}{a + b} <span class="sc">\\</span></span>
<span id="cb72-557"><a href="#cb72-557" aria-hidden="true" tabindex="-1"></a>\text{Precision:} &amp;&amp; \phi &amp;= a + b</span>
<span id="cb72-558"><a href="#cb72-558" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb72-559"><a href="#cb72-559" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb72-560"><a href="#cb72-560" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb72-561"><a href="#cb72-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-562"><a href="#cb72-562" aria-hidden="true" tabindex="-1"></a>To help with the intuition, we can make a couple little functions to switch between them. </span>
<span id="cb72-563"><a href="#cb72-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-564"><a href="#cb72-564" aria-hidden="true" tabindex="-1"></a><span class="in">```{r funs-muphi}</span></span>
<span id="cb72-565"><a href="#cb72-565" aria-hidden="true" tabindex="-1"></a><span class="in">shapes_to_muphi &lt;- function(shape1, shape2) {</span></span>
<span id="cb72-566"><a href="#cb72-566" aria-hidden="true" tabindex="-1"></a><span class="in">  mu &lt;- shape1 / (shape1 + shape2)</span></span>
<span id="cb72-567"><a href="#cb72-567" aria-hidden="true" tabindex="-1"></a><span class="in">  phi &lt;- shape1 + shape2</span></span>
<span id="cb72-568"><a href="#cb72-568" aria-hidden="true" tabindex="-1"></a><span class="in">  return(list(mu = mu, phi = phi))</span></span>
<span id="cb72-569"><a href="#cb72-569" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb72-570"><a href="#cb72-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-571"><a href="#cb72-571" aria-hidden="true" tabindex="-1"></a><span class="in">muphi_to_shapes &lt;- function(mu, phi) {</span></span>
<span id="cb72-572"><a href="#cb72-572" aria-hidden="true" tabindex="-1"></a><span class="in">  shape1 &lt;- mu * phi</span></span>
<span id="cb72-573"><a href="#cb72-573" aria-hidden="true" tabindex="-1"></a><span class="in">  shape2 &lt;- (1 - mu) * phi</span></span>
<span id="cb72-574"><a href="#cb72-574" aria-hidden="true" tabindex="-1"></a><span class="in">  return(list(shape1 = shape1, shape2 = shape2))</span></span>
<span id="cb72-575"><a href="#cb72-575" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb72-576"><a href="#cb72-576" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-577"><a href="#cb72-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-578"><a href="#cb72-578" aria-hidden="true" tabindex="-1"></a>Remember our initial distribution where <span class="in">`shape1`</span> was 6 and <span class="in">`shape2`</span> was 4? Here's are the parameters for that using $\mu$ and $\phi$ instead:</span>
<span id="cb72-579"><a href="#cb72-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-580"><a href="#cb72-580" aria-hidden="true" tabindex="-1"></a><span class="in">```{r muphi-1}</span></span>
<span id="cb72-581"><a href="#cb72-581" aria-hidden="true" tabindex="-1"></a><span class="in">shapes_to_muphi(6, 4)</span></span>
<span id="cb72-582"><a href="#cb72-582" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-583"><a href="#cb72-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-584"><a href="#cb72-584" aria-hidden="true" tabindex="-1"></a>It has a mean of 0.6 and a precision of 10. That more precise and taller distribution where <span class="in">`shape1`</span> was 60 and <span class="in">`shape2`</span> was 40?</span>
<span id="cb72-585"><a href="#cb72-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-586"><a href="#cb72-586" aria-hidden="true" tabindex="-1"></a><span class="in">```{r muphi-2}</span></span>
<span id="cb72-587"><a href="#cb72-587" aria-hidden="true" tabindex="-1"></a><span class="in">shapes_to_muphi(60, 40)</span></span>
<span id="cb72-588"><a href="#cb72-588" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-589"><a href="#cb72-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-590"><a href="#cb72-590" aria-hidden="true" tabindex="-1"></a>It has the same mean of 0.6, but a much higher precision (100 now instead of 10).</span>
<span id="cb72-591"><a href="#cb72-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-592"><a href="#cb72-592" aria-hidden="true" tabindex="-1"></a>R has built-in support for the shape-based beta distribution with things like <span class="in">`dbeta()`</span>, <span class="in">`rbeta()`</span>, etc. We can work with this reparameterized $\mu$- and $\phi$-based beta distribution using the <span class="in">`dprop()`</span> (and <span class="in">`rprop()`</span>, etc.) from the **extraDistr** package. It takes two arguments: <span class="in">`size`</span> for $\phi$ and <span class="in">`mean`</span> for $\mu$.</span>
<span id="cb72-593"><a href="#cb72-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-594"><a href="#cb72-594" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-dist-beta-lots-dprop, fig.width=8, out.width="100%"}</span></span>
<span id="cb72-595"><a href="#cb72-595" aria-hidden="true" tabindex="-1"></a><span class="in">#| column: page-inset-right</span></span>
<span id="cb72-596"><a href="#cb72-596" aria-hidden="true" tabindex="-1"></a><span class="in">beta_shapes &lt;- ggplot() +</span></span>
<span id="cb72-597"><a href="#cb72-597" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_function(fun = dbeta, args = list(shape1 = 6, shape2 = 4),</span></span>
<span id="cb72-598"><a href="#cb72-598" aria-hidden="true" tabindex="-1"></a><span class="in">                aes(color = "dbeta(shape1 = 6, shape2 = 4)"),</span></span>
<span id="cb72-599"><a href="#cb72-599" aria-hidden="true" tabindex="-1"></a><span class="in">                size = 1) +</span></span>
<span id="cb72-600"><a href="#cb72-600" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_function(fun = dbeta, args = list(shape1 = 60, shape2 = 40),</span></span>
<span id="cb72-601"><a href="#cb72-601" aria-hidden="true" tabindex="-1"></a><span class="in">                aes(color = "dbeta(shape1 = 60, shape2 = 40)"),</span></span>
<span id="cb72-602"><a href="#cb72-602" aria-hidden="true" tabindex="-1"></a><span class="in">                size = 1) +</span></span>
<span id="cb72-603"><a href="#cb72-603" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_function(fun = dbeta, args = list(shape1 = 9, shape2 = 1),</span></span>
<span id="cb72-604"><a href="#cb72-604" aria-hidden="true" tabindex="-1"></a><span class="in">                aes(color = "dbeta(shape1 = 9, shape2 = 1)"),</span></span>
<span id="cb72-605"><a href="#cb72-605" aria-hidden="true" tabindex="-1"></a><span class="in">                size = 1) +</span></span>
<span id="cb72-606"><a href="#cb72-606" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_function(fun = dbeta, args = list(shape1 = 2, shape2 = 11),</span></span>
<span id="cb72-607"><a href="#cb72-607" aria-hidden="true" tabindex="-1"></a><span class="in">                aes(color = "dbeta(shape1 = 2, shape2 = 11)"),</span></span>
<span id="cb72-608"><a href="#cb72-608" aria-hidden="true" tabindex="-1"></a><span class="in">                size = 1) +</span></span>
<span id="cb72-609"><a href="#cb72-609" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_viridis_d(option = "plasma", end = 0.8, name = "",</span></span>
<span id="cb72-610"><a href="#cb72-610" aria-hidden="true" tabindex="-1"></a><span class="in">                        guide = guide_legend(ncol = 1)) +</span></span>
<span id="cb72-611"><a href="#cb72-611" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Shape-based beta distributions") +</span></span>
<span id="cb72-612"><a href="#cb72-612" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() +</span></span>
<span id="cb72-613"><a href="#cb72-613" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb72-614"><a href="#cb72-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-615"><a href="#cb72-615" aria-hidden="true" tabindex="-1"></a><span class="in">beta_mu_phi &lt;- ggplot() +</span></span>
<span id="cb72-616"><a href="#cb72-616" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_function(fun = dprop, args = list(mean = 0.6, size = 10),</span></span>
<span id="cb72-617"><a href="#cb72-617" aria-hidden="true" tabindex="-1"></a><span class="in">                aes(color = "dprop(mean = 0.6, size = 10)"),</span></span>
<span id="cb72-618"><a href="#cb72-618" aria-hidden="true" tabindex="-1"></a><span class="in">                size = 1) +</span></span>
<span id="cb72-619"><a href="#cb72-619" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_function(fun = dprop, args = list(mean = 0.6, size = 100),</span></span>
<span id="cb72-620"><a href="#cb72-620" aria-hidden="true" tabindex="-1"></a><span class="in">                aes(color = "dprop(mean = 0.6, size = 100)"),</span></span>
<span id="cb72-621"><a href="#cb72-621" aria-hidden="true" tabindex="-1"></a><span class="in">                size = 1) +</span></span>
<span id="cb72-622"><a href="#cb72-622" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_function(fun = dprop, args = list(mean = 0.9, size = 10),</span></span>
<span id="cb72-623"><a href="#cb72-623" aria-hidden="true" tabindex="-1"></a><span class="in">                aes(color = "dprop(mean = 0.9, size = 10)"),</span></span>
<span id="cb72-624"><a href="#cb72-624" aria-hidden="true" tabindex="-1"></a><span class="in">                size = 1) +</span></span>
<span id="cb72-625"><a href="#cb72-625" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_function(fun = dprop, args = list(mean = 0.154, size = 13),</span></span>
<span id="cb72-626"><a href="#cb72-626" aria-hidden="true" tabindex="-1"></a><span class="in">                aes(color = "dprop(mean = 0.154, size = 13)"),</span></span>
<span id="cb72-627"><a href="#cb72-627" aria-hidden="true" tabindex="-1"></a><span class="in">                size = 1) +</span></span>
<span id="cb72-628"><a href="#cb72-628" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_viridis_d(option = "plasma", end = 0.8, name = "",</span></span>
<span id="cb72-629"><a href="#cb72-629" aria-hidden="true" tabindex="-1"></a><span class="in">                        guide = guide_legend(ncol = 1)) +</span></span>
<span id="cb72-630"><a href="#cb72-630" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Mean- and precision-based beta distributions") +</span></span>
<span id="cb72-631"><a href="#cb72-631" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() +</span></span>
<span id="cb72-632"><a href="#cb72-632" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb72-633"><a href="#cb72-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-634"><a href="#cb72-634" aria-hidden="true" tabindex="-1"></a><span class="in">beta_shapes | beta_mu_phi</span></span>
<span id="cb72-635"><a href="#cb72-635" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-636"><a href="#cb72-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-637"><a href="#cb72-637" aria-hidden="true" tabindex="-1"></a>Phew. That's a lot of background to basically say that you don't have to think about the shape parameters for beta distributions—you can think of mean ($\mu$) and precision ($\phi$) instead, just like you do with a normal distribution and its mean and standard deviation.</span>
<span id="cb72-638"><a href="#cb72-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-639"><a href="#cb72-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-640"><a href="#cb72-640" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3a: Beta regression</span></span>
<span id="cb72-641"><a href="#cb72-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-642"><a href="#cb72-642" aria-hidden="true" tabindex="-1"></a>So, with that quick background on how beta distributions work, we can now explore how beta regression lets us model outcomes that range between 0 and 1. Again, beta regression is a *distributional* regression, which means we're ultimately modeling $\mu$ and $\phi$ and not just a slope and intercept. With this regression, we'll be able to fit separate models for both parameters and see how the overall distribution shifts based on different covariates.</span>
<span id="cb72-643"><a href="#cb72-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-644"><a href="#cb72-644" aria-hidden="true" tabindex="-1"></a>The <span class="co">[</span><span class="ot">**betareg** package</span><span class="co">](https://cran.r-project.org/web/packages/betareg/index.html)</span> provides the <span class="in">`betareg()`</span> function for doing frequentist beta regression. For the sake of simplicity, we'll just look at <span class="in">`prop_fem ~ quota`</span> and ignore polyarchy for a bit. </span>
<span id="cb72-645"><a href="#cb72-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-646"><a href="#cb72-646" aria-hidden="true" tabindex="-1"></a>The syntax is just like all other formula-based regression functions, but with an added bit: the first part of the equation (<span class="in">`prop_fem ~ quota`</span>) models the mean, or $\mu$, while anything that comes after a <span class="in">`|`</span> in the formula will explain variation in the precision, or $\phi$.</span>
<span id="cb72-647"><a href="#cb72-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-648"><a href="#cb72-648" aria-hidden="true" tabindex="-1"></a>Let's try it out!</span>
<span id="cb72-649"><a href="#cb72-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-650"><a href="#cb72-650" aria-hidden="true" tabindex="-1"></a><span class="in">```{r model-betareg-bad, error=TRUE}</span></span>
<span id="cb72-651"><a href="#cb72-651" aria-hidden="true" tabindex="-1"></a><span class="in">model_beta &lt;- betareg(prop_fem ~ quota | quota, </span></span>
<span id="cb72-652"><a href="#cb72-652" aria-hidden="true" tabindex="-1"></a><span class="in">                      data = vdem_2015, </span></span>
<span id="cb72-653"><a href="#cb72-653" aria-hidden="true" tabindex="-1"></a><span class="in">                      link = "logit")</span></span>
<span id="cb72-654"><a href="#cb72-654" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-655"><a href="#cb72-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-656"><a href="#cb72-656" aria-hidden="true" tabindex="-1"></a>Oh no! We have an error. Beta regression can *only* handle outcome values that range between 0 and 1—it **cannot** deal with values that are exactly 0 or exactly 1. </span>
<span id="cb72-657"><a href="#cb72-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-658"><a href="#cb72-658" aria-hidden="true" tabindex="-1"></a>We'll show how to deal with 0s and 1s later. For now we can do some trickery and add 0.001 to all the 0s so that they're not actually 0. This is cheating, but it's fine for now :)</span>
<span id="cb72-659"><a href="#cb72-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-660"><a href="#cb72-660" aria-hidden="true" tabindex="-1"></a><span class="in">```{r model-betareg-good}</span></span>
<span id="cb72-661"><a href="#cb72-661" aria-hidden="true" tabindex="-1"></a><span class="in">vdem_2015_fake0 &lt;- vdem_2015 %&gt;% </span></span>
<span id="cb72-662"><a href="#cb72-662" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(prop_fem = ifelse(prop_fem == 0, 0.001, prop_fem))</span></span>
<span id="cb72-663"><a href="#cb72-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-664"><a href="#cb72-664" aria-hidden="true" tabindex="-1"></a><span class="in">model_beta &lt;- betareg(prop_fem ~ quota | quota, </span></span>
<span id="cb72-665"><a href="#cb72-665" aria-hidden="true" tabindex="-1"></a><span class="in">                      data = vdem_2015_fake0, </span></span>
<span id="cb72-666"><a href="#cb72-666" aria-hidden="true" tabindex="-1"></a><span class="in">                      link = "logit")</span></span>
<span id="cb72-667"><a href="#cb72-667" aria-hidden="true" tabindex="-1"></a><span class="in">tidy(model_beta)</span></span>
<span id="cb72-668"><a href="#cb72-668" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-669"><a href="#cb72-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-670"><a href="#cb72-670" aria-hidden="true" tabindex="-1"></a><span class="fu">### Interpreting coefficients</span></span>
<span id="cb72-671"><a href="#cb72-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-672"><a href="#cb72-672" aria-hidden="true" tabindex="-1"></a>We now have two sets of coefficients, one set for each parameter (the mean and precision). The parameters for the mean are measured on the logit scale, just like with logistic regression previously, and we can calculate the marginal effect of having a quota by using <span class="in">`plogis()`</span> and piecing together the coefficient and the intercept:</span>
<span id="cb72-673"><a href="#cb72-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-674"><a href="#cb72-674" aria-hidden="true" tabindex="-1"></a><span class="in">```{r calc-quota-effect-plogis}</span></span>
<span id="cb72-675"><a href="#cb72-675" aria-hidden="true" tabindex="-1"></a><span class="in">beta_mu_intercept &lt;- model_beta %&gt;% </span></span>
<span id="cb72-676"><a href="#cb72-676" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy() %&gt;% </span></span>
<span id="cb72-677"><a href="#cb72-677" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(component == "mean", term == "(Intercept)") %&gt;% </span></span>
<span id="cb72-678"><a href="#cb72-678" aria-hidden="true" tabindex="-1"></a><span class="in">  pull(estimate)</span></span>
<span id="cb72-679"><a href="#cb72-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-680"><a href="#cb72-680" aria-hidden="true" tabindex="-1"></a><span class="in">beta_mu_quota &lt;- model_beta %&gt;% </span></span>
<span id="cb72-681"><a href="#cb72-681" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy() %&gt;% </span></span>
<span id="cb72-682"><a href="#cb72-682" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(component == "mean", term == "quotaTRUE") %&gt;% </span></span>
<span id="cb72-683"><a href="#cb72-683" aria-hidden="true" tabindex="-1"></a><span class="in">  pull(estimate)</span></span>
<span id="cb72-684"><a href="#cb72-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-685"><a href="#cb72-685" aria-hidden="true" tabindex="-1"></a><span class="in">plogis(beta_mu_intercept + beta_mu_quota) - plogis(beta_mu_intercept)</span></span>
<span id="cb72-686"><a href="#cb72-686" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-687"><a href="#cb72-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-688"><a href="#cb72-688" aria-hidden="true" tabindex="-1"></a>Having a quota thus increases the average of the distribution of women MPs by <span class="in">`r (plogis(beta_mu_intercept + beta_mu_quota) - plogis(beta_mu_intercept)) * 100`</span> percentage points, on average. That's the same value that we found with OLS and with fractional logistic regression!</span>
<span id="cb72-689"><a href="#cb72-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-690"><a href="#cb72-690" aria-hidden="true" tabindex="-1"></a><span class="fu">### Working with the precision parameter</span></span>
<span id="cb72-691"><a href="#cb72-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-692"><a href="#cb72-692" aria-hidden="true" tabindex="-1"></a>But what about those precision parameters—what can we do with those? For mathy reasons, these are not measured on a logit scale. Instead, they're logged values. We can invert them by exponentiating them with <span class="in">`exp()`</span>. </span>
<span id="cb72-693"><a href="#cb72-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-694"><a href="#cb72-694" aria-hidden="true" tabindex="-1"></a>The phi intercept represents the precision of the distribution of the proportion of women MPs in countries without a quota, while the phi coefficient for quota represents the change in that precision when <span class="in">`quota`</span> is <span class="in">`TRUE`</span>. That means we have all the parameters to draw two different distributions of our outcome, split by whether countries have quotas. Let's plot these two predicted distributions on top of the true underlying data and see how well they fit:</span>
<span id="cb72-695"><a href="#cb72-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-696"><a href="#cb72-696" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-dist-beta-shifted}</span></span>
<span id="cb72-697"><a href="#cb72-697" aria-hidden="true" tabindex="-1"></a><span class="in">beta_phi_intercept &lt;- model_beta %&gt;% </span></span>
<span id="cb72-698"><a href="#cb72-698" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy() %&gt;% </span></span>
<span id="cb72-699"><a href="#cb72-699" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(component == "precision", term == "(Intercept)") %&gt;% </span></span>
<span id="cb72-700"><a href="#cb72-700" aria-hidden="true" tabindex="-1"></a><span class="in">  pull(estimate)</span></span>
<span id="cb72-701"><a href="#cb72-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-702"><a href="#cb72-702" aria-hidden="true" tabindex="-1"></a><span class="in">beta_phi_quota &lt;- model_beta %&gt;% </span></span>
<span id="cb72-703"><a href="#cb72-703" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy() %&gt;% </span></span>
<span id="cb72-704"><a href="#cb72-704" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(component == "precision", term == "quotaTRUE") %&gt;% </span></span>
<span id="cb72-705"><a href="#cb72-705" aria-hidden="true" tabindex="-1"></a><span class="in">  pull(estimate)</span></span>
<span id="cb72-706"><a href="#cb72-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-707"><a href="#cb72-707" aria-hidden="true" tabindex="-1"></a><span class="in">no_quota_title &lt;- paste0("dprop(mean = plogis(", round(beta_mu_intercept, 2),</span></span>
<span id="cb72-708"><a href="#cb72-708" aria-hidden="true" tabindex="-1"></a><span class="in">                         "), size = exp(", round(beta_phi_intercept, 2), "))")</span></span>
<span id="cb72-709"><a href="#cb72-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-710"><a href="#cb72-710" aria-hidden="true" tabindex="-1"></a><span class="in">quota_title &lt;- paste0("dprop(mean = plogis(", round(beta_mu_intercept, 2),</span></span>
<span id="cb72-711"><a href="#cb72-711" aria-hidden="true" tabindex="-1"></a><span class="in">                      " + ", round(beta_mu_quota, 2), </span></span>
<span id="cb72-712"><a href="#cb72-712" aria-hidden="true" tabindex="-1"></a><span class="in">                      "), size = exp(", round(beta_phi_intercept, 2),</span></span>
<span id="cb72-713"><a href="#cb72-713" aria-hidden="true" tabindex="-1"></a><span class="in">                      " + ", round(beta_phi_quota, 2), "))")</span></span>
<span id="cb72-714"><a href="#cb72-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-715"><a href="#cb72-715" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = tibble(x = 0:1), aes(x = x)) +</span></span>
<span id="cb72-716"><a href="#cb72-716" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_density(data = vdem_2015_fake0, </span></span>
<span id="cb72-717"><a href="#cb72-717" aria-hidden="true" tabindex="-1"></a><span class="in">               aes(x = prop_fem, fill = quota), alpha = 0.5, color = NA) +</span></span>
<span id="cb72-718"><a href="#cb72-718" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_function(fun = dprop, size = 1,</span></span>
<span id="cb72-719"><a href="#cb72-719" aria-hidden="true" tabindex="-1"></a><span class="in">                args = list(size = exp(beta_phi_intercept), </span></span>
<span id="cb72-720"><a href="#cb72-720" aria-hidden="true" tabindex="-1"></a><span class="in">                            mean = plogis(beta_mu_intercept)),</span></span>
<span id="cb72-721"><a href="#cb72-721" aria-hidden="true" tabindex="-1"></a><span class="in">                aes(color = no_quota_title)) +</span></span>
<span id="cb72-722"><a href="#cb72-722" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_function(fun = dprop, size = 1,</span></span>
<span id="cb72-723"><a href="#cb72-723" aria-hidden="true" tabindex="-1"></a><span class="in">                args = list(size = exp(beta_phi_intercept + beta_phi_quota), </span></span>
<span id="cb72-724"><a href="#cb72-724" aria-hidden="true" tabindex="-1"></a><span class="in">                            mean = plogis(beta_mu_intercept + beta_mu_quota)),</span></span>
<span id="cb72-725"><a href="#cb72-725" aria-hidden="true" tabindex="-1"></a><span class="in">                aes(color = quota_title)) +</span></span>
<span id="cb72-726"><a href="#cb72-726" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_percent()) +</span></span>
<span id="cb72-727"><a href="#cb72-727" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_viridis_d(option = "plasma", end = 0.8, name = "Quota",</span></span>
<span id="cb72-728"><a href="#cb72-728" aria-hidden="true" tabindex="-1"></a><span class="in">                       guide = guide_legend(ncol = 1, order = 1)) +</span></span>
<span id="cb72-729"><a href="#cb72-729" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_viridis_d(option = "plasma", end = 0.8, direction = -1, name = "",</span></span>
<span id="cb72-730"><a href="#cb72-730" aria-hidden="true" tabindex="-1"></a><span class="in">                        guide = guide_legend(reverse = TRUE, ncol = 1, order = 2)) +</span></span>
<span id="cb72-731"><a href="#cb72-731" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Proportion of women in parliament") +</span></span>
<span id="cb72-732"><a href="#cb72-732" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() +</span></span>
<span id="cb72-733"><a href="#cb72-733" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb72-734"><a href="#cb72-734" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-735"><a href="#cb72-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-736"><a href="#cb72-736" aria-hidden="true" tabindex="-1"></a>Note how the whole distribution changes when there's a quota. The mean doesn't just shift rightward—the precision of the distribution changes too and the distribution where quota is <span class="in">`TRUE`</span> has a whole new shape. The model actually captures it really well too! Look at how closely the predicted orange line aligns with the the underlying data. The blue predicted line is a little off, but that's likely due to the 0s that we cheated with.</span>
<span id="cb72-737"><a href="#cb72-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-738"><a href="#cb72-738" aria-hidden="true" tabindex="-1"></a>You don't have to model the $\phi$ if you don't want to. A model like this will work just fine too: </span>
<span id="cb72-739"><a href="#cb72-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-740"><a href="#cb72-740" aria-hidden="true" tabindex="-1"></a><span class="in">```{r model-beta-no-phi}</span></span>
<span id="cb72-741"><a href="#cb72-741" aria-hidden="true" tabindex="-1"></a><span class="in">model_beta_no_phi &lt;- betareg(prop_fem ~ quota, </span></span>
<span id="cb72-742"><a href="#cb72-742" aria-hidden="true" tabindex="-1"></a><span class="in">                             data = vdem_2015_fake0, </span></span>
<span id="cb72-743"><a href="#cb72-743" aria-hidden="true" tabindex="-1"></a><span class="in">                             link = "logit")</span></span>
<span id="cb72-744"><a href="#cb72-744" aria-hidden="true" tabindex="-1"></a><span class="in">tidy(model_beta_no_phi)</span></span>
<span id="cb72-745"><a href="#cb72-745" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-746"><a href="#cb72-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-747"><a href="#cb72-747" aria-hidden="true" tabindex="-1"></a>In this case, you still get a precision component, but it's universal across all the different coefficients—it doesn't vary across <span class="in">`quota`</span> (or any other variables, had we included any others in the model). Also, for whatever mathy reasons, when you *don't* explicitly model the precision, the resulting coefficient in the table isn't on the log scale—it's a regular non-logged number, so there's no need to exponentiate. We can plot the two distributions like before. The mean part is all the same! The only difference now is that phi is constant across the two groups</span>
<span id="cb72-748"><a href="#cb72-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-749"><a href="#cb72-749" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-dist-beta-shifted-no-phi}</span></span>
<span id="cb72-750"><a href="#cb72-750" aria-hidden="true" tabindex="-1"></a><span class="in">beta_phi &lt;- model_beta_no_phi %&gt;% </span></span>
<span id="cb72-751"><a href="#cb72-751" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy() %&gt;% </span></span>
<span id="cb72-752"><a href="#cb72-752" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(component == "precision") %&gt;% </span></span>
<span id="cb72-753"><a href="#cb72-753" aria-hidden="true" tabindex="-1"></a><span class="in">  pull(estimate)</span></span>
<span id="cb72-754"><a href="#cb72-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-755"><a href="#cb72-755" aria-hidden="true" tabindex="-1"></a><span class="in">no_quota_title &lt;- paste0("dprop(mean = plogis(", round(beta_mu_intercept, 2),</span></span>
<span id="cb72-756"><a href="#cb72-756" aria-hidden="true" tabindex="-1"></a><span class="in">                         "), size = ", round(beta_phi, 2), ")")</span></span>
<span id="cb72-757"><a href="#cb72-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-758"><a href="#cb72-758" aria-hidden="true" tabindex="-1"></a><span class="in">quota_title &lt;- paste0("dprop(mean = plogis(", round(beta_mu_intercept, 2),</span></span>
<span id="cb72-759"><a href="#cb72-759" aria-hidden="true" tabindex="-1"></a><span class="in">                      " + ", round(beta_mu_quota, 2), </span></span>
<span id="cb72-760"><a href="#cb72-760" aria-hidden="true" tabindex="-1"></a><span class="in">                      "), size = ", round(beta_phi, 2), ")")</span></span>
<span id="cb72-761"><a href="#cb72-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-762"><a href="#cb72-762" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = tibble(x = 0:1), aes(x = x)) +</span></span>
<span id="cb72-763"><a href="#cb72-763" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_density(data = vdem_2015_fake0, </span></span>
<span id="cb72-764"><a href="#cb72-764" aria-hidden="true" tabindex="-1"></a><span class="in">               aes(x = prop_fem, fill = quota), alpha = 0.5, color = NA) +</span></span>
<span id="cb72-765"><a href="#cb72-765" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_function(fun = dprop, size = 1,</span></span>
<span id="cb72-766"><a href="#cb72-766" aria-hidden="true" tabindex="-1"></a><span class="in">                args = list(size = beta_phi, </span></span>
<span id="cb72-767"><a href="#cb72-767" aria-hidden="true" tabindex="-1"></a><span class="in">                            mean = plogis(beta_mu_intercept)),</span></span>
<span id="cb72-768"><a href="#cb72-768" aria-hidden="true" tabindex="-1"></a><span class="in">                aes(color = no_quota_title)) +</span></span>
<span id="cb72-769"><a href="#cb72-769" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_function(fun = dprop, size = 1,</span></span>
<span id="cb72-770"><a href="#cb72-770" aria-hidden="true" tabindex="-1"></a><span class="in">                args = list(size = beta_phi, </span></span>
<span id="cb72-771"><a href="#cb72-771" aria-hidden="true" tabindex="-1"></a><span class="in">                            mean = plogis(beta_mu_intercept + beta_mu_quota)),</span></span>
<span id="cb72-772"><a href="#cb72-772" aria-hidden="true" tabindex="-1"></a><span class="in">                aes(color = quota_title)) +</span></span>
<span id="cb72-773"><a href="#cb72-773" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_percent()) +</span></span>
<span id="cb72-774"><a href="#cb72-774" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_viridis_d(option = "plasma", end = 0.8, name = "Quota",</span></span>
<span id="cb72-775"><a href="#cb72-775" aria-hidden="true" tabindex="-1"></a><span class="in">                       guide = guide_legend(ncol = 1, order = 1)) +</span></span>
<span id="cb72-776"><a href="#cb72-776" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_viridis_d(option = "plasma", end = 0.8, direction = -1, name = "",</span></span>
<span id="cb72-777"><a href="#cb72-777" aria-hidden="true" tabindex="-1"></a><span class="in">                        guide = guide_legend(reverse = TRUE, ncol = 1, order = 2)) +</span></span>
<span id="cb72-778"><a href="#cb72-778" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Proportion of women in parliament") +</span></span>
<span id="cb72-779"><a href="#cb72-779" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() +</span></span>
<span id="cb72-780"><a href="#cb72-780" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb72-781"><a href="#cb72-781" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-782"><a href="#cb72-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-783"><a href="#cb72-783" aria-hidden="true" tabindex="-1"></a>Again, the means are the same, so the average difference between having a quota and not having a quota is the same, but because the precision is constant, the distributions don't fit the data as well.</span>
<span id="cb72-784"><a href="#cb72-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-785"><a href="#cb72-785" aria-hidden="true" tabindex="-1"></a><span class="fu">### Average marginal effects</span></span>
<span id="cb72-786"><a href="#cb72-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-787"><a href="#cb72-787" aria-hidden="true" tabindex="-1"></a>Because beta regression coefficients are all in logit units (with the exception of the $\phi$ part), we can interpret their marginal effects just like we did with logistic regression. It's tricky to piece together all the different parts and feed them through <span class="in">`plogis()`</span>, so it's best to calculate the slope with hypothetical data as before.</span>
<span id="cb72-788"><a href="#cb72-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-789"><a href="#cb72-789" aria-hidden="true" tabindex="-1"></a><span class="in">```{r mfx-betareg}</span></span>
<span id="cb72-790"><a href="#cb72-790" aria-hidden="true" tabindex="-1"></a><span class="in">avg_slopes(model_beta,</span></span>
<span id="cb72-791"><a href="#cb72-791" aria-hidden="true" tabindex="-1"></a><span class="in">           newdata = datagrid(quota = c(FALSE, TRUE)))</span></span>
<span id="cb72-792"><a href="#cb72-792" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-793"><a href="#cb72-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-794"><a href="#cb72-794" aria-hidden="true" tabindex="-1"></a>After incorporating all the moving parts of the model, we find that having a quota is associated with an increase of <span class="in">`r avg_slopes(model_beta, newdata = datagrid(quota = c(FALSE, TRUE)))$estimate * 100`</span> percentage points of the proportion of women MPs, on average, which is what we found earlier by piecing together the intercept and coefficient. If we had more covariates, this <span class="in">`avg_slopes()`</span> approach would be necessary, since it's tricky to incorporate all the different model pieces by hand.</span>
<span id="cb72-795"><a href="#cb72-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-796"><a href="#cb72-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-797"><a href="#cb72-797" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3b: Beta regression, Bayesian style</span></span>
<span id="cb72-798"><a href="#cb72-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-799"><a href="#cb72-799" aria-hidden="true" tabindex="-1"></a>Uncertainty is wonderful. We're working with distributions already with distributional regression like beta regression—it would be great if we could quantify and model our uncertainty directly and treat all the parameters as distributions.</span>
<span id="cb72-800"><a href="#cb72-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-801"><a href="#cb72-801" aria-hidden="true" tabindex="-1"></a>Fortunately Bayesian regression lets us do just that. We can generate thousands of plausible estimates based on the combination of our prior beliefs and the likelihood of the data, and then we can explore the uncertainty and the distributions of all those estimates.</span>
<span id="cb72-802"><a href="#cb72-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-803"><a href="#cb72-803" aria-hidden="true" tabindex="-1"></a>We'll also get to interpret the results Bayesianly. <span class="co">[</span><span class="ot">Goodbye confidence intervals; hello credible intervals.</span><span class="co">](https://evalf21.classes.andrewheiss.com/resource/bayes/#confidence-intervals-vs-credible-intervals)</span></span>
<span id="cb72-804"><a href="#cb72-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-805"><a href="#cb72-805" aria-hidden="true" tabindex="-1"></a>The <span class="co">[</span><span class="ot">incredible **brms** package</span><span class="co">](https://paul-buerkner.github.io/brms/)</span> has built-in support for beta regression. I won't go into details here about how to use **brms**—there are all sorts of tutorials and examples online for that (<span class="co">[</span><span class="ot">here's a quick basic one</span><span class="co">](https://evalf21.classes.andrewheiss.com/resource/bayes/#super-short-example)</span>). </span>
<span id="cb72-806"><a href="#cb72-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-807"><a href="#cb72-807" aria-hidden="true" tabindex="-1"></a>Let's recreate the model we made with <span class="in">`betareg()`</span> earlier, but now with a Bayesian flavor. The formula syntax is a little different with **brms**. Instead of using <span class="in">`|`</span> to divide the $\mu$ part from the $\phi$ part, we specify two separate formulas: one for <span class="in">`prop_fem`</span> for the $\mu$ part, and one for <span class="in">`phi`</span> for the $\phi$ part. We'll use the default priors here (but in real life, you'd want to set them to something sensible), and we'll generate 2,000 Monte Carlo Markov Chain (MCMC) samples across 4 chains.</span>
<span id="cb72-808"><a href="#cb72-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-809"><a href="#cb72-809" aria-hidden="true" tabindex="-1"></a><span class="in">```{r model-bayes-beta-basic, results="hide"}</span></span>
<span id="cb72-810"><a href="#cb72-810" aria-hidden="true" tabindex="-1"></a><span class="in">model_beta_bayes &lt;- brm(</span></span>
<span id="cb72-811"><a href="#cb72-811" aria-hidden="true" tabindex="-1"></a><span class="in">  bf(prop_fem ~ quota,</span></span>
<span id="cb72-812"><a href="#cb72-812" aria-hidden="true" tabindex="-1"></a><span class="in">     phi ~ quota),</span></span>
<span id="cb72-813"><a href="#cb72-813" aria-hidden="true" tabindex="-1"></a><span class="in">  data = vdem_2015_fake0,</span></span>
<span id="cb72-814"><a href="#cb72-814" aria-hidden="true" tabindex="-1"></a><span class="in">  family = Beta(),</span></span>
<span id="cb72-815"><a href="#cb72-815" aria-hidden="true" tabindex="-1"></a><span class="in">  chains = 4, iter = 2000, warmup = 1000,</span></span>
<span id="cb72-816"><a href="#cb72-816" aria-hidden="true" tabindex="-1"></a><span class="in">  cores = 4, seed = 1234, </span></span>
<span id="cb72-817"><a href="#cb72-817" aria-hidden="true" tabindex="-1"></a><span class="in">  # Use the cmdstanr backend for Stan because it's faster and more modern than</span></span>
<span id="cb72-818"><a href="#cb72-818" aria-hidden="true" tabindex="-1"></a><span class="in">  # the default rstan You need to install the cmdstanr package first</span></span>
<span id="cb72-819"><a href="#cb72-819" aria-hidden="true" tabindex="-1"></a><span class="in">  # (https://mc-stan.org/cmdstanr/) and then run cmdstanr::install_cmdstan() to</span></span>
<span id="cb72-820"><a href="#cb72-820" aria-hidden="true" tabindex="-1"></a><span class="in">  # install cmdstan on your computer.</span></span>
<span id="cb72-821"><a href="#cb72-821" aria-hidden="true" tabindex="-1"></a><span class="in">  backend = "cmdstanr",</span></span>
<span id="cb72-822"><a href="#cb72-822" aria-hidden="true" tabindex="-1"></a><span class="in">  file = "model_beta_bayes"  # Save this so it doesn't have to always rerun</span></span>
<span id="cb72-823"><a href="#cb72-823" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb72-824"><a href="#cb72-824" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-825"><a href="#cb72-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-826"><a href="#cb72-826" aria-hidden="true" tabindex="-1"></a>Check out the results—they're basically the same that we found with <span class="in">`betareg()`</span> in <span class="in">`model_beta`</span>.</span>
<span id="cb72-827"><a href="#cb72-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-828"><a href="#cb72-828" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tidy-bayes-basic, warning=FALSE}</span></span>
<span id="cb72-829"><a href="#cb72-829" aria-hidden="true" tabindex="-1"></a><span class="in">tidy(model_beta_bayes, effects = "fixed")</span></span>
<span id="cb72-830"><a href="#cb72-830" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-831"><a href="#cb72-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-832"><a href="#cb72-832" aria-hidden="true" tabindex="-1"></a><span class="fu">### Working with the posterior</span></span>
<span id="cb72-833"><a href="#cb72-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-834"><a href="#cb72-834" aria-hidden="true" tabindex="-1"></a>The estimates are the same, but richer—we have a complete posterior distribution for each coefficient, which we can visualize in neat ways:</span>
<span id="cb72-835"><a href="#cb72-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-836"><a href="#cb72-836" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-coefs-bayes-basic, warning=FALSE}</span></span>
<span id="cb72-837"><a href="#cb72-837" aria-hidden="true" tabindex="-1"></a><span class="in">posterior_beta &lt;- model_beta_bayes %&gt;% </span></span>
<span id="cb72-838"><a href="#cb72-838" aria-hidden="true" tabindex="-1"></a><span class="in">  gather_draws(`b_.*`, regex = TRUE) %&gt;% </span></span>
<span id="cb72-839"><a href="#cb72-839" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(component = ifelse(str_detect(.variable, "phi_"), "Precision", "Mean"),</span></span>
<span id="cb72-840"><a href="#cb72-840" aria-hidden="true" tabindex="-1"></a><span class="in">         intercept = str_detect(.variable, "Intercept"))</span></span>
<span id="cb72-841"><a href="#cb72-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-842"><a href="#cb72-842" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(posterior_beta, aes(x = .value, y = fct_rev(.variable), fill = component)) +</span></span>
<span id="cb72-843"><a href="#cb72-843" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = 0) +</span></span>
<span id="cb72-844"><a href="#cb72-844" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye(aes(slab_alpha = intercept), </span></span>
<span id="cb72-845"><a href="#cb72-845" aria-hidden="true" tabindex="-1"></a><span class="in">               .width = c(0.8, 0.95), point_interval = "median_hdi") +</span></span>
<span id="cb72-846"><a href="#cb72-846" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_viridis_d(option = "viridis", end = 0.6) +</span></span>
<span id="cb72-847"><a href="#cb72-847" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_slab_alpha_discrete(range = c(1, 0.4)) +</span></span>
<span id="cb72-848"><a href="#cb72-848" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(fill = "none", slab_alpha = "none") +</span></span>
<span id="cb72-849"><a href="#cb72-849" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Coefficient", y = "Variable",</span></span>
<span id="cb72-850"><a href="#cb72-850" aria-hidden="true" tabindex="-1"></a><span class="in">       caption = "80% and 95% credible intervals shown in black") +</span></span>
<span id="cb72-851"><a href="#cb72-851" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(component), ncol = 1, scales = "free_y") +</span></span>
<span id="cb72-852"><a href="#cb72-852" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean()</span></span>
<span id="cb72-853"><a href="#cb72-853" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-854"><a href="#cb72-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-855"><a href="#cb72-855" aria-hidden="true" tabindex="-1"></a>That shows the coefficients in their transformed scale (logits for the mean, logs for the precision), but we can transform them to the response scale too by feeding the $\phi$ parts to <span class="in">`exp()`</span> and the $\mu$ parts to <span class="in">`plogis()`</span>:</span>
<span id="cb72-856"><a href="#cb72-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-857"><a href="#cb72-857" aria-hidden="true" tabindex="-1"></a><span class="in">```{r backtransform-beta-coefs}</span></span>
<span id="cb72-858"><a href="#cb72-858" aria-hidden="true" tabindex="-1"></a><span class="in">model_beta_bayes %&gt;% </span></span>
<span id="cb72-859"><a href="#cb72-859" aria-hidden="true" tabindex="-1"></a><span class="in">  spread_draws(`b_.*`, regex = TRUE) %&gt;% </span></span>
<span id="cb72-860"><a href="#cb72-860" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(starts_with("b_phi"), ~exp(.))) %&gt;%</span></span>
<span id="cb72-861"><a href="#cb72-861" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across((!starts_with(".") &amp; !starts_with("b_phi")), ~plogis(.))) %&gt;%</span></span>
<span id="cb72-862"><a href="#cb72-862" aria-hidden="true" tabindex="-1"></a><span class="in">  gather_variables() %&gt;% </span></span>
<span id="cb72-863"><a href="#cb72-863" aria-hidden="true" tabindex="-1"></a><span class="in">  median_hdi()</span></span>
<span id="cb72-864"><a href="#cb72-864" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-865"><a href="#cb72-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-866"><a href="#cb72-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-867"><a href="#cb72-867" aria-hidden="true" tabindex="-1"></a><span class="in">```{r extract-bayes-beta-coefs, include=FALSE}</span></span>
<span id="cb72-868"><a href="#cb72-868" aria-hidden="true" tabindex="-1"></a><span class="in">r_beta_bayes &lt;- model_beta_bayes %&gt;% </span></span>
<span id="cb72-869"><a href="#cb72-869" aria-hidden="true" tabindex="-1"></a><span class="in">  spread_draws(`b_.*`, regex = TRUE) %&gt;% </span></span>
<span id="cb72-870"><a href="#cb72-870" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(starts_with("b_phi"), ~exp(.))) %&gt;%</span></span>
<span id="cb72-871"><a href="#cb72-871" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across((!starts_with(".") &amp; !starts_with("b_phi")), ~plogis(.))) %&gt;%</span></span>
<span id="cb72-872"><a href="#cb72-872" aria-hidden="true" tabindex="-1"></a><span class="in">  gather_variables() %&gt;% </span></span>
<span id="cb72-873"><a href="#cb72-873" aria-hidden="true" tabindex="-1"></a><span class="in">  median_hdi() %&gt;% </span></span>
<span id="cb72-874"><a href="#cb72-874" aria-hidden="true" tabindex="-1"></a><span class="in">  split(~.variable)</span></span>
<span id="cb72-875"><a href="#cb72-875" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-876"><a href="#cb72-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-877"><a href="#cb72-877" aria-hidden="true" tabindex="-1"></a>But beyond the intercepts here, this isn't actually that helpful. The median back-transformed intercept for the $\mu$ part of the regression is <span class="in">`r round(r_beta_bayes$b_Intercept$.value, 3)`</span>, which means countries without a quota have an average proportion of women MPs of <span class="in">`r label_percent(accuracy = 0.1)(r_beta_bayes$b_Intercept$.value)`</span>. That's all fine. The quota effect here, though, is <span class="in">`r round(r_beta_bayes$b_quotaTRUE$.value, 3)`</span>. That does *not* mean that having a quota increases the proportion of women by <span class="in">`r label_comma()(r_beta_bayes$b_quotaTRUE$.value * 100)`</span> percentage points! In order to find the marginal effect of having a quota, we need to also incorporate the intercept. Remember when we ran <span class="in">`plogis(intercept + coefficient) - plogis(intercept)`</span> earlier? We have to do that again.</span>
<span id="cb72-878"><a href="#cb72-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-879"><a href="#cb72-879" aria-hidden="true" tabindex="-1"></a><span class="fu">### Posterior average marginal effects</span></span>
<span id="cb72-880"><a href="#cb72-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-881"><a href="#cb72-881" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Binary predictor</span></span>
<span id="cb72-882"><a href="#cb72-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-883"><a href="#cb72-883" aria-hidden="true" tabindex="-1"></a>Once again, the math for combining these coefficients can get hairy, especially when we're working with more than one explanatory variable, so instead of figuring out that math, we'll calculate the marginal effects across different values of <span class="in">`quota`</span>.</span>
<span id="cb72-884"><a href="#cb72-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-885"><a href="#cb72-885" aria-hidden="true" tabindex="-1"></a>~~The **marginaleffects** package doesn't work with **brms** models (and [there are no plans to add support for it](https://github.com/vincentarelbundock/marginaleffects/issues/100)), but [the powerful **emmeans** package](https://cran.r-project.org/web/packages/emmeans/index.html) does, so we'll use that. The syntax is a little different, but the documentation for **emmeans** is really complete and helpful. [This website also has a bunch of worked out examples](https://errickson.net/marginsnotes/).~~</span>
<span id="cb72-886"><a href="#cb72-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-887"><a href="#cb72-887" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb72-888"><a href="#cb72-888" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2023-08-18 edit</span></span>
<span id="cb72-889"><a href="#cb72-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-890"><a href="#cb72-890" aria-hidden="true" tabindex="-1"></a>The **marginaleffects** package *does* work with **brms** models now and I like its interface and its approach to estimating things a lot better than **emmeans**, so I've changed all the code here to use it instead. If you want to see the **emmeans** version of everything, <span class="co">[</span><span class="ot">look at this past version at GitHub</span><span class="co">](https://github.com/andrewheiss/ath-quarto/blob/d8628ba05ee4e4dbec3c571e0656461e2f737594/blog/2021/11/08/beta-regression-guide/index.qmd#L834)</span>.</span>
<span id="cb72-891"><a href="#cb72-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-892"><a href="#cb72-892" aria-hidden="true" tabindex="-1"></a>Also, I'm pretty loosey-goosey about the term "marginal effect" throughout this post because this was early in my journey to actually understanding what all these different estimands are. See <span class="co">[</span><span class="ot">my "Marginalia" post</span><span class="co">](https://www.andrewheiss.com/blog/2022/05/20/marginalia/)</span>, published a few months after this one, for a ton more about what "marginal effects" actually mean.</span>
<span id="cb72-893"><a href="#cb72-893" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb72-894"><a href="#cb72-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-895"><a href="#cb72-895" aria-hidden="true" tabindex="-1"></a>We can calculate the pairwise marginal effects across different values of <span class="in">`quota`</span>, which conveniently shows us the difference, or the marginal effect of having a quota:</span>
<span id="cb72-896"><a href="#cb72-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-897"><a href="#cb72-897" aria-hidden="true" tabindex="-1"></a><span class="in">```{r mfx-beta-bayes}</span></span>
<span id="cb72-898"><a href="#cb72-898" aria-hidden="true" tabindex="-1"></a><span class="in">model_beta_bayes %&gt;% </span></span>
<span id="cb72-899"><a href="#cb72-899" aria-hidden="true" tabindex="-1"></a><span class="in">  avg_comparisons(variables = "quota")</span></span>
<span id="cb72-900"><a href="#cb72-900" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-901"><a href="#cb72-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-902"><a href="#cb72-902" aria-hidden="true" tabindex="-1"></a>This summary information is helpful—we have our difference in predicted outcomes of <span class="in">`r avg_comparisons(model_beta_bayes, variables = "quota")$estimate`</span>, which is roughly what we found in earlier models. We also have a 95% highest posterior density interval for the difference. </span>
<span id="cb72-903"><a href="#cb72-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-904"><a href="#cb72-904" aria-hidden="true" tabindex="-1"></a>But it would be great if we could visualize these predictions! What do the posteriors for quota and non-quota countries look like, and what does the distribution of differences look like? We can work with the original model and MCMC chains to visualize this, letting **brms** take care of the hard work of predicting the coefficients we need and back-transforming them into probabilities.</span>
<span id="cb72-905"><a href="#cb72-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-906"><a href="#cb72-906" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb72-907"><a href="#cb72-907" aria-hidden="true" tabindex="-1"></a><span class="fu">### marginaleffects</span></span>
<span id="cb72-908"><a href="#cb72-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-909"><a href="#cb72-909" aria-hidden="true" tabindex="-1"></a>**marginaleffects** can also handle all this with its <span class="co">[</span><span class="ot">`comparisons()`</span><span class="co">](https://marginaleffects.com/articles/comparisons.html)</span> and <span class="co">[</span><span class="ot">`hypotheses()`</span><span class="co">](https://marginaleffects.com/articles/hypothesis.html)</span> functions—<span class="co">[</span><span class="ot">even with Bayesian models</span><span class="co">](https://marginaleffects.com/articles/brms.html)</span>!</span>
<span id="cb72-910"><a href="#cb72-910" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb72-911"><a href="#cb72-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-912"><a href="#cb72-912" aria-hidden="true" tabindex="-1"></a>We'll use <span class="in">`epred_draws()`</span> from **tidybayes** to plug in a hypothetical dataset and generate predictions, as we did with previous models. Only this time, instead of getting a single predicted value for each level of `quota`, we'll get 4,000. The `epred_draws()` (like all **tidybayes** functions) returns a long tidy data frame, so it's really easy to plot with ggplot:</span>
<span id="cb72-913"><a href="#cb72-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-914"><a href="#cb72-914" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-bayes-beta-preds}</span></span>
<span id="cb72-915"><a href="#cb72-915" aria-hidden="true" tabindex="-1"></a><span class="in"># Plug a dataset where quota is FALSE and TRUE into the model</span></span>
<span id="cb72-916"><a href="#cb72-916" aria-hidden="true" tabindex="-1"></a><span class="in">beta_bayes_pred &lt;- model_beta_bayes %&gt;% </span></span>
<span id="cb72-917"><a href="#cb72-917" aria-hidden="true" tabindex="-1"></a><span class="in">  epred_draws(newdata = tibble(quota = c(FALSE, TRUE)))</span></span>
<span id="cb72-918"><a href="#cb72-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-919"><a href="#cb72-919" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(beta_bayes_pred, aes(x = .epred, y = quota, fill = quota)) +</span></span>
<span id="cb72-920"><a href="#cb72-920" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi") +</span></span>
<span id="cb72-921"><a href="#cb72-921" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_percent()) +</span></span>
<span id="cb72-922"><a href="#cb72-922" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_viridis_d(option = "plasma", end = 0.8) +</span></span>
<span id="cb72-923"><a href="#cb72-923" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(fill = "none") +</span></span>
<span id="cb72-924"><a href="#cb72-924" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Predicted proportion of women in parliament", y = NULL,</span></span>
<span id="cb72-925"><a href="#cb72-925" aria-hidden="true" tabindex="-1"></a><span class="in">       caption = "80% and 95% credible intervals shown in black") +</span></span>
<span id="cb72-926"><a href="#cb72-926" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean()</span></span>
<span id="cb72-927"><a href="#cb72-927" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-928"><a href="#cb72-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-929"><a href="#cb72-929" aria-hidden="true" tabindex="-1"></a>That's super neat! We can easily see that countries with quotas have a higher predicted proportion of women in parliament, and we can see the uncertainty in those estimates. We can also work with these posterior predictions to calculate the difference in proportions, or the marginal effect of having a quota, which is the main thing we're interested in.</span>
<span id="cb72-930"><a href="#cb72-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-931"><a href="#cb72-931" aria-hidden="true" tabindex="-1"></a>We can use <span class="in">`compare_levels()`</span> from **tidybayes** to calculate the difference between these two posteriors:</span>
<span id="cb72-932"><a href="#cb72-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-933"><a href="#cb72-933" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-mfx-beta-bayes}</span></span>
<span id="cb72-934"><a href="#cb72-934" aria-hidden="true" tabindex="-1"></a><span class="in">beta_bayes_pred_diff &lt;- beta_bayes_pred %&gt;% </span></span>
<span id="cb72-935"><a href="#cb72-935" aria-hidden="true" tabindex="-1"></a><span class="in">  compare_levels(variable = .epred, by = quota)</span></span>
<span id="cb72-936"><a href="#cb72-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-937"><a href="#cb72-937" aria-hidden="true" tabindex="-1"></a><span class="in">beta_bayes_pred_diff %&gt;% median_hdi()</span></span>
<span id="cb72-938"><a href="#cb72-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-939"><a href="#cb72-939" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(beta_bayes_pred_diff, aes(x = .epred)) +</span></span>
<span id="cb72-940"><a href="#cb72-940" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",</span></span>
<span id="cb72-941"><a href="#cb72-941" aria-hidden="true" tabindex="-1"></a><span class="in">               fill = "#bc3032") +</span></span>
<span id="cb72-942"><a href="#cb72-942" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_pp) +</span></span>
<span id="cb72-943"><a href="#cb72-943" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Average marginal effect of having a gender-based\nquota on the proportion of women in parliament", </span></span>
<span id="cb72-944"><a href="#cb72-944" aria-hidden="true" tabindex="-1"></a><span class="in">       y = NULL, caption = "80% and 95% credible intervals shown in black") +</span></span>
<span id="cb72-945"><a href="#cb72-945" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean()</span></span>
<span id="cb72-946"><a href="#cb72-946" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-947"><a href="#cb72-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-948"><a href="#cb72-948" aria-hidden="true" tabindex="-1"></a>Perfect! The median marginal effect of having a quota is 6 percentage points, but it can range from 2 to 10.</span>
<span id="cb72-949"><a href="#cb72-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-950"><a href="#cb72-950" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Continuous predictor</span></span>
<span id="cb72-951"><a href="#cb72-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-952"><a href="#cb72-952" aria-hidden="true" tabindex="-1"></a>The same approach works for continuous predictors too, just like with previous methods. Let's build a model that explains both the mean and the precision with <span class="in">`quota`</span> and <span class="in">`polyarchy`</span>. We don't necessarily have to model the precision with the same variables that we use for the mean—that can be a completely separate process—but we'll do it just for fun.</span>
<span id="cb72-953"><a href="#cb72-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-954"><a href="#cb72-954" aria-hidden="true" tabindex="-1"></a><span class="in">```{r model-bayes-beta-complex, results="hide"}</span></span>
<span id="cb72-955"><a href="#cb72-955" aria-hidden="true" tabindex="-1"></a><span class="in"># We need to specify init here because the beta precision parameter can never</span></span>
<span id="cb72-956"><a href="#cb72-956" aria-hidden="true" tabindex="-1"></a><span class="in"># be negative, but Stan will generate random initial values from -2 to 2, even</span></span>
<span id="cb72-957"><a href="#cb72-957" aria-hidden="true" tabindex="-1"></a><span class="in"># for beta's precision, which leads to rejected chains and slower performance.</span></span>
<span id="cb72-958"><a href="#cb72-958" aria-hidden="true" tabindex="-1"></a><span class="in"># For even fancier init handling, see Solomon Kurz's post here:</span></span>
<span id="cb72-959"><a href="#cb72-959" aria-hidden="true" tabindex="-1"></a><span class="in"># https://solomonkurz.netlify.app/post/2021-06-05-don-t-forget-your-inits/</span></span>
<span id="cb72-960"><a href="#cb72-960" aria-hidden="true" tabindex="-1"></a><span class="in">model_beta_bayes_1 &lt;- brm(</span></span>
<span id="cb72-961"><a href="#cb72-961" aria-hidden="true" tabindex="-1"></a><span class="in">  bf(prop_fem ~ quota + polyarchy,</span></span>
<span id="cb72-962"><a href="#cb72-962" aria-hidden="true" tabindex="-1"></a><span class="in">     phi ~ quota + polyarchy),</span></span>
<span id="cb72-963"><a href="#cb72-963" aria-hidden="true" tabindex="-1"></a><span class="in">  data = vdem_2015_fake0,</span></span>
<span id="cb72-964"><a href="#cb72-964" aria-hidden="true" tabindex="-1"></a><span class="in">  family = Beta(),</span></span>
<span id="cb72-965"><a href="#cb72-965" aria-hidden="true" tabindex="-1"></a><span class="in">  init = 0,</span></span>
<span id="cb72-966"><a href="#cb72-966" aria-hidden="true" tabindex="-1"></a><span class="in">  chains = 4, iter = 2000, warmup = 1000,</span></span>
<span id="cb72-967"><a href="#cb72-967" aria-hidden="true" tabindex="-1"></a><span class="in">  cores = 4, seed = 1234, </span></span>
<span id="cb72-968"><a href="#cb72-968" aria-hidden="true" tabindex="-1"></a><span class="in">  backend = "cmdstanr",</span></span>
<span id="cb72-969"><a href="#cb72-969" aria-hidden="true" tabindex="-1"></a><span class="in">  file = "model_beta_bayes_1"</span></span>
<span id="cb72-970"><a href="#cb72-970" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb72-971"><a href="#cb72-971" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-972"><a href="#cb72-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-973"><a href="#cb72-973" aria-hidden="true" tabindex="-1"></a>We'll forgo interpreting all these different coefficients, since we'd need to piece together the different parts and back-transform them with either <span class="in">`plogis()`</span> (for the $\mu$ parts) or <span class="in">`exp()`</span> (for the $\phi$ parts). Instead, we'll skip to the marginal effect of polyarchy on the proportion of women MPs. First we can look at the posterior prediction of the outcome across the whole range of democracy scores:</span>
<span id="cb72-974"><a href="#cb72-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-975"><a href="#cb72-975" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-preds-polyarchy-beta, warning=FALSE}</span></span>
<span id="cb72-976"><a href="#cb72-976" aria-hidden="true" tabindex="-1"></a><span class="in"># Use a dataset where quota is FALSE and polyarchy is a range</span></span>
<span id="cb72-977"><a href="#cb72-977" aria-hidden="true" tabindex="-1"></a><span class="in">beta_bayes_pred_1 &lt;- model_beta_bayes_1 %&gt;% </span></span>
<span id="cb72-978"><a href="#cb72-978" aria-hidden="true" tabindex="-1"></a><span class="in">  epred_draws(newdata = expand_grid(quota = FALSE,</span></span>
<span id="cb72-979"><a href="#cb72-979" aria-hidden="true" tabindex="-1"></a><span class="in">                                    polyarchy = seq(0, 100, by = 1)))</span></span>
<span id="cb72-980"><a href="#cb72-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-981"><a href="#cb72-981" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(beta_bayes_pred_1, aes(x = polyarchy, y = .epred)) +</span></span>
<span id="cb72-982"><a href="#cb72-982" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_lineribbon() + </span></span>
<span id="cb72-983"><a href="#cb72-983" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(labels = label_percent()) +</span></span>
<span id="cb72-984"><a href="#cb72-984" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_brewer(palette = "Purples") +</span></span>
<span id="cb72-985"><a href="#cb72-985" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Polyarchy (democracy)", y = "Predicted proportion of women MPs",</span></span>
<span id="cb72-986"><a href="#cb72-986" aria-hidden="true" tabindex="-1"></a><span class="in">       fill = "Credible interval") +</span></span>
<span id="cb72-987"><a href="#cb72-987" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() +</span></span>
<span id="cb72-988"><a href="#cb72-988" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb72-989"><a href="#cb72-989" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-990"><a href="#cb72-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-991"><a href="#cb72-991" aria-hidden="true" tabindex="-1"></a>The predicted proportion of women MPs increases as democracy increases, as we've seen before. Note how the slope here isn't constant, though—the line is slightly curved. That's because this is a nonlinear regression model, making it so the marginal effect of democracy is different depending on its level. We can see this if we look at the instantaneous slope (or first derivative) at different values of polyarchy. **marginaleffects** makes this really easy with the <span class="in">`aavg_slopes()`</span> function. If we ask it for the slope of the line, it will provide it at the average value of polyarchy, or 53.5:</span>
<span id="cb72-992"><a href="#cb72-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-993"><a href="#cb72-993" aria-hidden="true" tabindex="-1"></a><span class="in">```{r beta-bayes-polyarchy-mean}</span></span>
<span id="cb72-994"><a href="#cb72-994" aria-hidden="true" tabindex="-1"></a><span class="in">avg_slopes(model_beta_bayes_1, variables = "polyarchy")</span></span>
<span id="cb72-995"><a href="#cb72-995" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-996"><a href="#cb72-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-997"><a href="#cb72-997" aria-hidden="true" tabindex="-1"></a>Our effect is thus <span class="in">`r avg_slopes(model_beta_bayes_1, variables = "polyarchy")$estimate`</span>, or <span class="in">`r round(avg_slopes(model_beta_bayes_1, variables = "polyarchy")$estimate * 100, 3)`</span> percentage points, but only for countries in the middle range of polyarchy. The slope is shallower and steeper depending on the level of democracy. We can check the slope (or effect) at different hypothetical levels:</span>
<span id="cb72-998"><a href="#cb72-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-999"><a href="#cb72-999" aria-hidden="true" tabindex="-1"></a><span class="in">```{r beta-bayes-polyarchy-3}</span></span>
<span id="cb72-1000"><a href="#cb72-1000" aria-hidden="true" tabindex="-1"></a><span class="in">slopes(model_beta_bayes_1, </span></span>
<span id="cb72-1001"><a href="#cb72-1001" aria-hidden="true" tabindex="-1"></a><span class="in">       variables = "polyarchy",</span></span>
<span id="cb72-1002"><a href="#cb72-1002" aria-hidden="true" tabindex="-1"></a><span class="in">       newdata = datagrid(polyarchy = c(20, 50, 80)))</span></span>
<span id="cb72-1003"><a href="#cb72-1003" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1004"><a href="#cb72-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1005"><a href="#cb72-1005" aria-hidden="true" tabindex="-1"></a><span class="in">```{r extract-beta-bayes-slopes, include=FALSE}</span></span>
<span id="cb72-1006"><a href="#cb72-1006" aria-hidden="true" tabindex="-1"></a><span class="in">r_beta_bayes_slopes &lt;- slopes(model_beta_bayes_1, </span></span>
<span id="cb72-1007"><a href="#cb72-1007" aria-hidden="true" tabindex="-1"></a><span class="in">  variables = "polyarchy",</span></span>
<span id="cb72-1008"><a href="#cb72-1008" aria-hidden="true" tabindex="-1"></a><span class="in">  newdata = datagrid(polyarchy = c(20, 50, 80))) %&gt;% </span></span>
<span id="cb72-1009"><a href="#cb72-1009" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(polyarchy = janitor::make_clean_names(polyarchy)) %&gt;% </span></span>
<span id="cb72-1010"><a href="#cb72-1010" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(pp = estimate * 100) %&gt;% </span></span>
<span id="cb72-1011"><a href="#cb72-1011" aria-hidden="true" tabindex="-1"></a><span class="in">  split(~polyarchy)</span></span>
<span id="cb72-1012"><a href="#cb72-1012" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1013"><a href="#cb72-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1014"><a href="#cb72-1014" aria-hidden="true" tabindex="-1"></a>Neat! For observations with low democracy scores like 20, a one-unit increase in polyarchy is associated with a <span class="in">`r round(r_beta_bayes_slopes$x20$pp, 3)`</span> percentage point increase in the proportion of women MPs, while countries with high scores like 80 see a <span class="in">`r round(r_beta_bayes_slopes$x80$pp, 3)`</span> percentage point increase.</span>
<span id="cb72-1015"><a href="#cb72-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1016"><a href="#cb72-1016" aria-hidden="true" tabindex="-1"></a>We can visualize the distribution of these marginal effects too by using <span class="in">`slopes()`</span> to calculate the instantaneous slopes across all the MCMC chains, and then using <span class="in">`posteriordraws()`</span> to extract the draws as tidy, plottable data.</span>
<span id="cb72-1017"><a href="#cb72-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1018"><a href="#cb72-1018" aria-hidden="true" tabindex="-1"></a>(Side note: You could technically do this without **marginaleffects**. The way **marginaleffects** calculates the instantaneous slope is by finding the predicted average for some value, finding the predicted average for that same value plus a *tiny* amount extra, subtracting the two predictions, and dividing by that tiny extra amount. If you really didn't want to use **marginaleffects**, you could generate predictions for `polyarchy = 20` and `polyarchy = 20.001`, subtract them by hand, and then divide by 0.001. That's miserable though—don't do it. Use **marginaleffects** instead.)</span>
<span id="cb72-1019"><a href="#cb72-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1020"><a href="#cb72-1020" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-ame-beta-bayes}</span></span>
<span id="cb72-1021"><a href="#cb72-1021" aria-hidden="true" tabindex="-1"></a><span class="in">ame_beta_bayes_1 &lt;- model_beta_bayes_1 %&gt;% </span></span>
<span id="cb72-1022"><a href="#cb72-1022" aria-hidden="true" tabindex="-1"></a><span class="in">  slopes(variables = "polyarchy",</span></span>
<span id="cb72-1023"><a href="#cb72-1023" aria-hidden="true" tabindex="-1"></a><span class="in">         newdata = datagrid(polyarchy = c(20, 50, 80))) %&gt;% </span></span>
<span id="cb72-1024"><a href="#cb72-1024" aria-hidden="true" tabindex="-1"></a><span class="in">  posterior_draws()</span></span>
<span id="cb72-1025"><a href="#cb72-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1026"><a href="#cb72-1026" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(ame_beta_bayes_1, aes(x = draw, fill = factor(polyarchy))) +</span></span>
<span id="cb72-1027"><a href="#cb72-1027" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = 0) +</span></span>
<span id="cb72-1028"><a href="#cb72-1028" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",</span></span>
<span id="cb72-1029"><a href="#cb72-1029" aria-hidden="true" tabindex="-1"></a><span class="in">               slab_alpha = 0.75) +</span></span>
<span id="cb72-1030"><a href="#cb72-1030" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_pp_tiny) +</span></span>
<span id="cb72-1031"><a href="#cb72-1031" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_viridis_d(option = "viridis", end = 0.6) +</span></span>
<span id="cb72-1032"><a href="#cb72-1032" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Average marginal effect of polyarchy (democracy)", </span></span>
<span id="cb72-1033"><a href="#cb72-1033" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Density", fill = "Polyarchy",</span></span>
<span id="cb72-1034"><a href="#cb72-1034" aria-hidden="true" tabindex="-1"></a><span class="in">       caption = "80% and 95% credible intervals shown in black") +</span></span>
<span id="cb72-1035"><a href="#cb72-1035" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() +</span></span>
<span id="cb72-1036"><a href="#cb72-1036" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb72-1037"><a href="#cb72-1037" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1038"><a href="#cb72-1038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1039"><a href="#cb72-1039" aria-hidden="true" tabindex="-1"></a>To me this is absolutely incredible! Check out how the shapes of these distributions change as polyarchy increases! That's because we modeled both the $\mu$ and the $\phi$ parameters of the beta distribution, so we get to see changes in both the mean and precision of the outcome. Had we left the phi part alone, doing something like <span class="in">`phi ~ 1`</span>, the marginal effect would look the same and would just be shifted to the right.</span>
<span id="cb72-1040"><a href="#cb72-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1041"><a href="#cb72-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1042"><a href="#cb72-1042" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4: Zero-inflated beta regression, Bayesian style</span></span>
<span id="cb72-1043"><a href="#cb72-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1044"><a href="#cb72-1044" aria-hidden="true" tabindex="-1"></a>Beta regression is really neat and modeling different components of the beta regression is a fascinating and rich way of thinking about the outcome variable. Plus the beta distribution naturally limits the outcome to the 0–1 range, so you don't have to shoehorn the data into an OLS-based LPM or fractional logistic model.</span>
<span id="cb72-1045"><a href="#cb72-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1046"><a href="#cb72-1046" aria-hidden="true" tabindex="-1"></a>One problem with beta regression, though, is that the beta distribution does *not* include 0 and 1. As we saw earlier, if your data has has 0s or 1s, the model breaks.</span>
<span id="cb72-1047"><a href="#cb72-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1048"><a href="#cb72-1048" aria-hidden="true" tabindex="-1"></a><span class="fu">### A new parameter for modeling the zero process</span></span>
<span id="cb72-1049"><a href="#cb72-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1050"><a href="#cb72-1050" aria-hidden="true" tabindex="-1"></a>To get around this, we can use a special zero-inflated beta regression. We'll still model the $\mu$ and $\phi$ (or mean and precision) of the beta distribution, but we'll also model one new special parameter $\alpha$. With zero-inflated regression, we're actually modelling a mixture of data-generating processes: </span>
<span id="cb72-1051"><a href="#cb72-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1052"><a href="#cb72-1052" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>A logistic regression model that predicts if an outcome is 0 or not, defined by $\alpha$</span>
<span id="cb72-1053"><a href="#cb72-1053" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>A beta regression model that predicts if an outcome is between 0 and 1 if it's not zero, defined by $\mu$ and $\phi$</span>
<span id="cb72-1054"><a href="#cb72-1054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1055"><a href="#cb72-1055" aria-hidden="true" tabindex="-1"></a>Let's see how many zeros we have in the data:</span>
<span id="cb72-1056"><a href="#cb72-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1057"><a href="#cb72-1057" aria-hidden="true" tabindex="-1"></a><span class="in">```{r prop-zeros}</span></span>
<span id="cb72-1058"><a href="#cb72-1058" aria-hidden="true" tabindex="-1"></a><span class="in">vdem_2015 %&gt;% </span></span>
<span id="cb72-1059"><a href="#cb72-1059" aria-hidden="true" tabindex="-1"></a><span class="in">  count(prop_fem == 0) %&gt;% </span></span>
<span id="cb72-1060"><a href="#cb72-1060" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(prop = n / sum(n))</span></span>
<span id="cb72-1061"><a href="#cb72-1061" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1062"><a href="#cb72-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1063"><a href="#cb72-1063" aria-hidden="true" tabindex="-1"></a>Hahahaha only 3, or 1.7% of the data. That's barely anything. Perhaps our approach of just adding a tiny amount to those three 0 observations is fine. For the sake of illustrating this approach, though, we'll still model the zero-creating process.</span>
<span id="cb72-1064"><a href="#cb72-1064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1065"><a href="#cb72-1065" aria-hidden="true" tabindex="-1"></a>The only difference between regular beta regression and zero-inflated regression is that we have to specify one more parameter: <span class="in">`zi`</span>. This corresponds to the $\alpha$ parameter and determines the zero/not-zero process.</span>
<span id="cb72-1066"><a href="#cb72-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1067"><a href="#cb72-1067" aria-hidden="true" tabindex="-1"></a>To help with the intuition, we'll first run a model where we don't actually define a model for <span class="in">`zi`</span>—it'll just return the intercept for the $\alpha$ parameter.</span>
<span id="cb72-1068"><a href="#cb72-1068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1069"><a href="#cb72-1069" aria-hidden="true" tabindex="-1"></a><span class="in">```{r model-bayes-zoi-int-only, results="hide"}</span></span>
<span id="cb72-1070"><a href="#cb72-1070" aria-hidden="true" tabindex="-1"></a><span class="in">model_beta_zi_int_only &lt;- brm(</span></span>
<span id="cb72-1071"><a href="#cb72-1071" aria-hidden="true" tabindex="-1"></a><span class="in">  bf(prop_fem ~ quota,</span></span>
<span id="cb72-1072"><a href="#cb72-1072" aria-hidden="true" tabindex="-1"></a><span class="in">     phi ~ quota,</span></span>
<span id="cb72-1073"><a href="#cb72-1073" aria-hidden="true" tabindex="-1"></a><span class="in">     zi ~ 1),</span></span>
<span id="cb72-1074"><a href="#cb72-1074" aria-hidden="true" tabindex="-1"></a><span class="in">  data = vdem_clean,</span></span>
<span id="cb72-1075"><a href="#cb72-1075" aria-hidden="true" tabindex="-1"></a><span class="in">  family = zero_inflated_beta(),</span></span>
<span id="cb72-1076"><a href="#cb72-1076" aria-hidden="true" tabindex="-1"></a><span class="in">  chains = 4, iter = 2000, warmup = 1000,</span></span>
<span id="cb72-1077"><a href="#cb72-1077" aria-hidden="true" tabindex="-1"></a><span class="in">  cores = 4, seed = 1234,</span></span>
<span id="cb72-1078"><a href="#cb72-1078" aria-hidden="true" tabindex="-1"></a><span class="in">  backend = "cmdstanr",</span></span>
<span id="cb72-1079"><a href="#cb72-1079" aria-hidden="true" tabindex="-1"></a><span class="in">  file = "model_beta_zi_int_only"</span></span>
<span id="cb72-1080"><a href="#cb72-1080" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb72-1081"><a href="#cb72-1081" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1082"><a href="#cb72-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1083"><a href="#cb72-1083" aria-hidden="true" tabindex="-1"></a><span class="in">```{r show-model-bayes-zoi-int-only, warning=FALSE}</span></span>
<span id="cb72-1084"><a href="#cb72-1084" aria-hidden="true" tabindex="-1"></a><span class="in">tidy(model_beta_zi_int_only, effects = "fixed")</span></span>
<span id="cb72-1085"><a href="#cb72-1085" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1086"><a href="#cb72-1086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1087"><a href="#cb72-1087" aria-hidden="true" tabindex="-1"></a>As before, the parameters for $\mu$ (<span class="in">`(Intercept)`</span> and <span class="in">`quotaTRUE`</span>) are on the logit scale, while the parameters for $\phi$ (<span class="in">`phi_(Intercept)`</span> and <span class="in">`phi_quotaTRUE`</span>) are on the log scale. The zero-inflated parameter (or $\alpha$) here (<span class="in">`(Intercept)`</span> for the <span class="in">`zi`</span> component) is on the logit scale like the regular model coefficients. That means we can back-transform it with <span class="in">`plogis()`</span>:</span>
<span id="cb72-1088"><a href="#cb72-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1089"><a href="#cb72-1089" aria-hidden="true" tabindex="-1"></a><span class="in">```{r zi-intercept-prob, warning=FALSE}</span></span>
<span id="cb72-1090"><a href="#cb72-1090" aria-hidden="true" tabindex="-1"></a><span class="in">zi_intercept &lt;- tidy(model_beta_zi_int_only, effects = "fixed") %&gt;% </span></span>
<span id="cb72-1091"><a href="#cb72-1091" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(component == "zi", term == "(Intercept)") %&gt;% </span></span>
<span id="cb72-1092"><a href="#cb72-1092" aria-hidden="true" tabindex="-1"></a><span class="in">  pull(estimate)</span></span>
<span id="cb72-1093"><a href="#cb72-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1094"><a href="#cb72-1094" aria-hidden="true" tabindex="-1"></a><span class="in"># Logit scale intercept</span></span>
<span id="cb72-1095"><a href="#cb72-1095" aria-hidden="true" tabindex="-1"></a><span class="in">zi_intercept</span></span>
<span id="cb72-1096"><a href="#cb72-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1097"><a href="#cb72-1097" aria-hidden="true" tabindex="-1"></a><span class="in"># Transformed to a probability/proportion</span></span>
<span id="cb72-1098"><a href="#cb72-1098" aria-hidden="true" tabindex="-1"></a><span class="in">plogis(zi_intercept)</span></span>
<span id="cb72-1099"><a href="#cb72-1099" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1100"><a href="#cb72-1100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1101"><a href="#cb72-1101" aria-hidden="true" tabindex="-1"></a>After transforming the intercept to a probability/proportion, we can see that it's <span class="in">`r label_percent(accuracy = 0.01)(plogis(zi_intercept))`</span>—basically the same as the proportion of zeros in the data!</span>
<span id="cb72-1102"><a href="#cb72-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1103"><a href="#cb72-1103" aria-hidden="true" tabindex="-1"></a>Right now, all we've modeled is the overall proportion of 0s. We haven't modeled what determines those zeros. We can see that if we plot the posterior predictions for <span class="in">`prop_fem`</span> across <span class="in">`quota`</span>, highlighting predicted values that are 0. In general, ≈2% of the predicted outcomes should be zero, and since we didn't really model <span class="in">`zi`</span>, the 0s should be equally spread across the different levels of <span class="in">`quota`</span>. To visualize this we'll use a histogram instead of a density plot so that we can better see the count of 0s. We'll also cheat a little and make the 0s a negative number so that the histogram bin for the 0s appears outside of the main 0–1 range.</span>
<span id="cb72-1104"><a href="#cb72-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1105"><a href="#cb72-1105" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-zi-hist-int-only}</span></span>
<span id="cb72-1106"><a href="#cb72-1106" aria-hidden="true" tabindex="-1"></a><span class="in">beta_zi_pred_int &lt;- model_beta_zi_int_only %&gt;% </span></span>
<span id="cb72-1107"><a href="#cb72-1107" aria-hidden="true" tabindex="-1"></a><span class="in">  predicted_draws(newdata = tibble(quota = c(FALSE, TRUE))) %&gt;% </span></span>
<span id="cb72-1108"><a href="#cb72-1108" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(is_zero = .prediction == 0,</span></span>
<span id="cb72-1109"><a href="#cb72-1109" aria-hidden="true" tabindex="-1"></a><span class="in">         .prediction = ifelse(is_zero, .prediction - 0.01, .prediction))</span></span>
<span id="cb72-1110"><a href="#cb72-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1111"><a href="#cb72-1111" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(beta_zi_pred_int, aes(x = .prediction)) +</span></span>
<span id="cb72-1112"><a href="#cb72-1112" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram(aes(fill = is_zero), binwidth = 0.025, </span></span>
<span id="cb72-1113"><a href="#cb72-1113" aria-hidden="true" tabindex="-1"></a><span class="in">                 boundary = 0, color = "white") +</span></span>
<span id="cb72-1114"><a href="#cb72-1114" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = 0) +</span></span>
<span id="cb72-1115"><a href="#cb72-1115" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_percent()) +</span></span>
<span id="cb72-1116"><a href="#cb72-1116" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_viridis_d(option = "plasma", end = 0.5,</span></span>
<span id="cb72-1117"><a href="#cb72-1117" aria-hidden="true" tabindex="-1"></a><span class="in">                       guide = guide_legend(reverse = TRUE)) +</span></span>
<span id="cb72-1118"><a href="#cb72-1118" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Predicted proportion of women in parliament", </span></span>
<span id="cb72-1119"><a href="#cb72-1119" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Count", fill = "Is zero?") +</span></span>
<span id="cb72-1120"><a href="#cb72-1120" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(quota), ncol = 2,</span></span>
<span id="cb72-1121"><a href="#cb72-1121" aria-hidden="true" tabindex="-1"></a><span class="in">             labeller = labeller(quota = c(`TRUE` = "Quota", </span></span>
<span id="cb72-1122"><a href="#cb72-1122" aria-hidden="true" tabindex="-1"></a><span class="in">                                           `FALSE` = "No Quota"))) + </span></span>
<span id="cb72-1123"><a href="#cb72-1123" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() +</span></span>
<span id="cb72-1124"><a href="#cb72-1124" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb72-1125"><a href="#cb72-1125" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1126"><a href="#cb72-1126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1127"><a href="#cb72-1127" aria-hidden="true" tabindex="-1"></a>The process for deciding 0/not 0 is probably determined by different political and social factors, though. It's likely that having a quota, for instance, should increase the probability of having at least one woman. There are probably a host of other factors—if we were doing this in real life, we could fully specify a model that explains the no women vs. at-least-one-woman split. For now, we'll just use <span class="in">`quota`</span>, though (in part because there are actually only 3 zeros!). This model takes a little longer to run because of all the moving parts:</span>
<span id="cb72-1128"><a href="#cb72-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1129"><a href="#cb72-1129" aria-hidden="true" tabindex="-1"></a><span class="in">```{r model-bayes-zi, results="hide"}</span></span>
<span id="cb72-1130"><a href="#cb72-1130" aria-hidden="true" tabindex="-1"></a><span class="in">model_beta_zi &lt;- brm(</span></span>
<span id="cb72-1131"><a href="#cb72-1131" aria-hidden="true" tabindex="-1"></a><span class="in">  bf(prop_fem ~ quota,</span></span>
<span id="cb72-1132"><a href="#cb72-1132" aria-hidden="true" tabindex="-1"></a><span class="in">     phi ~ quota,</span></span>
<span id="cb72-1133"><a href="#cb72-1133" aria-hidden="true" tabindex="-1"></a><span class="in">     zi ~ quota),</span></span>
<span id="cb72-1134"><a href="#cb72-1134" aria-hidden="true" tabindex="-1"></a><span class="in">  data = vdem_clean,</span></span>
<span id="cb72-1135"><a href="#cb72-1135" aria-hidden="true" tabindex="-1"></a><span class="in">  family = zero_inflated_beta(),</span></span>
<span id="cb72-1136"><a href="#cb72-1136" aria-hidden="true" tabindex="-1"></a><span class="in">  chains = 4, iter = 2000, warmup = 1000,</span></span>
<span id="cb72-1137"><a href="#cb72-1137" aria-hidden="true" tabindex="-1"></a><span class="in">  cores = 4, seed = 1234,</span></span>
<span id="cb72-1138"><a href="#cb72-1138" aria-hidden="true" tabindex="-1"></a><span class="in">  backend = "cmdstanr",</span></span>
<span id="cb72-1139"><a href="#cb72-1139" aria-hidden="true" tabindex="-1"></a><span class="in">  file = "model_beta_zi"</span></span>
<span id="cb72-1140"><a href="#cb72-1140" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb72-1141"><a href="#cb72-1141" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1142"><a href="#cb72-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1143"><a href="#cb72-1143" aria-hidden="true" tabindex="-1"></a><span class="in">```{r show-model-bayes-zi, warning=FALSE}</span></span>
<span id="cb72-1144"><a href="#cb72-1144" aria-hidden="true" tabindex="-1"></a><span class="in">tidy(model_beta_zi, effects = "fixed")</span></span>
<span id="cb72-1145"><a href="#cb72-1145" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1146"><a href="#cb72-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1147"><a href="#cb72-1147" aria-hidden="true" tabindex="-1"></a>We now have two estimates for the <span class="in">`zi`</span> part: an intercept and a coefficient for quota. Since these are on the logit scale, we can combine them mathematically to figure out the marginal effect of <span class="in">`quota`</span> on the probability of being 0:</span>
<span id="cb72-1148"><a href="#cb72-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1149"><a href="#cb72-1149" aria-hidden="true" tabindex="-1"></a><span class="in">```{r calc-plogis-zi, warning=FALSE}</span></span>
<span id="cb72-1150"><a href="#cb72-1150" aria-hidden="true" tabindex="-1"></a><span class="in">zi_intercept &lt;- tidy(model_beta_zi, effects = "fixed") %&gt;% </span></span>
<span id="cb72-1151"><a href="#cb72-1151" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(component == "zi", term == "(Intercept)") %&gt;% </span></span>
<span id="cb72-1152"><a href="#cb72-1152" aria-hidden="true" tabindex="-1"></a><span class="in">  pull(estimate)</span></span>
<span id="cb72-1153"><a href="#cb72-1153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1154"><a href="#cb72-1154" aria-hidden="true" tabindex="-1"></a><span class="in">zi_quota &lt;- tidy(model_beta_zi, effects = "fixed") %&gt;% </span></span>
<span id="cb72-1155"><a href="#cb72-1155" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(component == "zi", term == "quotaTRUE") %&gt;% </span></span>
<span id="cb72-1156"><a href="#cb72-1156" aria-hidden="true" tabindex="-1"></a><span class="in">  pull(estimate)</span></span>
<span id="cb72-1157"><a href="#cb72-1157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1158"><a href="#cb72-1158" aria-hidden="true" tabindex="-1"></a><span class="in">plogis(zi_intercept + zi_quota) - plogis(zi_intercept)</span></span>
<span id="cb72-1159"><a href="#cb72-1159" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1160"><a href="#cb72-1160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1161"><a href="#cb72-1161" aria-hidden="true" tabindex="-1"></a>Based on this, having a quota reduces the proportion of 0s in the data by <span class="in">`r round(plogis(zi_intercept + zi_quota) - plogis(zi_intercept), 4) * 100`</span> percentage points. Unsurprisingly, we can also see this in the posterior predictions. We can look at the predicted proportion of 0s across the two levels of <span class="in">`quota`</span> to find the marginal effect of having a quota on the 0/not 0 split. To do this with **tidybayes**, we can use the <span class="in">`dpar`</span> argument in <span class="in">`epred_draws()`</span> to also calculated the predicted zero-inflation part of the model (this is omitted by default). Here's what that looks like:</span>
<span id="cb72-1162"><a href="#cb72-1162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1163"><a href="#cb72-1163" aria-hidden="true" tabindex="-1"></a><span class="in">```{r calc-pred-zi-mfx}</span></span>
<span id="cb72-1164"><a href="#cb72-1164" aria-hidden="true" tabindex="-1"></a><span class="in">pred_beta_zi &lt;- model_beta_zi %&gt;% </span></span>
<span id="cb72-1165"><a href="#cb72-1165" aria-hidden="true" tabindex="-1"></a><span class="in">  epred_draws(newdata = expand_grid(quota = c(FALSE, TRUE)),</span></span>
<span id="cb72-1166"><a href="#cb72-1166" aria-hidden="true" tabindex="-1"></a><span class="in">              dpar = "zi")</span></span>
<span id="cb72-1167"><a href="#cb72-1167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1168"><a href="#cb72-1168" aria-hidden="true" tabindex="-1"></a><span class="in"># We now have columns for the overall prediction (.epred) and for the</span></span>
<span id="cb72-1169"><a href="#cb72-1169" aria-hidden="true" tabindex="-1"></a><span class="in"># zero-inflation probability (zi)</span></span>
<span id="cb72-1170"><a href="#cb72-1170" aria-hidden="true" tabindex="-1"></a><span class="in">head(pred_beta_zi)</span></span>
<span id="cb72-1171"><a href="#cb72-1171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1172"><a href="#cb72-1172" aria-hidden="true" tabindex="-1"></a><span class="in"># Look at the average zero-inflation probability across quota</span></span>
<span id="cb72-1173"><a href="#cb72-1173" aria-hidden="true" tabindex="-1"></a><span class="in">pred_beta_zi %&gt;%</span></span>
<span id="cb72-1174"><a href="#cb72-1174" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(quota) %&gt;% </span></span>
<span id="cb72-1175"><a href="#cb72-1175" aria-hidden="true" tabindex="-1"></a><span class="in">  median_hdci(zi)</span></span>
<span id="cb72-1176"><a href="#cb72-1176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1177"><a href="#cb72-1177" aria-hidden="true" tabindex="-1"></a><span class="in">pred_beta_zi %&gt;% </span></span>
<span id="cb72-1178"><a href="#cb72-1178" aria-hidden="true" tabindex="-1"></a><span class="in">  compare_levels(variable = zi, by = quota) %&gt;% </span></span>
<span id="cb72-1179"><a href="#cb72-1179" aria-hidden="true" tabindex="-1"></a><span class="in">  median_hdci()</span></span>
<span id="cb72-1180"><a href="#cb72-1180" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1181"><a href="#cb72-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1182"><a href="#cb72-1182" aria-hidden="true" tabindex="-1"></a>Without even plotting this, we can see a neat trend. When there's not a quota, ≈2–3% of the the predicted values are 0; when there is a quota, almost none of the predicted values are 0. Having a quota almost completely eliminates the possibility of having no women MPs. It's the same marginal effect that we found with <span class="in">`plogis()`</span>—the proportion of zeros drops by <span class="in">`r round(plogis(zi_intercept + zi_quota) - plogis(zi_intercept), 3) * 100`</span> percentage points when there's a quota.</span>
<span id="cb72-1183"><a href="#cb72-1183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1184"><a href="#cb72-1184" aria-hidden="true" tabindex="-1"></a>We can visualize this uncertainty by plotting the posterior predictions. We could either plot two distributions (for <span class="in">`quota`</span> being <span class="in">`TRUE`</span> or <span class="in">`FALSE`</span>), or we can calculate the difference between quota/no quota to find the average marginal effect of having a quota on the proportion of 0s in the data:</span>
<span id="cb72-1185"><a href="#cb72-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1186"><a href="#cb72-1186" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-pred-mfx-zi}</span></span>
<span id="cb72-1187"><a href="#cb72-1187" aria-hidden="true" tabindex="-1"></a><span class="in">mfx_quota_zi &lt;- pred_beta_zi %&gt;% </span></span>
<span id="cb72-1188"><a href="#cb72-1188" aria-hidden="true" tabindex="-1"></a><span class="in">  compare_levels(variable = zi, by = quota)</span></span>
<span id="cb72-1189"><a href="#cb72-1189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1190"><a href="#cb72-1190" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(mfx_quota_zi, aes(x = zi)) +</span></span>
<span id="cb72-1191"><a href="#cb72-1191" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",</span></span>
<span id="cb72-1192"><a href="#cb72-1192" aria-hidden="true" tabindex="-1"></a><span class="in">               fill = "#fb9e07") +</span></span>
<span id="cb72-1193"><a href="#cb72-1193" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_pp) +</span></span>
<span id="cb72-1194"><a href="#cb72-1194" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Average marginal effect of having a gender-based quota\non the proportion of countries with zero women in parliament", </span></span>
<span id="cb72-1195"><a href="#cb72-1195" aria-hidden="true" tabindex="-1"></a><span class="in">       y = NULL, caption = "80% and 95% credible intervals shown in black") +</span></span>
<span id="cb72-1196"><a href="#cb72-1196" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean()</span></span>
<span id="cb72-1197"><a href="#cb72-1197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1198"><a href="#cb72-1198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1199"><a href="#cb72-1199" aria-hidden="true" tabindex="-1"></a>Finally, we can see how this shows up in the overall predictions from the model. Note how there are a bunch of 0s when quota is <span class="in">`FALSE`</span>, and no 0s when it is <span class="in">`TRUE`</span>, as expected:</span>
<span id="cb72-1200"><a href="#cb72-1200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1201"><a href="#cb72-1201" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-zi-hist}</span></span>
<span id="cb72-1202"><a href="#cb72-1202" aria-hidden="true" tabindex="-1"></a><span class="in">beta_zi_pred &lt;- model_beta_zi %&gt;% </span></span>
<span id="cb72-1203"><a href="#cb72-1203" aria-hidden="true" tabindex="-1"></a><span class="in">  predicted_draws(newdata = tibble(quota = c(FALSE, TRUE))) %&gt;% </span></span>
<span id="cb72-1204"><a href="#cb72-1204" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(is_zero = .prediction == 0,</span></span>
<span id="cb72-1205"><a href="#cb72-1205" aria-hidden="true" tabindex="-1"></a><span class="in">         .prediction = ifelse(is_zero, .prediction - 0.01, .prediction))</span></span>
<span id="cb72-1206"><a href="#cb72-1206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1207"><a href="#cb72-1207" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(beta_zi_pred, aes(x = .prediction)) +</span></span>
<span id="cb72-1208"><a href="#cb72-1208" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram(aes(fill = is_zero), binwidth = 0.025, </span></span>
<span id="cb72-1209"><a href="#cb72-1209" aria-hidden="true" tabindex="-1"></a><span class="in">                 boundary = 0, color = "white") +</span></span>
<span id="cb72-1210"><a href="#cb72-1210" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = 0) +</span></span>
<span id="cb72-1211"><a href="#cb72-1211" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_percent()) +</span></span>
<span id="cb72-1212"><a href="#cb72-1212" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_viridis_d(option = "plasma", end = 0.5,</span></span>
<span id="cb72-1213"><a href="#cb72-1213" aria-hidden="true" tabindex="-1"></a><span class="in">                       guide = guide_legend(reverse = TRUE)) +</span></span>
<span id="cb72-1214"><a href="#cb72-1214" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Predicted proportion of women in parliament", </span></span>
<span id="cb72-1215"><a href="#cb72-1215" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Count", fill = "Is zero?") +</span></span>
<span id="cb72-1216"><a href="#cb72-1216" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(quota), ncol = 2,</span></span>
<span id="cb72-1217"><a href="#cb72-1217" aria-hidden="true" tabindex="-1"></a><span class="in">             labeller = labeller(quota = c(`TRUE` = "Quota", </span></span>
<span id="cb72-1218"><a href="#cb72-1218" aria-hidden="true" tabindex="-1"></a><span class="in">                                           `FALSE` = "No Quota"))) +</span></span>
<span id="cb72-1219"><a href="#cb72-1219" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() +</span></span>
<span id="cb72-1220"><a href="#cb72-1220" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb72-1221"><a href="#cb72-1221" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1222"><a href="#cb72-1222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1223"><a href="#cb72-1223" aria-hidden="true" tabindex="-1"></a>Again, I think it's so cool that we can explore all this uncertainty for specific parameters of this model, like the 0/not 0 process! You can't do this with OLS!</span>
<span id="cb72-1224"><a href="#cb72-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1225"><a href="#cb72-1225" aria-hidden="true" tabindex="-1"></a><span class="fu">### Average marginal effects, incorporating the zero process</span></span>
<span id="cb72-1226"><a href="#cb72-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1227"><a href="#cb72-1227" aria-hidden="true" tabindex="-1"></a>The main thing we're interested in here, though, is the average marginal effect of having a quota on the proportion of women in parliament, not just the 0/not 0 process. Since we've incorporated <span class="in">`quota`</span> in all the different parts of the model (the $\mu$, the $\phi$, and the zero-inflated $\alpha$), we should definitely once again simulate this value using **marginaleffects**—trying to get all the coefficients put together manually is going to be too tricky.</span>
<span id="cb72-1228"><a href="#cb72-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1229"><a href="#cb72-1229" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-ame-quota-zi}</span></span>
<span id="cb72-1230"><a href="#cb72-1230" aria-hidden="true" tabindex="-1"></a><span class="in">ame_beta_zi &lt;- model_beta_zi %&gt;%</span></span>
<span id="cb72-1231"><a href="#cb72-1231" aria-hidden="true" tabindex="-1"></a><span class="in">  avg_comparisons(variables = "quota") %&gt;% </span></span>
<span id="cb72-1232"><a href="#cb72-1232" aria-hidden="true" tabindex="-1"></a><span class="in">  posterior_draws()</span></span>
<span id="cb72-1233"><a href="#cb72-1233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1234"><a href="#cb72-1234" aria-hidden="true" tabindex="-1"></a><span class="in">ame_beta_zi %&gt;% median_hdi(draw)</span></span>
<span id="cb72-1235"><a href="#cb72-1235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1236"><a href="#cb72-1236" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(ame_beta_zi, aes(x = draw)) +</span></span>
<span id="cb72-1237"><a href="#cb72-1237" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",</span></span>
<span id="cb72-1238"><a href="#cb72-1238" aria-hidden="true" tabindex="-1"></a><span class="in">               fill = "#bc3032") +</span></span>
<span id="cb72-1239"><a href="#cb72-1239" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_pp) +</span></span>
<span id="cb72-1240"><a href="#cb72-1240" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Average marginal effect of having a gender-based\nquota on the proportion of women in parliament", y = NULL,</span></span>
<span id="cb72-1241"><a href="#cb72-1241" aria-hidden="true" tabindex="-1"></a><span class="in">       caption = "80% and 95% credible intervals shown in black") +</span></span>
<span id="cb72-1242"><a href="#cb72-1242" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean()</span></span>
<span id="cb72-1243"><a href="#cb72-1243" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1244"><a href="#cb72-1244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1245"><a href="#cb72-1245" aria-hidden="true" tabindex="-1"></a>The average marginal effect of having a quota on the proportion of women MPs in an average country, therefore, is 6.65 percentage points.</span>
<span id="cb72-1246"><a href="#cb72-1246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1247"><a href="#cb72-1247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1248"><a href="#cb72-1248" aria-hidden="true" tabindex="-1"></a><span class="fu">### Special case #1: Zero-one-inflated beta regression</span></span>
<span id="cb72-1249"><a href="#cb72-1249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1250"><a href="#cb72-1250" aria-hidden="true" tabindex="-1"></a>With our data here, no countries have parliaments with 100% women (cue <span class="co">[</span><span class="ot">that RBG "when there are nine" quote</span><span class="co">](https://bookshop.org/lists/when-there-are-nine-honoring-ruth-bader-ginsburg)</span>). But what if you have both 0s *and* 1s in your outcome? Zero-inflated beta regression handles the zeros just fine (it's in the name of the model!), but it can't handle both 0s and 1s.</span>
<span id="cb72-1251"><a href="#cb72-1251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1252"><a href="#cb72-1252" aria-hidden="true" tabindex="-1"></a>Fortunately there's a variation for zero-one-inflated beta (ZOIB) regression. I won't go into the details here—<span class="co">[</span><span class="ot">Matti Vuore has a phenomenal tutorial about how to run these models</span><span class="co">](https://mvuorre.github.io/posts/2019-02-18-analyze-analog-scale-ratings-with-zero-one-inflated-beta-models/)</span>. In short, ZOIB regression makes you model a mixture of *three* things: </span>
<span id="cb72-1253"><a href="#cb72-1253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1254"><a href="#cb72-1254" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>A logistic regression model that predicts if an outcome is either 0 or 1 or not 0 or 1, defined by $\alpha$ (or alternatively, a model that predicts if outcomes are extreme (0 or 1) or not (between 0 and 1); thanks to <span class="co">[</span><span class="ot">Isabella Ghement for this way of thinking about it</span><span class="co">](https://twitter.com/IsabellaGhement/status/1457789676387848205)</span>!)</span>
<span id="cb72-1255"><a href="#cb72-1255" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>A logistic regression model that predicts if any of the 0 or 1 outcomes are actually 1s, defined by $\gamma$ (or alternatively, a model that predicts if the extreme values are 1)</span>
<span id="cb72-1256"><a href="#cb72-1256" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>A beta regression model that predicts if an outcome is between 0 and 1 if it's not zero or not one, defined by $\mu$ and $\phi$ (or alternatively, a model that predicts the non-extreme (0 or 1) values)</span>
<span id="cb72-1257"><a href="#cb72-1257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1258"><a href="#cb72-1258" aria-hidden="true" tabindex="-1"></a>When using **brms**, you get to model all these different parts:</span>
<span id="cb72-1259"><a href="#cb72-1259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1260"><a href="#cb72-1260" aria-hidden="true" tabindex="-1"></a><span class="in">```{r example-zoi-model, eval=FALSE}</span></span>
<span id="cb72-1261"><a href="#cb72-1261" aria-hidden="true" tabindex="-1"></a><span class="in">brm(</span></span>
<span id="cb72-1262"><a href="#cb72-1262" aria-hidden="true" tabindex="-1"></a><span class="in">  bf(</span></span>
<span id="cb72-1263"><a href="#cb72-1263" aria-hidden="true" tabindex="-1"></a><span class="in">    outcome ~ covariates,  # The mean of the 0-1 values, or mu</span></span>
<span id="cb72-1264"><a href="#cb72-1264" aria-hidden="true" tabindex="-1"></a><span class="in">    phi ~ covariates,  # The precision of the 0-1 values, or phi</span></span>
<span id="cb72-1265"><a href="#cb72-1265" aria-hidden="true" tabindex="-1"></a><span class="in">    zoi ~ covariates,  # The zero-or-one-inflated part, or alpha</span></span>
<span id="cb72-1266"><a href="#cb72-1266" aria-hidden="true" tabindex="-1"></a><span class="in">    coi ~ covariates  # The one-inflated part, conditional on the 0s, or gamma</span></span>
<span id="cb72-1267"><a href="#cb72-1267" aria-hidden="true" tabindex="-1"></a><span class="in">  ),</span></span>
<span id="cb72-1268"><a href="#cb72-1268" aria-hidden="true" tabindex="-1"></a><span class="in">  data = whatever,</span></span>
<span id="cb72-1269"><a href="#cb72-1269" aria-hidden="true" tabindex="-1"></a><span class="in">  family = zero_one_inflated_beta(),</span></span>
<span id="cb72-1270"><a href="#cb72-1270" aria-hidden="true" tabindex="-1"></a><span class="in">  ...</span></span>
<span id="cb72-1271"><a href="#cb72-1271" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb72-1272"><a href="#cb72-1272" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1273"><a href="#cb72-1273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1274"><a href="#cb72-1274" aria-hidden="true" tabindex="-1"></a>Pulling out all these different parameters, plotting their distributions, and estimating their average marginal effects looks exactly the same as what we did earlier with the zero-inflated model—all the **brms**, **tidybayes**, and **marginaleffects** functions we used for marginal effects and fancy plots work the same. All the coefficients are on the logit scale, except $\phi$, which is on the log scale. </span>
<span id="cb72-1275"><a href="#cb72-1275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1276"><a href="#cb72-1276" aria-hidden="true" tabindex="-1"></a><span class="fu">### Special case #2: One-inflated beta regression</span></span>
<span id="cb72-1277"><a href="#cb72-1277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1278"><a href="#cb72-1278" aria-hidden="true" tabindex="-1"></a>What if your proportion-based outcome has a bunch of 1s and no 0s? It would be neat if there were a <span class="in">`one_inflated_beta()`</span> family, but there's not (<span class="co">[</span><span class="ot">also by design</span><span class="co">](https://github.com/paul-buerkner/brms/issues/942)</span>). But never fear! There are two ways to do one-inflated regression:</span>
<span id="cb72-1279"><a href="#cb72-1279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1280"><a href="#cb72-1280" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Reverse your outcome so that it's <span class="in">`1 - outcome`</span> instead of <span class="in">`outcome`</span> and then use zero-inflated regression. In the case of the proportion of women MPs, we would instead look at the proportion of not-women MPs:</span>
<span id="cb72-1281"><a href="#cb72-1281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1282"><a href="#cb72-1282" aria-hidden="true" tabindex="-1"></a><span class="in">```{r example-prop-reverse, eval=FALSE, indent="   "}</span></span>
<span id="cb72-1283"><a href="#cb72-1283" aria-hidden="true" tabindex="-1"></a><span class="in">mutate(prop_not_fem = 1 - prop_fem)</span></span>
<span id="cb72-1284"><a href="#cb72-1284" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1285"><a href="#cb72-1285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1286"><a href="#cb72-1286" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Use zero-one-inflated beta regression and force the conditional one parameter (<span class="in">`coi`</span>, or the $\gamma$ in that model) to be one, meaning that 100% of the 0/not 0 splits would actually be 1: <span class="in">`bf(..., coi = 1)`</span></span>
<span id="cb72-1287"><a href="#cb72-1287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1288"><a href="#cb72-1288" aria-hidden="true" tabindex="-1"></a>Everything else that we've explored in this post—posterior predictions, average marginal effects, etc.—will all work as expected.</span>
<span id="cb72-1289"><a href="#cb72-1289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1290"><a href="#cb72-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1291"><a href="#cb72-1291" aria-hidden="true" tabindex="-1"></a><span class="fu">## Super fancy detailed model with lots of moving parts, just for fun</span></span>
<span id="cb72-1292"><a href="#cb72-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1293"><a href="#cb72-1293" aria-hidden="true" tabindex="-1"></a>Throughout this post, for the sake of simplicity we've really only used one or two covariates at a time (<span class="in">`quota`</span> and/or <span class="in">`polyarchy`</span>). Real world models are more complex: we can use more covariates, multilevel hierarchical structures, or weighting, for instance. This all works just fine with zero|one|zero-one-inflated beta regression thanks to the power of **brms**, which handles all these extra features natively.</span>
<span id="cb72-1294"><a href="#cb72-1294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1295"><a href="#cb72-1295" aria-hidden="true" tabindex="-1"></a>Just for fun here at the end, let's run a more fully specified model with more covariates and a multilevel structure that accounts for year and region. This will let us look at the larger V-Dem dataset from 2010–2020 instead of just 2015.</span>
<span id="cb72-1296"><a href="#cb72-1296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1297"><a href="#cb72-1297" aria-hidden="true" tabindex="-1"></a><span class="fu">### Set better priors</span></span>
<span id="cb72-1298"><a href="#cb72-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1299"><a href="#cb72-1299" aria-hidden="true" tabindex="-1"></a>To make sure this runs as efficiently as possible, we'll set our own priors instead of relying on the default **brms** priors. This is especially important for beta models because of how parameters are used internally. Remember that most of our coefficients are on a logit scale, and those logits correspond to probabilities or proportions. While logits can theoretically range from −∞ to ∞, in practice they're a lot more limited. For instance, we can convert some small percentages to the logit scale with <span class="in">`qlogis()`</span>:</span>
<span id="cb72-1300"><a href="#cb72-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1301"><a href="#cb72-1301" aria-hidden="true" tabindex="-1"></a><span class="in">```{r probs-to-logits}</span></span>
<span id="cb72-1302"><a href="#cb72-1302" aria-hidden="true" tabindex="-1"></a><span class="in">qlogis(c(0.01, 0.001, 0.0001))</span></span>
<span id="cb72-1303"><a href="#cb72-1303" aria-hidden="true" tabindex="-1"></a><span class="in">qlogis(c(0.99, 0.999, 0.9999))</span></span>
<span id="cb72-1304"><a href="#cb72-1304" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1305"><a href="#cb72-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1306"><a href="#cb72-1306" aria-hidden="true" tabindex="-1"></a>A 1%/99% value is 4.6 as a logit, while 0.01%/99.99% is 9. Most of the proportions we've seen in the models so far are much smaller than that—logits of like ≈0–2 at most. By default, **brms** puts a flat prior on coefficients in beta regression, so values like 10 or 15 could occur, which are excessively massive when converted to probabilities! Look at this plot to see the relationship between the logit scale and the probability scale—there are big changes in probability between −4ish and 4ish, but once you start getting into the 5s and beyond, the probability is all essentially the same. </span>
<span id="cb72-1307"><a href="#cb72-1307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1308"><a href="#cb72-1308" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-dist-logit-prob, width=3}</span></span>
<span id="cb72-1309"><a href="#cb72-1309" aria-hidden="true" tabindex="-1"></a><span class="in">tibble(x = seq(-8, 8, by = 0.1)) %&gt;% </span></span>
<span id="cb72-1310"><a href="#cb72-1310" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(y = plogis(x)) %&gt;% </span></span>
<span id="cb72-1311"><a href="#cb72-1311" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = x, y = y)) +</span></span>
<span id="cb72-1312"><a href="#cb72-1312" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(size = 1) +</span></span>
<span id="cb72-1313"><a href="#cb72-1313" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Logit scale", y = "Probability scale") +</span></span>
<span id="cb72-1314"><a href="#cb72-1314" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean()</span></span>
<span id="cb72-1315"><a href="#cb72-1315" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1316"><a href="#cb72-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1317"><a href="#cb72-1317" aria-hidden="true" tabindex="-1"></a>To help speed up the model (and on philosophical grounds, since we know prior information about these model coefficients), we should tell **brms** that the logit-scale parameters in the model aren't ever going to get huge.</span>
<span id="cb72-1318"><a href="#cb72-1318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1319"><a href="#cb72-1319" aria-hidden="true" tabindex="-1"></a>To do this, we first need to define the formula for our fancy complex model. I added a bunch of plausible covariates to different portions of the model, along with random effects for region. In real life this should all be driven by theory.</span>
<span id="cb72-1320"><a href="#cb72-1320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1321"><a href="#cb72-1321" aria-hidden="true" tabindex="-1"></a><span class="in">```{r final-formula}</span></span>
<span id="cb72-1322"><a href="#cb72-1322" aria-hidden="true" tabindex="-1"></a><span class="in">vdem_clean &lt;- vdem_clean %&gt;% </span></span>
<span id="cb72-1323"><a href="#cb72-1323" aria-hidden="true" tabindex="-1"></a><span class="in">  # Scale polyarchy back down to 0-1 values to help Stan with modeling</span></span>
<span id="cb72-1324"><a href="#cb72-1324" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(polyarchy = polyarchy / 100) %&gt;% </span></span>
<span id="cb72-1325"><a href="#cb72-1325" aria-hidden="true" tabindex="-1"></a><span class="in">  # Make region and year factors instead of numbers</span></span>
<span id="cb72-1326"><a href="#cb72-1326" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(region = factor(region),</span></span>
<span id="cb72-1327"><a href="#cb72-1327" aria-hidden="true" tabindex="-1"></a><span class="in">         year = factor(year))</span></span>
<span id="cb72-1328"><a href="#cb72-1328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1329"><a href="#cb72-1329" aria-hidden="true" tabindex="-1"></a><span class="in"># Create the model formula</span></span>
<span id="cb72-1330"><a href="#cb72-1330" aria-hidden="true" tabindex="-1"></a><span class="in">fancy_formula &lt;- bf(</span></span>
<span id="cb72-1331"><a href="#cb72-1331" aria-hidden="true" tabindex="-1"></a><span class="in">  # mu (mean) part</span></span>
<span id="cb72-1332"><a href="#cb72-1332" aria-hidden="true" tabindex="-1"></a><span class="in">  prop_fem ~ quota + polyarchy + corruption + </span></span>
<span id="cb72-1333"><a href="#cb72-1333" aria-hidden="true" tabindex="-1"></a><span class="in">    civil_liberties + (1 | year) + (1 | region),</span></span>
<span id="cb72-1334"><a href="#cb72-1334" aria-hidden="true" tabindex="-1"></a><span class="in">  # phi (precision) part</span></span>
<span id="cb72-1335"><a href="#cb72-1335" aria-hidden="true" tabindex="-1"></a><span class="in">  phi ~ quota + (1 | year) + (1 | region),</span></span>
<span id="cb72-1336"><a href="#cb72-1336" aria-hidden="true" tabindex="-1"></a><span class="in">  # alpha (zero-inflation) part</span></span>
<span id="cb72-1337"><a href="#cb72-1337" aria-hidden="true" tabindex="-1"></a><span class="in">  zi ~ quota + polyarchy + (1 | year) + (1 | region)</span></span>
<span id="cb72-1338"><a href="#cb72-1338" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb72-1339"><a href="#cb72-1339" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1340"><a href="#cb72-1340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1341"><a href="#cb72-1341" aria-hidden="true" tabindex="-1"></a>We can then feed that formula to <span class="in">`get_prior()`</span> to see what the default priors are and how to change them:</span>
<span id="cb72-1342"><a href="#cb72-1342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1343"><a href="#cb72-1343" aria-hidden="true" tabindex="-1"></a><span class="in">```{r show-priors}</span></span>
<span id="cb72-1344"><a href="#cb72-1344" aria-hidden="true" tabindex="-1"></a><span class="in">get_prior(</span></span>
<span id="cb72-1345"><a href="#cb72-1345" aria-hidden="true" tabindex="-1"></a><span class="in">  fancy_formula,</span></span>
<span id="cb72-1346"><a href="#cb72-1346" aria-hidden="true" tabindex="-1"></a><span class="in">  data = vdem_clean,</span></span>
<span id="cb72-1347"><a href="#cb72-1347" aria-hidden="true" tabindex="-1"></a><span class="in">  family = zero_inflated_beta()</span></span>
<span id="cb72-1348"><a href="#cb72-1348" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb72-1349"><a href="#cb72-1349" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1350"><a href="#cb72-1350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1351"><a href="#cb72-1351" aria-hidden="true" tabindex="-1"></a>There are a *ton* of potential priors we can set here! If we really wanted, we could set the mean and standard deviation separately for each individual coefficient, but that's probably excessive for this case. </span>
<span id="cb72-1352"><a href="#cb72-1352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1353"><a href="#cb72-1353" aria-hidden="true" tabindex="-1"></a>You can see that everything with class <span class="in">`b`</span> (for β coefficient in a regression model) has a flat prior. We need to narrow that down, perhaps with something like a normal distribution centered at 0 with a standard deviation of 1. Values here won't get too big and will mostly be between −2 and 2:</span>
<span id="cb72-1354"><a href="#cb72-1354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1355"><a href="#cb72-1355" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-narrow-prior, width=3}</span></span>
<span id="cb72-1356"><a href="#cb72-1356" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = tibble(x = -4:4), aes(x = x)) +</span></span>
<span id="cb72-1357"><a href="#cb72-1357" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_function(fun = dnorm, args = list(mean = 0, sd = 1), linewidth = 1) +</span></span>
<span id="cb72-1358"><a href="#cb72-1358" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean()</span></span>
<span id="cb72-1359"><a href="#cb72-1359" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1360"><a href="#cb72-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1361"><a href="#cb72-1361" aria-hidden="true" tabindex="-1"></a>To set the priors, we can create a list of priors as a separate object that we can then feed to the main <span class="in">`brm()`</span> function. We'll keep the default prior for the intercepts.</span>
<span id="cb72-1362"><a href="#cb72-1362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1363"><a href="#cb72-1363" aria-hidden="true" tabindex="-1"></a><span class="in">```{r create-priors}</span></span>
<span id="cb72-1364"><a href="#cb72-1364" aria-hidden="true" tabindex="-1"></a><span class="in">priors &lt;- c(set_prior("student_t(3, 0, 2.5)", class = "Intercept"),</span></span>
<span id="cb72-1365"><a href="#cb72-1365" aria-hidden="true" tabindex="-1"></a><span class="in">            set_prior("normal(0, 1)", class = "b"))</span></span>
<span id="cb72-1366"><a href="#cb72-1366" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1367"><a href="#cb72-1367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1368"><a href="#cb72-1368" aria-hidden="true" tabindex="-1"></a><span class="fu">### Run the model</span></span>
<span id="cb72-1369"><a href="#cb72-1369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1370"><a href="#cb72-1370" aria-hidden="true" tabindex="-1"></a>Let's run the model! This will probably take a (long!) while to run. On my new 2021 MacBook Pro with a 10-core M1 Max CPU, running 4 chains with two CPU cores per chain (with **cmdstanr**'s [support for within-chain threading](https://cran.r-project.org/web/packages/brms/vignettes/brms_threading.html)) takes about 6 minutes. It probably takes a ***lot*** longer on a less powerful machine. To help Stan with estimation, I also set <span class="in">`init`</span> to help with some of the parameters of the beta distribution, and increased <span class="in">`adapt_delta`</span> and <span class="in">`max_treedepth`</span> a little. I only knew to do this because Stan complained when I used the defaults and told me to increase them :)</span>
<span id="cb72-1371"><a href="#cb72-1371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1372"><a href="#cb72-1372" aria-hidden="true" tabindex="-1"></a><span class="in">```{r model-fancy-bayes, results="hide", warning=FALSE}</span></span>
<span id="cb72-1373"><a href="#cb72-1373" aria-hidden="true" tabindex="-1"></a><span class="in">fancy_model &lt;- brm(</span></span>
<span id="cb72-1374"><a href="#cb72-1374" aria-hidden="true" tabindex="-1"></a><span class="in">  fancy_formula,</span></span>
<span id="cb72-1375"><a href="#cb72-1375" aria-hidden="true" tabindex="-1"></a><span class="in">  data = vdem_clean,</span></span>
<span id="cb72-1376"><a href="#cb72-1376" aria-hidden="true" tabindex="-1"></a><span class="in">  family = zero_inflated_beta(),</span></span>
<span id="cb72-1377"><a href="#cb72-1377" aria-hidden="true" tabindex="-1"></a><span class="in">  prior = priors,</span></span>
<span id="cb72-1378"><a href="#cb72-1378" aria-hidden="true" tabindex="-1"></a><span class="in">  init = 0,</span></span>
<span id="cb72-1379"><a href="#cb72-1379" aria-hidden="true" tabindex="-1"></a><span class="in">  control = list(adapt_delta = 0.97,</span></span>
<span id="cb72-1380"><a href="#cb72-1380" aria-hidden="true" tabindex="-1"></a><span class="in">                 max_treedepth = 12),</span></span>
<span id="cb72-1381"><a href="#cb72-1381" aria-hidden="true" tabindex="-1"></a><span class="in">  chains = 4, iter = 2000, warmup = 1000,</span></span>
<span id="cb72-1382"><a href="#cb72-1382" aria-hidden="true" tabindex="-1"></a><span class="in">  cores = 4, seed = 1234, </span></span>
<span id="cb72-1383"><a href="#cb72-1383" aria-hidden="true" tabindex="-1"></a><span class="in">  threads = threading(2),</span></span>
<span id="cb72-1384"><a href="#cb72-1384" aria-hidden="true" tabindex="-1"></a><span class="in">  backend = "cmdstanr",</span></span>
<span id="cb72-1385"><a href="#cb72-1385" aria-hidden="true" tabindex="-1"></a><span class="in">  file = "fancy_model"</span></span>
<span id="cb72-1386"><a href="#cb72-1386" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb72-1387"><a href="#cb72-1387" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1388"><a href="#cb72-1388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1389"><a href="#cb72-1389" aria-hidden="true" tabindex="-1"></a>There are a handful of divergent chains but since this isn't an actual model that I'd use in a publication, I'm not too worried. In real life, I'd increase the <span class="in">`adapt_delta`</span> or <span class="in">`max_treedepth`</span> parameters even more or do some other fine tuning, but we'll just live with the warnings for now.</span>
<span id="cb72-1390"><a href="#cb72-1390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1391"><a href="#cb72-1391" aria-hidden="true" tabindex="-1"></a><span class="fu">### Analyze and plot the results</span></span>
<span id="cb72-1392"><a href="#cb72-1392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1393"><a href="#cb72-1393" aria-hidden="true" tabindex="-1"></a>We now have a fully specified multilevel model with all sorts of rich moving parts: we account for the mean and precision of the beta distribution *and* we account for the zero-inflation process, all with different covariates with region-specific offsets. Here are the full results, with medians and 95% credible intervals for all the different coefficients:</span>
<span id="cb72-1394"><a href="#cb72-1394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1395"><a href="#cb72-1395" aria-hidden="true" tabindex="-1"></a><span class="in">```{r show-fancy-model, warning=FALSE}</span></span>
<span id="cb72-1396"><a href="#cb72-1396" aria-hidden="true" tabindex="-1"></a><span class="in">tidy(fancy_model)</span></span>
<span id="cb72-1397"><a href="#cb72-1397" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1398"><a href="#cb72-1398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1399"><a href="#cb72-1399" aria-hidden="true" tabindex="-1"></a>We can't really interpret any of these coefficients directly, since (1) they're on different scales (the <span class="in">`phi`</span> parts are all logged; all the other parts are logits), and (2) we need to combine coefficients with intercepts in order to back-transform them into percentage point values, and doing that mathematically is tricky.</span>
<span id="cb72-1400"><a href="#cb72-1400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1401"><a href="#cb72-1401" aria-hidden="true" tabindex="-1"></a>We'll focus on finding the marginal effect of <span class="in">`quota`</span>, since that's the main question we've been exploring throughout this post (and it was the subject of the original @TrippKang:2008 paper). For fun, we'll also look at <span class="in">`polyarchy`</span>, since it's a continuous variable.</span>
<span id="cb72-1402"><a href="#cb72-1402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1403"><a href="#cb72-1403" aria-hidden="true" tabindex="-1"></a>As before, **marginaleffects** makes it really easy to get posterior predictions of the difference between quota and no quota with <span class="in">`avg_comparisons()`</span></span>
<span id="cb72-1404"><a href="#cb72-1404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1405"><a href="#cb72-1405" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb72-1406"><a href="#cb72-1406" aria-hidden="true" tabindex="-1"></a><span class="fu">### More about these epreds and random effects</span></span>
<span id="cb72-1407"><a href="#cb72-1407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1408"><a href="#cb72-1408" aria-hidden="true" tabindex="-1"></a>A year after writing this post, I wrote a couple other guides about the <span class="co">[</span><span class="ot">differences between posterior predictions, linear predictions, and epreds</span><span class="co">](https://www.andrewheiss.com/blog/2022/09/26/guide-visualizing-types-posteriors/)</span> + <span class="co">[</span><span class="ot">different ways of handling random effects in predictions</span><span class="co">](https://www.andrewheiss.com/blog/2022/11/29/conditional-marginal-marginaleffects/)</span>. Check those out for more details.</span>
<span id="cb72-1409"><a href="#cb72-1409" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb72-1410"><a href="#cb72-1410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1411"><a href="#cb72-1411" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-ame-quota-fancy}</span></span>
<span id="cb72-1412"><a href="#cb72-1412" aria-hidden="true" tabindex="-1"></a><span class="in">ame_fancy_zi_quota &lt;- fancy_model %&gt;%</span></span>
<span id="cb72-1413"><a href="#cb72-1413" aria-hidden="true" tabindex="-1"></a><span class="in">  avg_comparisons(variables = "quota") %&gt;% </span></span>
<span id="cb72-1414"><a href="#cb72-1414" aria-hidden="true" tabindex="-1"></a><span class="in">  posterior_draws()</span></span>
<span id="cb72-1415"><a href="#cb72-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1416"><a href="#cb72-1416" aria-hidden="true" tabindex="-1"></a><span class="in">ame_fancy_zi_quota %&gt;% median_hdi(draw)</span></span>
<span id="cb72-1417"><a href="#cb72-1417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1418"><a href="#cb72-1418" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(ame_fancy_zi_quota, aes(x = draw)) +</span></span>
<span id="cb72-1419"><a href="#cb72-1419" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_halfeye(.width = c(0.8, 0.95), point_interval = "median_hdi",</span></span>
<span id="cb72-1420"><a href="#cb72-1420" aria-hidden="true" tabindex="-1"></a><span class="in">               fill = "#bc3032") +</span></span>
<span id="cb72-1421"><a href="#cb72-1421" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(labels = label_pp) +</span></span>
<span id="cb72-1422"><a href="#cb72-1422" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Average marginal effect of having a gender-based\nquota on the proportion of women in parliament", y = NULL,</span></span>
<span id="cb72-1423"><a href="#cb72-1423" aria-hidden="true" tabindex="-1"></a><span class="in">       caption = "80% and 95% credible intervals shown in black") +</span></span>
<span id="cb72-1424"><a href="#cb72-1424" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean()</span></span>
<span id="cb72-1425"><a href="#cb72-1425" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1426"><a href="#cb72-1426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1427"><a href="#cb72-1427" aria-hidden="true" tabindex="-1"></a><span class="in">```{r extract-fancy}</span></span>
<span id="cb72-1428"><a href="#cb72-1428" aria-hidden="true" tabindex="-1"></a><span class="in">r_fancy &lt;- ame_fancy_zi_quota %&gt;% median_hdi(draw)</span></span>
<span id="cb72-1429"><a href="#cb72-1429" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1430"><a href="#cb72-1430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1431"><a href="#cb72-1431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1432"><a href="#cb72-1432" aria-hidden="true" tabindex="-1"></a>After accounting for democracy, corruption, respect for civil liberties, year, and region, the proportion of women MPs in countries with a parliamentary gender quota is <span class="in">`r round(r_fancy$draw * 100, 1)`</span> percentage points higher than in countries without a quota, on average, with a 95% credible interval ranging from <span class="in">`r round(r_fancy$.lower * 100, 1)`</span> to <span class="in">`r round(r_fancy$.upper * 100, 1)`</span> percentage points.</span>
<span id="cb72-1433"><a href="#cb72-1433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1434"><a href="#cb72-1434" aria-hidden="true" tabindex="-1"></a>For fun, we can look at how the predicted outcome changes across both <span class="in">`polyarchy`</span> and <span class="in">`quota`</span> simultaneously (and for fun we'll do it with **marginaleffects**, though it's also doable with `tidybayes::epred_draws() %&gt;% compare_levels()`). Because we didn't use any interaction terms, the slope will be the same across both levels of `quota`, but the plot still looks neat. Weirdly, due to the constellation of controls we included in the model, the predicted proportion of women MPs *decreases* with more democracy. But that's not super important—if we were really only interested in the quota effect and we had included a sufficient set of variables to close backdoor paths, the coefficients for all other variables shouldn't be interpreted [@KeeleStevensonElwert:2020]. We'll pretend that's the case here—this code mostly just shows how you can do all sorts of neat stuff with **marginaleffects**.</span>
<span id="cb72-1435"><a href="#cb72-1435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1436"><a href="#cb72-1436" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-ame-quota-polyarchy-fancy, cache=TRUE, warning=FALSE}</span></span>
<span id="cb72-1437"><a href="#cb72-1437" aria-hidden="true" tabindex="-1"></a><span class="in">ame_fancy_zi_polyarchy_quota &lt;- fancy_model %&gt;% </span></span>
<span id="cb72-1438"><a href="#cb72-1438" aria-hidden="true" tabindex="-1"></a><span class="in">  predictions(newdata = datagrid(quota = unique,</span></span>
<span id="cb72-1439"><a href="#cb72-1439" aria-hidden="true" tabindex="-1"></a><span class="in">                                 polyarchy = seq(0, 1, by = 0.1))) %&gt;% </span></span>
<span id="cb72-1440"><a href="#cb72-1440" aria-hidden="true" tabindex="-1"></a><span class="in">  posterior_draws() %&gt;% </span></span>
<span id="cb72-1441"><a href="#cb72-1441" aria-hidden="true" tabindex="-1"></a><span class="in">  # Scale polyarchy back up for plotting</span></span>
<span id="cb72-1442"><a href="#cb72-1442" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(polyarchy = polyarchy * 100)</span></span>
<span id="cb72-1443"><a href="#cb72-1443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1444"><a href="#cb72-1444" aria-hidden="true" tabindex="-1"></a><span class="in"># With tidybayes instead</span></span>
<span id="cb72-1445"><a href="#cb72-1445" aria-hidden="true" tabindex="-1"></a><span class="in"># ame_fancy_zi_polyarchy_quota &lt;- fancy_model %&gt;%</span></span>
<span id="cb72-1446"><a href="#cb72-1446" aria-hidden="true" tabindex="-1"></a><span class="in">#   epred_draws(newdata = datagrid(model = fancy_model, </span></span>
<span id="cb72-1447"><a href="#cb72-1447" aria-hidden="true" tabindex="-1"></a><span class="in">#                                  quota = unique, </span></span>
<span id="cb72-1448"><a href="#cb72-1448" aria-hidden="true" tabindex="-1"></a><span class="in">#                                  polyarchy = seq(0, 1, by = 0.1)))</span></span>
<span id="cb72-1449"><a href="#cb72-1449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1450"><a href="#cb72-1450" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(ame_fancy_zi_polyarchy_quota,</span></span>
<span id="cb72-1451"><a href="#cb72-1451" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(x = polyarchy, y = draw, color = quota, fill = quota)) +</span></span>
<span id="cb72-1452"><a href="#cb72-1452" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_lineribbon(aes(fill_ramp = stat(level))) +</span></span>
<span id="cb72-1453"><a href="#cb72-1453" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(labels = label_percent()) +</span></span>
<span id="cb72-1454"><a href="#cb72-1454" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_viridis_d(option = "plasma", end = 0.8) +</span></span>
<span id="cb72-1455"><a href="#cb72-1455" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_viridis_d(option = "plasma", end = 0.8) +</span></span>
<span id="cb72-1456"><a href="#cb72-1456" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_ramp_discrete(range = c(0.2, 0.7)) +</span></span>
<span id="cb72-1457"><a href="#cb72-1457" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(quota), ncol = 2,</span></span>
<span id="cb72-1458"><a href="#cb72-1458" aria-hidden="true" tabindex="-1"></a><span class="in">             labeller = labeller(quota = c(`TRUE` = "Quota",</span></span>
<span id="cb72-1459"><a href="#cb72-1459" aria-hidden="true" tabindex="-1"></a><span class="in">                                           `FALSE` = "No Quota"))) +</span></span>
<span id="cb72-1460"><a href="#cb72-1460" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Polyarchy (democracy)",</span></span>
<span id="cb72-1461"><a href="#cb72-1461" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Predicted proportion of women MPs",</span></span>
<span id="cb72-1462"><a href="#cb72-1462" aria-hidden="true" tabindex="-1"></a><span class="in">       fill = "Quota", color = "Quota",</span></span>
<span id="cb72-1463"><a href="#cb72-1463" aria-hidden="true" tabindex="-1"></a><span class="in">       fill_ramp = "Credible interval") +</span></span>
<span id="cb72-1464"><a href="#cb72-1464" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_clean() +</span></span>
<span id="cb72-1465"><a href="#cb72-1465" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb72-1466"><a href="#cb72-1466" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb72-1467"><a href="#cb72-1467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1468"><a href="#cb72-1468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1469"><a href="#cb72-1469" aria-hidden="true" tabindex="-1"></a><span class="fu">## References</span></span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p><span class="faux-block">Forked from <a href="https://www.andrewheiss.com/">Andrew Heiss</a></span> # <span class="faux-block"><a href="https://github.com/andrewheiss/ath-quarto">View the source at <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></span></p>
</div>
  </div>
</footer>


</body></html>