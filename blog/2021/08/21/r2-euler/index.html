<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Hong T.M. Chu">
<meta name="description" content="Use Venn diagrams to visualize the proportion of an outcome explained by a regression model">
<title>Exploring R² and regression variance with Euler/Venn diagrams | Hong T.M. Chu – Hong T.M. Chu</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../../">
<link href="../../../../..//files/favicon-512.png" rel="icon" type="image/png">
<script src="../../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting-17c909d5fd25ae21b861c0c7a49b2096.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../site_libs/bootstrap/bootstrap-5cd0811f461c8271ae6bab49df9501be.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script src="../../../../../site_libs/quarto-contrib/iconify-2.0.0/iconify-icon.min.js"></script><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-527449-5', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script><style>

      .quarto-title-block .quarto-title-banner {
        background: #170C3A;
      }
</style>
<script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
<meta property="og:title" content="Exploring R² and regression variance with Euler/Venn diagrams | Hong T.M. Chu">
<meta property="og:description" content="Use Venn diagrams to visualize the proportion of an outcome explained by a regression model">
<meta property="og:image" content="https://www.andrewheiss.com/blog/2021/08/21/r2-euler/index_files/figure-html/nice-plot-1.png">
<meta property="og:site_name" content="Hong T.M. Chu">
<meta property="og:locale" content="en_US">
<meta property="og:image:height" content="1728">
<meta property="og:image:width" content="1440">
<meta name="twitter:title" content="Exploring R² and regression variance with Euler/Venn diagrams | Hong T.M. Chu">
<meta name="twitter:description" content="Use Venn diagrams to visualize the proportion of an outcome explained by a regression model">
<meta name="twitter:image" content="https://www.andrewheiss.com/blog/2021/08/21/r2-euler/index_files/figure-html/nice-plot-1.png">
<meta name="twitter:creator" content="@andrewheiss">
<meta name="twitter:site" content="@andrewheiss">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image-height" content="1728">
<meta name="twitter:image-width" content="1440">
</head>
<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../../index.html">
    <span class="navbar-title">Hong T.M. Chu</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../../../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../cv/index.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../research/index.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../teaching/index.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="mailto:hong.ctm@vinuni.edu.vn"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:envelope" style="font-size: 1.1em;" aria-label="Icon envelope from bi Iconify.design set." title="E-mail"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/andrewheiss" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:github" style="font-size: 1.1em;" aria-label="Icon github from bi Iconify.design set." title="GitHub"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/hongtmchu" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:linkedin" style="font-size: 1.1em;" aria-label="Icon linkedin from bi Iconify.design set." title="LinkedIn"></iconify-icon></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default blog-post page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Exploring R² and regression variance with Euler/Venn diagrams</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
                  <div>
        <div class="description">
          Use Venn diagrams to visualize the proportion of an outcome explained by a regression model
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">r</div>
                <div class="quarto-category">tidyverse</div>
                <div class="quarto-category">regression</div>
                <div class="quarto-category">statistics</div>
                <div class="quarto-category">data visualization</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://www.andrewheiss.com/">Andrew Heiss</a> <a href="https://orcid.org/0000-0002-3948-3914" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">Saturday, August 21, 2021</p>
      </div>
    </div>
    
      
      <div>
      <div class="quarto-title-meta-heading">Doi</div>
      <div class="quarto-title-meta-contents">
        <p class="doi">
          <a href="https://doi.org/10.59350/t57vy-p5115">10.59350/t57vy-p5115</a>
        </p>
      </div>
    </div>
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Contents</h2>
   
  <ul>
<li>
<a href="#regression-as-overlapping-circles" id="toc-regression-as-overlapping-circles" class="nav-link active" data-scroll-target="#regression-as-overlapping-circles">Regression as overlapping circles</a>
  <ul class="collapse">
<li><a href="#relationship-between-two-variables" id="toc-relationship-between-two-variables" class="nav-link" data-scroll-target="#relationship-between-two-variables">Relationship between two variables</a></li>
  <li><a href="#relationship-between-three-variables" id="toc-relationship-between-three-variables" class="nav-link" data-scroll-target="#relationship-between-three-variables">Relationship between three variables</a></li>
  <li><a href="#nicer-plot" id="toc-nicer-plot" class="nav-link" data-scroll-target="#nicer-plot">Nicer plot</a></li>
  <li><a href="#multicollinearity" id="toc-multicollinearity" class="nav-link" data-scroll-target="#multicollinearity">Multicollinearity</a></li>
  </ul>
</li>
  <li><a href="#why-this-matters" id="toc-why-this-matters" class="nav-link" data-scroll-target="#why-this-matters">Why this matters</a></li>
  <li><a href="#caveats" id="toc-caveats" class="nav-link" data-scroll-target="#caveats">Caveats</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></nav>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><p>Regression is the core of my <a href="https://statsf18.classes.andrewheiss.com/">statistics</a> and <a href="https://evalf21.classes.andrewheiss.com/">program evaluation/causal inference</a> courses. As I’ve taught different stats classes, I’ve found that one of the regression diagnostic statistics that students really glom onto is <span class="math inline">\(R^2\)</span>. Unlike lots of regression diagnostics like AIC, BIC, and the joint F-statistic, <span class="math inline">\(R^2\)</span> has a really intuitive interpretation—it’s the percent of variation in the outcome variable explained by all the explanatory variables. For instance, let’s explain global life expectancy using GDP per capita, based on data from <a href="https://www.gapminder.org/">the Gapminder project</a>. Here’s the basic model:</p>
<p><span class="math display">\[
\widehat{\text{Life expectancy}} = \beta_0 + \beta_1 \text{GDP per capita} + \epsilon
\]</span></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>     <span class="co"># For ggplot, dplyr, and friends</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span>         <span class="co"># For converting models into data frames</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jennybc/gapminder">gapminder</a></span><span class="op">)</span>     <span class="co"># For health and wealth data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/debruine/faux">faux</a></span><span class="op">)</span>          <span class="co"># For generating fake data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jolars/eulerr">eulerr</a></span><span class="op">)</span>        <span class="co"># For creating Euler and Venn diagrams</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Just look at 2007</span></span>
<span><span class="va">gapminder_2007</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span></span>
<span><span class="va">super_naive_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">lifeExp</span> <span class="op">~</span> <span class="va">gdpPercap</span>, data <span class="op">=</span> <span class="va">gapminder_2007</span><span class="op">)</span></span>
<span><span class="fu">tidy</span><span class="op">(</span><span class="va">super_naive_model</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 2 × 5</span></span>
<span><span class="co">##   term         estimate std.error statistic   p.value</span></span>
<span><span class="co">##   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">## 1 (Intercept) 59.6      1.01           59.0 9.89e-101</span></span>
<span><span class="co">## 2 gdpPercap    0.000637 0.0000583      10.9 1.69e- 20</span></span>
<span><span class="fu">glance</span><span class="op">(</span><span class="va">super_naive_model</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 12</span></span>
<span><span class="co">##   r.squared adj.r.squared sigma statistic  p.value    df logLik   AIC   BIC deviance</span></span>
<span><span class="co">##       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">## 1     0.461         0.457  8.90      120. 1.69e-20     1  -511. 1028. 1037.   11086.</span></span>
<span><span class="co">## # ℹ 2 more variables: df.residual &lt;int&gt;, nobs &lt;int&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is an awful model on theoretical grounds, but whatever. A $1 increase in GDP per capita is associated with a 0.001 year increase in life expectancy, on average. Look at all those diagnostics though—AIC? BIC? LogLik? Those are important, but definitely not intuitive. The <span class="math inline">\(R^2\)</span> value, on the other hand, is nice and interpretable. GDP per capita explains 46.1% of the variation in life expectancy. That’s soundbite-worthy. Students love it.</p>
<p>People also love to critique models based on it. In my program evaluation class, a model in one of my problem sets has an <span class="math inline">\(R^2\)</span> of 0.02, and without fail, a majority of students dismiss it because of its low explanatory power. It only explains 2% of the variation in the outcome! It must be junk!</p>
<p>But low <span class="math inline">\(R^2\)</span>s aren’t necessarily bad. And while saying that a model explains X% of the variation in an outcome, what does that even mean in practice?</p>
<p>So how the heck does <span class="math inline">\(R^2\)</span> work anyway? I’ve struggled teaching this, but recently a friend mentioned that she teaches students to imagine <span class="math inline">\(R^2\)</span> as a combination of overlapping circles, or a type of Venn diagram. I’d never heard of this approach before, so I went down a really interesting rabbit hole to discover that this approach has actually been used for decades! Let’s go down that rabbit hole together!</p>
<section id="regression-as-overlapping-circles" class="level2"><h2 class="anchored" data-anchor-id="regression-as-overlapping-circles">Regression as overlapping circles</h2>
<p>The earliest example I found is <span class="citation" data-cites="CohenCohen:1975">Cohen and Cohen (<a href="#ref-CohenCohen:1975" role="doc-biblioref">1975</a>)</span>, who proposed visualizing the shared variance between 2–3 variables as a “ballantine” graph (apparently named after <a href="https://en.wikipedia.org/wiki/P._Ballantine_and_Sons_Brewing_Company">an ale logo</a>?), or what we call nowadays a Venn or Euler diagram. Others refined their approach, like <span class="citation" data-cites="Hunt:1986">Hunt (<a href="#ref-Hunt:1986" role="doc-biblioref">1986</a>)</span> who provides all sorts of fancy geometric equations to make them accurate (and provides some neat vintage Pascal code in the appendix!), and <span class="citation" data-cites="Ip:2001">Ip (<a href="#ref-Ip:2001" role="doc-biblioref">2001</a>)</span>, who shows a bunch of different examples and highlights some of the limitations of using this approach.</p>
<p>For this ongoing example, we’ll simulate some correlated data using <a href="https://debruine.github.io/faux/">the <strong>faux</strong> package</a>. We could use real data, but as you’ll see, these diagrams are pretty finicky and fragile and generally need very tame data to work. Here we’ll create data with three variables that are normally distributed with these parameters:</p>
<ul>
<li>
<code>Y</code>: mean = 10, sd = 2</li>
<li>
<code>X1</code>: mean = 9, sd = 1.7</li>
<li>
<code>X2</code>: mean = 9, sd = 1.3</li>
</ul>
<p>We’ll make <code>Y</code> and <code>X1</code> be correlated at r = 0.5, <code>Y</code> and <code>X2</code> correlated at r = 0.3, and <code>X1</code> and <code>X2</code> correlated at r = 0.4:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">rnorm_multi</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                  mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>                  sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1.7</span>, <span class="fl">1.3</span><span class="op">)</span>,</span>
<span>                  r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span><span class="op">)</span>,</span>
<span>                  varnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Y"</span>, <span class="st">"X1"</span>, <span class="st">"X2"</span><span class="op">)</span>,</span>
<span>                  empirical <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Look at the first few rows</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">##       Y    X1    X2</span></span>
<span><span class="co">## 1  8.22  6.73  8.38</span></span>
<span><span class="co">## 2 10.17  9.36 10.12</span></span>
<span><span class="co">## 3 12.03 10.32  9.86</span></span>
<span><span class="co">## 4  5.41  5.80  8.38</span></span>
<span><span class="co">## 5 10.10 10.08 10.09</span></span>
<span><span class="co">## 6 11.13  9.11  9.94</span></span>
<span></span>
<span><span class="co"># Check if the correlations worked</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">##        Y    X1    X2</span></span>
<span><span class="co">## Y  1.000 0.453 0.373</span></span>
<span><span class="co">## X1 0.453 1.000 0.468</span></span>
<span><span class="co">## X2 0.373 0.468 1.000</span></span>
<span><span class="co"># Close enough!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In these regression diagrams, each variable is shown as a circle sized according to its variance, or:</p>
<p><span class="math display">\[
\operatorname{var} = \sigma^2 = \frac{\sum (\color{gray}{\overbrace{\color{black}{x_i}}^{\substack{\text{Single} \\ \text{value}}}} - \color{gray}{\overbrace{\color{black}{\bar{x}}}^{\substack{\text{Mean of} \\ \text{all values}}}\color{black}{)^2}}}{\color{gray}{\underbrace{\color{black}{n}}_{\substack{\text{Sample} \\ \text{size}}}}-1}
\]</span></p>
<p>According to <span class="citation" data-cites="Ip:2001">Ip (<a href="#ref-Ip:2001" role="doc-biblioref">2001</a>)</span>, you can also size the circles based on just the numerator of that equation, or the sum-of-squares, which is the same value proportionally number (it’s just not divided by <span class="math inline">\(n-1\)</span>). It’s also easier to work with when plotting, so that’s what we’ll use throughout this example.</p>
<p><span class="math display">\[
\color{gray}{\overbrace{\color{black}{{\scriptstyle\sum} (x_i - \bar{x})^2}}^{\text{Sum of squares}}}
\]</span></p>
<p>We can even make a little function to calculate the sum of squares for us:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Sum of squares, or the numerator of the variance equation</span></span>
<span><span class="va">ss</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Enough math, though—let’s make some plots! We’ll use <a href="https://cran.r-project.org/web/packages/eulerr/vignettes/introduction.html">the <strong>eulerr</strong> package</a> for this, since (1) it calculates proportional overlaps between circles (that’s the key technical difference between Venn and Euler diagram—Venn diagrams are supposed to have equally sized overlapping areas), and (2) it uses grid graphics, so it fits nicely in the ggplot ecosystem.</p>
<section id="relationship-between-two-variables" class="level3"><h3 class="anchored" data-anchor-id="relationship-between-two-variables">Relationship between two variables</h3>
<p>First let’s just look at the relationship between <code>Y</code> and <code>X1</code>. We’ll use the sum of squares to calculate the size for each circle:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ss_y</span> <span class="op">&lt;-</span> <span class="fu">ss</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span></span>
<span><span class="va">ss_x1</span> <span class="op">&lt;-</span> <span class="fu">ss</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">X1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">euler</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Y"</span> <span class="op">=</span> <span class="va">ss_y</span>,</span>
<span>             <span class="st">"X1"</span> <span class="op">=</span> <span class="va">ss_x1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     quantities <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/unrelated-vars-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>
<p>Just looking at this plot, we can see that <code>Y</code> has more variation than <code>X1</code>. Neat.</p>
<p>These two variables are related to each other though and have some covariance. We can calculate the shared covariance using <a href="https://en.wikipedia.org/wiki/Analysis_of_variance">ANOVA</a>. Ordinarily you need to feed R’s <code><a href="https://rdrr.io/r/stats/anova.html">anova()</a></code> function an <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> object to calculate different variance statistics (e.g.&nbsp;<code>anova(lm(Y ~ X1, data = df))</code>), but to save some typing, you can also use the <code><a href="https://rdrr.io/r/stats/aov.html">aov()</a></code> function to skip the intermediate <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> step. The nice thing about using the sum of squares values for these diagrams rather than variance values is that <code><a href="https://rdrr.io/r/stats/aov.html">aov()</a></code> reports its results as sums of squares, so we can use those results directly.</p>
<p>Let’s see how much of the variation between <code>Y</code> and <code>X1</code> is shared:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X1</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">##    aov(formula = Y ~ X1, data = df)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Terms:</span></span>
<span><span class="co">##                  X1 Residuals</span></span>
<span><span class="co">## Sum of Squares   82       318</span></span>
<span><span class="co">## Deg. of Freedom   1        98</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 1.8</span></span>
<span><span class="co">## Estimated effects may be unbalanced</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we look at the sum of squares row, we can see that 81.98 sum-of-squares units (whatever those mean) are shared between the two variables, with 317.87 not shared (or residual). To plot this overlap, we need to do a little bit of set theory math. We can’t just tell <code>Y</code> to be 399 units big—we need to subtract the shared space from both <code>Y</code> and <code>X1</code>. We’ll extract the sum of squares value from <code><a href="https://rdrr.io/r/stats/aov.html">aov()</a></code> (using <code>broom::tidy()</code> to make this easier):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ss_both_y_x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X1</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X1"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">sumsq</span><span class="op">)</span></span>
<span><span class="va">ss_both_y_x1</span></span>
<span><span class="co">## [1] 82</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">euler</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Y"</span> <span class="op">=</span> <span class="va">ss_y</span> <span class="op">-</span> <span class="va">ss_both_y_x1</span>,</span>
<span>             <span class="st">"X1"</span> <span class="op">=</span> <span class="va">ss_x1</span> <span class="op">-</span> <span class="va">ss_both_y_x1</span>,</span>
<span>             <span class="st">"Y&amp;X1"</span> <span class="op">=</span> <span class="va">ss_both_y_x1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     quantities <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-basic-overlap-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>
<p>Now we can visualize the covariance between these two variables! Let’s get rid of the raw numbers and add some letters for the different segments:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">euler</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Y"</span> <span class="op">=</span> <span class="va">ss_y</span> <span class="op">-</span> <span class="va">ss_both_y_x1</span>,</span>
<span>             <span class="st">"X1"</span> <span class="op">=</span> <span class="va">ss_x1</span> <span class="op">-</span> <span class="va">ss_both_y_x1</span>,</span>
<span>             <span class="st">"Y&amp;X1"</span> <span class="op">=</span> <span class="va">ss_both_y_x1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     quantities <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-basic-overlap-labels-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>
<p>Area C here represents the amount of variation in <code>Y</code> explained by <code>X1</code>, while Area A represents the unexplained portion of <code>Y</code>. In regression language, A is basically the error term:</p>
<p><span class="math display">\[
\hat{Y} = \beta_0 + \beta_1 X_1 + \color{gray}{\overbrace{\epsilon}^{\color{black}{\text{A}}}}
\]</span></p>
<p>The great thing about visualizing this is that C also represents the <span class="math inline">\(R^2\)</span>! In general, <span class="math inline">\(R^2\)</span> is the ratio between explained and total variance:</p>
<p><span class="math display">\[
R^2 = \frac{\text{Explained variance in }Y}{\text{Total variance in }Y}
\]</span></p>
<p>Based on this diagram, we can write this as:</p>
<p><span class="math display">\[
R^2 = \frac{C}{A + C}
\]</span></p>
<p>Using actual numbers, we get</p>
<p><span class="math display">\[
R^2 = \frac{81.98}{317.87 + 81.98} = 0.205
\]</span></p>
<p>We can do this more precisely with code:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">part_a</span> <span class="op">&lt;-</span> <span class="va">ss_y</span> <span class="op">-</span> <span class="va">ss_both_y_x1</span></span>
<span><span class="va">part_c</span> <span class="op">&lt;-</span> <span class="va">ss_both_y_x1</span></span>
<span></span>
<span><span class="va">part_c</span> <span class="op">/</span> <span class="op">(</span><span class="va">part_a</span> <span class="op">+</span> <span class="va">part_c</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.205</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>According to this, <code>X1</code> explains 20.5% of the variation in <code>Y</code>. That’s apparent visually—the overlapping space covers about 20% of the total <code>Y</code> circle.</p>
<p>Let’s run a regression model and check the <span class="math inline">\(R^2\)</span> value to see if it’s the same:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X1</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">glance</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">r.squared</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.205</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Incredible!! It’s the same! That’s so cool.</p>
</section><section id="relationship-between-three-variables" class="level3"><h3 class="anchored" data-anchor-id="relationship-between-three-variables">Relationship between three variables</h3>
<p>Where this gets even more useful is when we look at the overlapping space between three different variables. It’s also a little more complicated, since we need to calculate a bunch of different shared variances and do some set theory calculations to find the exact size of these different slivers of the diagram. Here’s a general diagram of what we’ll be calculating (this is unrelated to the data we’ve been working with and doesn’t use any actual numbers—it’s just a reference so we can find which shared variances we need to calculate):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">euler</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Y"</span> <span class="op">=</span> <span class="fl">4</span>,</span>
<span>             <span class="st">"X1"</span> <span class="op">=</span> <span class="fl">4</span>,</span>
<span>             <span class="st">"X2"</span> <span class="op">=</span> <span class="fl">4</span>,</span>
<span>             <span class="st">"X1&amp;Y"</span> <span class="op">=</span> <span class="fl">2</span>,</span>
<span>             <span class="st">"X2&amp;Y"</span> <span class="op">=</span> <span class="fl">2</span>,</span>
<span>             <span class="st">"X1&amp;X2"</span> <span class="op">=</span> <span class="fl">2</span>,</span>
<span>             <span class="st">"Y&amp;X1&amp;X2"</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     quantities <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-generic-3-rings-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>
<p>This looks complicated, but the same principles apply. The entire circles for <code>Y</code>, <code>X1</code>, and <code>X2</code> represent each variable’s total variance. Overlapping areas represent shared variance. For instance, the combination of D and G here (or <span class="math inline">\(A \cap B\)</span>) is the covariance that we calculated previously. The <span class="math inline">\(R^2\)</span> is still here too—the total explained variance in <code>Y</code> is the combination of D, E, and G, while A is the residual unexplained variance. That means we can calculate <span class="math inline">\(R^2\)</span> like this:</p>
<p><span class="math display">\[
\frac{D + E + G}{A + D + E + G}
\]</span></p>
<p>This visualization also helps with the intuition of <span class="math inline">\(R^2\)</span>. Generally when you add additional variables to a regression model, the <span class="math inline">\(R^2\)</span> increases. That’s because you’re adding another circle to the diagram and absorbing more of the variation in the outcome. For instance, even though the numbers in this diagram aren’t to scale at all, you can see that (D + G) (the <span class="math inline">\(R^2\)</span> that we calculated in the two-variable diagram) is smaller than (D + E + G). There’s more explained variance here.</p>
<p>To calculate the actual values for each of these segments, we’ll use <code><a href="https://rdrr.io/r/stats/aov.html">aov()</a></code> again to find the shared variance. This will involve a lot of different calculations and some algebra to isolate each segment. This table will help us keep everything straight:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 31%">
<col style="width: 50%">
<col style="width: 18%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Segment</th>
<th style="text-align: left;">Explanation</th>
<th style="text-align: left;">Code or algebra</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">A + D + E + G</td>
<td style="text-align: left;">Total variation in <code>Y</code>
</td>
<td style="text-align: left;">
<code>ss(df$Y)</code> or <code>aov(Y ~ 1)</code>
</td>
</tr>
<tr class="even">
<td style="text-align: left;">B + D + F + G</td>
<td style="text-align: left;">Total variation in <code>X1</code>
</td>
<td style="text-align: left;">
<code>ss(df$X1)</code> or <code>aov(X1 ~ 1)</code>
</td>
</tr>
<tr class="odd">
<td style="text-align: left;">C + E + F + G</td>
<td style="text-align: left;">Total variation in <code>X2</code>
</td>
<td style="text-align: left;">
<code>ss(df$X2)</code> or <code>aov(X2 ~ 1)</code>
</td>
</tr>
<tr class="even">
<td style="text-align: left;">A</td>
<td style="text-align: left;">Unexplained variation in <code>Y</code> after accounting for <code>X1</code> and <code>X2</code>
</td>
<td style="text-align: left;">Residuals from <code>aov(Y ~ X2 + X1)</code>
</td>
</tr>
<tr class="odd">
<td style="text-align: left;">B</td>
<td style="text-align: left;">Unexplained variation in <code>X1</code> after accounting for <code>Y</code> and <code>X2</code>
</td>
<td style="text-align: left;">Residuals from <code>aov(X1 ~ Y + X2)</code>
</td>
</tr>
<tr class="even">
<td style="text-align: left;">C</td>
<td style="text-align: left;">Unexplained variation in <code>X2</code> after accounting for <code>Y</code> and <code>X1</code>
</td>
<td style="text-align: left;">Residuals from <code>aov(X2 ~ Y + X1)</code>
</td>
</tr>
<tr class="odd">
<td style="text-align: left;">D + G</td>
<td style="text-align: left;">Variance shared by <code>Y</code> and <code>X1</code>
</td>
<td style="text-align: left;">
<code>X1</code> in <code>aov(Y ~ X1)</code>
</td>
</tr>
<tr class="even">
<td style="text-align: left;">E + G</td>
<td style="text-align: left;">Variance shared by <code>Y</code> and <code>X2</code>
</td>
<td style="text-align: left;">
<code>X2</code> in <code>aov(Y ~ X2)</code>
</td>
</tr>
<tr class="odd">
<td style="text-align: left;">D + G</td>
<td style="text-align: left;">Variance shared by <code>X1</code> and <code>X2</code>
</td>
<td style="text-align: left;">
<code>X2</code> in <code>aov(X1 ~ X2)</code>
</td>
</tr>
<tr class="even">
<td style="text-align: left;">D</td>
<td style="text-align: left;">Variance <em>only</em> between <code>Y</code> and <code>X1</code>, without influence from <code>X2</code>
</td>
<td style="text-align: left;">(A + D + E + G) − A − (E + G)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">E</td>
<td style="text-align: left;">Variance <em>only</em> between <code>Y</code> and <code>X2</code>, without influence from <code>X1</code>
</td>
<td style="text-align: left;">(C + E + F + G) − C − (F + G)</td>
</tr>
<tr class="even">
<td style="text-align: left;">F</td>
<td style="text-align: left;">Variance <em>only</em> between <code>X1</code> and <code>X2</code>, without influence from <code>Y</code>
</td>
<td style="text-align: left;">(B + D + F + G) − B − (D + G)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">G</td>
<td style="text-align: left;">Variance shared by <code>Y</code>, <code>X1</code>, and <code>X2</code>
</td>
<td style="text-align: left;">(D + G) − D</td>
</tr>
</tbody>
</table>
<p>PHEW. That’s <em>a lot</em>. Here’s all the code for it:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">y_total</span> <span class="op">&lt;-</span> <span class="fu">ss</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span>    <span class="co"># A + D + E + G</span></span>
<span><span class="va">x1_total</span> <span class="op">&lt;-</span> <span class="fu">ss</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">X1</span><span class="op">)</span>  <span class="co"># B + D + F + G</span></span>
<span><span class="va">x2_total</span> <span class="op">&lt;-</span> <span class="fu">ss</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">X2</span><span class="op">)</span>  <span class="co"># C + E + F + G</span></span>
<span></span>
<span><span class="co"># A</span></span>
<span><span class="va">y_alone</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X2</span> <span class="op">+</span> <span class="va">X1</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"Residuals"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">sumsq</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># B</span></span>
<span><span class="va">x1_alone</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span><span class="op">(</span><span class="va">X1</span> <span class="op">~</span> <span class="va">Y</span> <span class="op">+</span> <span class="va">X2</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"Residuals"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">sumsq</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># C</span></span>
<span><span class="va">x2_alone</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span><span class="op">(</span><span class="va">X2</span> <span class="op">~</span> <span class="va">Y</span> <span class="op">+</span> <span class="va">X1</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"Residuals"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">sumsq</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># D + G</span></span>
<span><span class="va">y_plus_x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X1</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X1"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">sumsq</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># E + G</span></span>
<span><span class="va">y_plus_x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X2</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X2"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">sumsq</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># F + G</span></span>
<span><span class="va">x1_plus_x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span><span class="op">(</span><span class="va">X1</span> <span class="op">~</span> <span class="va">X2</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"X2"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">sumsq</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># D = (A + D + E + G) − A − (E + G)</span></span>
<span><span class="va">y_x1_alone</span> <span class="op">&lt;-</span> <span class="va">y_total</span> <span class="op">-</span> <span class="va">y_alone</span> <span class="op">-</span> <span class="va">y_plus_x2</span></span>
<span></span>
<span><span class="co"># E = (A + D + E + G) − A − (D + G)</span></span>
<span><span class="va">y_x2_alone</span> <span class="op">&lt;-</span> <span class="va">y_total</span> <span class="op">-</span> <span class="va">y_alone</span> <span class="op">-</span> <span class="va">y_plus_x1</span></span>
<span></span>
<span><span class="co"># G = (D + G) − D</span></span>
<span><span class="va">y_x1_x2_alone</span> <span class="op">&lt;-</span> <span class="va">y_plus_x1</span> <span class="op">-</span> <span class="va">y_x1_alone</span></span>
<span></span>
<span><span class="co"># F = (F + G) - G</span></span>
<span><span class="va">x1_x2_alone</span> <span class="op">&lt;-</span> <span class="va">x1_plus_x2</span> <span class="op">-</span> <span class="va">y_x1_x2_alone</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Again, that’s super complex, but it’s really just a ton of set theory algebra.</p>
<p>Now that we have all these little pieces, let’s plot them!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">all_pieces</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Y"</span> <span class="op">=</span> <span class="va">y_alone</span>,</span>
<span>                <span class="st">"X1"</span> <span class="op">=</span> <span class="va">x1_alone</span>,</span>
<span>                <span class="st">"X2"</span> <span class="op">=</span> <span class="va">x2_alone</span>,</span>
<span>                <span class="st">"X1&amp;Y"</span> <span class="op">=</span> <span class="va">y_x1_alone</span>,</span>
<span>                <span class="st">"X2&amp;Y"</span> <span class="op">=</span> <span class="va">y_x2_alone</span>,</span>
<span>                <span class="st">"X1&amp;X2"</span> <span class="op">=</span> <span class="va">x1_x2_alone</span>,</span>
<span>                <span class="st">"Y&amp;X1&amp;X2"</span> <span class="op">=</span> <span class="va">y_x1_x2_alone</span><span class="op">)</span></span>
<span><span class="va">all_pieces</span></span>
<span><span class="co">##       Y      X1      X2    X1&amp;Y    X2&amp;Y   X1&amp;X2 Y&amp;X1&amp;X2 </span></span>
<span><span class="co">##   304.6   201.6   123.6    39.7    13.3    21.5    42.3</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">euler</span><span class="op">(</span><span class="va">all_pieces</span><span class="op">)</span>,</span>
<span>     quantities <span class="op">=</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-complex-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>
<p>These circles are now all proportional to the actual values in the data. Both <code>X1</code> and <code>X2</code> explain some of the variation in <code>Y</code>, but not a ton (and <code>X1</code> explains more than <code>X2</code>). The explained variance is represented by the area D + E + G, which means we can now calculate the actual <span class="math inline">\(R^2\)</span>:</p>
<p><span class="math display">\[
R^2 = \frac{D + E + G}{A + D + E + G} = \frac{39.69 + 13.27 + 42.29}{304.6 + 39.69 + 13.27 + 42.29} = 0.238
\]</span></p>
<p>Or with code:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">y_x1_alone</span> <span class="op">+</span> <span class="va">y_x2_alone</span> <span class="op">+</span> <span class="va">y_x1_x2_alone</span><span class="op">)</span> <span class="op">/</span></span>
<span>  <span class="op">(</span><span class="va">y_alone</span> <span class="op">+</span> <span class="va">y_x1_alone</span> <span class="op">+</span> <span class="va">y_x2_alone</span> <span class="op">+</span> <span class="va">y_x1_x2_alone</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.238</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s confirm it with a regression model:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">glance</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">r.squared</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.238</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>AMAZING. It’s the same. It worked!</p>
</section><section id="nicer-plot" class="level3"><h3 class="anchored" data-anchor-id="nicer-plot">Nicer plot</h3>
<p>With everything nice and proportional, let’s make this plot a little fancier for teaching purposes. Since <strong>eulerr</strong> uses grid-based graphics, we can use it with <a href="https://patchwork.data-imaginist.com/"><strong>patchwork</strong></a> to add annotations (or combine it with other ggplot objects if we really wanted to):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span>  <span class="co"># For combining ggplot and grid elements</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span>       <span class="co"># For making custom grid grobs</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stefanom.io/latex2exp/">latex2exp</a></span><span class="op">)</span>  <span class="co"># For writing LaTeX-like text with grid plots</span></span>
<span></span>
<span><span class="va">nice_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">euler</span><span class="op">(</span><span class="va">all_pieces</span><span class="op">)</span>,</span>
<span>                  quantities <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span>,</span>
<span>                                    fontfamily <span class="op">=</span> <span class="st">"Roboto Condensed Light"</span>,</span>
<span>                                    fontsize <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,</span>
<span>                  fills <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#7FDBFF"</span>, <span class="st">"grey30"</span>, <span class="st">"grey80"</span>,</span>
<span>                                        <span class="st">"#FF851B"</span>, <span class="st">"#FF851B"</span>, <span class="st">"grey50"</span>, <span class="st">"#FF851B"</span><span class="op">)</span>,</span>
<span>                               alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.35</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fontfamily <span class="op">=</span> <span class="st">"Roboto Condensed"</span>,</span>
<span>                                fontface <span class="op">=</span> <span class="st">"bold"</span>, fontsize <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">math_part</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html">textGrob</a></span><span class="op">(</span><span class="fu">TeX</span><span class="op">(</span><span class="st">"R^2 = \\frac{D + E + G}{A + D + E + G}"</span><span class="op">)</span>,</span>
<span>                      gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>fontfamily <span class="op">=</span> <span class="st">"Roboto Condensed"</span>,</span>
<span>                                col <span class="op">=</span> <span class="st">"grey50"</span>, fontsize <span class="op">=</span> <span class="fl">13</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Ordinarily patchwork works just fine with grid grob objects, like the results</span></span>
<span><span class="co"># from plot.euler(), but *not* when they're the first element in patchwork chain</span></span>
<span><span class="co"># of plots. To make grob objects work nicely with patchwork, we need to wrap</span></span>
<span><span class="co"># them in wrap_elements()</span></span>
<span><span class="fu">wrap_elements</span><span class="op">(</span><span class="va">nice_plot</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">inset_element</span><span class="op">(</span><span class="va">math_part</span>,</span>
<span>                left <span class="op">=</span> <span class="op">-</span><span class="fl">0.04</span>, bottom <span class="op">=</span> <span class="fl">0.72</span>, right <span class="op">=</span> <span class="fl">0.3</span>, top <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">plot_annotation</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"R² represented as an Euler diagram"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Orange area (D + E + G) shows the total variance in\noutcome Y that is jointly explained by X1 and X2"</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"Circles sized according to each variable's sum of squares; size of overlapping areas\nis not 100% correct due to limitations in available geometric space"</span>,</span>
<span>    theme <span class="op">=</span> <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>, family <span class="op">=</span> <span class="st">"Roboto Condensed"</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>                  plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span>, family <span class="op">=</span> <span class="st">"Roboto Condensed"</span><span class="op">)</span>,</span>
<span>                  plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span>, family <span class="op">=</span> <span class="st">"Roboto Condensed Light"</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/nice-plot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>
</section><section id="multicollinearity" class="level3"><h3 class="anchored" data-anchor-id="multicollinearity">Multicollinearity</h3>
<p>Another neat feature of this kind of diagram is that it helps visualize <a href="https://en.wikipedia.org/wiki/Multicollinearity">multicollinearity</a>, or the issues that arise when you control for explanatory variables that explain the same kind of variation in the outcome. Multicollinearity leads to strange coefficient estimates and variance inflation because mathematically the regression model has no way of telling which of the highly correlated explanatory variables explain which parts of the outcome.</p>
<p>In the diagram, areas D and E are uniquely accounted for by <code>X1</code> and <code>X2</code> respectively, but G is is overlapped, making it impossible to know if <code>X1</code> or <code>X2</code> explains that portion of the variation in <code>Y</code>. Similarly, area F shows the variation shared by both <code>X1</code> and <code>X2</code>, and again it’s impossible to know which parts are unique. As a result, the area (F + G) represents the total multicollinearity in the model:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">euler</span><span class="op">(</span><span class="va">all_pieces</span><span class="op">)</span>,</span>
<span>     quantities <span class="op">=</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span>,</span>
<span>     fills <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"#FF4136"</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-multicollinearity-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="why-this-matters" class="level2"><h2 class="anchored" data-anchor-id="why-this-matters">Why this matters</h2>
<p>One really neat thing about thinking about <span class="math inline">\(R^2\)</span> this way is that it highlights a key difference in the purposes of regression: prediction and estimation.</p>
<p>With prediction, the goal of the regression model is to predict the outcome as accurately as possible. This is what Netflix does when guessing what show you might want to watch next, or what the <a href="https://earlywarningproject.ushmm.org/">US Holocaust Museum does to predict genocide and human rights abuses</a>. You throw in as many control variables as you can in order to create a model that explains variation in Y as accurately as possible. As a result, these kinds of models will typically have a high <span class="math inline">\(R^2\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">euler</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Next show\non Netflix"</span> <span class="op">=</span> <span class="fl">1</span>,</span>
<span>             <span class="st">"X1"</span> <span class="op">=</span> <span class="fl">4</span>,</span>
<span>             <span class="st">"X2"</span> <span class="op">=</span> <span class="fl">6</span>,</span>
<span>             <span class="st">"X3"</span> <span class="op">=</span> <span class="fl">4</span>,</span>
<span>             <span class="st">"X4"</span> <span class="op">=</span> <span class="fl">6</span>,</span>
<span>             <span class="st">"X5"</span> <span class="op">=</span> <span class="fl">6</span>,</span>
<span>             <span class="st">"X1&amp;Next show\non Netflix"</span> <span class="op">=</span> <span class="fl">2</span>,</span>
<span>             <span class="st">"X2&amp;Next show\non Netflix"</span> <span class="op">=</span> <span class="fl">4</span>,</span>
<span>             <span class="st">"X3&amp;Next show\non Netflix"</span> <span class="op">=</span> <span class="fl">4</span>,</span>
<span>             <span class="st">"X4&amp;Next show\non Netflix"</span> <span class="op">=</span> <span class="fl">2</span>,</span>
<span>             <span class="st">"X5&amp;Next show\non Netflix"</span> <span class="op">=</span> <span class="fl">4</span>,</span>
<span>             <span class="st">"X1&amp;X2"</span> <span class="op">=</span> <span class="fl">2</span>,</span>
<span>             <span class="st">"Next show\non Netflix&amp;X1&amp;X2"</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-diagram-prediction-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>
<p>Look at that squishy little area of Y that’s not explained by any of the other variables. Neato.</p>
<p>In the realm of causal inference in social science, or with estimation in general, the focus of the analysis is on <em>a single X variable</em> , like whether or not people in the sample participated in a social program. You might include a bunch of control variables if you identification strategy tells you do: an interaction term for time and group if you’re using <a href="https://evalf21.classes.andrewheiss.com/example/diff-in-diff/">difference-in-differences</a>, an indicator showing if people are above/below a threshold if you’re using <a href="https://evalf21.classes.andrewheiss.com/example/rdd/">regression discontinuity</a>, an instrument if you’re using <a href="https://evalf21.classes.andrewheiss.com/example/iv/">instrumental variables</a>, confounding control variables if you’re using <a href="https://evalf21.classes.andrewheiss.com/example/matching-ipw/">inverse probability weighting and a DAG</a>, or nothing(!) if you’re using a <a href="https://evalf21.classes.andrewheiss.com/example/rcts/">randomized controlled trial</a> (like you can really just run <code>lm(Y ~ treatment)</code>!). Each of these types of models will inevitably return an <span class="math inline">\(R^2\)</span> value, since that what regression does, but we care less about that when estimating causal effects. All we care about is the accuracy of one little sliver of the diagram—that single policy lever that we might have control over to influence the larger outcome.</p>
<p>For instance, let’s say you’re a new little nonprofit who created a cool new program to help reduce childhood poverty within your city. You want to know if that program does anything to poverty more generally. You have lots of donor money so you decide to run a carefully designed randomized trial. You run a regression model and get a tiny <span class="math inline">\(R^2\)</span> value, like 0.015. You panic because that means your experiment only explains 1.5% of the variation in poverty, and that seems really bad and low!</p>
<p>But that’s actually totally fine. The goal with the experiment is <em>not</em> to explain all the factors that create poverty—there are far too many to include in a regression model. The goal here is to have an accurate estimate of how much your single program affects poverty. There’s <em>no way</em> your little program is going to explain 80% of the variation in poverty. If you had a high <span class="math inline">\(R^2\)</span>, I’d be incredibly worried! (Unless you really discovered a program that is a true silver bullet for poverty!)</p>
<p>Looking at an Euler diagram demonstrates this more easily. All we care about in this experiment is that little sliver. Is it accurate? Does the treatment move the needle on poverty in any way? If so, great!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">euler</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Poverty"</span> <span class="op">=</span> <span class="fl">100</span>,</span>
<span>             <span class="st">"Program"</span> <span class="op">=</span> <span class="fl">2</span>,</span>
<span>             <span class="st">"Poverty&amp;Program"</span> <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     fills <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"grey75"</span>, <span class="st">"#FF851B"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-diagram-estimation-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>
<p>So don’t dismiss models immediately just because of a low <span class="math inline">\(R^2\)</span>! The purpose of the models matters!</p>
</section><section id="caveats" class="level2"><h2 class="anchored" data-anchor-id="caveats">Caveats</h2>
<p>There are a few important caveats to keep in mind with these diagrams:</p>
<p><strong>1: This is inefficient</strong></p>
<p>Calculating each of these plot segments by hand is tedious and there will inevitably be typos and errors (there are probably errors in this very post!). Also, due to how ANOVA works, the order of the variables you specify matters <em>a lot</em>: <code>aov(Y ~ X1 + X2)</code> and <code>aov(Y ~ X2 + X1)</code> give completely different sum of squares for the joint variation of <code>Y</code>, <code>X1</code>, and <code>X2</code>. That in turn changes the sizes of the segments.</p>
<p>When writing this, I spent way too much time playing with covariance matrices, partial correlation matrices, and variance-covariance matrices to see if I could calculate these areas more mathematically using the guts of regression and ANOVA, but it was too tricky. Smarter people than me will need to figure it out.</p>
<p><strong>2: This doesn’t work in all cases</strong></p>
<p>It’s possible to have negative areas, depending on the data you have, and negative areas are unplottable (<span class="citation" data-cites="Ip:2001">Ip (<a href="#ref-Ip:2001" role="doc-biblioref">2001</a>)</span> shows an example of this at the end of his article). In order to use this kind of diagram when teaching, you have to use carefully constructed data—you can’t just throw any model into a chart like this. Also, when working with actual numbers, you’re generally limited to just one or two explanatory variables. Any more and the math gets too complex.</p>
<p><strong>3: This isn’t 100% accurate</strong></p>
<p>The geometry behind creating these Euler diagrams is complex and doesn’t always work perfectly. Let’s plot the actual values of the sum of squares for each segment:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">euler</span><span class="op">(</span><span class="va">all_pieces</span><span class="op">)</span>,</span>
<span>     quantities <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-complex-values-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>
<p>That central piece where <code>Y</code>, <code>X1</code>, and <code>X2</code> is 42, but it’s smaller any of the other intersections, which all have smaller sum-of-squares values. Yikes!</p>
<p>The <strong>eulerr</strong> package provides a way of diagnosing how bad things are by either inspecting the results of <code>euler()</code> directly, or looking at the residuals and errors with <code>error_plot()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">euler</span><span class="op">(</span><span class="va">all_pieces</span><span class="op">)</span></span>
<span><span class="co">##         original fitted residuals regionError</span></span>
<span><span class="co">## Y          304.6  303.9     0.742       0.001</span></span>
<span><span class="co">## X1         201.6  200.3     1.326       0.001</span></span>
<span><span class="co">## X2         123.6  121.3     2.319       0.002</span></span>
<span><span class="co">## Y&amp;X1        39.7   47.6    -7.953       0.011</span></span>
<span><span class="co">## Y&amp;X2        13.3   26.5   -13.236       0.018</span></span>
<span><span class="co">## X1&amp;X2       21.5   33.0   -11.541       0.016</span></span>
<span><span class="co">## Y&amp;X1&amp;X2     42.3   10.7    31.558       0.042</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## diagError: 0.042 </span></span>
<span><span class="co">## stress:    0.009</span></span>
<span></span>
<span><span class="fu">error_plot</span><span class="op">(</span><span class="fu">euler</span><span class="op">(</span><span class="va">all_pieces</span><span class="op">)</span>,</span>
<span>           quantities <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-errors-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>
<p>That central piece is underrepresented, while the other intersections are overrepresented. Alas.</p>
</section><section id="references" class="level2">


<!-- -->


</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-CohenCohen:1975" class="csl-entry" role="listitem">
Cohen, Jacob, and Patricia Cohen. 1975. <em>Applied Multiple Regression/Correlation Analysis for the Behavioral Sciences</em>. New Jersey: Lawrence Erlbaum Associates.
</div>
<div id="ref-Hunt:1986" class="csl-entry" role="listitem">
Hunt, Earl. 1986. <span>“The Design of Ballantines.”</span> <em>Behavior Research Methods, Instruments, &amp; Computers</em> 28 (May): 277–84. <a href="https://doi.org/10.3758/BF03204399">https://doi.org/10.3758/BF03204399</a>.
</div>
<div id="ref-Ip:2001" class="csl-entry" role="listitem">
Ip, Edward H. S. 2001. <span>“Visualizing Multiple Regression.”</span> <em>Journal of Statistics Education</em> 9 (1). <a href="https://doi.org/10.1080/10691898.2001.11910646">https://doi.org/10.1080/10691898.2001.11910646</a>.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{heiss2021,
  author = {Heiss, Andrew},
  title = {Exploring {R}\textsuperscript{2} and Regression Variance with
    {Euler/Venn} Diagrams},
  date = {2021-08-21},
  url = {https://www.andrewheiss.com/blog/2021/08/21/r2-euler/},
  doi = {10.59350/t57vy-p5115},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-heiss2021" class="csl-entry quarto-appendix-citeas" role="listitem">
Heiss, Andrew. 2021. <span>“Exploring R<sup>2</sup> and Regression
Variance with Euler/Venn Diagrams.”</span> August 21, 2021. <a href="https://doi.org/10.59350/t57vy-p5115">https://doi.org/10.59350/t57vy-p5115</a>.
</div></div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.andrewheiss\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><script src="https://giscus.app/client.js" data-repo="andrewheiss/ath-quarto" data-repo-id="R_kgDOIg6EJQ" data-category="Blog comments" data-category-id="DIC_kwDOIg6EJc4CSz92" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><input type="hidden" id="giscus-base-theme" value="light"><input type="hidden" id="giscus-alt-theme" value="dark"><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb22" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Exploring R² and regression variance with Euler/Venn diagrams"</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2021-08-21</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Use Venn diagrams to visualize the proportion of an outcome explained by a regression model"</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> index_files/figure-html/nice-plot-1.png</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co">  - r</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - tidyverse</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co">  - regression</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - statistics</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co">  - data visualization</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="an">doi:</span><span class="co"> 10.59350/t57vy-p5115</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="an">citation:</span><span class="co"> true</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(fig.align = "center", fig.retina = 3,</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="in">                      out.width = "75%", collapse = TRUE)</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="in">options(digits = 3, width = 90)</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="in">```{r other-resources, eval=FALSE, include=FALSE}</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="in"># https://pj.freefaculty.org/guides/stat/Regression/MultipleRegression/Regression-MultipleInputs-lecture-2.pdf#page27</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a><span class="in"># https://sites.google.com/site/modernprogramevaluation/2-ballentine-venn-diagrams</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="in"># Neat interactive thing for two variables</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="in"># https://rpsychologist.com/correlation/</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>Regression is the core of my <span class="co">[</span><span class="ot">statistics</span><span class="co">](https://statsf18.classes.andrewheiss.com/)</span> and <span class="co">[</span><span class="ot">program evaluation/causal inference</span><span class="co">](https://evalf21.classes.andrewheiss.com/)</span> courses. As I've taught different stats classes, I've found that one of the regression diagnostic statistics that students really glom onto is $R^2$. Unlike lots of regression diagnostics like AIC, BIC, and the joint F-statistic, $R^2$ has a really intuitive interpretation—it's the percent of variation in the outcome variable explained by all the explanatory variables. For instance, let's explain global life expectancy using GDP per capita, based on data from <span class="co">[</span><span class="ot">the Gapminder project</span><span class="co">](https://www.gapminder.org/)</span>. Here's the basic model:</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>\widehat{\text{Life expectancy}} = \beta_0 + \beta_1 \text{GDP per capita} + \epsilon</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a><span class="in">```{r libraries, message=FALSE, warning=FALSE}</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)     # For ggplot, dplyr, and friends</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a><span class="in">library(broom)         # For converting models into data frames</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a><span class="in">library(gapminder)     # For health and wealth data</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a><span class="in">library(faux)          # For generating fake data</span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a><span class="in">library(eulerr)        # For creating Euler and Venn diagrams</span></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a><span class="in">```{r gapminder-model}</span></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a><span class="in"># Just look at 2007</span></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a><span class="in">gapminder_2007 &lt;- gapminder %&gt;%</span></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(year == 2007)</span></span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a><span class="in">super_naive_model &lt;- lm(lifeExp ~ gdpPercap, data = gapminder_2007)</span></span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a><span class="in">tidy(super_naive_model)</span></span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a><span class="in">glance(super_naive_model)</span></span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>This is an awful model on theoretical grounds, but whatever. A \$1 increase in GDP per capita is associated with a 0.001 year increase in life expectancy, on average. Look at all those diagnostics though—AIC? BIC? LogLik? Those are important, but definitely not intuitive. The $R^2$ value, on the other hand, is nice and interpretable. GDP per capita explains 46.1% of the variation in life expectancy. That's soundbite-worthy. Students love it.</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>People also love to critique models based on it. In my program evaluation class, a model in one of my problem sets has an $R^2$ of 0.02, and without fail, a majority of students dismiss it because of its low explanatory power. It only explains 2% of the variation in the outcome! It must be junk!</span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>But low $R^2$s aren't necessarily bad. And while saying that a model explains X% of the variation in an outcome, what does that even mean in practice?</span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>So how the heck does $R^2$ work anyway? I've struggled teaching this, but recently a friend mentioned that she teaches students to imagine $R^2$ as a combination of overlapping circles, or a type of Venn diagram. I'd never heard of this approach before, so I went down a really interesting rabbit hole to discover that this approach has actually been used for decades! Let's go down that rabbit hole together!</span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a><span class="fu">## Regression as overlapping circles</span></span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a>The earliest example I found is @CohenCohen:1975, who proposed visualizing the shared variance between 2–3 variables as a "ballantine" graph (apparently named after <span class="co">[</span><span class="ot">an ale logo</span><span class="co">](https://en.wikipedia.org/wiki/P._Ballantine_and_Sons_Brewing_Company)</span>?), or what we call nowadays a Venn or Euler diagram. Others refined their approach, like @Hunt:1986 who provides all sorts of fancy geometric equations to make them accurate (and provides some neat vintage Pascal code in the appendix!), and @Ip:2001, who shows a bunch of different examples and highlights some of the limitations of using this approach.</span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a>For this ongoing example, we'll simulate some correlated data using <span class="co">[</span><span class="ot">the **faux** package</span><span class="co">](https://debruine.github.io/faux/)</span>. We could use real data, but as you'll see, these diagrams are pretty finicky and fragile and generally need very tame data to work. Here we'll create data with three variables that are normally distributed with these parameters:</span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`Y`</span>: mean = 10, sd = 2</span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`X1`</span>: mean = 9, sd = 1.7</span>
<span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`X2`</span>: mean = 9, sd = 1.3</span>
<span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a>We'll make <span class="in">`Y`</span> and <span class="in">`X1`</span> be correlated at r = 0.5, <span class="in">`Y`</span> and <span class="in">`X2`</span> correlated at r = 0.3, and <span class="in">`X1`</span> and <span class="in">`X2`</span> correlated at r = 0.4:</span>
<span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a><span class="in">```{r create-fake-data}</span></span>
<span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(1234)</span></span>
<span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a><span class="in">df &lt;- rnorm_multi(n = 100,</span></span>
<span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a><span class="in">                  mu = c(10, 9, 9),</span></span>
<span id="cb22-79"><a href="#cb22-79" aria-hidden="true" tabindex="-1"></a><span class="in">                  sd = c(2, 1.7, 1.3),</span></span>
<span id="cb22-80"><a href="#cb22-80" aria-hidden="true" tabindex="-1"></a><span class="in">                  r = c(0.5, 0.3, 0.4),</span></span>
<span id="cb22-81"><a href="#cb22-81" aria-hidden="true" tabindex="-1"></a><span class="in">                  varnames = c("Y", "X1", "X2"),</span></span>
<span id="cb22-82"><a href="#cb22-82" aria-hidden="true" tabindex="-1"></a><span class="in">                  empirical = FALSE)</span></span>
<span id="cb22-83"><a href="#cb22-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-84"><a href="#cb22-84" aria-hidden="true" tabindex="-1"></a><span class="in"># Look at the first few rows</span></span>
<span id="cb22-85"><a href="#cb22-85" aria-hidden="true" tabindex="-1"></a><span class="in">head(df)</span></span>
<span id="cb22-86"><a href="#cb22-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-87"><a href="#cb22-87" aria-hidden="true" tabindex="-1"></a><span class="in"># Check if the correlations worked</span></span>
<span id="cb22-88"><a href="#cb22-88" aria-hidden="true" tabindex="-1"></a><span class="in">cor(df)</span></span>
<span id="cb22-89"><a href="#cb22-89" aria-hidden="true" tabindex="-1"></a><span class="in"># Close enough!</span></span>
<span id="cb22-90"><a href="#cb22-90" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-91"><a href="#cb22-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-92"><a href="#cb22-92" aria-hidden="true" tabindex="-1"></a>In these regression diagrams, each variable is shown as a circle sized according to its variance, or:</span>
<span id="cb22-93"><a href="#cb22-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-94"><a href="#cb22-94" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb22-95"><a href="#cb22-95" aria-hidden="true" tabindex="-1"></a>\operatorname{var} = \sigma^2 = \frac{\sum (\color{gray}{\overbrace{\color{black}{x_i}}^{\substack{\text{Single} <span class="sc">\\</span> \text{value}}}} - \color{gray}{\overbrace{\color{black}{\bar{x}}}^{\substack{\text{Mean of} <span class="sc">\\</span> \text{all values}}}\color{black}{)^2}}}{\color{gray}{\underbrace{\color{black}{n}}_{\substack{\text{Sample} <span class="sc">\\</span> \text{size}}}}-1}</span>
<span id="cb22-96"><a href="#cb22-96" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb22-97"><a href="#cb22-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-98"><a href="#cb22-98" aria-hidden="true" tabindex="-1"></a>According to @Ip:2001, you can also size the circles based on just the numerator of that equation, or the sum-of-squares, which is the same value proportionally number (it's just not divided by $n-1$). It's also easier to work with when plotting, so that's what we'll use throughout this example.</span>
<span id="cb22-99"><a href="#cb22-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-100"><a href="#cb22-100" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb22-101"><a href="#cb22-101" aria-hidden="true" tabindex="-1"></a>\color{gray}{\overbrace{\color{black}{{\scriptstyle\sum} (x_i - \bar{x})^2}}^{\text{Sum of squares}}}</span>
<span id="cb22-102"><a href="#cb22-102" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb22-103"><a href="#cb22-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-104"><a href="#cb22-104" aria-hidden="true" tabindex="-1"></a>We can even make a little function to calculate the sum of squares for us:</span>
<span id="cb22-105"><a href="#cb22-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-106"><a href="#cb22-106" aria-hidden="true" tabindex="-1"></a><span class="in">```{r create-ss-function}</span></span>
<span id="cb22-107"><a href="#cb22-107" aria-hidden="true" tabindex="-1"></a><span class="in"># Sum of squares, or the numerator of the variance equation</span></span>
<span id="cb22-108"><a href="#cb22-108" aria-hidden="true" tabindex="-1"></a><span class="in">ss &lt;- function(x) {</span></span>
<span id="cb22-109"><a href="#cb22-109" aria-hidden="true" tabindex="-1"></a><span class="in">  sum((x - mean(x))^2)</span></span>
<span id="cb22-110"><a href="#cb22-110" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb22-111"><a href="#cb22-111" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-112"><a href="#cb22-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-113"><a href="#cb22-113" aria-hidden="true" tabindex="-1"></a>Enough math, though—let's make some plots! We'll use <span class="co">[</span><span class="ot">the **eulerr** package</span><span class="co">](https://cran.r-project.org/web/packages/eulerr/vignettes/introduction.html)</span> for this, since (1) it calculates proportional overlaps between circles (that's the key technical difference between Venn and Euler diagram—Venn diagrams are supposed to have equally sized overlapping areas), and (2) it uses grid graphics, so it fits nicely in the ggplot ecosystem.</span>
<span id="cb22-114"><a href="#cb22-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-115"><a href="#cb22-115" aria-hidden="true" tabindex="-1"></a><span class="fu">### Relationship between two variables</span></span>
<span id="cb22-116"><a href="#cb22-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-117"><a href="#cb22-117" aria-hidden="true" tabindex="-1"></a>First let's just look at the relationship between <span class="in">`Y`</span> and <span class="in">`X1`</span>. We'll use the sum of squares to calculate the size for each circle:</span>
<span id="cb22-118"><a href="#cb22-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-119"><a href="#cb22-119" aria-hidden="true" tabindex="-1"></a><span class="in">```{r unrelated-vars}</span></span>
<span id="cb22-120"><a href="#cb22-120" aria-hidden="true" tabindex="-1"></a><span class="in">ss_y &lt;- ss(df$Y)</span></span>
<span id="cb22-121"><a href="#cb22-121" aria-hidden="true" tabindex="-1"></a><span class="in">ss_x1 &lt;- ss(df$X1)</span></span>
<span id="cb22-122"><a href="#cb22-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-123"><a href="#cb22-123" aria-hidden="true" tabindex="-1"></a><span class="in">plot(euler(c("Y" = ss_y,</span></span>
<span id="cb22-124"><a href="#cb22-124" aria-hidden="true" tabindex="-1"></a><span class="in">             "X1" = ss_x1)),</span></span>
<span id="cb22-125"><a href="#cb22-125" aria-hidden="true" tabindex="-1"></a><span class="in">     quantities = TRUE)</span></span>
<span id="cb22-126"><a href="#cb22-126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-127"><a href="#cb22-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-128"><a href="#cb22-128" aria-hidden="true" tabindex="-1"></a>Just looking at this plot, we can see that <span class="in">`Y`</span> has more variation than <span class="in">`X1`</span>. Neat.</span>
<span id="cb22-129"><a href="#cb22-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-130"><a href="#cb22-130" aria-hidden="true" tabindex="-1"></a>These two variables are related to each other though and have some covariance. We can calculate the shared covariance using <span class="co">[</span><span class="ot">ANOVA</span><span class="co">](https://en.wikipedia.org/wiki/Analysis_of_variance)</span>. Ordinarily you need to feed R's <span class="in">`anova()`</span> function an <span class="in">`lm()`</span> object to calculate different variance statistics (e.g. <span class="in">`anova(lm(Y ~ X1, data = df))`</span>), but to save some typing, you can also use the <span class="in">`aov()`</span> function to skip the intermediate <span class="in">`lm()`</span> step. The nice thing about using the sum of squares values for these diagrams rather than variance values is that <span class="in">`aov()`</span> reports its results as sums of squares, so we can use those results directly.</span>
<span id="cb22-131"><a href="#cb22-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-132"><a href="#cb22-132" aria-hidden="true" tabindex="-1"></a>Let's see how much of the variation between <span class="in">`Y`</span> and <span class="in">`X1`</span> is shared:</span>
<span id="cb22-133"><a href="#cb22-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-134"><a href="#cb22-134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basic-aov}</span></span>
<span id="cb22-135"><a href="#cb22-135" aria-hidden="true" tabindex="-1"></a><span class="in">aov(Y ~ X1, data = df)</span></span>
<span id="cb22-136"><a href="#cb22-136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-137"><a href="#cb22-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-138"><a href="#cb22-138" aria-hidden="true" tabindex="-1"></a>If we look at the sum of squares row, we can see that 81.98 sum-of-squares units (whatever those mean) are shared between the two variables, with 317.87 not shared (or residual). To plot this overlap, we need to do a little bit of set theory math. We can't just tell <span class="in">`Y`</span> to be 399 units big—we need to subtract the shared space from both <span class="in">`Y`</span> and <span class="in">`X1`</span>. We'll extract the sum of squares value from <span class="in">`aov()`</span> (using <span class="in">`broom::tidy()`</span> to make this easier):</span>
<span id="cb22-139"><a href="#cb22-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-140"><a href="#cb22-140" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-basic-overlap}</span></span>
<span id="cb22-141"><a href="#cb22-141" aria-hidden="true" tabindex="-1"></a><span class="in">ss_both_y_x1 &lt;- aov(Y ~ X1, data = df) %&gt;%</span></span>
<span id="cb22-142"><a href="#cb22-142" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy() %&gt;%</span></span>
<span id="cb22-143"><a href="#cb22-143" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(term == "X1") %&gt;%</span></span>
<span id="cb22-144"><a href="#cb22-144" aria-hidden="true" tabindex="-1"></a><span class="in">  pull(sumsq)</span></span>
<span id="cb22-145"><a href="#cb22-145" aria-hidden="true" tabindex="-1"></a><span class="in">ss_both_y_x1</span></span>
<span id="cb22-146"><a href="#cb22-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-147"><a href="#cb22-147" aria-hidden="true" tabindex="-1"></a><span class="in">plot(euler(c("Y" = ss_y - ss_both_y_x1,</span></span>
<span id="cb22-148"><a href="#cb22-148" aria-hidden="true" tabindex="-1"></a><span class="in">             "X1" = ss_x1 - ss_both_y_x1,</span></span>
<span id="cb22-149"><a href="#cb22-149" aria-hidden="true" tabindex="-1"></a><span class="in">             "Y&amp;X1" = ss_both_y_x1)),</span></span>
<span id="cb22-150"><a href="#cb22-150" aria-hidden="true" tabindex="-1"></a><span class="in">     quantities = TRUE)</span></span>
<span id="cb22-151"><a href="#cb22-151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-152"><a href="#cb22-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-153"><a href="#cb22-153" aria-hidden="true" tabindex="-1"></a>Now we can visualize the covariance between these two variables! Let's get rid of the raw numbers and add some letters for the different segments:</span>
<span id="cb22-154"><a href="#cb22-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-155"><a href="#cb22-155" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-basic-overlap-labels}</span></span>
<span id="cb22-156"><a href="#cb22-156" aria-hidden="true" tabindex="-1"></a><span class="in">plot(euler(c("Y" = ss_y - ss_both_y_x1,</span></span>
<span id="cb22-157"><a href="#cb22-157" aria-hidden="true" tabindex="-1"></a><span class="in">             "X1" = ss_x1 - ss_both_y_x1,</span></span>
<span id="cb22-158"><a href="#cb22-158" aria-hidden="true" tabindex="-1"></a><span class="in">             "Y&amp;X1" = ss_both_y_x1)),</span></span>
<span id="cb22-159"><a href="#cb22-159" aria-hidden="true" tabindex="-1"></a><span class="in">     quantities = c("A", "B", "C"))</span></span>
<span id="cb22-160"><a href="#cb22-160" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-161"><a href="#cb22-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-162"><a href="#cb22-162" aria-hidden="true" tabindex="-1"></a>Area C here represents the amount of variation in <span class="in">`Y`</span> explained by <span class="in">`X1`</span>, while Area A represents the unexplained portion of <span class="in">`Y`</span>. In regression language, A is basically the error term:</span>
<span id="cb22-163"><a href="#cb22-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-164"><a href="#cb22-164" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb22-165"><a href="#cb22-165" aria-hidden="true" tabindex="-1"></a>\hat{Y} = \beta_0 + \beta_1 X_1 + \color{gray}{\overbrace{\epsilon}^{\color{black}{\text{A}}}}</span>
<span id="cb22-166"><a href="#cb22-166" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb22-167"><a href="#cb22-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-168"><a href="#cb22-168" aria-hidden="true" tabindex="-1"></a>The great thing about visualizing this is that C also represents the $R^2$! In general, $R^2$ is the ratio between explained and total variance:</span>
<span id="cb22-169"><a href="#cb22-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-170"><a href="#cb22-170" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb22-171"><a href="#cb22-171" aria-hidden="true" tabindex="-1"></a>R^2 = \frac{\text{Explained variance in }Y}{\text{Total variance in }Y}</span>
<span id="cb22-172"><a href="#cb22-172" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb22-173"><a href="#cb22-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-174"><a href="#cb22-174" aria-hidden="true" tabindex="-1"></a>Based on this diagram, we can write this as:</span>
<span id="cb22-175"><a href="#cb22-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-176"><a href="#cb22-176" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb22-177"><a href="#cb22-177" aria-hidden="true" tabindex="-1"></a>R^2 = \frac{C}{A + C}</span>
<span id="cb22-178"><a href="#cb22-178" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb22-179"><a href="#cb22-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-180"><a href="#cb22-180" aria-hidden="true" tabindex="-1"></a>Using actual numbers, we get</span>
<span id="cb22-181"><a href="#cb22-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-182"><a href="#cb22-182" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb22-183"><a href="#cb22-183" aria-hidden="true" tabindex="-1"></a>R^2 = \frac{81.98}{317.87 + 81.98} = 0.205</span>
<span id="cb22-184"><a href="#cb22-184" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb22-185"><a href="#cb22-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-186"><a href="#cb22-186" aria-hidden="true" tabindex="-1"></a>We can do this more precisely with code:</span>
<span id="cb22-187"><a href="#cb22-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-188"><a href="#cb22-188" aria-hidden="true" tabindex="-1"></a><span class="in">```{r calc-basic-r2-manually}</span></span>
<span id="cb22-189"><a href="#cb22-189" aria-hidden="true" tabindex="-1"></a><span class="in">part_a &lt;- ss_y - ss_both_y_x1</span></span>
<span id="cb22-190"><a href="#cb22-190" aria-hidden="true" tabindex="-1"></a><span class="in">part_c &lt;- ss_both_y_x1</span></span>
<span id="cb22-191"><a href="#cb22-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-192"><a href="#cb22-192" aria-hidden="true" tabindex="-1"></a><span class="in">part_c / (part_a + part_c)</span></span>
<span id="cb22-193"><a href="#cb22-193" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-194"><a href="#cb22-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-195"><a href="#cb22-195" aria-hidden="true" tabindex="-1"></a>According to this, <span class="in">`X1`</span> explains 20.5% of the variation in <span class="in">`Y`</span>. That's apparent visually—the overlapping space covers about 20% of the total <span class="in">`Y`</span> circle.</span>
<span id="cb22-196"><a href="#cb22-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-197"><a href="#cb22-197" aria-hidden="true" tabindex="-1"></a>Let's run a regression model and check the $R^2$ value to see if it's the same:</span>
<span id="cb22-198"><a href="#cb22-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-199"><a href="#cb22-199" aria-hidden="true" tabindex="-1"></a><span class="in">```{r calc-basic-r2-regression}</span></span>
<span id="cb22-200"><a href="#cb22-200" aria-hidden="true" tabindex="-1"></a><span class="in">lm(Y ~ X1, data = df) %&gt;%</span></span>
<span id="cb22-201"><a href="#cb22-201" aria-hidden="true" tabindex="-1"></a><span class="in">  glance() %&gt;%</span></span>
<span id="cb22-202"><a href="#cb22-202" aria-hidden="true" tabindex="-1"></a><span class="in">  pull(r.squared)</span></span>
<span id="cb22-203"><a href="#cb22-203" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-204"><a href="#cb22-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-205"><a href="#cb22-205" aria-hidden="true" tabindex="-1"></a>Incredible!! It's the same! That's so cool.</span>
<span id="cb22-206"><a href="#cb22-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-207"><a href="#cb22-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-208"><a href="#cb22-208" aria-hidden="true" tabindex="-1"></a><span class="fu">### Relationship between three variables</span></span>
<span id="cb22-209"><a href="#cb22-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-210"><a href="#cb22-210" aria-hidden="true" tabindex="-1"></a>Where this gets even more useful is when we look at the overlapping space between three different variables. It's also a little more complicated, since we need to calculate a bunch of different shared variances and do some set theory calculations to find the exact size of these different slivers of the diagram. Here's a general diagram of what we'll be calculating (this is unrelated to the data we've been working with and doesn't use any actual numbers—it's just a reference so we can find which shared variances we need to calculate):</span>
<span id="cb22-211"><a href="#cb22-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-212"><a href="#cb22-212" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-generic-3-rings}</span></span>
<span id="cb22-213"><a href="#cb22-213" aria-hidden="true" tabindex="-1"></a><span class="in">plot(euler(c("Y" = 4,</span></span>
<span id="cb22-214"><a href="#cb22-214" aria-hidden="true" tabindex="-1"></a><span class="in">             "X1" = 4,</span></span>
<span id="cb22-215"><a href="#cb22-215" aria-hidden="true" tabindex="-1"></a><span class="in">             "X2" = 4,</span></span>
<span id="cb22-216"><a href="#cb22-216" aria-hidden="true" tabindex="-1"></a><span class="in">             "X1&amp;Y" = 2,</span></span>
<span id="cb22-217"><a href="#cb22-217" aria-hidden="true" tabindex="-1"></a><span class="in">             "X2&amp;Y" = 2,</span></span>
<span id="cb22-218"><a href="#cb22-218" aria-hidden="true" tabindex="-1"></a><span class="in">             "X1&amp;X2" = 2,</span></span>
<span id="cb22-219"><a href="#cb22-219" aria-hidden="true" tabindex="-1"></a><span class="in">             "Y&amp;X1&amp;X2" = 0.5)),</span></span>
<span id="cb22-220"><a href="#cb22-220" aria-hidden="true" tabindex="-1"></a><span class="in">     quantities = c(LETTERS[1:7]))</span></span>
<span id="cb22-221"><a href="#cb22-221" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-222"><a href="#cb22-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-223"><a href="#cb22-223" aria-hidden="true" tabindex="-1"></a>This looks complicated, but the same principles apply. The entire circles for <span class="in">`Y`</span>, <span class="in">`X1`</span>, and <span class="in">`X2`</span> represent each variable's total variance. Overlapping areas represent shared variance. For instance, the combination of D and G here (or $A \cap B$) is the covariance that we calculated previously. The $R^2$ is still here too—the total explained variance in <span class="in">`Y`</span> is the combination of D, E, and G, while A is the residual unexplained variance. That means we can calculate $R^2$ like this:</span>
<span id="cb22-224"><a href="#cb22-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-225"><a href="#cb22-225" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb22-226"><a href="#cb22-226" aria-hidden="true" tabindex="-1"></a>\frac{D + E + G}{A + D + E + G}</span>
<span id="cb22-227"><a href="#cb22-227" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb22-228"><a href="#cb22-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-229"><a href="#cb22-229" aria-hidden="true" tabindex="-1"></a>This visualization also helps with the intuition of $R^2$. Generally when you add additional variables to a regression model, the $R^2$ increases. That's because you're adding another circle to the diagram and absorbing more of the variation in the outcome. For instance, even though the numbers in this diagram aren't to scale at all, you can see that (D + G) (the $R^2$ that we calculated in the two-variable diagram) is smaller than (D + E + G). There's more explained variance here.</span>
<span id="cb22-230"><a href="#cb22-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-231"><a href="#cb22-231" aria-hidden="true" tabindex="-1"></a>To calculate the actual values for each of these segments, we'll use <span class="in">`aov()`</span> again to find the shared variance. This will involve a lot of different calculations and some algebra to isolate each segment. This table will help us keep everything straight:</span>
<span id="cb22-232"><a href="#cb22-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-233"><a href="#cb22-233" aria-hidden="true" tabindex="-1"></a>| Segment | Explanation | Code or algebra |</span>
<span id="cb22-234"><a href="#cb22-234" aria-hidden="true" tabindex="-1"></a>| :------ | :---------- | :--- |</span>
<span id="cb22-235"><a href="#cb22-235" aria-hidden="true" tabindex="-1"></a>| A + D + E + G | Total variation in <span class="in">`Y`</span> | <span class="in">`ss(df$Y)`</span> or <span class="in">`aov(Y ~ 1)`</span> |</span>
<span id="cb22-236"><a href="#cb22-236" aria-hidden="true" tabindex="-1"></a>| B + D + F + G | Total variation in <span class="in">`X1`</span> | <span class="in">`ss(df$X1)`</span> or <span class="in">`aov(X1 ~ 1)`</span> |</span>
<span id="cb22-237"><a href="#cb22-237" aria-hidden="true" tabindex="-1"></a>| C + E + F + G | Total variation in <span class="in">`X2`</span> | <span class="in">`ss(df$X2)`</span> or <span class="in">`aov(X2 ~ 1)`</span> |</span>
<span id="cb22-238"><a href="#cb22-238" aria-hidden="true" tabindex="-1"></a>| A       | Unexplained variation in <span class="in">`Y`</span> after accounting for <span class="in">`X1`</span> and <span class="in">`X2`</span> | Residuals from <span class="in">`aov(Y ~ X2 + X1)`</span> |</span>
<span id="cb22-239"><a href="#cb22-239" aria-hidden="true" tabindex="-1"></a>| B       | Unexplained variation in <span class="in">`X1`</span> after accounting for <span class="in">`Y`</span> and <span class="in">`X2`</span> | Residuals from <span class="in">`aov(X1 ~ Y + X2)`</span> |</span>
<span id="cb22-240"><a href="#cb22-240" aria-hidden="true" tabindex="-1"></a>| C       | Unexplained variation in <span class="in">`X2`</span> after accounting for <span class="in">`Y`</span> and <span class="in">`X1`</span> | Residuals from <span class="in">`aov(X2 ~ Y + X1)`</span> |</span>
<span id="cb22-241"><a href="#cb22-241" aria-hidden="true" tabindex="-1"></a>| D + G   | Variance shared by <span class="in">`Y`</span> and <span class="in">`X1`</span> | <span class="in">`X1`</span> in <span class="in">`aov(Y ~ X1)`</span> |</span>
<span id="cb22-242"><a href="#cb22-242" aria-hidden="true" tabindex="-1"></a>| E + G   | Variance shared by <span class="in">`Y`</span> and <span class="in">`X2`</span> | <span class="in">`X2`</span> in <span class="in">`aov(Y ~ X2)`</span> |</span>
<span id="cb22-243"><a href="#cb22-243" aria-hidden="true" tabindex="-1"></a>| D + G   | Variance shared by <span class="in">`X1`</span> and <span class="in">`X2`</span> | <span class="in">`X2`</span> in <span class="in">`aov(X1 ~ X2)`</span> |</span>
<span id="cb22-244"><a href="#cb22-244" aria-hidden="true" tabindex="-1"></a>| D       | Variance *only* between <span class="in">`Y`</span> and <span class="in">`X1`</span>, without influence from <span class="in">`X2`</span> | (A + D + E + G) − A − (E + G) |</span>
<span id="cb22-245"><a href="#cb22-245" aria-hidden="true" tabindex="-1"></a>| E       | Variance *only* between <span class="in">`Y`</span> and <span class="in">`X2`</span>, without influence from <span class="in">`X1`</span> | (C + E + F + G) − C − (F + G) |</span>
<span id="cb22-246"><a href="#cb22-246" aria-hidden="true" tabindex="-1"></a>| F       | Variance *only* between <span class="in">`X1`</span> and <span class="in">`X2`</span>, without influence from <span class="in">`Y`</span> | (B + D + F + G) − B − (D + G) |</span>
<span id="cb22-247"><a href="#cb22-247" aria-hidden="true" tabindex="-1"></a>| G       | Variance shared by <span class="in">`Y`</span>, <span class="in">`X1`</span>, and <span class="in">`X2`</span> | (D + G) − D |</span>
<span id="cb22-248"><a href="#cb22-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-249"><a href="#cb22-249" aria-hidden="true" tabindex="-1"></a>PHEW. That's *a lot*. Here's all the code for it:</span>
<span id="cb22-250"><a href="#cb22-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-251"><a href="#cb22-251" aria-hidden="true" tabindex="-1"></a><span class="in">```{r calc-plot-pieces}</span></span>
<span id="cb22-252"><a href="#cb22-252" aria-hidden="true" tabindex="-1"></a><span class="in">y_total &lt;- ss(df$Y)    # A + D + E + G</span></span>
<span id="cb22-253"><a href="#cb22-253" aria-hidden="true" tabindex="-1"></a><span class="in">x1_total &lt;- ss(df$X1)  # B + D + F + G</span></span>
<span id="cb22-254"><a href="#cb22-254" aria-hidden="true" tabindex="-1"></a><span class="in">x2_total &lt;- ss(df$X2)  # C + E + F + G</span></span>
<span id="cb22-255"><a href="#cb22-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-256"><a href="#cb22-256" aria-hidden="true" tabindex="-1"></a><span class="in"># A</span></span>
<span id="cb22-257"><a href="#cb22-257" aria-hidden="true" tabindex="-1"></a><span class="in">y_alone &lt;- aov(Y ~ X2 + X1, data = df) %&gt;%</span></span>
<span id="cb22-258"><a href="#cb22-258" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy() %&gt;%</span></span>
<span id="cb22-259"><a href="#cb22-259" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(term == "Residuals") %&gt;%</span></span>
<span id="cb22-260"><a href="#cb22-260" aria-hidden="true" tabindex="-1"></a><span class="in">  pull(sumsq)</span></span>
<span id="cb22-261"><a href="#cb22-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-262"><a href="#cb22-262" aria-hidden="true" tabindex="-1"></a><span class="in"># B</span></span>
<span id="cb22-263"><a href="#cb22-263" aria-hidden="true" tabindex="-1"></a><span class="in">x1_alone &lt;- aov(X1 ~ Y + X2, data = df) %&gt;%</span></span>
<span id="cb22-264"><a href="#cb22-264" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy() %&gt;%</span></span>
<span id="cb22-265"><a href="#cb22-265" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(term == "Residuals") %&gt;%</span></span>
<span id="cb22-266"><a href="#cb22-266" aria-hidden="true" tabindex="-1"></a><span class="in">  pull(sumsq)</span></span>
<span id="cb22-267"><a href="#cb22-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-268"><a href="#cb22-268" aria-hidden="true" tabindex="-1"></a><span class="in"># C</span></span>
<span id="cb22-269"><a href="#cb22-269" aria-hidden="true" tabindex="-1"></a><span class="in">x2_alone &lt;- aov(X2 ~ Y + X1, data = df) %&gt;%</span></span>
<span id="cb22-270"><a href="#cb22-270" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy() %&gt;%</span></span>
<span id="cb22-271"><a href="#cb22-271" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(term == "Residuals") %&gt;%</span></span>
<span id="cb22-272"><a href="#cb22-272" aria-hidden="true" tabindex="-1"></a><span class="in">  pull(sumsq)</span></span>
<span id="cb22-273"><a href="#cb22-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-274"><a href="#cb22-274" aria-hidden="true" tabindex="-1"></a><span class="in"># D + G</span></span>
<span id="cb22-275"><a href="#cb22-275" aria-hidden="true" tabindex="-1"></a><span class="in">y_plus_x1 &lt;- aov(Y ~ X1, data = df) %&gt;%</span></span>
<span id="cb22-276"><a href="#cb22-276" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy() %&gt;%</span></span>
<span id="cb22-277"><a href="#cb22-277" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(term == "X1") %&gt;%</span></span>
<span id="cb22-278"><a href="#cb22-278" aria-hidden="true" tabindex="-1"></a><span class="in">  pull(sumsq)</span></span>
<span id="cb22-279"><a href="#cb22-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-280"><a href="#cb22-280" aria-hidden="true" tabindex="-1"></a><span class="in"># E + G</span></span>
<span id="cb22-281"><a href="#cb22-281" aria-hidden="true" tabindex="-1"></a><span class="in">y_plus_x2 &lt;- aov(Y ~ X2, data = df) %&gt;%</span></span>
<span id="cb22-282"><a href="#cb22-282" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy() %&gt;%</span></span>
<span id="cb22-283"><a href="#cb22-283" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(term == "X2") %&gt;%</span></span>
<span id="cb22-284"><a href="#cb22-284" aria-hidden="true" tabindex="-1"></a><span class="in">  pull(sumsq)</span></span>
<span id="cb22-285"><a href="#cb22-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-286"><a href="#cb22-286" aria-hidden="true" tabindex="-1"></a><span class="in"># F + G</span></span>
<span id="cb22-287"><a href="#cb22-287" aria-hidden="true" tabindex="-1"></a><span class="in">x1_plus_x2 &lt;- aov(X1 ~ X2, data = df) %&gt;%</span></span>
<span id="cb22-288"><a href="#cb22-288" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy() %&gt;%</span></span>
<span id="cb22-289"><a href="#cb22-289" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(term == "X2") %&gt;%</span></span>
<span id="cb22-290"><a href="#cb22-290" aria-hidden="true" tabindex="-1"></a><span class="in">  pull(sumsq)</span></span>
<span id="cb22-291"><a href="#cb22-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-292"><a href="#cb22-292" aria-hidden="true" tabindex="-1"></a><span class="in"># D = (A + D + E + G) − A − (E + G)</span></span>
<span id="cb22-293"><a href="#cb22-293" aria-hidden="true" tabindex="-1"></a><span class="in">y_x1_alone &lt;- y_total - y_alone - y_plus_x2</span></span>
<span id="cb22-294"><a href="#cb22-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-295"><a href="#cb22-295" aria-hidden="true" tabindex="-1"></a><span class="in"># E = (A + D + E + G) − A − (D + G)</span></span>
<span id="cb22-296"><a href="#cb22-296" aria-hidden="true" tabindex="-1"></a><span class="in">y_x2_alone &lt;- y_total - y_alone - y_plus_x1</span></span>
<span id="cb22-297"><a href="#cb22-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-298"><a href="#cb22-298" aria-hidden="true" tabindex="-1"></a><span class="in"># G = (D + G) − D</span></span>
<span id="cb22-299"><a href="#cb22-299" aria-hidden="true" tabindex="-1"></a><span class="in">y_x1_x2_alone &lt;- y_plus_x1 - y_x1_alone</span></span>
<span id="cb22-300"><a href="#cb22-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-301"><a href="#cb22-301" aria-hidden="true" tabindex="-1"></a><span class="in"># F = (F + G) - G</span></span>
<span id="cb22-302"><a href="#cb22-302" aria-hidden="true" tabindex="-1"></a><span class="in">x1_x2_alone &lt;- x1_plus_x2 - y_x1_x2_alone</span></span>
<span id="cb22-303"><a href="#cb22-303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-304"><a href="#cb22-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-305"><a href="#cb22-305" aria-hidden="true" tabindex="-1"></a>Again, that's super complex, but it's really just a ton of set theory algebra.</span>
<span id="cb22-306"><a href="#cb22-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-307"><a href="#cb22-307" aria-hidden="true" tabindex="-1"></a>Now that we have all these little pieces, let's plot them!</span>
<span id="cb22-308"><a href="#cb22-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-309"><a href="#cb22-309" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-complex}</span></span>
<span id="cb22-310"><a href="#cb22-310" aria-hidden="true" tabindex="-1"></a><span class="in">all_pieces &lt;- c("Y" = y_alone,</span></span>
<span id="cb22-311"><a href="#cb22-311" aria-hidden="true" tabindex="-1"></a><span class="in">                "X1" = x1_alone,</span></span>
<span id="cb22-312"><a href="#cb22-312" aria-hidden="true" tabindex="-1"></a><span class="in">                "X2" = x2_alone,</span></span>
<span id="cb22-313"><a href="#cb22-313" aria-hidden="true" tabindex="-1"></a><span class="in">                "X1&amp;Y" = y_x1_alone,</span></span>
<span id="cb22-314"><a href="#cb22-314" aria-hidden="true" tabindex="-1"></a><span class="in">                "X2&amp;Y" = y_x2_alone,</span></span>
<span id="cb22-315"><a href="#cb22-315" aria-hidden="true" tabindex="-1"></a><span class="in">                "X1&amp;X2" = x1_x2_alone,</span></span>
<span id="cb22-316"><a href="#cb22-316" aria-hidden="true" tabindex="-1"></a><span class="in">                "Y&amp;X1&amp;X2" = y_x1_x2_alone)</span></span>
<span id="cb22-317"><a href="#cb22-317" aria-hidden="true" tabindex="-1"></a><span class="in">all_pieces</span></span>
<span id="cb22-318"><a href="#cb22-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-319"><a href="#cb22-319" aria-hidden="true" tabindex="-1"></a><span class="in">plot(euler(all_pieces),</span></span>
<span id="cb22-320"><a href="#cb22-320" aria-hidden="true" tabindex="-1"></a><span class="in">     quantities = LETTERS[1:7])</span></span>
<span id="cb22-321"><a href="#cb22-321" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-322"><a href="#cb22-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-323"><a href="#cb22-323" aria-hidden="true" tabindex="-1"></a>These circles are now all proportional to the actual values in the data. Both <span class="in">`X1`</span> and <span class="in">`X2`</span> explain some of the variation in <span class="in">`Y`</span>, but not a ton (and <span class="in">`X1`</span> explains more than <span class="in">`X2`</span>). The explained variance is represented by the area D + E + G, which means we can now calculate the actual $R^2$:</span>
<span id="cb22-324"><a href="#cb22-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-325"><a href="#cb22-325" aria-hidden="true" tabindex="-1"></a><span class="in">```{r calc-r2-complex-manual, include=FALSE}</span></span>
<span id="cb22-326"><a href="#cb22-326" aria-hidden="true" tabindex="-1"></a><span class="in">rsq &lt;- (y_x1_alone + y_x2_alone + y_x1_x2_alone) /</span></span>
<span id="cb22-327"><a href="#cb22-327" aria-hidden="true" tabindex="-1"></a><span class="in">  (y_alone + y_x1_alone + y_x2_alone + y_x1_x2_alone)</span></span>
<span id="cb22-328"><a href="#cb22-328" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-329"><a href="#cb22-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-330"><a href="#cb22-330" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb22-331"><a href="#cb22-331" aria-hidden="true" tabindex="-1"></a>R^2 = \frac{D + E + G}{A + D + E + G} = \frac{<span class="in">`r round(y_x1_alone, 2)`</span> + <span class="in">`r round(y_x2_alone, 2)`</span> + <span class="in">`r round(y_x1_x2_alone, 2)`</span>}{<span class="in">`r round(y_alone, 2)`</span> + <span class="in">`r round(y_x1_alone, 2)`</span> + <span class="in">`r round(y_x2_alone, 2)`</span> + <span class="in">`r round(y_x1_x2_alone, 2)`</span>} = <span class="in">`r round(rsq, 3)`</span></span>
<span id="cb22-332"><a href="#cb22-332" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb22-333"><a href="#cb22-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-334"><a href="#cb22-334" aria-hidden="true" tabindex="-1"></a>Or with code:</span>
<span id="cb22-335"><a href="#cb22-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-336"><a href="#cb22-336" aria-hidden="true" tabindex="-1"></a><span class="in">```{r calc-r2-complex-code}</span></span>
<span id="cb22-337"><a href="#cb22-337" aria-hidden="true" tabindex="-1"></a><span class="in">(y_x1_alone + y_x2_alone + y_x1_x2_alone) /</span></span>
<span id="cb22-338"><a href="#cb22-338" aria-hidden="true" tabindex="-1"></a><span class="in">  (y_alone + y_x1_alone + y_x2_alone + y_x1_x2_alone)</span></span>
<span id="cb22-339"><a href="#cb22-339" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-340"><a href="#cb22-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-341"><a href="#cb22-341" aria-hidden="true" tabindex="-1"></a>Let's confirm it with a regression model:</span>
<span id="cb22-342"><a href="#cb22-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-343"><a href="#cb22-343" aria-hidden="true" tabindex="-1"></a><span class="in">```{r calc-r2-complex-regression}</span></span>
<span id="cb22-344"><a href="#cb22-344" aria-hidden="true" tabindex="-1"></a><span class="in">lm(Y ~ X1 + X2, data = df) %&gt;%</span></span>
<span id="cb22-345"><a href="#cb22-345" aria-hidden="true" tabindex="-1"></a><span class="in">  glance() %&gt;%</span></span>
<span id="cb22-346"><a href="#cb22-346" aria-hidden="true" tabindex="-1"></a><span class="in">  pull(r.squared)</span></span>
<span id="cb22-347"><a href="#cb22-347" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-348"><a href="#cb22-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-349"><a href="#cb22-349" aria-hidden="true" tabindex="-1"></a>AMAZING. It's the same. It worked!</span>
<span id="cb22-350"><a href="#cb22-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-351"><a href="#cb22-351" aria-hidden="true" tabindex="-1"></a><span class="fu">### Nicer plot</span></span>
<span id="cb22-352"><a href="#cb22-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-353"><a href="#cb22-353" aria-hidden="true" tabindex="-1"></a>With everything nice and proportional, let's make this plot a little fancier for teaching purposes. Since **eulerr** uses grid-based graphics, we can use it with [**patchwork**](https://patchwork.data-imaginist.com/) to add annotations (or combine it with other ggplot objects if we really wanted to):</span>
<span id="cb22-354"><a href="#cb22-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-355"><a href="#cb22-355" aria-hidden="true" tabindex="-1"></a><span class="in">```{r nice-plot, fig.width=5, fig.height=6}</span></span>
<span id="cb22-356"><a href="#cb22-356" aria-hidden="true" tabindex="-1"></a><span class="in">library(patchwork)  # For combining ggplot and grid elements</span></span>
<span id="cb22-357"><a href="#cb22-357" aria-hidden="true" tabindex="-1"></a><span class="in">library(grid)       # For making custom grid grobs</span></span>
<span id="cb22-358"><a href="#cb22-358" aria-hidden="true" tabindex="-1"></a><span class="in">library(latex2exp)  # For writing LaTeX-like text with grid plots</span></span>
<span id="cb22-359"><a href="#cb22-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-360"><a href="#cb22-360" aria-hidden="true" tabindex="-1"></a><span class="in">nice_plot &lt;- plot(euler(all_pieces),</span></span>
<span id="cb22-361"><a href="#cb22-361" aria-hidden="true" tabindex="-1"></a><span class="in">                  quantities = list(labels = LETTERS[1:7],</span></span>
<span id="cb22-362"><a href="#cb22-362" aria-hidden="true" tabindex="-1"></a><span class="in">                                    fontfamily = "Roboto Condensed Light",</span></span>
<span id="cb22-363"><a href="#cb22-363" aria-hidden="true" tabindex="-1"></a><span class="in">                                    fontsize = 16),</span></span>
<span id="cb22-364"><a href="#cb22-364" aria-hidden="true" tabindex="-1"></a><span class="in">                  fills = list(fill = c("#7FDBFF", "grey30", "grey80",</span></span>
<span id="cb22-365"><a href="#cb22-365" aria-hidden="true" tabindex="-1"></a><span class="in">                                        "#FF851B", "#FF851B", "grey50", "#FF851B"),</span></span>
<span id="cb22-366"><a href="#cb22-366" aria-hidden="true" tabindex="-1"></a><span class="in">                               alpha = c(1, 0.5, 0.5, 0.5, 0.5, 0.5, 0.35)),</span></span>
<span id="cb22-367"><a href="#cb22-367" aria-hidden="true" tabindex="-1"></a><span class="in">                  labels = list(fontfamily = "Roboto Condensed",</span></span>
<span id="cb22-368"><a href="#cb22-368" aria-hidden="true" tabindex="-1"></a><span class="in">                                fontface = "bold", fontsize = 20))</span></span>
<span id="cb22-369"><a href="#cb22-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-370"><a href="#cb22-370" aria-hidden="true" tabindex="-1"></a><span class="in">math_part &lt;- textGrob(TeX("R^2 = \\frac{D + E + G}{A + D + E + G}"),</span></span>
<span id="cb22-371"><a href="#cb22-371" aria-hidden="true" tabindex="-1"></a><span class="in">                      gp = gpar(fontfamily = "Roboto Condensed",</span></span>
<span id="cb22-372"><a href="#cb22-372" aria-hidden="true" tabindex="-1"></a><span class="in">                                col = "grey50", fontsize = 13))</span></span>
<span id="cb22-373"><a href="#cb22-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-374"><a href="#cb22-374" aria-hidden="true" tabindex="-1"></a><span class="in"># Ordinarily patchwork works just fine with grid grob objects, like the results</span></span>
<span id="cb22-375"><a href="#cb22-375" aria-hidden="true" tabindex="-1"></a><span class="in"># from plot.euler(), but *not* when they're the first element in patchwork chain</span></span>
<span id="cb22-376"><a href="#cb22-376" aria-hidden="true" tabindex="-1"></a><span class="in"># of plots. To make grob objects work nicely with patchwork, we need to wrap</span></span>
<span id="cb22-377"><a href="#cb22-377" aria-hidden="true" tabindex="-1"></a><span class="in"># them in wrap_elements()</span></span>
<span id="cb22-378"><a href="#cb22-378" aria-hidden="true" tabindex="-1"></a><span class="in">wrap_elements(nice_plot) +</span></span>
<span id="cb22-379"><a href="#cb22-379" aria-hidden="true" tabindex="-1"></a><span class="in">  inset_element(math_part,</span></span>
<span id="cb22-380"><a href="#cb22-380" aria-hidden="true" tabindex="-1"></a><span class="in">                left = -0.04, bottom = 0.72, right = 0.3, top = 0.85) +</span></span>
<span id="cb22-381"><a href="#cb22-381" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_annotation(</span></span>
<span id="cb22-382"><a href="#cb22-382" aria-hidden="true" tabindex="-1"></a><span class="in">    title = "R² represented as an Euler diagram",</span></span>
<span id="cb22-383"><a href="#cb22-383" aria-hidden="true" tabindex="-1"></a><span class="in">    subtitle = "Orange area (D + E + G) shows the total variance in\noutcome Y that is jointly explained by X1 and X2",</span></span>
<span id="cb22-384"><a href="#cb22-384" aria-hidden="true" tabindex="-1"></a><span class="in">    caption = "Circles sized according to each variable's sum of squares; size of overlapping areas\nis not 100% correct due to limitations in available geometric space",</span></span>
<span id="cb22-385"><a href="#cb22-385" aria-hidden="true" tabindex="-1"></a><span class="in">    theme = theme(plot.title = element_text(size = 20, family = "Roboto Condensed", face = "bold"),</span></span>
<span id="cb22-386"><a href="#cb22-386" aria-hidden="true" tabindex="-1"></a><span class="in">                  plot.subtitle = element_text(size = 15, family = "Roboto Condensed"),</span></span>
<span id="cb22-387"><a href="#cb22-387" aria-hidden="true" tabindex="-1"></a><span class="in">                  plot.caption = element_text(size = 10, family = "Roboto Condensed Light", hjust = 0))</span></span>
<span id="cb22-388"><a href="#cb22-388" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb22-389"><a href="#cb22-389" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-390"><a href="#cb22-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-391"><a href="#cb22-391" aria-hidden="true" tabindex="-1"></a><span class="fu">### Multicollinearity</span></span>
<span id="cb22-392"><a href="#cb22-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-393"><a href="#cb22-393" aria-hidden="true" tabindex="-1"></a>Another neat feature of this kind of diagram is that it helps visualize <span class="co">[</span><span class="ot">multicollinearity</span><span class="co">](https://en.wikipedia.org/wiki/Multicollinearity)</span>, or the issues that arise when you control for explanatory variables that explain the same kind of variation in the outcome. Multicollinearity leads to strange coefficient estimates and variance inflation because mathematically the regression model has no way of telling which of the highly correlated explanatory variables explain which parts of the outcome.</span>
<span id="cb22-394"><a href="#cb22-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-395"><a href="#cb22-395" aria-hidden="true" tabindex="-1"></a>In the diagram, areas D and E are uniquely accounted for by <span class="in">`X1`</span> and <span class="in">`X2`</span> respectively, but G is is overlapped, making it impossible to know if <span class="in">`X1`</span> or <span class="in">`X2`</span> explains that portion of the variation in <span class="in">`Y`</span>. Similarly, area F shows the variation shared by both <span class="in">`X1`</span> and <span class="in">`X2`</span>, and again it's impossible to know which parts are unique. As a result, the area (F + G) represents the total multicollinearity in the model:</span>
<span id="cb22-396"><a href="#cb22-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-397"><a href="#cb22-397" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-multicollinearity}</span></span>
<span id="cb22-398"><a href="#cb22-398" aria-hidden="true" tabindex="-1"></a><span class="in">plot(euler(all_pieces),</span></span>
<span id="cb22-399"><a href="#cb22-399" aria-hidden="true" tabindex="-1"></a><span class="in">     quantities = LETTERS[1:7],</span></span>
<span id="cb22-400"><a href="#cb22-400" aria-hidden="true" tabindex="-1"></a><span class="in">     fills = c(rep("white", 5), rep("#FF4136", 2)))</span></span>
<span id="cb22-401"><a href="#cb22-401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-402"><a href="#cb22-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-403"><a href="#cb22-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-404"><a href="#cb22-404" aria-hidden="true" tabindex="-1"></a><span class="fu">## Why this matters</span></span>
<span id="cb22-405"><a href="#cb22-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-406"><a href="#cb22-406" aria-hidden="true" tabindex="-1"></a>One really neat thing about thinking about $R^2$ this way is that it highlights a key difference in the purposes of regression: prediction and estimation.</span>
<span id="cb22-407"><a href="#cb22-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-408"><a href="#cb22-408" aria-hidden="true" tabindex="-1"></a>With prediction, the goal of the regression model is to predict the outcome as accurately as possible. This is what Netflix does when guessing what show you might want to watch next, or what the <span class="co">[</span><span class="ot">US Holocaust Museum does to predict genocide and human rights abuses</span><span class="co">](https://earlywarningproject.ushmm.org/)</span>. You throw in as many control variables as you can in order to create a model that explains variation in Y as accurately as possible. As a result, these kinds of models will typically have a high $R^2$.</span>
<span id="cb22-409"><a href="#cb22-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-410"><a href="#cb22-410" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-diagram-prediction}</span></span>
<span id="cb22-411"><a href="#cb22-411" aria-hidden="true" tabindex="-1"></a><span class="in">plot(euler(c("Next show\non Netflix" = 1,</span></span>
<span id="cb22-412"><a href="#cb22-412" aria-hidden="true" tabindex="-1"></a><span class="in">             "X1" = 4,</span></span>
<span id="cb22-413"><a href="#cb22-413" aria-hidden="true" tabindex="-1"></a><span class="in">             "X2" = 6,</span></span>
<span id="cb22-414"><a href="#cb22-414" aria-hidden="true" tabindex="-1"></a><span class="in">             "X3" = 4,</span></span>
<span id="cb22-415"><a href="#cb22-415" aria-hidden="true" tabindex="-1"></a><span class="in">             "X4" = 6,</span></span>
<span id="cb22-416"><a href="#cb22-416" aria-hidden="true" tabindex="-1"></a><span class="in">             "X5" = 6,</span></span>
<span id="cb22-417"><a href="#cb22-417" aria-hidden="true" tabindex="-1"></a><span class="in">             "X1&amp;Next show\non Netflix" = 2,</span></span>
<span id="cb22-418"><a href="#cb22-418" aria-hidden="true" tabindex="-1"></a><span class="in">             "X2&amp;Next show\non Netflix" = 4,</span></span>
<span id="cb22-419"><a href="#cb22-419" aria-hidden="true" tabindex="-1"></a><span class="in">             "X3&amp;Next show\non Netflix" = 4,</span></span>
<span id="cb22-420"><a href="#cb22-420" aria-hidden="true" tabindex="-1"></a><span class="in">             "X4&amp;Next show\non Netflix" = 2,</span></span>
<span id="cb22-421"><a href="#cb22-421" aria-hidden="true" tabindex="-1"></a><span class="in">             "X5&amp;Next show\non Netflix" = 4,</span></span>
<span id="cb22-422"><a href="#cb22-422" aria-hidden="true" tabindex="-1"></a><span class="in">             "X1&amp;X2" = 2,</span></span>
<span id="cb22-423"><a href="#cb22-423" aria-hidden="true" tabindex="-1"></a><span class="in">             "Next show\non Netflix&amp;X1&amp;X2" = 0.5)))</span></span>
<span id="cb22-424"><a href="#cb22-424" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-425"><a href="#cb22-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-426"><a href="#cb22-426" aria-hidden="true" tabindex="-1"></a>Look at that squishy little area of Y that's not explained by any of the other variables. Neato.</span>
<span id="cb22-427"><a href="#cb22-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-428"><a href="#cb22-428" aria-hidden="true" tabindex="-1"></a>In the realm of causal inference in social science, or with estimation in general, the focus of the analysis is on *a single X variable* , like whether or not people in the sample participated in a social program. You might include a bunch of control variables if you identification strategy tells you do: an interaction term for time and group if you're using <span class="co">[</span><span class="ot">difference-in-differences</span><span class="co">](https://evalf21.classes.andrewheiss.com/example/diff-in-diff/)</span>, an indicator showing if people are above/below a threshold if you're using <span class="co">[</span><span class="ot">regression discontinuity</span><span class="co">](https://evalf21.classes.andrewheiss.com/example/rdd/)</span>, an instrument if you're using <span class="co">[</span><span class="ot">instrumental variables</span><span class="co">](https://evalf21.classes.andrewheiss.com/example/iv/)</span>, confounding control variables if you're using <span class="co">[</span><span class="ot">inverse probability weighting and a DAG</span><span class="co">](https://evalf21.classes.andrewheiss.com/example/matching-ipw/)</span>, or nothing(!) if you're using a <span class="co">[</span><span class="ot">randomized controlled trial</span><span class="co">](https://evalf21.classes.andrewheiss.com/example/rcts/)</span> (like you can really just run <span class="in">`lm(Y ~ treatment)`</span>!). Each of these types of models will inevitably return an $R^2$ value, since that what regression does, but we care less about that when estimating causal effects. All we care about is the accuracy of one little sliver of the diagram—that single policy lever that we might have control over to influence the larger outcome.</span>
<span id="cb22-429"><a href="#cb22-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-430"><a href="#cb22-430" aria-hidden="true" tabindex="-1"></a>For instance, let's say you're a new little nonprofit who created a cool new program to help reduce childhood poverty within your city. You want to know if that program does anything to poverty more generally. You have lots of donor money so you decide to run a carefully designed randomized trial. You run a regression model and get a tiny $R^2$ value, like 0.015. You panic because that means your experiment only explains 1.5% of the variation in poverty, and that seems really bad and low!</span>
<span id="cb22-431"><a href="#cb22-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-432"><a href="#cb22-432" aria-hidden="true" tabindex="-1"></a>But that's actually totally fine. The goal with the experiment is *not* to explain all the factors that create poverty—there are far too many to include in a regression model. The goal here is to have an accurate estimate of how much your single program affects poverty. There's *no way* your little program is going to explain 80% of the variation in poverty. If you had a high $R^2$, I'd be incredibly worried! (Unless you really discovered a program that is a true silver bullet for poverty!)</span>
<span id="cb22-433"><a href="#cb22-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-434"><a href="#cb22-434" aria-hidden="true" tabindex="-1"></a>Looking at an Euler diagram demonstrates this more easily. All we care about in this experiment is that little sliver. Is it accurate? Does the treatment move the needle on poverty in any way? If so, great!</span>
<span id="cb22-435"><a href="#cb22-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-436"><a href="#cb22-436" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-diagram-estimation}</span></span>
<span id="cb22-437"><a href="#cb22-437" aria-hidden="true" tabindex="-1"></a><span class="in">plot(euler(c("Poverty" = 100,</span></span>
<span id="cb22-438"><a href="#cb22-438" aria-hidden="true" tabindex="-1"></a><span class="in">             "Program" = 2,</span></span>
<span id="cb22-439"><a href="#cb22-439" aria-hidden="true" tabindex="-1"></a><span class="in">             "Poverty&amp;Program" = 0.25)),</span></span>
<span id="cb22-440"><a href="#cb22-440" aria-hidden="true" tabindex="-1"></a><span class="in">     fills = c("white", "grey75", "#FF851B"))</span></span>
<span id="cb22-441"><a href="#cb22-441" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-442"><a href="#cb22-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-443"><a href="#cb22-443" aria-hidden="true" tabindex="-1"></a>So don't dismiss models immediately just because of a low $R^2$! The purpose of the models matters!</span>
<span id="cb22-444"><a href="#cb22-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-445"><a href="#cb22-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-446"><a href="#cb22-446" aria-hidden="true" tabindex="-1"></a><span class="fu">## Caveats</span></span>
<span id="cb22-447"><a href="#cb22-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-448"><a href="#cb22-448" aria-hidden="true" tabindex="-1"></a>There are a few important caveats to keep in mind with these diagrams:</span>
<span id="cb22-449"><a href="#cb22-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-450"><a href="#cb22-450" aria-hidden="true" tabindex="-1"></a>**1: This is inefficient**</span>
<span id="cb22-451"><a href="#cb22-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-452"><a href="#cb22-452" aria-hidden="true" tabindex="-1"></a>Calculating each of these plot segments by hand is tedious and there will inevitably be typos and errors (there are probably errors in this very post!). Also, due to how ANOVA works, the order of the variables you specify matters *a lot*: <span class="in">`aov(Y ~ X1 + X2)`</span> and <span class="in">`aov(Y ~ X2 + X1)`</span> give completely different sum of squares for the joint variation of <span class="in">`Y`</span>, <span class="in">`X1`</span>, and <span class="in">`X2`</span>. That in turn changes the sizes of the segments.</span>
<span id="cb22-453"><a href="#cb22-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-454"><a href="#cb22-454" aria-hidden="true" tabindex="-1"></a>When writing this, I spent way too much time playing with covariance matrices, partial correlation matrices, and variance-covariance matrices to see if I could calculate these areas more mathematically using the guts of regression and ANOVA, but it was too tricky. Smarter people than me will need to figure it out.</span>
<span id="cb22-455"><a href="#cb22-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-456"><a href="#cb22-456" aria-hidden="true" tabindex="-1"></a>**2: This doesn't work in all cases**</span>
<span id="cb22-457"><a href="#cb22-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-458"><a href="#cb22-458" aria-hidden="true" tabindex="-1"></a>It's possible to have negative areas, depending on the data you have, and negative areas are unplottable (@Ip:2001 shows an example of this at the end of his article). In order to use this kind of diagram when teaching, you have to use carefully constructed data—you can't just throw any model into a chart like this. Also, when working with actual numbers, you're generally limited to just one or two explanatory variables. Any more and the math gets too complex.</span>
<span id="cb22-459"><a href="#cb22-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-460"><a href="#cb22-460" aria-hidden="true" tabindex="-1"></a>**3: This isn't 100% accurate**</span>
<span id="cb22-461"><a href="#cb22-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-462"><a href="#cb22-462" aria-hidden="true" tabindex="-1"></a>The geometry behind creating these Euler diagrams is complex and doesn't always work perfectly. Let's plot the actual values of the sum of squares for each segment:</span>
<span id="cb22-463"><a href="#cb22-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-464"><a href="#cb22-464" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-complex-values}</span></span>
<span id="cb22-465"><a href="#cb22-465" aria-hidden="true" tabindex="-1"></a><span class="in">plot(euler(all_pieces),</span></span>
<span id="cb22-466"><a href="#cb22-466" aria-hidden="true" tabindex="-1"></a><span class="in">     quantities = TRUE)</span></span>
<span id="cb22-467"><a href="#cb22-467" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-468"><a href="#cb22-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-469"><a href="#cb22-469" aria-hidden="true" tabindex="-1"></a>That central piece where <span class="in">`Y`</span>, <span class="in">`X1`</span>, and <span class="in">`X2`</span> is 42, but it's smaller any of the other intersections, which all have smaller sum-of-squares values. Yikes!</span>
<span id="cb22-470"><a href="#cb22-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-471"><a href="#cb22-471" aria-hidden="true" tabindex="-1"></a>The **eulerr** package provides a way of diagnosing how bad things are by either inspecting the results of <span class="in">`euler()`</span> directly, or looking at the residuals and errors with <span class="in">`error_plot()`</span>:</span>
<span id="cb22-472"><a href="#cb22-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-473"><a href="#cb22-473" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-errors}</span></span>
<span id="cb22-474"><a href="#cb22-474" aria-hidden="true" tabindex="-1"></a><span class="in">euler(all_pieces)</span></span>
<span id="cb22-475"><a href="#cb22-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-476"><a href="#cb22-476" aria-hidden="true" tabindex="-1"></a><span class="in">error_plot(euler(all_pieces),</span></span>
<span id="cb22-477"><a href="#cb22-477" aria-hidden="true" tabindex="-1"></a><span class="in">           quantities = TRUE)</span></span>
<span id="cb22-478"><a href="#cb22-478" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-479"><a href="#cb22-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-480"><a href="#cb22-480" aria-hidden="true" tabindex="-1"></a>That central piece is underrepresented, while the other intersections are overrepresented. Alas.</span>
<span id="cb22-481"><a href="#cb22-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-482"><a href="#cb22-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-483"><a href="#cb22-483" aria-hidden="true" tabindex="-1"></a><span class="fu">## References</span></span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p><span class="faux-block">Forked from <a href="https://www.andrewheiss.com/">Andrew Heiss</a></span> # <span class="faux-block"><a href="https://github.com/andrewheiss/ath-quarto">View the source at <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></span></p>
</div>
  </div>
</footer>


</body></html>