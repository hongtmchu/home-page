<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Hong T.M. Chu">
<meta name="description" content="Make knitr and R Markdown convert TikZ graphics to font-embedded SVG files when knitting to HTML">
<title>How to automatically convert TikZ images to SVG (with fonts!) from knitr | Hong T.M. Chu – Hong T.M. Chu</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../../">
<link href="../../../../..//files/favicon-512.png" rel="icon" type="image/png">
<script src="../../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting-17c909d5fd25ae21b861c0c7a49b2096.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../site_libs/bootstrap/bootstrap-5cd0811f461c8271ae6bab49df9501be.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script src="../../../../../site_libs/quarto-contrib/iconify-2.0.0/iconify-icon.min.js"></script><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-527449-5', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script><style>

      .quarto-title-block .quarto-title-banner {
        background: #170C3A;
      }
</style>
<meta property="og:title" content="How to automatically convert TikZ images to SVG (with fonts!) from knitr | Hong T.M. Chu">
<meta property="og:description" content="Make knitr and R Markdown convert TikZ graphics to font-embedded SVG files when knitting to HTML">
<meta property="og:image" content="https://www.andrewheiss.com/blog/2021/08/27/tikz-knitr-html-svg-fun/example-final.png">
<meta property="og:site_name" content="Hong T.M. Chu">
<meta property="og:locale" content="en_US">
<meta property="og:image:height" content="1056">
<meta property="og:image:width" content="2016">
<meta name="twitter:title" content="How to automatically convert TikZ images to SVG (with fonts!) from knitr | Hong T.M. Chu">
<meta name="twitter:description" content="Make knitr and R Markdown convert TikZ graphics to font-embedded SVG files when knitting to HTML">
<meta name="twitter:image" content="https://www.andrewheiss.com/blog/2021/08/27/tikz-knitr-html-svg-fun/example-final.png">
<meta name="twitter:creator" content="@andrewheiss">
<meta name="twitter:site" content="@andrewheiss">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image-height" content="1056">
<meta name="twitter:image-width" content="2016">
</head>
<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../../index.html">
    <span class="navbar-title">Hong T.M. Chu</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../../../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../cv/index.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../research/index.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../teaching/index.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="mailto:hong.ctm@vinuni.edu.vn"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:envelope" style="font-size: 1.1em;" aria-label="Icon envelope from bi Iconify.design set." title="E-mail"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/andrewheiss" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:github" style="font-size: 1.1em;" aria-label="Icon github from bi Iconify.design set." title="GitHub"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/hongtmchu" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:linkedin" style="font-size: 1.1em;" aria-label="Icon linkedin from bi Iconify.design set." title="LinkedIn"></iconify-icon></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default blog-post page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">How to automatically convert TikZ images to SVG (with fonts!) from knitr</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
                  <div>
        <div class="description">
          Make knitr and R Markdown convert TikZ graphics to font-embedded SVG files when knitting to HTML
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">r</div>
                <div class="quarto-category">tidyverse</div>
                <div class="quarto-category">R markdown</div>
                <div class="quarto-category">tikz</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://www.andrewheiss.com/">Andrew Heiss</a> <a href="https://orcid.org/0000-0002-3948-3914" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">Friday, August 27, 2021</p>
      </div>
    </div>
    
      
      <div>
      <div class="quarto-title-meta-heading">Doi</div>
      <div class="quarto-title-meta-contents">
        <p class="doi">
          <a href="https://doi.org/10.59350/6qevp-87j81">10.59350/6qevp-87j81</a>
        </p>
      </div>
    </div>
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Contents</h2>
   
  <ul>
<li><a href="#knitting-tikz-chunks-to-pdf" id="toc-knitting-tikz-chunks-to-pdf" class="nav-link active" data-scroll-target="#knitting-tikz-chunks-to-pdf">Knitting TikZ chunks to PDF</a></li>
  <li><a href="#knitting-tikz-chunks-to-html-as-pngs" id="toc-knitting-tikz-chunks-to-html-as-pngs" class="nav-link" data-scroll-target="#knitting-tikz-chunks-to-html-as-pngs">Knitting TikZ chunks to HTML as PNGs</a></li>
  <li>
<a href="#knitting-tikz-chunks-to-html-as-svgs" id="toc-knitting-tikz-chunks-to-html-as-svgs" class="nav-link" data-scroll-target="#knitting-tikz-chunks-to-html-as-svgs">Knitting TikZ chunks to HTML as SVGs</a>
  <ul class="collapse">
<li><a href="#connecting-dvisvgm-to-ghostscript-on-macos" id="toc-connecting-dvisvgm-to-ghostscript-on-macos" class="nav-link" data-scroll-target="#connecting-dvisvgm-to-ghostscript-on-macos">Connecting <code>dvisvgm</code> to Ghostscript on macOS</a></li>
  <li><a href="#connecting-dvisvgm-to-ghostscript-within-r" id="toc-connecting-dvisvgm-to-ghostscript-within-r" class="nav-link" data-scroll-target="#connecting-dvisvgm-to-ghostscript-within-r">Connecting <code>dvisvgm</code> to Ghostscript within R</a></li>
  <li><a href="#choosing-the-tikz-output-format-based-on-the-knitted-output" id="toc-choosing-the-tikz-output-format-based-on-the-knitted-output" class="nav-link" data-scroll-target="#choosing-the-tikz-output-format-based-on-the-knitted-output">Choosing the TikZ output format based on the knitted output</a></li>
  <li><a href="#font-issues" id="toc-font-issues" class="nav-link" data-scroll-target="#font-issues">Font issues</a></li>
  <li><a href="#font-solutions" id="toc-font-solutions" class="nav-link" data-scroll-target="#font-solutions">Font solutions</a></li>
  </ul>
</li>
  <li><a href="#tldr-final-working-version" id="toc-tldr-final-working-version" class="nav-link" data-scroll-target="#tldr-final-working-version">tl;dr: Final working version</a></li>
  <li><a href="#update-easier-font-embedding" id="toc-update-easier-font-embedding" class="nav-link" data-scroll-target="#update-easier-font-embedding">UPDATE: Easier font embedding!</a></li>
  <li>
<a href="#another-update-changing-fonts" id="toc-another-update-changing-fonts" class="nav-link" data-scroll-target="#another-update-changing-fonts">ANOTHER UPDATE: Changing fonts!</a>
  <ul class="collapse">
<li><a href="#knitting-only-to-pdf" id="toc-knitting-only-to-pdf" class="nav-link" data-scroll-target="#knitting-only-to-pdf">Knitting only to PDF</a></li>
  <li><a href="#knitting-to-pdf-and-html" id="toc-knitting-to-pdf-and-html" class="nav-link" data-scroll-target="#knitting-to-pdf-and-html">Knitting to PDF and HTML</a></li>
  </ul>
</li>
  </ul></nav>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Update #1
</div>
</div>
<div class="callout-body-container callout-body">
<p>An update to knitr has made it a ton easier to embed fonts in SVG files from R. <a href="#update-easier-font-embedding">Jump to the update</a> to see how.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Update #2
</div>
</div>
<div class="callout-body-container callout-body">
<p>Also, it’s possible to change TikZ fonts and not use Computer Modern for everything! <a href="#another-update-changing-fonts">Jump to the second update</a> to see how.</p>
</div>
</div>
<p><strong>knitr</strong> and R Markdown are essential parts of my academic writing workflow, and they make it really easy to write in one file format and then convert it to whatever output I need. When knitting to PDF, plots are all vector-based with selectable text, and math equations are all done in beautiful LaTeX. When knitting to HTML, plots are PNG files (since HTML struggles with cross-browser vector image support), and math equations are all done in beautiful MathJax. It’s a wonderful system.</p>
<p>One place where the system struggles, though, is with more complex types of content like TikZ figures. TikZ lets you make all sorts of fancy diagrams and equations, but it’s a tricky language and I barely understand it, lol. There are some helpful resources about it, though:</p>
<ul>
<li>
<a href="https://rmwu.github.io/">Rachel Menghua Wu</a>’s crash course to TikZ (<a href="https://rmwu.github.io/tutorial/latex/2019/08/27/intro/">part 1</a> and <a href="https://rmwu.github.io/tutorial/latex/2019/11/21/positioning/">part 2</a>)</li>
<li><a href="https://www.overleaf.com/learn/latex/TikZ_package">Overleaf’s guide</a></li>
<li><a href="https://www.overleaf.com/learn/latex/LaTeX_Graphics_using_TikZ:_A_Tutorial_for_Beginners_(Part_1)%E2%80%94Basic_Drawing">Overleaf’s tutorial series</a></li>
<li>
<a href="https://www.mathcha.io/">Mathcha</a> can draw and export diagrams as TikZ, as can <a href="http://dagitty.net/">DAGitty</a>
</li>
</ul>
<p>Through the magic of <strong>knitr</strong> and R Markdown, it’s actually possible to use TikZ chunks directly in an R Markdown document and have them knit to both PDF <em>and</em> vector-based SVG files in HTML. Magic!</p>
<section id="knitting-tikz-chunks-to-pdf" class="level2"><h2 class="anchored" data-anchor-id="knitting-tikz-chunks-to-pdf">Knitting TikZ chunks to PDF</h2>
<p><strong>knitr</strong> has the ability to <a href="https://yihui.org/knitr/demo/engines/">use custom engines for rendering other languages</a>, including TikZ, by including a <code>tikz</code> chunk like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz}</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="in">% TikZ code here</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To try this out, make a new blank .Rmd file and put this in it:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "TikZ fun!"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">  pdf_document: default</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>Here's an empty DAG</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz, echo=FALSE, cache=TRUE, fig.cap="Empty DAG", fig.align="center"}</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning}</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}[every node/.append style={draw, minimum size=0.5cm}]</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="in">\node [circle] (X) at (0,0) {};</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="in">\node [circle] (Y) at (2,0) {};</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle] (Z) at (1,1) {};</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="in">\path [-latex] (X) edge (Y);</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex] (Z) edge (Y);</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex] (Z) edge (X);</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Knit that to PDF and you’ll see a neat little diagram of a <a href="https://cran.r-project.org/web/packages/ggdag/vignettes/intro-to-dags.html">directed acyclic graph</a> (or DAG) (<a href="example-1.pdf">see full PDF here</a>):</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="example-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section><section id="knitting-tikz-chunks-to-html-as-pngs" class="level2"><h2 class="anchored" data-anchor-id="knitting-tikz-chunks-to-html-as-pngs">Knitting TikZ chunks to HTML as PNGs</h2>
<p>If you knit that document to HTML, you’ll also see the same diagram, but it will be a low resolution PNG and will look huge and pixelated. Behind the scenes, <strong>knitr</strong> converts the TikZ chunk to PDF and then converts that PDF to PNG and includes it in the HTML file (<a href="example-1.html">see full HTML file here</a>).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="example-1-pixelated.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p>There’s theoretically a way to change the DPI of this PNG file using the <code>engine.opts</code> chunk option and passing additional arguments to ImageMagick, which handles the conversion, but it only causes errors for me (<code>Error in magick_image_format(image, toupper(format), type, colorspace, : Invalid ImageType value: -density 300</code>) and I can’t figure out why (see <a href="https://stackoverflow.com/questions/51735831/is-it-possible-to-increase-resolution-of-image-inserted-to-word-document-from-rm">this StackOverflow post too</a>) :</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz, engine.opts = list(convert.opts = '-density 300'), fig.ext="png"}</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="in">% Stuff here</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section><section id="knitting-tikz-chunks-to-html-as-svgs" class="level2"><h2 class="anchored" data-anchor-id="knitting-tikz-chunks-to-html-as-svgs">Knitting TikZ chunks to HTML as SVGs</h2>
<p>But even if I could get it to work, PNG files aren’t great for vector-like things like TikZ diagrams. It would be great if instead I could convert these diagrams to vector-based SVG files.</p>
<p>Fortunately <strong>knitr</strong> handles that too! Try this! (Note the <code>self_contained: no</code> in the YAML metadata—this will create a standalone DVI and SVG file in a folder named <code>&lt;NAME_OF_RMD&gt;_files/html-figures/</code>. You don’t technically need this—without it, R will embed the images as base64-encoded text—but to make it easier to see the files R makes, we’ll disable it)</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "TikZ fun!"</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html_document: </span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">    self_contained: no</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>Here's an empty DAG:</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz empty-dag, echo=FALSE, fig.cap="Empty DAG", fig.align="center", fig.ext="svg"}</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning}</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}[every node/.append style={draw, minimum size=0.5cm}]</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="in">\node [circle] (X) at (0,0) {};</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="in">\node [circle] (Y) at (2,0) {};</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle] (Z) at (1,1) {};</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="in">\path [-latex] (X) edge (Y);</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex] (Z) edge (Y);</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex] (Z) edge (X);</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You’ll most likely get an error about Ghostscript:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#&gt; processing of PostScript specials is disabled (Ghostscript not found)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="connecting-dvisvgm-to-ghostscript-on-macos" class="level3"><h3 class="anchored" data-anchor-id="connecting-dvisvgm-to-ghostscript-on-macos">Connecting <code>dvisvgm</code> to Ghostscript on macOS</h3>
<p>Unfortunately it takes a little bit of initial setup to get all the moving pieces working for it to happen. To go from TikZ to SVG, <strong>knitr</strong> first converts the <code>tikz</code> chunk to DVI and then uses the terminal program <code>dvisvgm</code> to convert the DVI to SVG. Getting <code>dvisvgm</code> working on macOS is tricky though (and presumably it’s tricky on Windows too, but I don’t have a Windows machine to test it on).</p>
<p>The most typical way of installing the LaTeX ecosystem on macOS is to install <a href="https://www.tug.org/mactex/">MacTeX</a>, which comes with all the dozens of special utilities TeX uses for typesetting. MacTeX comes with both <code>dvisvgm</code> and a special program called Ghostscript that handles text in DVI files. HOWEVER, by default it does not provide a way to have <code>dvisvgm</code> and Ghostscript talk to each other (there’s <a href="https://tex.stackexchange.com/questions/559640/making-dvisvgm-and-ghostscript-from-mactex-talk-to-each-other">a whole post about it here</a>). Ghostscript really is installed, though—<code>dvisvgm</code> just can’t see it.</p>
<p>To fix it, you actually need to reinstall MacTex and choose a custom installation option. When you get to the “Installation Type” section in the package installation dialog box, click on “Customize” and then make sure the box is checked for “Ghostscript Dynamic Library”. By default this is not checked, and I have no clue why, since this is the bridge that you need to get <code>dvisvgm</code> and Ghostscript to talk to each other.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="install-mactex.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Install MacTeX with that option enabled and you’ll have a special new file nested deep within your filesystem at <code>/usr/local/share/ghostscript/9.53.3/lib/libgs.dylib.9.53</code>. This <code>libgs.dylib.**</code> file is the dynamic library that <code>dvisvgm</code> needs to know about to work. MacTex 2021 installs Ghostscript 9.53.3, so later versions of MacTex will place <code>libgs.dylib</code> somewhere else.</p>
<p>To tell <code>dvisvgm</code> where this dynamic library is, you then need to set an environment variable. Open <code>~/.bash_profile</code> or <code>~/.zshrc</code> or whatever you use for setting your PATH and other terminal settings and add this:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">LIBGS</span><span class="op">=</span>/usr/local/share/ghostscript/9.53.3/lib/libgs.dylib.9.53</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Open a new terminal window and type <code>print $LIBGS</code> to verify that the environment variable was actually set. Now you should be able to run <code>dvisvgm -l</code> and see an entry for <code>ps</code> in it (see <a href="https://dvisvgm.de/FAQ/">this FAQ page</a> for lots of other details and help for troubleshooting this):</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> dvisvgm <span class="at">-l</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ps</span>         dvips PostScript specials</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>That means everything’s working and you should now be able to convert from DVI to SVG!</p>
</section><section id="connecting-dvisvgm-to-ghostscript-within-r" class="level3"><h3 class="anchored" data-anchor-id="connecting-dvisvgm-to-ghostscript-within-r">Connecting <code>dvisvgm</code> to Ghostscript within R</h3>
<p>However, RStudio doesn’t pick up your shell’s environment variables when knitting files, so if you knit the document with <code>fix.ext='svg'</code> enabled, you’ll still get an error about Ghostscript not being found.</p>
<p>To get around this, you can actually set environment variables from within the R Markdown document itself. Add <code><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv()</a></code> to an invisible chunk like this:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "TikZ fun!"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html_document: </span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">    self_contained: no</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="in">```{r point-to-ghostscript, include=FALSE}</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="in">Sys.setenv(LIBGS = "/usr/local/share/ghostscript/9.53.3/lib/libgs.dylib.9.53")</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>Here's an empty DAG:</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz empty-dag, echo=FALSE, fig.cap="Empty DAG", fig.align="center", fig.ext="svg"}</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning}</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}[every node/.append style={draw, minimum size=0.5cm}]</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="in">\node [circle] (X) at (0,0) {};</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="in">\node [circle] (Y) at (2,0) {};</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle] (Z) at (1,1) {};</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="in">\path [-latex] (X) edge (Y);</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex] (Z) edge (Y);</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex] (Z) edge (X);</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And now everything should work! You’ll get an HTML file with a vector-based SVG version of the TikZ figure (<a href="example-2.html">see full HTML file here</a>):</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="example-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
</section><section id="choosing-the-tikz-output-format-based-on-the-knitted-output" class="level3"><h3 class="anchored" data-anchor-id="choosing-the-tikz-output-format-based-on-the-knitted-output">Choosing the TikZ output format based on the knitted output</h3>
<p>We can now knit this TikZ chunk to PDF if we use <code>fig.ext="pdf"</code> and to SVG if we use <code>fig.ext="svg"</code> in the chunk options. Remembering to switch these extensions manually, though, is tedious. To make life a little easier, we can create some conditional output types using <strong>knitr</strong>’s (newer?) <code>opts-template</code> ability, which lets you create chunk option templates that you can reuse throughout the document. Here, we’ll use <code>fig.ext="pdf"</code> when knitting to PDF, and <code>fig.ext="svg"</code> otherwise. If I could get the TikZ → PNG conversion working nicely, I’d make it use <code>fig.ext="png"</code> when knitting to Word, too.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "TikZ fun!"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html_document: </span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">    self_contained: no</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">  pdf_document: default</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{r point-to-ghostscript, include=FALSE}</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="in">Sys.setenv(LIBGS = "/usr/local/share/ghostscript/9.53.3/lib/libgs.dylib.9.53")</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="in"># Conditional tikz output types; use PDF if this is LaTeX, otherwise use SVG</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="in">if (knitr::is_latex_output()) {</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="in">  knitr::opts_template$set(</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="in">    tikz_settings = list(fig.ext = "pdf", fig.align = "center")</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="in">} else {</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="in">  knitr::opts_template$set(</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="in">    tikz_settings = list(fig.ext = "svg", fig.align = "center")</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>Here's an empty DAG:</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz empty-dag, echo=FALSE, fig.cap="Empty DAG", fig.align="center", fig.ext="svg"}</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning}</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}[every node/.append style={draw, minimum size=0.5cm}]</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="in">\node [circle] (X) at (0,0) {};</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="in">\node [circle] (Y) at (2,0) {};</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle] (Z) at (1,1) {};</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="in">\path [-latex] (X) edge (Y);</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex] (Z) edge (Y);</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex] (Z) edge (X);</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now if you knit that file ↑ to PDF, it will create a PDF TikZ image; if you knit to HTML, it will create an SVG image through <code>dvisvgm</code>. Magic!</p>
</section><section id="font-issues" class="level3"><h3 class="anchored" data-anchor-id="font-issues">Font issues</h3>
<p>You’ll notice that we’ve only been using text-less TikZ figures as an example so far. TikZ handles text just fine—it processes it through LaTeX and lets you do everything regular LaTeX typesetting does, so you can add fancy equations and Greek letters, etc. to diagrams. Let’s add some letters with subscripts:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "TikZ fun!"</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html_document: </span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">    self_contained: no</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="in">```{r point-to-ghostscript, include=FALSE}</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="in">Sys.setenv(LIBGS = "/usr/local/share/ghostscript/9.53.3/lib/libgs.dylib.9.53")</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="in"># Conditional tikz output types; use PDF if this is LaTeX, otherwise use SVG</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="in">if (knitr::is_latex_output()) {</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="in">  knitr::opts_template$set(</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="in">    tikz_settings = list(fig.ext = "pdf", fig.align = "center")</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="in">} else {</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="in">  knitr::opts_template$set(</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="in">    tikz_settings = list(fig.ext = "svg", fig.align = "center")</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>Here's a DAG with text:</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz dag-text, echo=FALSE, fig.cap="DAG with text", opts.label="tikz_settings"}</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning}</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}[every node/.append style={draw, minimum size=0.5cm}]</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="in">\node [draw=none] (X) at (0,0) {$X_{it}$};</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="in">\node [draw=none] (Y) at (2,0) {$Y_{it}$};</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle] (Z) at (1,1) {$Z$};</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="in">\path [-latex] (X) edge (Y);</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex] (Z) edge (Y);</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex] (Z) edge (X);</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>When knitting to PDF, this diagram looks great, typeset in Computer Modern like any standard LaTeX document(<a href="example-5.pdf">see full PDF here</a>):</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="example-5-pdf.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>When knitting to HTML, the SVG version of the diagram also works, except for the fonts, since <code>dvisvgm</code> doesn’t embed the fonts by default (<a href="example-5.html">see full HTML file here</a>):</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="example-5.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p>If you open the SVG file that R generates (find it at <code>&lt;RMD_filename&gt;_files/figure-html/unnamed-chunk-1-1.svg</code>) in something like Illustrator, it will complain about font references that are missing, like <code>cmmi10</code> and <code>cmmi7</code>:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="illustrator.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>
<p>And if you open the SVG file in a text editor you’ll notice references to font names, but those assume that you have fonts named “cmmi7” and “cmmi10” on your computer, which is doubtful:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">font</span><span class="ot"> id=</span><span class="st">'cmmi7'</span><span class="ot"> horiz-adv-x=</span><span class="st">'0'</span>&gt;</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">font-face</span><span class="ot"> font-family=</span><span class="st">'cmmi7'</span><span class="ot"> units-per-em=</span><span class="st">'1000'</span><span class="ot"> ascent=</span><span class="st">'750'</span><span class="ot"> descent=</span><span class="st">'250'</span>/&gt;</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section><section id="font-solutions" class="level3"><h3 class="anchored" data-anchor-id="font-solutions">Font solutions</h3>
<p>Fortunately there’s a solution! <code>dvisvgm</code> has an optional flag (<code>--font-format=woff</code>) that will embed the special LaTeX fonts using a base64-encoded web-optimized WOFF file, which means the SVG file should show the correct fonts in any modern browser or editor.</p>
<p>However, there’s currently not a direct way to use that flag with <strong>knitr</strong>. The command for <code>dvisvgm</code> is hardcoded into <strong>knitr</strong>’s code and you can’t add any extra arguments (though <a href="https://github.com/yihui/knitr/issues/2038">I’ve opened an issue at GitHub</a> about this).</p>
<p>But never fear! There’s a neat roundabout way around this!</p>
<p>You can use <a href="https://bookdown.org/yihui/rmarkdown-cookbook/chunk-hooks.html">special chunk hooks</a> in <strong>knitr</strong> to run functions before or after chunks are rendered. We can create a function that runs after a TikZ chunk is rendered that takes the temporary DVI file that <strong>knitr</strong> creates and then runs <code>dvisvgm --font-format=woff</code> on it, thus overwriting the non-embedded SVG file that <strong>knitr</strong> makes with its hardcoded <code>dvisvgm</code> command. Here’s one way to do it (which I adapted from <a href="https://github.com/yihui/knitr/blob/3237add034368a3018ff26fa9f4d0ca89a4afd78/R/hooks-extra.R#L74">the built-in <code>hook_png()</code> function</a>):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">embed_svg_fonts</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">before</span>, <span class="va">options</span>, <span class="va">envir</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># !before means after the chunk is run</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">before</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Get a list of all the plot files this chunk makes</span></span>
<span>    <span class="va">paths</span> <span class="op">&lt;-</span> <span class="fu">knitr</span><span class="fu">:::</span><span class="fu">get_plot_files</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Loop through all the plot files. When dealing with SVG, knitr actually</span></span>
<span>    <span class="co"># creates two different files: an initial DVI and the converted SVG. We'll</span></span>
<span>    <span class="co"># use the original DVI and pass it through dvisvgm again, this time with</span></span>
<span>    <span class="co"># --font-format=woff enabled. This will overwrite the SVG that knitr makes</span></span>
<span>    <span class="fu">knitr</span><span class="fu">:::</span><span class="fu">in_base_dir</span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">paths</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"Embedding fonts in "</span>, <span class="va">x</span><span class="op">)</span></span>
<span>        <span class="va">path_svg</span> <span class="op">&lt;-</span> <span class="fu">xfun</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xfun/man/file_ext.html">with_ext</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"svg"</span><span class="op">)</span></span>
<span>        <span class="va">path_dvi</span> <span class="op">&lt;-</span> <span class="fu">xfun</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xfun/man/file_ext.html">with_ext</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"dvi"</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system2.html">system2</a></span><span class="op">(</span><span class="st">'dvisvgm'</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'--font-format=woff'</span>, <span class="st">'-o'</span>, <span class="fu"><a href="https://rdrr.io/r/base/shQuote.html">shQuote</a></span><span class="op">(</span><span class="va">path_svg</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/shQuote.html">shQuote</a></span><span class="op">(</span><span class="va">path_dvi</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>          <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">'Failed to convert '</span>, <span class="va">path_dvi</span>, <span class="st">' to '</span>, <span class="va">path_svg</span><span class="op">)</span></span>
<span>      <span class="op">}</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Register the function as a possible hook</span></span>
<span><span class="co"># Use this in a chunk by setting embed_svg_fonts=TRUE in the chunk options</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/knit_hooks.html">knit_hooks</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>embed_svg_fonts <span class="op">=</span> <span class="va">embed_svg_fonts</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Stick that ↑ in an invisible chunk (probably in the same one with <code>Sys.setenv(LIBGS = "blah")</code>), and then add <code>embed_svg_fonts=TRUE</code> to the chunk options of the TikZ chunk, and it should work. When you knit, you’ll see two messages about converting DVI to SVG. We don’t care about the first—that’s <strong>knitr</strong>’s basic version without embedded fonts. The second message corresponds to the command we created with the hook, which includes <code>--font-format=woff</code>.</p>
<p>Here’s what the SVG file looks like now with the fonts embedded in it (<a href="dag-text-1.svg">see full SVG file here</a>):</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="dag-text-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:40.0%"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="tldr-final-working-version" class="level2"><h2 class="anchored" data-anchor-id="tldr-final-working-version">tl;dr: Final working version</h2>
<p>Here’s what your final R Markdown file should look like:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "TikZ fun!"</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html_document: </span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">    self_contained: no</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">  pdf_document: default</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{r svg-settings, include=FALSE}</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="in">Sys.setenv(LIBGS = "/usr/local/share/ghostscript/9.53.3/lib/libgs.dylib.9.53")</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="in">embed_svg_fonts &lt;- function(before, options, envir) {</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="in">  # !before means after the chunk is run</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="in">  if (!before) {</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="in">    # Get a list of all the plot files this chunk makes</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="in">    paths &lt;- knitr:::get_plot_files()</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="in">    # Loop through all the plot files. When dealing with SVG, knitr actually</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="in">    # creates two different files: an initial DVI and the converted SVG. We'll</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="in">    # use the original DVI and pass it through dvisvgm again, this time with</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="in">    # --font-format=woff enabled. This will overwrite the SVG that knitr makes</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="in">    knitr:::in_base_dir(</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="in">      lapply(paths, function(x) {</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="in">        message("Embedding fonts in ", x)</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="in">        path_svg &lt;- xfun::with_ext(x, "svg")</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="in">        path_dvi &lt;- xfun::with_ext(x, "dvi")</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="in">        if (system2('dvisvgm', c('--font-format=woff', '-o', shQuote(path_svg), shQuote(path_dvi))) != 0)</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="in">          stop('Failed to convert ', path_dvi, ' to ', path_svg)</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="in">      })</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a><span class="in"># Register the function as a possible hook</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a><span class="in"># Use this in a chunk by setting embed_svg_fonts=TRUE in the chunk options</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::knit_hooks$set(embed_svg_fonts = embed_svg_fonts)</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a><span class="in"># Conditional tikz output types; use PDF if this is LaTeX, otherwise use SVG</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a><span class="in">if (knitr::is_latex_output()) {</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a><span class="in">  knitr::opts_template$set(</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a><span class="in">    tikz_settings = list(fig.ext = "pdf", fig.align = "center")</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a><span class="in">} else {</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a><span class="in">  knitr::opts_template$set(</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a><span class="in">    tikz_settings = list(fig.ext = "svg", fig.align = "center", embed_svg_fonts = TRUE)</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>Here's a DAG with text:</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz dag-text, echo=FALSE, fig.cap="DAG with text", opts.label="tikz_settings"}</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning}</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}[every node/.append style={draw, minimum size=0.5cm}]</span></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a><span class="in">\node [draw=none] (X) at (0,0) {$X_{it}$};</span></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a><span class="in">\node [draw=none] (Y) at (2,0) {$Y_{it}$};</span></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle] (Z) at (1,1) {$Z$};</span></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a><span class="in">\path [-latex] (X) edge (Y);</span></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex] (Z) edge (Y);</span></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex] (Z) edge (X);</span></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>When knitting to PDF, the TikZ figure will show up as a regular PDF image, as excepted. When knitting to HTML, though, <strong>knitr</strong> will create a DVI version of the image and then convert that to SVG (but without font embedding enabled in <code>dvisvgm</code>). Then finally, because of the post-rendering hook, <strong>knitr</strong> will run the <code>embed_svg_fonts()</code> function on the DVI and create a new SVG with fonts embedded that will overwrite the original SVG file.</p>
<p>Look at that! So great! (<a href="example-final.html">see full HTML file here</a>):</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="example-final.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
</section><section id="update-easier-font-embedding" class="level2"><h2 class="anchored" data-anchor-id="update-easier-font-embedding">UPDATE: Easier font embedding!</h2>
<p>I submitted <a href="https://github.com/yihui/knitr/pull/2039">a pull request to <strong>knitr</strong></a> that would allow users to specify additional arguments to <code>dvisvgm</code> from a chunk, and it was just merged in, so with the development version of <strong>knitr</strong> (and someday with the CRAN version, once a new version is eventually submitted), you can use the <code>dvisvgm.opts</code> option in the <code>engine.opts</code> chunk options like this:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz, fig.ext="svg", engine.opts=list(dvisvgm.opts = "--font-format=woff")}</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="in">% Stuff here</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>So now there’s no need for the <code>embed_svg_fonts()</code> hook function! This should work now for the complete DAG example:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "TikZ fun!"</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html_document: </span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">    self_contained: no</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">  pdf_document: default</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{r point-to-ghostscript, include=FALSE}</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="in">Sys.setenv(LIBGS = "/usr/local/share/ghostscript/9.53.3/lib/libgs.dylib.9.53")</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="in"># Conditional tikz output types; use PDF if this is LaTeX, otherwise use SVG with embedded fonts</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="in">if (knitr::is_latex_output()) {</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="in">  knitr::opts_template$set(</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="in">    tikz_settings = list(fig.ext = "pdf", fig.align = "center")</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="in">} else {</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="in">  knitr::opts_template$set(</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="in">    tikz_settings = list(fig.ext = "svg", fig.align = "center",</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="in">                         engine.opts = list(dvisvgm.opts = "--font-format=woff"))</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>Here's a DAG with text:</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz dag-text, echo=FALSE, fig.cap="DAG with text", opts.label="tikz_settings"}</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning}</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}[every node/.append style={draw, minimum size=0.5cm}]</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a><span class="in">\node [draw=none] (X) at (0,0) {$X_{it}$};</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a><span class="in">\node [draw=none] (Y) at (2,0) {$Y_{it}$};</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle] (Z) at (1,1) {$Z$};</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a><span class="in">\path [-latex] (X) edge (Y);</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex] (Z) edge (Y);</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex] (Z) edge (X);</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section><section id="another-update-changing-fonts" class="level2"><h2 class="anchored" data-anchor-id="another-update-changing-fonts">ANOTHER UPDATE: Changing fonts!</h2>
<p>You’re not limited to the default (and kinda ugly) Computer Modern font with TikZ chunks, but changing the font is a little tricky becuase each TikZ chunk in <strong>knitr</strong> is treated as a standalone LaTeX document, so you need to adjust the fonts in each chunk.</p>
<section id="knitting-only-to-pdf" class="level3"><h3 class="anchored" data-anchor-id="knitting-only-to-pdf">Knitting only to PDF</h3>
<p>If you’re <em>only</em> interested in knitting to PDF, you can use XeTeX to embed any font you want in the diagram. When using XeTeX, you’d typically add something like this to the preamble of your document to change the document font:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode latex code-with-copy"><code class="sourceCode latex"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="bu">\usepackage</span>{<span class="ex">fontspec</span>}</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">\setmainfont</span>{Comic Sans MS}  <span class="co">% ew</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Each standalone TikZ knitr chunk gets passed to <a href="https://github.com/yihui/knitr/blob/master/inst/misc/tikz2pdf.tex">a special <code>tikz2pdf.tex</code> template</a>. The content of the chunk is inserted in the <code>%% TIKZ_CODE %%</code> area, and there’s a space in the template for preamble things at <code>%% EXTRA_TIKZ_PREAMBLE_CODE %%</code>. To get content inserted there, you can use the <code>extra.preamble</code> option in <code>engine.opts</code> like so:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="in">font_opts &lt;- list(extra.preamble=c("\\usepackage{fontspec}", </span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "\\setmainfont{Comic Sans MS}"))</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz, engine.opts=font_opts}</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="in">% Stuff here</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>That won’t work right away though. When you knit, <strong>knitr</strong> uses the default <code>pdflatex</code> LaTeX engine to render each TikZ chunk, and you’ll get an error because <code>fontspec</code> only works with XeTeX. You can tell <strong>knitr</strong> to use <code>xelatex</code> to render those chunks if you set the <code>tinytex.engine</code> option:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>tinytex.engine <span class="op">=</span> <span class="st">"xelatex"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Once you set <code>xelatex</code> as the default LaTeX engine for the document, all TikZ chunks will render correctly. Here’s a complete example (note that I moved the <code>extra.preamble</code> stuff to a separate variable so that it’s easier to reuse) (<a href="example-xelatex.pdf">see full PDF here</a>):</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "TikZ fun!"</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">  pdf_document: </span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">    latex_engine: xelatex</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="in">options(tinytex.engine = "xelatex")</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="in">font_opts &lt;- list(extra.preamble = c("\\usepackage{fontspec}", </span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="in">                                     "\\setmainfont{Comic Sans MS}",</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="in">                                     "\\usepackage{unicode-math}",</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="in">                                     "\\usepackage{mathastext}",</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="in">                                     "\\setmathfont{Comic Sans MS}"))</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz rectangle-text, echo=FALSE, fig.align="center", engine.opts=font_opts}</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="in">\draw (0,0) rectangle (6, 2) node[midway, align=center] {I am a rectangle with math: \\ $\hat{y} = \beta_0 + \beta_1 x_1 + \text{Some text} + \varepsilon$};</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="example-xelatex.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
</section><section id="knitting-to-pdf-and-html" class="level3"><h3 class="anchored" data-anchor-id="knitting-to-pdf-and-html">Knitting to PDF and HTML</h3>
<p>This is a little trickier if you want to convert these TikZ chunks to SVG when knitting to HTML. <strong>knitr</strong> ignores the <code>tinytex.engine</code> option when you knit to HTML, so there’s no way to tell TikZ chunks to get processed through <code>xelatex</code>. Additionally, <code>xelatex</code> does not produce .dvi files, which <code>dvisvgm</code> uses to convert to SVG. <code>xelatex</code> instead creates its own special .xdv files. In theory, newer versions of <code>dvisvgm</code> should work with XDV files, but <strong>knitr</strong> is hard-coded to pass DVI files to <code>dvisvgm</code>, not XDV files. So even if we could force TikZ chunks to go through <code>xelatex</code>, they wouldn’t be converted to SVG. Alas.</p>
<p>But all is not lost! It’s possible to change fonts in non-XeTeX documents. Because you’re limited to whatever <code>pdflatex</code> can support, you can only use specific font packages instead of whatever font you want. For instance, to use <a href="https://ctan.org/pkg/tex-gyre-pagella">TEX Gyre Pagella</a>, include <code>\usepackage{tgpagella}</code> in your preamble. <a href="https://www.overleaf.com/learn/latex/Font_typefaces">See this</a> for a basic list of possible font packages, or <a href="https://tug.org/FontCatalogue/">this for a pretty complete catalogue</a>.</p>
<p>For instance, here’s how to use <a href="https://tug.org/FontCatalogue/linuxlibertine/">Linux Libertine</a> for text and <a href="https://github.com/alerque/libertinus">Libertinus Math</a> for math <em>with</em> embedded SVG fonts when knitting to HTML (<a href="example-svg-libertine.html">see full HTML file here</a>):</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "TikZ fun!"</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html_document: default</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="in">```{r point-to-ghostscript, include=FALSE}</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="in">Sys.setenv(LIBGS = "/usr/local/share/ghostscript/9.53.3/lib/libgs.dylib.9.53")</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="in">font_opts &lt;- list(extra.preamble = c("\\usepackage{libertine}", "\\usepackage{libertinust1math}"),</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="in">                  dvisvgm.opts = "--font-format=woff")</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz rectangle-text, fig.ext="svg", echo=FALSE, fig.align="center", engine.opts=font_opts}</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="in">\draw (0,0) rectangle (6, 2) node[midway, align=center] {I am a rectangle with math: \\ $\hat{y} = \beta_0 + \beta_1 x_1 + \text{Some text} + \varepsilon$};</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="example-svg-libertine.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p>Or with <a href="https://tug.org/FontCatalogue/gfsartemisiaeulermath/">GFS Artemisia with Euler for math</a> (<a href="example-svg-artemisia.html">see full HTML file here</a>):</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "TikZ fun!"</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html_document: default</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="in">```{r point-to-ghostscript, include=FALSE}</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="in">Sys.setenv(LIBGS = "/usr/local/share/ghostscript/9.53.3/lib/libgs.dylib.9.53")</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="in">font_opts &lt;- list(extra.preamble = c("\\usepackage{gfsartemisia-euler}"),</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="in">                  dvisvgm.opts = "--font-format=woff")</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz rectangle-text, fig.ext="svg", echo=FALSE, fig.align="center", engine.opts=font_opts}</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="in">\draw (0,0) rectangle (6, 2) node[midway, align=center] {I am a rectangle with math: \\ $\hat{y} = \beta_0 + \beta_1 x_1 + \text{Some text} + \varepsilon$};</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="example-svg-artemisia.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>


<!-- -->

</section></section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{heiss2021,
  author = {Heiss, Andrew},
  title = {How to Automatically Convert {TikZ} Images to {SVG} (with
    Fonts!) from Knitr},
  date = {2021-08-27},
  url = {https://www.andrewheiss.com/blog/2021/08/27/tikz-knitr-html-svg-fun/},
  doi = {10.59350/6qevp-87j81},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-heiss2021" class="csl-entry quarto-appendix-citeas" role="listitem">
Heiss, Andrew. 2021. <span>“How to Automatically Convert TikZ Images to
SVG (with Fonts!) from Knitr.”</span> August 27, 2021. <a href="https://doi.org/10.59350/6qevp-87j81">https://doi.org/10.59350/6qevp-87j81</a>.
</div></div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.andrewheiss\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><script src="https://giscus.app/client.js" data-repo="andrewheiss/ath-quarto" data-repo-id="R_kgDOIg6EJQ" data-category="Blog comments" data-category-id="DIC_kwDOIg6EJc4CSz92" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><input type="hidden" id="giscus-base-theme" value="light"><input type="hidden" id="giscus-alt-theme" value="dark"><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb22" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "How to automatically convert TikZ images to SVG (with fonts!) from knitr"</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2021-08-27</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Make knitr and R Markdown convert TikZ graphics to font-embedded SVG files when knitting to HTML"</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> example-final.png</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co">  - r</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - tidyverse</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co">  - R markdown</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - tikz</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="an">doi:</span><span class="co"> 10.59350/6qevp-87j81</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="an">citation:</span><span class="co"> true</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(fig.align = "center", fig.retina = 3,</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="in">                      fig.width = 6, fig.height = (6 * 0.618),</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="in">                      out.width = "75%", collapse = TRUE)</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="in">options(digits = 3, width = 90)</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="fu">### Update #1</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>An update to knitr has made it a ton easier to embed fonts in SVG files from R. &lt;a href="#update-easier-font-embedding"&gt;Jump to the update&lt;/a&gt; to see how.</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a><span class="fu">### Update #2</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>Also, it's possible to change TikZ fonts and not use Computer Modern for everything! &lt;a href="#another-update-changing-fonts"&gt;Jump to the second update&lt;/a&gt; to see how.</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>**knitr** and R Markdown are essential parts of my academic writing workflow, and they make it really easy to write in one file format and then convert it to whatever output I need. When knitting to PDF, plots are all vector-based with selectable text, and math equations are all done in beautiful LaTeX. When knitting to HTML, plots are PNG files (since HTML struggles with cross-browser vector image support), and math equations are all done in beautiful MathJax. It's a wonderful system.</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>One place where the system struggles, though, is with more complex types of content like TikZ figures. TikZ lets you make all sorts of fancy diagrams and equations, but it's a tricky language and I barely understand it, lol. There are some helpful resources about it, though:</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a><span class="ss">-  </span><span class="co">[</span><span class="ot">Rachel Menghua Wu</span><span class="co">](https://rmwu.github.io/)</span>'s crash course to TikZ (<span class="co">[</span><span class="ot">part 1</span><span class="co">](https://rmwu.github.io/tutorial/latex/2019/08/27/intro/)</span> and <span class="co">[</span><span class="ot">part 2</span><span class="co">](https://rmwu.github.io/tutorial/latex/2019/11/21/positioning/)</span>)</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Overleaf's guide</span><span class="co">](https://www.overleaf.com/learn/latex/TikZ_package)</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Overleaf's tutorial series</span><span class="co">]</span>(https://www.overleaf.com/learn/latex/LaTeX_Graphics_using_TikZ:_A_Tutorial_for_Beginners_(Part_1)%E2%80%94Basic_Drawing)</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Mathcha</span><span class="co">](https://www.mathcha.io/)</span> can draw and export diagrams as TikZ, as can <span class="co">[</span><span class="ot">DAGitty</span><span class="co">](http://dagitty.net/)</span></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>Through the magic of **knitr** and R Markdown, it's actually possible to use TikZ chunks directly in an R Markdown document and have them knit to both PDF *and* vector-based SVG files in HTML. Magic!</span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a><span class="fu">## Knitting TikZ chunks to PDF</span></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>**knitr** has the ability to <span class="co">[</span><span class="ot">use custom engines for rendering other languages</span><span class="co">](https://yihui.org/knitr/demo/engines/)</span>, including TikZ, by including a <span class="in">`tikz`</span> chunk like this:</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz}</span></span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}</span></span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a><span class="in">% TikZ code here</span></span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>To try this out, make a new blank .Rmd file and put this in it:</span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a><span class="in">````</span></span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a><span class="in">---</span></span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a><span class="in">title: "TikZ fun!"</span></span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a><span class="in">output:</span></span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a><span class="in">  pdf_document: default</span></span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a><span class="in">---</span></span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a><span class="in">Here's an empty DAG</span></span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz, echo=FALSE, cache=TRUE, fig.cap="Empty DAG", fig.align="center"}</span></span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning}</span></span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}[every node/.append style={draw, minimum size=0.5cm}]</span></span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a><span class="in">\node [circle] (X) at (0,0) {};</span></span>
<span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a><span class="in">\node [circle] (Y) at (2,0) {};</span></span>
<span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle] (Z) at (1,1) {};</span></span>
<span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a><span class="in">\path [-latex] (X) edge (Y);</span></span>
<span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex] (Z) edge (Y);</span></span>
<span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex] (Z) edge (X);</span></span>
<span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a><span class="in">````</span></span>
<span id="cb22-79"><a href="#cb22-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-80"><a href="#cb22-80" aria-hidden="true" tabindex="-1"></a>Knit that to PDF and you'll see a neat little diagram of a <span class="co">[</span><span class="ot">directed acyclic graph</span><span class="co">](https://cran.r-project.org/web/packages/ggdag/vignettes/intro-to-dags.html)</span> (or DAG) (<span class="co">[</span><span class="ot">see full PDF here</span><span class="co">](example-1.pdf)</span>):</span>
<span id="cb22-81"><a href="#cb22-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-82"><a href="#cb22-82" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=FALSE, out.width="100%", fig.align="center"}</span></span>
<span id="cb22-83"><a href="#cb22-83" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("example-1.png")</span></span>
<span id="cb22-84"><a href="#cb22-84" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-85"><a href="#cb22-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-86"><a href="#cb22-86" aria-hidden="true" tabindex="-1"></a><span class="fu">## Knitting TikZ chunks to HTML as PNGs</span></span>
<span id="cb22-87"><a href="#cb22-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-88"><a href="#cb22-88" aria-hidden="true" tabindex="-1"></a>If you knit that document to HTML, you'll also see the same diagram, but it will be a low resolution PNG and will look huge and pixelated. Behind the scenes, **knitr** converts the TikZ chunk to PDF and then converts that PDF to PNG and includes it in the HTML file (<span class="co">[</span><span class="ot">see full HTML file here</span><span class="co">](example-1.html)</span>).</span>
<span id="cb22-89"><a href="#cb22-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-90"><a href="#cb22-90" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=FALSE, out.width="70%", fig.align="center"}</span></span>
<span id="cb22-91"><a href="#cb22-91" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("example-1-pixelated.png")</span></span>
<span id="cb22-92"><a href="#cb22-92" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-93"><a href="#cb22-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-94"><a href="#cb22-94" aria-hidden="true" tabindex="-1"></a>There's theoretically a way to change the DPI of this PNG file using the <span class="in">`engine.opts`</span> chunk option and passing additional arguments to ImageMagick, which handles the conversion, but it only causes errors for me (<span class="in">`Error in magick_image_format(image, toupper(format), type, colorspace, : Invalid ImageType value: -density 300`</span>) and I can't figure out why (see <span class="co">[</span><span class="ot">this StackOverflow post too</span><span class="co">](https://stackoverflow.com/questions/51735831/is-it-possible-to-increase-resolution-of-image-inserted-to-word-document-from-rm)</span>) :</span>
<span id="cb22-95"><a href="#cb22-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-96"><a href="#cb22-96" aria-hidden="true" tabindex="-1"></a><span class="in">````</span></span>
<span id="cb22-97"><a href="#cb22-97" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz, engine.opts = list(convert.opts = '-density 300'), fig.ext="png"}</span></span>
<span id="cb22-98"><a href="#cb22-98" aria-hidden="true" tabindex="-1"></a><span class="in">% Stuff here</span></span>
<span id="cb22-99"><a href="#cb22-99" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-100"><a href="#cb22-100" aria-hidden="true" tabindex="-1"></a><span class="in">````</span></span>
<span id="cb22-101"><a href="#cb22-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-102"><a href="#cb22-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-103"><a href="#cb22-103" aria-hidden="true" tabindex="-1"></a><span class="fu">## Knitting TikZ chunks to HTML as SVGs</span></span>
<span id="cb22-104"><a href="#cb22-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-105"><a href="#cb22-105" aria-hidden="true" tabindex="-1"></a>But even if I could get it to work, PNG files aren't great for vector-like things like TikZ diagrams. It would be great if instead I could convert these diagrams to vector-based SVG files. </span>
<span id="cb22-106"><a href="#cb22-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-107"><a href="#cb22-107" aria-hidden="true" tabindex="-1"></a>Fortunately **knitr** handles that too! Try this! (Note the <span class="in">`self_contained: no`</span> in the YAML metadata—this will create a standalone DVI and SVG file in a folder named <span class="in">`&lt;NAME_OF_RMD&gt;_files/html-figures/`</span>. You don't technically need this—without it, R will embed the images as base64-encoded text—but to make it easier to see the files R makes, we'll disable it)</span>
<span id="cb22-108"><a href="#cb22-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-109"><a href="#cb22-109" aria-hidden="true" tabindex="-1"></a><span class="in">````</span></span>
<span id="cb22-110"><a href="#cb22-110" aria-hidden="true" tabindex="-1"></a><span class="in">---</span></span>
<span id="cb22-111"><a href="#cb22-111" aria-hidden="true" tabindex="-1"></a><span class="in">title: "TikZ fun!"</span></span>
<span id="cb22-112"><a href="#cb22-112" aria-hidden="true" tabindex="-1"></a><span class="in">output:</span></span>
<span id="cb22-113"><a href="#cb22-113" aria-hidden="true" tabindex="-1"></a><span class="in">  html_document: </span></span>
<span id="cb22-114"><a href="#cb22-114" aria-hidden="true" tabindex="-1"></a><span class="in">    self_contained: no</span></span>
<span id="cb22-115"><a href="#cb22-115" aria-hidden="true" tabindex="-1"></a><span class="in">---</span></span>
<span id="cb22-116"><a href="#cb22-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-117"><a href="#cb22-117" aria-hidden="true" tabindex="-1"></a><span class="in">Here's an empty DAG:</span></span>
<span id="cb22-118"><a href="#cb22-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-119"><a href="#cb22-119" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz empty-dag, echo=FALSE, fig.cap="Empty DAG", fig.align="center", fig.ext="svg"}</span></span>
<span id="cb22-120"><a href="#cb22-120" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning}</span></span>
<span id="cb22-121"><a href="#cb22-121" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}[every node/.append style={draw, minimum size=0.5cm}]</span></span>
<span id="cb22-122"><a href="#cb22-122" aria-hidden="true" tabindex="-1"></a><span class="in">\node [circle] (X) at (0,0) {};</span></span>
<span id="cb22-123"><a href="#cb22-123" aria-hidden="true" tabindex="-1"></a><span class="in">\node [circle] (Y) at (2,0) {};</span></span>
<span id="cb22-124"><a href="#cb22-124" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle] (Z) at (1,1) {};</span></span>
<span id="cb22-125"><a href="#cb22-125" aria-hidden="true" tabindex="-1"></a><span class="in">\path [-latex] (X) edge (Y);</span></span>
<span id="cb22-126"><a href="#cb22-126" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex] (Z) edge (Y);</span></span>
<span id="cb22-127"><a href="#cb22-127" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex] (Z) edge (X);</span></span>
<span id="cb22-128"><a href="#cb22-128" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb22-129"><a href="#cb22-129" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-130"><a href="#cb22-130" aria-hidden="true" tabindex="-1"></a><span class="in">````</span></span>
<span id="cb22-131"><a href="#cb22-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-132"><a href="#cb22-132" aria-hidden="true" tabindex="-1"></a>You'll most likely get an error about Ghostscript:</span>
<span id="cb22-133"><a href="#cb22-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-134"><a href="#cb22-134" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb22-135"><a href="#cb22-135" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; processing of PostScript specials is disabled (Ghostscript not found)</span></span>
<span id="cb22-136"><a href="#cb22-136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-137"><a href="#cb22-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-138"><a href="#cb22-138" aria-hidden="true" tabindex="-1"></a><span class="fu">### Connecting `dvisvgm` to Ghostscript on macOS</span></span>
<span id="cb22-139"><a href="#cb22-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-140"><a href="#cb22-140" aria-hidden="true" tabindex="-1"></a>Unfortunately it takes a little bit of initial setup to get all the moving pieces working for it to happen. To go from TikZ to SVG, **knitr** first converts the <span class="in">`tikz`</span> chunk to DVI and then uses the terminal program <span class="in">`dvisvgm`</span> to convert the DVI to SVG. Getting <span class="in">`dvisvgm`</span> working on macOS is tricky though (and presumably it's tricky on Windows too, but I don't have a Windows machine to test it on).</span>
<span id="cb22-141"><a href="#cb22-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-142"><a href="#cb22-142" aria-hidden="true" tabindex="-1"></a>The most typical way of installing the LaTeX ecosystem on macOS is to install <span class="co">[</span><span class="ot">MacTeX</span><span class="co">](https://www.tug.org/mactex/)</span>, which comes with all the dozens of special utilities TeX uses for typesetting. MacTeX comes with both <span class="in">`dvisvgm`</span> and a special program called Ghostscript that handles text in DVI files. HOWEVER, by default it does not provide a way to have <span class="in">`dvisvgm`</span> and Ghostscript talk to each other (there's <span class="co">[</span><span class="ot">a whole post about it here</span><span class="co">](https://tex.stackexchange.com/questions/559640/making-dvisvgm-and-ghostscript-from-mactex-talk-to-each-other)</span>). Ghostscript really is installed, though—<span class="in">`dvisvgm`</span> just can't see it.</span>
<span id="cb22-143"><a href="#cb22-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-144"><a href="#cb22-144" aria-hidden="true" tabindex="-1"></a>To fix it, you actually need to reinstall MacTex and choose a custom installation option. When you get to the "Installation Type" section in the package installation dialog box, click on "Customize" and then make sure the box is checked for "Ghostscript Dynamic Library". By default this is not checked, and I have no clue why, since this is the bridge that you need to get <span class="in">`dvisvgm`</span> and Ghostscript to talk to each other. </span>
<span id="cb22-145"><a href="#cb22-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-146"><a href="#cb22-146" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=FALSE, out.width="100%", fig.align="center"}</span></span>
<span id="cb22-147"><a href="#cb22-147" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("install-mactex.png")</span></span>
<span id="cb22-148"><a href="#cb22-148" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-149"><a href="#cb22-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-150"><a href="#cb22-150" aria-hidden="true" tabindex="-1"></a>Install MacTeX with that option enabled and you'll have a special new file nested deep within your filesystem at <span class="in">`/usr/local/share/ghostscript/9.53.3/lib/libgs.dylib.9.53`</span>. This <span class="in">`libgs.dylib.**`</span> file is the dynamic library that <span class="in">`dvisvgm`</span> needs to know about to work. MacTex 2021 installs Ghostscript 9.53.3, so later versions of MacTex will place <span class="in">`libgs.dylib`</span> somewhere else.</span>
<span id="cb22-151"><a href="#cb22-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-152"><a href="#cb22-152" aria-hidden="true" tabindex="-1"></a>To tell <span class="in">`dvisvgm`</span> where this dynamic library is, you then need to set an environment variable. Open <span class="in">`~/.bash_profile`</span> or <span class="in">`~/.zshrc`</span> or whatever you use for setting your PATH and other terminal settings and add this:</span>
<span id="cb22-153"><a href="#cb22-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-154"><a href="#cb22-154" aria-hidden="true" tabindex="-1"></a><span class="in">```sh</span></span>
<span id="cb22-155"><a href="#cb22-155" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">LIBGS</span><span class="op">=</span>/usr/local/share/ghostscript/9.53.3/lib/libgs.dylib.9.53</span>
<span id="cb22-156"><a href="#cb22-156" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-157"><a href="#cb22-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-158"><a href="#cb22-158" aria-hidden="true" tabindex="-1"></a>Open a new terminal window and type <span class="in">`print $LIBGS`</span> to verify that the environment variable was actually set. Now you should be able to run <span class="in">`dvisvgm -l`</span> and see an entry for <span class="in">`ps`</span> in it (see <span class="co">[</span><span class="ot">this FAQ page</span><span class="co">](https://dvisvgm.de/FAQ/)</span> for lots of other details and help for troubleshooting this):</span>
<span id="cb22-159"><a href="#cb22-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-160"><a href="#cb22-160" aria-hidden="true" tabindex="-1"></a><span class="in">```sh</span></span>
<span id="cb22-161"><a href="#cb22-161" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> dvisvgm <span class="at">-l</span></span>
<span id="cb22-162"><a href="#cb22-162" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb22-163"><a href="#cb22-163" aria-hidden="true" tabindex="-1"></a><span class="fu">ps</span>         dvips PostScript specials</span>
<span id="cb22-164"><a href="#cb22-164" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb22-165"><a href="#cb22-165" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-166"><a href="#cb22-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-167"><a href="#cb22-167" aria-hidden="true" tabindex="-1"></a>That means everything's working and you should now be able to convert from DVI to SVG!</span>
<span id="cb22-168"><a href="#cb22-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-169"><a href="#cb22-169" aria-hidden="true" tabindex="-1"></a><span class="fu">### Connecting `dvisvgm` to Ghostscript within R</span></span>
<span id="cb22-170"><a href="#cb22-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-171"><a href="#cb22-171" aria-hidden="true" tabindex="-1"></a>However, RStudio doesn't pick up your shell's environment variables when knitting files, so if you knit the document with <span class="in">`fix.ext='svg'`</span> enabled, you'll still get an error about Ghostscript not being found.</span>
<span id="cb22-172"><a href="#cb22-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-173"><a href="#cb22-173" aria-hidden="true" tabindex="-1"></a>To get around this, you can actually set environment variables from within the R Markdown document itself. Add <span class="in">`Sys.setenv()`</span> to an invisible chunk like this:</span>
<span id="cb22-174"><a href="#cb22-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-175"><a href="#cb22-175" aria-hidden="true" tabindex="-1"></a><span class="in">````</span></span>
<span id="cb22-176"><a href="#cb22-176" aria-hidden="true" tabindex="-1"></a><span class="in">---</span></span>
<span id="cb22-177"><a href="#cb22-177" aria-hidden="true" tabindex="-1"></a><span class="in">title: "TikZ fun!"</span></span>
<span id="cb22-178"><a href="#cb22-178" aria-hidden="true" tabindex="-1"></a><span class="in">output:</span></span>
<span id="cb22-179"><a href="#cb22-179" aria-hidden="true" tabindex="-1"></a><span class="in">  html_document: </span></span>
<span id="cb22-180"><a href="#cb22-180" aria-hidden="true" tabindex="-1"></a><span class="in">    self_contained: no</span></span>
<span id="cb22-181"><a href="#cb22-181" aria-hidden="true" tabindex="-1"></a><span class="in">---</span></span>
<span id="cb22-182"><a href="#cb22-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-183"><a href="#cb22-183" aria-hidden="true" tabindex="-1"></a><span class="in">```{r point-to-ghostscript, include=FALSE}</span></span>
<span id="cb22-184"><a href="#cb22-184" aria-hidden="true" tabindex="-1"></a><span class="in">Sys.setenv(LIBGS = "/usr/local/share/ghostscript/9.53.3/lib/libgs.dylib.9.53")</span></span>
<span id="cb22-185"><a href="#cb22-185" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-186"><a href="#cb22-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-187"><a href="#cb22-187" aria-hidden="true" tabindex="-1"></a><span class="in">Here's an empty DAG:</span></span>
<span id="cb22-188"><a href="#cb22-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-189"><a href="#cb22-189" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz empty-dag, echo=FALSE, fig.cap="Empty DAG", fig.align="center", fig.ext="svg"}</span></span>
<span id="cb22-190"><a href="#cb22-190" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning}</span></span>
<span id="cb22-191"><a href="#cb22-191" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}[every node/.append style={draw, minimum size=0.5cm}]</span></span>
<span id="cb22-192"><a href="#cb22-192" aria-hidden="true" tabindex="-1"></a><span class="in">\node [circle] (X) at (0,0) {};</span></span>
<span id="cb22-193"><a href="#cb22-193" aria-hidden="true" tabindex="-1"></a><span class="in">\node [circle] (Y) at (2,0) {};</span></span>
<span id="cb22-194"><a href="#cb22-194" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle] (Z) at (1,1) {};</span></span>
<span id="cb22-195"><a href="#cb22-195" aria-hidden="true" tabindex="-1"></a><span class="in">\path [-latex] (X) edge (Y);</span></span>
<span id="cb22-196"><a href="#cb22-196" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex] (Z) edge (Y);</span></span>
<span id="cb22-197"><a href="#cb22-197" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex] (Z) edge (X);</span></span>
<span id="cb22-198"><a href="#cb22-198" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb22-199"><a href="#cb22-199" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-200"><a href="#cb22-200" aria-hidden="true" tabindex="-1"></a><span class="in">````</span></span>
<span id="cb22-201"><a href="#cb22-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-202"><a href="#cb22-202" aria-hidden="true" tabindex="-1"></a>And now everything should work! You'll get an HTML file with a vector-based SVG version of the TikZ figure (<span class="co">[</span><span class="ot">see full HTML file here</span><span class="co">](example-2.html)</span>):</span>
<span id="cb22-203"><a href="#cb22-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-204"><a href="#cb22-204" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=FALSE, out.width="90%", fig.align="center"}</span></span>
<span id="cb22-205"><a href="#cb22-205" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("example-2.png")</span></span>
<span id="cb22-206"><a href="#cb22-206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-207"><a href="#cb22-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-208"><a href="#cb22-208" aria-hidden="true" tabindex="-1"></a><span class="fu">### Choosing the TikZ output format based on the knitted output</span></span>
<span id="cb22-209"><a href="#cb22-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-210"><a href="#cb22-210" aria-hidden="true" tabindex="-1"></a>We can now knit this TikZ chunk to PDF if we use <span class="in">`fig.ext="pdf"`</span> and to SVG if we use <span class="in">`fig.ext="svg"`</span> in the chunk options. Remembering to switch these extensions manually, though, is tedious. To make life a little easier, we can create some conditional output types using **knitr**'s (newer?) <span class="in">`opts-template`</span> ability, which lets you create chunk option templates that you can reuse throughout the document. Here, we'll use <span class="in">`fig.ext="pdf"`</span> when knitting to PDF, and <span class="in">`fig.ext="svg"`</span> otherwise. If I could get the TikZ → PNG conversion working nicely, I'd make it use <span class="in">`fig.ext="png"`</span> when knitting to Word, too.</span>
<span id="cb22-211"><a href="#cb22-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-212"><a href="#cb22-212" aria-hidden="true" tabindex="-1"></a><span class="in">````</span></span>
<span id="cb22-213"><a href="#cb22-213" aria-hidden="true" tabindex="-1"></a><span class="in">---</span></span>
<span id="cb22-214"><a href="#cb22-214" aria-hidden="true" tabindex="-1"></a><span class="in">title: "TikZ fun!"</span></span>
<span id="cb22-215"><a href="#cb22-215" aria-hidden="true" tabindex="-1"></a><span class="in">output:</span></span>
<span id="cb22-216"><a href="#cb22-216" aria-hidden="true" tabindex="-1"></a><span class="in">  html_document: </span></span>
<span id="cb22-217"><a href="#cb22-217" aria-hidden="true" tabindex="-1"></a><span class="in">    self_contained: no</span></span>
<span id="cb22-218"><a href="#cb22-218" aria-hidden="true" tabindex="-1"></a><span class="in">  pdf_document: default</span></span>
<span id="cb22-219"><a href="#cb22-219" aria-hidden="true" tabindex="-1"></a><span class="in">---</span></span>
<span id="cb22-220"><a href="#cb22-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-221"><a href="#cb22-221" aria-hidden="true" tabindex="-1"></a><span class="in">```{r point-to-ghostscript, include=FALSE}</span></span>
<span id="cb22-222"><a href="#cb22-222" aria-hidden="true" tabindex="-1"></a><span class="in">Sys.setenv(LIBGS = "/usr/local/share/ghostscript/9.53.3/lib/libgs.dylib.9.53")</span></span>
<span id="cb22-223"><a href="#cb22-223" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-224"><a href="#cb22-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-225"><a href="#cb22-225" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb22-226"><a href="#cb22-226" aria-hidden="true" tabindex="-1"></a><span class="in"># Conditional tikz output types; use PDF if this is LaTeX, otherwise use SVG</span></span>
<span id="cb22-227"><a href="#cb22-227" aria-hidden="true" tabindex="-1"></a><span class="in">if (knitr::is_latex_output()) {</span></span>
<span id="cb22-228"><a href="#cb22-228" aria-hidden="true" tabindex="-1"></a><span class="in">  knitr::opts_template$set(</span></span>
<span id="cb22-229"><a href="#cb22-229" aria-hidden="true" tabindex="-1"></a><span class="in">    tikz_settings = list(fig.ext = "pdf", fig.align = "center")</span></span>
<span id="cb22-230"><a href="#cb22-230" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb22-231"><a href="#cb22-231" aria-hidden="true" tabindex="-1"></a><span class="in">} else {</span></span>
<span id="cb22-232"><a href="#cb22-232" aria-hidden="true" tabindex="-1"></a><span class="in">  knitr::opts_template$set(</span></span>
<span id="cb22-233"><a href="#cb22-233" aria-hidden="true" tabindex="-1"></a><span class="in">    tikz_settings = list(fig.ext = "svg", fig.align = "center")</span></span>
<span id="cb22-234"><a href="#cb22-234" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb22-235"><a href="#cb22-235" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb22-236"><a href="#cb22-236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-237"><a href="#cb22-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-238"><a href="#cb22-238" aria-hidden="true" tabindex="-1"></a><span class="in">Here's an empty DAG:</span></span>
<span id="cb22-239"><a href="#cb22-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-240"><a href="#cb22-240" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz empty-dag, echo=FALSE, fig.cap="Empty DAG", fig.align="center", fig.ext="svg"}</span></span>
<span id="cb22-241"><a href="#cb22-241" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning}</span></span>
<span id="cb22-242"><a href="#cb22-242" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}[every node/.append style={draw, minimum size=0.5cm}]</span></span>
<span id="cb22-243"><a href="#cb22-243" aria-hidden="true" tabindex="-1"></a><span class="in">\node [circle] (X) at (0,0) {};</span></span>
<span id="cb22-244"><a href="#cb22-244" aria-hidden="true" tabindex="-1"></a><span class="in">\node [circle] (Y) at (2,0) {};</span></span>
<span id="cb22-245"><a href="#cb22-245" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle] (Z) at (1,1) {};</span></span>
<span id="cb22-246"><a href="#cb22-246" aria-hidden="true" tabindex="-1"></a><span class="in">\path [-latex] (X) edge (Y);</span></span>
<span id="cb22-247"><a href="#cb22-247" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex] (Z) edge (Y);</span></span>
<span id="cb22-248"><a href="#cb22-248" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex] (Z) edge (X);</span></span>
<span id="cb22-249"><a href="#cb22-249" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb22-250"><a href="#cb22-250" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-251"><a href="#cb22-251" aria-hidden="true" tabindex="-1"></a><span class="in">````</span></span>
<span id="cb22-252"><a href="#cb22-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-253"><a href="#cb22-253" aria-hidden="true" tabindex="-1"></a>Now if you knit that file ↑ to PDF, it will create a PDF TikZ image; if you knit to HTML, it will create an SVG image through <span class="in">`dvisvgm`</span>. Magic!</span>
<span id="cb22-254"><a href="#cb22-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-255"><a href="#cb22-255" aria-hidden="true" tabindex="-1"></a><span class="fu">### Font issues</span></span>
<span id="cb22-256"><a href="#cb22-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-257"><a href="#cb22-257" aria-hidden="true" tabindex="-1"></a>You'll notice that we've only been using text-less TikZ figures as an example so far. TikZ handles text just fine—it processes it through LaTeX and lets you do everything regular LaTeX typesetting does, so you can add fancy equations and Greek letters, etc. to diagrams. Let's add some letters with subscripts:</span>
<span id="cb22-258"><a href="#cb22-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-259"><a href="#cb22-259" aria-hidden="true" tabindex="-1"></a><span class="in">````</span></span>
<span id="cb22-260"><a href="#cb22-260" aria-hidden="true" tabindex="-1"></a><span class="in">---</span></span>
<span id="cb22-261"><a href="#cb22-261" aria-hidden="true" tabindex="-1"></a><span class="in">title: "TikZ fun!"</span></span>
<span id="cb22-262"><a href="#cb22-262" aria-hidden="true" tabindex="-1"></a><span class="in">output:</span></span>
<span id="cb22-263"><a href="#cb22-263" aria-hidden="true" tabindex="-1"></a><span class="in">  html_document: </span></span>
<span id="cb22-264"><a href="#cb22-264" aria-hidden="true" tabindex="-1"></a><span class="in">    self_contained: no</span></span>
<span id="cb22-265"><a href="#cb22-265" aria-hidden="true" tabindex="-1"></a><span class="in">---</span></span>
<span id="cb22-266"><a href="#cb22-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-267"><a href="#cb22-267" aria-hidden="true" tabindex="-1"></a><span class="in">```{r point-to-ghostscript, include=FALSE}</span></span>
<span id="cb22-268"><a href="#cb22-268" aria-hidden="true" tabindex="-1"></a><span class="in">Sys.setenv(LIBGS = "/usr/local/share/ghostscript/9.53.3/lib/libgs.dylib.9.53")</span></span>
<span id="cb22-269"><a href="#cb22-269" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-270"><a href="#cb22-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-271"><a href="#cb22-271" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb22-272"><a href="#cb22-272" aria-hidden="true" tabindex="-1"></a><span class="in"># Conditional tikz output types; use PDF if this is LaTeX, otherwise use SVG</span></span>
<span id="cb22-273"><a href="#cb22-273" aria-hidden="true" tabindex="-1"></a><span class="in">if (knitr::is_latex_output()) {</span></span>
<span id="cb22-274"><a href="#cb22-274" aria-hidden="true" tabindex="-1"></a><span class="in">  knitr::opts_template$set(</span></span>
<span id="cb22-275"><a href="#cb22-275" aria-hidden="true" tabindex="-1"></a><span class="in">    tikz_settings = list(fig.ext = "pdf", fig.align = "center")</span></span>
<span id="cb22-276"><a href="#cb22-276" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb22-277"><a href="#cb22-277" aria-hidden="true" tabindex="-1"></a><span class="in">} else {</span></span>
<span id="cb22-278"><a href="#cb22-278" aria-hidden="true" tabindex="-1"></a><span class="in">  knitr::opts_template$set(</span></span>
<span id="cb22-279"><a href="#cb22-279" aria-hidden="true" tabindex="-1"></a><span class="in">    tikz_settings = list(fig.ext = "svg", fig.align = "center")</span></span>
<span id="cb22-280"><a href="#cb22-280" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb22-281"><a href="#cb22-281" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb22-282"><a href="#cb22-282" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-283"><a href="#cb22-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-284"><a href="#cb22-284" aria-hidden="true" tabindex="-1"></a><span class="in">Here's a DAG with text:</span></span>
<span id="cb22-285"><a href="#cb22-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-286"><a href="#cb22-286" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz dag-text, echo=FALSE, fig.cap="DAG with text", opts.label="tikz_settings"}</span></span>
<span id="cb22-287"><a href="#cb22-287" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning}</span></span>
<span id="cb22-288"><a href="#cb22-288" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}[every node/.append style={draw, minimum size=0.5cm}]</span></span>
<span id="cb22-289"><a href="#cb22-289" aria-hidden="true" tabindex="-1"></a><span class="in">\node [draw=none] (X) at (0,0) {$X_{it}$};</span></span>
<span id="cb22-290"><a href="#cb22-290" aria-hidden="true" tabindex="-1"></a><span class="in">\node [draw=none] (Y) at (2,0) {$Y_{it}$};</span></span>
<span id="cb22-291"><a href="#cb22-291" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle] (Z) at (1,1) {$Z$};</span></span>
<span id="cb22-292"><a href="#cb22-292" aria-hidden="true" tabindex="-1"></a><span class="in">\path [-latex] (X) edge (Y);</span></span>
<span id="cb22-293"><a href="#cb22-293" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex] (Z) edge (Y);</span></span>
<span id="cb22-294"><a href="#cb22-294" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex] (Z) edge (X);</span></span>
<span id="cb22-295"><a href="#cb22-295" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb22-296"><a href="#cb22-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-297"><a href="#cb22-297" aria-hidden="true" tabindex="-1"></a><span class="in">````</span></span>
<span id="cb22-298"><a href="#cb22-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-299"><a href="#cb22-299" aria-hidden="true" tabindex="-1"></a>When knitting to PDF, this diagram looks great, typeset in Computer Modern like any standard LaTeX document(<span class="co">[</span><span class="ot">see full PDF here</span><span class="co">](example-5.pdf)</span>):</span>
<span id="cb22-300"><a href="#cb22-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-301"><a href="#cb22-301" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=FALSE, out.width="100%", fig.align="center"}</span></span>
<span id="cb22-302"><a href="#cb22-302" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("example-5-pdf.png")</span></span>
<span id="cb22-303"><a href="#cb22-303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-304"><a href="#cb22-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-305"><a href="#cb22-305" aria-hidden="true" tabindex="-1"></a>When knitting to HTML, the SVG version of the diagram also works, except for the fonts, since <span class="in">`dvisvgm`</span> doesn't embed the fonts by default (<span class="co">[</span><span class="ot">see full HTML file here</span><span class="co">](example-5.html)</span>):</span>
<span id="cb22-306"><a href="#cb22-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-307"><a href="#cb22-307" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=FALSE, out.width="70%", fig.align="center"}</span></span>
<span id="cb22-308"><a href="#cb22-308" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("example-5.png")</span></span>
<span id="cb22-309"><a href="#cb22-309" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-310"><a href="#cb22-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-311"><a href="#cb22-311" aria-hidden="true" tabindex="-1"></a>If you open the SVG file that R generates (find it at <span class="in">`&lt;RMD_filename&gt;_files/figure-html/unnamed-chunk-1-1.svg`</span>) in something like Illustrator, it will complain about font references that are missing, like <span class="in">`cmmi10`</span> and <span class="in">`cmmi7`</span>:</span>
<span id="cb22-312"><a href="#cb22-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-313"><a href="#cb22-313" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=FALSE, out.width="75%", fig.align="center"}</span></span>
<span id="cb22-314"><a href="#cb22-314" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("illustrator.png")</span></span>
<span id="cb22-315"><a href="#cb22-315" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-316"><a href="#cb22-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-317"><a href="#cb22-317" aria-hidden="true" tabindex="-1"></a>And if you open the SVG file in a text editor you'll notice references to font names, but those assume that you have fonts named "cmmi7" and "cmmi10" on your computer, which is doubtful:</span>
<span id="cb22-318"><a href="#cb22-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-319"><a href="#cb22-319" aria-hidden="true" tabindex="-1"></a><span class="in">```xml</span></span>
<span id="cb22-320"><a href="#cb22-320" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb22-321"><a href="#cb22-321" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">font</span><span class="ot"> id=</span><span class="st">'cmmi7'</span><span class="ot"> horiz-adv-x=</span><span class="st">'0'</span>&gt;</span>
<span id="cb22-322"><a href="#cb22-322" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">font-face</span><span class="ot"> font-family=</span><span class="st">'cmmi7'</span><span class="ot"> units-per-em=</span><span class="st">'1000'</span><span class="ot"> ascent=</span><span class="st">'750'</span><span class="ot"> descent=</span><span class="st">'250'</span>/&gt;</span>
<span id="cb22-323"><a href="#cb22-323" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb22-324"><a href="#cb22-324" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb22-325"><a href="#cb22-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-326"><a href="#cb22-326" aria-hidden="true" tabindex="-1"></a>### Font solutions</span>
<span id="cb22-327"><a href="#cb22-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-328"><a href="#cb22-328" aria-hidden="true" tabindex="-1"></a>Fortunately there's a solution! `dvisvgm` has an optional flag (`--font-format=woff`) that will embed the special LaTeX fonts using a base64-encoded web-optimized WOFF file, which means the SVG file should show the correct fonts in any modern browser or editor.</span>
<span id="cb22-329"><a href="#cb22-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-330"><a href="#cb22-330" aria-hidden="true" tabindex="-1"></a>However, there's currently not a direct way to use that flag with **knitr**. The command for `dvisvgm` is hardcoded into **knitr**'s code and you can't add any extra arguments (though [I've opened an issue at GitHub](https://github.com/yihui/knitr/issues/2038) about this).</span>
<span id="cb22-331"><a href="#cb22-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-332"><a href="#cb22-332" aria-hidden="true" tabindex="-1"></a>But never fear! There's a neat roundabout way around this!</span>
<span id="cb22-333"><a href="#cb22-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-334"><a href="#cb22-334" aria-hidden="true" tabindex="-1"></a>You can use [special chunk hooks](https://bookdown.org/yihui/rmarkdown-cookbook/chunk-hooks.html) in **knitr** to run functions before or after chunks are rendered. We can create a function that runs after a TikZ chunk is rendered that takes the temporary DVI file that **knitr** creates and then runs `dvisvgm --font-format=woff` on it, thus overwriting the non-embedded SVG file that **knitr** makes with its hardcoded `dvisvgm` command. Here's one way to do it (which I adapted from [the built-in `hook_png()` function](https://github.com/yihui/knitr/blob/3237add034368a3018ff26fa9f4d0ca89a4afd78/R/hooks-extra.R#L74)):</span>
<span id="cb22-335"><a href="#cb22-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-336"><a href="#cb22-336" aria-hidden="true" tabindex="-1"></a>```r</span>
<span id="cb22-337"><a href="#cb22-337" aria-hidden="true" tabindex="-1"></a>embed_svg_fonts <span class="er">&lt;</span>- function(before, options, envir) {</span>
<span id="cb22-338"><a href="#cb22-338" aria-hidden="true" tabindex="-1"></a>  # !before means after the chunk is run</span>
<span id="cb22-339"><a href="#cb22-339" aria-hidden="true" tabindex="-1"></a>  if (!before) {</span>
<span id="cb22-340"><a href="#cb22-340" aria-hidden="true" tabindex="-1"></a>    # Get a list of all the plot files this chunk makes</span>
<span id="cb22-341"><a href="#cb22-341" aria-hidden="true" tabindex="-1"></a>    paths <span class="er">&lt;</span>- knitr:::get_plot_files()</span>
<span id="cb22-342"><a href="#cb22-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-343"><a href="#cb22-343" aria-hidden="true" tabindex="-1"></a>    # Loop through all the plot files. When dealing with SVG, knitr actually</span>
<span id="cb22-344"><a href="#cb22-344" aria-hidden="true" tabindex="-1"></a>    # creates two different files: an initial DVI and the converted SVG. We'll</span>
<span id="cb22-345"><a href="#cb22-345" aria-hidden="true" tabindex="-1"></a>    # use the original DVI and pass it through dvisvgm again, this time with</span>
<span id="cb22-346"><a href="#cb22-346" aria-hidden="true" tabindex="-1"></a>    # --font-format=woff enabled. This will overwrite the SVG that knitr makes</span>
<span id="cb22-347"><a href="#cb22-347" aria-hidden="true" tabindex="-1"></a>    knitr:::in_base_dir(</span>
<span id="cb22-348"><a href="#cb22-348" aria-hidden="true" tabindex="-1"></a>      lapply(paths, function(x) {</span>
<span id="cb22-349"><a href="#cb22-349" aria-hidden="true" tabindex="-1"></a>        message("Embedding fonts in ", x)</span>
<span id="cb22-350"><a href="#cb22-350" aria-hidden="true" tabindex="-1"></a>        path_svg <span class="er">&lt;</span>- xfun::with_ext(x, "svg")</span>
<span id="cb22-351"><a href="#cb22-351" aria-hidden="true" tabindex="-1"></a>        path_dvi <span class="er">&lt;</span>- xfun::with_ext(x, "dvi")</span>
<span id="cb22-352"><a href="#cb22-352" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb22-353"><a href="#cb22-353" aria-hidden="true" tabindex="-1"></a>        if (system2('dvisvgm', c('--font-format=woff', '-o', shQuote(path_svg), shQuote(path_dvi))) != 0)</span>
<span id="cb22-354"><a href="#cb22-354" aria-hidden="true" tabindex="-1"></a>          stop('Failed to convert ', path_dvi, ' to ', path_svg)</span>
<span id="cb22-355"><a href="#cb22-355" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb22-356"><a href="#cb22-356" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-357"><a href="#cb22-357" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-358"><a href="#cb22-358" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-359"><a href="#cb22-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-360"><a href="#cb22-360" aria-hidden="true" tabindex="-1"></a># Register the function as a possible hook</span>
<span id="cb22-361"><a href="#cb22-361" aria-hidden="true" tabindex="-1"></a># Use this in a chunk by setting embed_svg_fonts=TRUE in the chunk options</span>
<span id="cb22-362"><a href="#cb22-362" aria-hidden="true" tabindex="-1"></a>knitr::knit_hooks$set(embed_svg_fonts = embed_svg_fonts)</span>
<span id="cb22-363"><a href="#cb22-363" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb22-364"><a href="#cb22-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-365"><a href="#cb22-365" aria-hidden="true" tabindex="-1"></a>Stick that ↑ in an invisible chunk (probably in the same one with `Sys.setenv(LIBGS = "blah")`), and then add `embed_svg_fonts=TRUE` to the chunk options of the TikZ chunk, and it should work. When you knit, you'll see two messages about converting DVI to SVG. We don't care about the first—that's **knitr**'s basic version without embedded fonts. The second message corresponds to the command we created with the hook, which includes `--font-format=woff`.</span>
<span id="cb22-366"><a href="#cb22-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-367"><a href="#cb22-367" aria-hidden="true" tabindex="-1"></a>Here's what the SVG file looks like now with the fonts embedded in it ([see full SVG file here](dag-text-1.svg)):</span>
<span id="cb22-368"><a href="#cb22-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-369"><a href="#cb22-369" aria-hidden="true" tabindex="-1"></a>```{r echo=FALSE, out.width="40%", fig.align="center"}</span>
<span id="cb22-370"><a href="#cb22-370" aria-hidden="true" tabindex="-1"></a>knitr::include_graphics("dag-text-1.svg")</span>
<span id="cb22-371"><a href="#cb22-371" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb22-372"><a href="#cb22-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-373"><a href="#cb22-373" aria-hidden="true" tabindex="-1"></a>## tl;dr: Final working version</span>
<span id="cb22-374"><a href="#cb22-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-375"><a href="#cb22-375" aria-hidden="true" tabindex="-1"></a>Here's what your final R Markdown file should look like:</span>
<span id="cb22-376"><a href="#cb22-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-377"><a href="#cb22-377" aria-hidden="true" tabindex="-1"></a>````</span>
<span id="cb22-378"><a href="#cb22-378" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb22-379"><a href="#cb22-379" aria-hidden="true" tabindex="-1"></a>title: "TikZ fun!"</span>
<span id="cb22-380"><a href="#cb22-380" aria-hidden="true" tabindex="-1"></a>output:</span>
<span id="cb22-381"><a href="#cb22-381" aria-hidden="true" tabindex="-1"></a>  html_document: </span>
<span id="cb22-382"><a href="#cb22-382" aria-hidden="true" tabindex="-1"></a>    self_contained: no</span>
<span id="cb22-383"><a href="#cb22-383" aria-hidden="true" tabindex="-1"></a>  pdf_document: default</span>
<span id="cb22-384"><a href="#cb22-384" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb22-385"><a href="#cb22-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-386"><a href="#cb22-386" aria-hidden="true" tabindex="-1"></a>```{r svg-settings, include=FALSE}</span>
<span id="cb22-387"><a href="#cb22-387" aria-hidden="true" tabindex="-1"></a>Sys.setenv(LIBGS = "/usr/local/share/ghostscript/9.53.3/lib/libgs.dylib.9.53")</span>
<span id="cb22-388"><a href="#cb22-388" aria-hidden="true" tabindex="-1"></a>embed_svg_fonts <span class="er">&lt;</span>- function(before, options, envir) {</span>
<span id="cb22-389"><a href="#cb22-389" aria-hidden="true" tabindex="-1"></a>  # !before means after the chunk is run</span>
<span id="cb22-390"><a href="#cb22-390" aria-hidden="true" tabindex="-1"></a>  if (!before) {</span>
<span id="cb22-391"><a href="#cb22-391" aria-hidden="true" tabindex="-1"></a>    # Get a list of all the plot files this chunk makes</span>
<span id="cb22-392"><a href="#cb22-392" aria-hidden="true" tabindex="-1"></a>    paths <span class="er">&lt;</span>- knitr:::get_plot_files()</span>
<span id="cb22-393"><a href="#cb22-393" aria-hidden="true" tabindex="-1"></a>    # Loop through all the plot files. When dealing with SVG, knitr actually</span>
<span id="cb22-394"><a href="#cb22-394" aria-hidden="true" tabindex="-1"></a>    # creates two different files: an initial DVI and the converted SVG. We'll</span>
<span id="cb22-395"><a href="#cb22-395" aria-hidden="true" tabindex="-1"></a>    # use the original DVI and pass it through dvisvgm again, this time with</span>
<span id="cb22-396"><a href="#cb22-396" aria-hidden="true" tabindex="-1"></a>    # --font-format=woff enabled. This will overwrite the SVG that knitr makes</span>
<span id="cb22-397"><a href="#cb22-397" aria-hidden="true" tabindex="-1"></a>    knitr:::in_base_dir(</span>
<span id="cb22-398"><a href="#cb22-398" aria-hidden="true" tabindex="-1"></a>      lapply(paths, function(x) {</span>
<span id="cb22-399"><a href="#cb22-399" aria-hidden="true" tabindex="-1"></a>        message("Embedding fonts in ", x)</span>
<span id="cb22-400"><a href="#cb22-400" aria-hidden="true" tabindex="-1"></a>        path_svg <span class="er">&lt;</span>- xfun::with_ext(x, "svg")</span>
<span id="cb22-401"><a href="#cb22-401" aria-hidden="true" tabindex="-1"></a>        path_dvi <span class="er">&lt;</span>- xfun::with_ext(x, "dvi")</span>
<span id="cb22-402"><a href="#cb22-402" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb22-403"><a href="#cb22-403" aria-hidden="true" tabindex="-1"></a>        if (system2('dvisvgm', c('--font-format=woff', '-o', shQuote(path_svg), shQuote(path_dvi))) != 0)</span>
<span id="cb22-404"><a href="#cb22-404" aria-hidden="true" tabindex="-1"></a>          stop('Failed to convert ', path_dvi, ' to ', path_svg)</span>
<span id="cb22-405"><a href="#cb22-405" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb22-406"><a href="#cb22-406" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-407"><a href="#cb22-407" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-408"><a href="#cb22-408" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-409"><a href="#cb22-409" aria-hidden="true" tabindex="-1"></a># Register the function as a possible hook</span>
<span id="cb22-410"><a href="#cb22-410" aria-hidden="true" tabindex="-1"></a># Use this in a chunk by setting embed_svg_fonts=TRUE in the chunk options</span>
<span id="cb22-411"><a href="#cb22-411" aria-hidden="true" tabindex="-1"></a>knitr::knit_hooks$set(embed_svg_fonts = embed_svg_fonts)</span>
<span id="cb22-412"><a href="#cb22-412" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb22-413"><a href="#cb22-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-414"><a href="#cb22-414" aria-hidden="true" tabindex="-1"></a>```{r setup, include=FALSE}</span>
<span id="cb22-415"><a href="#cb22-415" aria-hidden="true" tabindex="-1"></a># Conditional tikz output types; use PDF if this is LaTeX, otherwise use SVG</span>
<span id="cb22-416"><a href="#cb22-416" aria-hidden="true" tabindex="-1"></a>if (knitr::is_latex_output()) {</span>
<span id="cb22-417"><a href="#cb22-417" aria-hidden="true" tabindex="-1"></a>  knitr::opts_template$set(</span>
<span id="cb22-418"><a href="#cb22-418" aria-hidden="true" tabindex="-1"></a>    tikz_settings = list(fig.ext = "pdf", fig.align = "center")</span>
<span id="cb22-419"><a href="#cb22-419" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-420"><a href="#cb22-420" aria-hidden="true" tabindex="-1"></a>} else {</span>
<span id="cb22-421"><a href="#cb22-421" aria-hidden="true" tabindex="-1"></a>  knitr::opts_template$set(</span>
<span id="cb22-422"><a href="#cb22-422" aria-hidden="true" tabindex="-1"></a>    tikz_settings = list(fig.ext = "svg", fig.align = "center", embed_svg_fonts = TRUE)</span>
<span id="cb22-423"><a href="#cb22-423" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-424"><a href="#cb22-424" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-425"><a href="#cb22-425" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb22-426"><a href="#cb22-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-427"><a href="#cb22-427" aria-hidden="true" tabindex="-1"></a>Here's a DAG with text:</span>
<span id="cb22-428"><a href="#cb22-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-429"><a href="#cb22-429" aria-hidden="true" tabindex="-1"></a>```{tikz dag-text, echo=FALSE, fig.cap="DAG with text", opts.label="tikz_settings"}</span>
<span id="cb22-430"><a href="#cb22-430" aria-hidden="true" tabindex="-1"></a>\usetikzlibrary{positioning}</span>
<span id="cb22-431"><a href="#cb22-431" aria-hidden="true" tabindex="-1"></a>\begin{tikzpicture}[every node/.append style={draw, minimum size=0.5cm}]</span>
<span id="cb22-432"><a href="#cb22-432" aria-hidden="true" tabindex="-1"></a>\node [draw=none] (X) at (0,0) {$X_{it}$};</span>
<span id="cb22-433"><a href="#cb22-433" aria-hidden="true" tabindex="-1"></a>\node [draw=none] (Y) at (2,0) {$Y_{it}$};</span>
<span id="cb22-434"><a href="#cb22-434" aria-hidden="true" tabindex="-1"></a>\node [rectangle] (Z) at (1,1) {$Z$};</span>
<span id="cb22-435"><a href="#cb22-435" aria-hidden="true" tabindex="-1"></a>\path [-latex] (X) edge (Y);</span>
<span id="cb22-436"><a href="#cb22-436" aria-hidden="true" tabindex="-1"></a>\draw [-latex] (Z) edge (Y);</span>
<span id="cb22-437"><a href="#cb22-437" aria-hidden="true" tabindex="-1"></a>\draw [-latex] (Z) edge (X);</span>
<span id="cb22-438"><a href="#cb22-438" aria-hidden="true" tabindex="-1"></a>\end{tikzpicture}</span>
<span id="cb22-439"><a href="#cb22-439" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb22-440"><a href="#cb22-440" aria-hidden="true" tabindex="-1"></a>````</span>
<span id="cb22-441"><a href="#cb22-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-442"><a href="#cb22-442" aria-hidden="true" tabindex="-1"></a>When knitting to PDF, the TikZ figure will show up as a regular PDF image, as excepted. When knitting to HTML, though, **knitr** will create a DVI version of the image and then convert that to SVG (but without font embedding enabled in `dvisvgm`). Then finally, because of the post-rendering hook, **knitr** will run the `embed_svg_fonts()` function on the DVI and create a new SVG with fonts embedded that will overwrite the original SVG file. </span>
<span id="cb22-443"><a href="#cb22-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-444"><a href="#cb22-444" aria-hidden="true" tabindex="-1"></a>Look at that! So great! ([see full HTML file here](example-final.html)):</span>
<span id="cb22-445"><a href="#cb22-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-446"><a href="#cb22-446" aria-hidden="true" tabindex="-1"></a>```{r echo=FALSE, out.width="70%", fig.align="center"}</span>
<span id="cb22-447"><a href="#cb22-447" aria-hidden="true" tabindex="-1"></a>knitr::include_graphics("example-final.png")</span>
<span id="cb22-448"><a href="#cb22-448" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb22-449"><a href="#cb22-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-450"><a href="#cb22-450" aria-hidden="true" tabindex="-1"></a>## UPDATE: Easier font embedding!</span>
<span id="cb22-451"><a href="#cb22-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-452"><a href="#cb22-452" aria-hidden="true" tabindex="-1"></a>I submitted [a pull request to **knitr**](https://github.com/yihui/knitr/pull/2039) that would allow users to specify additional arguments to `dvisvgm` from a chunk, and it was just merged in, so with the development version of **knitr** (and someday with the CRAN version, once a new version is eventually submitted), you can use the `dvisvgm.opts` option in the `engine.opts` chunk options like this:</span>
<span id="cb22-453"><a href="#cb22-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-454"><a href="#cb22-454" aria-hidden="true" tabindex="-1"></a>````</span>
<span id="cb22-455"><a href="#cb22-455" aria-hidden="true" tabindex="-1"></a>```{tikz, fig.ext="svg", engine.opts=list(dvisvgm.opts = "--font-format=woff")}</span>
<span id="cb22-456"><a href="#cb22-456" aria-hidden="true" tabindex="-1"></a>% Stuff here</span>
<span id="cb22-457"><a href="#cb22-457" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb22-458"><a href="#cb22-458" aria-hidden="true" tabindex="-1"></a>````</span>
<span id="cb22-459"><a href="#cb22-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-460"><a href="#cb22-460" aria-hidden="true" tabindex="-1"></a>So now there's no need for the `embed_svg_fonts()` hook function! This should work now for the complete DAG example:</span>
<span id="cb22-461"><a href="#cb22-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-462"><a href="#cb22-462" aria-hidden="true" tabindex="-1"></a>````</span>
<span id="cb22-463"><a href="#cb22-463" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb22-464"><a href="#cb22-464" aria-hidden="true" tabindex="-1"></a>title: "TikZ fun!"</span>
<span id="cb22-465"><a href="#cb22-465" aria-hidden="true" tabindex="-1"></a>output:</span>
<span id="cb22-466"><a href="#cb22-466" aria-hidden="true" tabindex="-1"></a>  html_document: </span>
<span id="cb22-467"><a href="#cb22-467" aria-hidden="true" tabindex="-1"></a>    self_contained: no</span>
<span id="cb22-468"><a href="#cb22-468" aria-hidden="true" tabindex="-1"></a>  pdf_document: default</span>
<span id="cb22-469"><a href="#cb22-469" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb22-470"><a href="#cb22-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-471"><a href="#cb22-471" aria-hidden="true" tabindex="-1"></a>```{r point-to-ghostscript, include=FALSE}</span>
<span id="cb22-472"><a href="#cb22-472" aria-hidden="true" tabindex="-1"></a>Sys.setenv(LIBGS = "/usr/local/share/ghostscript/9.53.3/lib/libgs.dylib.9.53")</span>
<span id="cb22-473"><a href="#cb22-473" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb22-474"><a href="#cb22-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-475"><a href="#cb22-475" aria-hidden="true" tabindex="-1"></a>```{r setup, include=FALSE}</span>
<span id="cb22-476"><a href="#cb22-476" aria-hidden="true" tabindex="-1"></a># Conditional tikz output types; use PDF if this is LaTeX, otherwise use SVG with embedded fonts</span>
<span id="cb22-477"><a href="#cb22-477" aria-hidden="true" tabindex="-1"></a>if (knitr::is_latex_output()) {</span>
<span id="cb22-478"><a href="#cb22-478" aria-hidden="true" tabindex="-1"></a>  knitr::opts_template$set(</span>
<span id="cb22-479"><a href="#cb22-479" aria-hidden="true" tabindex="-1"></a>    tikz_settings = list(fig.ext = "pdf", fig.align = "center")</span>
<span id="cb22-480"><a href="#cb22-480" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-481"><a href="#cb22-481" aria-hidden="true" tabindex="-1"></a>} else {</span>
<span id="cb22-482"><a href="#cb22-482" aria-hidden="true" tabindex="-1"></a>  knitr::opts_template$set(</span>
<span id="cb22-483"><a href="#cb22-483" aria-hidden="true" tabindex="-1"></a>    tikz_settings = list(fig.ext = "svg", fig.align = "center",</span>
<span id="cb22-484"><a href="#cb22-484" aria-hidden="true" tabindex="-1"></a>                         engine.opts = list(dvisvgm.opts = "--font-format=woff"))</span>
<span id="cb22-485"><a href="#cb22-485" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-486"><a href="#cb22-486" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-487"><a href="#cb22-487" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb22-488"><a href="#cb22-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-489"><a href="#cb22-489" aria-hidden="true" tabindex="-1"></a>Here's a DAG with text:</span>
<span id="cb22-490"><a href="#cb22-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-491"><a href="#cb22-491" aria-hidden="true" tabindex="-1"></a>```{tikz dag-text, echo=FALSE, fig.cap="DAG with text", opts.label="tikz_settings"}</span>
<span id="cb22-492"><a href="#cb22-492" aria-hidden="true" tabindex="-1"></a>\usetikzlibrary{positioning}</span>
<span id="cb22-493"><a href="#cb22-493" aria-hidden="true" tabindex="-1"></a>\begin{tikzpicture}[every node/.append style={draw, minimum size=0.5cm}]</span>
<span id="cb22-494"><a href="#cb22-494" aria-hidden="true" tabindex="-1"></a>\node [draw=none] (X) at (0,0) {$X_{it}$};</span>
<span id="cb22-495"><a href="#cb22-495" aria-hidden="true" tabindex="-1"></a>\node [draw=none] (Y) at (2,0) {$Y_{it}$};</span>
<span id="cb22-496"><a href="#cb22-496" aria-hidden="true" tabindex="-1"></a>\node [rectangle] (Z) at (1,1) {$Z$};</span>
<span id="cb22-497"><a href="#cb22-497" aria-hidden="true" tabindex="-1"></a>\path [-latex] (X) edge (Y);</span>
<span id="cb22-498"><a href="#cb22-498" aria-hidden="true" tabindex="-1"></a>\draw [-latex] (Z) edge (Y);</span>
<span id="cb22-499"><a href="#cb22-499" aria-hidden="true" tabindex="-1"></a>\draw [-latex] (Z) edge (X);</span>
<span id="cb22-500"><a href="#cb22-500" aria-hidden="true" tabindex="-1"></a>\end{tikzpicture}</span>
<span id="cb22-501"><a href="#cb22-501" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb22-502"><a href="#cb22-502" aria-hidden="true" tabindex="-1"></a>````</span>
<span id="cb22-503"><a href="#cb22-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-504"><a href="#cb22-504" aria-hidden="true" tabindex="-1"></a>## ANOTHER UPDATE: Changing fonts!</span>
<span id="cb22-505"><a href="#cb22-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-506"><a href="#cb22-506" aria-hidden="true" tabindex="-1"></a>You're not limited to the default (and kinda ugly) Computer Modern font with TikZ chunks, but changing the font is a little tricky becuase each TikZ chunk in **knitr** is treated as a standalone LaTeX document, so you need to adjust the fonts in each chunk.</span>
<span id="cb22-507"><a href="#cb22-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-508"><a href="#cb22-508" aria-hidden="true" tabindex="-1"></a>### Knitting only to PDF</span>
<span id="cb22-509"><a href="#cb22-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-510"><a href="#cb22-510" aria-hidden="true" tabindex="-1"></a>If you're *only* interested in knitting to PDF, you can use XeTeX to embed any font you want in the diagram. When using XeTeX, you'd typically add something like this to the preamble of your document to change the document font:</span>
<span id="cb22-511"><a href="#cb22-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-512"><a href="#cb22-512" aria-hidden="true" tabindex="-1"></a>```latex</span>
<span id="cb22-513"><a href="#cb22-513" aria-hidden="true" tabindex="-1"></a>\usepackage{fontspec}</span>
<span id="cb22-514"><a href="#cb22-514" aria-hidden="true" tabindex="-1"></a>\setmainfont{Comic Sans MS}  % ew</span>
<span id="cb22-515"><a href="#cb22-515" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb22-516"><a href="#cb22-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-517"><a href="#cb22-517" aria-hidden="true" tabindex="-1"></a>Each standalone TikZ knitr chunk gets passed to [a special `tikz2pdf.tex` template](https://github.com/yihui/knitr/blob/master/inst/misc/tikz2pdf.tex). The content of the chunk is inserted in the `%% TIKZ_CODE %%` area, and there's a space in the template for preamble things at `%% EXTRA_TIKZ_PREAMBLE_CODE %%`. To get content inserted there, you can use the `extra.preamble` option in `engine.opts` like so:</span>
<span id="cb22-518"><a href="#cb22-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-519"><a href="#cb22-519" aria-hidden="true" tabindex="-1"></a>````</span>
<span id="cb22-520"><a href="#cb22-520" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb22-521"><a href="#cb22-521" aria-hidden="true" tabindex="-1"></a>font_opts <span class="er">&lt;</span>- list(extra.preamble=c("\\usepackage{fontspec}", </span>
<span id="cb22-522"><a href="#cb22-522" aria-hidden="true" tabindex="-1"></a>                                   "\\setmainfont{Comic Sans MS}"))</span>
<span id="cb22-523"><a href="#cb22-523" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb22-524"><a href="#cb22-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-525"><a href="#cb22-525" aria-hidden="true" tabindex="-1"></a>```{tikz, engine.opts=font_opts}</span>
<span id="cb22-526"><a href="#cb22-526" aria-hidden="true" tabindex="-1"></a>% Stuff here</span>
<span id="cb22-527"><a href="#cb22-527" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb22-528"><a href="#cb22-528" aria-hidden="true" tabindex="-1"></a>````</span>
<span id="cb22-529"><a href="#cb22-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-530"><a href="#cb22-530" aria-hidden="true" tabindex="-1"></a>That won't work right away though. When you knit, **knitr** uses the default `pdflatex` LaTeX engine to render each TikZ chunk, and you'll get an error because `fontspec` only works with XeTeX. You can tell **knitr** to use `xelatex` to render those chunks if you set the `tinytex.engine` option: </span>
<span id="cb22-531"><a href="#cb22-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-532"><a href="#cb22-532" aria-hidden="true" tabindex="-1"></a>```r</span>
<span id="cb22-533"><a href="#cb22-533" aria-hidden="true" tabindex="-1"></a>options(tinytex.engine = "xelatex")</span>
<span id="cb22-534"><a href="#cb22-534" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb22-535"><a href="#cb22-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-536"><a href="#cb22-536" aria-hidden="true" tabindex="-1"></a>Once you set `xelatex` as the default LaTeX engine for the document, all TikZ chunks will render correctly. Here's a complete example (note that I moved the `extra.preamble` stuff to a separate variable so that it's easier to reuse) ([see full PDF here](example-xelatex.pdf)):</span>
<span id="cb22-537"><a href="#cb22-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-538"><a href="#cb22-538" aria-hidden="true" tabindex="-1"></a>````</span>
<span id="cb22-539"><a href="#cb22-539" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb22-540"><a href="#cb22-540" aria-hidden="true" tabindex="-1"></a>title: "TikZ fun!"</span>
<span id="cb22-541"><a href="#cb22-541" aria-hidden="true" tabindex="-1"></a>output:</span>
<span id="cb22-542"><a href="#cb22-542" aria-hidden="true" tabindex="-1"></a>  pdf_document: </span>
<span id="cb22-543"><a href="#cb22-543" aria-hidden="true" tabindex="-1"></a>    latex_engine: xelatex</span>
<span id="cb22-544"><a href="#cb22-544" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb22-545"><a href="#cb22-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-546"><a href="#cb22-546" aria-hidden="true" tabindex="-1"></a>```{r setup, include=FALSE}</span>
<span id="cb22-547"><a href="#cb22-547" aria-hidden="true" tabindex="-1"></a>options(tinytex.engine = "xelatex")</span>
<span id="cb22-548"><a href="#cb22-548" aria-hidden="true" tabindex="-1"></a>font_opts <span class="er">&lt;</span>- list(extra.preamble = c("\\usepackage{fontspec}", </span>
<span id="cb22-549"><a href="#cb22-549" aria-hidden="true" tabindex="-1"></a>                                     "\\setmainfont{Comic Sans MS}",</span>
<span id="cb22-550"><a href="#cb22-550" aria-hidden="true" tabindex="-1"></a>                                     "\\usepackage{unicode-math}",</span>
<span id="cb22-551"><a href="#cb22-551" aria-hidden="true" tabindex="-1"></a>                                     "\\usepackage{mathastext}",</span>
<span id="cb22-552"><a href="#cb22-552" aria-hidden="true" tabindex="-1"></a>                                     "\\setmathfont{Comic Sans MS}"))</span>
<span id="cb22-553"><a href="#cb22-553" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb22-554"><a href="#cb22-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-555"><a href="#cb22-555" aria-hidden="true" tabindex="-1"></a>```{tikz rectangle-text, echo=FALSE, fig.align="center", engine.opts=font_opts}</span>
<span id="cb22-556"><a href="#cb22-556" aria-hidden="true" tabindex="-1"></a>\begin{tikzpicture}</span>
<span id="cb22-557"><a href="#cb22-557" aria-hidden="true" tabindex="-1"></a>\draw (0,0) rectangle (6, 2) node[midway, align=center] {I am a rectangle with math: \\ $\hat{y} = \beta_0 + \beta_1 x_1 + \text{Some text} + \varepsilon$};</span>
<span id="cb22-558"><a href="#cb22-558" aria-hidden="true" tabindex="-1"></a>\end{tikzpicture}</span>
<span id="cb22-559"><a href="#cb22-559" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb22-560"><a href="#cb22-560" aria-hidden="true" tabindex="-1"></a>````</span>
<span id="cb22-561"><a href="#cb22-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-562"><a href="#cb22-562" aria-hidden="true" tabindex="-1"></a>```{r echo=FALSE, out.width="70%", fig.align="center"}</span>
<span id="cb22-563"><a href="#cb22-563" aria-hidden="true" tabindex="-1"></a>knitr::include_graphics("example-xelatex.png")</span>
<span id="cb22-564"><a href="#cb22-564" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb22-565"><a href="#cb22-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-566"><a href="#cb22-566" aria-hidden="true" tabindex="-1"></a>### Knitting to PDF and HTML</span>
<span id="cb22-567"><a href="#cb22-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-568"><a href="#cb22-568" aria-hidden="true" tabindex="-1"></a>This is a little trickier if you want to convert these TikZ chunks to SVG when knitting to HTML. **knitr** ignores the `tinytex.engine` option when you knit to HTML, so there's no way to tell TikZ chunks to get processed through `xelatex`. Additionally, `xelatex` does not produce .dvi files, which `dvisvgm` uses to convert to SVG. `xelatex` instead creates its own special .xdv files. In theory, newer versions of `dvisvgm` should work with XDV files, but **knitr** is hard-coded to pass DVI files to `dvisvgm`, not XDV files. So even if we could force TikZ chunks to go through `xelatex`, they wouldn't be converted to SVG. Alas.</span>
<span id="cb22-569"><a href="#cb22-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-570"><a href="#cb22-570" aria-hidden="true" tabindex="-1"></a>But all is not lost! It's possible to change fonts in non-XeTeX documents. Because you're limited to whatever `pdflatex` can support, you can only use specific font packages instead of whatever font you want. For instance, to use [TEX Gyre Pagella](https://ctan.org/pkg/tex-gyre-pagella), include `\usepackage{tgpagella}` in your preamble. [See this](https://www.overleaf.com/learn/latex/Font_typefaces) for a basic list of possible font packages, or [this for a pretty complete catalogue](https://tug.org/FontCatalogue/).</span>
<span id="cb22-571"><a href="#cb22-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-572"><a href="#cb22-572" aria-hidden="true" tabindex="-1"></a>For instance, here's how to use [Linux Libertine](https://tug.org/FontCatalogue/linuxlibertine/) for text and [Libertinus Math](https://github.com/alerque/libertinus) for math *with* embedded SVG fonts when knitting to HTML ([see full HTML file here](example-svg-libertine.html)):</span>
<span id="cb22-573"><a href="#cb22-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-574"><a href="#cb22-574" aria-hidden="true" tabindex="-1"></a>````</span>
<span id="cb22-575"><a href="#cb22-575" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb22-576"><a href="#cb22-576" aria-hidden="true" tabindex="-1"></a>title: "TikZ fun!"</span>
<span id="cb22-577"><a href="#cb22-577" aria-hidden="true" tabindex="-1"></a>output:</span>
<span id="cb22-578"><a href="#cb22-578" aria-hidden="true" tabindex="-1"></a>  html_document: default</span>
<span id="cb22-579"><a href="#cb22-579" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb22-580"><a href="#cb22-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-581"><a href="#cb22-581" aria-hidden="true" tabindex="-1"></a>```{r point-to-ghostscript, include=FALSE}</span>
<span id="cb22-582"><a href="#cb22-582" aria-hidden="true" tabindex="-1"></a>Sys.setenv(LIBGS = "/usr/local/share/ghostscript/9.53.3/lib/libgs.dylib.9.53")</span>
<span id="cb22-583"><a href="#cb22-583" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb22-584"><a href="#cb22-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-585"><a href="#cb22-585" aria-hidden="true" tabindex="-1"></a>```{r setup, include=FALSE}</span>
<span id="cb22-586"><a href="#cb22-586" aria-hidden="true" tabindex="-1"></a>font_opts <span class="er">&lt;</span>- list(extra.preamble = c("\\usepackage{libertine}", "\\usepackage{libertinust1math}"),</span>
<span id="cb22-587"><a href="#cb22-587" aria-hidden="true" tabindex="-1"></a>                  dvisvgm.opts = "--font-format=woff")</span>
<span id="cb22-588"><a href="#cb22-588" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb22-589"><a href="#cb22-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-590"><a href="#cb22-590" aria-hidden="true" tabindex="-1"></a>```{tikz rectangle-text, fig.ext="svg", echo=FALSE, fig.align="center", engine.opts=font_opts}</span>
<span id="cb22-591"><a href="#cb22-591" aria-hidden="true" tabindex="-1"></a>\begin{tikzpicture}</span>
<span id="cb22-592"><a href="#cb22-592" aria-hidden="true" tabindex="-1"></a>\draw (0,0) rectangle (6, 2) node[midway, align=center] {I am a rectangle with math: \\ $\hat{y} = \beta_0 + \beta_1 x_1 + \text{Some text} + \varepsilon$};</span>
<span id="cb22-593"><a href="#cb22-593" aria-hidden="true" tabindex="-1"></a>\end{tikzpicture}</span>
<span id="cb22-594"><a href="#cb22-594" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb22-595"><a href="#cb22-595" aria-hidden="true" tabindex="-1"></a>````</span>
<span id="cb22-596"><a href="#cb22-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-597"><a href="#cb22-597" aria-hidden="true" tabindex="-1"></a>```{r echo=FALSE, out.width="70%", fig.align="center"}</span>
<span id="cb22-598"><a href="#cb22-598" aria-hidden="true" tabindex="-1"></a>knitr::include_graphics("example-svg-libertine.png")</span>
<span id="cb22-599"><a href="#cb22-599" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb22-600"><a href="#cb22-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-601"><a href="#cb22-601" aria-hidden="true" tabindex="-1"></a>Or with [GFS Artemisia with Euler for math](https://tug.org/FontCatalogue/gfsartemisiaeulermath/) ([see full HTML file here](example-svg-artemisia.html)):</span>
<span id="cb22-602"><a href="#cb22-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-603"><a href="#cb22-603" aria-hidden="true" tabindex="-1"></a>````</span>
<span id="cb22-604"><a href="#cb22-604" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb22-605"><a href="#cb22-605" aria-hidden="true" tabindex="-1"></a>title: "TikZ fun!"</span>
<span id="cb22-606"><a href="#cb22-606" aria-hidden="true" tabindex="-1"></a>output:</span>
<span id="cb22-607"><a href="#cb22-607" aria-hidden="true" tabindex="-1"></a>  html_document: default</span>
<span id="cb22-608"><a href="#cb22-608" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb22-609"><a href="#cb22-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-610"><a href="#cb22-610" aria-hidden="true" tabindex="-1"></a>```{r point-to-ghostscript, include=FALSE}</span>
<span id="cb22-611"><a href="#cb22-611" aria-hidden="true" tabindex="-1"></a>Sys.setenv(LIBGS = "/usr/local/share/ghostscript/9.53.3/lib/libgs.dylib.9.53")</span>
<span id="cb22-612"><a href="#cb22-612" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb22-613"><a href="#cb22-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-614"><a href="#cb22-614" aria-hidden="true" tabindex="-1"></a>```{r setup, include=FALSE}</span>
<span id="cb22-615"><a href="#cb22-615" aria-hidden="true" tabindex="-1"></a>font_opts <span class="er">&lt;</span>- list(extra.preamble = c("\\usepackage{gfsartemisia-euler}"),</span>
<span id="cb22-616"><a href="#cb22-616" aria-hidden="true" tabindex="-1"></a>                  dvisvgm.opts = "--font-format=woff")</span>
<span id="cb22-617"><a href="#cb22-617" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb22-618"><a href="#cb22-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-619"><a href="#cb22-619" aria-hidden="true" tabindex="-1"></a>```{tikz rectangle-text, fig.ext="svg", echo=FALSE, fig.align="center", engine.opts=font_opts}</span>
<span id="cb22-620"><a href="#cb22-620" aria-hidden="true" tabindex="-1"></a>\begin{tikzpicture}</span>
<span id="cb22-621"><a href="#cb22-621" aria-hidden="true" tabindex="-1"></a>\draw (0,0) rectangle (6, 2) node[midway, align=center] {I am a rectangle with math: \\ $\hat{y} = \beta_0 + \beta_1 x_1 + \text{Some text} + \varepsilon$};</span>
<span id="cb22-622"><a href="#cb22-622" aria-hidden="true" tabindex="-1"></a>\end{tikzpicture}</span>
<span id="cb22-623"><a href="#cb22-623" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb22-624"><a href="#cb22-624" aria-hidden="true" tabindex="-1"></a>````</span>
<span id="cb22-625"><a href="#cb22-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-626"><a href="#cb22-626" aria-hidden="true" tabindex="-1"></a>```{r echo=FALSE, out.width="70%", fig.align="center"}</span>
<span id="cb22-627"><a href="#cb22-627" aria-hidden="true" tabindex="-1"></a>knitr::include_graphics("example-svg-artemisia.png")</span>
<span id="cb22-628"><a href="#cb22-628" aria-hidden="true" tabindex="-1"></a>```</span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p><span class="faux-block">Forked from <a href="https://www.andrewheiss.com/">Andrew Heiss</a></span> # <span class="faux-block"><a href="https://github.com/andrewheiss/ath-quarto">View the source at <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></span></p>
</div>
  </div>
</footer>


</body></html>