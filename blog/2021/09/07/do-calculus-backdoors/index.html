<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Andrew Heiss">
<meta name="description" content="Use R to explore the three rules of do-calculus in plain language and derive the backdoor adjustment formula by hand">
<title>Do-calculus adventures! Exploring the three rules of do-calculus in plain language and deriving the backdoor adjustment formula by hand | Andrew Heiss – Andrew Heiss</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../../">
<link href="../../../../..//files/favicon-512.png" rel="icon" type="image/png">
<script src="../../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting-17c909d5fd25ae21b861c0c7a49b2096.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../site_libs/bootstrap/bootstrap-5cd0811f461c8271ae6bab49df9501be.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script src="../../../../../site_libs/quarto-contrib/iconify-2.0.0/iconify-icon.min.js"></script><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-527449-5', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script><style>

      .quarto-title-block .quarto-title-banner {
        background: #170C3A;
      }
</style>
<script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script><script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script><script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">
<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
<meta property="og:title" content="Do-calculus adventures! Exploring the three rules of do-calculus in plain language and deriving the backdoor adjustment formula by hand | Andrew Heiss">
<meta property="og:description" content="Use R to explore the three rules of do-calculus in plain language and derive the backdoor adjustment formula by hand">
<meta property="og:image" content="https://www.andrewheiss.com/blog/2021/09/07/do-calculus-backdoors/do-calculus-math.png">
<meta property="og:site_name" content="Andrew Heiss">
<meta property="og:locale" content="en_US">
<meta property="og:image:height" content="2825">
<meta property="og:image:width" content="5022">
<meta name="twitter:title" content="Do-calculus adventures! Exploring the three rules of do-calculus in plain language and deriving the backdoor adjustment formula by hand | Andrew Heiss">
<meta name="twitter:description" content="Use R to explore the three rules of do-calculus in plain language and derive the backdoor adjustment formula by hand">
<meta name="twitter:image" content="https://www.andrewheiss.com/blog/2021/09/07/do-calculus-backdoors/do-calculus-math.png">
<meta name="twitter:creator" content="@andrewheiss">
<meta name="twitter:site" content="@andrewheiss">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image-height" content="2825">
<meta name="twitter:image-width" content="5022">
</head>
<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../../index.html">
    <span class="navbar-title">Andrew Heiss</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../../../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../cv/index.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../research/index.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../teaching/index.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../talks/index.html"> 
<span class="menu-text">Talks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../now/index.html"> 
<span class="menu-text">Now</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../uses/index.html"> 
<span class="menu-text">Uses</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../../../../../atom.xml"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:rss" style="font-size: 1.1em;" aria-label="Icon rss from bi Iconify.design set." title="RSS"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="mailto:aheiss@gsu.edu"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:envelope" style="font-size: 1.1em;" aria-label="Icon envelope from bi Iconify.design set." title="E-mail"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://bsky.app/profile/andrew.heiss.phd" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="fa6-brands:bluesky" style="font-size: 1.1em;" aria-label="Icon bluesky from fa6-brands Iconify.design set." title="Bluesky"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://fediscience.org/users/andrew/" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:mastodon" style="font-size: 1.1em;" aria-label="Icon mastodon from bi Iconify.design set." title="Mastodon"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/andrewheiss" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:github" style="font-size: 1.1em;" aria-label="Icon github from bi Iconify.design set." title="GitHub"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.youtube.com/andrewheiss" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:youtube" style="font-size: 1.1em;" aria-label="Icon youtube from bi Iconify.design set." title="YouTube"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.heissatopia.com/"> 
<span class="menu-text"><iconify-icon inline="" icon="fa6-brands:blogger" style="font-size: 1.15em;" aria-label="Icon blogger from fa6-brands Iconify.design set." title="Blogger"></iconify-icon></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/andrewheiss" rel="me"> 
<span class="menu-text"><iconify-icon inline="" icon="bi:linkedin" style="font-size: 1.1em;" aria-label="Icon linkedin from bi Iconify.design set." title="LinkedIn"></iconify-icon></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default blog-post page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Do-calculus adventures! Exploring the three rules of do-calculus in plain language and deriving the backdoor adjustment formula by hand</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
                  <div>
        <div class="description">
          Use R to explore the three rules of <em>do</em>-calculus in plain language and derive the backdoor adjustment formula by hand
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">r</div>
                <div class="quarto-category">tidyverse</div>
                <div class="quarto-category">DAGs</div>
                <div class="quarto-category">causal inference</div>
                <div class="quarto-category">do calculus</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://www.andrewheiss.com/">Andrew Heiss</a> <a href="https://orcid.org/0000-0002-3948-3914" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">Tuesday, September 7, 2021</p>
      </div>
    </div>
    
      
      <div>
      <div class="quarto-title-meta-heading">Doi</div>
      <div class="quarto-title-meta-contents">
        <p class="doi">
          <a href="https://doi.org/10.59350/fqkhz-kq526">10.59350/fqkhz-kq526</a>
        </p>
      </div>
    </div>
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Contents</h2>
   
  <ul>
<li>
<a href="#exploring-the-rules-of-do-calculus" id="toc-exploring-the-rules-of-do-calculus" class="nav-link active" data-scroll-target="#exploring-the-rules-of-do-calculus">Exploring the rules of <em>do</em>-calculus</a>
  <ul class="collapse">
<li><a href="#rule-1-ignoring-observations" id="toc-rule-1-ignoring-observations" class="nav-link" data-scroll-target="#rule-1-ignoring-observations">Rule 1: Ignoring observations</a></li>
  <li><a href="#rule-2-treating-interventions-as-observations" id="toc-rule-2-treating-interventions-as-observations" class="nav-link" data-scroll-target="#rule-2-treating-interventions-as-observations">Rule 2: Treating interventions as observations</a></li>
  <li><a href="#rule-3-ignoring-interventions" id="toc-rule-3-ignoring-interventions" class="nav-link" data-scroll-target="#rule-3-ignoring-interventions">Rule 3: Ignoring interventions</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
</li>
  <li>
<a href="#deriving-the-backdoor-adjustment-formula-from-do-calculus-rules" id="toc-deriving-the-backdoor-adjustment-formula-from-do-calculus-rules" class="nav-link" data-scroll-target="#deriving-the-backdoor-adjustment-formula-from-do-calculus-rules">Deriving the backdoor adjustment formula from <em>do</em>-calculus rules</a>
  <ul class="collapse">
<li><a href="#marginalizing-across-z" id="toc-marginalizing-across-z" class="nav-link" data-scroll-target="#marginalizing-across-z">Marginalizing across <span class="math inline">z</span></a></li>
  <li><a href="#applying-rule-2" id="toc-applying-rule-2" class="nav-link" data-scroll-target="#applying-rule-2">Applying Rule 2</a></li>
  <li><a href="#applying-rule-3" id="toc-applying-rule-3" class="nav-link" data-scroll-target="#applying-rule-3">Applying Rule 3</a></li>
  <li><a href="#final-equation" id="toc-final-equation" class="nav-link" data-scroll-target="#final-equation">Final equation</a></li>
  </ul>
</li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></nav>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content"><p>I’ve been teaching <a href="https://evalf21.classes.andrewheiss.com/">a course on program evaluation</a> since Fall 2019, and while part of the class is focused on logic models and the more managerial aspects of evaluation, the bulk of the class is focused on causal inference. Ever since reading <a href="http://bayes.cs.ucla.edu/WHY/">Judea Pearl’s <em>The Book of Why</em></a> in 2019, I’ve thrown myself into the world of DAGs, econometrics, and general causal inference, and I’ve been both teaching it and using it in research ever since. I’ve even <a href="https://www.andrewheiss.com/research/chapters/heiss-causal-inference-2021/">published a book chapter on it</a>. Fun stuff.</p>
<p>This post assumes you have a general knowledge of DAGs and backdoor confounding. Read <a href="https://www.andrewheiss.com/blog/2020/02/25/closing-backdoors-dags/">this post</a> or <a href="https://www.andrewheiss.com/research/chapters/heiss-causal-inference-2021/">this chapter</a> if you haven’t heard about those things yet.</p>
<p>DAGs are a powerful tool for causal inference because they let you map out all your assumptions of the data generating process for some treatment and some outcome. Importantly, these causal graphs help you determine what statistical approaches you need to use to isolate or identify the causal arrow between treatment and outcome. One of the more common (and intuitive) methods for idenfifying causal effects with DAGs is to close back doors, or adjust for nodes in a DAG that open up unwanted causal associtions between treatment and control. By properly closing backdoors, you can estimate a causal quantity using observational data. There’s even a special formula called the backdoor adjustment formula that takes an equation with a <span class="math inline">\operatorname{do}(\cdot)</span> operator (a <a href="https://stats.stackexchange.com/questions/211008/dox-operator-meaning">special mathematical function</a> representing a direct experimental intervention in a graph) and allows you to estimate the effect with <em>do</em>-free quantities:</p>
<p><span class="math display">
P(y \mid \operatorname{do}(x)) = \sum_z P(y \mid x, z) \times P(z)
</span></p>
<p>When I teach this stuff, I show that formula on a slide, tell students they don’t need to worry about it too much, and then show how actually do it using regression, inverse probability weighting, and matching (<a href="https://evalf21.classes.andrewheiss.com/example/matching-ipw/">with this guide</a>). For my MPA and MPP students, the math isn’t as important as the actual application of these principles, so that’s what I focus on.</p>
<p>However—confession time—that math is also a bit of a magic black box for me too. I’ve read it in books and assume that it’s correct, but I never really fully understood why.</p>
<p>Compounding my confusion is the fact that the foundation of Judea Pearl-style DAG-based causal inference is the idea of <em>do</em>-calculus <span class="citation" data-cites="Pearl:2012">(<a href="#ref-Pearl:2012" role="doc-biblioref">Pearl 2012</a>)</span>: a set of three mathematical rules that can be applied to a causal graph to identify causal relationships. Part of my confusion stems from the fact that most textbooks and courses (including mine!) explain that you can identify causal relationships in DAGs using backdoor adjustment, frontdoor adjustment, or the fancy application of <em>do</em>-calculus rules. When framed like this, it seems like backdoor and frontdoor adjustment are separate things from <em>do</em>-calculus, and that <em>do</em>-calculus is something you do when backdoor and frontdoor adjustments don’t work.</p>
<p>But that’s not the case! In 2020, <a href="https://twitter.com/@andrewheiss">I asked Twitter</a> if backdoor and frontdoor adjustment were connected to <em>do</em>-calculus, and surprisingly <a href="https://twitter.com/yudapearl/status/1252462516468240390">Judea Pearl himself answered</a> that they are!</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="pearl-tweet.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p>They’re both specific consequences of the application of the rules of <em>do</em>-calculus—they just have special names because they’re easy to see in a graph.</p>
<p>But how? How do people apply these strange rules of <em>do</em>-calculus to derive these magical backdoor and frontdoor adjustment formulas? The question has haunted me since April 2020.</p>
<p>But in the past couple days, I’ve stumbled across a couple excellent resources (<a href="https://www.bradyneal.com/causal-inference-course">this course</a> and <a href="https://www.youtube.com/playlist?list=PLoazKTcS0Rzb6bb9L508cyJ1z-U9iWkA0">these videos</a> + <a href="https://stephenmalina.com/post/2020-03-09-front-door-do-calc-derivation/">this blog post</a>) that explained <em>do</em>-calculus really well, so I figured I’d finally tackle this question and figure out how exactly <em>do</em>-calculus is used to derive the backdoor adjustment formula. I won’t show the derivation of the frontdoor formula—smarter people than me have done that (<a href="https://stephenmalina.com/post/2020-03-09-front-door-do-calc-derivation/">here</a> and <a href="https://www.bradyneal.com/Introduction_to_Causal_Inference-Dec17_2020-Neal.pdf">Section 6.2.1 here</a>, for instance), but I can do the backdoor one now!</p>
<p>First, I’ll explain and illustrate how each of the three rules of <em>do</em>-calculus as plain-language-y as possible, and then I’ll apply those rules to show how the backdoor adjustment formula is created.</p>
<p>I use the <strong>ggdag</strong> and <strong>dagitty</strong> packages in R for all this, so you can follow along too. Here we go!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>  <span class="co"># For ggplot2 and friends</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span>  <span class="co"># For combining plots</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-causal/ggdag">ggdag</a></span><span class="op">)</span>      <span class="co"># For making DAGs with ggplot</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.dagitty.net">dagitty</a></span><span class="op">)</span>    <span class="co"># For dealing with DAG math</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stefanom.io/latex2exp/">latex2exp</a></span><span class="op">)</span>  <span class="co"># Easily convert LaTeX into arcane plotmath expressions</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/ggtext/">ggtext</a></span><span class="op">)</span>     <span class="co"># Use markdown in ggplot labels</span></span>
<span></span>
<span><span class="co"># Create a cleaner serifed theme to use throughout</span></span>
<span><span class="va">theme_do_calc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">theme_dag</span><span class="op">(</span>base_family <span class="op">=</span> <span class="st">"Linux Libertine O"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fu">rel</span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        plot.subtitle <span class="op">=</span> <span class="fu">element_markdown</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Make all geom_dag_text() layers use these settings automatically</span></span>
<span><span class="fu">update_geom_defaults</span><span class="op">(</span><span class="fu">ggdag</span><span class="fu">:::</span><span class="va">GeomDagText</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Linux Libertine O"</span>, </span>
<span>                                               fontface <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>                                               color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exploring-the-rules-of-do-calculus" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="exploring-the-rules-of-do-calculus">Exploring the rules of <em>do</em>-calculus</h2>
<p>The three rules of <em>do</em>-calculus have always been confusing to me since they are typically written as pure math equations and not in plain understandable language. For instance, <a href="https://ftp.cs.ucla.edu/pub/stat_ser/r402.pdf">here’s Judea Pearl’s canonical primer on <em>do</em>-calculus</a>—a short PDF with lots of math and proofs <span class="citation" data-cites="Pearl:2012">(<a href="#ref-Pearl:2012" role="doc-biblioref">Pearl 2012</a>)</span>. In basically everything I’ve read about <em>do</em>-calculus, there’s inevitably a listing of these three very mathy rules, written for people much smarter than me:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p><img src="do-calculus-math.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="margin-caption">From left to right: <span class="citation" data-cites="LattimoreRohde:2019">Lattimore and Rohde (<a href="#ref-LattimoreRohde:2019" role="doc-biblioref">2019</a>)</span>, <a href="https://plato.stanford.edu/entries/causal-models/do-calculus.html">The Stanford Encyclopedia of Philosophy</a>, <span class="citation" data-cites="Pearl:2012">Pearl (<a href="#ref-Pearl:2012" role="doc-biblioref">2012</a>)</span>, <span class="citation" data-cites="Neal:2020">Neal (<a href="#ref-Neal:2020" role="doc-biblioref">2020</a>)</span></figcaption></figure>
</div>
</div>
</div>
<p>However, beneath this scary math, each rule has specific intuition and purpose behind it—I just didn’t understand the plain-language reasons for each rule until reading <a href="https://stephenmalina.com/post/2020-03-09-front-door-do-calc-derivation/">this really neat blog post</a>. Here’s what each rule actually does:</p>
<ul>
<li>
<strong>Rule 1</strong>: Decide if we can ignore an observation</li>
<li>
<strong>Rule 2</strong>: Decide if we can treat an intervention as an observation</li>
<li>
<strong>Rule 3</strong>: Decide if we can ignore an intervention</li>
</ul>
<p>Whoa! That’s exceptionally logical. Each rule is designed to help simplify and reduce nodes in a DAG by either ignoring them (Rules 1 and 3) or making it so interventions like <span class="math inline">\operatorname{do}(\cdot)</span> can be treated like observations instead (Rule 2).</p>
<p>Let’s explore each of these rules in detail. In all these situations, we’re assuming that there’s a DAG with 4 nodes: W, X, Y, and Z. Y is always the outcome; X is always the main treatment. In each rule, our goal is to get rid of Z by applying the rule. When talking about interventions in a graph, there’s a special notation with overlines and underlines:</p>
<ul>
<li>An overline like <span class="math inline">G_{\overline{X}}</span> means that you delete all the arrows <em>going into</em> X</li>
<li>An underline like <span class="math inline">G_{\underline{X}}</span> means that you delete all the arrows <em>coming out of</em> X</li>
</ul>
<p>I imagine this line like a wall:</p>
<ul>
<li>If the wall is on top of X like <span class="math inline">\overline{X}</span>, you can’t draw any arrows going into it, so you delete anything going in</li>
<li>If the wall is on the bottom of X like <span class="math inline">\underline{X}</span>, you can’t draw any arrows going out of it, so you delete anything going out</li>
</ul>
<section id="rule-1-ignoring-observations" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="rule-1-ignoring-observations">Rule 1: Ignoring observations</h3>
<p>According to Rule 1, we can ignore any observational node if it doesn’t influence the outcome through any path, or if it is d-separated from the outcome. Here’s the formal definition:</p>
<p><span class="math display">
P(y \mid z, \operatorname{do}(x), w) = P(y \mid \operatorname{do}(x), w) \qquad \text{ if } (Y \perp Z \mid W, X)_{G_{\overline{X}}}
</span></p>
<p>There are a lot of moving parts here, but remember, the focus in this equation is <span class="math inline">z</span>. Our goal here is to remove or ignore <span class="math inline">z</span>. Notice how <span class="math inline">z</span> exists on the left-hand side of the equation and how it is gone on the right-hand side. As long as we meet the cryptic conditions of <span class="math inline">(Y \perp Z \mid W, X)_{G_{\overline{X}}}</span>, we can get rid of it. But what the heck does that even mean?</p>
<p>Here, <span class="math inline">G_{\overline{X}}</span> means “the original causal graph with all arrows into X removed”, while the <span class="math inline">Y \perp Z \mid W, X</span> part means “Y is independent of Z, given W and X” in the new modified graph. If the Y and Z nodes are d-separated from each other after we account for both W and X, we can get rid of Z and ignore it.</p>
<p>Let’s look at this graphically to help make better sense of this. We’ll use the <code>dagify()</code> function from <strong>ggdag</strong> to build a couple DAGs: one complete one (<span class="math inline">G</span>) and one with all the arrows into X deleted (<span class="math inline">G_{\overline{X}}</span>). X causes both X and Y, while W confounds X, Y, and Z.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rule1_g</span> <span class="op">&lt;-</span> <span class="fu">dagify</span><span class="op">(</span></span>
<span>  <span class="va">Y</span> <span class="op">~</span> <span class="va">X</span> <span class="op">+</span> <span class="va">W</span>,</span>
<span>  <span class="va">X</span> <span class="op">~</span> <span class="va">W</span>,</span>
<span>  <span class="va">Z</span> <span class="op">~</span> <span class="va">X</span> <span class="op">+</span> <span class="va">W</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span>, Y <span class="op">=</span> <span class="fl">2</span>, Z <span class="op">=</span> <span class="fl">1.25</span>, W <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span>, Y <span class="op">=</span> <span class="fl">1</span>, Z <span class="op">=</span> <span class="fl">2</span>, W <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">rule1_g_x_over</span> <span class="op">&lt;-</span> <span class="fu">dagify</span><span class="op">(</span></span>
<span>  <span class="va">Y</span> <span class="op">~</span> <span class="va">X</span> <span class="op">+</span> <span class="va">W</span>,</span>
<span>  <span class="va">Z</span> <span class="op">~</span> <span class="va">X</span> <span class="op">+</span> <span class="va">W</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span>, Y <span class="op">=</span> <span class="fl">2</span>, Z <span class="op">=</span> <span class="fl">1.25</span>, W <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span>, Y <span class="op">=</span> <span class="fl">1</span>, Z <span class="op">=</span> <span class="fl">2</span>, W <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plot_rule1_g</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">rule1_g</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                                    xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_edges</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey80"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_text</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="fu">TeX</span><span class="op">(</span><span class="st">"$G$"</span><span class="op">)</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Original DAG"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_do_calc</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_rule1_g_x_over</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">rule1_g_x_over</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                                                  xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_edges</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey80"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_text</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="fu">TeX</span><span class="op">(</span><span class="st">"$G_{\\bar{X}}$"</span><span class="op">)</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"DAG with arrows *into* X deleted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_do_calc</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_rule1_g</span> <span class="op">|</span> <span class="va">plot_rule1_g_x_over</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p class="page-columns page-full"><img src="index_files/figure-html/plot-rule1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-page-inset-right" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>If we want to calculate the causal effect of X on Y, do we need to worry about Z here, or can we ignore it? Let’s apply Rule 1. If we look at the modified <span class="math inline">G_{\overline{X}}</span>, Y and Z are completely d-separated if we account for both W and X—there’s no direct arrow between them, and there’s no active path connecting them through W or X, since we’re accounting for (or condition on) those nodes. Y and Z are thus d-separated and <span class="math inline">Y \perp Z \mid W, X</span>. We can confirm this with the <code>impliedConditionalIndependencies()</code> function from the <strong>dagitty</strong> package:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">impliedConditionalIndependencies</span><span class="op">(</span><span class="va">rule1_g_x_over</span><span class="op">)</span></span>
<span><span class="co">## W _||_ X</span></span>
<span><span class="co">## Y _||_ Z | W, X</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And there it is! The second independency there is <span class="math inline">Y \perp Z \mid W, X</span>. That means that we can apply Rule 1 and ignore Z, meaning that</p>
<p><span class="math display">
P(y \mid z, \operatorname{do}(x), w) = P(y \mid \operatorname{do}(x), w)
</span></p>
<p>This makes sense but is a little too complicated for me, since we’re working with four different nodes. We can simplify this and pretend that <span class="math inline">\operatorname{do}(x)</span> is nothing and that X doesn’t exist. That leaves us with just three nodes—W, Y, and Z—and this DAG:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rule1_g_simple</span> <span class="op">&lt;-</span> <span class="fu">dagify</span><span class="op">(</span></span>
<span>  <span class="va">Y</span> <span class="op">~</span> <span class="va">W</span>,</span>
<span>  <span class="va">Z</span> <span class="op">~</span> <span class="va">W</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fl">2</span>, Z <span class="op">=</span> <span class="fl">1</span>, W <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fl">1</span>, Z <span class="op">=</span> <span class="fl">1</span>, W <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_rule1_g_simple</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">rule1_g_simple</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                                                  xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_edges</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey80"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_text</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="fu">TeX</span><span class="op">(</span><span class="st">"$G$"</span><span class="op">)</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Simplified DAG without X"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_do_calc</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">plot_rule1_g_simple</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/plot-rule1-simple-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%"></p>
</figure>
</div>
</div>
</div>
<p>The simplified X-free version of Rule 1 looks like this:</p>
<p><span class="math display">
P(y \mid z, w) = P(y \mid w) \qquad \text{ if } (Y \perp Z \mid W)_{G}
</span></p>
<p>In other words, we can ignore Z and remove it from the <span class="math inline">P(y \mid z, w)</span> equation if Y and Z are d-separated (or independent of each other) after accounting for W. Once we account for W, there’s no possible connection between Y and Z, so they really are d-separated. We can again confirm this with code:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">impliedConditionalIndependencies</span><span class="op">(</span><span class="va">rule1_g_simple</span><span class="op">)</span></span>
<span><span class="co">## Y _||_ Z | W</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There we go. Because <span class="math inline">Y \perp Z \mid W</span> we can safely ignore Z.</p>
</section><section id="rule-2-treating-interventions-as-observations" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="rule-2-treating-interventions-as-observations">Rule 2: Treating interventions as observations</h3>
<p>Rule 1 is neat, but it has nothing to do with causal interventions or the <span class="math inline">\operatorname{do}(\cdot)</span> operator. It feels more like a housekeeping rule—it’s a way of simplifying and removing unnecessary nodes that don’t have to do with the main treatment → outcome relationship.</p>
<p>With Rule 2, we start messing with interventions. In an experiment like a randomized controlled trial, a researcher has the ability to assign treatment and either <span class="math inline">\operatorname{do}(x)</span> or not <span class="math inline">\operatorname{do}(x)</span>. With observational data, though, it’s not possible to <span class="math inline">\operatorname{do}(x)</span> directly. It would be fantastic if we could take an intervention like <span class="math inline">\operatorname{do}(x)</span> and treat it like regular non-interventional observational data. Rule 2 lets us do this.</p>
<p>According to Rule 2, interventions (or <span class="math inline">do(x)</span>) can be treated as observations (or <span class="math inline">x</span>) when the causal effect of a variable on the outcome (<span class="math inline">X \rightarrow Y</span>) only influences the outcome through directed paths. The official math for this is this complicated thing:</p>
<p><span class="math display">
P(y \mid \operatorname{do}(z), \operatorname{do}(x), w) = P(y \mid z, \operatorname{do}(x), w) \qquad \text{ if } (Y \perp Z \mid W, X)_{G_{\overline{X}, \underline{Z}}}
</span></p>
<p>For me, this is super confusing, since there are two different <span class="math inline">\operatorname{do}(\cdot)</span> operators here and when I think of causal graphs, I think of single interventions. Like we did with Rule 1, we can simplify this and pretend that there’s no intervention <span class="math inline">\operatorname{do}(x)</span> (we’ll do the full rule in a minute, don’t worry). Again, this is legal because each of these rules are focused on messing with the Z variable: ignoring it or treating it as an observation. That leaves us with this slightly simpler (though still cryptic) equation:</p>
<p><span class="math display">
P(y \mid \operatorname{do}(z), w) = P(y \mid z, w) \qquad \text{ if } (Y \perp Z \mid W)_{G_{\underline{Z}}}
</span></p>
<p>Notice how the left-hand side has the interventional <span class="math inline">\operatorname{do}(z)</span>, while the right-hand side has the observed <span class="math inline">z</span>. As long as we meet the condition <span class="math inline">(Y \perp Z \mid W)_{G_{\underline{Z}}}</span>, we can transform <span class="math inline">\operatorname{do}(z)</span> into <span class="math inline">z</span> and work only with observational data. Once again, though, what does this <span class="math inline">(Y \perp Z \mid W)_{G_{\underline{Z}}}</span> condition even mean?</p>
<p>Here, <span class="math inline">G_{\underline{Z}}</span> means “the original causal graph with all arrows out of Z removed”, while the <span class="math inline">Y \perp Z \mid W</span> part means “Y is independent of Z, given W” in the new modified graph. Similar to Rule 1, if the Y and Z nodes are d-separated from each other after we account for W, we can legally treat <span class="math inline">\operatorname{do}(z)</span> like <span class="math inline">z</span>.</p>
<p>As we did with Rule 1, we’ll build a couple basic DAGs: a complete one (<span class="math inline">G</span>) and one with all the arrows <em>out of</em> Z deleted (<span class="math inline">G_{\underline{Z}}</span>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rule2_g_simple</span> <span class="op">&lt;-</span> <span class="fu">dagify</span><span class="op">(</span></span>
<span>  <span class="va">Y</span> <span class="op">~</span> <span class="va">Z</span> <span class="op">+</span> <span class="va">W</span>,</span>
<span>  <span class="va">Z</span> <span class="op">~</span> <span class="va">W</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fl">2</span>, Z <span class="op">=</span> <span class="fl">1</span>, W <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fl">1</span>, Z <span class="op">=</span> <span class="fl">1</span>, W <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">rule2_g_simple_z_under</span> <span class="op">&lt;-</span> <span class="fu">dagify</span><span class="op">(</span></span>
<span>  <span class="va">Y</span> <span class="op">~</span> <span class="va">W</span>,</span>
<span>  <span class="va">Z</span> <span class="op">~</span> <span class="va">W</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fl">2</span>, Z <span class="op">=</span> <span class="fl">1</span>, W <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fl">1</span>, Z <span class="op">=</span> <span class="fl">1</span>, W <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plot_rule2_g_simple</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">rule2_g_simple</span>, </span>
<span>                              <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                                  xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_edges</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey80"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_text</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="fu">TeX</span><span class="op">(</span><span class="st">"$G$"</span><span class="op">)</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Original DAG"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_do_calc</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_rule2_g_simple_z_under</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">rule2_g_simple_z_under</span>, </span>
<span>                                      <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                                          xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_edges</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey80"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_text</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="fu">TeX</span><span class="op">(</span><span class="st">"$G_{\\underline{Z}}$"</span><span class="op">)</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"DAG with arrows *out of* Z deleted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_do_calc</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_rule2_g_simple</span> <span class="op">|</span> <span class="va">plot_rule2_g_simple_z_under</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p class="page-columns page-full"><img src="index_files/figure-html/plot-rule2-simple-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-page-inset-right" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>So, can we treat Z here like an observational node instead of a interventional <span class="math inline">\operatorname{do}(\cdot)</span> node? Let’s apply Rule 2. If we look at the modified <span class="math inline">G_{\underline{Z}}</span> graph, Z and Y are completely d-separated if we account for W—there’s no direct arrow between them, and there’s no active path connecting them through W since we’re conditioning on W. We can thus say that <span class="math inline">Y \perp Z \mid W</span>. We can confirm this with code too:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">impliedConditionalIndependencies</span><span class="op">(</span><span class="va">rule2_g_simple_z_under</span><span class="op">)</span></span>
<span><span class="co">## Y _||_ Z | W</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Woohoo! Because <span class="math inline">Y \perp Z \mid W</span> in that modified <span class="math inline">G_{\underline{Z}}</span> graph, we can legally convert the interventional <span class="math inline">\operatorname{do}(z)</span> to just a regular old observational <span class="math inline">z</span>:</p>
<p><span class="math display">
P(y \mid \operatorname{do}(z), w) = P(y \mid z, w)
</span></p>
<p>So far we’ve applied Rule 2 to a simplified DAG with three nodes, but what does it look like if we’re using the full four-node graph that is used in the formal definition of Rule 2?</p>
<p><span class="math display">
P(y \mid \operatorname{do}(z), \operatorname{do}(x), w) = P(y \mid z, \operatorname{do}(x), w) \qquad \text{ if } (Y \perp Z \mid W, X)_{G_{\overline{X}, \underline{Z}}}
</span></p>
<p>Here’s one graphical representation of a graph with the four nodes W, X, Y, and Z (but it’s definitely not the only possible graph! These <em>do</em>-calculus rules don’t assume any specific relationships between the nodes). Here, Y is caused by both X and Z, and we’ll pretend that they’re both interventions (so <span class="math inline">\operatorname{do}(x)</span> and <span class="math inline">\operatorname{do}(z)</span>). X is causally linked to Z, and W confounds all three: X, Y, and Z. Graph <span class="math inline">G</span> shows the complete DAG; Graph <span class="math inline">G_{\overline{X}, \underline{Z}}</span> shows a modified DAG with all arrows <em>into</em> X deleted (<span class="math inline">\overline{X}</span>) and all arrows <em>out of</em> Z deleted (<span class="math inline">\underline{Z}</span>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rule2_g</span> <span class="op">&lt;-</span> <span class="fu">dagify</span><span class="op">(</span></span>
<span>  <span class="va">Y</span> <span class="op">~</span> <span class="va">X</span> <span class="op">+</span> <span class="va">W</span> <span class="op">+</span> <span class="va">Z</span>,</span>
<span>  <span class="va">X</span> <span class="op">~</span> <span class="va">W</span>,</span>
<span>  <span class="va">Z</span> <span class="op">~</span> <span class="va">X</span> <span class="op">+</span> <span class="va">W</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span>, Y <span class="op">=</span> <span class="fl">2</span>, Z <span class="op">=</span> <span class="fl">1.25</span>, W <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span>, Y <span class="op">=</span> <span class="fl">1</span>, Z <span class="op">=</span> <span class="fl">2</span>, W <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">rule2_g_modified</span> <span class="op">&lt;-</span> <span class="fu">dagify</span><span class="op">(</span></span>
<span>  <span class="va">Y</span> <span class="op">~</span> <span class="va">X</span> <span class="op">+</span> <span class="va">W</span>,</span>
<span>  <span class="va">Z</span> <span class="op">~</span> <span class="va">X</span> <span class="op">+</span> <span class="va">W</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span>, Y <span class="op">=</span> <span class="fl">2</span>, Z <span class="op">=</span> <span class="fl">1.25</span>, W <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span>, Y <span class="op">=</span> <span class="fl">1</span>, Z <span class="op">=</span> <span class="fl">2</span>, W <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plot_rule2_g</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">rule2_g</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                                    xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_edges</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey80"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_text</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="fu">TeX</span><span class="op">(</span><span class="st">"$G$"</span><span class="op">)</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Original DAG"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_do_calc</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_rule2_modified</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">rule2_g_modified</span>, </span>
<span>                              <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                                  xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_edges</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey80"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_text</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="fu">TeX</span><span class="op">(</span><span class="st">"$G_{\\bar{X}, \\underline{Z}}$"</span><span class="op">)</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"DAG with arrows *into* X and *out of* Z deleted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_do_calc</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_rule2_g</span> <span class="op">|</span> <span class="va">plot_rule2_modified</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p class="page-columns page-full"><img src="index_files/figure-html/plot-rule2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-page-inset-right" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Okay. Our goal here is to check if we can treat <span class="math inline">\operatorname{do}(z)</span> like a regular observational <span class="math inline">z</span>. We can legally do this if Y and Z are d-separated in that modified graph, after accounting for both W and X, or <span class="math inline">Y \perp Z \mid W, X</span>. And that is indeed the case! There’s no direct arrow connecting Y and Z in the modified graph, and once we condition on (or account for) W and X, no pathways between Y and Z are active—Y and Z are independent and d-separated. We can confirm this with code:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">impliedConditionalIndependencies</span><span class="op">(</span><span class="va">rule2_g_modified</span><span class="op">)</span></span>
<span><span class="co">## W _||_ X</span></span>
<span><span class="co">## Y _||_ Z | W, X</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The second independency there is that <span class="math inline">Y \perp Z \mid W, X</span>, which is exactly what we want to see. We can thus legally transform <span class="math inline">\operatorname{do}(z)</span> to <span class="math inline">z</span>:</p>
<p><span class="math display">
P(y \mid \operatorname{do}(z), \operatorname{do}(x), w) = P(y \mid z, \operatorname{do}(x), w)
</span></p>
<p>What’s really neat is that Rule 2 is a generalized version of the backdoor criterion. More on that below after we explore Rule 3.</p>
</section><section id="rule-3-ignoring-interventions" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="rule-3-ignoring-interventions">Rule 3: Ignoring interventions</h3>
<p>Rule 3 is the trickiest of the three, conceptually. It tells us when we can completely remove a <span class="math inline">\operatorname{do}(\cdot)</span> expression rather than converting it to an observed quantity. Here it is in all its mathy glory:</p>
<p><span class="math display">
P(y \mid \operatorname{do}(z), \operatorname{do}(x), w) = P(y \mid \operatorname{do}(x), w) \qquad \text{ if } (Y \perp Z \mid W, X)_{G_{\overline{X}, \overline{Z(W)}}}
</span></p>
<p>In simpler language, this means that we can ignore an intervention (or a <span class="math inline">\operatorname{do}(\cdot)</span> expression) if it doesn’t influence the outcome through any uncontrolled path—we can remove <span class="math inline">\operatorname{do}(z)</span> if there is no causal association (or no unblocked causal paths) flowing from Z to Y.</p>
<p>This rule is tricky, though, because it depends on where the Z node (i.e.&nbsp;the intervention we want to get rid of) appears in the graph. Note the notation for the modified graph here. With the other rules, we used things like <span class="math inline">G_{\overline{X}}</span> or <span class="math inline">G_{\underline{Z}}</span> to remove arrows into and out of specific nodes in the modified graph. Here, though, we have the strange <span class="math inline">G_{\overline{Z(W)}}</span>. This Z(W) is weird! It means “any Z node that isn’t an ancestor of W”. We thus only delete arrows going into a Z node in the modified graph if that Z node doesn’t precede W.</p>
<p>Here’s one version of what that could look like graphically:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rule3_g</span> <span class="op">&lt;-</span> <span class="fu">dagify</span><span class="op">(</span></span>
<span>  <span class="va">Y</span> <span class="op">~</span> <span class="va">X</span> <span class="op">+</span> <span class="va">W</span>,</span>
<span>  <span class="va">W</span> <span class="op">~</span> <span class="va">Z</span>,</span>
<span>  <span class="va">Z</span> <span class="op">~</span> <span class="va">X</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span>, Y <span class="op">=</span> <span class="fl">2</span>, Z <span class="op">=</span> <span class="fl">1.25</span>, W <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span>, Y <span class="op">=</span> <span class="fl">1</span>, Z <span class="op">=</span> <span class="fl">2</span>, W <span class="op">=</span> <span class="fl">1.75</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plot_rule3_g</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">rule3_g</span>, </span>
<span>                       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                           xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_edges</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey80"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_text</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="fu">TeX</span><span class="op">(</span><span class="st">"$G$"</span><span class="op">)</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Original DAG"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_do_calc</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_rule3_g_modified</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">rule3_g</span>, </span>
<span>                                <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                                    xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_edges</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey80"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_text</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="fu">TeX</span><span class="op">(</span><span class="st">"$G_{\\bar{X}, \\bar{Z(W)}}$"</span><span class="op">)</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"DAG with arrows *into* Z deleted as long as Z isn't an&lt;br&gt;ancestor of W + all arrows *into* X deleted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_do_calc</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_rule3_g</span> <span class="op">|</span> <span class="va">plot_rule3_g_modified</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p class="page-columns page-full"><img src="index_files/figure-html/plot-rule3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-page-inset-right" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Notice how these two graphs are identical. Because we only delete arrows going into Z if Z is not an ancestor of W, in this case <span class="math inline">G = G_{\overline{X}, \overline{Z(W)}}</span>.</p>
<p>Remember that our original goal is to get rid of <span class="math inline">\operatorname{do}(z)</span>, which we can legally do if Y and Z are d-separated and independent in our modified graph, or if <span class="math inline">Y \perp Z \mid W, X</span>. That is once again indeed the case here: there’s no direct arrow between Y and Z, and if we condition on W and X, there’s no way to pass association between Y and Z, meaning that Y and Z are d-separated. Let’s confirm it with code:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">impliedConditionalIndependencies</span><span class="op">(</span><span class="va">rule3_g</span><span class="op">)</span></span>
<span><span class="co">## W _||_ X | Z</span></span>
<span><span class="co">## Y _||_ Z | W, X</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That second independency is our <span class="math inline">Y \perp Z \mid W, X</span>, so we can safely eliminate <span class="math inline">\operatorname{do}(z)</span> from the equation. We can ignore it because it doesn’t influence the outcome <span class="math inline">Y</span> through any possible path. Goodbye <span class="math inline">\operatorname{do}(z)</span>!:</p>
<p><span class="math display">
P(y \mid \operatorname{do}(z), \operatorname{do}(x), w) = P(y \mid \operatorname{do}(x), w)
</span></p>
<p>In this case, the alternative graph <span class="math inline">G_{\overline{X}, \overline{Z(W)}}</span> was the same as the original graph because of the location of Z—Z was an ancestor of W, so we didn’t delete any arrows. If Z is <em>not</em> an ancestor, though, we get to actually modify the graph. For instance, consider this DAG:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rule3_g_alt</span> <span class="op">&lt;-</span> <span class="fu">dagify</span><span class="op">(</span></span>
<span>  <span class="va">Y</span> <span class="op">~</span> <span class="va">X</span> <span class="op">+</span> <span class="va">W</span>,</span>
<span>  <span class="va">Z</span> <span class="op">~</span> <span class="va">W</span>,</span>
<span>  <span class="va">X</span> <span class="op">~</span> <span class="va">Z</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span>, Y <span class="op">=</span> <span class="fl">2</span>, Z <span class="op">=</span> <span class="fl">1.25</span>, W <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span>, Y <span class="op">=</span> <span class="fl">1</span>, Z <span class="op">=</span> <span class="fl">2</span>, W <span class="op">=</span> <span class="fl">1.75</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">rule3_g_alt_modified</span> <span class="op">&lt;-</span> <span class="fu">dagify</span><span class="op">(</span></span>
<span>  <span class="va">Y</span> <span class="op">~</span> <span class="va">X</span> <span class="op">+</span> <span class="va">W</span>,</span>
<span>  <span class="va">Z</span> <span class="op">~</span> <span class="fl">0</span>,</span>
<span>  <span class="va">X</span> <span class="op">~</span> <span class="fl">0</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span>, Y <span class="op">=</span> <span class="fl">2</span>, Z <span class="op">=</span> <span class="fl">1.25</span>, W <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span>, Y <span class="op">=</span> <span class="fl">1</span>, Z <span class="op">=</span> <span class="fl">2</span>, W <span class="op">=</span> <span class="fl">1.75</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plot_rule3_g_alt</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">rule3_g_alt</span>, </span>
<span>                           <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                               xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_edges</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey80"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_text</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="fu">TeX</span><span class="op">(</span><span class="st">"$G$"</span><span class="op">)</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Original DAG"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_do_calc</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_rule3_g_alt_modified</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">rule3_g_alt_modified</span>, </span>
<span>                                    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                                        xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_edges</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey80"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_text</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="fu">TeX</span><span class="op">(</span><span class="st">"$G_{\\bar{X}, \\bar{Z(W)}}$"</span><span class="op">)</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"DAG with arrows *into* Z deleted as long as Z isn't an&lt;br&gt;ancestor of W + all arrows *into* X deleted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_do_calc</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_rule3_g_alt</span> <span class="op">|</span> <span class="va">plot_rule3_g_alt_modified</span></span>
<span><span class="co">## Warning: Removed 1 rows containing missing values (`geom_dag_point()`).</span></span>
<span><span class="co">## Warning: Removed 1 rows containing missing values (`geom_dag_text()`).</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p class="page-columns page-full"><img src="index_files/figure-html/plot-rule3-alt-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-page-inset-right" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Phew. In this case, our DAG surgery for making the modified graph <span class="math inline">G_{\overline{X}, \overline{Z(W)}}</span> actually ended up completely d-separating Z from all nodes. Because Z isn’t an ancestor of W (but is instead a descendant), we get to delete arrows going into it, and we get to delete arrows going into X as well. We can remove <span class="math inline">\operatorname{do}(z)</span> from the equation as long as <span class="math inline">Y \perp Z \mid W, X</span> in this modified graph. That is most definitely the case here. And once again, code confirms it (ignore the 0s here—they’re only there so that the DAG plots correctly):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">impliedConditionalIndependencies</span><span class="op">(</span><span class="va">rule3_g_alt_modified</span><span class="op">)</span></span>
<span><span class="co">## 0 _||_ W</span></span>
<span><span class="co">## 0 _||_ Y | X</span></span>
<span><span class="co">## W _||_ X</span></span>
<span><span class="co">## W _||_ Z</span></span>
<span><span class="co">## X _||_ Z | 0</span></span>
<span><span class="co">## Y _||_ Z | 0</span></span>
<span><span class="co">## Y _||_ Z | X</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And once again, we can legally get rid of <span class="math inline">\operatorname{do}(z)</span>:</p>
<p><span class="math display">
P(y \mid \operatorname{do}(z), \operatorname{do}(x), w) = P(y \mid \operatorname{do}(x), w)
</span></p>
</section><section id="summary" class="level3"><h3 class="anchored" data-anchor-id="summary">Summary</h3>
<p>Phew. Let’s look back at the three main rules and add their corresponding mathy versions, which should make more sense now:</p>
<ul>
<li>
<p><strong>Rule 1</strong>: Decide if we can ignore an observation</p>
<p><span class="math display">
P(y \mid z, \operatorname{do}(x), w) = P(y \mid \operatorname{do}(x), w) \qquad \text{ if } (Y \perp Z \mid W, X)_{G_{\overline{X}}}
</span></p>
</li>
<li>
<p><strong>Rule 2</strong>: Decide if we can treat an intervention as an observation</p>
<p><span class="math display">
P(y \mid \operatorname{do}(z), \operatorname{do}(x), w) = P(y \mid z, \operatorname{do}(x), w) \qquad \text{ if } (Y \perp Z \mid W, X)_{G_{\overline{X}, \underline{Z}}}
</span></p>
</li>
<li>
<p><strong>Rule 3</strong>: Decide if we can ignore an intervention</p>
<p><span class="math display">
P(y \mid \operatorname{do}(z), \operatorname{do}(x), w) = P(y \mid \operatorname{do}(x), w) \qquad \text{ if } (Y \perp Z \mid W, X)_{G_{\overline{X}, \overline{Z(W)}}}
</span></p>
</li>
</ul></section></section><section id="deriving-the-backdoor-adjustment-formula-from-do-calculus-rules" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="deriving-the-backdoor-adjustment-formula-from-do-calculus-rules">Deriving the backdoor adjustment formula from <em>do</em>-calculus rules</h2>
<p>That was a lot of math, but hopefully each of these <em>do</em>-calculus rules make sense in isolation now. Now that I finally understand what each of these are doing, we can apply these rules to see where the pre-derived / canned backdoor adjustment formula comes from. Somehow by applying these rules, we can transform the left-hand side of this formula into the <em>do</em>-free right-hand side:</p>
<p><span class="math display">
P(y \mid \operatorname{do}(x)) = \sum_z P(y \mid x, z) \times P(z)
</span></p>
<p>Let’s go through the derivation of the backdoor adjustment formula step-by-step to see how it works. We’ll use this super simple DAG that shows the causal effect of treatment X on outcome Y, confounded by Z:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">backdoor_g</span> <span class="op">&lt;-</span> <span class="fu">dagify</span><span class="op">(</span></span>
<span>  <span class="va">Y</span> <span class="op">~</span> <span class="va">X</span> <span class="op">+</span> <span class="va">Z</span>,</span>
<span>  <span class="va">X</span> <span class="op">~</span> <span class="va">Z</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fl">2</span>, X <span class="op">=</span> <span class="fl">1</span>, Z <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fl">1</span>, X <span class="op">=</span> <span class="fl">1</span>, Z <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_backdoor_g</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">backdoor_g</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                                          xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_edges</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey80"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_text</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="fu">TeX</span><span class="op">(</span><span class="st">"$G$"</span><span class="op">)</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Basic backdoor confounding"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_do_calc</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">plot_backdoor_g</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="index_files/figure-html/basic-backdoor-dag-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%"></p>
</figure>
</div>
</div>
</div>
<section id="marginalizing-across-z" class="level3"><h3 class="anchored" data-anchor-id="marginalizing-across-z">Marginalizing across <span class="math inline">z</span>
</h3>
<p>We’re interested in the causal effect of X on Y, or <span class="math inline">P(y \mid \operatorname{do}(x))</span>. If this were an experiment like a randomized controlled trial, we’d be able to delete all arrows going into X, which would remove all confounding from Z and allow us to measure the exact causal effect of X on Y. However, with observational data, we can’t delete arrows like that. But, we can condition the X → Y relationship on Z, given that it influences both X and Y.</p>
<p>We thus need to calculate the joint probability of <span class="math inline">P(y \mid \operatorname{do}(x))</span> across all values of Z. Using the rules of <a href="https://en.wikipedia.org/wiki/Marginal_distribution">probability marginalization</a> and <a href="https://en.wikipedia.org/wiki/Chain_rule_(probability)">the chain rule for joint probabilities</a>, we can write this joint probability like so:</p>
<p><span class="math display">
P(y \mid \operatorname{do}(x)) = \sum_z P(y \mid \operatorname{do}(x), z) \times P(z \mid \operatorname{do}(x))
</span></p>
<p>The right-hand side of that equation is what we want to be able to estimate using only observational data, but right now it has two <span class="math inline">\operatorname{do}(\cdot)</span> operators in it, marked in <span style="color:#FF4136;">red</span> and <span style="color:#B10DC9;">purple</span>:</p>
<p><span class="math display">
\sum_z P(y \mid {\color{#FF4136} \operatorname{do}(x)}, z) \times P(z \mid {\color{#B10DC9} \operatorname{do}(x)})
</span></p>
<p>We need to get rid of those.</p>
</section><section id="applying-rule-2" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="applying-rule-2">Applying Rule 2</h3>
<p>First let’s get rid of the <span style="color:#FF4136;">red</span> <span class="math inline">\color{#FF4136} \operatorname{do}(x)</span> that’s in <span class="math inline">P(y \mid {\color{#FF4136} \operatorname{do}(x)}, z)</span>. This chunk of the equation involves all three variables: treatment, outcome, and confounder. Accordingly, we don’t really want to ignore any of these variables by using something like Rule 1 or Rule 3. Instead, we can try to treat that <span class="math inline">\color{#FF4136} \operatorname{do}(x)</span> as an observational <span class="math inline">\color{#FF4136} x</span> using Rule 2.</p>
<p>According to Rule 2, we can treat an interventional <span class="math inline">\operatorname{do}(\cdot)</span> operator as observational if we meet specific criteria in a modified graph where we remove all arrows out of X:</p>
<p><span class="math display">
P(y \mid {\color{#FF4136} \operatorname{do}(x)}, z) = P(y \mid {\color{#FF4136} x}, z) \qquad \text{ if } (Y \perp X \mid Z)_{G_{\underline{X}}}
</span></p>
<p>Here’s the modified <span class="math inline">G_{\underline{X}}</span> graph:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">backdoor_g_underline_x</span> <span class="op">&lt;-</span> <span class="fu">dagify</span><span class="op">(</span></span>
<span>  <span class="va">Y</span> <span class="op">~</span> <span class="va">Z</span>,</span>
<span>  <span class="va">X</span> <span class="op">~</span> <span class="va">Z</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fl">2</span>, X <span class="op">=</span> <span class="fl">1</span>, Z <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fl">1</span>, X <span class="op">=</span> <span class="fl">1</span>, Z <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_backdoor_g_underline_x</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">backdoor_g_underline_x</span>, </span>
<span>                                      <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                                          xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_edges</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey80"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_text</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="fu">TeX</span><span class="op">(</span><span class="st">"$G_{\\underline{X}}$"</span><span class="op">)</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"DAG with arrows *out of* X deleted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_do_calc</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_backdoor_g</span> <span class="op">|</span> <span class="va">plot_backdoor_g_underline_x</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p class="page-columns page-full"><img src="index_files/figure-html/backdoor-rule2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-page-inset-right" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Following Rule 2, we can treat <span class="math inline">\color{#FF4136} \operatorname{do}(x)</span> like a regular observational <span class="math inline">\color{#FF4136} x</span> as long as X and Y are d-separated in this modified <span class="math inline">G_{\underline{X}}</span> graph when conditioning on Z. And that is indeed the case: there’s no direct arrow between X and Y, and by conditioning on Z, there’s no active pathway between X and Y through Z. Let’s see if code backs us up:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">impliedConditionalIndependencies</span><span class="op">(</span><span class="va">backdoor_g_underline_x</span><span class="op">)</span></span>
<span><span class="co">## X _||_ Y | Z</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Perfect! Because <span class="math inline">Y \perp X \mid Z</span>, we can treat <span class="math inline">\color{#FF4136} \operatorname{do}(x)</span> like <span class="math inline">\color{#FF4136} x</span>.</p>
</section><section id="applying-rule-3" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="applying-rule-3">Applying Rule 3</h3>
<p>After applying Rule 2 to the first chunk of the equation, we’re still left with the <span style="color:#B10DC9;">purple</span> <span class="math inline">\color{#B10DC9} \operatorname{do}(x)</span> in the second chunk:</p>
<p><span class="math display">
\sum_z P(y \mid {\color{#FF4136} x}, z) \times P(z \mid {\color{#B10DC9} \operatorname{do}(x)})
</span></p>
<p>This second chunk doesn’t have the outcome <span class="math inline">y</span> in it and instead refers only to the treatment and confounder. Since it’s not connected with the outcome, it would be neat if we could get rid of that <span class="math inline">\color{#B10DC9} \operatorname{do}(x)</span> altogether. That’s what Rule 3 is for—ignoring interventions.</p>
<p>According to Rule 3, we can remove a <span class="math inline">\operatorname{do}(\cdot)</span> operator as long as it doesn’t influence the outcome through any uncontrolled or unconditioned path in a modified graph. Because we’re dealing with a smaller number of variables here, the math for Rule 3 is a lot simpler:</p>
<p><span class="math display">
P(z \mid {\color{#B10DC9} \operatorname{do}(x)}) = P(z \mid {\color{#B10DC9} \text{nothing!}}) \qquad \text{ if } (X \perp Z)_{G_{\overline{X}}}
</span></p>
<p>Here’s the simplified <span class="math inline">G_{\overline{X}}</span> graph:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">backdoor_g_overline_x</span> <span class="op">&lt;-</span> <span class="fu">dagify</span><span class="op">(</span></span>
<span>  <span class="va">Y</span> <span class="op">~</span> <span class="va">X</span> <span class="op">+</span> <span class="va">Z</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fl">2</span>, X <span class="op">=</span> <span class="fl">1</span>, Z <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fl">1</span>, X <span class="op">=</span> <span class="fl">1</span>, Z <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_backdoor_g_overline_x</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">backdoor_g_overline_x</span>, </span>
<span>                                     <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, </span>
<span>                                         xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_edges</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey80"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_dag_text</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="fu">TeX</span><span class="op">(</span><span class="st">"$G_{\\bar{X}}$"</span><span class="op">)</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"DAG with arrows *into* X deleted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_do_calc</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_backdoor_g</span> <span class="op">|</span> <span class="va">plot_backdoor_g_overline_x</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full"><p class="page-columns page-full"><img src="index_files/figure-html/backdoor-rule3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-page-inset-right" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>As long as X and Z are d-separated and independent, we can remove that <span class="math inline">\color{#B10DC9} \operatorname{do}(x)</span> completely. According to this graph, there’s no direct arrow connecting them, and there’s no active pathway through Y, since Y is a collider in this case and doesn’t pass on causal association. As always, let’s verify with code:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">impliedConditionalIndependencies</span><span class="op">(</span><span class="va">backdoor_g_overline_x</span><span class="op">)</span></span>
<span><span class="co">## X _||_ Z</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Huzzah! <span class="math inline">X \perp Z</span>, which means we can nuke the <span class="math inline">\color{#B10DC9} \operatorname{do}(x)</span>.</p>
</section><section id="final-equation" class="level3"><h3 class="anchored" data-anchor-id="final-equation">Final equation</h3>
<p>After marginalizing across <span class="math inline">z</span>, applying Rule 2, and applying Rule 3, we’re left with the following formula for backdoor adjustment:</p>
<p><span class="math display">
P(y \mid \operatorname{do}(x)) = \sum_z P(y \mid x, z) \times P(z)
</span></p>
<p>That’s exactly the same formula as the general backdoor adjustment formula—we successfully derived it using <em>do</em>-calculus rules!</p>
<p>Most importantly, there are no <span class="math inline">\operatorname{do}(\cdot)</span> operators anywhere in this equation, making this estimand completely <em>do</em>-free and estimable using non-interventional observational data! As long as we close the backdoor confounding by adjusting for Z (however you want, like through inverse probability weighting, matching, fancy machine learning stuff, or whatever else—see <a href="https://www.andrewheiss.com/research/chapters/heiss-causal-inference-2021/">this chapter</a>, or <a href="https://www.andrewheiss.com/blog/2020/02/25/closing-backdoors-dags/">this blog post</a>, or <a href="https://evalf21.classes.andrewheiss.com/example/matching-ipw/">this guide</a> for examples of how to do this), we can estimate the causal effect of X on Y (or <span class="math inline">P(y \mid \operatorname{do}(x))</span>) with only observational data.</p>
<p>Here’s the derivation all at once:</p>
<p><span class="math display">
\begin{aligned}
&amp; [\text{Marginalization across } z + \text{chain rule for conditional probabilities}] \\
P(y \mid \operatorname{do}(x)) =&amp; \sum_z P(y \mid {\color{#FF4136} \operatorname{do}(x)}, z) \times P(z \mid {\color{#B10DC9} \operatorname{do}(x)}) \\
&amp; [\text{Use Rule 2 to treat } {\color{#FF4136} \operatorname{do}(x)} \text{ as } {\color{#FF4136} x}] \\
=&amp; \sum_z P(y \mid {\color{#FF4136} x}, z) \times P(z \mid {\color{#B10DC9} \operatorname{do}(x)}) \\
&amp; [\text{Use Rule 3 to nuke } {\color{#B10DC9} \operatorname{do}(x)}] \\
=&amp; \sum_z P(y \mid {\color{#FF4136} x}, z) \times P(z \mid {\color{#B10DC9} \text{nothing!}}) \\
&amp; [\text{Final backdoor adjustment formula!}] \\
=&amp; \sum_z P(y \mid x, z) \times P(z)
\end{aligned}
</span></p>
<p>That’s so so cool!</p>
<p>The frontdoor adjustment formula can be derived in a similar process—see <a href="https://stephenmalina.com/post/2020-03-09-front-door-do-calc-derivation/#fn:1">the end of this post for an example</a> (with that, you apply Rules 2 and 3 repeatedly until all the <span class="math inline">\operatorname{do}(\cdot)</span> operators disappear)</p>
<p>And in cases where there’s no pre-derived backdoor or frontdoor adjustment formula, you can still apply these three <em>do</em>-calculus rules to attempt to identify the relationship between X and Y. Not all DAGs are fully estimable, but if they are estimable, the rules of <em>do</em>-calculus can be applied to derive the estimate. Fancier tools like <a href="https://causalfusion.net/">Causal Fusion</a> help with this and automate the process.</p>
</section></section><section id="references" class="level2">


<!-- -->


</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-LattimoreRohde:2019" class="csl-entry" role="listitem">
Lattimore, Finnian, and David Rohde. 2019. <span>“Replacing the Do-Calculus with Bayes Rule,”</span> December. <a href="https://arxiv.org/abs/1906.07125">https://arxiv.org/abs/1906.07125</a>.
</div>
<div id="ref-Neal:2020" class="csl-entry" role="listitem">
Neal, Brady. 2020. <em>Introduction to Causal Inference from a Machine Learning Perspective</em>. <a href="https://www.bradyneal.com/causal-inference-course">https://www.bradyneal.com/causal-inference-course</a>.
</div>
<div id="ref-Pearl:2012" class="csl-entry" role="listitem">
Pearl, Judea. 2012. <span>“The <em>Do</em>-Calculus Revisited.”</span> In <em>Proceedings of the Twenty-Eighth Conference on Uncertainty in Artificial Intelligence</em>, 3–11. UAI’12. Arlington, Virginia: AUAI Press. <a href="https://dl.acm.org/doi/10.5555/3020652.3020654">https://dl.acm.org/doi/10.5555/3020652.3020654</a>.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{heiss2021,
  author = {Heiss, Andrew},
  title = {Do-Calculus Adventures! {Exploring} the Three Rules of
    Do-Calculus in Plain Language and Deriving the Backdoor Adjustment
    Formula by Hand},
  date = {2021-09-07},
  url = {https://www.andrewheiss.com/blog/2021/09/07/do-calculus-backdoors/},
  doi = {10.59350/fqkhz-kq526},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-heiss2021" class="csl-entry quarto-appendix-citeas" role="listitem">
Heiss, Andrew. 2021. <span>“Do-Calculus Adventures! Exploring the Three
Rules of Do-Calculus in Plain Language and Deriving the Backdoor
Adjustment Formula by Hand.”</span> September 7, 2021. <a href="https://doi.org/10.59350/fqkhz-kq526">https://doi.org/10.59350/fqkhz-kq526</a>.
</div></div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.andrewheiss\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><script src="https://giscus.app/client.js" data-repo="andrewheiss/ath-quarto" data-repo-id="R_kgDOIg6EJQ" data-category="Blog comments" data-category-id="DIC_kwDOIg6EJc4CSz92" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><input type="hidden" id="giscus-base-theme" value="light"><input type="hidden" id="giscus-alt-theme" value="dark"><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb24" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Do-calculus adventures! Exploring the three rules of do-calculus in plain language and deriving the backdoor adjustment formula by hand"</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2021-09-07</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Use R to explore the three rules of &lt;em&gt;do&lt;/em&gt;-calculus in plain language and derive the backdoor adjustment formula by hand"</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> do-calculus-math.png</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co">  - r</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - tidyverse</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co">  - DAGs</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - causal inference</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co">  - do calculus</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="an">html-math-method:</span><span class="co"> katex</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="an">doi:</span><span class="co"> 10.59350/fqkhz-kq526</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="an">citation:</span><span class="co"> true</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="in">```{r knitr-options, include=FALSE}</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(fig.align = "center", fig.retina = 3, collapse = TRUE)</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>I've been teaching <span class="co">[</span><span class="ot">a course on program evaluation</span><span class="co">](https://evalf21.classes.andrewheiss.com/)</span> since Fall 2019, and while part of the class is focused on logic models and the more managerial aspects of evaluation, the bulk of the class is focused on causal inference. Ever since reading <span class="co">[</span><span class="ot">Judea Pearl's *The Book of Why*</span><span class="co">](http://bayes.cs.ucla.edu/WHY/)</span> in 2019, I've thrown myself into the world of DAGs, econometrics, and general causal inference, and I've been both teaching it and using it in research ever since. I've even <span class="co">[</span><span class="ot">published a book chapter on it</span><span class="co">](https://www.andrewheiss.com/research/chapters/heiss-causal-inference-2021/)</span>. Fun stuff.</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>This post assumes you have a general knowledge of DAGs and backdoor confounding. Read <span class="co">[</span><span class="ot">this post</span><span class="co">](https://www.andrewheiss.com/blog/2020/02/25/closing-backdoors-dags/)</span> or <span class="co">[</span><span class="ot">this chapter</span><span class="co">](https://www.andrewheiss.com/research/chapters/heiss-causal-inference-2021/)</span> if you haven't heard about those things yet.</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>DAGs are a powerful tool for causal inference because they let you map out all your assumptions of the data generating process for some treatment and some outcome. Importantly, these causal graphs help you determine what statistical approaches you need to use to isolate or identify the causal arrow between treatment and outcome. One of the more common (and intuitive) methods for idenfifying causal effects with DAGs is to close back doors, or adjust for nodes in a DAG that open up unwanted causal associtions between treatment and control. By properly closing backdoors, you can estimate a causal quantity using observational data. There's even a special formula called the backdoor adjustment formula that takes an equation with a $\operatorname{do}(\cdot)$ operator (a <span class="co">[</span><span class="ot">special mathematical function</span><span class="co">](https://stats.stackexchange.com/questions/211008/dox-operator-meaning)</span> representing a direct experimental intervention in a graph) and allows you to estimate the effect with *do*-free quantities:</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>P(y \mid \operatorname{do}(x)) = \sum_z P(y \mid x, z) \times P(z)</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>When I teach this stuff, I show that formula on a slide, tell students they don't need to worry about it too much, and then show how actually do it using regression, inverse probability weighting, and matching (<span class="co">[</span><span class="ot">with this guide</span><span class="co">](https://evalf21.classes.andrewheiss.com/example/matching-ipw/)</span>). For my MPA and MPP students, the math isn't as important as the actual application of these principles, so that's what I focus on.</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>However—confession time—that math is also a bit of a magic black box for me too. I've read it in books and assume that it's correct, but I never really fully understood why.</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>Compounding my confusion is the fact that the foundation of Judea Pearl-style DAG-based causal inference is the idea of *do*-calculus [@Pearl:2012]: a set of three mathematical rules that can be applied to a causal graph to identify causal relationships. Part of my confusion stems from the fact that most textbooks and courses (including mine!) explain that you can identify causal relationships in DAGs using backdoor adjustment, frontdoor adjustment, or the fancy application of *do*-calculus rules. When framed like this, it seems like backdoor and frontdoor adjustment are separate things from *do*-calculus, and that *do*-calculus is something you do when backdoor and frontdoor adjustments don't work.</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>But that's not the case! In 2020, <span class="co">[</span><span class="ot">I asked Twitter</span><span class="co">](https://twitter.com/@andrewheiss)</span> if backdoor and frontdoor adjustment were connected to *do*-calculus, and surprisingly <span class="co">[</span><span class="ot">Judea Pearl himself answered</span><span class="co">](https://twitter.com/yudapearl/status/1252462516468240390)</span> that they are! </span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=FALSE, out.width="70%", fig.align="center"}</span></span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("pearl-tweet.png")</span></span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>They're both specific consequences of the application of the rules of *do*-calculus—they just have special names because they're easy to see in a graph. </span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>But how? How do people apply these strange rules of *do*-calculus to derive these magical backdoor and frontdoor adjustment formulas? The question has haunted me since April 2020.</span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>But in the past couple days, I've stumbled across a couple excellent resources (<span class="co">[</span><span class="ot">this course</span><span class="co">](https://www.bradyneal.com/causal-inference-course)</span> and <span class="co">[</span><span class="ot">these videos</span><span class="co">](https://www.youtube.com/playlist?list=PLoazKTcS0Rzb6bb9L508cyJ1z-U9iWkA0)</span> + <span class="co">[</span><span class="ot">this blog post</span><span class="co">](https://stephenmalina.com/post/2020-03-09-front-door-do-calc-derivation/)</span>) that explained *do*-calculus really well, so I figured I'd finally tackle this question and figure out how exactly *do*-calculus is used to derive the backdoor adjustment formula. I won't show the derivation of the frontdoor formula—smarter people than me have done that (<span class="co">[</span><span class="ot">here</span><span class="co">](https://stephenmalina.com/post/2020-03-09-front-door-do-calc-derivation/)</span> and <span class="co">[</span><span class="ot">Section 6.2.1 here</span><span class="co">](https://www.bradyneal.com/Introduction_to_Causal_Inference-Dec17_2020-Neal.pdf)</span>, for instance), but I can do the backdoor one now!</span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>First, I'll explain and illustrate how each of the three rules of *do*-calculus as plain-language-y as possible, and then I'll apply those rules to show how the backdoor adjustment formula is created. </span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>I use the **ggdag** and **dagitty** packages in R for all this, so you can follow along too. Here we go!</span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, warning=FALSE, message=FALSE}</span></span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)  # For ggplot2 and friends</span></span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a><span class="in">library(patchwork)  # For combining plots</span></span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggdag)      # For making DAGs with ggplot</span></span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a><span class="in">library(dagitty)    # For dealing with DAG math</span></span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a><span class="in">library(latex2exp)  # Easily convert LaTeX into arcane plotmath expressions</span></span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggtext)     # Use markdown in ggplot labels</span></span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a cleaner serifed theme to use throughout</span></span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a><span class="in">theme_do_calc &lt;- function() {</span></span>
<span id="cb24-65"><a href="#cb24-65" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_dag(base_family = "Linux Libertine O") +</span></span>
<span id="cb24-66"><a href="#cb24-66" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(plot.title = element_text(size = rel(1.5)),</span></span>
<span id="cb24-67"><a href="#cb24-67" aria-hidden="true" tabindex="-1"></a><span class="in">        plot.subtitle = element_markdown())</span></span>
<span id="cb24-68"><a href="#cb24-68" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb24-69"><a href="#cb24-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-70"><a href="#cb24-70" aria-hidden="true" tabindex="-1"></a><span class="in"># Make all geom_dag_text() layers use these settings automatically</span></span>
<span id="cb24-71"><a href="#cb24-71" aria-hidden="true" tabindex="-1"></a><span class="in">update_geom_defaults(ggdag:::GeomDagText, list(family = "Linux Libertine O", </span></span>
<span id="cb24-72"><a href="#cb24-72" aria-hidden="true" tabindex="-1"></a><span class="in">                                               fontface = "bold",</span></span>
<span id="cb24-73"><a href="#cb24-73" aria-hidden="true" tabindex="-1"></a><span class="in">                                               color = "black"))</span></span>
<span id="cb24-74"><a href="#cb24-74" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-75"><a href="#cb24-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-76"><a href="#cb24-76" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exploring the rules of *do*-calculus</span></span>
<span id="cb24-77"><a href="#cb24-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-78"><a href="#cb24-78" aria-hidden="true" tabindex="-1"></a>The three rules of *do*-calculus have always been confusing to me since they are typically written as pure math equations and not in plain understandable language. For instance, [here's Judea Pearl's canonical primer on *do*-calculus](https://ftp.cs.ucla.edu/pub/stat_ser/r402.pdf)—a short PDF with lots of math and proofs [@Pearl:2012]. In basically everything I've read about *do*-calculus, there's inevitably a listing of these three very mathy rules, written for people much smarter than me:</span>
<span id="cb24-79"><a href="#cb24-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-80"><a href="#cb24-80" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=FALSE, out.width="100%", fig.align="center"}</span></span>
<span id="cb24-81"><a href="#cb24-81" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "From left to right: @LattimoreRohde:2019, [The Stanford Encyclopedia of Philosophy](https://plato.stanford.edu/entries/causal-models/do-calculus.html), @Pearl:2012, @Neal:2020"</span></span>
<span id="cb24-82"><a href="#cb24-82" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("do-calculus-math.png")</span></span>
<span id="cb24-83"><a href="#cb24-83" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-84"><a href="#cb24-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-85"><a href="#cb24-85" aria-hidden="true" tabindex="-1"></a>However, beneath this scary math, each rule has specific intuition and purpose behind it—I just didn't understand the plain-language reasons for each rule until reading <span class="co">[</span><span class="ot">this really neat blog post</span><span class="co">](https://stephenmalina.com/post/2020-03-09-front-door-do-calc-derivation/)</span>. Here's what each rule actually does:</span>
<span id="cb24-86"><a href="#cb24-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-87"><a href="#cb24-87" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Rule 1**: Decide if we can ignore an observation</span>
<span id="cb24-88"><a href="#cb24-88" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Rule 2**: Decide if we can treat an intervention as an observation</span>
<span id="cb24-89"><a href="#cb24-89" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Rule 3**: Decide if we can ignore an intervention</span>
<span id="cb24-90"><a href="#cb24-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-91"><a href="#cb24-91" aria-hidden="true" tabindex="-1"></a>Whoa! That's exceptionally logical. Each rule is designed to help simplify and reduce nodes in a DAG by either ignoring them (Rules 1 and 3) or making it so interventions like $\operatorname{do}(\cdot)$ can be treated like observations instead (Rule 2).</span>
<span id="cb24-92"><a href="#cb24-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-93"><a href="#cb24-93" aria-hidden="true" tabindex="-1"></a>Let's explore each of these rules in detail. In all these situations, we're assuming that there's a DAG with 4 nodes: W, X, Y, and Z. Y is always the outcome; X is always the main treatment. In each rule, our goal is to get rid of Z by applying the rule. When talking about interventions in a graph, there's a special notation with overlines and underlines:</span>
<span id="cb24-94"><a href="#cb24-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-95"><a href="#cb24-95" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>An overline like $G_{\overline{X}}$ means that you delete all the arrows *going into* X</span>
<span id="cb24-96"><a href="#cb24-96" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>An underline like $G_{\underline{X}}$ means that you delete all the arrows *coming out of* X</span>
<span id="cb24-97"><a href="#cb24-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-98"><a href="#cb24-98" aria-hidden="true" tabindex="-1"></a>I imagine this line like a wall:</span>
<span id="cb24-99"><a href="#cb24-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-100"><a href="#cb24-100" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If the wall is on top of X like $\overline{X}$, you can't draw any arrows going into it, so you delete anything going in</span>
<span id="cb24-101"><a href="#cb24-101" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If the wall is on the bottom of X like $\underline{X}$, you can't draw any arrows going out of it, so you delete anything going out</span>
<span id="cb24-102"><a href="#cb24-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-103"><a href="#cb24-103" aria-hidden="true" tabindex="-1"></a><span class="fu">### Rule 1: Ignoring observations</span></span>
<span id="cb24-104"><a href="#cb24-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-105"><a href="#cb24-105" aria-hidden="true" tabindex="-1"></a>According to Rule 1, we can ignore any observational node if it doesn't influence the outcome through any path, or if it is d-separated from the outcome. Here's the formal definition:</span>
<span id="cb24-106"><a href="#cb24-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-107"><a href="#cb24-107" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-108"><a href="#cb24-108" aria-hidden="true" tabindex="-1"></a>P(y \mid z, \operatorname{do}(x), w) = P(y \mid \operatorname{do}(x), w) \qquad \text{ if } (Y \perp Z \mid W, X)_{G_{\overline{X}}}</span>
<span id="cb24-109"><a href="#cb24-109" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-110"><a href="#cb24-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-111"><a href="#cb24-111" aria-hidden="true" tabindex="-1"></a>There are a lot of moving parts here, but remember, the focus in this equation is $z$. Our goal here is to remove or ignore $z$. Notice how $z$ exists on the left-hand side of the equation and how it is gone on the right-hand side. As long as we meet the cryptic conditions of $(Y \perp Z \mid W, X)_{G_{\overline{X}}}$, we can get rid of it. But what the heck does that even mean? </span>
<span id="cb24-112"><a href="#cb24-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-113"><a href="#cb24-113" aria-hidden="true" tabindex="-1"></a>Here, $G_{\overline{X}}$ means "the original causal graph with all arrows into X removed", while the $Y \perp Z \mid W, X$ part means "Y is independent of Z, given W and X" in the new modified graph. If the Y and Z nodes are d-separated from each other after we account for both W and X, we can get rid of Z and ignore it.</span>
<span id="cb24-114"><a href="#cb24-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-115"><a href="#cb24-115" aria-hidden="true" tabindex="-1"></a>Let's look at this graphically to help make better sense of this. We'll use the <span class="in">`dagify()`</span> function from **ggdag** to build a couple DAGs: one complete one ($G$) and one with all the arrows into X deleted ($G_{\overline{X}}$). X causes both X and Y, while W confounds X, Y, and Z. </span>
<span id="cb24-116"><a href="#cb24-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-117"><a href="#cb24-117" aria-hidden="true" tabindex="-1"></a><span class="in">```{r build-rule1}</span></span>
<span id="cb24-118"><a href="#cb24-118" aria-hidden="true" tabindex="-1"></a><span class="in">rule1_g &lt;- dagify(</span></span>
<span id="cb24-119"><a href="#cb24-119" aria-hidden="true" tabindex="-1"></a><span class="in">  Y ~ X + W,</span></span>
<span id="cb24-120"><a href="#cb24-120" aria-hidden="true" tabindex="-1"></a><span class="in">  X ~ W,</span></span>
<span id="cb24-121"><a href="#cb24-121" aria-hidden="true" tabindex="-1"></a><span class="in">  Z ~ X + W,</span></span>
<span id="cb24-122"><a href="#cb24-122" aria-hidden="true" tabindex="-1"></a><span class="in">  coords = list(x = c(X = 1, Y = 2, Z = 1.25, W = 1.5),</span></span>
<span id="cb24-123"><a href="#cb24-123" aria-hidden="true" tabindex="-1"></a><span class="in">                y = c(X = 1, Y = 1, Z = 2, W = 2))</span></span>
<span id="cb24-124"><a href="#cb24-124" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb24-125"><a href="#cb24-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-126"><a href="#cb24-126" aria-hidden="true" tabindex="-1"></a><span class="in">rule1_g_x_over &lt;- dagify(</span></span>
<span id="cb24-127"><a href="#cb24-127" aria-hidden="true" tabindex="-1"></a><span class="in">  Y ~ X + W,</span></span>
<span id="cb24-128"><a href="#cb24-128" aria-hidden="true" tabindex="-1"></a><span class="in">  Z ~ X + W,</span></span>
<span id="cb24-129"><a href="#cb24-129" aria-hidden="true" tabindex="-1"></a><span class="in">  coords = list(x = c(X = 1, Y = 2, Z = 1.25, W = 1.5),</span></span>
<span id="cb24-130"><a href="#cb24-130" aria-hidden="true" tabindex="-1"></a><span class="in">                y = c(X = 1, Y = 1, Z = 2, W = 2))</span></span>
<span id="cb24-131"><a href="#cb24-131" aria-hidden="true" tabindex="-1"></a><span class="in">) </span></span>
<span id="cb24-132"><a href="#cb24-132" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-133"><a href="#cb24-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-134"><a href="#cb24-134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-rule1, fig.width=8, fig.height=3, out.width="100%"}</span></span>
<span id="cb24-135"><a href="#cb24-135" aria-hidden="true" tabindex="-1"></a><span class="in">#| column: page-inset-right</span></span>
<span id="cb24-136"><a href="#cb24-136" aria-hidden="true" tabindex="-1"></a><span class="in">plot_rule1_g &lt;- ggplot(rule1_g, aes(x = x, y = y, </span></span>
<span id="cb24-137"><a href="#cb24-137" aria-hidden="true" tabindex="-1"></a><span class="in">                                    xend = xend, yend = yend)) +</span></span>
<span id="cb24-138"><a href="#cb24-138" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_edges() +</span></span>
<span id="cb24-139"><a href="#cb24-139" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_point(color = "grey80", size = 10) +</span></span>
<span id="cb24-140"><a href="#cb24-140" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_text() +</span></span>
<span id="cb24-141"><a href="#cb24-141" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = TeX("$G$"),</span></span>
<span id="cb24-142"><a href="#cb24-142" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = "Original DAG") +</span></span>
<span id="cb24-143"><a href="#cb24-143" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_do_calc()</span></span>
<span id="cb24-144"><a href="#cb24-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-145"><a href="#cb24-145" aria-hidden="true" tabindex="-1"></a><span class="in">plot_rule1_g_x_over &lt;- ggplot(rule1_g_x_over, aes(x = x, y = y, </span></span>
<span id="cb24-146"><a href="#cb24-146" aria-hidden="true" tabindex="-1"></a><span class="in">                                                  xend = xend, yend = yend)) +</span></span>
<span id="cb24-147"><a href="#cb24-147" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_edges() +</span></span>
<span id="cb24-148"><a href="#cb24-148" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_point(color = "grey80", size = 10) +</span></span>
<span id="cb24-149"><a href="#cb24-149" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_text() +</span></span>
<span id="cb24-150"><a href="#cb24-150" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = TeX("$G_{\\bar{X}}$"),</span></span>
<span id="cb24-151"><a href="#cb24-151" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = "DAG with arrows *into* X deleted") +</span></span>
<span id="cb24-152"><a href="#cb24-152" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_do_calc()</span></span>
<span id="cb24-153"><a href="#cb24-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-154"><a href="#cb24-154" aria-hidden="true" tabindex="-1"></a><span class="in">plot_rule1_g | plot_rule1_g_x_over</span></span>
<span id="cb24-155"><a href="#cb24-155" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-156"><a href="#cb24-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-157"><a href="#cb24-157" aria-hidden="true" tabindex="-1"></a>If we want to calculate the causal effect of X on Y, do we need to worry about Z here, or can we ignore it? Let's apply Rule 1. If we look at the modified $G_{\overline{X}}$, Y and Z are completely d-separated if we account for both W and X—there's no direct arrow between them, and there's no active path connecting them through W or X, since we're accounting for (or condition on) those nodes. Y and Z are thus d-separated and $Y \perp Z \mid W, X$. We can confirm this with the <span class="in">`impliedConditionalIndependencies()`</span> function from the **dagitty** package:</span>
<span id="cb24-158"><a href="#cb24-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-159"><a href="#cb24-159" aria-hidden="true" tabindex="-1"></a><span class="in">```{r independencies-rule1}</span></span>
<span id="cb24-160"><a href="#cb24-160" aria-hidden="true" tabindex="-1"></a><span class="in">impliedConditionalIndependencies(rule1_g_x_over)</span></span>
<span id="cb24-161"><a href="#cb24-161" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-162"><a href="#cb24-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-163"><a href="#cb24-163" aria-hidden="true" tabindex="-1"></a>And there it is! The second independency there is $Y \perp Z \mid W, X$. That means that we can apply Rule 1 and ignore Z, meaning that</span>
<span id="cb24-164"><a href="#cb24-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-165"><a href="#cb24-165" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-166"><a href="#cb24-166" aria-hidden="true" tabindex="-1"></a>P(y \mid z, \operatorname{do}(x), w) = P(y \mid \operatorname{do}(x), w)</span>
<span id="cb24-167"><a href="#cb24-167" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-168"><a href="#cb24-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-169"><a href="#cb24-169" aria-hidden="true" tabindex="-1"></a>This makes sense but is a little too complicated for me, since we're working with four different nodes. We can simplify this and pretend that $\operatorname{do}(x)$ is nothing and that X doesn't exist. That leaves us with just three nodes—W, Y, and Z—and this DAG:</span>
<span id="cb24-170"><a href="#cb24-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-171"><a href="#cb24-171" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-rule1-simple, fig.width=4, fig.height=3, out.width="60%"}</span></span>
<span id="cb24-172"><a href="#cb24-172" aria-hidden="true" tabindex="-1"></a><span class="in">rule1_g_simple &lt;- dagify(</span></span>
<span id="cb24-173"><a href="#cb24-173" aria-hidden="true" tabindex="-1"></a><span class="in">  Y ~ W,</span></span>
<span id="cb24-174"><a href="#cb24-174" aria-hidden="true" tabindex="-1"></a><span class="in">  Z ~ W,</span></span>
<span id="cb24-175"><a href="#cb24-175" aria-hidden="true" tabindex="-1"></a><span class="in">  coords = list(x = c(Y = 2, Z = 1, W = 1.5),</span></span>
<span id="cb24-176"><a href="#cb24-176" aria-hidden="true" tabindex="-1"></a><span class="in">                y = c(Y = 1, Z = 1, W = 2))</span></span>
<span id="cb24-177"><a href="#cb24-177" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb24-178"><a href="#cb24-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-179"><a href="#cb24-179" aria-hidden="true" tabindex="-1"></a><span class="in">plot_rule1_g_simple &lt;- ggplot(rule1_g_simple, aes(x = x, y = y, </span></span>
<span id="cb24-180"><a href="#cb24-180" aria-hidden="true" tabindex="-1"></a><span class="in">                                                  xend = xend, yend = yend)) +</span></span>
<span id="cb24-181"><a href="#cb24-181" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_edges() +</span></span>
<span id="cb24-182"><a href="#cb24-182" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_point(color = "grey80", size = 10) +</span></span>
<span id="cb24-183"><a href="#cb24-183" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_text() +</span></span>
<span id="cb24-184"><a href="#cb24-184" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = TeX("$G$"),</span></span>
<span id="cb24-185"><a href="#cb24-185" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = "Simplified DAG without X") +</span></span>
<span id="cb24-186"><a href="#cb24-186" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_do_calc()</span></span>
<span id="cb24-187"><a href="#cb24-187" aria-hidden="true" tabindex="-1"></a><span class="in">plot_rule1_g_simple</span></span>
<span id="cb24-188"><a href="#cb24-188" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-189"><a href="#cb24-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-190"><a href="#cb24-190" aria-hidden="true" tabindex="-1"></a>The simplified X-free version of Rule 1 looks like this:</span>
<span id="cb24-191"><a href="#cb24-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-192"><a href="#cb24-192" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-193"><a href="#cb24-193" aria-hidden="true" tabindex="-1"></a>P(y \mid z, w) = P(y \mid w) \qquad \text{ if } (Y \perp Z \mid W)_{G}</span>
<span id="cb24-194"><a href="#cb24-194" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-195"><a href="#cb24-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-196"><a href="#cb24-196" aria-hidden="true" tabindex="-1"></a>In other words, we can ignore Z and remove it from the $P(y \mid z, w)$ equation if Y and Z are d-separated (or independent of each other) after accounting for W. Once we account for W, there's no possible connection between Y and Z, so they really are d-separated. We can again confirm this with code:</span>
<span id="cb24-197"><a href="#cb24-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-198"><a href="#cb24-198" aria-hidden="true" tabindex="-1"></a><span class="in">```{r independencies-rule1-simple}</span></span>
<span id="cb24-199"><a href="#cb24-199" aria-hidden="true" tabindex="-1"></a><span class="in">impliedConditionalIndependencies(rule1_g_simple)</span></span>
<span id="cb24-200"><a href="#cb24-200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-201"><a href="#cb24-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-202"><a href="#cb24-202" aria-hidden="true" tabindex="-1"></a>There we go. Because $Y \perp Z \mid W$ we can safely ignore Z.</span>
<span id="cb24-203"><a href="#cb24-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-204"><a href="#cb24-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-205"><a href="#cb24-205" aria-hidden="true" tabindex="-1"></a><span class="fu">### Rule 2: Treating interventions as observations</span></span>
<span id="cb24-206"><a href="#cb24-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-207"><a href="#cb24-207" aria-hidden="true" tabindex="-1"></a>Rule 1 is neat, but it has nothing to do with causal interventions or the $\operatorname{do}(\cdot)$ operator. It feels more like a housekeeping rule—it's a way of simplifying and removing unnecessary nodes that don't have to do with the main treatment → outcome relationship. </span>
<span id="cb24-208"><a href="#cb24-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-209"><a href="#cb24-209" aria-hidden="true" tabindex="-1"></a>With Rule 2, we start messing with interventions. In an experiment like a randomized controlled trial, a researcher has the ability to assign treatment and either $\operatorname{do}(x)$ or not $\operatorname{do}(x)$. With observational data, though, it's not possible to $\operatorname{do}(x)$ directly. It would be fantastic if we could take an intervention like $\operatorname{do}(x)$ and treat it like regular non-interventional observational data. Rule 2 lets us do this.</span>
<span id="cb24-210"><a href="#cb24-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-211"><a href="#cb24-211" aria-hidden="true" tabindex="-1"></a>According to Rule 2, interventions (or $do(x)$) can be treated as observations (or $x$) when the causal effect of a variable on the outcome ($X \rightarrow Y$) only influences the outcome through directed paths. The official math for this is this complicated thing:</span>
<span id="cb24-212"><a href="#cb24-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-213"><a href="#cb24-213" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-214"><a href="#cb24-214" aria-hidden="true" tabindex="-1"></a>P(y \mid \operatorname{do}(z), \operatorname{do}(x), w) = P(y \mid z, \operatorname{do}(x), w) \qquad \text{ if } (Y \perp Z \mid W, X)_{G_{\overline{X}, \underline{Z}}}</span>
<span id="cb24-215"><a href="#cb24-215" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-216"><a href="#cb24-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-217"><a href="#cb24-217" aria-hidden="true" tabindex="-1"></a>For me, this is super confusing, since there are two different $\operatorname{do}(\cdot)$ operators here and when I think of causal graphs, I think of single interventions. Like we did with Rule 1, we can simplify this and pretend that there's no intervention $\operatorname{do}(x)$ (we'll do the full rule in a minute, don't worry). Again, this is legal because each of these rules are focused on messing with the Z variable: ignoring it or treating it as an observation. That leaves us with this slightly simpler (though still cryptic) equation:</span>
<span id="cb24-218"><a href="#cb24-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-219"><a href="#cb24-219" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-220"><a href="#cb24-220" aria-hidden="true" tabindex="-1"></a>P(y \mid \operatorname{do}(z), w) = P(y \mid z, w) \qquad \text{ if } (Y \perp Z \mid W)_{G_{\underline{Z}}}</span>
<span id="cb24-221"><a href="#cb24-221" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-222"><a href="#cb24-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-223"><a href="#cb24-223" aria-hidden="true" tabindex="-1"></a>Notice how the left-hand side has the interventional $\operatorname{do}(z)$, while the right-hand side has the observed $z$. As long as we meet the condition $(Y \perp Z \mid W)_{G_{\underline{Z}}}$, we can transform $\operatorname{do}(z)$ into $z$ and work only with observational data. Once again, though, what does this $(Y \perp Z \mid W)_{G_{\underline{Z}}}$ condition even mean?</span>
<span id="cb24-224"><a href="#cb24-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-225"><a href="#cb24-225" aria-hidden="true" tabindex="-1"></a>Here, $G_{\underline{Z}}$ means "the original causal graph with all arrows out of Z removed", while the $Y \perp Z \mid W$ part means "Y is independent of Z, given W" in the new modified graph. Similar to Rule 1, if the Y and Z nodes are d-separated from each other after we account for W, we can legally treat $\operatorname{do}(z)$ like $z$.</span>
<span id="cb24-226"><a href="#cb24-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-227"><a href="#cb24-227" aria-hidden="true" tabindex="-1"></a>As we did with Rule 1, we'll build a couple basic DAGs: a complete one ($G$) and one with all the arrows *out of* Z deleted ($G_{\underline{Z}}$).</span>
<span id="cb24-228"><a href="#cb24-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-229"><a href="#cb24-229" aria-hidden="true" tabindex="-1"></a><span class="in">```{r build-rule2-simple}</span></span>
<span id="cb24-230"><a href="#cb24-230" aria-hidden="true" tabindex="-1"></a><span class="in">rule2_g_simple &lt;- dagify(</span></span>
<span id="cb24-231"><a href="#cb24-231" aria-hidden="true" tabindex="-1"></a><span class="in">  Y ~ Z + W,</span></span>
<span id="cb24-232"><a href="#cb24-232" aria-hidden="true" tabindex="-1"></a><span class="in">  Z ~ W,</span></span>
<span id="cb24-233"><a href="#cb24-233" aria-hidden="true" tabindex="-1"></a><span class="in">  coords = list(x = c(Y = 2, Z = 1, W = 1.5),</span></span>
<span id="cb24-234"><a href="#cb24-234" aria-hidden="true" tabindex="-1"></a><span class="in">                y = c(Y = 1, Z = 1, W = 2))</span></span>
<span id="cb24-235"><a href="#cb24-235" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb24-236"><a href="#cb24-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-237"><a href="#cb24-237" aria-hidden="true" tabindex="-1"></a><span class="in">rule2_g_simple_z_under &lt;- dagify(</span></span>
<span id="cb24-238"><a href="#cb24-238" aria-hidden="true" tabindex="-1"></a><span class="in">  Y ~ W,</span></span>
<span id="cb24-239"><a href="#cb24-239" aria-hidden="true" tabindex="-1"></a><span class="in">  Z ~ W,</span></span>
<span id="cb24-240"><a href="#cb24-240" aria-hidden="true" tabindex="-1"></a><span class="in">  coords = list(x = c(Y = 2, Z = 1, W = 1.5),</span></span>
<span id="cb24-241"><a href="#cb24-241" aria-hidden="true" tabindex="-1"></a><span class="in">                y = c(Y = 1, Z = 1, W = 2))</span></span>
<span id="cb24-242"><a href="#cb24-242" aria-hidden="true" tabindex="-1"></a><span class="in">) </span></span>
<span id="cb24-243"><a href="#cb24-243" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-244"><a href="#cb24-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-245"><a href="#cb24-245" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-rule2-simple, fig.width=8, fig.height=3, out.width="100%"}</span></span>
<span id="cb24-246"><a href="#cb24-246" aria-hidden="true" tabindex="-1"></a><span class="in">#| column: page-inset-right</span></span>
<span id="cb24-247"><a href="#cb24-247" aria-hidden="true" tabindex="-1"></a><span class="in">plot_rule2_g_simple &lt;- ggplot(rule2_g_simple, </span></span>
<span id="cb24-248"><a href="#cb24-248" aria-hidden="true" tabindex="-1"></a><span class="in">                              aes(x = x, y = y, </span></span>
<span id="cb24-249"><a href="#cb24-249" aria-hidden="true" tabindex="-1"></a><span class="in">                                  xend = xend, yend = yend)) +</span></span>
<span id="cb24-250"><a href="#cb24-250" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_edges() +</span></span>
<span id="cb24-251"><a href="#cb24-251" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_point(color = "grey80", size = 10) +</span></span>
<span id="cb24-252"><a href="#cb24-252" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_text() +</span></span>
<span id="cb24-253"><a href="#cb24-253" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = TeX("$G$"),</span></span>
<span id="cb24-254"><a href="#cb24-254" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = "Original DAG") +</span></span>
<span id="cb24-255"><a href="#cb24-255" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_do_calc()</span></span>
<span id="cb24-256"><a href="#cb24-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-257"><a href="#cb24-257" aria-hidden="true" tabindex="-1"></a><span class="in">plot_rule2_g_simple_z_under &lt;- ggplot(rule2_g_simple_z_under, </span></span>
<span id="cb24-258"><a href="#cb24-258" aria-hidden="true" tabindex="-1"></a><span class="in">                                      aes(x = x, y = y, </span></span>
<span id="cb24-259"><a href="#cb24-259" aria-hidden="true" tabindex="-1"></a><span class="in">                                          xend = xend, yend = yend)) +</span></span>
<span id="cb24-260"><a href="#cb24-260" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_edges() +</span></span>
<span id="cb24-261"><a href="#cb24-261" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_point(color = "grey80", size = 10) +</span></span>
<span id="cb24-262"><a href="#cb24-262" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_text() +</span></span>
<span id="cb24-263"><a href="#cb24-263" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = TeX("$G_{\\underline{Z}}$"),</span></span>
<span id="cb24-264"><a href="#cb24-264" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = "DAG with arrows *out of* Z deleted") +</span></span>
<span id="cb24-265"><a href="#cb24-265" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_do_calc()</span></span>
<span id="cb24-266"><a href="#cb24-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-267"><a href="#cb24-267" aria-hidden="true" tabindex="-1"></a><span class="in">plot_rule2_g_simple | plot_rule2_g_simple_z_under</span></span>
<span id="cb24-268"><a href="#cb24-268" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-269"><a href="#cb24-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-270"><a href="#cb24-270" aria-hidden="true" tabindex="-1"></a>So, can we treat Z here like an observational node instead of a interventional $\operatorname{do}(\cdot)$ node? Let's apply Rule 2. If we look at the modified $G_{\underline{Z}}$ graph, Z and Y are completely d-separated if we account for W—there's no direct arrow between them, and there's no active path connecting them through W since we're conditioning on W. We can thus say that $Y \perp Z \mid W$. We can confirm this with code too:</span>
<span id="cb24-271"><a href="#cb24-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-272"><a href="#cb24-272" aria-hidden="true" tabindex="-1"></a><span class="in">```{r independencies-rule2-simple}</span></span>
<span id="cb24-273"><a href="#cb24-273" aria-hidden="true" tabindex="-1"></a><span class="in">impliedConditionalIndependencies(rule2_g_simple_z_under)</span></span>
<span id="cb24-274"><a href="#cb24-274" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-275"><a href="#cb24-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-276"><a href="#cb24-276" aria-hidden="true" tabindex="-1"></a>Woohoo! Because $Y \perp Z \mid W$ in that modified $G_{\underline{Z}}$ graph, we can legally convert the interventional $\operatorname{do}(z)$ to just a regular old observational $z$:</span>
<span id="cb24-277"><a href="#cb24-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-278"><a href="#cb24-278" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-279"><a href="#cb24-279" aria-hidden="true" tabindex="-1"></a>P(y \mid \operatorname{do}(z), w) = P(y \mid z, w)</span>
<span id="cb24-280"><a href="#cb24-280" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-281"><a href="#cb24-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-282"><a href="#cb24-282" aria-hidden="true" tabindex="-1"></a>So far we've applied Rule 2 to a simplified DAG with three nodes, but what does it look like if we're using the full four-node graph that is used in the formal definition of Rule 2?</span>
<span id="cb24-283"><a href="#cb24-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-284"><a href="#cb24-284" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-285"><a href="#cb24-285" aria-hidden="true" tabindex="-1"></a>P(y \mid \operatorname{do}(z), \operatorname{do}(x), w) = P(y \mid z, \operatorname{do}(x), w) \qquad \text{ if } (Y \perp Z \mid W, X)_{G_{\overline{X}, \underline{Z}}}</span>
<span id="cb24-286"><a href="#cb24-286" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-287"><a href="#cb24-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-288"><a href="#cb24-288" aria-hidden="true" tabindex="-1"></a>Here's one graphical representation of a graph with the four nodes W, X, Y, and Z (but it's definitely not the only possible graph! These *do*-calculus rules don't assume any specific relationships between the nodes). Here, Y is caused by both X and Z, and we'll pretend that they're both interventions (so $\operatorname{do}(x)$ and $\operatorname{do}(z)$). X is causally linked to Z, and W confounds all three: X, Y, and Z. Graph $G$ shows the complete DAG; Graph $G_{\overline{X}, \underline{Z}}$ shows a modified DAG with all arrows *into* X deleted ($\overline{X}$) and all arrows *out of* Z deleted ($\underline{Z}$).</span>
<span id="cb24-289"><a href="#cb24-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-290"><a href="#cb24-290" aria-hidden="true" tabindex="-1"></a><span class="in">```{r build-rule2}</span></span>
<span id="cb24-291"><a href="#cb24-291" aria-hidden="true" tabindex="-1"></a><span class="in">rule2_g &lt;- dagify(</span></span>
<span id="cb24-292"><a href="#cb24-292" aria-hidden="true" tabindex="-1"></a><span class="in">  Y ~ X + W + Z,</span></span>
<span id="cb24-293"><a href="#cb24-293" aria-hidden="true" tabindex="-1"></a><span class="in">  X ~ W,</span></span>
<span id="cb24-294"><a href="#cb24-294" aria-hidden="true" tabindex="-1"></a><span class="in">  Z ~ X + W,</span></span>
<span id="cb24-295"><a href="#cb24-295" aria-hidden="true" tabindex="-1"></a><span class="in">  coords = list(x = c(X = 1, Y = 2, Z = 1.25, W = 1.5),</span></span>
<span id="cb24-296"><a href="#cb24-296" aria-hidden="true" tabindex="-1"></a><span class="in">                y = c(X = 1, Y = 1, Z = 2, W = 2))</span></span>
<span id="cb24-297"><a href="#cb24-297" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb24-298"><a href="#cb24-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-299"><a href="#cb24-299" aria-hidden="true" tabindex="-1"></a><span class="in">rule2_g_modified &lt;- dagify(</span></span>
<span id="cb24-300"><a href="#cb24-300" aria-hidden="true" tabindex="-1"></a><span class="in">  Y ~ X + W,</span></span>
<span id="cb24-301"><a href="#cb24-301" aria-hidden="true" tabindex="-1"></a><span class="in">  Z ~ X + W,</span></span>
<span id="cb24-302"><a href="#cb24-302" aria-hidden="true" tabindex="-1"></a><span class="in">  coords = list(x = c(X = 1, Y = 2, Z = 1.25, W = 1.5),</span></span>
<span id="cb24-303"><a href="#cb24-303" aria-hidden="true" tabindex="-1"></a><span class="in">                y = c(X = 1, Y = 1, Z = 2, W = 2))</span></span>
<span id="cb24-304"><a href="#cb24-304" aria-hidden="true" tabindex="-1"></a><span class="in">) </span></span>
<span id="cb24-305"><a href="#cb24-305" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-306"><a href="#cb24-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-307"><a href="#cb24-307" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-rule2, fig.width=8, fig.height=3, out.width="100%"}</span></span>
<span id="cb24-308"><a href="#cb24-308" aria-hidden="true" tabindex="-1"></a><span class="in">#| column: page-inset-right</span></span>
<span id="cb24-309"><a href="#cb24-309" aria-hidden="true" tabindex="-1"></a><span class="in">plot_rule2_g &lt;- ggplot(rule2_g, aes(x = x, y = y, </span></span>
<span id="cb24-310"><a href="#cb24-310" aria-hidden="true" tabindex="-1"></a><span class="in">                                    xend = xend, yend = yend)) +</span></span>
<span id="cb24-311"><a href="#cb24-311" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_edges() +</span></span>
<span id="cb24-312"><a href="#cb24-312" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_point(color = "grey80", size = 10) +</span></span>
<span id="cb24-313"><a href="#cb24-313" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_text() +</span></span>
<span id="cb24-314"><a href="#cb24-314" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = TeX("$G$"),</span></span>
<span id="cb24-315"><a href="#cb24-315" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = "Original DAG") +</span></span>
<span id="cb24-316"><a href="#cb24-316" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_do_calc()</span></span>
<span id="cb24-317"><a href="#cb24-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-318"><a href="#cb24-318" aria-hidden="true" tabindex="-1"></a><span class="in">plot_rule2_modified &lt;- ggplot(rule2_g_modified, </span></span>
<span id="cb24-319"><a href="#cb24-319" aria-hidden="true" tabindex="-1"></a><span class="in">                              aes(x = x, y = y, </span></span>
<span id="cb24-320"><a href="#cb24-320" aria-hidden="true" tabindex="-1"></a><span class="in">                                  xend = xend, yend = yend)) +</span></span>
<span id="cb24-321"><a href="#cb24-321" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_edges() +</span></span>
<span id="cb24-322"><a href="#cb24-322" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_point(color = "grey80", size = 10) +</span></span>
<span id="cb24-323"><a href="#cb24-323" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_text() +</span></span>
<span id="cb24-324"><a href="#cb24-324" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = TeX("$G_{\\bar{X}, \\underline{Z}}$"),</span></span>
<span id="cb24-325"><a href="#cb24-325" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = "DAG with arrows *into* X and *out of* Z deleted") +</span></span>
<span id="cb24-326"><a href="#cb24-326" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_do_calc()</span></span>
<span id="cb24-327"><a href="#cb24-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-328"><a href="#cb24-328" aria-hidden="true" tabindex="-1"></a><span class="in">plot_rule2_g | plot_rule2_modified</span></span>
<span id="cb24-329"><a href="#cb24-329" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-330"><a href="#cb24-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-331"><a href="#cb24-331" aria-hidden="true" tabindex="-1"></a>Okay. Our goal here is to check if we can treat $\operatorname{do}(z)$ like a regular observational $z$. We can legally do this if Y and Z are d-separated in that modified graph, after accounting for both W and X, or $Y \perp Z \mid W, X$. And that is indeed the case! There's no direct arrow connecting Y and Z in the modified graph, and once we condition on (or account for) W and X, no pathways between Y and Z are active—Y and Z are independent and d-separated. We can confirm this with code:</span>
<span id="cb24-332"><a href="#cb24-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-333"><a href="#cb24-333" aria-hidden="true" tabindex="-1"></a><span class="in">```{r independencies-rule2}</span></span>
<span id="cb24-334"><a href="#cb24-334" aria-hidden="true" tabindex="-1"></a><span class="in">impliedConditionalIndependencies(rule2_g_modified)</span></span>
<span id="cb24-335"><a href="#cb24-335" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-336"><a href="#cb24-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-337"><a href="#cb24-337" aria-hidden="true" tabindex="-1"></a>The second independency there is that $Y \perp Z \mid W, X$, which is exactly what we want to see. We can thus legally transform $\operatorname{do}(z)$ to $z$:</span>
<span id="cb24-338"><a href="#cb24-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-339"><a href="#cb24-339" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-340"><a href="#cb24-340" aria-hidden="true" tabindex="-1"></a>P(y \mid \operatorname{do}(z), \operatorname{do}(x), w) = P(y \mid z, \operatorname{do}(x), w)</span>
<span id="cb24-341"><a href="#cb24-341" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-342"><a href="#cb24-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-343"><a href="#cb24-343" aria-hidden="true" tabindex="-1"></a>What's really neat is that Rule 2 is a generalized version of the backdoor criterion. More on that below after we explore Rule 3.</span>
<span id="cb24-344"><a href="#cb24-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-345"><a href="#cb24-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-346"><a href="#cb24-346" aria-hidden="true" tabindex="-1"></a><span class="fu">### Rule 3: Ignoring interventions</span></span>
<span id="cb24-347"><a href="#cb24-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-348"><a href="#cb24-348" aria-hidden="true" tabindex="-1"></a>Rule 3 is the trickiest of the three, conceptually. It tells us when we can completely remove a $\operatorname{do}(\cdot)$ expression rather than converting it to an observed quantity. Here it is in all its mathy glory:</span>
<span id="cb24-349"><a href="#cb24-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-350"><a href="#cb24-350" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-351"><a href="#cb24-351" aria-hidden="true" tabindex="-1"></a>P(y \mid \operatorname{do}(z), \operatorname{do}(x), w) = P(y \mid \operatorname{do}(x), w) \qquad \text{ if } (Y \perp Z \mid W, X)_{G_{\overline{X}, \overline{Z(W)}}}</span>
<span id="cb24-352"><a href="#cb24-352" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-353"><a href="#cb24-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-354"><a href="#cb24-354" aria-hidden="true" tabindex="-1"></a>In simpler language, this means that we can ignore an intervention (or a $\operatorname{do}(\cdot)$ expression) if it doesn't influence the outcome through any uncontrolled path—we can remove $\operatorname{do}(z)$ if there is no causal association (or no unblocked causal paths) flowing from Z to Y.</span>
<span id="cb24-355"><a href="#cb24-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-356"><a href="#cb24-356" aria-hidden="true" tabindex="-1"></a>This rule is tricky, though, because it depends on where the Z node (i.e. the intervention we want to get rid of) appears in the graph. Note the notation for the modified graph here. With the other rules, we used things like $G_{\overline{X}}$ or $G_{\underline{Z}}$ to remove arrows into and out of specific nodes in the modified graph. Here, though, we have the strange $G_{\overline{Z(W)}}$. This Z(W) is weird! It means "any Z node that isn't an ancestor of W". We thus only delete arrows going into a Z node in the modified graph if that Z node doesn't precede W.</span>
<span id="cb24-357"><a href="#cb24-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-358"><a href="#cb24-358" aria-hidden="true" tabindex="-1"></a>Here's one version of what that could look like graphically:</span>
<span id="cb24-359"><a href="#cb24-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-360"><a href="#cb24-360" aria-hidden="true" tabindex="-1"></a><span class="in">```{r build-rule3}</span></span>
<span id="cb24-361"><a href="#cb24-361" aria-hidden="true" tabindex="-1"></a><span class="in">rule3_g &lt;- dagify(</span></span>
<span id="cb24-362"><a href="#cb24-362" aria-hidden="true" tabindex="-1"></a><span class="in">  Y ~ X + W,</span></span>
<span id="cb24-363"><a href="#cb24-363" aria-hidden="true" tabindex="-1"></a><span class="in">  W ~ Z,</span></span>
<span id="cb24-364"><a href="#cb24-364" aria-hidden="true" tabindex="-1"></a><span class="in">  Z ~ X,</span></span>
<span id="cb24-365"><a href="#cb24-365" aria-hidden="true" tabindex="-1"></a><span class="in">  coords = list(x = c(X = 1, Y = 2, Z = 1.25, W = 1.5),</span></span>
<span id="cb24-366"><a href="#cb24-366" aria-hidden="true" tabindex="-1"></a><span class="in">                y = c(X = 1, Y = 1, Z = 2, W = 1.75))</span></span>
<span id="cb24-367"><a href="#cb24-367" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb24-368"><a href="#cb24-368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-369"><a href="#cb24-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-370"><a href="#cb24-370" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-rule3, fig.width=8, fig.height=3, out.width="100%"}</span></span>
<span id="cb24-371"><a href="#cb24-371" aria-hidden="true" tabindex="-1"></a><span class="in">#| column: page-inset-right</span></span>
<span id="cb24-372"><a href="#cb24-372" aria-hidden="true" tabindex="-1"></a><span class="in">plot_rule3_g &lt;- ggplot(rule3_g, </span></span>
<span id="cb24-373"><a href="#cb24-373" aria-hidden="true" tabindex="-1"></a><span class="in">                       aes(x = x, y = y, </span></span>
<span id="cb24-374"><a href="#cb24-374" aria-hidden="true" tabindex="-1"></a><span class="in">                           xend = xend, yend = yend)) +</span></span>
<span id="cb24-375"><a href="#cb24-375" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_edges() +</span></span>
<span id="cb24-376"><a href="#cb24-376" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_point(color = "grey80", size = 10) +</span></span>
<span id="cb24-377"><a href="#cb24-377" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_text() +</span></span>
<span id="cb24-378"><a href="#cb24-378" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = TeX("$G$"),</span></span>
<span id="cb24-379"><a href="#cb24-379" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = "Original DAG") +</span></span>
<span id="cb24-380"><a href="#cb24-380" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_do_calc()</span></span>
<span id="cb24-381"><a href="#cb24-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-382"><a href="#cb24-382" aria-hidden="true" tabindex="-1"></a><span class="in">plot_rule3_g_modified &lt;- ggplot(rule3_g, </span></span>
<span id="cb24-383"><a href="#cb24-383" aria-hidden="true" tabindex="-1"></a><span class="in">                                aes(x = x, y = y, </span></span>
<span id="cb24-384"><a href="#cb24-384" aria-hidden="true" tabindex="-1"></a><span class="in">                                    xend = xend, yend = yend)) +</span></span>
<span id="cb24-385"><a href="#cb24-385" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_edges() +</span></span>
<span id="cb24-386"><a href="#cb24-386" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_point(color = "grey80", size = 10) +</span></span>
<span id="cb24-387"><a href="#cb24-387" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_text() +</span></span>
<span id="cb24-388"><a href="#cb24-388" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = TeX("$G_{\\bar{X}, \\bar{Z(W)}}$"),</span></span>
<span id="cb24-389"><a href="#cb24-389" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = "DAG with arrows *into* Z deleted as long as Z isn't an&lt;br&gt;ancestor of W + all arrows *into* X deleted") +</span></span>
<span id="cb24-390"><a href="#cb24-390" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_do_calc()</span></span>
<span id="cb24-391"><a href="#cb24-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-392"><a href="#cb24-392" aria-hidden="true" tabindex="-1"></a><span class="in">plot_rule3_g | plot_rule3_g_modified</span></span>
<span id="cb24-393"><a href="#cb24-393" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-394"><a href="#cb24-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-395"><a href="#cb24-395" aria-hidden="true" tabindex="-1"></a>Notice how these two graphs are identical. Because we only delete arrows going into Z if Z is not an ancestor of W, in this case $G = G_{\overline{X}, \overline{Z(W)}}$. </span>
<span id="cb24-396"><a href="#cb24-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-397"><a href="#cb24-397" aria-hidden="true" tabindex="-1"></a>Remember that our original goal is to get rid of $\operatorname{do}(z)$, which we can legally do if Y and Z are d-separated and independent in our modified graph, or if $Y \perp Z \mid W, X$. That is once again indeed the case here: there's no direct arrow between Y and Z, and if we condition on W and X, there's no way to pass association between Y and Z, meaning that Y and Z are d-separated. Let's confirm it with code:</span>
<span id="cb24-398"><a href="#cb24-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-399"><a href="#cb24-399" aria-hidden="true" tabindex="-1"></a><span class="in">```{r independencies-rule3}</span></span>
<span id="cb24-400"><a href="#cb24-400" aria-hidden="true" tabindex="-1"></a><span class="in">impliedConditionalIndependencies(rule3_g)</span></span>
<span id="cb24-401"><a href="#cb24-401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-402"><a href="#cb24-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-403"><a href="#cb24-403" aria-hidden="true" tabindex="-1"></a>That second independency is our $Y \perp Z \mid W, X$, so we can safely eliminate $\operatorname{do}(z)$ from the equation. We can ignore it because it doesn't influence the outcome $Y$ through any possible path. Goodbye $\operatorname{do}(z)$!:</span>
<span id="cb24-404"><a href="#cb24-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-405"><a href="#cb24-405" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-406"><a href="#cb24-406" aria-hidden="true" tabindex="-1"></a>P(y \mid \operatorname{do}(z), \operatorname{do}(x), w) = P(y \mid \operatorname{do}(x), w)</span>
<span id="cb24-407"><a href="#cb24-407" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-408"><a href="#cb24-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-409"><a href="#cb24-409" aria-hidden="true" tabindex="-1"></a>In this case, the alternative graph $G_{\overline{X}, \overline{Z(W)}}$ was the same as the original graph because of the location of Z—Z was an ancestor of W, so we didn't delete any arrows. If Z is *not* an ancestor, though, we get to actually modify the graph. For instance, consider this DAG:</span>
<span id="cb24-410"><a href="#cb24-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-411"><a href="#cb24-411" aria-hidden="true" tabindex="-1"></a><span class="in">```{r build-rule3-alt}</span></span>
<span id="cb24-412"><a href="#cb24-412" aria-hidden="true" tabindex="-1"></a><span class="in">rule3_g_alt &lt;- dagify(</span></span>
<span id="cb24-413"><a href="#cb24-413" aria-hidden="true" tabindex="-1"></a><span class="in">  Y ~ X + W,</span></span>
<span id="cb24-414"><a href="#cb24-414" aria-hidden="true" tabindex="-1"></a><span class="in">  Z ~ W,</span></span>
<span id="cb24-415"><a href="#cb24-415" aria-hidden="true" tabindex="-1"></a><span class="in">  X ~ Z,</span></span>
<span id="cb24-416"><a href="#cb24-416" aria-hidden="true" tabindex="-1"></a><span class="in">  coords = list(x = c(X = 1, Y = 2, Z = 1.25, W = 1.5),</span></span>
<span id="cb24-417"><a href="#cb24-417" aria-hidden="true" tabindex="-1"></a><span class="in">                y = c(X = 1, Y = 1, Z = 2, W = 1.75))</span></span>
<span id="cb24-418"><a href="#cb24-418" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb24-419"><a href="#cb24-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-420"><a href="#cb24-420" aria-hidden="true" tabindex="-1"></a><span class="in">rule3_g_alt_modified &lt;- dagify(</span></span>
<span id="cb24-421"><a href="#cb24-421" aria-hidden="true" tabindex="-1"></a><span class="in">  Y ~ X + W,</span></span>
<span id="cb24-422"><a href="#cb24-422" aria-hidden="true" tabindex="-1"></a><span class="in">  Z ~ 0,</span></span>
<span id="cb24-423"><a href="#cb24-423" aria-hidden="true" tabindex="-1"></a><span class="in">  X ~ 0,</span></span>
<span id="cb24-424"><a href="#cb24-424" aria-hidden="true" tabindex="-1"></a><span class="in">  coords = list(x = c(X = 1, Y = 2, Z = 1.25, W = 1.5),</span></span>
<span id="cb24-425"><a href="#cb24-425" aria-hidden="true" tabindex="-1"></a><span class="in">                y = c(X = 1, Y = 1, Z = 2, W = 1.75))</span></span>
<span id="cb24-426"><a href="#cb24-426" aria-hidden="true" tabindex="-1"></a><span class="in">) </span></span>
<span id="cb24-427"><a href="#cb24-427" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-428"><a href="#cb24-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-429"><a href="#cb24-429" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-rule3-alt, fig.width=8, fig.height=3, out.width="100%"}</span></span>
<span id="cb24-430"><a href="#cb24-430" aria-hidden="true" tabindex="-1"></a><span class="in">#| column: page-inset-right</span></span>
<span id="cb24-431"><a href="#cb24-431" aria-hidden="true" tabindex="-1"></a><span class="in">plot_rule3_g_alt &lt;- ggplot(rule3_g_alt, </span></span>
<span id="cb24-432"><a href="#cb24-432" aria-hidden="true" tabindex="-1"></a><span class="in">                           aes(x = x, y = y, </span></span>
<span id="cb24-433"><a href="#cb24-433" aria-hidden="true" tabindex="-1"></a><span class="in">                               xend = xend, yend = yend)) +</span></span>
<span id="cb24-434"><a href="#cb24-434" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_edges() +</span></span>
<span id="cb24-435"><a href="#cb24-435" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_point(color = "grey80", size = 10) +</span></span>
<span id="cb24-436"><a href="#cb24-436" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_text() +</span></span>
<span id="cb24-437"><a href="#cb24-437" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = TeX("$G$"),</span></span>
<span id="cb24-438"><a href="#cb24-438" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = "Original DAG") +</span></span>
<span id="cb24-439"><a href="#cb24-439" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_do_calc()</span></span>
<span id="cb24-440"><a href="#cb24-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-441"><a href="#cb24-441" aria-hidden="true" tabindex="-1"></a><span class="in">plot_rule3_g_alt_modified &lt;- ggplot(rule3_g_alt_modified, </span></span>
<span id="cb24-442"><a href="#cb24-442" aria-hidden="true" tabindex="-1"></a><span class="in">                                    aes(x = x, y = y, </span></span>
<span id="cb24-443"><a href="#cb24-443" aria-hidden="true" tabindex="-1"></a><span class="in">                                        xend = xend, yend = yend)) +</span></span>
<span id="cb24-444"><a href="#cb24-444" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_edges() +</span></span>
<span id="cb24-445"><a href="#cb24-445" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_point(color = "grey80", size = 10) +</span></span>
<span id="cb24-446"><a href="#cb24-446" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_text() +</span></span>
<span id="cb24-447"><a href="#cb24-447" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = TeX("$G_{\\bar{X}, \\bar{Z(W)}}$"),</span></span>
<span id="cb24-448"><a href="#cb24-448" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = "DAG with arrows *into* Z deleted as long as Z isn't an&lt;br&gt;ancestor of W + all arrows *into* X deleted") +</span></span>
<span id="cb24-449"><a href="#cb24-449" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_do_calc()</span></span>
<span id="cb24-450"><a href="#cb24-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-451"><a href="#cb24-451" aria-hidden="true" tabindex="-1"></a><span class="in">plot_rule3_g_alt | plot_rule3_g_alt_modified</span></span>
<span id="cb24-452"><a href="#cb24-452" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-453"><a href="#cb24-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-454"><a href="#cb24-454" aria-hidden="true" tabindex="-1"></a>Phew. In this case, our DAG surgery for making the modified graph $G_{\overline{X}, \overline{Z(W)}}$ actually ended up completely d-separating Z from all nodes. Because Z isn't an ancestor of W (but is instead a descendant), we get to delete arrows going into it, and we get to delete arrows going into X as well. We can remove $\operatorname{do}(z)$ from the equation as long as $Y \perp Z \mid W, X$ in this modified graph. That is most definitely the case here. And once again, code confirms it (ignore the 0s here—they're only there so that the DAG plots correctly):</span>
<span id="cb24-455"><a href="#cb24-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-456"><a href="#cb24-456" aria-hidden="true" tabindex="-1"></a><span class="in">```{r independencies-rule3-alt}</span></span>
<span id="cb24-457"><a href="#cb24-457" aria-hidden="true" tabindex="-1"></a><span class="in">impliedConditionalIndependencies(rule3_g_alt_modified)</span></span>
<span id="cb24-458"><a href="#cb24-458" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-459"><a href="#cb24-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-460"><a href="#cb24-460" aria-hidden="true" tabindex="-1"></a>And once again, we can legally get rid of $\operatorname{do}(z)$:</span>
<span id="cb24-461"><a href="#cb24-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-462"><a href="#cb24-462" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-463"><a href="#cb24-463" aria-hidden="true" tabindex="-1"></a>P(y \mid \operatorname{do}(z), \operatorname{do}(x), w) = P(y \mid \operatorname{do}(x), w)</span>
<span id="cb24-464"><a href="#cb24-464" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-465"><a href="#cb24-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-466"><a href="#cb24-466" aria-hidden="true" tabindex="-1"></a><span class="fu">### Summary</span></span>
<span id="cb24-467"><a href="#cb24-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-468"><a href="#cb24-468" aria-hidden="true" tabindex="-1"></a>Phew. Let's look back at the three main rules and add their corresponding mathy versions, which should make more sense now:</span>
<span id="cb24-469"><a href="#cb24-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-470"><a href="#cb24-470" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Rule 1**: Decide if we can ignore an observation</span>
<span id="cb24-471"><a href="#cb24-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-472"><a href="#cb24-472" aria-hidden="true" tabindex="-1"></a>  $$</span>
<span id="cb24-473"><a href="#cb24-473" aria-hidden="true" tabindex="-1"></a>  P(y \mid z, \operatorname{do}(x), w) = P(y \mid \operatorname{do}(x), w) \qquad \text{ if } (Y \perp Z \mid W, X)_{G_{\overline{X}}}</span>
<span id="cb24-474"><a href="#cb24-474" aria-hidden="true" tabindex="-1"></a>  $$</span>
<span id="cb24-475"><a href="#cb24-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-476"><a href="#cb24-476" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Rule 2**: Decide if we can treat an intervention as an observation</span>
<span id="cb24-477"><a href="#cb24-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-478"><a href="#cb24-478" aria-hidden="true" tabindex="-1"></a>  $$</span>
<span id="cb24-479"><a href="#cb24-479" aria-hidden="true" tabindex="-1"></a>  P(y \mid \operatorname{do}(z), \operatorname{do}(x), w) = P(y \mid z, \operatorname{do}(x), w) \qquad \text{ if } (Y \perp Z \mid W, X)_{G_{\overline{X}, \underline{Z}}}</span>
<span id="cb24-480"><a href="#cb24-480" aria-hidden="true" tabindex="-1"></a>  $$</span>
<span id="cb24-481"><a href="#cb24-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-482"><a href="#cb24-482" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Rule 3**: Decide if we can ignore an intervention</span>
<span id="cb24-483"><a href="#cb24-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-484"><a href="#cb24-484" aria-hidden="true" tabindex="-1"></a>  $$</span>
<span id="cb24-485"><a href="#cb24-485" aria-hidden="true" tabindex="-1"></a>  P(y \mid \operatorname{do}(z), \operatorname{do}(x), w) = P(y \mid \operatorname{do}(x), w) \qquad \text{ if } (Y \perp Z \mid W, X)_{G_{\overline{X}, \overline{Z(W)}}}</span>
<span id="cb24-486"><a href="#cb24-486" aria-hidden="true" tabindex="-1"></a>  $$</span>
<span id="cb24-487"><a href="#cb24-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-488"><a href="#cb24-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-489"><a href="#cb24-489" aria-hidden="true" tabindex="-1"></a><span class="fu">## Deriving the backdoor adjustment formula from *do*-calculus rules</span></span>
<span id="cb24-490"><a href="#cb24-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-491"><a href="#cb24-491" aria-hidden="true" tabindex="-1"></a>That was a lot of math, but hopefully each of these *do*-calculus rules make sense in isolation now. Now that I finally understand what each of these are doing, we can apply these rules to see where the pre-derived / canned backdoor adjustment formula comes from. Somehow by applying these rules, we can transform the left-hand side of this formula into the *do*-free right-hand side:</span>
<span id="cb24-492"><a href="#cb24-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-493"><a href="#cb24-493" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-494"><a href="#cb24-494" aria-hidden="true" tabindex="-1"></a>P(y \mid \operatorname{do}(x)) = \sum_z P(y \mid x, z) \times P(z)</span>
<span id="cb24-495"><a href="#cb24-495" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-496"><a href="#cb24-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-497"><a href="#cb24-497" aria-hidden="true" tabindex="-1"></a>Let's go through the derivation of the backdoor adjustment formula step-by-step to see how it works. We'll use this super simple DAG that shows the causal effect of treatment X on outcome Y, confounded by Z:</span>
<span id="cb24-498"><a href="#cb24-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-499"><a href="#cb24-499" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basic-backdoor-dag, fig.width=4, fig.height=3, out.width="60%"}</span></span>
<span id="cb24-500"><a href="#cb24-500" aria-hidden="true" tabindex="-1"></a><span class="in">backdoor_g &lt;- dagify(</span></span>
<span id="cb24-501"><a href="#cb24-501" aria-hidden="true" tabindex="-1"></a><span class="in">  Y ~ X + Z,</span></span>
<span id="cb24-502"><a href="#cb24-502" aria-hidden="true" tabindex="-1"></a><span class="in">  X ~ Z,</span></span>
<span id="cb24-503"><a href="#cb24-503" aria-hidden="true" tabindex="-1"></a><span class="in">  coords = list(x = c(Y = 2, X = 1, Z = 1.5),</span></span>
<span id="cb24-504"><a href="#cb24-504" aria-hidden="true" tabindex="-1"></a><span class="in">                y = c(Y = 1, X = 1, Z = 2))</span></span>
<span id="cb24-505"><a href="#cb24-505" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb24-506"><a href="#cb24-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-507"><a href="#cb24-507" aria-hidden="true" tabindex="-1"></a><span class="in">plot_backdoor_g &lt;- ggplot(backdoor_g, aes(x = x, y = y, </span></span>
<span id="cb24-508"><a href="#cb24-508" aria-hidden="true" tabindex="-1"></a><span class="in">                                          xend = xend, yend = yend)) +</span></span>
<span id="cb24-509"><a href="#cb24-509" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_edges() +</span></span>
<span id="cb24-510"><a href="#cb24-510" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_point(color = "grey80", size = 10) +</span></span>
<span id="cb24-511"><a href="#cb24-511" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_text() +</span></span>
<span id="cb24-512"><a href="#cb24-512" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = TeX("$G$"),</span></span>
<span id="cb24-513"><a href="#cb24-513" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = "Basic backdoor confounding") +</span></span>
<span id="cb24-514"><a href="#cb24-514" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_do_calc()</span></span>
<span id="cb24-515"><a href="#cb24-515" aria-hidden="true" tabindex="-1"></a><span class="in">plot_backdoor_g</span></span>
<span id="cb24-516"><a href="#cb24-516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-517"><a href="#cb24-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-518"><a href="#cb24-518" aria-hidden="true" tabindex="-1"></a><span class="fu">### Marginalizing across $z$</span></span>
<span id="cb24-519"><a href="#cb24-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-520"><a href="#cb24-520" aria-hidden="true" tabindex="-1"></a>We're interested in the causal effect of X on Y, or $P(y \mid \operatorname{do}(x))$. If this were an experiment like a randomized controlled trial, we'd be able to delete all arrows going into X, which would remove all confounding from Z and allow us to measure the exact causal effect of X on Y. However, with observational data, we can't delete arrows like that. But, we can condition the X → Y relationship on Z, given that it influences both X and Y.</span>
<span id="cb24-521"><a href="#cb24-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-522"><a href="#cb24-522" aria-hidden="true" tabindex="-1"></a>We thus need to calculate the joint probability of $P(y \mid \operatorname{do}(x))$ across all values of Z. Using the rules of <span class="co">[</span><span class="ot">probability marginalization</span><span class="co">](https://en.wikipedia.org/wiki/Marginal_distribution)</span> and <span class="co">[</span><span class="ot">the chain rule for joint probabilities</span><span class="co">]</span>(https://en.wikipedia.org/wiki/Chain_rule_(probability)), we can write this joint probability like so:</span>
<span id="cb24-523"><a href="#cb24-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-524"><a href="#cb24-524" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-525"><a href="#cb24-525" aria-hidden="true" tabindex="-1"></a>P(y \mid \operatorname{do}(x)) = \sum_z P(y \mid \operatorname{do}(x), z) \times P(z \mid \operatorname{do}(x))</span>
<span id="cb24-526"><a href="#cb24-526" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-527"><a href="#cb24-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-528"><a href="#cb24-528" aria-hidden="true" tabindex="-1"></a>The right-hand side of that equation is what we want to be able to estimate using only observational data, but right now it has two $\operatorname{do}(\cdot)$ operators in it, marked in &lt;span style="color:#FF4136;"&gt;red&lt;/span&gt; and &lt;span style="color:#B10DC9;"&gt;purple&lt;/span&gt;:</span>
<span id="cb24-529"><a href="#cb24-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-530"><a href="#cb24-530" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-531"><a href="#cb24-531" aria-hidden="true" tabindex="-1"></a>\sum_z P(y \mid {\color{#FF4136} \operatorname{do}(x)}, z) \times P(z \mid {\color{#B10DC9} \operatorname{do}(x)})</span>
<span id="cb24-532"><a href="#cb24-532" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-533"><a href="#cb24-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-534"><a href="#cb24-534" aria-hidden="true" tabindex="-1"></a>We need to get rid of those.</span>
<span id="cb24-535"><a href="#cb24-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-536"><a href="#cb24-536" aria-hidden="true" tabindex="-1"></a><span class="fu">### Applying Rule 2</span></span>
<span id="cb24-537"><a href="#cb24-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-538"><a href="#cb24-538" aria-hidden="true" tabindex="-1"></a>First let's get rid of the &lt;span style="color:#FF4136;"&gt;red&lt;/span&gt; $\color{#FF4136} \operatorname{do}(x)$ that's in $P(y \mid {\color{#FF4136} \operatorname{do}(x)}, z)$. This chunk of the equation involves all three variables: treatment, outcome, and confounder. Accordingly, we don't really want to ignore any of these variables by using something like Rule 1 or Rule 3. Instead, we can try to treat that $\color{#FF4136} \operatorname{do}(x)$ as an observational $\color{#FF4136} x$ using Rule 2.</span>
<span id="cb24-539"><a href="#cb24-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-540"><a href="#cb24-540" aria-hidden="true" tabindex="-1"></a>According to Rule 2, we can treat an interventional $\operatorname{do}(\cdot)$ operator as observational if we meet specific criteria in a modified graph where we remove all arrows out of X:</span>
<span id="cb24-541"><a href="#cb24-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-542"><a href="#cb24-542" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-543"><a href="#cb24-543" aria-hidden="true" tabindex="-1"></a>P(y \mid {\color{#FF4136} \operatorname{do}(x)}, z) = P(y \mid {\color{#FF4136} x}, z) \qquad \text{ if } (Y \perp X \mid Z)_{G_{\underline{X}}}</span>
<span id="cb24-544"><a href="#cb24-544" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-545"><a href="#cb24-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-546"><a href="#cb24-546" aria-hidden="true" tabindex="-1"></a>Here's the modified $G_{\underline{X}}$ graph:</span>
<span id="cb24-547"><a href="#cb24-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-548"><a href="#cb24-548" aria-hidden="true" tabindex="-1"></a><span class="in">```{r backdoor-rule2, fig.width=8, fig.height=3, out.width="100%"}</span></span>
<span id="cb24-549"><a href="#cb24-549" aria-hidden="true" tabindex="-1"></a><span class="in">#| column: page-inset-right</span></span>
<span id="cb24-550"><a href="#cb24-550" aria-hidden="true" tabindex="-1"></a><span class="in">backdoor_g_underline_x &lt;- dagify(</span></span>
<span id="cb24-551"><a href="#cb24-551" aria-hidden="true" tabindex="-1"></a><span class="in">  Y ~ Z,</span></span>
<span id="cb24-552"><a href="#cb24-552" aria-hidden="true" tabindex="-1"></a><span class="in">  X ~ Z,</span></span>
<span id="cb24-553"><a href="#cb24-553" aria-hidden="true" tabindex="-1"></a><span class="in">  coords = list(x = c(Y = 2, X = 1, Z = 1.5),</span></span>
<span id="cb24-554"><a href="#cb24-554" aria-hidden="true" tabindex="-1"></a><span class="in">                y = c(Y = 1, X = 1, Z = 2))</span></span>
<span id="cb24-555"><a href="#cb24-555" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb24-556"><a href="#cb24-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-557"><a href="#cb24-557" aria-hidden="true" tabindex="-1"></a><span class="in">plot_backdoor_g_underline_x &lt;- ggplot(backdoor_g_underline_x, </span></span>
<span id="cb24-558"><a href="#cb24-558" aria-hidden="true" tabindex="-1"></a><span class="in">                                      aes(x = x, y = y, </span></span>
<span id="cb24-559"><a href="#cb24-559" aria-hidden="true" tabindex="-1"></a><span class="in">                                          xend = xend, yend = yend)) +</span></span>
<span id="cb24-560"><a href="#cb24-560" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_edges() +</span></span>
<span id="cb24-561"><a href="#cb24-561" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_point(color = "grey80", size = 10) +</span></span>
<span id="cb24-562"><a href="#cb24-562" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_text() +</span></span>
<span id="cb24-563"><a href="#cb24-563" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = TeX("$G_{\\underline{X}}$"),</span></span>
<span id="cb24-564"><a href="#cb24-564" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = "DAG with arrows *out of* X deleted") +</span></span>
<span id="cb24-565"><a href="#cb24-565" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_do_calc()</span></span>
<span id="cb24-566"><a href="#cb24-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-567"><a href="#cb24-567" aria-hidden="true" tabindex="-1"></a><span class="in">plot_backdoor_g | plot_backdoor_g_underline_x</span></span>
<span id="cb24-568"><a href="#cb24-568" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-569"><a href="#cb24-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-570"><a href="#cb24-570" aria-hidden="true" tabindex="-1"></a>Following Rule 2, we can treat $\color{#FF4136} \operatorname{do}(x)$ like a regular observational $\color{#FF4136} x$ as long as X and Y are d-separated in this modified $G_{\underline{X}}$ graph when conditioning on Z. And that is indeed the case: there's no direct arrow between X and Y, and by conditioning on Z, there's no active pathway between X and Y through Z. Let's see if code backs us up:</span>
<span id="cb24-571"><a href="#cb24-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-574"><a href="#cb24-574" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-575"><a href="#cb24-575" aria-hidden="true" tabindex="-1"></a><span class="fu">impliedConditionalIndependencies</span>(backdoor_g_underline_x)</span>
<span id="cb24-576"><a href="#cb24-576" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-577"><a href="#cb24-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-578"><a href="#cb24-578" aria-hidden="true" tabindex="-1"></a>Perfect! Because $Y \perp X \mid Z$, we can treat $\color{#FF4136} \operatorname{do}(x)$ like $\color{#FF4136} x$.</span>
<span id="cb24-579"><a href="#cb24-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-580"><a href="#cb24-580" aria-hidden="true" tabindex="-1"></a><span class="fu">### Applying Rule 3</span></span>
<span id="cb24-581"><a href="#cb24-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-582"><a href="#cb24-582" aria-hidden="true" tabindex="-1"></a>After applying Rule 2 to the first chunk of the equation, we're still left with the &lt;span style="color:#B10DC9;"&gt;purple&lt;/span&gt; $\color{#B10DC9} \operatorname{do}(x)$ in the second chunk:</span>
<span id="cb24-583"><a href="#cb24-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-584"><a href="#cb24-584" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-585"><a href="#cb24-585" aria-hidden="true" tabindex="-1"></a>\sum_z P(y \mid {\color{#FF4136} x}, z) \times P(z \mid {\color{#B10DC9} \operatorname{do}(x)})</span>
<span id="cb24-586"><a href="#cb24-586" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-587"><a href="#cb24-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-588"><a href="#cb24-588" aria-hidden="true" tabindex="-1"></a>This second chunk doesn't have the outcome $y$ in it and instead refers only to the treatment and confounder. Since it's not connected with the outcome, it would be neat if we could get rid of that $\color{#B10DC9} \operatorname{do}(x)$ altogether. That's what Rule 3 is for—ignoring interventions.</span>
<span id="cb24-589"><a href="#cb24-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-590"><a href="#cb24-590" aria-hidden="true" tabindex="-1"></a>According to Rule 3, we can remove a $\operatorname{do}(\cdot)$ operator as long as it doesn't influence the outcome through any uncontrolled or unconditioned path in a modified graph. Because we're dealing with a smaller number of variables here, the math for Rule 3 is a lot simpler:</span>
<span id="cb24-591"><a href="#cb24-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-592"><a href="#cb24-592" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-593"><a href="#cb24-593" aria-hidden="true" tabindex="-1"></a>P(z \mid {\color{#B10DC9} \operatorname{do}(x)}) = P(z \mid {\color{#B10DC9} \text{nothing!}}) \qquad \text{ if } (X \perp Z)_{G_{\overline{X}}}</span>
<span id="cb24-594"><a href="#cb24-594" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-595"><a href="#cb24-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-596"><a href="#cb24-596" aria-hidden="true" tabindex="-1"></a>Here's the simplified $G_{\overline{X}}$ graph:</span>
<span id="cb24-597"><a href="#cb24-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-598"><a href="#cb24-598" aria-hidden="true" tabindex="-1"></a><span class="in">```{r backdoor-rule3, fig.width=8, fig.height=3, out.width="100%"}</span></span>
<span id="cb24-599"><a href="#cb24-599" aria-hidden="true" tabindex="-1"></a><span class="in">#| column: page-inset-right</span></span>
<span id="cb24-600"><a href="#cb24-600" aria-hidden="true" tabindex="-1"></a><span class="in">backdoor_g_overline_x &lt;- dagify(</span></span>
<span id="cb24-601"><a href="#cb24-601" aria-hidden="true" tabindex="-1"></a><span class="in">  Y ~ X + Z,</span></span>
<span id="cb24-602"><a href="#cb24-602" aria-hidden="true" tabindex="-1"></a><span class="in">  coords = list(x = c(Y = 2, X = 1, Z = 1.5),</span></span>
<span id="cb24-603"><a href="#cb24-603" aria-hidden="true" tabindex="-1"></a><span class="in">                y = c(Y = 1, X = 1, Z = 2))</span></span>
<span id="cb24-604"><a href="#cb24-604" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb24-605"><a href="#cb24-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-606"><a href="#cb24-606" aria-hidden="true" tabindex="-1"></a><span class="in">plot_backdoor_g_overline_x &lt;- ggplot(backdoor_g_overline_x, </span></span>
<span id="cb24-607"><a href="#cb24-607" aria-hidden="true" tabindex="-1"></a><span class="in">                                     aes(x = x, y = y, </span></span>
<span id="cb24-608"><a href="#cb24-608" aria-hidden="true" tabindex="-1"></a><span class="in">                                         xend = xend, yend = yend)) +</span></span>
<span id="cb24-609"><a href="#cb24-609" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_edges() +</span></span>
<span id="cb24-610"><a href="#cb24-610" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_point(color = "grey80", size = 10) +</span></span>
<span id="cb24-611"><a href="#cb24-611" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_dag_text() +</span></span>
<span id="cb24-612"><a href="#cb24-612" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = TeX("$G_{\\bar{X}}$"),</span></span>
<span id="cb24-613"><a href="#cb24-613" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = "DAG with arrows *into* X deleted") +</span></span>
<span id="cb24-614"><a href="#cb24-614" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_do_calc()</span></span>
<span id="cb24-615"><a href="#cb24-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-616"><a href="#cb24-616" aria-hidden="true" tabindex="-1"></a><span class="in">plot_backdoor_g | plot_backdoor_g_overline_x</span></span>
<span id="cb24-617"><a href="#cb24-617" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-618"><a href="#cb24-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-619"><a href="#cb24-619" aria-hidden="true" tabindex="-1"></a>As long as X and Z are d-separated and independent, we can remove that $\color{#B10DC9} \operatorname{do}(x)$ completely. According to this graph, there's no direct arrow connecting them, and there's no active pathway through Y, since Y is a collider in this case and doesn't pass on causal association. As always, let's verify with code:</span>
<span id="cb24-620"><a href="#cb24-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-623"><a href="#cb24-623" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-624"><a href="#cb24-624" aria-hidden="true" tabindex="-1"></a><span class="fu">impliedConditionalIndependencies</span>(backdoor_g_overline_x)</span>
<span id="cb24-625"><a href="#cb24-625" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-626"><a href="#cb24-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-627"><a href="#cb24-627" aria-hidden="true" tabindex="-1"></a>Huzzah! $X \perp Z$, which means we can nuke the $\color{#B10DC9} \operatorname{do}(x)$.</span>
<span id="cb24-628"><a href="#cb24-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-629"><a href="#cb24-629" aria-hidden="true" tabindex="-1"></a><span class="fu">### Final equation</span></span>
<span id="cb24-630"><a href="#cb24-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-631"><a href="#cb24-631" aria-hidden="true" tabindex="-1"></a>After marginalizing across $z$, applying Rule 2, and applying Rule 3, we're left with the following formula for backdoor adjustment:</span>
<span id="cb24-632"><a href="#cb24-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-633"><a href="#cb24-633" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-634"><a href="#cb24-634" aria-hidden="true" tabindex="-1"></a>P(y \mid \operatorname{do}(x)) = \sum_z P(y \mid x, z) \times P(z)</span>
<span id="cb24-635"><a href="#cb24-635" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-636"><a href="#cb24-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-637"><a href="#cb24-637" aria-hidden="true" tabindex="-1"></a>That's exactly the same formula as the general backdoor adjustment formula—we successfully derived it using *do*-calculus rules!</span>
<span id="cb24-638"><a href="#cb24-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-639"><a href="#cb24-639" aria-hidden="true" tabindex="-1"></a>Most importantly, there are no $\operatorname{do}(\cdot)$ operators anywhere in this equation, making this estimand completely *do*-free and estimable using non-interventional observational data! As long as we close the backdoor confounding by adjusting for Z (however you want, like through inverse probability weighting, matching, fancy machine learning stuff, or whatever else—see <span class="co">[</span><span class="ot">this chapter</span><span class="co">](https://www.andrewheiss.com/research/chapters/heiss-causal-inference-2021/)</span>, or <span class="co">[</span><span class="ot">this blog post</span><span class="co">](https://www.andrewheiss.com/blog/2020/02/25/closing-backdoors-dags/)</span>, or <span class="co">[</span><span class="ot">this guide</span><span class="co">](https://evalf21.classes.andrewheiss.com/example/matching-ipw/)</span> for examples of how to do this), we can estimate the causal effect of X on Y (or $P(y \mid \operatorname{do}(x))$) with only observational data.</span>
<span id="cb24-640"><a href="#cb24-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-641"><a href="#cb24-641" aria-hidden="true" tabindex="-1"></a>Here's the derivation all at once:</span>
<span id="cb24-642"><a href="#cb24-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-643"><a href="#cb24-643" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-644"><a href="#cb24-644" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb24-645"><a href="#cb24-645" aria-hidden="true" tabindex="-1"></a>&amp; <span class="co">[</span><span class="ot">\text{Marginalization across } z + \text{chain rule for conditional probabilities}</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb24-646"><a href="#cb24-646" aria-hidden="true" tabindex="-1"></a>P(y \mid \operatorname{do}(x)) =&amp; \sum_z P(y \mid {\color{#FF4136} \operatorname{do}(x)}, z) \times P(z \mid {\color{#B10DC9} \operatorname{do}(x)}) <span class="sc">\\</span></span>
<span id="cb24-647"><a href="#cb24-647" aria-hidden="true" tabindex="-1"></a>&amp; <span class="co">[</span><span class="ot">\text{Use Rule 2 to treat } {\color{#FF4136} \operatorname{do}(x)} \text{ as } {\color{#FF4136} x}</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb24-648"><a href="#cb24-648" aria-hidden="true" tabindex="-1"></a>=&amp; \sum_z P(y \mid {\color{#FF4136} x}, z) \times P(z \mid {\color{#B10DC9} \operatorname{do}(x)}) <span class="sc">\\</span></span>
<span id="cb24-649"><a href="#cb24-649" aria-hidden="true" tabindex="-1"></a>&amp; <span class="co">[</span><span class="ot">\text{Use Rule 3 to nuke } {\color{#B10DC9} \operatorname{do}(x)}</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb24-650"><a href="#cb24-650" aria-hidden="true" tabindex="-1"></a>=&amp; \sum_z P(y \mid {\color{#FF4136} x}, z) \times P(z \mid {\color{#B10DC9} \text{nothing!}}) <span class="sc">\\</span></span>
<span id="cb24-651"><a href="#cb24-651" aria-hidden="true" tabindex="-1"></a>&amp; <span class="co">[</span><span class="ot">\text{Final backdoor adjustment formula!}</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb24-652"><a href="#cb24-652" aria-hidden="true" tabindex="-1"></a>=&amp; \sum_z P(y \mid x, z) \times P(z)</span>
<span id="cb24-653"><a href="#cb24-653" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb24-654"><a href="#cb24-654" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb24-655"><a href="#cb24-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-656"><a href="#cb24-656" aria-hidden="true" tabindex="-1"></a>That's so so cool!</span>
<span id="cb24-657"><a href="#cb24-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-658"><a href="#cb24-658" aria-hidden="true" tabindex="-1"></a>The frontdoor adjustment formula can be derived in a similar process—see <span class="co">[</span><span class="ot">the end of this post for an example</span><span class="co">](https://stephenmalina.com/post/2020-03-09-front-door-do-calc-derivation/#fn:1)</span> (with that, you apply Rules 2 and 3 repeatedly until all the $\operatorname{do}(\cdot)$ operators disappear)</span>
<span id="cb24-659"><a href="#cb24-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-660"><a href="#cb24-660" aria-hidden="true" tabindex="-1"></a>And in cases where there's no pre-derived backdoor or frontdoor adjustment formula, you can still apply these three *do*-calculus rules to attempt to identify the relationship between X and Y. Not all DAGs are fully estimable, but if they are estimable, the rules of *do*-calculus can be applied to derive the estimate. Fancier tools like <span class="co">[</span><span class="ot">Causal Fusion</span><span class="co">](https://causalfusion.net/)</span> help with this and automate the process.</span>
<span id="cb24-661"><a href="#cb24-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-662"><a href="#cb24-662" aria-hidden="true" tabindex="-1"></a><span class="fu">## References</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p><span class="faux-block"><i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> 2007–2024 Andrew Heiss</span> <span class="faux-block">All content licensed under<br><a href="https://creativecommons.org/licenses/by/4.0/"><i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> <i class="fa-brands fa-creative-commons-by" aria-label="creative-commons-by"></i> Creative Commons CC BY 4.0</a></span></p>
</div>   
    <div class="nav-footer-center">
<p><span class="faux-block"><i class="fa-brands fa-orcid" aria-label="orcid"></i> <strong>ORCID</strong> <a href="https://orcid.org/0000-0002-3948-3914">0000-0002-3948-3914</a></span> <span class="faux-block"><i class="fa-solid fa-key" aria-label="key"></i> <a href="../../../../../pgp_ath.asc.txt">PGP public key</a>   <i class="fa-solid fa-fingerprint" aria-label="fingerprint"></i> Fingerprint:<br><span class="fingerprint">4AA2 FA83 A8B2 05A4 E30F<br> 610D 1382 6216 9178 36AB</span></span></p>
</div>
    <div class="nav-footer-right">
<p><span class="faux-block">Made with <i class="fa-brands fa-r-project" aria-label="r-project"></i> and <a href="https://quarto.org/">Quarto</a></span> <span class="faux-block"><a href="https://github.com/andrewheiss/ath-quarto">View the source at <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></span></p>
</div>
  </div>
</footer>


</body></html>